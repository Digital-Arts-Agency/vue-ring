"use strict";(self["webpackChunkvue2"]=self["webpackChunkvue2"]||[]).push([[504],{1656:function(e,t,n){function i(e,t,n,i,r,s,o,a){var l,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),o?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=l):r&&(l=a?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(e,t){return l.call(t),u(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:c}}n.d(t,{A:function(){return i}})},2856:function(e,t,n){n.d(t,{Ay:function(){return Zi}});n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698),n(8992),n(3215),n(4520),n(3949),n(1454),n(8872),n(7550),n(9848);var i=Object.freeze({}),r=Array.isArray;function s(e){return void 0===e||null===e}function o(e){return void 0!==e&&null!==e}function a(e){return!0===e}function l(e){return!1===e}function c(e){return"string"===typeof e||"number"===typeof e||"symbol"===typeof e||"boolean"===typeof e}function u(e){return"function"===typeof e}function d(e){return null!==e&&"object"===typeof e}var h=Object.prototype.toString;function p(e){return"[object Object]"===h.call(e)}function f(e){return"[object RegExp]"===h.call(e)}function m(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function g(e){return o(e)&&"function"===typeof e.then&&"function"===typeof e.catch}function _(e){return null==e?"":Array.isArray(e)||p(e)&&e.toString===h?JSON.stringify(e,v,2):String(e)}function v(e,t){return t&&t.__v_isRef?t.value:t}function y(e){var t=parseFloat(e);return isNaN(t)?e:t}function b(e,t){for(var n=Object.create(null),i=e.split(","),r=0;r<i.length;r++)n[i[r]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}b("slot,component",!0);var A=b("key,ref,slot,slot-scope,is");function w(e,t){var n=e.length;if(n){if(t===e[n-1])return void(e.length=n-1);var i=e.indexOf(t);if(i>-1)return e.splice(i,1)}}var x=Object.prototype.hasOwnProperty;function E(e,t){return x.call(e,t)}function C(e){var t=Object.create(null);return function(n){var i=t[n];return i||(t[n]=e(n))}}var S=/-(\w)/g,M=C((function(e){return e.replace(S,(function(e,t){return t?t.toUpperCase():""}))})),T=C((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})),I=/\B([A-Z])/g,P=C((function(e){return e.replace(I,"-$1").toLowerCase()}));function R(e,t){function n(n){var i=arguments.length;return i?i>1?e.apply(t,arguments):e.call(t,n):e.call(t)}return n._length=e.length,n}function D(e,t){return e.bind(t)}var k=Function.prototype.bind?D:R;function B(e,t){t=t||0;var n=e.length-t,i=new Array(n);while(n--)i[n]=e[n+t];return i}function O(e,t){for(var n in t)e[n]=t[n];return e}function L(e){for(var t={},n=0;n<e.length;n++)e[n]&&O(t,e[n]);return t}function U(e,t,n){}var N=function(e,t,n){return!1},F=function(e){return e};function j(e,t){if(e===t)return!0;var n=d(e),i=d(t);if(!n||!i)return!n&&!i&&String(e)===String(t);try{var r=Array.isArray(e),s=Array.isArray(t);if(r&&s)return e.length===t.length&&e.every((function(e,n){return j(e,t[n])}));if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(r||s)return!1;var o=Object.keys(e),a=Object.keys(t);return o.length===a.length&&o.every((function(n){return j(e[n],t[n])}))}catch(l){return!1}}function z(e,t){for(var n=0;n<e.length;n++)if(j(e[n],t))return n;return-1}function G(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}function V(e,t){return e===t?0===e&&1/e!==1/t:e===e||t===t}var H="data-server-rendered",Q=["component","directive","filter"],W=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],q={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:N,isReservedAttr:N,isUnknownElement:N,getTagNamespace:U,parsePlatformTagName:F,mustUseProp:N,async:!0,_lifecycleHooks:W},X=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function Y(e){var t=(e+"").charCodeAt(0);return 36===t||95===t}function K(e,t,n,i){Object.defineProperty(e,t,{value:n,enumerable:!!i,writable:!0,configurable:!0})}var J=new RegExp("[^".concat(X.source,".$_\\d]"));function Z(e){if(!J.test(e)){var t=e.split(".");return function(e){for(var n=0;n<t.length;n++){if(!e)return;e=e[t[n]]}return e}}}var $="__proto__"in{},ee="undefined"!==typeof window,te=ee&&window.navigator.userAgent.toLowerCase(),ne=te&&/msie|trident/.test(te),ie=te&&te.indexOf("msie 9.0")>0,re=te&&te.indexOf("edge/")>0;te&&te.indexOf("android");var se=te&&/iphone|ipad|ipod|ios/.test(te);te&&/chrome\/\d+/.test(te),te&&/phantomjs/.test(te);var oe,ae=te&&te.match(/firefox\/(\d+)/),le={}.watch,ce=!1;if(ee)try{var ue={};Object.defineProperty(ue,"passive",{get:function(){ce=!0}}),window.addEventListener("test-passive",null,ue)}catch($o){}var de=function(){return void 0===oe&&(oe=!ee&&"undefined"!==typeof n.g&&(n.g["process"]&&"server"===n.g["process"].env.VUE_ENV)),oe},he=ee&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function pe(e){return"function"===typeof e&&/native code/.test(e.toString())}var fe,me="undefined"!==typeof Symbol&&pe(Symbol)&&"undefined"!==typeof Reflect&&pe(Reflect.ownKeys);fe="undefined"!==typeof Set&&pe(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var ge=null;function _e(e){void 0===e&&(e=null),e||ge&&ge._scope.off(),ge=e,e&&e._scope.on()}var ve=function(){function e(e,t,n,i,r,s,o,a){this.tag=e,this.data=t,this.children=n,this.text=i,this.elm=r,this.ns=void 0,this.context=s,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=o,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=a,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(e.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),e}(),ye=function(e){void 0===e&&(e="");var t=new ve;return t.text=e,t.isComment=!0,t};function be(e){return new ve(void 0,void 0,void 0,String(e))}function Ae(e){var t=new ve(e.tag,e.data,e.children&&e.children.slice(),e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.asyncMeta=e.asyncMeta,t.isCloned=!0,t}"function"===typeof SuppressedError&&SuppressedError;var we=0,xe=[],Ee=function(){for(var e=0;e<xe.length;e++){var t=xe[e];t.subs=t.subs.filter((function(e){return e})),t._pending=!1}xe.length=0},Ce=function(){function e(){this._pending=!1,this.id=we++,this.subs=[]}return e.prototype.addSub=function(e){this.subs.push(e)},e.prototype.removeSub=function(e){this.subs[this.subs.indexOf(e)]=null,this._pending||(this._pending=!0,xe.push(this))},e.prototype.depend=function(t){e.target&&e.target.addDep(this)},e.prototype.notify=function(e){var t=this.subs.filter((function(e){return e}));for(var n=0,i=t.length;n<i;n++){var r=t[n];0,r.update()}},e}();Ce.target=null;var Se=[];function Me(e){Se.push(e),Ce.target=e}function Te(){Se.pop(),Ce.target=Se[Se.length-1]}var Ie=Array.prototype,Pe=Object.create(Ie),Re=["push","pop","shift","unshift","splice","sort","reverse"];Re.forEach((function(e){var t=Ie[e];K(Pe,e,(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r,s=t.apply(this,n),o=this.__ob__;switch(e){case"push":case"unshift":r=n;break;case"splice":r=n.slice(2);break}return r&&o.observeArray(r),o.dep.notify(),s}))}));var De=Object.getOwnPropertyNames(Pe),ke={},Be=!0;function Oe(e){Be=e}var Le={notify:U,depend:U,addSub:U,removeSub:U},Ue=function(){function e(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),this.value=e,this.shallow=t,this.mock=n,this.dep=n?Le:new Ce,this.vmCount=0,K(e,"__ob__",this),r(e)){if(!n)if($)e.__proto__=Pe;else for(var i=0,s=De.length;i<s;i++){var o=De[i];K(e,o,Pe[o])}t||this.observeArray(e)}else{var a=Object.keys(e);for(i=0;i<a.length;i++){o=a[i];Fe(e,o,ke,void 0,t,n)}}}return e.prototype.observeArray=function(e){for(var t=0,n=e.length;t<n;t++)Ne(e[t],!1,this.mock)},e}();function Ne(e,t,n){return e&&E(e,"__ob__")&&e.__ob__ instanceof Ue?e.__ob__:!Be||!n&&de()||!r(e)&&!p(e)||!Object.isExtensible(e)||e.__v_skip||We(e)||e instanceof ve?void 0:new Ue(e,t,n)}function Fe(e,t,n,i,s,o,a){void 0===a&&(a=!1);var l=new Ce,c=Object.getOwnPropertyDescriptor(e,t);if(!c||!1!==c.configurable){var u=c&&c.get,d=c&&c.set;u&&!d||n!==ke&&2!==arguments.length||(n=e[t]);var h=s?n&&n.__ob__:Ne(n,!1,o);return Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=u?u.call(e):n;return Ce.target&&(l.depend(),h&&(h.dep.depend(),r(t)&&Ge(t))),We(t)&&!s?t.value:t},set:function(t){var i=u?u.call(e):n;if(V(i,t)){if(d)d.call(e,t);else{if(u)return;if(!s&&We(i)&&!We(t))return void(i.value=t);n=t}h=s?t&&t.__ob__:Ne(t,!1,o),l.notify()}}}),l}}function je(e,t,n){if(!Qe(e)){var i=e.__ob__;return r(e)&&m(t)?(e.length=Math.max(e.length,t),e.splice(t,1,n),i&&!i.shallow&&i.mock&&Ne(n,!1,!0),n):t in e&&!(t in Object.prototype)?(e[t]=n,n):e._isVue||i&&i.vmCount?n:i?(Fe(i.value,t,n,void 0,i.shallow,i.mock),i.dep.notify(),n):(e[t]=n,n)}}function ze(e,t){if(r(e)&&m(t))e.splice(t,1);else{var n=e.__ob__;e._isVue||n&&n.vmCount||Qe(e)||E(e,t)&&(delete e[t],n&&n.dep.notify())}}function Ge(e){for(var t=void 0,n=0,i=e.length;n<i;n++)t=e[n],t&&t.__ob__&&t.__ob__.dep.depend(),r(t)&&Ge(t)}function Ve(e){return He(e,!0),K(e,"__v_isShallow",!0),e}function He(e,t){if(!Qe(e)){Ne(e,t,de());0}}function Qe(e){return!(!e||!e.__v_isReadonly)}function We(e){return!(!e||!0!==e.__v_isRef)}function qe(e,t,n){Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:function(){var e=t[n];if(We(e))return e.value;var i=e&&e.__ob__;return i&&i.dep.depend(),e},set:function(e){var i=t[n];We(i)&&!We(e)?i.value=e:t[n]=e}})}var Xe="watcher";"".concat(Xe," callback"),"".concat(Xe," getter"),"".concat(Xe," cleanup");var Ye;var Ke=function(){function e(e){void 0===e&&(e=!1),this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Ye,!e&&Ye&&(this.index=(Ye.scopes||(Ye.scopes=[])).push(this)-1)}return e.prototype.run=function(e){if(this.active){var t=Ye;try{return Ye=this,e()}finally{Ye=t}}else 0},e.prototype.on=function(){Ye=this},e.prototype.off=function(){Ye=this.parent},e.prototype.stop=function(e){if(this.active){var t=void 0,n=void 0;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].teardown();for(t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){var i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this.active=!1}},e}();function Je(e,t){void 0===t&&(t=Ye),t&&t.active&&t.effects.push(e)}function Ze(){return Ye}function $e(e){var t=e._provided,n=e.$parent&&e.$parent._provided;return n===t?e._provided=Object.create(n):t}var et=C((function(e){var t="&"===e.charAt(0);e=t?e.slice(1):e;var n="~"===e.charAt(0);e=n?e.slice(1):e;var i="!"===e.charAt(0);return e=i?e.slice(1):e,{name:e,once:n,capture:i,passive:t}}));function tt(e,t){function n(){var e=n.fns;if(!r(e))return Jt(e,null,arguments,t,"v-on handler");for(var i=e.slice(),s=0;s<i.length;s++)Jt(i[s],null,arguments,t,"v-on handler")}return n.fns=e,n}function nt(e,t,n,i,r,o){var l,c,u,d;for(l in e)c=e[l],u=t[l],d=et(l),s(c)||(s(u)?(s(c.fns)&&(c=e[l]=tt(c,o)),a(d.once)&&(c=e[l]=r(d.name,c,d.capture)),n(d.name,c,d.capture,d.passive,d.params)):c!==u&&(u.fns=c,e[l]=u));for(l in t)s(e[l])&&(d=et(l),i(d.name,t[l],d.capture))}function it(e,t,n){var i;e instanceof ve&&(e=e.data.hook||(e.data.hook={}));var r=e[t];function l(){n.apply(this,arguments),w(i.fns,l)}s(r)?i=tt([l]):o(r.fns)&&a(r.merged)?(i=r,i.fns.push(l)):i=tt([r,l]),i.merged=!0,e[t]=i}function rt(e,t,n){var i=t.options.props;if(!s(i)){var r={},a=e.attrs,l=e.props;if(o(a)||o(l))for(var c in i){var u=P(c);st(r,l,c,u,!0)||st(r,a,c,u,!1)}return r}}function st(e,t,n,i,r){if(o(t)){if(E(t,n))return e[n]=t[n],r||delete t[n],!0;if(E(t,i))return e[n]=t[i],r||delete t[i],!0}return!1}function ot(e){for(var t=0;t<e.length;t++)if(r(e[t]))return Array.prototype.concat.apply([],e);return e}function at(e){return c(e)?[be(e)]:r(e)?ct(e):void 0}function lt(e){return o(e)&&o(e.text)&&l(e.isComment)}function ct(e,t){var n,i,l,u,d=[];for(n=0;n<e.length;n++)i=e[n],s(i)||"boolean"===typeof i||(l=d.length-1,u=d[l],r(i)?i.length>0&&(i=ct(i,"".concat(t||"","_").concat(n)),lt(i[0])&&lt(u)&&(d[l]=be(u.text+i[0].text),i.shift()),d.push.apply(d,i)):c(i)?lt(u)?d[l]=be(u.text+i):""!==i&&d.push(be(i)):lt(i)&&lt(u)?d[l]=be(u.text+i.text):(a(e._isVList)&&o(i.tag)&&s(i.key)&&o(t)&&(i.key="__vlist".concat(t,"_").concat(n,"__")),d.push(i)));return d}function ut(e,t){var n,i,s,a,l=null;if(r(e)||"string"===typeof e)for(l=new Array(e.length),n=0,i=e.length;n<i;n++)l[n]=t(e[n],n);else if("number"===typeof e)for(l=new Array(e),n=0;n<e;n++)l[n]=t(n+1,n);else if(d(e))if(me&&e[Symbol.iterator]){l=[];var c=e[Symbol.iterator](),u=c.next();while(!u.done)l.push(t(u.value,l.length)),u=c.next()}else for(s=Object.keys(e),l=new Array(s.length),n=0,i=s.length;n<i;n++)a=s[n],l[n]=t(e[a],a,n);return o(l)||(l=[]),l._isVList=!0,l}function dt(e,t,n,i){var r,s=this.$scopedSlots[e];s?(n=n||{},i&&(n=O(O({},i),n)),r=s(n)||(u(t)?t():t)):r=this.$slots[e]||(u(t)?t():t);var o=n&&n.slot;return o?this.$createElement("template",{slot:o},r):r}function ht(e){return Ci(this.$options,"filters",e,!0)||F}function pt(e,t){return r(e)?-1===e.indexOf(t):e!==t}function ft(e,t,n,i,r){var s=q.keyCodes[t]||n;return r&&i&&!q.keyCodes[t]?pt(r,i):s?pt(s,e):i?P(i)!==t:void 0===e}function mt(e,t,n,i,s){if(n)if(d(n)){r(n)&&(n=L(n));var o=void 0,a=function(r){if("class"===r||"style"===r||A(r))o=e;else{var a=e.attrs&&e.attrs.type;o=i||q.mustUseProp(t,a,r)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}var l=M(r),c=P(r);if(!(l in o)&&!(c in o)&&(o[r]=n[r],s)){var u=e.on||(e.on={});u["update:".concat(r)]=function(e){n[r]=e}}};for(var l in n)a(l)}else;return e}function gt(e,t){var n=this._staticTrees||(this._staticTrees=[]),i=n[e];return i&&!t||(i=n[e]=this.$options.staticRenderFns[e].call(this._renderProxy,this._c,this),vt(i,"__static__".concat(e),!1)),i}function _t(e,t,n){return vt(e,"__once__".concat(t).concat(n?"_".concat(n):""),!0),e}function vt(e,t,n){if(r(e))for(var i=0;i<e.length;i++)e[i]&&"string"!==typeof e[i]&&yt(e[i],"".concat(t,"_").concat(i),n);else yt(e,t,n)}function yt(e,t,n){e.isStatic=!0,e.key=t,e.isOnce=n}function bt(e,t){if(t)if(p(t)){var n=e.on=e.on?O({},e.on):{};for(var i in t){var r=n[i],s=t[i];n[i]=r?[].concat(r,s):s}}else;return e}function At(e,t,n,i){t=t||{$stable:!n};for(var s=0;s<e.length;s++){var o=e[s];r(o)?At(o,t,n):o&&(o.proxy&&(o.fn.proxy=!0),t[o.key]=o.fn)}return i&&(t.$key=i),t}function wt(e,t){for(var n=0;n<t.length;n+=2){var i=t[n];"string"===typeof i&&i&&(e[t[n]]=t[n+1])}return e}function xt(e,t){return"string"===typeof e?t+e:e}function Et(e){e._o=_t,e._n=y,e._s=_,e._l=ut,e._t=dt,e._q=j,e._i=z,e._m=gt,e._f=ht,e._k=ft,e._b=mt,e._v=be,e._e=ye,e._u=At,e._g=bt,e._d=wt,e._p=xt}function Ct(e,t){if(!e||!e.length)return{};for(var n={},i=0,r=e.length;i<r;i++){var s=e[i],o=s.data;if(o&&o.attrs&&o.attrs.slot&&delete o.attrs.slot,s.context!==t&&s.fnContext!==t||!o||null==o.slot)(n.default||(n.default=[])).push(s);else{var a=o.slot,l=n[a]||(n[a]=[]);"template"===s.tag?l.push.apply(l,s.children||[]):l.push(s)}}for(var c in n)n[c].every(St)&&delete n[c];return n}function St(e){return e.isComment&&!e.asyncFactory||" "===e.text}function Mt(e){return e.isComment&&e.asyncFactory}function Tt(e,t,n,r){var s,o=Object.keys(n).length>0,a=t?!!t.$stable:!o,l=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(a&&r&&r!==i&&l===r.$key&&!o&&!r.$hasNormal)return r;for(var c in s={},t)t[c]&&"$"!==c[0]&&(s[c]=It(e,n,c,t[c]))}else s={};for(var u in n)u in s||(s[u]=Pt(n,u));return t&&Object.isExtensible(t)&&(t._normalized=s),K(s,"$stable",a),K(s,"$key",l),K(s,"$hasNormal",o),s}function It(e,t,n,i){var s=function(){var t=ge;_e(e);var n=arguments.length?i.apply(null,arguments):i({});n=n&&"object"===typeof n&&!r(n)?[n]:at(n);var s=n&&n[0];return _e(t),n&&(!s||1===n.length&&s.isComment&&!Mt(s))?void 0:n};return i.proxy&&Object.defineProperty(t,n,{get:s,enumerable:!0,configurable:!0}),s}function Pt(e,t){return function(){return e[t]}}function Rt(e){var t=e.$options,n=t.setup;if(n){var i=e._setupContext=Dt(e);_e(e),Me();var r=Jt(n,null,[e._props||Ve({}),i],e,"setup");if(Te(),_e(),u(r))t.render=r;else if(d(r))if(e._setupState=r,r.__sfc){var s=e._setupProxy={};for(var o in r)"__sfc"!==o&&qe(s,r,o)}else for(var o in r)Y(o)||qe(e,r,o);else 0}}function Dt(e){return{get attrs(){if(!e._attrsProxy){var t=e._attrsProxy={};K(t,"_v_attr_proxy",!0),kt(t,e.$attrs,i,e,"$attrs")}return e._attrsProxy},get listeners(){if(!e._listenersProxy){var t=e._listenersProxy={};kt(t,e.$listeners,i,e,"$listeners")}return e._listenersProxy},get slots(){return Ot(e)},emit:k(e.$emit,e),expose:function(t){t&&Object.keys(t).forEach((function(n){return qe(e,t,n)}))}}}function kt(e,t,n,i,r){var s=!1;for(var o in t)o in e?t[o]!==n[o]&&(s=!0):(s=!0,Bt(e,o,i,r));for(var o in e)o in t||(s=!0,delete e[o]);return s}function Bt(e,t,n,i){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return n[i][t]}})}function Ot(e){return e._slotsProxy||Lt(e._slotsProxy={},e.$scopedSlots),e._slotsProxy}function Lt(e,t){for(var n in t)e[n]=t[n];for(var n in e)n in t||delete e[n]}function Ut(e){e._vnode=null,e._staticTrees=null;var t=e.$options,n=e.$vnode=t._parentVnode,r=n&&n.context;e.$slots=Ct(t._renderChildren,r),e.$scopedSlots=n?Tt(e.$parent,n.data.scopedSlots,e.$slots):i,e._c=function(t,n,i,r){return Wt(e,t,n,i,r,!1)},e.$createElement=function(t,n,i,r){return Wt(e,t,n,i,r,!0)};var s=n&&n.data;Fe(e,"$attrs",s&&s.attrs||i,null,!0),Fe(e,"$listeners",t._parentListeners||i,null,!0)}var Nt=null;function Ft(e){Et(e.prototype),e.prototype.$nextTick=function(e){return un(e,this)},e.prototype._render=function(){var e=this,t=e.$options,n=t.render,i=t._parentVnode;i&&e._isMounted&&(e.$scopedSlots=Tt(e.$parent,i.data.scopedSlots,e.$slots,e.$scopedSlots),e._slotsProxy&&Lt(e._slotsProxy,e.$scopedSlots)),e.$vnode=i;var s,o=ge,a=Nt;try{_e(e),Nt=e,s=n.call(e._renderProxy,e.$createElement)}catch($o){Kt($o,e,"render"),s=e._vnode}finally{Nt=a,_e(o)}return r(s)&&1===s.length&&(s=s[0]),s instanceof ve||(s=ye()),s.parent=i,s}}function jt(e,t){return(e.__esModule||me&&"Module"===e[Symbol.toStringTag])&&(e=e.default),d(e)?t.extend(e):e}function zt(e,t,n,i,r){var s=ye();return s.asyncFactory=e,s.asyncMeta={data:t,context:n,children:i,tag:r},s}function Gt(e,t){if(a(e.error)&&o(e.errorComp))return e.errorComp;if(o(e.resolved))return e.resolved;var n=Nt;if(n&&o(e.owners)&&-1===e.owners.indexOf(n)&&e.owners.push(n),a(e.loading)&&o(e.loadingComp))return e.loadingComp;if(n&&!o(e.owners)){var i=e.owners=[n],r=!0,l=null,c=null;n.$on("hook:destroyed",(function(){return w(i,n)}));var u=function(e){for(var t=0,n=i.length;t<n;t++)i[t].$forceUpdate();e&&(i.length=0,null!==l&&(clearTimeout(l),l=null),null!==c&&(clearTimeout(c),c=null))},h=G((function(n){e.resolved=jt(n,t),r?i.length=0:u(!0)})),p=G((function(t){o(e.errorComp)&&(e.error=!0,u(!0))})),f=e(h,p);return d(f)&&(g(f)?s(e.resolved)&&f.then(h,p):g(f.component)&&(f.component.then(h,p),o(f.error)&&(e.errorComp=jt(f.error,t)),o(f.loading)&&(e.loadingComp=jt(f.loading,t),0===f.delay?e.loading=!0:l=setTimeout((function(){l=null,s(e.resolved)&&s(e.error)&&(e.loading=!0,u(!1))}),f.delay||200)),o(f.timeout)&&(c=setTimeout((function(){c=null,s(e.resolved)&&p(null)}),f.timeout)))),r=!1,e.loading?e.loadingComp:e.resolved}}function Vt(e){if(r(e))for(var t=0;t<e.length;t++){var n=e[t];if(o(n)&&(o(n.componentOptions)||Mt(n)))return n}}var Ht=1,Qt=2;function Wt(e,t,n,i,s,o){return(r(n)||c(n))&&(s=i,i=n,n=void 0),a(o)&&(s=Qt),qt(e,t,n,i,s)}function qt(e,t,n,i,s){if(o(n)&&o(n.__ob__))return ye();if(o(n)&&o(n.is)&&(t=n.is),!t)return ye();var a,l;if(r(i)&&u(i[0])&&(n=n||{},n.scopedSlots={default:i[0]},i.length=0),s===Qt?i=at(i):s===Ht&&(i=ot(i)),"string"===typeof t){var c=void 0;l=e.$vnode&&e.$vnode.ns||q.getTagNamespace(t),a=q.isReservedTag(t)?new ve(q.parsePlatformTagName(t),n,i,void 0,void 0,e):n&&n.pre||!o(c=Ci(e.$options,"components",t))?new ve(t,n,i,void 0,void 0,e):li(c,n,e,i,t)}else a=li(t,n,e,i);return r(a)?a:o(a)?(o(l)&&Xt(a,l),o(n)&&Yt(n),a):ye()}function Xt(e,t,n){if(e.ns=t,"foreignObject"===e.tag&&(t=void 0,n=!0),o(e.children))for(var i=0,r=e.children.length;i<r;i++){var l=e.children[i];o(l.tag)&&(s(l.ns)||a(n)&&"svg"!==l.tag)&&Xt(l,t,n)}}function Yt(e){d(e.style)&&mn(e.style),d(e.class)&&mn(e.class)}function Kt(e,t,n){Me();try{if(t){var i=t;while(i=i.$parent){var r=i.$options.errorCaptured;if(r)for(var s=0;s<r.length;s++)try{var o=!1===r[s].call(i,e,t,n);if(o)return}catch($o){Zt($o,i,"errorCaptured hook")}}}Zt(e,t,n)}finally{Te()}}function Jt(e,t,n,i,r){var s;try{s=n?e.apply(t,n):e.call(t),s&&!s._isVue&&g(s)&&!s._handled&&(s.catch((function(e){return Kt(e,i,r+" (Promise/async)")})),s._handled=!0)}catch($o){Kt($o,i,r)}return s}function Zt(e,t,n){if(q.errorHandler)try{return q.errorHandler.call(null,e,t,n)}catch($o){$o!==e&&$t($o,null,"config.errorHandler")}$t(e,t,n)}function $t(e,t,n){if(!ee||"undefined"===typeof console)throw e;console.error(e)}var en,tn=!1,nn=[],rn=!1;function sn(){rn=!1;var e=nn.slice(0);nn.length=0;for(var t=0;t<e.length;t++)e[t]()}if("undefined"!==typeof Promise&&pe(Promise)){var on=Promise.resolve();en=function(){on.then(sn),se&&setTimeout(U)},tn=!0}else if(ne||"undefined"===typeof MutationObserver||!pe(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())en="undefined"!==typeof setImmediate&&pe(setImmediate)?function(){setImmediate(sn)}:function(){setTimeout(sn,0)};else{var an=1,ln=new MutationObserver(sn),cn=document.createTextNode(String(an));ln.observe(cn,{characterData:!0}),en=function(){an=(an+1)%2,cn.data=String(an)},tn=!0}function un(e,t){var n;if(nn.push((function(){if(e)try{e.call(t)}catch($o){Kt($o,t,"nextTick")}else n&&n(t)})),rn||(rn=!0,en()),!e&&"undefined"!==typeof Promise)return new Promise((function(e){n=e}))}function dn(e){return function(t,n){if(void 0===n&&(n=ge),n)return hn(n,e,t)}}function hn(e,t,n){var i=e.$options;i[t]=_i(i[t],n)}dn("beforeMount"),dn("mounted"),dn("beforeUpdate"),dn("updated"),dn("beforeDestroy"),dn("destroyed"),dn("activated"),dn("deactivated"),dn("serverPrefetch"),dn("renderTracked"),dn("renderTriggered"),dn("errorCaptured");var pn="2.7.16";var fn=new fe;function mn(e){return gn(e,fn),fn.clear(),e}function gn(e,t){var n,i,s=r(e);if(!(!s&&!d(e)||e.__v_skip||Object.isFrozen(e)||e instanceof ve)){if(e.__ob__){var o=e.__ob__.dep.id;if(t.has(o))return;t.add(o)}if(s){n=e.length;while(n--)gn(e[n],t)}else if(We(e))gn(e.value,t);else{i=Object.keys(e),n=i.length;while(n--)gn(e[i[n]],t)}}}var _n,vn=0,yn=function(){function e(e,t,n,i,r){Je(this,Ye&&!Ye._vm?Ye:e?e._scope:void 0),(this.vm=e)&&r&&(e._watcher=this),i?(this.deep=!!i.deep,this.user=!!i.user,this.lazy=!!i.lazy,this.sync=!!i.sync,this.before=i.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++vn,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new fe,this.newDepIds=new fe,this.expression="",u(t)?this.getter=t:(this.getter=Z(t),this.getter||(this.getter=U)),this.value=this.lazy?void 0:this.get()}return e.prototype.get=function(){var e;Me(this);var t=this.vm;try{e=this.getter.call(t,t)}catch($o){if(!this.user)throw $o;Kt($o,t,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&mn(e),Te(),this.cleanupDeps()}return e},e.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},e.prototype.cleanupDeps=function(){var e=this.deps.length;while(e--){var t=this.deps[e];this.newDepIds.has(t.id)||t.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},e.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():Jn(this)},e.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||d(e)||this.deep){var t=this.value;if(this.value=e,this.user){var n='callback for watcher "'.concat(this.expression,'"');Jt(this.cb,this.vm,[e,t],this.vm,n)}else this.cb.call(this.vm,e,t)}}},e.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},e.prototype.depend=function(){var e=this.deps.length;while(e--)this.deps[e].depend()},e.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&w(this.vm._scope.effects,this),this.active){var e=this.deps.length;while(e--)this.deps[e].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},e}();function bn(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&En(e,t)}function An(e,t){_n.$on(e,t)}function wn(e,t){_n.$off(e,t)}function xn(e,t){var n=_n;return function i(){var r=t.apply(null,arguments);null!==r&&n.$off(e,i)}}function En(e,t,n){_n=e,nt(t,n||{},An,wn,xn,e),_n=void 0}function Cn(e){var t=/^hook:/;e.prototype.$on=function(e,n){var i=this;if(r(e))for(var s=0,o=e.length;s<o;s++)i.$on(e[s],n);else(i._events[e]||(i._events[e]=[])).push(n),t.test(e)&&(i._hasHookEvent=!0);return i},e.prototype.$once=function(e,t){var n=this;function i(){n.$off(e,i),t.apply(n,arguments)}return i.fn=t,n.$on(e,i),n},e.prototype.$off=function(e,t){var n=this;if(!arguments.length)return n._events=Object.create(null),n;if(r(e)){for(var i=0,s=e.length;i<s;i++)n.$off(e[i],t);return n}var o,a=n._events[e];if(!a)return n;if(!t)return n._events[e]=null,n;var l=a.length;while(l--)if(o=a[l],o===t||o.fn===t){a.splice(l,1);break}return n},e.prototype.$emit=function(e){var t=this,n=t._events[e];if(n){n=n.length>1?B(n):n;for(var i=B(arguments,1),r='event handler for "'.concat(e,'"'),s=0,o=n.length;s<o;s++)Jt(n[s],t,i,t,r)}return t}}var Sn=null;function Mn(e){var t=Sn;return Sn=e,function(){Sn=t}}function Tn(e){var t=e.$options,n=t.parent;if(n&&!t.abstract){while(n.$options.abstract&&n.$parent)n=n.$parent;n.$children.push(e)}e.$parent=n,e.$root=n?n.$root:e,e.$children=[],e.$refs={},e._provided=n?n._provided:Object.create(null),e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}function In(e){e.prototype._update=function(e,t){var n=this,i=n.$el,r=n._vnode,s=Mn(n);n._vnode=e,n.$el=r?n.__patch__(r,e):n.__patch__(n.$el,e,t,!1),s(),i&&(i.__vue__=null),n.$el&&(n.$el.__vue__=n);var o=n;while(o&&o.$vnode&&o.$parent&&o.$vnode===o.$parent._vnode)o.$parent.$el=o.$el,o=o.$parent},e.prototype.$forceUpdate=function(){var e=this;e._watcher&&e._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){On(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||w(t.$children,e),e._scope.stop(),e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),On(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}function Pn(e,t,n){var i;e.$el=t,e.$options.render||(e.$options.render=ye),On(e,"beforeMount"),i=function(){e._update(e._render(),n)};var r={before:function(){e._isMounted&&!e._isDestroyed&&On(e,"beforeUpdate")}};new yn(e,i,U,r,!0),n=!1;var s=e._preWatchers;if(s)for(var o=0;o<s.length;o++)s[o].run();return null==e.$vnode&&(e._isMounted=!0,On(e,"mounted")),e}function Rn(e,t,n,r,s){var o=r.data.scopedSlots,a=e.$scopedSlots,l=!!(o&&!o.$stable||a!==i&&!a.$stable||o&&e.$scopedSlots.$key!==o.$key||!o&&e.$scopedSlots.$key),c=!!(s||e.$options._renderChildren||l),u=e.$vnode;e.$options._parentVnode=r,e.$vnode=r,e._vnode&&(e._vnode.parent=r),e.$options._renderChildren=s;var d=r.data.attrs||i;e._attrsProxy&&kt(e._attrsProxy,d,u.data&&u.data.attrs||i,e,"$attrs")&&(c=!0),e.$attrs=d,n=n||i;var h=e.$options._parentListeners;if(e._listenersProxy&&kt(e._listenersProxy,n,h||i,e,"$listeners"),e.$listeners=e.$options._parentListeners=n,En(e,n,h),t&&e.$options.props){Oe(!1);for(var p=e._props,f=e.$options._propKeys||[],m=0;m<f.length;m++){var g=f[m],_=e.$options.props;p[g]=Si(g,_,t,e)}Oe(!0),e.$options.propsData=t}c&&(e.$slots=Ct(s,r.context),e.$forceUpdate())}function Dn(e){while(e&&(e=e.$parent))if(e._inactive)return!0;return!1}function kn(e,t){if(t){if(e._directInactive=!1,Dn(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var n=0;n<e.$children.length;n++)kn(e.$children[n]);On(e,"activated")}}function Bn(e,t){if((!t||(e._directInactive=!0,!Dn(e)))&&!e._inactive){e._inactive=!0;for(var n=0;n<e.$children.length;n++)Bn(e.$children[n]);On(e,"deactivated")}}function On(e,t,n,i){void 0===i&&(i=!0),Me();var r=ge,s=Ze();i&&_e(e);var o=e.$options[t],a="".concat(t," hook");if(o)for(var l=0,c=o.length;l<c;l++)Jt(o[l],e,n||null,e,a);e._hasHookEvent&&e.$emit("hook:"+t),i&&(_e(r),s&&s.on()),Te()}var Ln=[],Un=[],Nn={},Fn=!1,jn=!1,zn=0;function Gn(){zn=Ln.length=Un.length=0,Nn={},Fn=jn=!1}var Vn=0,Hn=Date.now;if(ee&&!ne){var Qn=window.performance;Qn&&"function"===typeof Qn.now&&Hn()>document.createEvent("Event").timeStamp&&(Hn=function(){return Qn.now()})}var Wn=function(e,t){if(e.post){if(!t.post)return 1}else if(t.post)return-1;return e.id-t.id};function qn(){var e,t;for(Vn=Hn(),jn=!0,Ln.sort(Wn),zn=0;zn<Ln.length;zn++)e=Ln[zn],e.before&&e.before(),t=e.id,Nn[t]=null,e.run();var n=Un.slice(),i=Ln.slice();Gn(),Kn(n),Xn(i),Ee(),he&&q.devtools&&he.emit("flush")}function Xn(e){var t=e.length;while(t--){var n=e[t],i=n.vm;i&&i._watcher===n&&i._isMounted&&!i._isDestroyed&&On(i,"updated")}}function Yn(e){e._inactive=!1,Un.push(e)}function Kn(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,kn(e[t],!0)}function Jn(e){var t=e.id;if(null==Nn[t]&&(e!==Ce.target||!e.noRecurse)){if(Nn[t]=!0,jn){var n=Ln.length-1;while(n>zn&&Ln[n].id>e.id)n--;Ln.splice(n+1,0,e)}else Ln.push(e);Fn||(Fn=!0,un(qn))}}function Zn(e){var t=e.$options.provide;if(t){var n=u(t)?t.call(e):t;if(!d(n))return;for(var i=$e(e),r=me?Reflect.ownKeys(n):Object.keys(n),s=0;s<r.length;s++){var o=r[s];Object.defineProperty(i,o,Object.getOwnPropertyDescriptor(n,o))}}}function $n(e){var t=ei(e.$options.inject,e);t&&(Oe(!1),Object.keys(t).forEach((function(n){Fe(e,n,t[n])})),Oe(!0))}function ei(e,t){if(e){for(var n=Object.create(null),i=me?Reflect.ownKeys(e):Object.keys(e),r=0;r<i.length;r++){var s=i[r];if("__ob__"!==s){var o=e[s].from;if(o in t._provided)n[s]=t._provided[o];else if("default"in e[s]){var a=e[s].default;n[s]=u(a)?a.call(t):a}else 0}}return n}}function ti(e,t,n,s,o){var l,c=this,u=o.options;E(s,"_uid")?(l=Object.create(s),l._original=s):(l=s,s=s._original);var d=a(u._compiled),h=!d;this.data=e,this.props=t,this.children=n,this.parent=s,this.listeners=e.on||i,this.injections=ei(u.inject,s),this.slots=function(){return c.$slots||Tt(s,e.scopedSlots,c.$slots=Ct(n,s)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return Tt(s,e.scopedSlots,this.slots())}}),d&&(this.$options=u,this.$slots=this.slots(),this.$scopedSlots=Tt(s,e.scopedSlots,this.$slots)),u._scopeId?this._c=function(e,t,n,i){var o=Wt(l,e,t,n,i,h);return o&&!r(o)&&(o.fnScopeId=u._scopeId,o.fnContext=s),o}:this._c=function(e,t,n,i){return Wt(l,e,t,n,i,h)}}function ni(e,t,n,s,a){var l=e.options,c={},u=l.props;if(o(u))for(var d in u)c[d]=Si(d,u,t||i);else o(n.attrs)&&ri(c,n.attrs),o(n.props)&&ri(c,n.props);var h=new ti(n,c,a,s,e),p=l.render.call(null,h._c,h);if(p instanceof ve)return ii(p,n,h.parent,l,h);if(r(p)){for(var f=at(p)||[],m=new Array(f.length),g=0;g<f.length;g++)m[g]=ii(f[g],n,h.parent,l,h);return m}}function ii(e,t,n,i,r){var s=Ae(e);return s.fnContext=n,s.fnOptions=i,t.slot&&((s.data||(s.data={})).slot=t.slot),s}function ri(e,t){for(var n in t)e[M(n)]=t[n]}function si(e){return e.name||e.__name||e._componentTag}Et(ti.prototype);var oi={init:function(e,t){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var n=e;oi.prepatch(n,n)}else{var i=e.componentInstance=ci(e,Sn);i.$mount(t?e.elm:void 0,t)}},prepatch:function(e,t){var n=t.componentOptions,i=t.componentInstance=e.componentInstance;Rn(i,n.propsData,n.listeners,t,n.children)},insert:function(e){var t=e.context,n=e.componentInstance;n._isMounted||(n._isMounted=!0,On(n,"mounted")),e.data.keepAlive&&(t._isMounted?Yn(n):kn(n,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?Bn(t,!0):t.$destroy())}},ai=Object.keys(oi);function li(e,t,n,i,r){if(!s(e)){var l=n.$options._base;if(d(e)&&(e=l.extend(e)),"function"===typeof e){var c;if(s(e.cid)&&(c=e,e=Gt(c,l),void 0===e))return zt(c,t,n,i,r);t=t||{},Ki(e),o(t.model)&&hi(e.options,t);var u=rt(t,e,r);if(a(e.options.functional))return ni(e,u,t,n,i);var h=t.on;if(t.on=t.nativeOn,a(e.options.abstract)){var p=t.slot;t={},p&&(t.slot=p)}ui(t);var f=si(e.options)||r,m=new ve("vue-component-".concat(e.cid).concat(f?"-".concat(f):""),t,void 0,void 0,void 0,n,{Ctor:e,propsData:u,listeners:h,tag:r,children:i},c);return m}}}function ci(e,t){var n={_isComponent:!0,_parentVnode:e,parent:t},i=e.data.inlineTemplate;return o(i)&&(n.render=i.render,n.staticRenderFns=i.staticRenderFns),new e.componentOptions.Ctor(n)}function ui(e){for(var t=e.hook||(e.hook={}),n=0;n<ai.length;n++){var i=ai[n],r=t[i],s=oi[i];r===s||r&&r._merged||(t[i]=r?di(s,r):s)}}function di(e,t){var n=function(n,i){e(n,i),t(n,i)};return n._merged=!0,n}function hi(e,t){var n=e.model&&e.model.prop||"value",i=e.model&&e.model.event||"input";(t.attrs||(t.attrs={}))[n]=t.model.value;var s=t.on||(t.on={}),a=s[i],l=t.model.callback;o(a)?(r(a)?-1===a.indexOf(l):a!==l)&&(s[i]=[l].concat(a)):s[i]=l}var pi=U,fi=q.optionMergeStrategies;function mi(e,t,n){if(void 0===n&&(n=!0),!t)return e;for(var i,r,s,o=me?Reflect.ownKeys(t):Object.keys(t),a=0;a<o.length;a++)i=o[a],"__ob__"!==i&&(r=e[i],s=t[i],n&&E(e,i)?r!==s&&p(r)&&p(s)&&mi(r,s):je(e,i,s));return e}function gi(e,t,n){return n?function(){var i=u(t)?t.call(n,n):t,r=u(e)?e.call(n,n):e;return i?mi(i,r):r}:t?e?function(){return mi(u(t)?t.call(this,this):t,u(e)?e.call(this,this):e)}:t:e}function _i(e,t){var n=t?e?e.concat(t):r(t)?t:[t]:e;return n?vi(n):n}function vi(e){for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}function yi(e,t,n,i){var r=Object.create(e||null);return t?O(r,t):r}fi.data=function(e,t,n){return n?gi(e,t,n):t&&"function"!==typeof t?e:gi(e,t)},W.forEach((function(e){fi[e]=_i})),Q.forEach((function(e){fi[e+"s"]=yi})),fi.watch=function(e,t,n,i){if(e===le&&(e=void 0),t===le&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var s={};for(var o in O(s,e),t){var a=s[o],l=t[o];a&&!r(a)&&(a=[a]),s[o]=a?a.concat(l):r(l)?l:[l]}return s},fi.props=fi.methods=fi.inject=fi.computed=function(e,t,n,i){if(!e)return t;var r=Object.create(null);return O(r,e),t&&O(r,t),r},fi.provide=function(e,t){return e?function(){var n=Object.create(null);return mi(n,u(e)?e.call(this):e),t&&mi(n,u(t)?t.call(this):t,!1),n}:t};var bi=function(e,t){return void 0===t?e:t};function Ai(e,t){var n=e.props;if(n){var i,s,o,a={};if(r(n)){i=n.length;while(i--)s=n[i],"string"===typeof s&&(o=M(s),a[o]={type:null})}else if(p(n))for(var l in n)s=n[l],o=M(l),a[o]=p(s)?s:{type:s};else 0;e.props=a}}function wi(e,t){var n=e.inject;if(n){var i=e.inject={};if(r(n))for(var s=0;s<n.length;s++)i[n[s]]={from:n[s]};else if(p(n))for(var o in n){var a=n[o];i[o]=p(a)?O({from:o},a):{from:a}}else 0}}function xi(e){var t=e.directives;if(t)for(var n in t){var i=t[n];u(i)&&(t[n]={bind:i,update:i})}}function Ei(e,t,n){if(u(t)&&(t=t.options),Ai(t,n),wi(t,n),xi(t),!t._base&&(t.extends&&(e=Ei(e,t.extends,n)),t.mixins))for(var i=0,r=t.mixins.length;i<r;i++)e=Ei(e,t.mixins[i],n);var s,o={};for(s in e)a(s);for(s in t)E(e,s)||a(s);function a(i){var r=fi[i]||bi;o[i]=r(e[i],t[i],n,i)}return o}function Ci(e,t,n,i){if("string"===typeof n){var r=e[t];if(E(r,n))return r[n];var s=M(n);if(E(r,s))return r[s];var o=T(s);if(E(r,o))return r[o];var a=r[n]||r[s]||r[o];return a}}function Si(e,t,n,i){var r=t[e],s=!E(n,e),o=n[e],a=Ri(Boolean,r.type);if(a>-1)if(s&&!E(r,"default"))o=!1;else if(""===o||o===P(e)){var l=Ri(String,r.type);(l<0||a<l)&&(o=!0)}if(void 0===o){o=Mi(i,r,e);var c=Be;Oe(!0),Ne(o),Oe(c)}return o}function Mi(e,t,n){if(E(t,"default")){var i=t.default;return e&&e.$options.propsData&&void 0===e.$options.propsData[n]&&void 0!==e._props[n]?e._props[n]:u(i)&&"Function"!==Ii(t.type)?i.call(e):i}}var Ti=/^\s*function (\w+)/;function Ii(e){var t=e&&e.toString().match(Ti);return t?t[1]:""}function Pi(e,t){return Ii(e)===Ii(t)}function Ri(e,t){if(!r(t))return Pi(t,e)?0:-1;for(var n=0,i=t.length;n<i;n++)if(Pi(t[n],e))return n;return-1}var Di={enumerable:!0,configurable:!0,get:U,set:U};function ki(e,t,n){Di.get=function(){return this[t][n]},Di.set=function(e){this[t][n]=e},Object.defineProperty(e,n,Di)}function Bi(e){var t=e.$options;if(t.props&&Oi(e,t.props),Rt(e),t.methods&&Vi(e,t.methods),t.data)Li(e);else{var n=Ne(e._data={});n&&n.vmCount++}t.computed&&Fi(e,t.computed),t.watch&&t.watch!==le&&Hi(e,t.watch)}function Oi(e,t){var n=e.$options.propsData||{},i=e._props=Ve({}),r=e.$options._propKeys=[],s=!e.$parent;s||Oe(!1);var o=function(s){r.push(s);var o=Si(s,t,n,e);Fe(i,s,o,void 0,!0),s in e||ki(e,"_props",s)};for(var a in t)o(a);Oe(!0)}function Li(e){var t=e.$options.data;t=e._data=u(t)?Ui(t,e):t||{},p(t)||(t={});var n=Object.keys(t),i=e.$options.props,r=(e.$options.methods,n.length);while(r--){var s=n[r];0,i&&E(i,s)||Y(s)||ki(e,"_data",s)}var o=Ne(t);o&&o.vmCount++}function Ui(e,t){Me();try{return e.call(t,t)}catch($o){return Kt($o,t,"data()"),{}}finally{Te()}}var Ni={lazy:!0};function Fi(e,t){var n=e._computedWatchers=Object.create(null),i=de();for(var r in t){var s=t[r],o=u(s)?s:s.get;0,i||(n[r]=new yn(e,o||U,U,Ni)),r in e||ji(e,r,s)}}function ji(e,t,n){var i=!de();u(n)?(Di.get=i?zi(t):Gi(n),Di.set=U):(Di.get=n.get?i&&!1!==n.cache?zi(t):Gi(n.get):U,Di.set=n.set||U),Object.defineProperty(e,t,Di)}function zi(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),Ce.target&&t.depend(),t.value}}function Gi(e){return function(){return e.call(this,this)}}function Vi(e,t){e.$options.props;for(var n in t)e[n]="function"!==typeof t[n]?U:k(t[n],e)}function Hi(e,t){for(var n in t){var i=t[n];if(r(i))for(var s=0;s<i.length;s++)Qi(e,n,i[s]);else Qi(e,n,i)}}function Qi(e,t,n,i){return p(n)&&(i=n,n=n.handler),"string"===typeof n&&(n=e[n]),e.$watch(t,n,i)}function Wi(e){var t={get:function(){return this._data}},n={get:function(){return this._props}};Object.defineProperty(e.prototype,"$data",t),Object.defineProperty(e.prototype,"$props",n),e.prototype.$set=je,e.prototype.$delete=ze,e.prototype.$watch=function(e,t,n){var i=this;if(p(t))return Qi(i,e,t,n);n=n||{},n.user=!0;var r=new yn(i,e,t,n);if(n.immediate){var s='callback for immediate watcher "'.concat(r.expression,'"');Me(),Jt(t,i,[r.value],i,s),Te()}return function(){r.teardown()}}}var qi=0;function Xi(e){e.prototype._init=function(e){var t=this;t._uid=qi++,t._isVue=!0,t.__v_skip=!0,t._scope=new Ke(!0),t._scope.parent=void 0,t._scope._vm=!0,e&&e._isComponent?Yi(t,e):t.$options=Ei(Ki(t.constructor),e||{},t),t._renderProxy=t,t._self=t,Tn(t),bn(t),Ut(t),On(t,"beforeCreate",void 0,!1),$n(t),Bi(t),Zn(t),On(t,"created"),t.$options.el&&t.$mount(t.$options.el)}}function Yi(e,t){var n=e.$options=Object.create(e.constructor.options),i=t._parentVnode;n.parent=t.parent,n._parentVnode=i;var r=i.componentOptions;n.propsData=r.propsData,n._parentListeners=r.listeners,n._renderChildren=r.children,n._componentTag=r.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}function Ki(e){var t=e.options;if(e.super){var n=Ki(e.super),i=e.superOptions;if(n!==i){e.superOptions=n;var r=Ji(e);r&&O(e.extendOptions,r),t=e.options=Ei(n,e.extendOptions),t.name&&(t.components[t.name]=e)}}return t}function Ji(e){var t,n=e.options,i=e.sealedOptions;for(var r in n)n[r]!==i[r]&&(t||(t={}),t[r]=n[r]);return t}function Zi(e){this._init(e)}function $i(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var n=B(arguments,1);return n.unshift(this),u(e.install)?e.install.apply(e,n):u(e)&&e.apply(null,n),t.push(e),this}}function er(e){e.mixin=function(e){return this.options=Ei(this.options,e),this}}function tr(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var n=this,i=n.cid,r=e._Ctor||(e._Ctor={});if(r[i])return r[i];var s=si(e)||si(n.options);var o=function(e){this._init(e)};return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.cid=t++,o.options=Ei(n.options,e),o["super"]=n,o.options.props&&nr(o),o.options.computed&&ir(o),o.extend=n.extend,o.mixin=n.mixin,o.use=n.use,Q.forEach((function(e){o[e]=n[e]})),s&&(o.options.components[s]=o),o.superOptions=n.options,o.extendOptions=e,o.sealedOptions=O({},o.options),r[i]=o,o}}function nr(e){var t=e.options.props;for(var n in t)ki(e.prototype,"_props",n)}function ir(e){var t=e.options.computed;for(var n in t)ji(e.prototype,n,t[n])}function rr(e){Q.forEach((function(t){e[t]=function(e,n){return n?("component"===t&&p(n)&&(n.name=n.name||e,n=this.options._base.extend(n)),"directive"===t&&u(n)&&(n={bind:n,update:n}),this.options[t+"s"][e]=n,n):this.options[t+"s"][e]}}))}function sr(e){return e&&(si(e.Ctor.options)||e.tag)}function or(e,t){return r(e)?e.indexOf(t)>-1:"string"===typeof e?e.split(",").indexOf(t)>-1:!!f(e)&&e.test(t)}function ar(e,t){var n=e.cache,i=e.keys,r=e._vnode,s=e.$vnode;for(var o in n){var a=n[o];if(a){var l=a.name;l&&!t(l)&&lr(n,o,i,r)}}s.componentOptions.children=void 0}function lr(e,t,n,i){var r=e[t];!r||i&&r.tag===i.tag||r.componentInstance.$destroy(),e[t]=null,w(n,t)}Xi(Zi),Wi(Zi),Cn(Zi),In(Zi),Ft(Zi);var cr=[String,RegExp,Array],ur={name:"keep-alive",abstract:!0,props:{include:cr,exclude:cr,max:[String,Number]},methods:{cacheVNode:function(){var e=this,t=e.cache,n=e.keys,i=e.vnodeToCache,r=e.keyToCache;if(i){var s=i.tag,o=i.componentInstance,a=i.componentOptions;t[r]={name:sr(a),tag:s,componentInstance:o},n.push(r),this.max&&n.length>parseInt(this.max)&&lr(t,n[0],n,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var e in this.cache)lr(this.cache,e,this.keys)},mounted:function(){var e=this;this.cacheVNode(),this.$watch("include",(function(t){ar(e,(function(e){return or(t,e)}))})),this.$watch("exclude",(function(t){ar(e,(function(e){return!or(t,e)}))}))},updated:function(){this.cacheVNode()},render:function(){var e=this.$slots.default,t=Vt(e),n=t&&t.componentOptions;if(n){var i=sr(n),r=this,s=r.include,o=r.exclude;if(s&&(!i||!or(s,i))||o&&i&&or(o,i))return t;var a=this,l=a.cache,c=a.keys,u=null==t.key?n.Ctor.cid+(n.tag?"::".concat(n.tag):""):t.key;l[u]?(t.componentInstance=l[u].componentInstance,w(c,u),c.push(u)):(this.vnodeToCache=t,this.keyToCache=u),t.data.keepAlive=!0}return t||e&&e[0]}},dr={KeepAlive:ur};function hr(e){var t={get:function(){return q}};Object.defineProperty(e,"config",t),e.util={warn:pi,extend:O,mergeOptions:Ei,defineReactive:Fe},e.set=je,e.delete=ze,e.nextTick=un,e.observable=function(e){return Ne(e),e},e.options=Object.create(null),Q.forEach((function(t){e.options[t+"s"]=Object.create(null)})),e.options._base=e,O(e.options.components,dr),$i(e),er(e),tr(e),rr(e)}hr(Zi),Object.defineProperty(Zi.prototype,"$isServer",{get:de}),Object.defineProperty(Zi.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Zi,"FunctionalRenderContext",{value:ti}),Zi.version=pn;var pr=b("style,class"),fr=b("input,textarea,option,select,progress"),mr=function(e,t,n){return"value"===n&&fr(e)&&"button"!==t||"selected"===n&&"option"===e||"checked"===n&&"input"===e||"muted"===n&&"video"===e},gr=b("contenteditable,draggable,spellcheck"),_r=b("events,caret,typing,plaintext-only"),vr=function(e,t){return xr(t)||"false"===t?"false":"contenteditable"===e&&_r(t)?t:"true"},yr=b("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),br="http://www.w3.org/1999/xlink",Ar=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},wr=function(e){return Ar(e)?e.slice(6,e.length):""},xr=function(e){return null==e||!1===e};function Er(e){var t=e.data,n=e,i=e;while(o(i.componentInstance))i=i.componentInstance._vnode,i&&i.data&&(t=Cr(i.data,t));while(o(n=n.parent))n&&n.data&&(t=Cr(t,n.data));return Sr(t.staticClass,t.class)}function Cr(e,t){return{staticClass:Mr(e.staticClass,t.staticClass),class:o(e.class)?[e.class,t.class]:t.class}}function Sr(e,t){return o(e)||o(t)?Mr(e,Tr(t)):""}function Mr(e,t){return e?t?e+" "+t:e:t||""}function Tr(e){return Array.isArray(e)?Ir(e):d(e)?Pr(e):"string"===typeof e?e:""}function Ir(e){for(var t,n="",i=0,r=e.length;i<r;i++)o(t=Tr(e[i]))&&""!==t&&(n&&(n+=" "),n+=t);return n}function Pr(e){var t="";for(var n in e)e[n]&&(t&&(t+=" "),t+=n);return t}var Rr={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Dr=b("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),kr=b("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Br=function(e){return Dr(e)||kr(e)};function Or(e){return kr(e)?"svg":"math"===e?"math":void 0}var Lr=Object.create(null);function Ur(e){if(!ee)return!0;if(Br(e))return!1;if(e=e.toLowerCase(),null!=Lr[e])return Lr[e];var t=document.createElement(e);return e.indexOf("-")>-1?Lr[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:Lr[e]=/HTMLUnknownElement/.test(t.toString())}var Nr=b("text,number,password,search,email,tel,url");function Fr(e){if("string"===typeof e){var t=document.querySelector(e);return t||document.createElement("div")}return e}function jr(e,t){var n=document.createElement(e);return"select"!==e||t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n}function zr(e,t){return document.createElementNS(Rr[e],t)}function Gr(e){return document.createTextNode(e)}function Vr(e){return document.createComment(e)}function Hr(e,t,n){e.insertBefore(t,n)}function Qr(e,t){e.removeChild(t)}function Wr(e,t){e.appendChild(t)}function qr(e){return e.parentNode}function Xr(e){return e.nextSibling}function Yr(e){return e.tagName}function Kr(e,t){e.textContent=t}function Jr(e,t){e.setAttribute(t,"")}var Zr=Object.freeze({__proto__:null,createElement:jr,createElementNS:zr,createTextNode:Gr,createComment:Vr,insertBefore:Hr,removeChild:Qr,appendChild:Wr,parentNode:qr,nextSibling:Xr,tagName:Yr,setTextContent:Kr,setStyleScope:Jr}),$r={create:function(e,t){es(t)},update:function(e,t){e.data.ref!==t.data.ref&&(es(e,!0),es(t))},destroy:function(e){es(e,!0)}};function es(e,t){var n=e.data.ref;if(o(n)){var i=e.context,s=e.componentInstance||e.elm,a=t?null:s,l=t?void 0:s;if(u(n))Jt(n,i,[a],i,"template ref function");else{var c=e.data.refInFor,d="string"===typeof n||"number"===typeof n,h=We(n),p=i.$refs;if(d||h)if(c){var f=d?p[n]:n.value;t?r(f)&&w(f,s):r(f)?f.includes(s)||f.push(s):d?(p[n]=[s],ts(i,n,p[n])):n.value=[s]}else if(d){if(t&&p[n]!==s)return;p[n]=l,ts(i,n,a)}else if(h){if(t&&n.value!==s)return;n.value=a}else 0}}}function ts(e,t,n){var i=e._setupState;i&&E(i,t)&&(We(i[t])?i[t].value=n:i[t]=n)}var ns=new ve("",{},[]),is=["create","activate","update","remove","destroy"];function rs(e,t){return e.key===t.key&&e.asyncFactory===t.asyncFactory&&(e.tag===t.tag&&e.isComment===t.isComment&&o(e.data)===o(t.data)&&ss(e,t)||a(e.isAsyncPlaceholder)&&s(t.asyncFactory.error))}function ss(e,t){if("input"!==e.tag)return!0;var n,i=o(n=e.data)&&o(n=n.attrs)&&n.type,r=o(n=t.data)&&o(n=n.attrs)&&n.type;return i===r||Nr(i)&&Nr(r)}function os(e,t,n){var i,r,s={};for(i=t;i<=n;++i)r=e[i].key,o(r)&&(s[r]=i);return s}function as(e){var t,n,i={},l=e.modules,u=e.nodeOps;for(t=0;t<is.length;++t)for(i[is[t]]=[],n=0;n<l.length;++n)o(l[n][is[t]])&&i[is[t]].push(l[n][is[t]]);function d(e){return new ve(u.tagName(e).toLowerCase(),{},[],void 0,e)}function h(e,t){function n(){0===--n.listeners&&p(e)}return n.listeners=t,n}function p(e){var t=u.parentNode(e);o(t)&&u.removeChild(t,e)}function f(e,t,n,i,r,s,l){if(o(e.elm)&&o(s)&&(e=s[l]=Ae(e)),e.isRootInsert=!r,!m(e,t,n,i)){var c=e.data,d=e.children,h=e.tag;o(h)?(e.elm=e.ns?u.createElementNS(e.ns,h):u.createElement(h,e),x(e),y(e,d,t),o(c)&&w(e,t),v(n,e.elm,i)):a(e.isComment)?(e.elm=u.createComment(e.text),v(n,e.elm,i)):(e.elm=u.createTextNode(e.text),v(n,e.elm,i))}}function m(e,t,n,i){var r=e.data;if(o(r)){var s=o(e.componentInstance)&&r.keepAlive;if(o(r=r.hook)&&o(r=r.init)&&r(e,!1),o(e.componentInstance))return g(e,t),v(n,e.elm,i),a(s)&&_(e,t,n,i),!0}}function g(e,t){o(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,A(e)?(w(e,t),x(e)):(es(e),t.push(e))}function _(e,t,n,r){var s,a=e;while(a.componentInstance)if(a=a.componentInstance._vnode,o(s=a.data)&&o(s=s.transition)){for(s=0;s<i.activate.length;++s)i.activate[s](ns,a);t.push(a);break}v(n,e.elm,r)}function v(e,t,n){o(e)&&(o(n)?u.parentNode(n)===e&&u.insertBefore(e,t,n):u.appendChild(e,t))}function y(e,t,n){if(r(t)){0;for(var i=0;i<t.length;++i)f(t[i],n,e.elm,null,!0,t,i)}else c(e.text)&&u.appendChild(e.elm,u.createTextNode(String(e.text)))}function A(e){while(e.componentInstance)e=e.componentInstance._vnode;return o(e.tag)}function w(e,n){for(var r=0;r<i.create.length;++r)i.create[r](ns,e);t=e.data.hook,o(t)&&(o(t.create)&&t.create(ns,e),o(t.insert)&&n.push(e))}function x(e){var t;if(o(t=e.fnScopeId))u.setStyleScope(e.elm,t);else{var n=e;while(n)o(t=n.context)&&o(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t),n=n.parent}o(t=Sn)&&t!==e.context&&t!==e.fnContext&&o(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t)}function E(e,t,n,i,r,s){for(;i<=r;++i)f(n[i],s,e,t,!1,n,i)}function C(e){var t,n,r=e.data;if(o(r))for(o(t=r.hook)&&o(t=t.destroy)&&t(e),t=0;t<i.destroy.length;++t)i.destroy[t](e);if(o(t=e.children))for(n=0;n<e.children.length;++n)C(e.children[n])}function S(e,t,n){for(;t<=n;++t){var i=e[t];o(i)&&(o(i.tag)?(M(i),C(i)):p(i.elm))}}function M(e,t){if(o(t)||o(e.data)){var n,r=i.remove.length+1;for(o(t)?t.listeners+=r:t=h(e.elm,r),o(n=e.componentInstance)&&o(n=n._vnode)&&o(n.data)&&M(n,t),n=0;n<i.remove.length;++n)i.remove[n](e,t);o(n=e.data.hook)&&o(n=n.remove)?n(e,t):t()}else p(e.elm)}function T(e,t,n,i,r){var a,l,c,d,h=0,p=0,m=t.length-1,g=t[0],_=t[m],v=n.length-1,y=n[0],b=n[v],A=!r;while(h<=m&&p<=v)s(g)?g=t[++h]:s(_)?_=t[--m]:rs(g,y)?(P(g,y,i,n,p),g=t[++h],y=n[++p]):rs(_,b)?(P(_,b,i,n,v),_=t[--m],b=n[--v]):rs(g,b)?(P(g,b,i,n,v),A&&u.insertBefore(e,g.elm,u.nextSibling(_.elm)),g=t[++h],b=n[--v]):rs(_,y)?(P(_,y,i,n,p),A&&u.insertBefore(e,_.elm,g.elm),_=t[--m],y=n[++p]):(s(a)&&(a=os(t,h,m)),l=o(y.key)?a[y.key]:I(y,t,h,m),s(l)?f(y,i,e,g.elm,!1,n,p):(c=t[l],rs(c,y)?(P(c,y,i,n,p),t[l]=void 0,A&&u.insertBefore(e,c.elm,g.elm)):f(y,i,e,g.elm,!1,n,p)),y=n[++p]);h>m?(d=s(n[v+1])?null:n[v+1].elm,E(e,d,n,p,v,i)):p>v&&S(t,h,m)}function I(e,t,n,i){for(var r=n;r<i;r++){var s=t[r];if(o(s)&&rs(e,s))return r}}function P(e,t,n,r,l,c){if(e!==t){o(t.elm)&&o(r)&&(t=r[l]=Ae(t));var d=t.elm=e.elm;if(a(e.isAsyncPlaceholder))o(t.asyncFactory.resolved)?k(e.elm,t,n):t.isAsyncPlaceholder=!0;else if(a(t.isStatic)&&a(e.isStatic)&&t.key===e.key&&(a(t.isCloned)||a(t.isOnce)))t.componentInstance=e.componentInstance;else{var h,p=t.data;o(p)&&o(h=p.hook)&&o(h=h.prepatch)&&h(e,t);var f=e.children,m=t.children;if(o(p)&&A(t)){for(h=0;h<i.update.length;++h)i.update[h](e,t);o(h=p.hook)&&o(h=h.update)&&h(e,t)}s(t.text)?o(f)&&o(m)?f!==m&&T(d,f,m,n,c):o(m)?(o(e.text)&&u.setTextContent(d,""),E(d,null,m,0,m.length-1,n)):o(f)?S(f,0,f.length-1):o(e.text)&&u.setTextContent(d,""):e.text!==t.text&&u.setTextContent(d,t.text),o(p)&&o(h=p.hook)&&o(h=h.postpatch)&&h(e,t)}}}function R(e,t,n){if(a(n)&&o(e.parent))e.parent.data.pendingInsert=t;else for(var i=0;i<t.length;++i)t[i].data.hook.insert(t[i])}var D=b("attrs,class,staticClass,staticStyle,key");function k(e,t,n,i){var r,s=t.tag,l=t.data,c=t.children;if(i=i||l&&l.pre,t.elm=e,a(t.isComment)&&o(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(o(l)&&(o(r=l.hook)&&o(r=r.init)&&r(t,!0),o(r=t.componentInstance)))return g(t,n),!0;if(o(s)){if(o(c))if(e.hasChildNodes())if(o(r=l)&&o(r=r.domProps)&&o(r=r.innerHTML)){if(r!==e.innerHTML)return!1}else{for(var u=!0,d=e.firstChild,h=0;h<c.length;h++){if(!d||!k(d,c[h],n,i)){u=!1;break}d=d.nextSibling}if(!u||d)return!1}else y(t,c,n);if(o(l)){var p=!1;for(var f in l)if(!D(f)){p=!0,w(t,n);break}!p&&l["class"]&&mn(l["class"])}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,t,n,r){if(!s(t)){var l=!1,c=[];if(s(e))l=!0,f(t,c);else{var h=o(e.nodeType);if(!h&&rs(e,t))P(e,t,c,null,null,r);else{if(h){if(1===e.nodeType&&e.hasAttribute(H)&&(e.removeAttribute(H),n=!0),a(n)&&k(e,t,c))return R(t,c,!0),e;e=d(e)}var p=e.elm,m=u.parentNode(p);if(f(t,c,p._leaveCb?null:m,u.nextSibling(p)),o(t.parent)){var g=t.parent,_=A(t);while(g){for(var v=0;v<i.destroy.length;++v)i.destroy[v](g);if(g.elm=t.elm,_){for(var y=0;y<i.create.length;++y)i.create[y](ns,g);var b=g.data.hook.insert;if(b.merged)for(var w=b.fns.slice(1),x=0;x<w.length;x++)w[x]()}else es(g);g=g.parent}}o(m)?S([e],0,0):o(e.tag)&&C(e)}}return R(t,c,l),t.elm}o(e)&&C(e)}}var ls={create:cs,update:cs,destroy:function(e){cs(e,ns)}};function cs(e,t){(e.data.directives||t.data.directives)&&us(e,t)}function us(e,t){var n,i,r,s=e===ns,o=t===ns,a=hs(e.data.directives,e.context),l=hs(t.data.directives,t.context),c=[],u=[];for(n in l)i=a[n],r=l[n],i?(r.oldValue=i.value,r.oldArg=i.arg,fs(r,"update",t,e),r.def&&r.def.componentUpdated&&u.push(r)):(fs(r,"bind",t,e),r.def&&r.def.inserted&&c.push(r));if(c.length){var d=function(){for(var n=0;n<c.length;n++)fs(c[n],"inserted",t,e)};s?it(t,"insert",d):d()}if(u.length&&it(t,"postpatch",(function(){for(var n=0;n<u.length;n++)fs(u[n],"componentUpdated",t,e)})),!s)for(n in a)l[n]||fs(a[n],"unbind",e,e,o)}var ds=Object.create(null);function hs(e,t){var n,i,r=Object.create(null);if(!e)return r;for(n=0;n<e.length;n++){if(i=e[n],i.modifiers||(i.modifiers=ds),r[ps(i)]=i,t._setupState&&t._setupState.__sfc){var s=i.def||Ci(t,"_setupState","v-"+i.name);i.def="function"===typeof s?{bind:s,update:s}:s}i.def=i.def||Ci(t.$options,"directives",i.name,!0)}return r}function ps(e){return e.rawName||"".concat(e.name,".").concat(Object.keys(e.modifiers||{}).join("."))}function fs(e,t,n,i,r){var s=e.def&&e.def[t];if(s)try{s(n.elm,e,n,i,r)}catch($o){Kt($o,n.context,"directive ".concat(e.name," ").concat(t," hook"))}}var ms=[$r,ls];function gs(e,t){var n=t.componentOptions;if((!o(n)||!1!==n.Ctor.options.inheritAttrs)&&(!s(e.data.attrs)||!s(t.data.attrs))){var i,r,l,c=t.elm,u=e.data.attrs||{},d=t.data.attrs||{};for(i in(o(d.__ob__)||a(d._v_attr_proxy))&&(d=t.data.attrs=O({},d)),d)r=d[i],l=u[i],l!==r&&_s(c,i,r,t.data.pre);for(i in(ne||re)&&d.value!==u.value&&_s(c,"value",d.value),u)s(d[i])&&(Ar(i)?c.removeAttributeNS(br,wr(i)):gr(i)||c.removeAttribute(i))}}function _s(e,t,n,i){i||e.tagName.indexOf("-")>-1?vs(e,t,n):yr(t)?xr(n)?e.removeAttribute(t):(n="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,n)):gr(t)?e.setAttribute(t,vr(t,n)):Ar(t)?xr(n)?e.removeAttributeNS(br,wr(t)):e.setAttributeNS(br,t,n):vs(e,t,n)}function vs(e,t,n){if(xr(n))e.removeAttribute(t);else{if(ne&&!ie&&"TEXTAREA"===e.tagName&&"placeholder"===t&&""!==n&&!e.__ieph){var i=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",i)};e.addEventListener("input",i),e.__ieph=!0}e.setAttribute(t,n)}}var ys={create:gs,update:gs};function bs(e,t){var n=t.elm,i=t.data,r=e.data;if(!(s(i.staticClass)&&s(i.class)&&(s(r)||s(r.staticClass)&&s(r.class)))){var a=Er(t),l=n._transitionClasses;o(l)&&(a=Mr(a,Tr(l))),a!==n._prevClass&&(n.setAttribute("class",a),n._prevClass=a)}}var As,ws={create:bs,update:bs},xs="__r",Es="__c";function Cs(e){if(o(e[xs])){var t=ne?"change":"input";e[t]=[].concat(e[xs],e[t]||[]),delete e[xs]}o(e[Es])&&(e.change=[].concat(e[Es],e.change||[]),delete e[Es])}function Ss(e,t,n){var i=As;return function r(){var s=t.apply(null,arguments);null!==s&&Is(e,r,n,i)}}var Ms=tn&&!(ae&&Number(ae[1])<=53);function Ts(e,t,n,i){if(Ms){var r=Vn,s=t;t=s._wrapper=function(e){if(e.target===e.currentTarget||e.timeStamp>=r||e.timeStamp<=0||e.target.ownerDocument!==document)return s.apply(this,arguments)}}As.addEventListener(e,t,ce?{capture:n,passive:i}:n)}function Is(e,t,n,i){(i||As).removeEventListener(e,t._wrapper||t,n)}function Ps(e,t){if(!s(e.data.on)||!s(t.data.on)){var n=t.data.on||{},i=e.data.on||{};As=t.elm||e.elm,Cs(n),nt(n,i,Ts,Is,Ss,t.context),As=void 0}}var Rs,Ds={create:Ps,update:Ps,destroy:function(e){return Ps(e,ns)}};function ks(e,t){if(!s(e.data.domProps)||!s(t.data.domProps)){var n,i,r=t.elm,l=e.data.domProps||{},c=t.data.domProps||{};for(n in(o(c.__ob__)||a(c._v_attr_proxy))&&(c=t.data.domProps=O({},c)),l)n in c||(r[n]="");for(n in c){if(i=c[n],"textContent"===n||"innerHTML"===n){if(t.children&&(t.children.length=0),i===l[n])continue;1===r.childNodes.length&&r.removeChild(r.childNodes[0])}if("value"===n&&"PROGRESS"!==r.tagName){r._value=i;var u=s(i)?"":String(i);Bs(r,u)&&(r.value=u)}else if("innerHTML"===n&&kr(r.tagName)&&s(r.innerHTML)){Rs=Rs||document.createElement("div"),Rs.innerHTML="<svg>".concat(i,"</svg>");var d=Rs.firstChild;while(r.firstChild)r.removeChild(r.firstChild);while(d.firstChild)r.appendChild(d.firstChild)}else if(i!==l[n])try{r[n]=i}catch($o){}}}}function Bs(e,t){return!e.composing&&("OPTION"===e.tagName||Os(e,t)||Ls(e,t))}function Os(e,t){var n=!0;try{n=document.activeElement!==e}catch($o){}return n&&e.value!==t}function Ls(e,t){var n=e.value,i=e._vModifiers;if(o(i)){if(i.number)return y(n)!==y(t);if(i.trim)return n.trim()!==t.trim()}return n!==t}var Us={create:ks,update:ks},Ns=C((function(e){var t={},n=/;(?![^(]*\))/g,i=/:(.+)/;return e.split(n).forEach((function(e){if(e){var n=e.split(i);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}));function Fs(e){var t=js(e.style);return e.staticStyle?O(e.staticStyle,t):t}function js(e){return Array.isArray(e)?L(e):"string"===typeof e?Ns(e):e}function zs(e,t){var n,i={};if(t){var r=e;while(r.componentInstance)r=r.componentInstance._vnode,r&&r.data&&(n=Fs(r.data))&&O(i,n)}(n=Fs(e.data))&&O(i,n);var s=e;while(s=s.parent)s.data&&(n=Fs(s.data))&&O(i,n);return i}var Gs,Vs=/^--/,Hs=/\s*!important$/,Qs=function(e,t,n){if(Vs.test(t))e.style.setProperty(t,n);else if(Hs.test(n))e.style.setProperty(P(t),n.replace(Hs,""),"important");else{var i=qs(t);if(Array.isArray(n))for(var r=0,s=n.length;r<s;r++)e.style[i]=n[r];else e.style[i]=n}},Ws=["Webkit","Moz","ms"],qs=C((function(e){if(Gs=Gs||document.createElement("div").style,e=M(e),"filter"!==e&&e in Gs)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<Ws.length;n++){var i=Ws[n]+t;if(i in Gs)return i}}));function Xs(e,t){var n=t.data,i=e.data;if(!(s(n.staticStyle)&&s(n.style)&&s(i.staticStyle)&&s(i.style))){var r,a,l=t.elm,c=i.staticStyle,u=i.normalizedStyle||i.style||{},d=c||u,h=js(t.data.style)||{};t.data.normalizedStyle=o(h.__ob__)?O({},h):h;var p=zs(t,!0);for(a in d)s(p[a])&&Qs(l,a,"");for(a in p)r=p[a],Qs(l,a,null==r?"":r)}}var Ys={create:Xs,update:Xs},Ks=/\s+/;function Js(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(Ks).forEach((function(t){return e.classList.add(t)})):e.classList.add(t);else{var n=" ".concat(e.getAttribute("class")||""," ");n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function Zs(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(Ks).forEach((function(t){return e.classList.remove(t)})):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{var n=" ".concat(e.getAttribute("class")||""," "),i=" "+t+" ";while(n.indexOf(i)>=0)n=n.replace(i," ");n=n.trim(),n?e.setAttribute("class",n):e.removeAttribute("class")}}function $s(e){if(e){if("object"===typeof e){var t={};return!1!==e.css&&O(t,eo(e.name||"v")),O(t,e),t}return"string"===typeof e?eo(e):void 0}}var eo=C((function(e){return{enterClass:"".concat(e,"-enter"),enterToClass:"".concat(e,"-enter-to"),enterActiveClass:"".concat(e,"-enter-active"),leaveClass:"".concat(e,"-leave"),leaveToClass:"".concat(e,"-leave-to"),leaveActiveClass:"".concat(e,"-leave-active")}})),to=ee&&!ie,no="transition",io="animation",ro="transition",so="transitionend",oo="animation",ao="animationend";to&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(ro="WebkitTransition",so="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(oo="WebkitAnimation",ao="webkitAnimationEnd"));var lo=ee?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function co(e){lo((function(){lo(e)}))}function uo(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),Js(e,t))}function ho(e,t){e._transitionClasses&&w(e._transitionClasses,t),Zs(e,t)}function po(e,t,n){var i=mo(e,t),r=i.type,s=i.timeout,o=i.propCount;if(!r)return n();var a=r===no?so:ao,l=0,c=function(){e.removeEventListener(a,u),n()},u=function(t){t.target===e&&++l>=o&&c()};setTimeout((function(){l<o&&c()}),s+1),e.addEventListener(a,u)}var fo=/\b(transform|all)(,|$)/;function mo(e,t){var n,i=window.getComputedStyle(e),r=(i[ro+"Delay"]||"").split(", "),s=(i[ro+"Duration"]||"").split(", "),o=go(r,s),a=(i[oo+"Delay"]||"").split(", "),l=(i[oo+"Duration"]||"").split(", "),c=go(a,l),u=0,d=0;t===no?o>0&&(n=no,u=o,d=s.length):t===io?c>0&&(n=io,u=c,d=l.length):(u=Math.max(o,c),n=u>0?o>c?no:io:null,d=n?n===no?s.length:l.length:0);var h=n===no&&fo.test(i[ro+"Property"]);return{type:n,timeout:u,propCount:d,hasTransform:h}}function go(e,t){while(e.length<t.length)e=e.concat(e);return Math.max.apply(null,t.map((function(t,n){return _o(t)+_o(e[n])})))}function _o(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function vo(e,t){var n=e.elm;o(n._leaveCb)&&(n._leaveCb.cancelled=!0,n._leaveCb());var i=$s(e.data.transition);if(!s(i)&&!o(n._enterCb)&&1===n.nodeType){var r=i.css,a=i.type,l=i.enterClass,c=i.enterToClass,h=i.enterActiveClass,p=i.appearClass,f=i.appearToClass,m=i.appearActiveClass,g=i.beforeEnter,_=i.enter,v=i.afterEnter,b=i.enterCancelled,A=i.beforeAppear,w=i.appear,x=i.afterAppear,E=i.appearCancelled,C=i.duration,S=Sn,M=Sn.$vnode;while(M&&M.parent)S=M.context,M=M.parent;var T=!S._isMounted||!e.isRootInsert;if(!T||w||""===w){var I=T&&p?p:l,P=T&&m?m:h,R=T&&f?f:c,D=T&&A||g,k=T&&u(w)?w:_,B=T&&x||v,O=T&&E||b,L=y(d(C)?C.enter:C);0;var U=!1!==r&&!ie,N=Ao(k),F=n._enterCb=G((function(){U&&(ho(n,R),ho(n,P)),F.cancelled?(U&&ho(n,I),O&&O(n)):B&&B(n),n._enterCb=null}));e.data.show||it(e,"insert",(function(){var t=n.parentNode,i=t&&t._pending&&t._pending[e.key];i&&i.tag===e.tag&&i.elm._leaveCb&&i.elm._leaveCb(),k&&k(n,F)})),D&&D(n),U&&(uo(n,I),uo(n,P),co((function(){ho(n,I),F.cancelled||(uo(n,R),N||(bo(L)?setTimeout(F,L):po(n,a,F)))}))),e.data.show&&(t&&t(),k&&k(n,F)),U||N||F()}}}function yo(e,t){var n=e.elm;o(n._enterCb)&&(n._enterCb.cancelled=!0,n._enterCb());var i=$s(e.data.transition);if(s(i)||1!==n.nodeType)return t();if(!o(n._leaveCb)){var r=i.css,a=i.type,l=i.leaveClass,c=i.leaveToClass,u=i.leaveActiveClass,h=i.beforeLeave,p=i.leave,f=i.afterLeave,m=i.leaveCancelled,g=i.delayLeave,_=i.duration,v=!1!==r&&!ie,b=Ao(p),A=y(d(_)?_.leave:_);0;var w=n._leaveCb=G((function(){n.parentNode&&n.parentNode._pending&&(n.parentNode._pending[e.key]=null),v&&(ho(n,c),ho(n,u)),w.cancelled?(v&&ho(n,l),m&&m(n)):(t(),f&&f(n)),n._leaveCb=null}));g?g(x):x()}function x(){w.cancelled||(!e.data.show&&n.parentNode&&((n.parentNode._pending||(n.parentNode._pending={}))[e.key]=e),h&&h(n),v&&(uo(n,l),uo(n,u),co((function(){ho(n,l),w.cancelled||(uo(n,c),b||(bo(A)?setTimeout(w,A):po(n,a,w)))}))),p&&p(n,w),v||b||w())}}function bo(e){return"number"===typeof e&&!isNaN(e)}function Ao(e){if(s(e))return!1;var t=e.fns;return o(t)?Ao(Array.isArray(t)?t[0]:t):(e._length||e.length)>1}function wo(e,t){!0!==t.data.show&&vo(t)}var xo=ee?{create:wo,activate:wo,remove:function(e,t){!0!==e.data.show?yo(e,t):t()}}:{},Eo=[ys,ws,Ds,Us,Ys,xo],Co=Eo.concat(ms),So=as({nodeOps:Zr,modules:Co});ie&&document.addEventListener("selectionchange",(function(){var e=document.activeElement;e&&e.vmodel&&Bo(e,"input")}));var Mo={inserted:function(e,t,n,i){"select"===n.tag?(i.elm&&!i.elm._vOptions?it(n,"postpatch",(function(){Mo.componentUpdated(e,t,n)})):To(e,t,n.context),e._vOptions=[].map.call(e.options,Ro)):("textarea"===n.tag||Nr(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",Do),e.addEventListener("compositionend",ko),e.addEventListener("change",ko),ie&&(e.vmodel=!0)))},componentUpdated:function(e,t,n){if("select"===n.tag){To(e,t,n.context);var i=e._vOptions,r=e._vOptions=[].map.call(e.options,Ro);if(r.some((function(e,t){return!j(e,i[t])}))){var s=e.multiple?t.value.some((function(e){return Po(e,r)})):t.value!==t.oldValue&&Po(t.value,r);s&&Bo(e,"change")}}}};function To(e,t,n){Io(e,t,n),(ne||re)&&setTimeout((function(){Io(e,t,n)}),0)}function Io(e,t,n){var i=t.value,r=e.multiple;if(!r||Array.isArray(i)){for(var s,o,a=0,l=e.options.length;a<l;a++)if(o=e.options[a],r)s=z(i,Ro(o))>-1,o.selected!==s&&(o.selected=s);else if(j(Ro(o),i))return void(e.selectedIndex!==a&&(e.selectedIndex=a));r||(e.selectedIndex=-1)}}function Po(e,t){return t.every((function(t){return!j(t,e)}))}function Ro(e){return"_value"in e?e._value:e.value}function Do(e){e.target.composing=!0}function ko(e){e.target.composing&&(e.target.composing=!1,Bo(e.target,"input"))}function Bo(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}function Oo(e){return!e.componentInstance||e.data&&e.data.transition?e:Oo(e.componentInstance._vnode)}var Lo={bind:function(e,t,n){var i=t.value;n=Oo(n);var r=n.data&&n.data.transition,s=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;i&&r?(n.data.show=!0,vo(n,(function(){e.style.display=s}))):e.style.display=i?s:"none"},update:function(e,t,n){var i=t.value,r=t.oldValue;if(!i!==!r){n=Oo(n);var s=n.data&&n.data.transition;s?(n.data.show=!0,i?vo(n,(function(){e.style.display=e.__vOriginalDisplay})):yo(n,(function(){e.style.display="none"}))):e.style.display=i?e.__vOriginalDisplay:"none"}},unbind:function(e,t,n,i,r){r||(e.style.display=e.__vOriginalDisplay)}},Uo={model:Mo,show:Lo},No={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Fo(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?Fo(Vt(t.children)):e}function jo(e){var t={},n=e.$options;for(var i in n.propsData)t[i]=e[i];var r=n._parentListeners;for(var i in r)t[M(i)]=r[i];return t}function zo(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}function Go(e){while(e=e.parent)if(e.data.transition)return!0}function Vo(e,t){return t.key===e.key&&t.tag===e.tag}var Ho=function(e){return e.tag||Mt(e)},Qo=function(e){return"show"===e.name},Wo={name:"transition",props:No,abstract:!0,render:function(e){var t=this,n=this.$slots.default;if(n&&(n=n.filter(Ho),n.length)){0;var i=this.mode;0;var r=n[0];if(Go(this.$vnode))return r;var s=Fo(r);if(!s)return r;if(this._leaving)return zo(e,r);var o="__transition-".concat(this._uid,"-");s.key=null==s.key?s.isComment?o+"comment":o+s.tag:c(s.key)?0===String(s.key).indexOf(o)?s.key:o+s.key:s.key;var a=(s.data||(s.data={})).transition=jo(this),l=this._vnode,u=Fo(l);if(s.data.directives&&s.data.directives.some(Qo)&&(s.data.show=!0),u&&u.data&&!Vo(s,u)&&!Mt(u)&&(!u.componentInstance||!u.componentInstance._vnode.isComment)){var d=u.data.transition=O({},a);if("out-in"===i)return this._leaving=!0,it(d,"afterLeave",(function(){t._leaving=!1,t.$forceUpdate()})),zo(e,r);if("in-out"===i){if(Mt(s))return l;var h,p=function(){h()};it(a,"afterEnter",p),it(a,"enterCancelled",p),it(d,"delayLeave",(function(e){h=e}))}}return r}}},qo=O({tag:String,moveClass:String},No);delete qo.mode;var Xo={props:qo,beforeMount:function(){var e=this,t=this._update;this._update=function(n,i){var r=Mn(e);e.__patch__(e._vnode,e.kept,!1,!0),e._vnode=e.kept,r(),t.call(e,n,i)}},render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),i=this.prevChildren=this.children,r=this.$slots.default||[],s=this.children=[],o=jo(this),a=0;a<r.length;a++){var l=r[a];if(l.tag)if(null!=l.key&&0!==String(l.key).indexOf("__vlist"))s.push(l),n[l.key]=l,(l.data||(l.data={})).transition=o;else;}if(i){var c=[],u=[];for(a=0;a<i.length;a++){l=i[a];l.data.transition=o,l.data.pos=l.elm.getBoundingClientRect(),n[l.key]?c.push(l):u.push(l)}this.kept=e(t,null,c),this.removed=u}return e(t,null,s)},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(Yo),e.forEach(Ko),e.forEach(Jo),this._reflow=document.body.offsetHeight,e.forEach((function(e){if(e.data.moved){var n=e.elm,i=n.style;uo(n,t),i.transform=i.WebkitTransform=i.transitionDuration="",n.addEventListener(so,n._moveCb=function e(i){i&&i.target!==n||i&&!/transform$/.test(i.propertyName)||(n.removeEventListener(so,e),n._moveCb=null,ho(n,t))})}})))},methods:{hasMove:function(e,t){if(!to)return!1;if(this._hasMove)return this._hasMove;var n=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach((function(e){Zs(n,e)})),Js(n,t),n.style.display="none",this.$el.appendChild(n);var i=mo(n);return this.$el.removeChild(n),this._hasMove=i.hasTransform}}};function Yo(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function Ko(e){e.data.newPos=e.elm.getBoundingClientRect()}function Jo(e){var t=e.data.pos,n=e.data.newPos,i=t.left-n.left,r=t.top-n.top;if(i||r){e.data.moved=!0;var s=e.elm.style;s.transform=s.WebkitTransform="translate(".concat(i,"px,").concat(r,"px)"),s.transitionDuration="0s"}}var Zo={Transition:Wo,TransitionGroup:Xo};Zi.config.mustUseProp=mr,Zi.config.isReservedTag=Br,Zi.config.isReservedAttr=pr,Zi.config.getTagNamespace=Or,Zi.config.isUnknownElement=Ur,O(Zi.options.directives,Uo),O(Zi.options.components,Zo),Zi.prototype.__patch__=ee?So:U,Zi.prototype.$mount=function(e,t){return e=e&&ee?Fr(e):void 0,Pn(this,e,t)},ee&&setTimeout((function(){q.devtools&&he&&he.emit("init",Zi)}),0)},2661:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{EW5:function(){return __webpackgi_exports__ViewerApp},GMU:function(){return __webpackgi_exports__DiamondPlugin},Pq0:function(){return __webpackgi_exports__Vector3},hzv:function(){return __webpackgi_exports__CameraView},mKI:function(){return __webpackgi_exports__VariationConfiguratorPlugin},rQr:function(){return __webpackgi_exports__addBasePlugins}});var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4114),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_buffer_detached_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6573),core_js_modules_es_array_buffer_detached_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_buffer_detached_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_buffer_transfer_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8100),core_js_modules_es_array_buffer_transfer_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_buffer_transfer_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_buffer_transfer_to_fixed_length_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7936),core_js_modules_es_array_buffer_transfer_to_fixed_length_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_buffer_transfer_to_fixed_length_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_regexp_flags_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9479),core_js_modules_es_regexp_flags_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_regexp_flags_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_set_difference_v2_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7642),core_js_modules_es_set_difference_v2_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_set_difference_v2_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_set_intersection_v2_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8004),core_js_modules_es_set_intersection_v2_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_set_intersection_v2_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_set_is_disjoint_from_v2_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(3853),core_js_modules_es_set_is_disjoint_from_v2_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_set_is_disjoint_from_v2_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_set_is_subset_of_v2_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5876),core_js_modules_es_set_is_subset_of_v2_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_set_is_subset_of_v2_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_set_is_superset_of_v2_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(2475),core_js_modules_es_set_is_superset_of_v2_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_set_is_superset_of_v2_js__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_set_symmetric_difference_v2_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(5024),core_js_modules_es_set_symmetric_difference_v2_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_set_symmetric_difference_v2_js__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_set_union_v2_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(1698),core_js_modules_es_set_union_v2_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_set_union_v2_js__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_typed_array_to_reversed_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(7467),core_js_modules_es_typed_array_to_reversed_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_typed_array_to_reversed_js__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_typed_array_to_sorted_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(4732),core_js_modules_es_typed_array_to_sorted_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_typed_array_to_sorted_js__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es_typed_array_with_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(9577),core_js_modules_es_typed_array_with_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es_typed_array_with_js__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_esnext_iterator_constructor_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(8992),core_js_modules_esnext_iterator_constructor_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_esnext_iterator_constructor_js__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_esnext_iterator_every_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(3215),core_js_modules_esnext_iterator_every_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_esnext_iterator_every_js__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_esnext_iterator_filter_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(4520),core_js_modules_esnext_iterator_filter_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_esnext_iterator_filter_js__WEBPACK_IMPORTED_MODULE_17__),core_js_modules_esnext_iterator_find_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(2577),core_js_modules_esnext_iterator_find_js__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(core_js_modules_esnext_iterator_find_js__WEBPACK_IMPORTED_MODULE_18__),core_js_modules_esnext_iterator_flat_map_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(670),core_js_modules_esnext_iterator_flat_map_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(core_js_modules_esnext_iterator_flat_map_js__WEBPACK_IMPORTED_MODULE_19__),core_js_modules_esnext_iterator_for_each_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(3949),core_js_modules_esnext_iterator_for_each_js__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(core_js_modules_esnext_iterator_for_each_js__WEBPACK_IMPORTED_MODULE_20__),core_js_modules_esnext_iterator_map_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(1454),core_js_modules_esnext_iterator_map_js__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(core_js_modules_esnext_iterator_map_js__WEBPACK_IMPORTED_MODULE_21__),core_js_modules_esnext_iterator_reduce_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(8872),core_js_modules_esnext_iterator_reduce_js__WEBPACK_IMPORTED_MODULE_22___default=__webpack_require__.n(core_js_modules_esnext_iterator_reduce_js__WEBPACK_IMPORTED_MODULE_22__),core_js_modules_esnext_iterator_some_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(7550),core_js_modules_esnext_iterator_some_js__WEBPACK_IMPORTED_MODULE_23___default=__webpack_require__.n(core_js_modules_esnext_iterator_some_js__WEBPACK_IMPORTED_MODULE_23__),core_js_modules_esnext_iterator_to_array_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(1795),core_js_modules_esnext_iterator_to_array_js__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(core_js_modules_esnext_iterator_to_array_js__WEBPACK_IMPORTED_MODULE_24__),core_js_modules_web_dom_exception_stack_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(4979),core_js_modules_web_dom_exception_stack_js__WEBPACK_IMPORTED_MODULE_25___default=__webpack_require__.n(core_js_modules_web_dom_exception_stack_js__WEBPACK_IMPORTED_MODULE_25__),core_js_modules_web_immediate_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(9848),core_js_modules_web_immediate_js__WEBPACK_IMPORTED_MODULE_26___default=__webpack_require__.n(core_js_modules_web_immediate_js__WEBPACK_IMPORTED_MODULE_26__),core_js_modules_web_url_search_params_delete_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(4603),core_js_modules_web_url_search_params_delete_js__WEBPACK_IMPORTED_MODULE_27___default=__webpack_require__.n(core_js_modules_web_url_search_params_delete_js__WEBPACK_IMPORTED_MODULE_27__),core_js_modules_web_url_search_params_has_js__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(7566),core_js_modules_web_url_search_params_has_js__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(core_js_modules_web_url_search_params_has_js__WEBPACK_IMPORTED_MODULE_28__),core_js_modules_web_url_search_params_size_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(8721),core_js_modules_web_url_search_params_size_js__WEBPACK_IMPORTED_MODULE_29___default=__webpack_require__.n(core_js_modules_web_url_search_params_size_js__WEBPACK_IMPORTED_MODULE_29__),__webpackgi_modules__={109:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),t.Z=r},356:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:rgba(0,0,0,0);border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",""]),t.Z=r},44:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),t.Z=r},27:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,'#assetManagerLoadingScreen{z-index:300;position:absolute;bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:rgba(0,0,0,0);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: 0.8;--b-background: #ffffff}#assetManagerLoadingScreen::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:bold}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem;padding:1rem}.loadingScreenLogoElement{margin-bottom:.5rem;max-width:80%}.loadingScreenLogoElement img{min-height:3rem;max-height:5rem;max-width:100%;-o-object-fit:contain;object-fit:contain}.loadingScreenLogoImage{width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoElement{min-height:0;display:none}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',""]),t.Z=r},798:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;color:#fff;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),t.Z=r},729:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,'.button-bar{background:var(--tp-base-background-color);width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:500;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:var(--tp-input-foreground-color, #cccccc);transition:color .25s}.button-bar-button:hover{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected-box{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:var(--tp-container-background-color-active, #413762)}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:var(--tp-container-foreground-color, #cccccc);transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s;box-sizing:content-box !important}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem;aspect-ratio:1;box-sizing:content-box !important}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px;flex-wrap:nowrap !important;overflow-x:scroll;pointer-events:auto;max-width:100%;align-content:center;justify-content:flex-start;align-items:center;box-sizing:border-box}.mode-buttons-container::-webkit-scrollbar{display:none}.mode-buttons-container{-ms-overflow-style:none;scrollbar-width:none}.mode-button{font-weight:500}#webgi-logo{background-image:url("https://static.webgi.xyz/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:7.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem;color:var(--tp-container-foreground-color, #dddddd)}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.9rem !important;color:var(--tp-container-foreground-color, #dddddd) !important}#tweakpaneUiContainer{margin-top:4.5rem}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{transition:background-color .5s ease;background-color:#d1d4e7}body.tpTheme-blue{background-color:#d1d4e7}body.tpTheme-white{background-color:#dcdcdc}body.tpTheme-black{background-color:#48495d}',""]),t.Z=r},898:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,':root{--tp-blade-unit-size: 26px;--tp-font-family: "Inter";--tp-element-border-radius: 0.25rem}:root{--tp-base-background-color: #0e0e0e;--tp-container-background-color: rgba(32, 32, 32, 0.2);--tp-container-background-color-hover: rgba(32, 32, 32, 0.3);--tp-container-background-color-active: rgba(50, 50, 50, 0.8);--tp-container-background-color-focus: rgba(50, 50, 50, 1.0);--tp-container-foreground-color: hsla(0, 0%, 90%, 0.90);--tp-label-foreground-color: hsla(0, 0%, 85%, 0.90)}:root .tpTheme-blue{--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 36%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED}:root .tpTheme-white{--tp-base-background-color: hsla(230, 5%, 90%, 1.00);--tp-base-shadow-color: hsla(0, 0%, 0%, 0.10);--tp-button-background-color: hsla(230, 7%, 85%, 1.00);--tp-button-background-color-active: hsla(230, 7%, 70%, 1.00);--tp-button-background-color-focus: hsla(230, 7%, 75%, 1.00);--tp-button-background-color-hover: hsla(230, 7%, 80%, 1.00);--tp-button-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-container-background-color: hsla(230, 15%, 80%, 0.10);--tp-container-background-color-active: hsla(230, 15%, 70%, 0.32);--tp-container-background-color-focus: hsla(230, 15%, 70%, 0.28);--tp-container-background-color-hover: hsla(230, 15%, 70%, 0.24);--tp-container-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-groove-foreground-color: hsla(230, 15%, 20%, 0.10);--tp-input-background-color: hsla(230, 15%, 30%, 0.10);--tp-input-background-color-active: hsla(230, 15%, 50%, 0.22);--tp-input-background-color-focus: hsla(230, 15%, 50%, 0.18);--tp-input-background-color-hover: hsla(230, 15%, 50%, 0.14);--tp-input-foreground-color: hsla(230, 10%, 20%, 1.00);--tp-label-foreground-color: hsla(230, 10%, 10%, 1.00);--tp-monitor-background-color: hsla(230, 15%, 30%, 0.10);--tp-monitor-foreground-color: hsla(230, 10%, 30%, 0.50)}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.9rem !important;transition:background-color .5s ease}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.7rem !important}.tp-lblv_l{font-size:.75rem !important;font-weight:500 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.75rem !important;font-weight:500 !important}.tp-fldv_t{font-weight:500 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:var(--tp-container-foreground-color, #eeeeee);font-size:.9rem;border:none}.tp-sldv_k::after{background-color:var(--tp-input-foreground-color, hsl(230, 7%, 75%))}.tp-btnv_b{height:calc(var(--tp-blade-unit-size)*1.15)}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{font-weight:500 !important}.tp-rotv{font-size:13px !important}',""]),t.Z=r},513:function(e,t,n){var i=n(352),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),t.Z=r},476:function(e){var t;t=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i={convertToObject:function(e){var t=e.substring(e.indexOf("{")+1).trim().slice(0,-1),n={};return t.split(";").map((function(e){if(e=e.trim()){var t=e.split(":");n[t[0].trim()]=t[1].trim()}})),n},getFromSheets:function(e){var t=document.styleSheets;for(var n in t){var r=null;try{r=t[n].rules||t[n].cssRules}catch(e){}if(r)for(var s in r)if(r[s].selectorText&&-1!=r[s].selectorText.split(",").indexOf(e))return r[s].cssText?i.convertToObject(r[s].cssText):i.convertToObject(r[s].style.cssText)}return{}},getPropertyDefault:function(e){return"timing-function"==e?"ease":"iteration-count"==e?1:"direction"==e?"normal":"fill-mode"==e?"none":null}};t.default=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i={generateId:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<8;++n)e+=t.charAt(Math.floor(Math.random()*t.length));return e},frameToString:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},convertTimeToMs:function(e){if(!e)return 0;if("number"==typeof e)return e;var t=parseFloat(e);return-1!=e.indexOf("ms")?t:1e3*t},prefixes:["","-webkit-","-moz-","-o-"]};t.default=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i,r=(i=n(0))&&i.__esModule?i:{default:i};t.default=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.styles="string"==typeof t?r.default.getFromSheets(t):t,"string"==typeof n){var i=r.default.getFromSheets(n);for(var s in this.options={},i)this.options[s.replace("animation-","")]=i[s]}else this.options="number"==typeof n?{duration:n}:n}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=a(n(4)),s=a(n(1)),o=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,n,i,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.constructor===Array?this.doms=t:this.doms=[t],n.constructor===Array?this.frames=n:this.frames=[n],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},null!=i&&null!=i)if("boolean"==typeof i)this.options.instant=i;else if("number"==typeof i)this.options.count=i,"boolean"==typeof r&&(this.options.instant=r);else for(var o in i)"pauseAt"==o&&i.pauseAt.constructor!==Array?this.options[o]=[i[o]]:this.options[o]=i[o];for(var a in this.promiseSupported="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=s.default.prefixes:this.prefixes=[""],t)this.countRemainder[a]=this.options.count-1;this.options.instant&&this.play()}return i(e,[{key:"play",value:function(){var e=this;for(var t in this.clear(),this.promiseSupported&&(this.promise=new Promise((function(t){e.promiseResolve=t}))),this.doms){var n=this.makeAnimation(this.doms[t]);this.animations[t]=n.names,this.styleDoms[t]=n.styleDom,this.superSets[t]=this.makeSuperSet(this.doms[t],this.animations[t]),this.playAnimation(this.doms[t],this.superSets[t]),this.eventHandler[t]=this.handleAnimationEnd.bind(this,t),this.doms[t].addEventListener("animationend",this.eventHandler[t])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(e){if(!e){for(var t in this.doms)this.clear(t);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var n=this.styleDoms[e];for(var i in n&&n.parentNode&&n.parentNode.removeChild(n),this.superSets[e])for(var r in this.prefixes)this.doms[e].style[this.prefixes[r]+"animation-"+i]=null;for(var s in this.prefixes)this.doms[e].style[this.prefixes[s]+"animation-play-state"]=null;this.doms[e].removeEventListener("animationend",this.eventHandler[e]),this.countRemainder[e]=this.options.count-1}},{key:"replay",value:function(e){var t=this.doms[e],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),this.doms[e].removeEventListener("animationend",this.eventHandler[e]),this.doms[e]=n,this.doms[e].addEventListener("animationend",this.eventHandler[e])}},{key:"pause",value:function(){for(var e in this.doms)this.pauseDom(this.doms[e])}},{key:"resume",value:function(){for(var e in this.doms)this.resumeDom(this.doms[e])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(e,t){var n=t.animationName,i=n.substring(n.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(i))&&this.pauseDom(this.doms[e]),i==this.frames.length&&(-1==this.countRemainder[e]?this.replay(e):this.countRemainder[e]>0?(this.countRemainder[e]--,this.replay(e)):(this.options.applyOnEnd&&this.applyOnEnd(e),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(e){for(var t in this.prefixes)e.style[this.prefixes[t]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(e){for(var t in this.prefixes)e.style[this.prefixes[t]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(e){var t=this.newFrames[this.frames.length];for(var n in t)this.doms[e].style[n]=t[n]}},{key:"makeAnimation",value:function(e){var t={},n=[],i={};for(var s in this.frames)for(var o in n.push(this.frames[s].styles),n[s])i[o]=!0;var a=window.getComputedStyle(e);for(var l in i)t[l]=a[l];n.unshift(t);for(var c=[n[0]],u=1;u<n.length;++u){var d=JSON.parse(JSON.stringify(c[u-1]));for(var h in n[u])d[h]=n[u][h];c.push(d)}return this.newFrames=c,r.default.make(c,this.prefixes)}},{key:"makeSuperSet",value:function(e,t){var n=0,i={};for(var r in this.frames)for(var a in this.frames[r].options)i[a]="";i.name="",i.duration="",i.delay="";for(var l=0;l<this.frames.length;++l){if(l)for(var c in i)i[c]+=",";var u=s.default.convertTimeToMs(this.frames[l].options.duration),d=s.default.convertTimeToMs(this.frames[l].options.delay);for(var h in l<this.options.startFrom&&(u=0,d=0),i.name+=t[l],i.duration+=u+"ms",i.delay+=n+d+"ms",i)"name"!=h&&"duration"!=h&&"delay"!=h&&(i[h]+=this.frames[l].options[h]?this.frames[l].options[h]:o.default.getPropertyDefault(h));var p=this.frames[l].options["iteration-count"];n+=u*parseInt(p||1)+d}return i}},{key:"playAnimation",value:function(e,t){for(var n in t)for(var i in this.prefixes)e.style[this.prefixes[i]+"animation-"+n]=t[n];this.options.pauseAt.includes(0)&&this.pauseDom(e)}}]),e}();t.default=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i,r=(i=n(1))&&i.__esModule?i:{default:i},s={make:function(e,t){for(var n=[],i="",o="atr-"+r.default.generateId(),a=document.createElement("style"),l=0;l<e.length-1;++l)n.push(o+"-"+(l+1)),i+=s.makeFromTwoFrames(e[l],e[l+1],n[l],t);return a.innerHTML=i,a.class="foo",document.getElementsByTagName("head")[0].appendChild(a),{names:n,styleDom:a}},makeFromTwoFrames:function(e,t,n,i){var s="";for(var o in i)s+="@"+i[o]+"keyframes "+n+" {",s+="0%",s+="{"+r.default.frameToString(e)+"}",s+="100%",s+="{"+r.default.frameToString(t)+"}",s+="}";return s}};t.default=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=t.Frame=void 0;var i=s(n(2)),r=s(n(3));function s(e){return e&&e.__esModule?e:{default:e}}t.Frame=i.default,t.Queue=r.default}])},e.exports=t()},352:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(i)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(r[o]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);i&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},388:function(e){e.exports=function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return r(t[o][1][e]||e)}),l,l.exports,e,t,n,i)}return n[o].exports}for(var s=void 0,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){(function(i,r,s,o,a,l,c,u,d){var h=e("crypto");function p(e,t){return function(e,t){var n;if(void 0===(n="passthrough"!==t.algorithm?h.createHash(t.algorithm):new y).write&&(n.write=n.update,n.end=n.update),v(t,n).dispatch(e),n.update||n.end(""),n.digest)return n.digest("buffer"===t.encoding?void 0:t.encoding);var i=n.read();return"buffer"!==t.encoding?i.toString(t.encoding):i}(e,t=g(e,t))}(n=t.exports=p).sha1=function(e){return p(e)},n.keys=function(e){return p(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},n.MD5=function(e){return p(e,{algorithm:"md5",encoding:"hex"})},n.keysMD5=function(e){return p(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var f=h.getHashes?h.getHashes().slice():["sha1","md5"];f.push("passthrough");var m=["buffer","hex","binary","base64"];function g(e,t){t=t||{};var n={};if(n.algorithm=t.algorithm||"sha1",n.encoding=t.encoding||"hex",n.excludeValues=!!t.excludeValues,n.algorithm=n.algorithm.toLowerCase(),n.encoding=n.encoding.toLowerCase(),n.ignoreUnknown=!0===t.ignoreUnknown,n.respectType=!1!==t.respectType,n.respectFunctionNames=!1!==t.respectFunctionNames,n.respectFunctionProperties=!1!==t.respectFunctionProperties,n.unorderedArrays=!0===t.unorderedArrays,n.unorderedSets=!1!==t.unorderedSets,n.unorderedObjects=!1!==t.unorderedObjects,n.replacer=t.replacer||void 0,n.excludeKeys=t.excludeKeys||void 0,void 0===e)throw new Error("Object argument required.");for(var i=0;i<f.length;++i)f[i].toLowerCase()===n.algorithm.toLowerCase()&&(n.algorithm=f[i]);if(-1===f.indexOf(n.algorithm))throw new Error('Algorithm "'+n.algorithm+'"  not supported. supported values: '+f.join(", "));if(-1===m.indexOf(n.encoding)&&"passthrough"!==n.algorithm)throw new Error('Encoding "'+n.encoding+'"  not supported. supported values: '+m.join(", "));return n}function _(e){if("function"==typeof e)return null!=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))}function v(e,t,n){function i(e){return t.update?t.update(e,"utf8"):t.write(e,"utf8")}return n=n||[],{dispatch:function(t){return e.replacer&&(t=e.replacer(t)),this["_"+(null===t?"null":typeof t)](t)},_object:function(t){var r,o=Object.prototype.toString.call(t),a=/\[object (.*)\]/i.exec(o);if(a=(a=a?a[1]:"unknown:["+o+"]").toLowerCase(),0<=(r=n.indexOf(t)))return this.dispatch("[CIRCULAR:"+r+"]");if(n.push(t),void 0!==s&&s.isBuffer&&s.isBuffer(t))return i("buffer:"),i(t);if("object"===a||"function"===a||"asyncfunction"===a){var l=Object.keys(t);e.unorderedObjects&&(l=l.sort()),!1===e.respectType||_(t)||l.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(l=l.filter((function(t){return!e.excludeKeys(t)}))),i("object:"+l.length+":");var c=this;return l.forEach((function(n){c.dispatch(n),i(":"),e.excludeValues||c.dispatch(t[n]),i(",")}))}if(!this["_"+a]){if(e.ignoreUnknown)return i("["+a+"]");throw new Error('Unknown object type "'+a+'"')}this["_"+a](t)},_array:function(t,r){r=void 0!==r?r:!1!==e.unorderedArrays;var s=this;if(i("array:"+t.length+":"),!r||t.length<=1)return t.forEach((function(e){return s.dispatch(e)}));var o=[],a=t.map((function(t){var i=new y,r=n.slice();return v(e,i,r).dispatch(t),o=o.concat(r.slice(n.length)),i.read().toString()}));return n=n.concat(o),a.sort(),this._array(a,!1)},_date:function(e){return i("date:"+e.toJSON())},_symbol:function(e){return i("symbol:"+e.toString())},_error:function(e){return i("error:"+e.toString())},_boolean:function(e){return i("bool:"+e.toString())},_string:function(e){i("string:"+e.length+":"),i(e.toString())},_function:function(t){i("fn:"),_(t)?this.dispatch("[native]"):this.dispatch(t.toString()),!1!==e.respectFunctionNames&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(e){return i("number:"+e.toString())},_xml:function(e){return i("xml:"+e.toString())},_null:function(){return i("Null")},_undefined:function(){return i("Undefined")},_regexp:function(e){return i("regex:"+e.toString())},_uint8array:function(e){return i("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return i("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return i("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return i("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return i("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return i("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return i("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return i("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return i("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return i("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){return i("url:"+e.toString())},_map:function(t){i("map:");var n=Array.from(t);return this._array(n,!1!==e.unorderedSets)},_set:function(t){i("set:");var n=Array.from(t);return this._array(n,!1!==e.unorderedSets)},_file:function(e){return i("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},_blob:function(){if(e.ignoreUnknown)return i("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n')},_domwindow:function(){return i("domwindow")},_bigint:function(e){return i("bigint:"+e.toString())},_process:function(){return i("process")},_timer:function(){return i("timer")},_pipe:function(){return i("pipe")},_tcp:function(){return i("tcp")},_udp:function(){return i("udp")},_tty:function(){return i("tty")},_statwatcher:function(){return i("statwatcher")},_securecontext:function(){return i("securecontext")},_connection:function(){return i("connection")},_zlib:function(){return i("zlib")},_context:function(){return i("context")},_nodescript:function(){return i("nodescript")},_httpparser:function(){return i("httpparser")},_dataview:function(){return i("dataview")},_signal:function(){return i("signal")},_fsevent:function(){return i("fsevent")},_tlswrap:function(){return i("tlswrap")}}}function y(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}n.writeToStream=function(e,t,n){return void 0===n&&(n=t,t={}),v(t=g(e,t),n).dispatch(e)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(e,t,n){(function(e,t,i,r,s,o,a,l,c){!function(e){var t="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),i="/".charCodeAt(0),r="0".charCodeAt(0),s="a".charCodeAt(0),o="A".charCodeAt(0),a="-".charCodeAt(0),l="_".charCodeAt(0);function c(e){var t=e.charCodeAt(0);return t===n||t===a?62:t===i||t===l?63:t<r?-1:t<r+10?t-r+26+26:t<o+26?t-o:t<s+26?t-s+26:void 0}e.toByteArray=function(e){var n,i;if(0<e.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.length,s="="===e.charAt(r-2)?2:"="===e.charAt(r-1)?1:0,o=new t(3*e.length/4-s),a=0<s?e.length-4:e.length,l=0;function u(e){o[l++]=e}for(n=0;n<a;n+=4,0)u((16711680&(i=c(e.charAt(n))<<18|c(e.charAt(n+1))<<12|c(e.charAt(n+2))<<6|c(e.charAt(n+3))))>>16),u((65280&i)>>8),u(255&i);return 2==s?u(255&(i=c(e.charAt(n))<<2|c(e.charAt(n+1))>>4)):1==s&&(u((i=c(e.charAt(n))<<10|c(e.charAt(n+1))<<4|c(e.charAt(n+2))>>2)>>8&255),u(255&i)),o},e.fromByteArray=function(e){var t,n,i,r,s=e.length%3,o="";function a(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,i=e.length-s;t<i;t+=3)o+=a((r=n=(e[t]<<16)+(e[t+1]<<8)+e[t+2])>>18&63)+a(r>>12&63)+a(r>>6&63)+a(63&r);switch(s){case 1:o+=a((n=e[e.length-1])>>2),o+=a(n<<4&63),o+="==";break;case 2:o+=a((n=(e[e.length-2]<<8)+e[e.length-1])>>10),o+=a(n>>4&63),o+=a(n<<2&63),o+="="}return o}}(void 0===n?this.base64js={}:n)}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(e,t,n){(function(t,i,r,s,o,a,l,c,u){var d=e("base64-js"),h=e("ieee754");function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);var i,s,o,a,l,c=typeof e;if("base64"===t&&"string"==c)for(e=(i=e).trim?i.trim():i.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"==c)s=M(e);else if("string"==c)s=r.byteLength(e,t);else{if("object"!=c)throw new Error("First argument needs to be a number, array or string.");s=M(e.length)}if(r._useTypedArrays?o=r._augment(new Uint8Array(s)):((o=this).length=s,o._isBuffer=!0),r._useTypedArrays&&"number"==typeof e.byteLength)o._set(e);else if(T(l=e)||r.isBuffer(l)||l&&"object"==typeof l&&"number"==typeof l.length)for(a=0;a<s;a++)r.isBuffer(e)?o[a]=e.readUInt8(a):o[a]=e[a];else if("string"==c)o.write(e,0,t);else if("number"==c&&!r._useTypedArrays&&!n)for(a=0;a<s;a++)o[a]=0;return o}function p(e,t,n,i){i||(U("boolean"==typeof n,"missing or invalid endian"),U(null!=t,"missing offset"),U(t+1<e.length,"Trying to read beyond buffer length"));var r,s=e.length;if(!(s<=t))return n?(r=e[t],t+1<s&&(r|=e[t+1]<<8)):(r=e[t]<<8,t+1<s&&(r|=e[t+1])),r}function f(e,t,n,i){i||(U("boolean"==typeof n,"missing or invalid endian"),U(null!=t,"missing offset"),U(t+3<e.length,"Trying to read beyond buffer length"));var r,s=e.length;if(!(s<=t))return n?(t+2<s&&(r=e[t+2]<<16),t+1<s&&(r|=e[t+1]<<8),r|=e[t],t+3<s&&(r+=e[t+3]<<24>>>0)):(t+1<s&&(r=e[t+1]<<16),t+2<s&&(r|=e[t+2]<<8),t+3<s&&(r|=e[t+3]),r+=e[t]<<24>>>0),r}function m(e,t,n,i){if(i||(U("boolean"==typeof n,"missing or invalid endian"),U(null!=t,"missing offset"),U(t+1<e.length,"Trying to read beyond buffer length")),!(e.length<=t)){var r=p(e,t,n,!0);return 32768&r?-1*(65535-r+1):r}}function g(e,t,n,i){if(i||(U("boolean"==typeof n,"missing or invalid endian"),U(null!=t,"missing offset"),U(t+3<e.length,"Trying to read beyond buffer length")),!(e.length<=t)){var r=f(e,t,n,!0);return 2147483648&r?-1*(4294967295-r+1):r}}function _(e,t,n,i){return i||(U("boolean"==typeof n,"missing or invalid endian"),U(t+3<e.length,"Trying to read beyond buffer length")),h.read(e,t,n,23,4)}function v(e,t,n,i){return i||(U("boolean"==typeof n,"missing or invalid endian"),U(t+7<e.length,"Trying to read beyond buffer length")),h.read(e,t,n,52,8)}function y(e,t,n,i,r){r||(U(null!=t,"missing value"),U("boolean"==typeof i,"missing or invalid endian"),U(null!=n,"missing offset"),U(n+1<e.length,"trying to write beyond buffer length"),B(t,65535));var s=e.length;if(!(s<=n))for(var o=0,a=Math.min(s-n,2);o<a;o++)e[n+o]=(t&255<<8*(i?o:1-o))>>>8*(i?o:1-o)}function b(e,t,n,i,r){r||(U(null!=t,"missing value"),U("boolean"==typeof i,"missing or invalid endian"),U(null!=n,"missing offset"),U(n+3<e.length,"trying to write beyond buffer length"),B(t,4294967295));var s=e.length;if(!(s<=n))for(var o=0,a=Math.min(s-n,4);o<a;o++)e[n+o]=t>>>8*(i?o:3-o)&255}function A(e,t,n,i,r){r||(U(null!=t,"missing value"),U("boolean"==typeof i,"missing or invalid endian"),U(null!=n,"missing offset"),U(n+1<e.length,"Trying to write beyond buffer length"),O(t,32767,-32768)),e.length<=n||y(e,0<=t?t:65535+t+1,n,i,r)}function w(e,t,n,i,r){r||(U(null!=t,"missing value"),U("boolean"==typeof i,"missing or invalid endian"),U(null!=n,"missing offset"),U(n+3<e.length,"Trying to write beyond buffer length"),O(t,2147483647,-2147483648)),e.length<=n||b(e,0<=t?t:4294967295+t+1,n,i,r)}function x(e,t,n,i,r){r||(U(null!=t,"missing value"),U("boolean"==typeof i,"missing or invalid endian"),U(null!=n,"missing offset"),U(n+3<e.length,"Trying to write beyond buffer length"),L(t,34028234663852886e22,-34028234663852886e22)),e.length<=n||h.write(e,t,n,i,23,4)}function E(e,t,n,i,r){r||(U(null!=t,"missing value"),U("boolean"==typeof i,"missing or invalid endian"),U(null!=n,"missing offset"),U(n+7<e.length,"Trying to write beyond buffer length"),L(t,17976931348623157e292,-17976931348623157e292)),e.length<=n||h.write(e,t,n,i,52,8)}n.Buffer=r,n.SlowBuffer=r,n.INSPECT_MAX_BYTES=50,r.poolSize=8192,r._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),r.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.isBuffer=function(e){return!(null==e||!e._isBuffer)},r.byteLength=function(e,t){var n;switch(e+="",t||"utf8"){case"hex":n=e.length/2;break;case"utf8":case"utf-8":n=P(e).length;break;case"ascii":case"binary":case"raw":n=e.length;break;case"base64":n=R(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*e.length;break;default:throw new Error("Unknown encoding")}return n},r.concat=function(e,t){if(U(T(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new r(0);if(1===e.length)return e[0];if("number"!=typeof t)for(s=t=0;s<e.length;s++)t+=e[s].length;for(var n=new r(t),i=0,s=0;s<e.length;s++){var o=e[s];o.copy(n,i),i+=o.length}return n},r.prototype.write=function(e,t,n,i){var s;isFinite(t)?isFinite(n)||(i=n,n=void 0):(s=i,i=t,t=n,n=s),t=Number(t)||0;var o,a,l,c,u,d,h,p=this.length-t;switch((!n||p<(n=Number(n)))&&(n=p),i=String(i||"utf8").toLowerCase()){case"hex":o=function(e,t,n,i){n=Number(n)||0;var s=e.length-n;(!i||s<(i=Number(i)))&&(i=s);var o=t.length;U(o%2==0,"Invalid hex string"),o/2<i&&(i=o/2);for(var a=0;a<i;a++){var l=parseInt(t.substr(2*a,2),16);U(!isNaN(l),"Invalid hex string"),e[n+a]=l}return r._charsWritten=2*a,a}(this,e,t,n);break;case"utf8":case"utf-8":u=e,d=t,h=n,o=r._charsWritten=D(P(u),this,d,h);break;case"ascii":case"binary":o=function(e,t,n,i){return r._charsWritten=D(function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}(this,e,t,n);break;case"base64":a=e,l=t,c=n,o=r._charsWritten=D(R(a),this,l,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=function(e,t,n,i){return r._charsWritten=D(function(e){for(var t,n,i,r=[],s=0;s<e.length;s++)n=(t=e.charCodeAt(s))>>8,i=t%256,r.push(i),r.push(n);return r}(t),e,n,i)}(this,e,t,n);break;default:throw new Error("Unknown encoding")}return o},r.prototype.toString=function(e,t,n){var i,r,s,o,a=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(n=void 0!==n?Number(n):n=a.length)===t)return"";switch(e){case"hex":i=function(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||i<n)&&(n=i);for(var r="",s=t;s<n;s++)r+=I(e[s]);return r}(a,t,n);break;case"utf8":case"utf-8":i=function(e,t,n){var i="",r="";n=Math.min(e.length,n);for(var s=t;s<n;s++)e[s]<=127?(i+=k(r)+String.fromCharCode(e[s]),r=""):r+="%"+e[s].toString(16);return i+k(r)}(a,t,n);break;case"ascii":case"binary":i=function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;r++)i+=String.fromCharCode(e[r]);return i}(a,t,n);break;case"base64":r=a,o=n,i=0===(s=t)&&o===r.length?d.fromByteArray(r):d.fromByteArray(r.slice(s,o));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=function(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}(a,t,n);break;default:throw new Error("Unknown encoding")}return i},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},r.prototype.copy=function(e,t,n,i){if(n=n||0,i||0===i||(i=this.length),t=t||0,i!==n&&0!==e.length&&0!==this.length){U(n<=i,"sourceEnd < sourceStart"),U(0<=t&&t<e.length,"targetStart out of bounds"),U(0<=n&&n<this.length,"sourceStart out of bounds"),U(0<=i&&i<=this.length,"sourceEnd out of bounds"),i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var s=i-n;if(s<100||!r._useTypedArrays)for(var o=0;o<s;o++)e[o+t]=this[o+n];else e._set(this.subarray(n,n+s),t)}},r.prototype.slice=function(e,t){var n=this.length;if(e=S(e,n,0),t=S(t,n,n),r._useTypedArrays)return r._augment(this.subarray(e,t));for(var i=t-e,s=new r(i,void 0,!0),o=0;o<i;o++)s[o]=this[o+e];return s},r.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},r.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},r.prototype.readUInt8=function(e,t){if(t||(U(null!=e,"missing offset"),U(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},r.prototype.readUInt16LE=function(e,t){return p(this,e,!0,t)},r.prototype.readUInt16BE=function(e,t){return p(this,e,!1,t)},r.prototype.readUInt32LE=function(e,t){return f(this,e,!0,t)},r.prototype.readUInt32BE=function(e,t){return f(this,e,!1,t)},r.prototype.readInt8=function(e,t){if(t||(U(null!=e,"missing offset"),U(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},r.prototype.readInt16LE=function(e,t){return m(this,e,!0,t)},r.prototype.readInt16BE=function(e,t){return m(this,e,!1,t)},r.prototype.readInt32LE=function(e,t){return g(this,e,!0,t)},r.prototype.readInt32BE=function(e,t){return g(this,e,!1,t)},r.prototype.readFloatLE=function(e,t){return _(this,e,!0,t)},r.prototype.readFloatBE=function(e,t){return _(this,e,!1,t)},r.prototype.readDoubleLE=function(e,t){return v(this,e,!0,t)},r.prototype.readDoubleBE=function(e,t){return v(this,e,!1,t)},r.prototype.writeUInt8=function(e,t,n){n||(U(null!=e,"missing value"),U(null!=t,"missing offset"),U(t<this.length,"trying to write beyond buffer length"),B(e,255)),t>=this.length||(this[t]=e)},r.prototype.writeUInt16LE=function(e,t,n){y(this,e,t,!0,n)},r.prototype.writeUInt16BE=function(e,t,n){y(this,e,t,!1,n)},r.prototype.writeUInt32LE=function(e,t,n){b(this,e,t,!0,n)},r.prototype.writeUInt32BE=function(e,t,n){b(this,e,t,!1,n)},r.prototype.writeInt8=function(e,t,n){n||(U(null!=e,"missing value"),U(null!=t,"missing offset"),U(t<this.length,"Trying to write beyond buffer length"),O(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,n):this.writeUInt8(255+e+1,t,n))},r.prototype.writeInt16LE=function(e,t,n){A(this,e,t,!0,n)},r.prototype.writeInt16BE=function(e,t,n){A(this,e,t,!1,n)},r.prototype.writeInt32LE=function(e,t,n){w(this,e,t,!0,n)},r.prototype.writeInt32BE=function(e,t,n){w(this,e,t,!1,n)},r.prototype.writeFloatLE=function(e,t,n){x(this,e,t,!0,n)},r.prototype.writeFloatBE=function(e,t,n){x(this,e,t,!1,n)},r.prototype.writeDoubleLE=function(e,t,n){E(this,e,t,!0,n)},r.prototype.writeDoubleBE=function(e,t,n){E(this,e,t,!1,n)},r.prototype.fill=function(e,t,n){if(e=e||0,t=t||0,n=n||this.length,"string"==typeof e&&(e=e.charCodeAt(0)),U("number"==typeof e&&!isNaN(e),"value is not a number"),U(t<=n,"end < start"),n!==t&&0!==this.length){U(0<=t&&t<this.length,"start out of bounds"),U(0<=n&&n<=this.length,"end out of bounds");for(var i=t;i<n;i++)this[i]=e}},r.prototype.inspect=function(){for(var e=[],t=this.length,i=0;i<t;i++)if(e[i]=I(this[i]),i===n.INSPECT_MAX_BYTES){e[i+1]="...";break}return"<Buffer "+e.join(" ")+">"},r.prototype.toArrayBuffer=function(){if("undefined"==typeof Uint8Array)throw new Error("Buffer.toArrayBuffer not supported in this browser");if(r._useTypedArrays)return new r(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer};var C=r.prototype;function S(e,t,n){return"number"!=typeof e?n:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function M(e){return(e=~~Math.ceil(+e))<0?0:e}function T(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function I(e){return e<16?"0"+e.toString(16):e.toString(16)}function P(e){for(var t=[],n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i<=127)t.push(e.charCodeAt(n));else{var r=n;55296<=i&&i<=57343&&n++;for(var s=encodeURIComponent(e.slice(r,n+1)).substr(1).split("%"),o=0;o<s.length;o++)t.push(parseInt(s[o],16))}}return t}function R(e){return d.toByteArray(e)}function D(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);r++)t[r+n]=e[r];return r}function k(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function B(e,t){U("number"==typeof e,"cannot write a non-number as a number"),U(0<=e,"specified a negative value for writing an unsigned value"),U(e<=t,"value is larger than maximum value for type"),U(Math.floor(e)===e,"value has a fractional component")}function O(e,t,n){U("number"==typeof e,"cannot write a non-number as a number"),U(e<=t,"value larger than maximum allowed value"),U(n<=e,"value smaller than minimum allowed value"),U(Math.floor(e)===e,"value has a fractional component")}function L(e,t,n){U("number"==typeof e,"cannot write a non-number as a number"),U(e<=t,"value larger than maximum allowed value"),U(n<=e,"value smaller than minimum allowed value")}function U(e,t){if(!e)throw new Error(t||"Failed assertion")}r._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=C.get,e.set=C.set,e.write=C.write,e.toString=C.toString,e.toLocaleString=C.toString,e.toJSON=C.toJSON,e.copy=C.copy,e.slice=C.slice,e.readUInt8=C.readUInt8,e.readUInt16LE=C.readUInt16LE,e.readUInt16BE=C.readUInt16BE,e.readUInt32LE=C.readUInt32LE,e.readUInt32BE=C.readUInt32BE,e.readInt8=C.readInt8,e.readInt16LE=C.readInt16LE,e.readInt16BE=C.readInt16BE,e.readInt32LE=C.readInt32LE,e.readInt32BE=C.readInt32BE,e.readFloatLE=C.readFloatLE,e.readFloatBE=C.readFloatBE,e.readDoubleLE=C.readDoubleLE,e.readDoubleBE=C.readDoubleBE,e.writeUInt8=C.writeUInt8,e.writeUInt16LE=C.writeUInt16LE,e.writeUInt16BE=C.writeUInt16BE,e.writeUInt32LE=C.writeUInt32LE,e.writeUInt32BE=C.writeUInt32BE,e.writeInt8=C.writeInt8,e.writeInt16LE=C.writeInt16LE,e.writeInt16BE=C.writeInt16BE,e.writeInt32LE=C.writeInt32LE,e.writeInt32BE=C.writeInt32BE,e.writeFloatLE=C.writeFloatLE,e.writeFloatBE=C.writeFloatBE,e.writeDoubleLE=C.writeDoubleLE,e.writeDoubleBE=C.writeDoubleBE,e.fill=C.fill,e.inspect=C.inspect,e.toArrayBuffer=C.toArrayBuffer,e}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(e,t,n){(function(n,i,r,s,o,a,l,c,u){r=e("buffer").Buffer;var d=new r(4);d.fill(0),t.exports={hash:function(e,t,n,i){return r.isBuffer(e)||(e=new r(e)),function(e,t,n){for(var i=new r(t),s=n?i.writeInt32BE:i.writeInt32LE,o=0;o<e.length;o++)s.call(i,e[o],4*o,!0);return i}(t(function(e,t){var n;e.length%4!=0&&(n=e.length+(4-e.length%4),e=r.concat([e,d],n));for(var i=[],s=t?e.readInt32BE:e.readInt32LE,o=0;o<e.length;o+=4)i.push(s.call(e,o));return i}(e,i),8*e.length),n,i)}}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(e,t,n){(function(t,i,r,s,o,a,l,c,u){r=e("buffer").Buffer;var d=e("./sha"),h=e("./sha256"),p=e("./rng"),f={sha1:d,sha256:h,md5:e("./md5")},m=64,g=new r(m);function _(e,t){var n=f[e=e||"sha1"],i=[];return n||v("algorithm:",e,"is not yet supported"),{update:function(e){return r.isBuffer(e)||(e=new r(e)),i.push(e),e.length,this},digest:function(e){var s=r.concat(i),o=t?function(e,t,n){r.isBuffer(t)||(t=new r(t)),r.isBuffer(n)||(n=new r(n)),t.length>m?t=e(t):t.length<m&&(t=r.concat([t,g],m));for(var i=new r(m),s=new r(m),o=0;o<m;o++)i[o]=54^t[o],s[o]=92^t[o];var a=e(r.concat([i,n]));return e(r.concat([s,a]))}(n,t,s):n(s);return i=null,e?o.toString(e):o}}}function v(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}g.fill(0),n.createHash=function(e){return _(e)},n.createHmac=_,n.randomBytes=function(e,t){if(!t||!t.call)return new r(p(e));try{t.call(this,void 0,new r(p(e)))}catch(e){t(e)}},function(e,t){for(var n in e)t(e[n])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],(function(e){n[e]=function(){v("sorry,",e,"is not implemented yet")}}))}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(e,t,n){(function(n,i,r,s,o,a,l,c,u){var d=e("./helpers");function h(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,i=-271733879,r=-1732584194,s=271733878,o=0;o<e.length;o+=16){var a=n,l=i,c=r,u=s;n=f(n,i,r,s,e[o+0],7,-680876936),s=f(s,n,i,r,e[o+1],12,-389564586),r=f(r,s,n,i,e[o+2],17,606105819),i=f(i,r,s,n,e[o+3],22,-1044525330),n=f(n,i,r,s,e[o+4],7,-176418897),s=f(s,n,i,r,e[o+5],12,1200080426),r=f(r,s,n,i,e[o+6],17,-1473231341),i=f(i,r,s,n,e[o+7],22,-45705983),n=f(n,i,r,s,e[o+8],7,1770035416),s=f(s,n,i,r,e[o+9],12,-1958414417),r=f(r,s,n,i,e[o+10],17,-42063),i=f(i,r,s,n,e[o+11],22,-1990404162),n=f(n,i,r,s,e[o+12],7,1804603682),s=f(s,n,i,r,e[o+13],12,-40341101),r=f(r,s,n,i,e[o+14],17,-1502002290),n=m(n,i=f(i,r,s,n,e[o+15],22,1236535329),r,s,e[o+1],5,-165796510),s=m(s,n,i,r,e[o+6],9,-1069501632),r=m(r,s,n,i,e[o+11],14,643717713),i=m(i,r,s,n,e[o+0],20,-373897302),n=m(n,i,r,s,e[o+5],5,-701558691),s=m(s,n,i,r,e[o+10],9,38016083),r=m(r,s,n,i,e[o+15],14,-660478335),i=m(i,r,s,n,e[o+4],20,-405537848),n=m(n,i,r,s,e[o+9],5,568446438),s=m(s,n,i,r,e[o+14],9,-1019803690),r=m(r,s,n,i,e[o+3],14,-187363961),i=m(i,r,s,n,e[o+8],20,1163531501),n=m(n,i,r,s,e[o+13],5,-1444681467),s=m(s,n,i,r,e[o+2],9,-51403784),r=m(r,s,n,i,e[o+7],14,1735328473),n=g(n,i=m(i,r,s,n,e[o+12],20,-1926607734),r,s,e[o+5],4,-378558),s=g(s,n,i,r,e[o+8],11,-2022574463),r=g(r,s,n,i,e[o+11],16,1839030562),i=g(i,r,s,n,e[o+14],23,-35309556),n=g(n,i,r,s,e[o+1],4,-1530992060),s=g(s,n,i,r,e[o+4],11,1272893353),r=g(r,s,n,i,e[o+7],16,-155497632),i=g(i,r,s,n,e[o+10],23,-1094730640),n=g(n,i,r,s,e[o+13],4,681279174),s=g(s,n,i,r,e[o+0],11,-358537222),r=g(r,s,n,i,e[o+3],16,-722521979),i=g(i,r,s,n,e[o+6],23,76029189),n=g(n,i,r,s,e[o+9],4,-640364487),s=g(s,n,i,r,e[o+12],11,-421815835),r=g(r,s,n,i,e[o+15],16,530742520),n=_(n,i=g(i,r,s,n,e[o+2],23,-995338651),r,s,e[o+0],6,-198630844),s=_(s,n,i,r,e[o+7],10,1126891415),r=_(r,s,n,i,e[o+14],15,-1416354905),i=_(i,r,s,n,e[o+5],21,-57434055),n=_(n,i,r,s,e[o+12],6,1700485571),s=_(s,n,i,r,e[o+3],10,-1894986606),r=_(r,s,n,i,e[o+10],15,-1051523),i=_(i,r,s,n,e[o+1],21,-2054922799),n=_(n,i,r,s,e[o+8],6,1873313359),s=_(s,n,i,r,e[o+15],10,-30611744),r=_(r,s,n,i,e[o+6],15,-1560198380),i=_(i,r,s,n,e[o+13],21,1309151649),n=_(n,i,r,s,e[o+4],6,-145523070),s=_(s,n,i,r,e[o+11],10,-1120210379),r=_(r,s,n,i,e[o+2],15,718787259),i=_(i,r,s,n,e[o+9],21,-343485551),n=v(n,a),i=v(i,l),r=v(r,c),s=v(s,u)}return Array(n,i,r,s)}function p(e,t,n,i,r,s){return v((o=v(v(t,e),v(i,s)))<<(a=r)|o>>>32-a,n);var o,a}function f(e,t,n,i,r,s,o){return p(t&n|~t&i,e,t,r,s,o)}function m(e,t,n,i,r,s,o){return p(t&i|n&~i,e,t,r,s,o)}function g(e,t,n,i,r,s,o){return p(t^n^i,e,t,r,s,o)}function _(e,t,n,i,r,s,o){return p(n^(t|~i),e,t,r,s,o)}function v(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}t.exports=function(e){return d.hash(e,h,16)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(e,t,n){(function(e,n,i,r,s,o,a,l,c){var u;u=function(e){for(var t,n=new Array(e),i=0;i<e;i++)0==(3&i)&&(t=4294967296*Math.random()),n[i]=t>>>((3&i)<<3)&255;return n},t.exports=u}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(e,t,n){(function(n,i,r,s,o,a,l,c,u){var d=e("./helpers");function h(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n,i,r,s,o,a=Array(80),l=1732584193,c=-271733879,u=-1732584194,d=271733878,h=-1009589776,m=0;m<e.length;m+=16){for(var g=l,_=c,v=u,y=d,b=h,A=0;A<80;A++){a[A]=A<16?e[m+A]:f(a[A-3]^a[A-8]^a[A-14]^a[A-16],1);var w=p(p(f(l,5),(r=c,s=u,o=d,(i=A)<20?r&s|~r&o:!(i<40)&&i<60?r&s|r&o|s&o:r^s^o)),p(p(h,a[A]),(n=A)<20?1518500249:n<40?1859775393:n<60?-1894007588:-899497514));h=d,d=u,u=f(c,30),c=l,l=w}l=p(l,g),c=p(c,_),u=p(u,v),d=p(d,y),h=p(h,b)}return Array(l,c,u,d,h)}function p(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function f(e,t){return e<<t|e>>>32-t}t.exports=function(e){return d.hash(e,h,20,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(e,t,n){(function(n,i,r,s,o,a,l,c,u){function d(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function h(e,t){return e>>>t|e<<32-t}function p(e,t){var n,i,r,s,o,a,l,c,u,p,f=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),m=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),g=new Array(64);e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var _,v,y,b,A,w,x,E,C=0;C<e.length;C+=16){n=m[0],i=m[1],r=m[2],s=m[3],o=m[4],a=m[5],l=m[6],c=m[7];for(var S=0;S<64;S++)g[S]=S<16?e[S+C]:d(d(d(h(E=g[S-2],17)^h(E,19)^E>>>10,g[S-7]),h(x=g[S-15],7)^h(x,18)^x>>>3),g[S-16]),u=d(d(d(d(c,h(w=o,6)^h(w,11)^h(w,25)),(A=o)&a^~A&l),f[S]),g[S]),p=d(h(b=n,2)^h(b,13)^h(b,22),(_=n)&(v=i)^_&(y=r)^v&y),c=l,l=a,a=o,o=d(s,u),s=r,r=i,i=n,n=d(u,p);m[0]=d(n,m[0]),m[1]=d(i,m[1]),m[2]=d(r,m[2]),m[3]=d(s,m[3]),m[4]=d(o,m[4]),m[5]=d(a,m[5]),m[6]=d(l,m[6]),m[7]=d(c,m[7])}return m}var f=e("./helpers");t.exports=function(e){return f.hash(e,p,32,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(e,t,n){(function(e,n,i,r,s,o,a,l,c){function u(){}(e=t.exports={}).nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",(function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<n.length&&n.shift()())}),!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=u,e.addListener=u,e.once=u,e.off=u,e.removeListener=u,e.removeAllListeners=u,e.emit=u,e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(e,t,n){(function(e,t,i,r,s,o,a,l,c){n.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,d=n?r-1:0,h=n?-1:1,p=e[t+d];for(d+=h,s=p&(1<<-u)-1,p>>=-u,u+=a;0<u;s=256*s+e[t+d],d+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;0<u;o=256*o+e[t+d],d+=h,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),s-=c}return(p?-1:1)*o*Math.pow(2,s-i)},n.write=function(e,t,n,i,r,s){var o,a,l,c=8*s-r-1,u=(1<<c)-1,d=u>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),2<=(t+=1<=o+d?h/l:h*Math.pow(2,1-d))*l&&(o++,l/=2),u<=o+d?(a=0,o=u):1<=o+d?(a=(t*l-1)*Math.pow(2,r),o+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,r),o=0));8<=r;e[n+p]=255&a,p+=f,a/=256,r-=8);for(o=o<<r|a,c+=r;0<c;e[n+p]=255&o,p+=f,o/=256,c-=8);e[n+p-f]|=128*m}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(e){var t=function(){function e(e){return l(e,c(a(u(e.length),e),1/e.length))}function t(e){return a(d(e),e)}function n(e,t){return c(e,t?1/(e.length-1):1/e.length)}function i(e){var t=function(e){var t,n=Math.pow(2,-52),i=1e-64/n,r=0,s=0,o=0,a=0,l=0,c=h(e),u=c.length,d=c[0].length;if(u<d)throw"Need more rows than columns";var p=new Array(d),f=new Array(d);for(s=0;s<d;s++)p[s]=f[s]=0;var m=function e(t,n,i){void 0===i&&(i=0);var r,s=t[i],o=Array(s);if(i===t.length-1){for(r=s-2;r>=0;r-=2)o[r+1]=n,o[r]=n;return-1===r&&(o[0]=n),o}for(r=s-1;r>=0;r--)o[r]=e(t,n,i+1);return o}([d,d],0);function g(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var _=0,v=0,y=0,b=0,A=0,w=0,x=0;for(s=0;s<d;s++){for(p[s]=v,x=0,l=s+1,o=s;o<u;o++)x+=c[o][s]*c[o][s];if(x<=i)v=0;else for(_=c[s][s],v=Math.sqrt(x),_>=0&&(v=-v),y=_*v-x,c[s][s]=_-v,o=l;o<d;o++){for(x=0,a=s;a<u;a++)x+=c[a][s]*c[a][o];for(_=x/y,a=s;a<u;a++)c[a][o]+=_*c[a][s]}for(f[s]=v,x=0,o=l;o<d;o++)x+=c[s][o]*c[s][o];if(x<=i)v=0;else{for(_=c[s][s+1],v=Math.sqrt(x),_>=0&&(v=-v),y=_*v-x,c[s][s+1]=_-v,o=l;o<d;o++)p[o]=c[s][o]/y;for(o=l;o<u;o++){for(x=0,a=l;a<d;a++)x+=c[o][a]*c[s][a];for(a=l;a<d;a++)c[o][a]+=x*p[a]}}(A=Math.abs(f[s])+Math.abs(p[s]))>b&&(b=A)}for(s=d-1;-1!=s;s+=-1){if(0!=v){for(y=v*c[s][s+1],o=l;o<d;o++)m[o][s]=c[s][o]/y;for(o=l;o<d;o++){for(x=0,a=l;a<d;a++)x+=c[s][a]*m[a][o];for(a=l;a<d;a++)m[a][o]+=x*m[a][s]}}for(o=l;o<d;o++)m[s][o]=0,m[o][s]=0;m[s][s]=1,v=p[s],l=s}for(s=d-1;-1!=s;s+=-1){for(l=s+1,v=f[s],o=l;o<d;o++)c[s][o]=0;if(0!=v){for(y=c[s][s]*v,o=l;o<d;o++){for(x=0,a=l;a<u;a++)x+=c[a][s]*c[a][o];for(_=x/y,a=s;a<u;a++)c[a][o]+=_*c[a][s]}for(o=s;o<u;o++)c[o][s]=c[o][s]/v}else for(o=s;o<u;o++)c[o][s]=0;c[s][s]+=1}for(n*=b,a=d-1;-1!=a;a+=-1)for(var E=0;E<50;E++){var C=!1;for(l=a;-1!=l;l+=-1){if(Math.abs(p[l])<=n){C=!0;break}if(Math.abs(f[l-1])<=n)break}if(!C){r=0,x=1;var S=l-1;for(s=l;s<a+1&&(_=x*p[s],p[s]=r*p[s],!(Math.abs(_)<=n));s++)for(y=g(_,v=f[s]),f[s]=y,r=v/y,x=-_/y,o=0;o<u;o++)A=c[o][S],w=c[o][s],c[o][S]=A*r+w*x,c[o][s]=-A*x+w*r}if(w=f[a],l==a){if(w<0)for(f[a]=-w,o=0;o<d;o++)m[o][a]=-m[o][a];break}if(E>=49)throw"Error: no convergence.";for(b=f[l],v=g(_=(((A=f[a-1])-w)*(A+w)+((v=p[a-1])-(y=p[a]))*(v+y))/(2*y*A),1),_=_<0?((b-w)*(b+w)+y*(A/(_-v)-y))/b:((b-w)*(b+w)+y*(A/(_+v)-y))/b,r=1,x=1,s=l+1;s<a+1;s++){for(v=p[s],A=f[s],y=x*v,v*=r,w=g(_,y),p[s-1]=w,_=b*(r=_/w)+v*(x=y/w),v=-b*x+v*r,y=A*x,A*=r,o=0;o<d;o++)b=m[o][s-1],w=m[o][s],m[o][s-1]=b*r+w*x,m[o][s]=-b*x+w*r;for(w=g(_,y),f[s-1]=w,_=(r=_/w)*v+(x=y/w)*A,b=-x*v+r*A,o=0;o<u;o++)A=c[o][s-1],w=c[o][s],c[o][s-1]=A*r+w*x,c[o][s]=-A*x+w*r}p[l]=0,p[a]=_,f[a]=b}for(s=0;s<f.length;s++)f[s]<n&&(f[s]=0);for(s=0;s<d;s++)for(o=s-1;o>=0;o--)if(f[o]<f[s]){for(r=f[o],f[o]=f[s],f[s]=r,a=0;a<c.length;a++)t=c[a][s],c[a][s]=c[a][o],c[a][o]=t;for(a=0;a<m.length;a++)t=m[a][s],m[a][s]=m[a][o],m[a][o]=t;s=o}return{U:c,S:f,V:m}}(e);console.log(t);var n=t.U;return t.S.map((function(e,t){var i={};return i.eigenvalue=e,i.vector=n.map((function(e,n){return-1*e[t]})),i}))}function r(t,...n){var i=n.map((function(e){return e.vector})),r=a(i,d(e(t))),s=c(a(u(t.length),t),-1/t.length);return{adjustedData:r,formattedAdjustedData:o(r,2),avgData:s,selectedVectors:i}}function s(r){return i(n(t(e(r)),!1))}function o(e,t){var n=Math.pow(10,t||2);return e.map((function(e,t){return e.map((function(e){return Math.round(e*n)/n}))}))}function a(e,t){if(!(e[0]&&t[0]&&e.length&&t.length))throw new Error("Both A and B should be matrices");if(t.length!==e[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var n=[],i=0;i<e.length;i++){n[i]=[];for(var r=0;r<t[0].length;r++)for(var s=0;s<e[0].length;s++)n[i][r]=n[i][r]?n[i][r]+e[i][s]*t[s][r]:e[i][s]*t[s][r]}return n}function l(e,t){if(e.length!==t.length||e[0].length!==t[0].length)throw new Error("Both A and B should have the same dimensions");for(var n=[],i=0;i<e.length;i++){n[i]=[];for(var r=0;r<t[0].length;r++)n[i][r]=e[i][r]-t[i][r]}return n}function c(e,t){for(var n=[],i=0;i<e.length;i++){n[i]=[];for(var r=0;r<e[0].length;r++)n[i][r]=e[i][r]*t}return n}function u(e){for(var t=[],n=0;n<e;n++){t[n]=[];for(var i=0;i<e;i++)t[n][i]=1}return t}function d(e){return h(e)[0].map((function(t,n){return e.map((function(e){return e[n]}))}))}function h(e){var t=JSON.stringify(e);return JSON.parse(t)}return{computeDeviationScores:t,computeDeviationMatrix:e,computeSVD:i,computePercentageExplained:function(e,...t){var n=e.map((function(e){return e.eigenvalue})).reduce((function(e,t){return e+t}));return t.map((function(e){return e.eigenvalue})).reduce((function(e,t){return e+t}))/n},computeOriginalData:function(e,t,n){var i=l(d(a(d(t),e)),n);return{originalData:i,formattedOriginalData:o(i,2)}},computeVarianceCovariance:n,computeAdjustedData:r,getEigenVectors:s,analyseTopResult:function(e){var t=s(e).sort((function(e,t){return t.eigenvalue-e.eigenvalue}));return console.log("Sorted Vectors",t),r(e,t[0].vector)},transpose:d,multiply:a,clone:h,scale:c}}();e.exports=t},701:function(e){var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=s[c]||0,d="".concat(c," ").concat(u);s[c]=u+1;var h=n(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var f=r(p,i);i.byIndex=a,t.splice(a,0,{identifier:d,updater:f,references:1})}o.push(d)}return o}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var s=i(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var l=i(e,r),c=0;c<s.length;c++){var u=n(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},182:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},850:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},236:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/",i+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," *"),i+="/"),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},213:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1:function(e){self,e.exports=function(){var e={820:function(e,t,n){var i=n(537),r=n.n(i),s=n(645),o=n.n(s)()(r());o.push([e.id,".treejs {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.treejs *:after,\n.treejs *:before {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.treejs > .treejs-node {\n  padding-left: 0;\n}\n.treejs .treejs-nodes {\n  list-style: none;\n  padding-left: 18px;\n  margin: 0;\n  overflow: hidden;\n  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;\n  -o-transition: height 150ms ease-out, opacity 150ms ease-out;\n  transition: height 150ms ease-out, opacity 150ms ease-out;\n}\n.treejs .treejs-node {\n  cursor: pointer;\n  overflow: hidden;\n}\n.treejs .treejs-node.treejs-placeholder {\n  padding-left: 18px;\n}\n.treejs .treejs-switcher {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n  -webkit-transition: -webkit-transform 150ms ease-out;\n  transition: -webkit-transform 150ms ease-out;\n  -o-transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;\n}\n.treejs .treejs-switcher:before {\n  position: absolute;\n  top: 8px;\n  left: 6px;\n  display: block;\n  content: ' ';\n  border: 4px solid transparent;\n  border-top: 4px solid rgba(245, 245, 245, 0.7);\n  -webkit-transition: border-color 150ms;\n  -o-transition: border-color 150ms;\n  transition: border-color 150ms;\n}\n.treejs .treejs-switcher:hover:before {\n  border-top: 4px solid rgba(245, 245, 245, 0.96);\n}\n.treejs .treejs-node__close > .treejs-switcher {\n  -webkit-transform: rotate(-90deg);\n      -ms-transform: rotate(-90deg);\n          transform: rotate(-90deg);\n}\n.treejs .treejs-node__close > .treejs-nodes {\n  height: 0;\n}\n.treejs .treejs-checkbox {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n}\n.treejs .treejs-checkbox:before {\n  -webkit-transition: all 0.3s;\n  -o-transition: all 0.3s;\n  transition: all 0.3s;\n  cursor: pointer;\n  position: absolute;\n  top: 2px;\n  content: ' ';\n  display: block;\n  width: 16px;\n  height: 16px;\n  border: 1px solid #d9d9d9;\n  border-radius: 2px;\n}\n.treejs .treejs-checkbox:hover:before {\n  -webkit-box-shadow: 0 0 2px 1px #1890ff;\n          box-shadow: 0 0 2px 1px #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 4px;\n  left: 5px;\n  width: 5px;\n  height: 9px;\n  border: 2px solid #fff;\n  border-top: none;\n  border-left: none;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 9px;\n  left: 3px;\n  width: 10px;\n  height: 2px;\n  background-color: #fff;\n}\n.treejs .treejs-node__disabled {\n  cursor: not-allowed;\n  color: rgba(255, 255, 255, 0.25);\n}\n.treejs .treejs-node__disabled .treejs-checkbox {\n  cursor: not-allowed;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:before {\n  cursor: not-allowed;\n  border-color: #d9d9d9 !important;\n  background-color: #f5f5f5 !important;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:hover:before {\n  -webkit-box-shadow: none !important;\n          box-shadow: none !important;\n}\n.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-label {\n  vertical-align: middle;\n}\n","",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:["@color-disable: #d4d4d4;\n@bgcolor-disable: #f5f5f5;\n@greyborder: #d9d9d9;\n@bluebg: #1890ff;\n\n.treejs {\n  box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  user-select: none;\n\n  *:after,\n  *:before {\n    box-sizing: border-box;\n  }\n\n  & > .treejs-node {\n    padding-left: 0;\n  }\n\n  .treejs-nodes {\n    list-style: none;\n    padding-left: 18px;\n    margin: 0; //  for default ul...\n    overflow: hidden;\n    transition: height 150ms ease-out, opacity 150ms ease-out;\n  }\n\n  .treejs-node {\n    cursor: pointer;\n    overflow: hidden;\n\n    &.treejs-placeholder {\n      padding-left: 18px;\n    }\n  }\n\n  .treejs-switcher {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n    transition: transform 150ms ease-out;\n\n    &:before {\n      position: absolute;\n      top: 8px;\n      left: 6px;\n      display: block;\n      content: ' ';\n      border: 4px solid transparent;\n      border-top: 4px solid rgba(245, 245, 245, 0.7);\n      transition: border-color 150ms;\n    }\n    &:hover:before {\n      border-top: 4px solid rgba(245, 245, 245, 0.96);\n    }\n  }\n  .treejs-node__close > .treejs-switcher {\n    transform: rotate(-90deg);\n  }\n  .treejs-node__close > .treejs-nodes {\n    height: 0;\n  }\n\n  .treejs-checkbox {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n\n    &:before {\n      transition: all 0.3s;\n      cursor: pointer;\n      position: absolute;\n      top: 2px;\n      content: ' ';\n      display: block;\n      width: 16px;\n      height: 16px;\n      border: 1px solid @greyborder;\n      border-radius: 2px;\n    }\n    &:hover:before {\n      box-shadow: 0 0 2px 1px @bluebg;\n    }\n  }\n  .treejs-node__checked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 4px;\n        left: 5px;\n        width: 5px;\n        height: 9px;\n        border: 2px solid #fff;\n        border-top: none;\n        border-left: none;\n        transform: rotate(45deg);\n      }\n    }\n  }\n  .treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 9px;\n        left: 3px;\n        width: 10px;\n        height: 2px;\n        background-color: #fff;\n      }\n    }\n  }\n\n  .treejs-node__disabled {\n    cursor: not-allowed;\n    color: rgba(255, 255, 255, 0.25);\n    .treejs-checkbox {\n      cursor: not-allowed;\n      &:before {\n        cursor: not-allowed;\n        border-color: @greyborder !important;\n        background-color: @bgcolor-disable !important;\n      }\n      &:hover:before {\n        box-shadow: none !important;\n      }\n    }\n    .treejs-node__checked {\n      & > .treejs-checkbox {\n        &:after {\n          border-color: @greyborder;\n        }\n      }\n    }\n    .treejs-node__halfchecked {\n      & > .treejs-checkbox {\n        &:after {\n          background-color: @greyborder;\n        }\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__checked {\n    & > .treejs-checkbox {\n      &:after {\n        border-color: @greyborder;\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:after {\n        background-color: @greyborder;\n      }\n    }\n  }\n\n  .treejs-label {\n    vertical-align: middle;\n  }\n}\n"],sourceRoot:""}]),t.Z=o},645:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},537:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),s="/*# ".concat(r," */"),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(o).concat([s]).join("\n")}return[t].join("\n")}},379:function(e){var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=s[c]||0,d="".concat(c," ").concat(u);s[c]=u+1;var h=n(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var f=r(p,i);i.byIndex=a,t.splice(a,0,{identifier:d,updater:f,references:1})}o.push(d)}return o}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var s=i(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var l=i(e,r),c=0;c<s.length;c++){var u=n(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},216:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},636:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/",i+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," *"),i+="/"),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={id:i,exports:{}};return e[i](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.nc=void 0;var i={};return function(){n.d(i,{default:function(){return T}});var e=n(379),t=n.n(e),r=n(795),s=n.n(r),o=n(636),a=n.n(o),l=n(216),c=n.n(l),u=n(589),d=n.n(u),h=n(820),p={};h.Z&&h.Z.locals&&(p.locals=h.Z.locals);var f,m=0,g={};g.styleTagTransform=d(),g.setAttributes=a(),g.insert=function(e,t){(t.target||document.head).appendChild(e)},g.domAPI=s(),g.insertStyleElement=c(),p.use=function(e){return g.options=e||{},m++||(f=t()(h.Z,g)),p},p.unuse=function(){m>0&&! --m&&(f(),f=null)};var _=p;function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,s=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function E(e){var t={};return e.reduce((function(e,n){return t[n]||(t[n]=!0,e.push(n)),e}),[])}function C(e,t){requestAnimationFrame((function(){t.enter(),requestAnimationFrame((function(){t.active(),setTimeout((function(){t.leave()}),e)}))}))}function S(e,t){try{var n=e.liElementsById[t.parent.id];n.classList.contains("treejs-node__close")||n.getElementsByClassName("treejs-switcher")[0].click()}catch(e){return}Object.prototype.hasOwnProperty.call(t,"parent")&&S(e,t.parent)}function M(e,t){var n=e.liElementsById[t.id];n.classList.contains("treejs-node__close")&&n.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(t,"children")&&t.children.forEach((function(t){return M(e,t)}))}var T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_.use({target:"string"==typeof this.container?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=t,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},n),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(e){this.setValues(E(e))}},disables:{get:function(){return this.getDisables()},set:function(e){this.setDisables(E(e))}},selectedNodes:{get:function(){var e=[],t=this.nodesById;return Object.keys(t).forEach((function(n){if(Object.prototype.hasOwnProperty.call(t,n)&&(1===t[n].status||2===t[n].status)){var i=A({},t[n]);delete i.parent,delete i.children,e.push(i)}})),e}},disabledNodes:{get:function(){var e=[],t=this.nodesById;return Object.keys(t).forEach((function(n){if(Object.prototype.hasOwnProperty.call(t,n)&&t[n].disabled){var i=A({},t[n]);delete i.parent,e.push(i)}})),e}}}),this.init(this.options.data)}var t,n,i;return t=e,i=[{key:"onSwitcherClick",value:function(e){var t=e.parentNode,n=t.lastChild,i=n.scrollHeight;t.classList.contains("treejs-node__close")?C(150,{enter:function(){n.style.height=0,n.style.opacity=0},active:function(){n.style.height="".concat(i,"px"),n.style.opacity=1},leave:function(){n.style.height="",n.style.opacity="",t.classList.remove("treejs-node__close")}}):C(150,{enter:function(){n.style.height="".concat(i,"px"),n.style.opacity=1},active:function(){n.style.height=0,n.style.opacity=0},leave:function(){n.style.height="",n.style.opacity="",t.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(e){var t,n=(t=e,JSON.parse(JSON.stringify(t))),i={},r={},s=[],o=[];return function e(t,n){t.forEach((function(t){i[t.id]=t,t.checked&&s.push(t.id),t.disabled&&o.push(t.id),n&&(t.parent=n),t.children&&t.children.length?e(t.children,t):r[t.id]=t}))}(n),{treeNodes:n,nodesById:i,leafNodesById:r,defaultValues:s,defaultDisables:o}}},{key:"createRootEle",value:function(){var e=document.createElement("div");return e.classList.add("treejs"),e}},{key:"createUlEle",value:function(){var e=document.createElement("ul");return e.classList.add("treejs-nodes"),e}},{key:"createLiEle",value:function(e,t){var n=document.createElement("li");if(n.classList.add("treejs-node"),t&&n.classList.add("treejs-node__close"),e.children&&e.children.length){var i=document.createElement("span");i.classList.add("treejs-switcher"),n.appendChild(i)}else n.classList.add("treejs-placeholder");var r=document.createElement("span");r.classList.add("treejs-checkbox"),n.appendChild(r);var s=document.createElement("span");s.classList.add("treejs-label");var o=document.createTextNode(e.text);return s.appendChild(o),n.appendChild(s),n.nodeId=e.id,n}}],(n=[{key:"init",value:function(t){var n=e.parseTreeData(t),i=n.treeNodes,r=n.nodesById,s=n.leafNodesById,o=n.defaultValues,a=n.defaultDisables;this.treeNodes=i,this.nodesById=r,this.leafNodesById=s,this.render(this.treeNodes);var l=this.options,c=l.values,u=l.disables,d=l.loaded;c&&c.length?this.setValues(c):o&&o.length&&this.setValues(o),u&&u.length?this.setDisables(u):a&&a.length&&this.setDisables(a),"function"==typeof d&&d.call(this)}},{key:"render",value:function(t){var n=e.createRootEle();n.appendChild(this.buildTree(t,0)),this.bindEvent(n);var i="string"==typeof this.container?document.querySelector(this.container):this.container;!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(i),i.appendChild(n)}},{key:"buildTree",value:function(t,n){var i=this,r=e.createUlEle();return t&&t.length&&t.forEach((function(t){var s=e.createLiEle(t,n===i.options.closeDepth-1);i.liElementsById[t.id]=s;var o=null;t.children&&t.children.length&&(o=i.buildTree(t.children,n+1)),o&&s.appendChild(o),r.appendChild(s)})),r}},{key:"bindEvent",value:function(t){var n=this;t.addEventListener("click",(function(t){var i=t.target;"SPAN"===i.nodeName&&i.classList.contains("treejs-checkbox")?n.onItemClick(i.parentNode.nodeId):"SPAN"===i.nodeName&&i.classList.contains("treejs-label")?n.onItemLabelClick(i.parentNode.nodeId):"LI"===i.nodeName&&i.classList.contains("treejs-node")?n.onItemClick(i.nodeId):"SPAN"===i.nodeName&&i.classList.contains("treejs-switcher")&&e.onSwitcherClick(i)}),!1)}},{key:"onItemClick",value:function(e){var t=this.nodesById[e],n=this.options.onChange;t.disabled||(this.setValue(e),this.updateLiElements()),n&&n.call(this)}},{key:"onItemLabelClick",value:function(e){var t=this.options.onItemLabelClick;t&&t.call(this,e)}},{key:"setValue",value:function(e){var t=this.nodesById[e];if(t){var n=t.status,i=1===n||2===n?0:2;t.status=i,this.markWillUpdateNode(t),this.walkUp(t,"status"),this.walkDown(t,"status")}}},{key:"getValues",value:function(){var e=this,t=[];return Object.keys(this.leafNodesById).forEach((function(n){Object.prototype.hasOwnProperty.call(e.leafNodesById,n)&&(1!==e.leafNodesById[n].status&&2!==e.leafNodesById[n].status||t.push(n))})),t}},{key:"setValues",value:function(e){var t=this;this.emptyNodesCheckStatus(),e.forEach((function(e){t.setValue(e)})),this.updateLiElements();var n=this.options.onChange;n&&n.call(this)}},{key:"setDisable",value:function(e){var t=this.nodesById[e];t&&(t.disabled||(t.disabled=!0,this.markWillUpdateNode(t),this.walkUp(t,"disabled"),this.walkDown(t,"disabled")))}},{key:"getDisables",value:function(){var e=this,t=[];return Object.keys(this.leafNodesById).forEach((function(n){Object.prototype.hasOwnProperty.call(e.leafNodesById,n)&&e.leafNodesById[n].disabled&&t.push(n)})),t}},{key:"setDisables",value:function(e){var t=this;this.emptyNodesDisable(),e.forEach((function(e){t.setDisable(e)})),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach((function(e){e.disabled||(e.status=0)}))}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach((function(e){e.disabled=!1}))}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce((function(e,t){var n=v(t,2),i=n[0],r=n[1];return 1!==r.status&&2!==r.status||(e[i]=r),e}),{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce((function(e,t){var n=v(t,2),i=n[0],r=n[1];return r.disabled&&(e[i]=r),e}),{})}},{key:"updateLiElements",value:function(){var e=this;Object.values(this.willUpdateNodesById).forEach((function(t){e.updateLiElement(t)})),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(e){this.willUpdateNodesById[e.id]=e}},{key:"walkUp",value:function(e,t){var n=e.parent;if(n){if("status"===t){var i,r=n.children.reduce((function(e,t){return Number.isNaN(t.status)?e:e+t.status}),0);if(i=r?r===2*n.children.length?2:1:0,n.status===i)return;n.status=i}else{var s=n.children.reduce((function(e,t){return e&&t.disabled}),!0);if(n.disabled===s)return;n.disabled=s}this.markWillUpdateNode(n),this.walkUp(n,t)}}},{key:"walkDown",value:function(e,t){var n=this;e.children&&e.children.length&&e.children.forEach((function(i){"status"===t&&i.disabled||(i[t]=e[t],n.markWillUpdateNode(i),n.walkDown(i,t))}))}},{key:"updateLiElement",value:function(e){var t=this.liElementsById[e.id].classList;switch(e.status){case 0:t.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:t.remove("treejs-node__checked"),t.add("treejs-node__halfchecked");break;case 2:t.remove("treejs-node__halfchecked"),t.add("treejs-node__checked")}switch(e.disabled){case!0:t.contains("treejs-node__disabled")||t.add("treejs-node__disabled");break;case!1:t.contains("treejs-node__disabled")&&t.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var e=this;Object.keys(this.leafNodesById).forEach((function(t){var n=e.leafNodesById[t];S(e,n)}))}},{key:"expandAll",value:function(){M(this,this.treeNodes[0])}}])&&x(t.prototype,n),i&&x(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()}(),i.default}()},8:function(e,t){!function(e){class t{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const n=this._eventListeners;void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t)}hasEventListener(e,t){const n=this._eventListeners;return void 0!==n[e]&&n[e].includes(t)}removeEventListener(e,t){const n=this._eventListeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){const t=this._eventListeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e)}}}function n(){return("undefined"==typeof performance?Date:performance).now()}class i{constructor(e=i.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(i.MIN_DECAY_MILLISECONDS,e)}update(e,t,n,i){const r=2e-4*this.naturalFrequency;if(null==e||0===i)return t;if(e===t&&0===this.velocity)return t;if(n<0)return e;const s=e-t,o=this.velocity+this.naturalFrequency*s,a=s+n*o,l=Math.exp(-this.naturalFrequency*n),c=(o-this.naturalFrequency*a)*l,u=-this.naturalFrequency*(c+o*l);return Math.abs(c)<r*Math.abs(i)&&u*s>=0?(this.velocity=0,t):(this.velocity=c,t+a*l)}}async function r(e){return new Promise(((t,n)=>{const i=new Image;i.onload=()=>t(i),i.onerror=n,i.crossOrigin="anonymous",i.decoding="sync",i.src=e}))}function s(e,t=document.head){const n=document.createElement("style");return n.type="text/css",n.innerText=e,null==t||t.appendChild(n),n}i.SETTLING_TIME=1e4,i.MIN_DECAY_MILLISECONDS=.001,i.DECAY_MILLISECONDS=50;const o={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function a(e){return e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function l(e,t,n){return e.replace(new RegExp(a(t),"g"),n)}const c=(e,...t)=>String.raw({raw:e},...t),u=(e,...t)=>{let n=String.raw({raw:e},...t);return n=l(n,"%","%25"),n=l(n,"> <","><"),n=l(n,"; }",";}"),n=l(n,"<","%3c"),n=l(n,">","%3e"),n=l(n,'"',"'"),n=l(n,"#","%23"),n=l(n,"{","%7b"),n=l(n,"}","%7d"),n=l(n,"|","%7c"),n=l(n,"^","%5e"),n=l(n,"`","%60"),n=l(n,"@","%40"),n=l(n,"&","&amp;"),n=l(n,"\n","%0A"),"data:image/svg+xml;charset=UTF-8,"+n};function d(e,t){const n=window.URL.createObjectURL(e),i=document.createElement("a");i.style.display="none",i.href=n,i.download=t,document.body.appendChild(i),i.click(),setTimeout((()=>{document.body.removeChild(i),window.URL.revokeObjectURL(n)}),1e3)}async function h(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=e=>t(i.result),i.onerror=e=>n(i.error),i.onabort=e=>n(new Error("Read aborted")),i.readAsDataURL(e)}))}function p(e,t){let n;do{n=Object.getOwnPropertyDescriptor(e,t)}while(!n&&(e=Object.getPrototypeOf(e)));return n}function f(e,t,n=!0,i=!1){const r=p(e,t);return!!(null==r?void 0:r.set)||n&&!1!==(null==r?void 0:r.writable)&&void 0===(null==r?void 0:r.get)||i&&!r}function m(e,t,n,i=!0,r=!1){return!(!e||!f(e,t,i,r)||(e[t]=n,0))}function g(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}const _={priority:1/0,serialize:(e,t)=>Object.fromEntries(Object.entries(e).map((([e,n])=>[e,v.Serialize(n,t,!1)]))),deserialize:(e,t,n)=>Object.assign(t||{},Object.fromEntries(Object.entries(e).map((([e,i])=>[e,v.Deserialize(i,null==t?void 0:t[e],n,!1)])))),isType:e=>(e.constructor||Object)===Object};class v{static GetSerializer(e){return v.Serializers.find((t=>t.isType(e)))}static RegisterSerializer(...e){var t;for(const n of e){const e=null!==(t=n.priority)&&void 0!==t?t:1e10,i=g(v.Serializers,(t=>void 0!==t.priority&&t.priority<e));i>=0?v.Serializers.splice(i+1,0,n):v.Serializers.push(n)}}static UnregisterSerializer(...e){for(const t of e){const e=v.Serializers.indexOf(t);e>=0&&v.Serializers.splice(e,1)}}static Serialize(e,t,n=!1){var i,r;if("function"==typeof e)return;if(!n){const n=v.GetSerializer(e);if(n)return n.serialize(e,t);if("function"==typeof e.toJSON){const n=e.toJSON(t);return e.serializableClassId&&n&&(n.serializableClassId=e.serializableClassId),n}}let s=null!==(i=e.constructor)&&void 0!==i?i:Object;const o={};for(;s&&s!==Object;){const n=null!==(r=v.TypeMap.get(s))&&void 0!==r?r:[];for(const[i,r]of n)o[i]=v.Serialize(e[r],t,!1);s=Object.getPrototypeOf(s)}return e.serializableClassId&&(o.serializableClassId=e.serializableClassId),o}static Deserialize(e,t,n,i=!1){var r,s;if(void 0===e)return t;if(t===e)return t;if(e&&"object"==typeof e&&(e.constructor||Object)===Object&&e.resource&&"string"==typeof e.resource&&e.uuid){const i=null==n?void 0:n[e.resource];if(!i)return console.warn(`Resource ${e.resource} not found`),t;if("object"==typeof(e=i[e.uuid])&&(e.__useCount=e.__useCount?e.__useCount+1:1),e||console.warn(`Resource ${e.resource} with uuid ${e.uuid} not found`),t===e)return t;if(e&&"object"==typeof e){if((e.constructor||Object)!==Object)return t?(console.warn("replacing object",t,"with deserialized object from meta",e),e):e;console.error("Deserialize; meta should only have class instances, not js objects",e,t,n)}}if(e&&"object"==typeof e&&(e.constructor||Object)!==Object&&!Array.isArray(e)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",e,"source",t,e.constructor,e.constructor!==Object),e&&"object"==typeof e)if(!e.serializableClassId||t&&t.serializableClassId===e.serializableClassId)(e.constructor||Object)!==Object||t?Array.isArray(e)&&!t&&(t=[]):t={};else{const n=v.SerializableClasses.get(e.serializableClassId);n&&(t=n.DataInConstructor?new n(e):new n)}if("function"==typeof t)return console.error("cannot deserialize over function",t,e),t;if(!i){const i=v.GetSerializer(e);if(i&&i!==_)return i.deserialize(e,t,n)}if(!e||null==t||"object"!=typeof t)return e;if(!i&&"function"==typeof(null==t?void 0:t.fromJSON))return t.fromJSON(e,n),t;let o=null!==(r=t.constructor)&&void 0!==r?r:Object;if(o===Object)return _.deserialize(e,t,n);for(;o&&o!==Object;){const i=null!==(s=v.TypeMap.get(o))&&void 0!==s?s:[];for(const[r,s]of i){const i=t[s],o=v.Deserialize(e[r],i,n,!1);o!==i&&m(t,s,o,!0)}o=Object.getPrototypeOf(o)}return t}}function y(e,t="param"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(n,i)=>{Object.defineProperty(n,i,{get(){return this[`_oc_${i}`]},set(n){var r;const s=this[`_oc_${i}`];if(s===n)return;this[`_oc_${i}`]=n;const o="param"===t?[i,n,s]:"object"===t?[{key:i,value:n,oldValue:s}]:"";if("string"==typeof e)null===(r=this[e])||void 0===r||r.call(this,...o);else if("function"==typeof e){let t=!1;if(e.name){let n=this;for(;n;){if(n[e.name]===e){e.call(this,...o),t=!0;break}n=Object.getPrototypeOf(n)}}t||(e.name&&this[e.name].name===`bound ${e.name}`?this[e.name](...o):e(...o))}}})}}function b(e,{backgroundColor:t="",scale:n=1,width:i=512,height:r=512}){const s=document.createElement("canvas"),o=s.getContext("2d"),a=n,l=i,c=r;return s.width=l*a,s.height=c*a,s.style.width=`${l}`,s.style.height=`${c}`,(null==t?void 0:t.length)>0&&(o.fillStyle=t,o.fillRect(0,0,s.width,s.height)),o.drawImage(e,0,0,s.width,s.height),s}v.TypeMap=new Map,v.SerializableClasses=new Map,v.Serializers=[{priority:0,isType:e=>Array.isArray(e),serialize:(e,t)=>e.map((e=>v.Serialize(e,t,!1))),deserialize:(e,t,n)=>{const i=e.length;Array.isArray(t)||(t=[]);for(let r=0;r<i;r++){const i=e[r],s=t.length>r?v.Deserialize(i,t[r],n,!1):v.Deserialize(i,void 0,n,!1);t.length<=r?t.push(s):t[r]=s}return t}},{priority:0,isType:e=>!e||"object"!=typeof e,serialize:e=>{if(e&&"number"==typeof e){if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN"}return e},deserialize:(e,t)=>{if("number"==typeof t){if("Infinity"===e)return 1/0;if("-Infinity"===e)return-1/0;if("NaN"===e)return NaN;if("number"==typeof e||!e)return e}return e}},_];const A=async(e,t)=>b(await r(e),t),w=async(e,t)=>await A(e,t).then((e=>e.toDataURL("image/png"))),x=async e=>h(await(await fetch(e)).blob());function E(e,t,{width:n,height:i},r=!0){const s=`\n<svg viewBox="0 0 ${n} ${i}" xmlns="http://www.w3.org/2000/svg">\n    <style>\n    ${t}\n    </style>\n    <foreignObject x="0" y="0" width="100%" height="100%">\n        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">\n            ${e}\n        </div>\n    </foreignObject>\n</svg>\n    `;return r?u(s):s}e.Damper=i,e.LinearToSRGB=function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055},e.PointerDragHelper=class extends t{constructor(){super(...arguments),this._onPointerDown=e=>{if(0!==e.button)return;if(!this._element)return;this._pointerUp=void 0;const t=e.clientX/this._element.clientWidth*2-1,i=-e.clientY/this._element.clientHeight*2+1,r=n();this._pointerDown={x:t,y:i,time:r},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=e=>{if(!this._pointerDown||!this._pointer)return;if(!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-e.clientY/this._element.clientHeight*2+1,r=n();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:t-this._pointerDown.x,y:i-this._pointerDown.y,time:r-this._pointerDown.time},delta:{x:t-this._pointer.x,y:i-this._pointer.y,time:r-this._pointer.time}}),this._pointer={x:t,y:i,time:n()},e.buttons%2==0&&this._onPointerUp(e)},this._onPointerUp=e=>{if(0!==e.button)return;if(!this._pointerDown)return;if(!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-e.clientY/this._element.clientHeight*2+1,r=n();this._pointerUp={x:t,y:i,time:r},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(e){this._element!==e&&(this._element&&this._removeElement(),this._element=e,this._element&&this._addElement())}_removeElement(){var e,t,n,i,r;null===(e=this._element)||void 0===e||e.removeEventListener("pointerdown",this._onPointerDown),null===(t=this._element)||void 0===t||t.removeEventListener("pointermove",this._onPointerMove),null===(n=this._element)||void 0===n||n.removeEventListener("pointerup",this._onPointerUp),null===(i=this._element)||void 0===i||i.removeEventListener("pointercancel",this._onPointerUp),null===(r=this._element)||void 0===r||r.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var e,t,n,i,r;null===(e=this._element)||void 0===e||e.addEventListener("pointerdown",this._onPointerDown),null===(t=this._element)||void 0===t||t.addEventListener("pointermove",this._onPointerMove),null===(n=this._element)||void 0===n||n.addEventListener("pointerup",this._onPointerUp),null===(i=this._element)||void 0===i||i.addEventListener("pointercancel",this._onPointerUp),null===(r=this._element)||void 0===r||r.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},e.SRGBToLinear=function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)},e.Serialization=v,e.SimpleEventDispatcher=t,e.TYPED_ARRAYS=o,e.absMax=function(e,t){return Math.abs(e)>Math.abs(t)?e:t},e.aesGcmDecrypt=async function(e,t){const n="string"==typeof t?(new TextEncoder).encode(t):t,i=await crypto.subtle.digest("SHA-256",n),r=e.slice(0,12),s={name:"AES-GCM",iv:"string"==typeof r?new Uint8Array(Array.from(r).map((e=>e.charCodeAt(0)))):r},o=await crypto.subtle.importKey("raw",i,s,!1,["decrypt"]),a=e.slice(12),l="string"==typeof a?new Uint8Array(Array.from(a).map((e=>e.charCodeAt(0)))):a;try{const t=await crypto.subtle.decrypt(s,o,l);return"string"==typeof e?(new TextDecoder).decode(t):new Uint8Array(t)}catch(e){throw new Error("Decrypt failed")}},e.aesGcmEncrypt=async function(e,t,n){const i="string"==typeof t?(new TextEncoder).encode(t):t,r=await crypto.subtle.digest("SHA-256",i),s=crypto.getRandomValues(new Uint8Array(12)),o=Array.from(s).map((e=>String.fromCharCode(e))).join(""),a={name:"AES-GCM",iv:s},l=await crypto.subtle.importKey("raw",r,a,!1,["encrypt"]),c="string"==typeof e?(new TextEncoder).encode(e):e,u=await crypto.subtle.encrypt(a,l,c),d=new Uint8Array(u),h=Array.from(d),p=h.map((e=>String.fromCharCode(e))).join(""),f=n?"string"==typeof n?n:(new TextDecoder).decode(n):"",m=n?"string"==typeof n?(new TextEncoder).encode(n):Array.from(n):[];return"string"==typeof e?f+o+p:new Uint8Array([...m,...s,...h])},e.arrayBufferToBase64=function(e){if(!window)return console.warn("window is required"),"";let t="";const n=new Uint8Array(e),i=n.byteLength;for(let r=0;r<i;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)},e.base64ToArrayBuffer=function(e){if(!window)return console.warn("window is required"),new Uint8Array(0);const t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=t.charCodeAt(r);return i.buffer},e.blobToDataURL=h,e.canvasFlipY=function(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");if(!n)throw new Error("Unable to get 2d context");return n.translate(0,e.height),n.scale(1,-1),n.drawImage(e,0,0),t},e.clearBit=function(e,t){return e&~(1<<t)},e.colorToDataUrl=function(e,t=1,n=1){const i=document.createElement("canvas");i.width=t,i.height=n;const r=i.getContext("2d");r.fillStyle="#"+e,r.fillRect(0,0,t,n);const s=i.toDataURL();return i.remove(),s},e.copyProps=function(e,t,n){for(const i of n){const n=e[i];void 0!==n&&m(t,i,n,!0)}return t},e.createCanvasElement=function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e},e.createDiv=function({innerHTML:e="",id:t,classList:n,addToBody:i=!0,elementTag:r="div"}){const s=document.createElement(r);return t&&(s.id=t),s.innerHTML=e,n&&s.classList.add(...n),i&&document.body.appendChild(s),s},e.createImage=r,e.createScriptFromURL=async function(e,t=document.head){return new Promise(((n,i)=>{const r=document.createElement("script");r.setAttribute("src",e),r.addEventListener("load",(()=>n(r))),r.addEventListener("error",i),t.appendChild(r)}))},e.createStyles=s,e.css=c,e.deepAccessObject=function(e,t,n=!1){for("string"==typeof e&&(e=e.split("."));e.length>0;){if(!t)return;const i=e.splice(0,1)[0];if(!(i.length<1)){if(!(i in t)){if(n)throw new Error("invalid access, check "+i+" in "+t);return}t=t[i]}}return t},e.downloadBlob=d,e.downloadFile=function(e,t){return d(e,null!=t?t:e.name)},e.embedUrlRefs=async function(e,t=x){const n=e.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(n)for(const i of n){const n=await t(i);e=e.replace(i,n)}return e},e.escapeRegExp=a,e.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then((e=>e[0])):window.chooseFileSystemEntries()},e.getFilenameFromPath=function(e){return e.substring(e.lastIndexOf("/")+1)},e.getKeyByValue=function(e,t){return Object.keys(e).find((n=>e[n]===t))},e.getNewFileHandle=function(){if("showSaveFilePicker"in window){const e={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(e)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},e.getOrCall=function(e,...t){return"function"==typeof e&&(e=e(...t)),e},e.getPropertyDescriptor=p,e.getTypedArray=function(e,t){return new o[e](t)},e.getUrlQueryParam=function(e,t=null){var n;return null!==(n=new URL(window.location.href).searchParams.get(e))&&void 0!==n?n:t},e.glsl=(e,...t)=>String.raw({raw:e},...t),e.html=(e,...t)=>String.raw({raw:e},...t),e.htmlToCanvas=async function(e,t,n){const i=E(e,t,n);return await A(i,n)},e.htmlToPng=async function(e,t,n){const i=E(e,t,n);return await w(i,n)},e.htmlToSvg=E,e.imageBitmapToBase64=function(e,t=8192,n=!1){var i;if(!e.width||!e.height)return"";const r=document.createElement("canvas");r.width=Math.min(t,e.width),r.height=Math.floor(1+r.width*e.height/e.width);const s=e instanceof ImageBitmap,o=s&&n&&Math.abs(r.width-e.width)<.5?r.getContext("bitmaprenderer"):void 0;o?o.transferFromImageBitmap(e):null===(i=r.getContext("2d"))||void 0===i||i.drawImage(e,0,0,r.width,r.height);const a=r.toDataURL("image/png");return r.remove(),s&&n&&e.close(),a},e.imageDataToCanvas=function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t},e.imageToCanvas=b,e.imageUrlToImageData=async function(e){return new Promise(((t,n)=>{const i=new Image;i.addEventListener("load",(()=>{const e=document.createElement("canvas");e.width=i.width,e.height=i.height;const r=e.getContext("2d");if(!r)return void n(new Error("Could not get 2d context"));r.drawImage(i,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height);t(s),e.remove(),i.remove()}),!1),i.addEventListener("error",(e=>{i.remove(),n(e)}),!1),i.src=e}))},e.includesAll=function(e,t){for(const n of t)if(!e.includes(n))return!1;return!0},e.isPropertyWritable=f,e.isWebpExportSupported=function(){const e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&e.toDataURL("image/webp").startsWith("data:image/webp")},e.longestCommonPrefix=function(e){return e.sort(),e[0].split("").map(((t,n)=>e[e.length-1][n]===t?t:"\0")).join("").split("\0").at(0)||""},e.makeColorSvg=e=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${e}'/%3E%3C/svg%3E%0A`,e.makeColorSvgCircle=e=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${e}'/%3E%3C/svg%3E%0A`,e.makeTextSvg=e=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${e}%3C/text%3E%3C/svg%3E%0A`,e.mobileAndTabletCheck=function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},e.now=n,e.objectHasOwn=function(e,t){return Object.hasOwn?Object.hasOwn(e,t):e.hasOwnProperty(t)},e.onChange=y,e.onChange2=function(e,t="void"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return y(e,t)},e.onChange3=function(e,t="object"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return y(e,t)},e.parseFileExtension=function(e){var t;if(!e||""===e||e.match(/__MACOSX\/.*\._/))return"";const n=null!==(t=(e=e.replace(/\?.*$/,"")).split(/[\\/]/).pop())&&void 0!==t?t:"",i=n.lastIndexOf(".");return""===n||i<1?"":n.slice(i+1)},e.pathJoin=function(e,t="/"){return e.join(t)},e.prettyScrollbar=function(e=document.head){return s(c`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,e)},e.readFile=function(e){return e.text?e.text():function(e){return new Promise((t=>{const n=new FileReader;n.addEventListener("loadend",(e=>{const n=e.srcElement.result;t(n)})),n.readAsText(e)}))}(e)},e.remoteWorkerURL=function(e,t){const n=(t?`var Module = { locateFile: function(s) { return "${t}"; } }; \n`:"")+`importScripts( "${e}" );`;return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))},e.replaceAll=l,e.safeSetProperty=m,e.serializable=function(e){return t=>(t=class extends t{constructor(){super(...arguments),this.serializableClassId=e}},v.SerializableClasses.set(e,t),t)},e.serialize=function(e){return(t,n)=>{const i=t.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");v.TypeMap.has(i)||v.TypeMap.set(i,[]),v.TypeMap.get(i).push([e||n,n])}},e.setUrlQueryParam=function(e,t,n=!1){const i=new URLSearchParams(location.search);null==t?i.has(e)&&i.delete(e):i.set(e,t),n?window.location.search=i.toString():window.history.replaceState({},"","?"+i.toString())},e.svgToCanvas=A,e.svgToPng=w,e.svgUrl=u,e.timeout=async function(e){return new Promise((t=>setTimeout(t,Math.max(0,e))))},e.toTitleCase=function(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))},e.updateBit=function(e,t,n){return e&~(1<<t)|(n?1:0)<<t},e.uploadFile=async function(e=!1,t=!1,n){const i=document.createElement("input");i.type="file",i.multiple=e,i.accept=n||"*",i.webkitdirectory=t,i.style.display="none",document.body.appendChild(i),i.click();const r=await new Promise((e=>{i.onchange=t=>{e(Array.from(i.files||[]))}}));return document.body.removeChild(i),r},e.verifyPermission=async function(e,t){const n={};return t&&(n.writable=!0,n.mode="readwrite"),"granted"===await e.queryPermission(n)||"granted"===await e.requestPermission(n)},e.writeFile=async function(e,t){if(e.createWriter){const n=await e.createWriter();return await n.write(0,t),void await n.close()}const n=await e.createWritable();await n.write(t),await n.close()}}(t)},819:function(e,t){!function(e){const t="tp";function n(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const i=e(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function i(e){return{custom:t=>n(t)(e),boolean:n((e=>"boolean"==typeof e?e:void 0))(e),number:n((e=>"number"==typeof e?e:void 0))(e),string:n((e=>"string"==typeof e?e:void 0))(e),function:n((e=>"function"==typeof e?e:void 0))(e),constant:t=>n((e=>e===t?t:void 0))(e),raw:n((e=>e))(e),object:t=>n((e=>{if(null!==(n=e)&&"object"==typeof n)return function(e,t){return Object.keys(t).reduce(((n,i)=>{if(void 0===n)return;const r=(0,t[i])(e[i]);return r.succeeded?Object.assign(Object.assign({},n),{[i]:r.value}):void 0}),{})}(e,t);var n}))(e),array:t=>n((e=>{if(Array.isArray(e))return n=t,e.reduce(((e,t)=>{if(void 0===e)return;const i=n(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0}),[]);var n}))(e)}}const r={optional:i(!0),required:i(!1)};function s(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}function o(e){return[e[0],e[1],e[2]]}function a(e){return t=>function(e,t){const n=s("float"===t?2:0);return`rgb(${o(e.getComponents("rgb",t)).map((e=>n(e))).join(", ")})`}(t,e)}function l(e){return t=>function(e,t){const n=s(2),i=s("float"===t?2:0);return`rgba(${e.getComponents("rgb",t).map(((e,t)=>(3===t?n:i)(e))).join(", ")})`}(t,e)}function c(e){return t=>function(e,t){const n=s("float"===t?2:0),i=["r","g","b"];return`{${o(e.getComponents("rgb",t)).map(((e,t)=>`${i[t]}: ${n(e)}`)).join(", ")}}`}(t,e)}function u(e){return t=>function(e,t){const n=s(2),i=s("float"===t?2:0),r=["r","g","b","a"];return`{${e.getComponents("rgb",t).map(((e,t)=>`${r[t]}: ${(3===t?n:i)(e)}`)).join(", ")}}`}(t,e)}function d(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}function h(e){return d(this,void 0,void 0,(function*(){const t=new Image;return t.crossOrigin="anonymous",new Promise(((n,i)=>{t.src=e,t.onload=()=>{n(t)},t.onerror=i}))}))}s(0),["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:a(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:l(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:c(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:u(t)}]),[]);const p=(f="img",(e,n)=>[t,"-",f,"v",e?`_${e}`:"",n?`-${n}`:""].join(""));var f;class m{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(p()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(p("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.image_=e.createElement("img"),this.image_.classList.add(p("image")),this.image_.classList.add(p(`image_${t.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=e=>{t.clickCallback?t.clickCallback(e,this.input):this.input.click()},this.element.classList.add(p("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?null==t||t.classList.add(p("area_dragging")):null==t||t.classList.remove(p("area_dragging"))}}let g=null;class _{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new m(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit,clickCallback:t.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose((()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)})),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(e){const t=(null==e?void 0:e.target).files;if(!t||!t.length)return;const n=t[0];this.setValue(n)}onDrop(e){return d(this,void 0,void 0,(function*(){e.preventDefault();try{const{dataTransfer:t}=e,n=null==t?void 0:t.files[0];if(n)this.setValue(n);else{const e=null==t?void 0:t.getData("url");if(!e)throw new Error("No url");this.setValue(e)}}catch(e){console.error("Could not parse the dropped image",e)}finally{this.view.changeDraggingState(!1)}}))}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){return d(this,void 0,void 0,(function*(){e instanceof HTMLImageElement?this.updateImage(e.src):"string"!=typeof e&&e?yield this.setValue(e):("placeholder"!==e&&e||(e=(yield this.handlePlaceholderImage()).src),this.updateImage(e))}))}updateImage(e){this.view.changeImage(e)}setValue(e){return d(this,void 0,void 0,(function*(){if(e instanceof HTMLImageElement)this.value.setRawValue(e);else if(e instanceof File){const t=URL.createObjectURL(e)+"#"+e.name;e.src=t;const n=yield h(t).catch((()=>{}));this.value.setRawValue(n||e)}else e?this.value.setRawValue(yield h(e)):this.value.setRawValue(yield this.handlePlaceholderImage())}))}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return d(this,void 0,void 0,(function*(){return g||(g=yield function(){const e=document.createElement("canvas");e.width=320,e.height=50;const t=e.getContext("2d");return t.fillStyle="#00000004",t.fillRect(0,0,e.width,e.height),t.fillStyle="#eee",t.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',t.textAlign="center",t.textBaseline="middle",t.fillText("No image",.5*e.width,.5*e.height),new Promise((t=>{e.toBlob((e=>{const n=new Image;n.src=URL.createObjectURL(e),n.isPlaceholder=!0,n.onload=()=>{t(n)}}))}))}()),g}))}}const v=[".jpg",".png",".gif"],y={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(e,t){if(!(e instanceof HTMLImageElement||"string"==typeof e))return null;const n=r,i=function(e,t){const n=r.required.object(t)(e);return n.succeeded?n.value:void 0}(t,{view:n.required.constant("input-image"),acceptUrl:n.optional.boolean,clickCallback:n.optional.function,imageFit:n.optional.custom((e=>"contain"===e||"cover"===e?e:void 0)),extensions:n.optional.array(n.required.string)});return i?{initialValue:e,params:i}:null},binding:{reader(e){return e=>void 0!==e.src?""===e.src?"placeholder":e.src:e},writer(e){return(e,t)=>{e.write(t)}}},controller(e){var t,n;return new _(e.document,{value:e.value,imageFit:null!==(t=e.params.imageFit)&&void 0!==t?t:"cover",clickCallback:e.params.clickCallback,viewProps:e.viewProps,extensions:null!==(n=e.params.extensions)&&void 0!==n?n:v})}};e.plugin=y,Object.defineProperty(e,"__esModule",{value:!0})}(t)},665:function(e,t){!function(e){class t{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class n{constructor(e){this.target=e}}class i extends n{constructor(e,t,n,i){super(e),this.value=t,this.presetKey=n,this.last=null==i||i}}class r extends n{constructor(e,t,n){super(e),this.value=t,this.presetKey=n}}class s extends n{constructor(e,t){super(e),this.expanded=t}}class o extends n{constructor(e,t){super(e),this.index=t}}function a(e){return null==e}function l(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function c(e,t){let n=e;do{const e=Object.getOwnPropertyDescriptor(n,t);if(e&&(void 0!==e.set||!0===e.writable))return!0;n=Object.getPrototypeOf(n)}while(null!==n);return!1}const u={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class d{static alreadyDisposed(){return new d({type:"alreadydisposed"})}static notBindable(){return new d({type:"notbindable"})}static propertyNotFound(e){return new d({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new d({type:"shouldneverhappen"})}constructor(e){var t;this.message=null!==(t=u[e.type](e.context))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}}class h{constructor(e,t,n){this.obj_=e,this.key_=t,this.presetKey_=null!=n?n:t}static isBindable(e){return null!==e&&"object"==typeof e}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const n=this.read();if(!h.isBindable(n))throw d.notBindable();if(!(e in n))throw d.propertyNotFound(e);n[e]=t}}class p extends t{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return null!==(e=this.controller_.valueController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller_.valueController.emitter.on(e,(()=>{i(new n(this))})),this}}class f{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter((e=>e.handler!==t))),this}emit(e,t){const n=this.observers_[e];n&&n.forEach((e=>{e.handler(t)}))}}const m="tp";function g(e){return(t,n)=>[m,"-",e,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}function _(e){return e.rawValue}function v(e,t){var n,i;e.emitter.on("change",(n=_,i=t,e=>i(n(e)))),t(e.rawValue)}function y(e,t,n){v(e.value(t),n)}function b(e,t){return n=>{!function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}(e,t,n)}}function A(e,t){v(e,(e=>{t.textContent=null!=e?e:""}))}const w=g("btn");class x{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(w()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(w("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(w("t")),A(t.props.value("title"),i),this.buttonElement.appendChild(i)}}class E{constructor(e,t){this.emitter=new f,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new x(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class C{constructor(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:(e,t)=>e===t,this.emitter=new f,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;(!this.equals_(r,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,previousRawValue:r,rawValue:i,sender:this}))}}class S{constructor(e){this.emitter=new f,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.value_;(i!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:this.value_,sender:this}))}}function M(e,t){const n=null==t?void 0:t.constraint,i=null==t?void 0:t.equals;return n||i?new C(e,t):new S(e)}class T{constructor(e){this.emitter=new f,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}static createCore(e){return Object.keys(e).reduce(((t,n)=>Object.assign(t,{[n]:M(e[n])})),{})}static fromObject(e){const t=this.createCore(e);return new T(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function I(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const i=e(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function P(e){return{custom:t=>I(t)(e),boolean:I((e=>"boolean"==typeof e?e:void 0))(e),number:I((e=>"number"==typeof e?e:void 0))(e),string:I((e=>"string"==typeof e?e:void 0))(e),function:I((e=>"function"==typeof e?e:void 0))(e),constant:t=>I((e=>e===t?t:void 0))(e),raw:I((e=>e))(e),object:t=>I((e=>{if(null!==(n=e)&&"object"==typeof n)return function(e,t){return Object.keys(t).reduce(((n,i)=>{if(void 0===n)return;const r=(0,t[i])(e[i]);return r.succeeded?Object.assign(Object.assign({},n),{[i]:r.value}):void 0}),{})}(e,t);var n}))(e),array:t=>I((e=>{if(Array.isArray(e))return n=t,e.reduce(((e,t)=>{if(void 0===e)return;const i=n(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0}),[]);var n}))(e)}}const R={optional:P(!0),required:P(!1)};function D(e,t){const n=R.required.object(t)(e);return n.succeeded?n.value:void 0}function k(e){console.warn([`Missing '${e.key}' of ${e.target} in ${e.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class B{constructor(e){this.value_=e}static create(e){return[new B(e),(t,n)=>{e.setRawValue(t,n)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const O=g("");function L(e,t){return b(e,O(void 0,t))}class U extends T{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=B.create(M(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,i;const r=null!=e?e:{};return new U(T.createCore({disabled:null!==(t=r.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=r.hidden)&&void 0!==n&&n,parent:null!==(i=r.parent)&&void 0!==i?i:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){v(this.globalDisabled_,L(e,"disabled")),y(this,"hidden",L(e,"hidden"))}bindDisabled(e){v(this.globalDisabled_,(t=>{e.disabled=t}))}bindTabIndex(e){v(this.globalDisabled_,(t=>{e.tabIndex=t?-1:0}))}handleDispose(e){this.value("disposed").emitter.on("change",(t=>{t&&e()}))}getGlobalDisabled_(){const e=this.get("parent");return!!e&&e.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const N=g(""),F={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class j{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((e=>{t.classList.remove(N(void 0,F[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(N(void 0,F[e]))}))})),this.viewProps.handleDispose((()=>{!function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}(t)}))}get parent(){return this.parent_}set parent(e){this.parent_=e,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):k({key:"parent",target:U.name,place:"BladeController.parent"})}}const z="http://www.w3.org/2000/svg";function G(e){e.offsetHeight}function V(e){return void 0!==e.ontouchstart}function H(){return globalThis.document}const Q={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function W(e,t){const n=e.createElementNS(z,"svg");return n.innerHTML=Q[t],n}function q(e,t,n){e.insertBefore(t,e.children[n])}function X(e){e.parentElement&&e.parentElement.removeChild(e)}function Y(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function K(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}const J=g("lbl");class Z{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(J()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(J("l")),y(t.props,"label",(t=>{a(t)?this.element.classList.add(J(void 0,"nol")):(this.element.classList.remove(J(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(n),n.appendChild(function(e,t){const n=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,i)=>{i>0&&n.appendChild(e.createElement("br")),n.appendChild(t)})),n}(e,t)))})),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("div");i.classList.add(J("v")),this.element.appendChild(i),this.valueElement=i}}class $ extends j{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new Z(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const ee={id:"button",type:"blade",accept(e){const t=R,n=D(e,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return n?{params:n}:null},controller(e){return new $(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:new E(e.document,{props:T.fromObject({title:e.params.title}),viewProps:e.viewProps})})},api(e){return e.controller instanceof $&&e.controller.valueController instanceof E?new p(e.controller):null}};class te extends j{constructor(e){super(e),this.value=e.value}}function ne(){return new T({positions:M([],{equals:l})})}class ie extends T{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=T.createCore(t);return new ie(n)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!a(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};y(this,"expanded",n),y(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function re(e,t){t.style.height=e.styleHeight}function se(e,t){e.value("expanded").emitter.on("beforechange",(()=>{if(e.set("completed",!1),a(e.get("expandedHeight"))){const n=function(e,t){let n=0;return function(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),G(t),n=t.clientHeight,e.set("temporaryExpanded",null),G(t)})),n}(e,t);n>0&&e.set("expandedHeight",n)}e.set("shouldFixHeight",!0),G(t)})),e.emitter.on("change",(()=>{re(e,t)})),re(e,t),t.addEventListener("transitionend",(t=>{"height"===t.propertyName&&e.cleanUpTransition()}))}class oe extends t{constructor(e,t){super(e),this.rackApi_=t}}class ae{constructor(e){this.emitter=new f,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw d.shouldNeverHappen();const n=void 0!==t?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((e=>{this.cache_.add(e)}))),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class le extends t{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new f,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new i(this,t,this.controller_.binding.target.presetKey,e.options.last)})}}class ce extends ${constructor(e,t){super(e,t),this.binding=t.binding}}class ue extends t{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new f,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new r(this,t,this.controller_.binding.target.presetKey)})}}class de extends ${constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function he(e){return e instanceof me?e.apiSet_:e instanceof oe?e.rackApi_.apiSet_:null}function pe(e,t){const n=e.find((e=>e.controller_===t));if(!n)throw d.shouldNeverHappen();return n}function fe(e,t,n){if(!h.isBindable(e))throw d.notBindable();return new h(e,t,n)}class me extends t{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new f,this.apiSet_=new ae(he),this.pool_=t;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach((e=>{this.setUpApi_(e)}))}get children(){return this.controller_.rack.children.map((e=>pe(this.apiSet_,e)))}addInput(e,t,n){const i=null!=n?n:{},r=this.controller_.view.element.ownerDocument,s=this.pool_.createInput(r,fe(e,t,i.presetKey),i),o=new le(s);return this.add(o,i.index)}addMonitor(e,t,n){const i=null!=n?n:{},r=this.controller_.view.element.ownerDocument,s=this.pool_.createMonitor(r,fe(e,t),i),o=new ue(s);return this.add(o,i.index)}addFolder(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}(this,e)}addButton(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}(this,e)}addSeparator(e){return function(e,t){const n=null!=t?t:{};return e.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}(this,e)}addTab(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const n=this.apiSet_.find((t=>t.controller_===e.controller_));return n&&this.apiSet_.remove(n),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(t,e),i=this.pool_.createBladeApi(n);return this.add(i,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}setUpApi_(e){this.apiSet_.find((t=>t.controller_===e))||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=pe(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof ce){const n=pe(this.apiSet_,t),r=t.binding;this.emitter_.emit("change",{event:new i(n,r.target.read(),r.target.presetKey,e.options.last)})}else if(t instanceof te){const n=pe(this.apiSet_,t);this.emitter_.emit("change",{event:new i(n,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof de))throw d.shouldNeverHappen();const t=pe(this.apiSet_,e.bladeController),n=e.bladeController.binding;this.emitter_.emit("update",{event:new r(t,n.target.read(),n.target.presetKey)})}}class ge extends oe{constructor(e,t){super(e,new me(e.rackController,t)),this.emitter_=new f,this.controller_.foldable.value("expanded").emitter.on("change",(e=>{this.emitter_.emit("fold",{event:new s(this,e.sender.rawValue)})})),this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})}))}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class _e extends j{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class ve{constructor(e,t){const n=g(t.viewName);this.element=e.createElement("div"),this.element.classList.add(n()),t.viewProps.bindClassModifiers(this.element)}}function ye(e){return e instanceof we?e.rack:e instanceof _e?e.rackController.rack:null}function be(e){const t=ye(e);return t?t.bcSet_:null}class Ae{constructor(e){var t,n;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new f,this.blade_=null!==(t=e.blade)&&void 0!==t?t:null,null===(n=this.blade_)||void 0===n||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new ae(be),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;null===(n=e.parent)||void 0===n||n.remove(e),c(e,"parent")?e.parent=this:(e.parent_=this,k({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(e,t)}remove(e){c(e,"parent")?e.parent=null:(e.parent_=null,k({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter((t=>t instanceof e))}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof ce)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof de)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof te)n.value.emitter.on("change",this.onChildValueChange_);else{const e=ye(n);if(e){const t=e.emitter;t.on("layout",this.onDescendantLayout_),t.on("inputchange",this.onDescendantInputChange_),t.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const n=e.item;if(n instanceof ce)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof de)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof te)n.value.emitter.off("change",this.onChildValueChange_);else{const e=ye(n);if(e){const t=e.emitter;t.off("layout",this.onDescendantLayout_),t.off("inputchange",this.onDescendantInputChange_),t.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter((e=>!e.viewProps.get("hidden"))),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach((e=>{const i=[];e===t&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),e===n&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),e.blade.set("positions",i)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((e=>e.viewProps.get("disposed"))).forEach((e=>{this.bcSet_.remove(e)}))}onChildInputChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i instanceof ce&&i.binding===t)return i}return null}(this.find(ce),e.sender);if(!t)throw d.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i instanceof de&&i.binding===t)return i}return null}(this.find(de),e.sender);if(!t)throw d.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i instanceof te&&i.value===t)return i}return null}(this.find(te),e.sender);if(!t)throw d.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class we extends j{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new ve(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new Ae({blade:t.root?void 0:t.blade,viewProps:t.viewProps});n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose((()=>{for(let e=this.rack.children.length-1;e>=0;e--)this.rack.children[e].viewProps.set("disposed",!0)}))}onRackAdd_(e){e.isRoot&&q(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.isRoot&&X(e.bladeController.view.element)}}const xe=g("cnt");class Ee{constructor(e,t){var n;this.className_=g(null!==(n=t.viewName)&&void 0!==n?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),xe()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),y(this.foldable_,"completed",b(this.element,this.className_(void 0,"cpl")));const i=e.createElement("button");i.classList.add(this.className_("b")),y(t.props,"title",(e=>{a(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const s=e.createElement("div");s.classList.add(this.className_("t")),A(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s;const o=e.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const l=t.containerElement;l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class Ce extends _e{constructor(e,t){var n;const i=ie.create(null===(n=t.expanded)||void 0===n||n),r=new we(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:r,view:new Ee(e,{containerElement:r.view.element,foldable:i,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=i,se(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Se={id:"folder",type:"blade",accept(e){const t=R,n=D(e,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return n?{params:n}:null},controller(e){return new Ce(e.document,{blade:e.blade,expanded:e.params.expanded,props:T.fromObject({title:e.params.title}),viewProps:e.viewProps})},api(e){return e.controller instanceof Ce?new ge(e.controller,e.pool):null}};class Me extends te{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new Z(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Te extends t{}const Ie=g("spr");class Pe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ie()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(Ie("r")),this.element.appendChild(n)}}class Re extends j{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Pe(e,{viewProps:t.viewProps})}))}}const De={id:"separator",type:"blade",accept(e){const t=D(e,{view:R.required.constant("separator")});return t?{params:t}:null},controller(e){return new Re(e.document,{blade:e.blade,viewProps:e.viewProps})},api(e){return e.controller instanceof Re?new Te(e.controller):null}},ke=g("tbi");class Be{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ke()),t.viewProps.bindClassModifiers(this.element),y(t.props,"selected",(e=>{e?this.element.classList.add(ke(void 0,"sel")):this.element.classList.remove(ke(void 0,"sel"))}));const n=e.createElement("button");n.classList.add(ke("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(ke("t")),A(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class Oe{constructor(e,t){this.emitter=new f,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Be(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Le{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Oe(e,{props:t.itemProps,viewProps:U.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new we(e,{blade:ne(),viewProps:U.create()}),this.props=t.props,y(this.props,"selected",(e=>{this.itemController.props.set("selected",e),this.contentController.viewProps.set("hidden",!e)}))}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ue{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return null!==(e=this.controller_.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class Ne extends oe{constructor(e,t){super(e,new me(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new f,this.pageApiMap_=new Map,this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})})),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((e=>{this.setUpPageApi_(e)}))}get pages(){return this.controller_.pageSet.items.map((e=>{const t=this.pageApiMap_.get(e);if(!t)throw d.shouldNeverHappen();return t}))}addPage(e){const t=this.controller_.view.element.ownerDocument,n=new Le(t,{itemProps:T.fromObject({selected:!1,title:e.title}),props:T.fromObject({selected:!1})});this.controller_.add(n,e.index);const i=this.pageApiMap_.get(n);if(!i)throw d.shouldNeverHappen();return i}removePage(e){this.controller_.remove(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find((t=>t.controller_===e.contentController));if(!t)throw d.shouldNeverHappen();const n=new Ue(e,t);this.pageApiMap_.set(e,n)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw d.shouldNeverHappen();this.pageApiMap_.delete(e.item)}onSelect_(e){this.emitter_.emit("select",{event:new o(this,e.rawValue)})}}class Fe{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=M(!0),this.selectedIndex=M(-1),this.items_=[]}add(e,t){const n=null!=t?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const e=this.items_.findIndex((e=>e.rawValue));e<0?(this.items_.forEach(((e,t)=>{e.rawValue=0===t})),this.selectedIndex.rawValue=0):(this.items_.forEach(((t,n)=>{t.rawValue=n===e})),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex((t=>t===e.sender));this.items_.forEach(((e,n)=>{e.rawValue=n===t})),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const je=g("tab");class ze{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(je(),xe()),t.viewProps.bindClassModifiers(this.element),v(t.empty,b(this.element,je(void 0,"nop")));const n=e.createElement("div");n.classList.add(je("t")),this.element.appendChild(n),this.itemsElement=n;const i=e.createElement("div");i.classList.add(je("i")),this.element.appendChild(i);const r=t.contentsElement;r.classList.add(je("c")),this.element.appendChild(r),this.contentsElement=r}}class Ge extends _e{constructor(e,t){const n=new we(e,{blade:t.blade,viewProps:t.viewProps}),i=new Fe;super({blade:t.blade,rackController:n,view:new ze(e,{contentsElement:n.view.element,empty:i.empty,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new ae((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=i}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}onPageAdd_(e){const t=e.item;q(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(t.contentController,e.index),this.tab.add(t.props.value("selected"))}onPageRemove_(e){const t=e.item;X(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.rackController.rack.remove(t.contentController),this.tab.remove(t.props.value("selected"))}}const Ve={id:"tab",type:"blade",accept(e){const t=R,n=D(e,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller(e){const t=new Ge(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach((n=>{const i=new Le(e.document,{itemProps:T.fromObject({selected:!1,title:n.title}),props:T.fromObject({selected:!1})});t.add(i)})),t},api(e){return e.controller instanceof Ge?new Ne(e.controller,e.pool):null}};class He{constructor(){this.disabled=!1,this.emitter=new f}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Qe{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new f,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class We{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new f,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function qe(e,t){for(;e.length<t;)e.push(void 0)}function Xe(e){const t=[];return qe(t,e),M(t)}function Ye(e){const t=e.indexOf(void 0);return t<0?e:e.slice(0,t)}class Ke{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new f,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(void 0===e)return;const t=this.value.rawValue,n=this.reader_(e);this.value.rawValue=function(e,t){const n=[...Ye(e),t];return n.length>e.length?n.splice(0,n.length-e.length):qe(n,e.length),n}(t,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(e){this.read()}}class Je{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function Ze(e,t){if(e instanceof t)return e;if(e instanceof Je){const n=e.constraints.reduce(((e,n)=>e||(n instanceof t?n:null)),null);if(n)return n}return null}class $e{constructor(e){this.values=T.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class et{constructor(e){this.values=T.fromObject({options:e})}get options(){return this.values.get("options")}constrain(e){const t=this.values.get("options");return 0===t.length||t.filter((t=>t.value===e)).length>0?e:t[0].value}}class tt{constructor(e){this.values=T.fromObject({max:e.max,min:e.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let i=e;return a(n)||(i=Math.max(i,n)),a(t)||(i=Math.min(i,t)),i}}class nt{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step;return t+Math.round((e-t)/this.step)*this.step}}const it=g("lst");class rt{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(it()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(it("s")),y(this.props_,"options",(t=>{Y(n),t.forEach(((t,i)=>{const r=e.createElement("option");r.dataset.index=String(i),r.textContent=t.text,r.value=String(t.value),n.appendChild(r)}))})),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=e.createElement("div");i.classList.add(it("m")),i.appendChild(W(e,"dropdown")),this.element.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class st{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new rt(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget.selectedOptions.item(0);if(!t)return;const n=Number(t.dataset.index);this.value.rawValue=this.props.get("options")[n].value}}const ot=g("pop");class at{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ot()),t.viewProps.bindClassModifiers(this.element),v(t.shows,b(this.element,ot(void 0,"v")))}}class lt{constructor(e,t){this.shows=M(!1),this.viewProps=t.viewProps,this.view=new at(e,{shows:this.shows,viewProps:this.viewProps})}}const ct=g("txt");class ut{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ct()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(ct("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class dt{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new ut(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);a(n)||(this.value.rawValue=n),this.view.refresh()}}function ht(e){return"false"!==e&&!!e}function pt(e){return function(e){return String(e)}(e)}class ft{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const mt={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class gt{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=mt[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const _t={"+":e=>e,"-":e=>-e,"~":e=>~e};class vt{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=_t[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function yt(e){return(t,n)=>{for(let i=0;i<e.length;i++){const r=e[i](t,n);if(""!==r)return r}return""}}function bt(e,t){var n;const i=e.substr(t).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function At(e,t){var n;const i=e.substr(t).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function wt(e,t){const n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";const i=function(e,t){const n=At(e,t);if(""!==n)return n;const i=e.substr(t,1);if("-"!==i&&"+"!==i)return"";const r=At(e,t+=1);return""===r?"":i+r}(e,t);return""===i?"":n+i}function xt(e,t){const n=e.substr(t,1);if("0"===n)return n;const i=function(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}(e,t);return t+=i.length,""===i?"":i+At(e,t)}const Et=yt([function(e,t){const n=xt(e,t);if(t+=n.length,""===n)return"";const i=e.substr(t,1);if(t+=i.length,"."!==i)return"";const r=At(e,t);return n+i+r+wt(e,t+=r.length)},function(e,t){const n=e.substr(t,1);if(t+=n.length,"."!==n)return"";const i=At(e,t);return t+=i.length,""===i?"":n+i+wt(e,t)},function(e,t){const n=xt(e,t);return t+=n.length,""===n?"":n+wt(e,t)}]),Ct=yt([function(e,t){const n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i}]),St=yt([Ct,Et]);function Mt(e,t){var n;return null!==(n=function(e,t){const n=St(e,t);return t+=n.length,""===n?null:{evaluable:new ft(n),cursor:t}}(e,t))&&void 0!==n?n:function(e,t){const n=e.substr(t,1);if(t+=n.length,"("!==n)return null;const i=Pt(e,t);if(!i)return null;t=i.cursor,t+=bt(e,t).length;const r=e.substr(t,1);return t+=r.length,")"!==r?null:{evaluable:i.evaluable,cursor:t}}(e,t)}function Tt(e,t,n){n+=bt(t,n).length;const i=e.filter((e=>t.startsWith(e,n)))[0];return i?(n+=i.length,{cursor:n+=bt(t,n).length,operator:i}):null}const It=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>function(e,t){return(n,i)=>{const r=e(n,i);if(!r)return null;i=r.cursor;let s=r.evaluable;for(;;){const r=Tt(t,n,i);if(!r)break;i=r.cursor;const o=e(n,i);if(!o)return null;i=o.cursor,s=new gt(r.operator,s,o.evaluable)}return s?{cursor:i,evaluable:s}:null}}(e,t)),(function e(t,n){const i=Mt(t,n);if(i)return i;const r=t.substr(n,1);if(n+=r.length,"+"!==r&&"-"!==r&&"~"!==r)return null;const s=e(t,n);return s?{cursor:n=s.cursor,evaluable:new vt(r,s.evaluable)}:null}));function Pt(e,t){return t+=bt(e,t).length,It(e,t)}function Rt(e){var t;const n=function(e){const t=Pt(e,0);return t?t.cursor+bt(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function Dt(e){if("number"==typeof e)return e;if("string"==typeof e){const t=Rt(e);if(!a(t))return t}return 0}function kt(e){return String(e)}function Bt(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}const Ot=Bt(0);function Lt(e){return Ot(e)+"%"}function Ut(e){return String(e)}function Nt(e){return e}function Ft({primary:e,secondary:t,forward:n,backward:i}){let r=!1;function s(e){r||(r=!0,e(),r=!1)}e.emitter.on("change",(i=>{s((()=>{t.setRawValue(n(e,t),i.options)}))})),t.emitter.on("change",(r=>{s((()=>{e.setRawValue(i(e,t),r.options)})),s((()=>{t.setRawValue(n(e,t),r.options)}))})),s((()=>{t.setRawValue(n(e,t),{forceEmit:!1,last:!0})}))}function jt(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function zt(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function Gt(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function Vt(e){return function(e){return"ArrowUp"===e||"ArrowDown"===e}(e)||"ArrowLeft"===e||"ArrowRight"===e}function Ht(e,t){var n,i;const r=t.ownerDocument.defaultView,s=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=r&&r.scrollX)&&void 0!==n?n:0)+s.left),y:e.pageY-((null!==(i=r&&r.scrollY)&&void 0!==i?i:0)+s.top)}}class Qt{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new f,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Ht(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Ht(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Ht(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Wt(e,t,n,i,r){return i+(e-t)/(n-t)*(r-i)}function qt(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Xt(e,t,n){return Math.min(Math.max(e,t),n)}function Yt(e,t){return(e%t+t)%t}const Kt=g("txt");class Jt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Kt(),Kt(void 0,"num")),t.arrayPosition&&this.element.classList.add(Kt(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Kt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Kt()),this.inputElement.classList.add(Kt("i"));const i=e.createElement("div");i.classList.add(Kt("k")),this.element.appendChild(i),this.knobElement=i;const r=e.createElementNS(z,"svg");r.classList.add(Kt("g")),this.knobElement.appendChild(r);const s=e.createElementNS(z,"path");s.classList.add(Kt("gb")),r.appendChild(s),this.guideBodyElem_=s;const o=e.createElementNS(z,"path");o.classList.add(Kt("gh")),r.appendChild(o),this.guideHeadElem_=o;const a=e.createElement("div");a.classList.add(g("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(Kt(void 0,"drg"));this.element.classList.add(Kt(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:t<0?1:0),i=Xt(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Zt{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.sliderProps_=null!==(n=t.sliderProps)&&void 0!==n?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=M(null),this.view=new Jt(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new Qt(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const i=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("minValue"),r=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("maxValue");let s=e;return void 0!==i&&(s=Math.max(s,i)),void 0!==r&&(s=Math.min(s,r)),s}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);a(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=jt(this.baseStep_,zt(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==jt(this.baseStep_,zt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("draggingScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const $t=g("sld");class en{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add($t()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add($t("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=e.createElement("div");i.classList.add($t("k")),this.trackElement.appendChild(i),this.knobElement=i,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Xt(Wt(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class tn{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new en(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Wt(Xt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=jt(this.baseStep_,Gt(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==jt(this.baseStep_,Gt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const nn=g("sldtxt");class rn{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nn());const n=e.createElement("div");n.classList.add(nn("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(nn("t")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class sn{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new tn(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Zt(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new rn(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function on(e,t){e.write(t)}function an(e){const t=R;return Array.isArray(e)?t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(e).value:"object"==typeof e?t.required.raw(e).value:void 0}function ln(e){if("inline"===e||"popup"===e)return e}function cn(e){const t=R;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(e).value}function un(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach((n=>{t.push({text:n,value:e[n]})})),t}function dn(e){return a(e)?null:new et(un(e))}function hn(e,t){const n=e&&Ze(e,nt);return n?qt(n.step):Math.max(qt(t),2)}function pn(e){const t=function(e){const t=e?Ze(e,nt):null;return t?t.step:null}(e);return null!=t?t:1}function fn(e,t){var n;const i=e&&Ze(e,nt),r=Math.abs(null!==(n=null==i?void 0:i.step)&&void 0!==n?n:t);return 0===r?.1:Math.pow(10,Math.floor(Math.log10(r))-1)}const mn=g("ckb");class gn{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(mn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(mn("l")),this.element.appendChild(n);const i=e.createElement("input");i.classList.add(mn("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(mn("w")),n.appendChild(r);const s=W(e,"check");r.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class _n{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new gn(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}const vn={id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=D(t,{options:R.optional.custom(an)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>ht,constraint:e=>function(e){const t=[],n=dn(e.options);return n&&t.push(n),new Je(t)}(e.params),writer:e=>on},controller:e=>{const t=e.document,n=e.value,i=e.constraint,r=i&&Ze(i,et);return r?new st(t,{props:new T({options:r.values.value("options")}),value:n,viewProps:e.viewProps}):new _n(t,{value:n,viewProps:e.viewProps})}},yn=g("col");class bn{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(yn()),t.foldable.bindExpandedClass(this.element,yn(void 0,"expanded")),y(t.foldable,"completed",b(this.element,yn(void 0,"cpl")));const n=e.createElement("div");n.classList.add(yn("h")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(yn("s")),n.appendChild(i),this.swatchElement=i;const r=e.createElement("div");if(r.classList.add(yn("t")),n.appendChild(r),this.textElement=r,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(yn("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function An(e,t,n){const i=Yt(e,360),r=Xt(t/100,0,1),s=Xt(n/100,0,1),o=s*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o;let c,u,d;return[c,u,d]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(d+l)]}function wn(e){return[e[0],e[1],e[2]]}function xn(e,t){return[e[0],e[1],e[2],t]}const En={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:function(e,t,n){const i=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==i?t*(100-Math.abs(2*n-100))/i:0,n+t*(100-Math.abs(2*n-100))/200]},rgb:function(e,t,n){const i=(e%360+360)%360,r=Xt(t/100,0,1),s=Xt(n/100,0,1),o=(1-Math.abs(2*s-1))*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o/2;let c,u,d;return[c,u,d]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(d+l)]}},hsv:{hsl:function(e,t,n){const i=100-Math.abs(n*(200-t)/100-100);return[e,0!==i?t*n/i:0,n*(200-t)/200]},hsv:(e,t,n)=>[e,t,n],rgb:An},rgb:{hsl:function(e,t,n){const i=Xt(e/255,0,1),r=Xt(t/255,0,1),s=Xt(n/255,0,1),o=Math.max(i,r,s),a=Math.min(i,r,s),l=o-a;let c=0,u=0;const d=(a+o)/2;return 0!==l&&(u=l/(1-Math.abs(o+a-1)),c=i===o?(r-s)/l:r===o?2+(s-i)/l:4+(i-r)/l,c=c/6+(c<0?1:0)),[360*c,100*u,100*d]},hsv:function(e,t,n){const i=Xt(e/255,0,1),r=Xt(t/255,0,1),s=Xt(n/255,0,1),o=Math.max(i,r,s),a=o-Math.min(i,r,s);let l;return l=0===a?0:o===i?((r-s)/a%6+6)%6*60:o===r?60*((s-i)/a+2):60*((i-r)/a+4),[l,100*(0===o?0:a/o),100*o]},rgb:(e,t,n)=>[e,t,n]}};function Cn(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function Sn(e,t,n,i){const r=Cn(t,n),s=Cn(t,i);return e.map(((e,t)=>e/r[t]*s[t]))}function Mn(e,t){return"object"==typeof e&&!a(e)&&t in e&&"number"==typeof e[t]}class Tn{static black(e="int"){return new Tn([0,0,0],"rgb",e)}static fromObject(e,t="int"){const n="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new Tn(n,"rgb",t)}static toRgbaObject(e,t="int"){return e.toRgbaObject(t)}static isRgbColorObject(e){return Mn(e,"r")&&Mn(e,"g")&&Mn(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&Mn(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode!==t.mode)return!1;const n=e.comps_,i=t.comps_;for(let r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}constructor(e,t,n="int"){this.mode=t,this.type=n,this.comps_=function(e,t,n){var i;const r=Cn(t,n);return["rgb"===t?Xt(e[0],0,r[0]):(s=e[0],o=r[0],s===o?o:Yt(s,o)),Xt(e[1],0,r[1]),Xt(e[2],0,r[2]),Xt(null!==(i=e[3])&&void 0!==i?i:1,0,1)];var s,o}(e,t,n)}getComponents(e,t="int"){return xn(function(e,t,n){const i=Sn(e,t.mode,t.type,"int");return Sn(En[t.mode][n.mode](...i),n.mode,"int",n.type)}(wn(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:t}),this.comps_[3])}toRgbaObject(e="int"){const t=this.getComponents("rgb",e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const In=g("colp");class Pn{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(In()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(In("hsv"));const i=e.createElement("div");i.classList.add(In("sv")),this.svPaletteView_=t.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const r=e.createElement("div");r.classList.add(In("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),n.appendChild(r),this.element.appendChild(n);const s=e.createElement("div");if(s.classList.add(In("rgb")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const n=e.createElement("div");n.classList.add(In("a"));const i=e.createElement("div");i.classList.add(In("ap")),i.appendChild(this.alphaViews_.palette.element),n.appendChild(i);const r=e.createElement("div");r.classList.add(In("at")),r.appendChild(this.alphaViews_.text.element),n.appendChild(r),this.element.appendChild(n)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((e=>e.inputElement))];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Rn(e){return"int"===e?"int":"float"===e?"float":void 0}function Dn(e){const t=R;return D(e,{alpha:t.optional.boolean,color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Rn)}),expanded:t.optional.boolean,picker:t.optional.custom(ln)})}function kn(e){return e?.1:1}function Bn(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}function On(e,t){const n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}const Ln={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function Un(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]),i=t[2];return Ln[i](n)}function Nn(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[On(t[1],255),On(t[2],255),On(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Fn(e){return t=>{const n=Nn(t);return n?new Tn(n,"rgb",e):null}}function jn(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[On(t[1],255),On(t[2],255),On(t[3],255),On(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function zn(e){return t=>{const n=jn(t);return n?new Tn(n,"rgb",e):null}}function Gn(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Un(t[1]),On(t[2],100),On(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Vn(e){return t=>{const n=Gn(t);return n?new Tn(n,"hsl",e):null}}function Hn(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Un(t[1]),On(t[2],100),On(t[3],100),On(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Qn(e){return t=>{const n=Hn(t);return n?new Tn(n,"hsl",e):null}}function Wn(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function qn(e){const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Wt(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Wt(parseInt(n[4],16),0,255,0,1)]:null}function Xn(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Yn(e){return t=>{const n=Xn(t);return n?new Tn(n,"rgb",e):null}}function Kn(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Jn(e){return t=>{const n=Kn(t);return n?new Tn(n,"rgb",e):null}}const Zn=[{parser:Wn,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:qn,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Nn,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:jn,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Gn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Hn,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Xn,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Kn,result:{alpha:!0,mode:"rgb",notation:"object"}}];function $n(e,t="int"){const n=function(e){return Zn.reduce(((t,{parser:n,result:i})=>t||(n(e)?i:null)),null)}(e);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}const ei={int:[function(e){const t=Wn(e);return t?new Tn(t,"rgb","int"):null},function(e){const t=qn(e);return t?new Tn(t,"rgb","int"):null},Fn("int"),zn("int"),Vn("int"),Qn("int"),Yn("int"),Jn("int")],float:[Fn("float"),zn("float"),Vn("float"),Qn("float"),Yn("float"),Jn("float")]};function ti(e){const t=ei[e];return e=>t.reduce(((t,n)=>t||n(e)),null)}function ni(e){const t=Xt(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function ii(e,t="#"){return`${t}${wn(e.getComponents("rgb")).map(ni).join("")}`}function ri(e,t="#"){const n=e.getComponents("rgb");return`${t}${[n[0],n[1],n[2],255*n[3]].map(ni).join("")}`}function si(e,t){const n=Bt("float"===t?2:0);return`rgb(${wn(e.getComponents("rgb",t)).map((e=>n(e))).join(", ")})`}function oi(e){return t=>si(t,e)}function ai(e,t){const n=Bt(2),i=Bt("float"===t?2:0);return`rgba(${e.getComponents("rgb",t).map(((e,t)=>(3===t?n:i)(e))).join(", ")})`}function li(e){return t=>ai(t,e)}function ci(e,t){const n=Bt("float"===t?2:0),i=["r","g","b"];return`{${wn(e.getComponents("rgb",t)).map(((e,t)=>`${i[t]}: ${n(e)}`)).join(", ")}}`}function ui(e){return t=>ci(t,e)}function di(e,t){const n=Bt(2),i=Bt("float"===t?2:0),r=["r","g","b","a"];return`{${e.getComponents("rgb",t).map(((e,t)=>`${r[t]}: ${(3===t?n:i)(e)}`)).join(", ")}}`}function hi(e){return t=>di(t,e)}const pi=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:ii},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ri},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[Bt(0),Lt,Lt];return`hsl(${wn(e.getComponents("hsl")).map(((e,n)=>t[n](e))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[Bt(0),Lt,Lt,Bt(2)];return`hsla(${e.getComponents("hsl").map(((e,n)=>t[n](e))).join(", ")})`}},...["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:oi(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:li(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:ui(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:hi(t)}]),[])];function fi(e){return pi.reduce(((t,n)=>{return t||(i=n.format,r=e,i.alpha===r.alpha&&i.mode===r.mode&&i.notation===r.notation&&i.type===r.type?n.stringifier:null);var i,r}),null)}const mi=g("apl");class gi{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(mi()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(mi("b")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(mi("c")),n.appendChild(i),this.colorElem_=i;const r=e.createElement("div");r.classList.add(mi("m")),this.element.appendChild(r),this.markerElem_=r;const s=e.createElement("div");s.classList.add(mi("p")),this.markerElem_.appendChild(s),this.previewElem_=s,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new Tn([t[0],t[1],t[2],0],"rgb"),i=new Tn([t[0],t[1],t[2],255],"rgb"),r=["to right",ai(n),ai(i)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=ai(e);const s=Wt(t[3],0,1,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class _i{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new gi(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,i=this.value.rawValue,[r,s,o]=i.getComponents("hsv");this.value.setRawValue(new Tn([r,s,o,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=jt(kn(!0),Gt(e));if(0===t)return;const n=this.value.rawValue,[i,r,s,o]=n.getComponents("hsv");this.value.setRawValue(new Tn([i,r,s,o+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==jt(kn(!0),Gt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const vi=g("coltxt");class yi{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(vi("m")),this.modeElem_=function(e){const t=e.createElement("select");return t.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce(((t,n)=>{const i=e.createElement("option");return i.textContent=n.text,i.value=n.value,t.appendChild(i),t}),e.createDocumentFragment())),t}(e),this.modeElem_.classList.add(vi("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const i=e.createElement("div");i.classList.add(vi("mm")),i.appendChild(W(e,"dropdown")),n.appendChild(i),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(vi("w")),this.element.appendChild(r),this.textsElem_=r,this.textViews_=t.textViews,this.applyTextViews_(),v(t.colorMode,(e=>{this.modeElem_.value=e}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){Y(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach((t=>{const n=e.createElement("div");n.classList.add(vi("c")),n.appendChild(t.element),this.textsElem_.appendChild(n)}))}}function bi(e,t,n){const i=Cn(e,t)[n];return new $e({min:0,max:i})}function Ai(e,t,n){return new Zt(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:kn(!1),parser:t.parser,props:T.fromObject({draggingScale:"float"===t.colorType?.01:1,formatter:(i=t.colorType,Bt("float"===i?2:0))}),value:M(0,{constraint:bi(t.colorMode,t.colorType,n)}),viewProps:t.viewProps});var i}class wi{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=M(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new yi(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},n=[Ai(e,t,0),Ai(e,t,1),Ai(e,t,2)];return n.forEach(((e,t)=>{Ft({primary:this.value,secondary:e.value,forward:e=>e.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[t],backward:(e,n)=>{const i=this.colorMode.rawValue,r=e.rawValue.getComponents(i,this.colorType_);return r[t]=n.rawValue,new Tn(xn(wn(r),r[3]),i,this.colorType_)}})})),n}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const xi=g("hpl");class Ei{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(xi()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(xi("c")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(xi("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=si(new Tn([t,100,100],"hsv"));const n=Wt(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class Ci{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Ei(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Wt(Xt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),i=this.value.rawValue,[,r,s,o]=i.getComponents("hsv");this.value.setRawValue(new Tn([n,r,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=jt(kn(!1),Gt(e));if(0===t)return;const n=this.value.rawValue,[i,r,s,o]=n.getComponents("hsv");this.value.setRawValue(new Tn([i+t,r,s,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==jt(kn(!1),Gt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Si=g("svp");class Mi{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Si()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=64,n.width=64,n.classList.add(Si("c")),this.element.appendChild(n),this.canvasElement=n;const i=e.createElement("div");i.classList.add(Si("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=function(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,r=e.getImageData(0,0,n,i),s=r.data;for(let l=0;l<i;l++)for(let e=0;e<n;e++){const r=Wt(e,0,n,0,100),o=Wt(l,0,i,100,0),a=An(t[0],r,o),c=4*(l*n+e);s[c]=a[0],s[c+1]=a[1],s[c+2]=a[2],s[c+3]=255}e.putImageData(r,0,0);const o=Wt(t[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=Wt(t[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Ti{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Mi(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Wt(e.point.x,0,e.bounds.width,0,100),i=Wt(e.point.y,0,e.bounds.height,100,0),[r,,,s]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Tn([r,n,i,s],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Vt(e.key)&&e.preventDefault();const[t,n,i,r]=this.value.rawValue.getComponents("hsv"),s=kn(!1),o=jt(s,Gt(e)),a=jt(s,zt(e));0===o&&0===a||this.value.setRawValue(new Tn([t,n+o,i+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=kn(!1),n=jt(t,Gt(e)),i=jt(t,zt(e));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ii{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Ci(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Ti(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new _i(e,{value:this.value,viewProps:this.viewProps}),text:new Zt(e,{parser:Rt,baseStep:.1,props:T.fromObject({draggingScale:.01,formatter:Bt(2)}),value:M(0,{constraint:new $e({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ft({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.rawValue.getComponents()[3],backward:(e,t)=>{const n=e.rawValue.getComponents();return n[3]=t.rawValue,new Tn(n,e.rawValue.mode)}}),this.textC_=new wi(e,{colorType:t.colorType,parser:Rt,value:this.value,viewProps:this.viewProps}),this.view=new Pn(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Pi=g("colsw");class Ri{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Pi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Pi("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=e.createElement("button");i.classList.add(Pi("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=ri(e)}onValueChange_(){this.update_()}}class Di{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ri(e,{value:this.value,viewProps:this.viewProps})}}class ki{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ie.create(t.expanded),this.swatchC_=new Di(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new dt(e,{parser:t.parser,props:T.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new bn(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new lt(e,{viewProps:this.viewProps}):null;const i=new Ii(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),Ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),se(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=K(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!V(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function Bi(e){return wn(e.getComponents("rgb")).reduce(((e,t)=>e<<8|255&Math.floor(t)),0)}function Oi(e){return e.getComponents("rgb").reduce(((e,t,n)=>e<<8|255&Math.floor(3===n?255*t:t)),0)>>>0}function Li(e){return"number"!=typeof e?Tn.black():new Tn([(t=e)>>16&255,t>>8&255,255&t],"rgb");var t}function Ui(e){return"number"!=typeof e?Tn.black():new Tn([(t=e)>>24&255,t>>16&255,t>>8&255,Wt(255&t,0,255,0,1)],"rgb");var t}function Ni(e){var t;return!(!(null==e?void 0:e.alpha)&&!(null===(t=null==e?void 0:e.color)||void 0===t?void 0:t.alpha))}function Fi(e){return e?e=>ri(e,"0x"):e=>ii(e,"0x")}const ji={id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!function(e){return"color"in e||"view"in e&&"color"===e.view}(t))return null;const n=Dn(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>Ni(e.params)?Ui:Li,equals:Tn.equals,writer:e=>function(e){const t=e?Oi:Bi;return(e,n)=>{on(e,t(n))}}(Ni(e.params))},controller:e=>{const t=Ni(e.params),n="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0;return new ki(e.document,{colorType:"int",expanded:null!=n&&n,formatter:Fi(t),parser:ti("int"),pickerLayout:null!=i?i:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}};function zi(e){return t=>function(e,t){return Tn.isColorObject(e)?Tn.fromObject(e,t):Tn.black(t)}(t,e)}function Gi(e,t){return n=>e?di(n,t):ci(n,t)}const Vi={id:"input-color-object",type:"input",accept:(e,t)=>{if(!Tn.isColorObject(e))return null;const n=Dn(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>zi(Bn(e.params)),equals:Tn.equals,writer:e=>{return i=e.initialValue,t=Tn.isRgbaColorObject(i),n=Bn(e.params),(e,i)=>{t?function(e,t,n){const i=t.toRgbaObject(n);e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b),e.writeProperty("a",i.a)}(e,i,n):function(e,t,n){const i=t.toRgbaObject(n);e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b)}(e,i,n)};var t,n,i}},controller:e=>{var t;const n=Tn.isRgbaColorObject(e.initialValue),i="expanded"in e.params?e.params.expanded:void 0,r="picker"in e.params?e.params.picker:void 0,s=null!==(t=Bn(e.params))&&void 0!==t?t:"int";return new ki(e.document,{colorType:s,expanded:null!=i&&i,formatter:Gi(n,s),parser:ti(s),pickerLayout:null!=r?r:"popup",supportsAlpha:n,value:e.value,viewProps:e.viewProps})}},Hi={id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("view"in t&&"text"===t.view)return null;const n=$n(e,Bn(t));if(!n)return null;if(!fi(n))return null;const i=Dn(t);return i?{initialValue:e,params:i}:null},binding:{reader:e=>{var t;return function(e){const t=ei[e];return n=>{if("string"!=typeof n)return Tn.black(e);const i=t.reduce(((e,t)=>e||t(n)),null);return null!=i?i:Tn.black(e)}}(null!==(t=Bn(e.params))&&void 0!==t?t:"int")},equals:Tn.equals,writer:e=>{const t=$n(e.initialValue,Bn(e.params));if(!t)throw d.shouldNeverHappen();const n=function(e){const t=fi(e);return t?(e,n)=>{on(e,t(n))}:null}(t);if(!n)throw d.notBindable();return n}},controller:e=>{const t=$n(e.initialValue,Bn(e.params));if(!t)throw d.shouldNeverHappen();const n=fi(t);if(!n)throw d.shouldNeverHappen();const i="expanded"in e.params?e.params.expanded:void 0,r="picker"in e.params?e.params.picker:void 0;return new ki(e.document,{colorType:t.type,expanded:null!=i&&i,formatter:n,parser:ti(t.type),pickerLayout:null!=r?r:"popup",supportsAlpha:t.alpha,value:e.value,viewProps:e.viewProps})}};class Qi{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var n,i;return null!==(i=null===(n=this.components[t])||void 0===n?void 0:n.constrain(e))&&void 0!==i?i:e}));return this.asm_.fromComponents(t)}}const Wi=g("pndtxt");class qi{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Wi()),this.textViews.forEach((t=>{const n=e.createElement("div");n.classList.add(Wi("a")),n.appendChild(t.element),this.element.appendChild(n)}))}}class Xi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((n,i)=>function(e,t,n){return new Zt(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",baseStep:t.axes[n].baseStep,parser:t.parser,props:t.axes[n].textProps,value:M(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}(e,t,i))),this.acs_.forEach(((e,n)=>{Ft({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e.rawValue)[n],backward:(e,i)=>{const r=t.assembly.toComponents(e.rawValue);return r[n]=i.rawValue,t.assembly.fromComponents(r)}})})),this.view=new qi(e,{textViews:this.acs_.map((e=>e.view))})}}function Yi(e,t){return"step"in e&&!a(e.step)?new nt(e.step,t):null}function Ki(e){return a(e.max)||a(e.min)?a(e.max)&&a(e.min)?null:new tt({max:e.max,min:e.min}):new $e({max:e.max,min:e.min})}const Ji={id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const n=R,i=D(t,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(an),step:n.optional.number});return i?{initialValue:e,params:i}:null},binding:{reader:e=>Dt,constraint:e=>function(e,t){const n=[],i=Yi(e,t);i&&n.push(i);const r=Ki(e);r&&n.push(r);const s=dn(e.options);return s&&n.push(s),new Je(n)}(e.params,e.initialValue),writer:e=>on},controller:e=>{var t;const n=e.value,i=e.constraint,r=i&&Ze(i,et);if(r)return new st(e.document,{props:new T({options:r.values.value("options")}),value:n,viewProps:e.viewProps});const s=null!==(t="format"in e.params?e.params.format:void 0)&&void 0!==t?t:Bt(hn(i,n.rawValue)),o=i&&Ze(i,$e);return o?new sn(e.document,{baseStep:pn(i),parser:Rt,sliderProps:new T({maxValue:o.values.value("max"),minValue:o.values.value("min")}),textProps:T.fromObject({draggingScale:fn(i,n.rawValue),formatter:s}),value:n,viewProps:e.viewProps}):new Zt(e.document,{baseStep:pn(i),parser:Rt,props:T.fromObject({draggingScale:fn(i,n.rawValue),formatter:s}),value:n,viewProps:e.viewProps})}};class Zi{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(a(e))return!1;const t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const $i={toComponents:e=>e.getComponents(),fromComponents:e=>new Zi(...e)},er=g("p2d");class tr{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(er()),t.viewProps.bindClassModifiers(this.element),v(t.expanded,b(this.element,er(void 0,"expanded")));const n=e.createElement("div");n.classList.add(er("h")),this.element.appendChild(n);const i=e.createElement("button");i.classList.add(er("b")),i.appendChild(W(e,"p2dpad")),t.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const r=e.createElement("div");if(r.classList.add(er("t")),n.appendChild(r),this.textElement=r,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(er("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const nr=g("p2dp");class ir{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(nr()),"popup"===t.layout&&this.element.classList.add(nr(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(nr("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=e.createElementNS(z,"svg");i.classList.add(nr("g")),this.padElement.appendChild(i),this.svgElem_=i;const r=e.createElementNS(z,"line");r.classList.add(nr("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const s=e.createElementNS(z,"line");s.classList.add(nr("ax")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","0"),s.setAttributeNS(null,"x2","50%"),s.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(s);const o=e.createElementNS(z,"line");o.classList.add(nr("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=e.createElement("div");a.classList.add(nr("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.maxValue_,i=Wt(e,-n,+n,0,100),r=Wt(t,-n,+n,0,100),s=this.invertsY_?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${s}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${s}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function rr(e,t,n){return[jt(t[0],Gt(e)),jt(t[1],zt(e))*(n?1:-1)]}class sr{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new ir(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.maxValue_,i=Wt(e.point.x,0,e.bounds.width,-n,+n),r=Wt(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new Zi(i,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Vt(e.key)&&e.preventDefault();const[t,n]=rr(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(new Zi(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=rr(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class or{constructor(e,t){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ie.create(t.expanded),this.popC_="popup"===t.pickerLayout?new lt(e,{viewProps:this.viewProps}):null;const r=new sr(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=r,this.textC_=new Xi(e,{assembly:$i,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new tr(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),se(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=K(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!V(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}class ar{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(a(e))return!1;const t=e.x,n=e.y,i=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const lr={toComponents:e=>e.getComponents(),fromComponents:e=>new ar(...e)};function cr(e){return ar.isObject(e)?new ar(e.x,e.y,e.z):new ar}function ur(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}function dr(e,t){return{baseStep:pn(t),constraint:t,textProps:T.fromObject({draggingScale:fn(t,e),formatter:Bt(hn(t,e))})}}const hr={id:"input-point3d",type:"input",accept:(e,t)=>{if(!ar.isObject(e))return null;const n=R,i=D(t,{x:n.optional.custom(cn),y:n.optional.custom(cn),z:n.optional.custom(cn)});return i?{initialValue:e,params:i}:null},binding:{reader:e=>cr,constraint:e=>{return t=e.params,n=e.initialValue,new Qi({assembly:lr,components:[Nr("x"in t?t.x:void 0,n.x),Nr("y"in t?t.y:void 0,n.y),Nr("z"in t?t.z:void 0,n.z)]});var t,n},equals:ar.equals,writer:e=>ur},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof Qi))throw d.shouldNeverHappen();return new Xi(e.document,{assembly:lr,axes:[dr(t.rawValue.x,n.components[0]),dr(t.rawValue.y,n.components[1]),dr(t.rawValue.z,n.components[2])],parser:Rt,value:t,viewProps:e.viewProps})}};class pr{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(a(e))return!1;const t=e.x,n=e.y,i=e.z,r=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i&&"number"==typeof r}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const fr={toComponents:e=>e.getComponents(),fromComponents:e=>new pr(...e)};function mr(e){return pr.isObject(e)?new pr(e.x,e.y,e.z,e.w):new pr}function gr(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}const _r={id:"input-point4d",type:"input",accept:(e,t)=>{if(!pr.isObject(e))return null;const n=R,i=D(t,{x:n.optional.custom(cn),y:n.optional.custom(cn),z:n.optional.custom(cn),w:n.optional.custom(cn)});return i?{initialValue:e,params:i}:null},binding:{reader:e=>mr,constraint:e=>{return t=e.params,n=e.initialValue,new Qi({assembly:fr,components:[Nr("x"in t?t.x:void 0,n.x),Nr("y"in t?t.y:void 0,n.y),Nr("z"in t?t.z:void 0,n.z),Nr("w"in t?t.w:void 0,n.w)]});var t,n},equals:pr.equals,writer:e=>gr},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof Qi))throw d.shouldNeverHappen();return new Xi(e.document,{assembly:fr,axes:t.rawValue.getComponents().map(((e,t)=>{return i=e,{baseStep:pn(r=n.components[t]),constraint:r,textProps:T.fromObject({draggingScale:fn(r,i),formatter:Bt(hn(r,i))})};var i,r})),parser:Rt,value:t,viewProps:e.viewProps})}},vr={id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const n=D(t,{options:R.optional.custom(an)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>Ut,constraint:e=>function(e){const t=[],n=dn(e.options);return n&&t.push(n),new Je(t)}(e.params),writer:e=>on},controller:e=>{const t=e.document,n=e.value,i=e.constraint,r=i&&Ze(i,et);return r?new st(t,{props:new T({options:r.values.value("options")}),value:n,viewProps:e.viewProps}):new dt(t,{parser:e=>e,props:T.fromObject({formatter:Nt}),value:n,viewProps:e.viewProps})}},yr={monitor:{defaultInterval:200,defaultLineCount:3}},br=g("mll");class Ar{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(br()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(br("i")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach((e=>{void 0!==e&&n.push(this.formatter_(e))})),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class wr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ar(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const xr=g("sgl");class Er{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(xr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(xr("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class Cr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Er(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const Sr={id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=D(t,{lineCount:R.optional.number});return n?{initialValue:e,params:n}:null},binding:{reader:e=>ht},controller:e=>{var t;return 1===e.value.rawValue.length?new Cr(e.document,{formatter:pt,value:e.value,viewProps:e.viewProps}):new wr(e.document,{formatter:pt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yr.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}},Mr=g("grl");class Tr{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Mr()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(z,"svg");n.classList.add(Mr("g")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const i=e.createElementNS(z,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const r=e.createElement("div");r.classList.add(Mr("t"),g("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("minValue"),i=this.props_.get("maxValue"),r=[];this.value.rawValue.forEach(((s,o)=>{if(void 0===s)return;const a=Wt(o,0,t,0,e.width),l=Wt(s,n,i,e.height,0);r.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const s=this.tooltipElem_,o=this.value.rawValue[this.cursor_.rawValue];if(void 0===o)return void s.classList.remove(Mr("t","a"));const a=Wt(this.cursor_.rawValue,0,t,0,e.width),l=Wt(o,n,i,e.height,0);s.style.left=`${a}px`,s.style.top=`${l}px`,s.textContent=`${this.formatter_(o)}`,s.classList.contains(Mr("t","a"))||(s.classList.add(Mr("t","a"),Mr("t","in")),G(s),s.classList.remove(Mr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ir{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=M(-1),this.view=new Tr(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),V(e)){const e=new Qt(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Wt(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.rawValue=Math.floor(Wt(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Pr(e){return"format"in e&&!a(e.format)?e.format:Bt(2)}function Rr(e){return"view"in e&&"graph"===e.view}const Dr={id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const n=R,i=D(t,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return i?{initialValue:e,params:i}:null},binding:{defaultBufferSize:e=>Rr(e)?64:1,reader:e=>Dt},controller:e=>Rr(e.params)?function(e){var t,n,i;return new Ir(e.document,{formatter:Pr(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yr.monitor.defaultLineCount,props:T.fromObject({maxValue:null!==(n="max"in e.params?e.params.max:null)&&void 0!==n?n:100,minValue:null!==(i="min"in e.params?e.params.min:null)&&void 0!==i?i:0}),value:e.value,viewProps:e.viewProps})}(e):function(e){var t;return 1===e.value.rawValue.length?new Cr(e.document,{formatter:Pr(e.params),value:e.value,viewProps:e.viewProps}):new wr(e.document,{formatter:Pr(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yr.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}(e)},kr={id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const n=R,i=D(t,{lineCount:n.optional.number,multiline:n.optional.boolean});return i?{initialValue:e,params:i}:null},binding:{reader:e=>Ut},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new wr(e.document,{formatter:Nt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:yr.monitor.defaultLineCount,value:n,viewProps:e.viewProps}):new Cr(e.document,{formatter:Nt,value:n,viewProps:e.viewProps})}};function Br(e,t){return 0===t?new He:new Qe(e,null!=t?t:yr.monitor.defaultInterval)}class Or{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,n){if(a(t.read()))throw new d({context:{key:t.key},type:"nomatchingcontroller"});const i=this.pluginsMap_.inputs.reduce(((i,r)=>null!=i?i:function(e,t){const n=e.accept(t.target.read(),t.params);if(a(n))return null;const i=R,r={target:t.target,initialValue:n.initialValue,params:n.params},s=e.binding.reader(r),o=e.binding.constraint?e.binding.constraint(r):void 0,l=M(s(n.initialValue),{constraint:o,equals:e.binding.equals}),c=new We({reader:s,target:t.target,value:l,writer:e.binding.writer(r)}),u=i.optional.boolean(t.params.disabled).value,d=i.optional.boolean(t.params.hidden).value,h=e.controller({constraint:o,document:t.document,initialValue:n.initialValue,params:n.params,value:c.value,viewProps:U.create({disabled:u,hidden:d})}),p=i.optional.string(t.params.label).value;return new ce(t.document,{binding:c,blade:ne(),props:T.fromObject({label:null!=p?p:t.target.key}),valueController:h})}(r,{document:e,target:t,params:n})),null);if(i)return i;throw new d({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,n){const i=this.pluginsMap_.monitors.reduce(((i,r)=>null!=i?i:function(e,t){var n,i,r;const s=R,o=e.accept(t.target.read(),t.params);if(a(o))return null;const l={target:t.target,initialValue:o.initialValue,params:o.params},c=e.binding.reader(l),u=null!==(i=null!==(n=s.optional.number(t.params.bufferSize).value)&&void 0!==n?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(o.params))&&void 0!==i?i:1,d=s.optional.number(t.params.interval).value,h=new Ke({reader:c,target:t.target,ticker:Br(t.document,d),value:Xe(u)}),p=s.optional.boolean(t.params.disabled).value,f=s.optional.boolean(t.params.hidden).value,m=e.controller({document:t.document,params:o.params,value:h.value,viewProps:U.create({disabled:p,hidden:f})}),g=null!==(r=s.optional.string(t.params.label).value)&&void 0!==r?r:t.target.key;return new de(t.document,{binding:h,blade:ne(),props:T.fromObject({label:g}),valueController:m})}(r,{document:e,params:n,target:t})),null);if(i)return i;throw new d({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce(((n,i)=>null!=n?n:function(e,t){const n=e.accept(t.params);if(!n)return null;const i=R.optional.boolean(t.params.disabled).value,r=R.optional.boolean(t.params.hidden).value;return e.controller({blade:ne(),document:t.document,params:Object.assign(Object.assign({},n.params),{disabled:i,hidden:r}),viewProps:U.create({disabled:i,hidden:r})})}(i,{document:e,params:t})),null);if(!n)throw new d({type:"nomatchingview",context:{params:t}});return n}createBladeApi(e){if(e instanceof ce)return new le(e);if(e instanceof de)return new ue(e);if(e instanceof we)return new me(e,this);const t=this.pluginsMap_.blades.reduce(((t,n)=>null!=t?t:n.api({controller:e,pool:this})),null);if(!t)throw d.shouldNeverHappen();return t}}function Lr(e){return Zi.isObject(e)?new Zi(e.x,e.y):new Zi}function Ur(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function Nr(e,t){if(!e)return;const n=[],i=Yi(e,t);i&&n.push(i);const r=Ki(e);return r&&n.push(r),new Je(n)}function Fr(e,t){const[n,i]=e?function(e){const t=Ze(e,$e);if(t)return[t.values.get("min"),t.values.get("max")];const n=Ze(e,tt);return n?[n.minValue,n.maxValue]:[void 0,void 0]}(e):[];if(!a(n)||!a(i))return Math.max(Math.abs(null!=n?n:0),Math.abs(null!=i?i:0));const r=pn(e);return Math.max(10*Math.abs(r),10*Math.abs(t))}function jr(e,t){const n=t instanceof Qi?t.components[0]:void 0,i=t instanceof Qi?t.components[1]:void 0,r=Fr(n,e.x),s=Fr(i,e.y);return Math.max(r,s)}function zr(e,t){return{baseStep:pn(t),constraint:t,textProps:T.fromObject({draggingScale:fn(t,e),formatter:Bt(hn(t,e))})}}function Gr(e){if(!("y"in e))return!1;const t=e.y;return!!t&&"inverted"in t&&!!t.inverted}const Vr={id:"input-point2d",type:"input",accept:(e,t)=>{if(!Zi.isObject(e))return null;const n=R,i=D(t,{expanded:n.optional.boolean,picker:n.optional.custom(ln),x:n.optional.custom(cn),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return i?{initialValue:e,params:i}:null},binding:{reader:e=>Lr,constraint:e=>{return t=e.params,n=e.initialValue,new Qi({assembly:$i,components:[Nr("x"in t?t.x:void 0,n.x),Nr("y"in t?t.y:void 0,n.y)]});var t,n},equals:Zi.equals,writer:e=>Ur},controller:e=>{const t=e.document,n=e.value,i=e.constraint;if(!(i instanceof Qi))throw d.shouldNeverHappen();const r="expanded"in e.params?e.params.expanded:void 0,s="picker"in e.params?e.params.picker:void 0;return new or(t,{axes:[zr(n.rawValue.x,i.components[0]),zr(n.rawValue.y,i.components[1])],expanded:null!=r&&r,invertsY:Gr(e.params),maxValue:jr(n.rawValue,i),parser:Rt,pickerLayout:null!=s?s:"popup",value:n,viewProps:e.viewProps})}};class Hr extends t{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class Qr extends t{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class Wr extends t{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}const qr={id:"list",type:"blade",accept(e){const t=R,n=D(e,{options:t.required.custom(an),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return n?{params:n}:null},controller(e){const t=new et(un(e.params.options)),n=M(e.params.value,{constraint:t}),i=new st(e.document,{props:new T({options:t.values.value("options")}),value:n,viewProps:e.viewProps});return new Me(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:i})},api(e){return e.controller instanceof Me&&e.controller.valueController instanceof st?new Hr(e.controller):null}};class Xr extends ge{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){(function(e,t){e.forEach((e=>{const n=t[e.target.presetKey];void 0!==n&&e.writer(e.target,e.reader(n))}))})(this.controller_.rackController.rack.find(ce).map((e=>e.binding)),e),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(ce).map((e=>e.binding.target)).reduce(((e,t)=>Object.assign(e,{[t.presetKey]:t.read()})),{})}refresh(){this.controller_.rackController.rack.find(ce).forEach((e=>{e.binding.read()})),this.controller_.rackController.rack.find(de).forEach((e=>{e.binding.read()}))}}class Yr extends Ce{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const Kr={id:"slider",type:"blade",accept(e){const t=R,n=D(e,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return n?{params:n}:null},controller(e){var t,n;const i=null!==(t=e.params.value)&&void 0!==t?t:0,r=new $e({max:e.params.max,min:e.params.min}),s=new sn(e.document,{baseStep:1,parser:Rt,sliderProps:new T({maxValue:r.values.value("max"),minValue:r.values.value("min")}),textProps:T.fromObject({draggingScale:fn(void 0,i),formatter:null!==(n=e.params.format)&&void 0!==n?n:kt}),value:M(i,{constraint:r}),viewProps:e.viewProps});return new Me(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:s})},api(e){return e.controller instanceof Me&&e.controller.valueController instanceof sn?new Qr(e.controller):null}},Jr={id:"text",type:"blade",accept(e){const t=R,n=D(e,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return n?{params:n}:null},controller(e){var t;const n=new dt(e.document,{parser:e.params.parse,props:T.fromObject({formatter:null!==(t=e.params.format)&&void 0!==t?t:e=>String(e)}),value:M(e.params.value),viewProps:e.viewProps});return new Me(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:n})},api(e){return e.controller instanceof Me&&e.controller.valueController instanceof dt?new Wr(e.controller):null}};function Zr(e,t,n){if(e.querySelector(`style[data-tp-style=${t}]`))return;const i=e.createElement("style");i.dataset.tpStyle=t,i.textContent=n,e.head.appendChild(i)}const $r=new class{constructor(e){const[t,n]=e.split("-"),i=t.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=n?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}("3.1.6");e.BladeApi=t,e.ButtonApi=p,e.FolderApi=ge,e.InputBindingApi=le,e.ListApi=Hr,e.MonitorBindingApi=ue,e.Pane=class extends Xr{constructor(e){var t,n;const i=null!=e?e:{},r=null!==(t=i.document)&&void 0!==t?t:H(),s=function(){const e=new Or;return[Vr,hr,_r,vr,Ji,Hi,Vi,ji,vn,Sr,kr,Dr,ee,Se,De,Ve].forEach((t=>{e.register(t)})),e}();super(new Yr(r,{expanded:i.expanded,blade:ne(),props:T.fromObject({title:i.title}),viewProps:U.create()}),s),this.pool_=s,this.containerElem_=null!==(n=i.container)&&void 0!==n?n:function(e){const t=e.createElement("div");return t.classList.add(g("dfw")()),e.body&&e.body.appendChild(t),t}(r),this.containerElem_.appendChild(this.element),this.doc_=r,this.usesDefaultWrapper_=!i.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw d.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw d.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach((e=>{this.pool_.register(e),this.embedPluginStyle_(e)}))}embedPluginStyle_(e){e.css&&Zr(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){Zr(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach((e=>{this.embedPluginStyle_(e)})),this.registerPlugin({plugins:[Kr,qr,Ve,Jr]})}},e.SeparatorApi=Te,e.SliderApi=Qr,e.TabApi=Ne,e.TabPageApi=Ue,e.TextApi=Wr,e.TpChangeEvent=i,e.VERSION=$r,Object.defineProperty(e,"__esModule",{value:!0})}(t)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(e){super(e),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath(DRACOLoader2.LIB_CDN_PATH),this.setDecoderConfig({type:"js"})}transform(e,t){return e?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(e,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(e=!0,t=!1){return e&&super.preload(),t&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS="object"!=typeof WebAssembly||"js"===this.encoderConfig.type,librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then((libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),null===(_a=eval(jsContent+"\nDracoEncoderModule;"))||void 0===_a?void 0:_a()})),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then((async e=>e.text())).then((e=>{const t=e.indexOf("/* worker */");if(t<1)throw new Error("unable to load decoder module");return e.substring(0,t-1)}));return null===(_a=eval(jsContent+"\nDracoDecoderModule;"))||void 0===_a?void 0:_a()}async _loadLibrary(e,t){return DRACOLoader2.LibraryValueMap[e]?DRACOLoader2.LibraryValueMap[e]:DRACOLoader2.LibraryValueMap[e]=await super._loadLibrary(e,t)}static SetDecoderJsString(e){this.LibraryValueMap["draco_decoder.js"]=e}}DRACOLoader2.LIB_CDN_PATH="https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/",DRACOLoader2.LibraryValueMap={}},988:function(e,t,n){n.d(t,{$TI:function(){return Ip},$V:function(){return Bp},$Vf:function(){return Sf},$YQ:function(){return Bl},A5E:function(){return Kr},AXT:function(){return _u},Aip:function(){return Bf},B02:function(){return c},BFQ:function(){return Qe},BG$:function(){return ot},BKK:function(){return Pf},BVF:function(){return j},BVQ:function(){return Tu},BbS:function(){return ap},Bf4:function(){return ae},BtG:function(){return qs},CJI:function(){return Or},CP7:function(){return Fl},CaW:function(){return Je},CdI:function(){return $},Cne:function(){return Lf},CtA:function(){return Ge},CtF:function(){return rh},D1R:function(){return be},D67:function(){return cn},D9w:function(){return je},DT1:function(){return Cf},Djp:function(){return st},DqL:function(){return hh},DvJ:function(){return Us},E2K:function(){return Ve},EB7:function(){return nu},EJi:function(){return Pd},EoG:function(){return Z},F1y:function(){return un},F5T:function(){return Ur},FDw:function(){return Ae},FE5:function(){return wd},FIo:function(){return Td},FM8:function(){return Qn},FT0:function(){return Ld},FUD:function(){return ht},FvO:function(){return Gp},GG6:function(){return ut},GQ:function(){return hf},GUF:function(){return Gt},GVz:function(){return _i},GZb:function(){return Tf},G_r:function(){return Ht},Gih:function(){return dt},Gql:function(){return jh},H$k:function(){return bd},HTd:function(){return fe},HW6:function(){return kf},HdW:function(){return gt},HgB:function(){return wn},HkE:function(){return Pl},Hmr:function(){return Wh},Hw6:function(){return ui},Hy8:function(){return L},Hyl:function(){return su},IEO:function(){return xc},IFH:function(){return It},IKL:function(){return Dd},ILR:function(){return qe},IOt:function(){return Nt},Ilk:function(){return Vr},Ir4:function(){return An},JCZ:function(){return In},JOQ:function(){return Zs},JQ4:function(){return Me},JUT:function(){return vi},JWc:function(){return yn},Jjb:function(){return fn},KI_:function(){return zt},Kgo:function(){return ku},KhW:function(){return R},Kj0:function(){return Os},Kz5:function(){return Se},L5g:function(){return Of},L5s:function(){return Nh},LBq:function(){return Op},LSk:function(){return Sn},LY2:function(){return te},L_r:function(){return Mn},Lcc:function(){return Nf},LgZ:function(){return B},LsT:function(){return Ce},Ltg:function(){return fi},Lun:function(){return xl},M$G:function(){return dn},M5h:function(){return w},M6v:function(){return q},M8C:function(){return Hn},Mig:function(){return Dh},MyG:function(){return $t},N$j:function(){return wc},N4l:function(){return A},NDo:function(){return K},NMF:function(){return Et},NYV:function(){return at},Ns1:function(){return X},NwF:function(){return eh},Ny0:function(){return ou},O78:function(){return pn},O7d:function(){return pd},OAl:function(){return rn},OM3:function(){return cs},OTo:function(){return ke},OdW:function(){return Sc},OoA:function(){return de},Ox3:function(){return Rh},PA7:function(){return Ft},PMe:function(){return Eh},Pa4:function(){return wi},PeU:function(){return o},Pnf:function(){return St},PpQ:function(){return li},QM0:function(){return bn},QRU:function(){return Hh},QZ1:function(){return vn},QmN:function(){return s},Qpg:function(){return Zp},R2R:function(){return Kd},REq:function(){return If},RNb:function(){return es},ROQ:function(){return ru},RSm:function(){return kd},Rki:function(){return lf},RlZ:function(){return F},RsA:function(){return r},RvT:function(){return sn},S2y:function(){return l},S3k:function(){return ph},S9g:function(){return cr},SJI:function(){return op},SPe:function(){return Oc},SUY:function(){return ep},Se2:function(){return z},Sm8:function(){return T},So8:function(){return Xh},SvJ:function(){return ft},Syv:function(){return xt},T6w:function(){return mn},T95:function(){return xe},TOt:function(){return Nu},TUj:function(){return Up},TUv:function(){return Ac},T_1:function(){return yf},T_J:function(){return Jt},T__:function(){return au},T_f:function(){return kh},TlE:function(){return $r},Tme:function(){return xr},Tn7:function(){return Md},TyD:function(){return he},U7:function(){return bu},USm:function(){return lr},UY4:function(){return qc},UZH:function(){return i},Uk6:function(){return Ed},UlW:function(){return Dt},Uol:function(){return Du},V1s:function(){return Vs},V4E:function(){return Df},VLJ:function(){return $p},VYz:function(){return hp},Vdb:function(){return U},Vj0:function(){return ao},Vkp:function(){return Wn},VzW:function(){return Te},W2J:function(){return gn},WMw:function(){return b},WTc:function(){return ts},WXh:function(){return xd},Wbm:function(){return C},WdD:function(){return so},Wid:function(){return Id},Wjw:function(){return Mf},Wl3:function(){return f},Wpd:function(){return N},Wqd:function(){return Cu},WwZ:function(){return Rt},Wzm:function(){return tu},XZw:function(){return Uf},Xaj:function(){return x},Xcj:function(){return Cp},XvJ:function(){return Ad},Y8D:function(){return Oe},YBo:function(){return Bd},YGz:function(){return ee},YKA:function(){return At},YLQ:function(){return pe},YN5:function(){return Af},YT8:function(){return pu},Ywn:function(){return yi},Z6B:function(){return En},ZAu:function(){return Rl},ZQ6:function(){return Au},ZRs:function(){return Xt},ZTh:function(){return vt},ZZA:function(){return Vd},Z_g:function(){return iu},Zen:function(){return hn},Zp0:function(){return Uh},Zr5:function(){return G},ZzF:function(){return Ci},Zzh:function(){return jp},_12:function(){return ro},_3:function(){return xf},_AM:function(){return Xe},_C8:function(){return Hd},_Li:function(){return m},_MY:function(){return u},_RZ:function(){return Tn},_YM:function(){return Yd},_YX:function(){return Wp},_am:function(){return Ws},_fP:function(){return Ai},_iA:function(){return d},_kC:function(){return _h},_lf:function(){return Mt},_sL:function(){return Tt},a$l:function(){return ls},aCh:function(){return jt},aH4:function(){return me},aLr:function(){return Vi},aNw:function(){return ah},aVm:function(){return is},ad5:function(){return Qt},anP:function(){return Co},aq0:function(){return ef},av9:function(){return ze},b5g:function(){return jl},bBp:function(){return xp},bGH:function(){return E},b_z:function(){return Ru},bdR:function(){return y},blk:function(){return Wc},bnF:function(){return Fu},brP:function(){return Ne},bsb:function(){return mt},c8b:function(){return I},cBI:function(){return sf},cBK:function(){return fh},cJO:function(){return md},cLu:function(){return Ie},cPb:function(){return Hs},cRx:function(){return Le},cU9:function(){return qd},ce8:function(){return qt},cek:function(){return Ih},cum:function(){return an},dSO:function(){return oe},dUE:function(){return Jd},dYG:function(){return Qd},dZ3:function(){return ne},dd2:function(){return mi},dj0:function(){return _n},dpR:function(){return gh},dwk:function(){return p},e62:function(){return as},eD:function(){return H},eMJ:function(){return Zt},eaV:function(){return Ke},ehD:function(){return g},ejS:function(){return Qc},ekQ:function(){return et},epp:function(){return oi},fHI:function(){return Pu},fO1:function(){return eu},fQA:function(){return df},fQK:function(){return Il},fSK:function(){return O},fY$:function(){return re},fto:function(){return Ze},g8_:function(){return le},gH0:function(){return Tp},gSk:function(){return Pt},g_z:function(){return yu},ghN:function(){return P},gi4:function(){return rt},gti:function(){return xu},hEm:function(){return Fe},hH6:function(){return uh},iAb:function(){return Ee},iDF:function(){return ud},iKG:function(){return go},iLg:function(){return $d},iMs:function(){return Rp},iUV:function(){return Ap},iWC:function(){return D},iWj:function(){return to},i_9:function(){return Yh},iiP:function(){return pt},irR:function(){return Re},j4z:function(){return on},j87:function(){return ss},jAl:function(){return bt},jFi:function(){return v},jZA:function(){return nt},jfJ:function(){return Yt},jwo:function(){return tn},jyi:function(){return ac},jyz:function(){return Gs},k0A:function(){return Pe},k74:function(){return k},kB5:function(){return Wl},kFz:function(){return bi},kaV:function(){return Od},knz:function(){return Ot},kqm:function(){return pp},ksN:function(){return Q},l0P:function(){return $e},l8J:function(){return xn},lCJ:function(){return os},lDi:function(){return Bh},lGU:function(){return yt},lLk:function(){return sh},lRF:function(){return wl},lRj:function(){return ye},lb7:function(){return Mc},lfu:function(){return Wd},lk7:function(){return Oh},m7l:function(){return nh},mSO:function(){return Ut},mTL:function(){return qh},mXe:function(){return wu},m_w:function(){return Ef},mzJ:function(){return wp},nls:function(){return Lc},ntZ:function(){return h},ntt:function(){return Vt},nvb:function(){return bf},o8S:function(){return _d},oAp:function(){return Xs},oa8:function(){return vd},oqc:function(){return Kt},p3g:function(){return gi},p7y:function(){return Mu},pBf:function(){return Pn},pIN:function(){return Ct},pKu:function(){return ct},pQR:function(){return gd},ptH:function(){return tt},qhX:function(){return Y},qkB:function(){return Ue},qlB:function(){return rs},qyh:function(){return ve},rAo:function(){return ns},rBU:function(){return oo},rDY:function(){return zs},rOj:function(){return S},r_:function(){return M},rnI:function(){return Bt},rpg:function(){return ce},s4_:function(){return Fh},sYA:function(){return dh},tEQ:function(){return oh},tGC:function(){return _f},tJx:function(){return pf},tUh:function(){return Xd},tf:function(){return fp},tm_:function(){return a},trn:function(){return wf},u37:function(){return $h},u7G:function(){return Lh},u9r:function(){return _s},uEv:function(){return wt},uL9:function(){return J},uWy:function(){return ue},uXU:function(){return en},ub3:function(){return _},ujx:function(){return Rf},v3W:function(){return We},v9Y:function(){return Cn},vBJ:function(){return Qr},vCF:function(){return V},vCx:function(){return Ye},vZf:function(){return ge},vmT:function(){return vh},vpT:function(){return Hl},vuL:function(){return _t},vxC:function(){return se},w$m:function(){return W},wJv:function(){return De},wem:function(){return _e},wk1:function(){return Be},woe:function(){return Zc},wuA:function(){return He},x12:function(){return Gc},x5V:function(){return Wt},xEZ:function(){return pi},xG9:function(){return Xp},xJs:function(){return lt},xWb:function(){return Sp},xeV:function(){return ql},xfE:function(){return ie},xo$:function(){return yd},xoQ:function(){return ln},xoR:function(){return Rd},xsS:function(){return Vl},y$t:function(){return Su},y2t:function(){return it},y8_:function(){return vf},yC1:function(){return th},yGw:function(){return Zi},ybr:function(){return Gl},yj7:function(){return vu},ylh:function(){return Pp},yo9:function(){return zl},yt0:function(){return nn},ywz:function(){return we},yxD:function(){return mh},z$h:function(){return kt},z81:function(){return Lt},z8B:function(){return dc},zHn:function(){return Ji},zbs:function(){return Zd},zf8:function(){return Iu}});const i="153",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,u=0,d=1,h=2,p=3,f=0,m=1,g=2,_=2,v=0,y=1,b=2,A=3,w=4,x=5,E=100,C=101,S=102,M=103,T=104,I=200,P=201,R=202,D=203,k=204,B=205,O=206,L=207,U=208,N=209,F=210,j=0,z=1,G=2,V=3,H=4,Q=5,W=6,q=7,X=0,Y=1,K=2,J=0,Z=1,$=2,ee=3,te=4,ne=5,ie=300,re=301,se=302,oe=303,ae=304,le=306,ce=1e3,ue=1001,de=1002,he=1003,pe=1004,fe=1004,me=1005,ge=1005,_e=1006,ve=1007,ye=1007,be=1008,Ae=1008,we=1009,xe=1010,Ee=1011,Ce=1012,Se=1013,Me=1014,Te=1015,Ie=1016,Pe=1017,Re=1018,De=1020,ke=1021,Be=1023,Oe=1024,Le=1025,Ue=1026,Ne=1027,Fe=1028,je=1029,ze=1030,Ge=1031,Ve=1033,He=33776,Qe=33777,We=33778,qe=33779,Xe=35840,Ye=35841,Ke=35842,Je=35843,Ze=36196,$e=37492,et=37496,tt=37808,nt=37809,it=37810,rt=37811,st=37812,ot=37813,at=37814,lt=37815,ct=37816,ut=37817,dt=37818,ht=37819,pt=37820,ft=37821,mt=36492,gt=36283,_t=36284,vt=36285,yt=36286,bt=2200,At=2201,wt=2202,xt=2300,Et=2301,Ct=2302,St=2400,Mt=2401,Tt=2402,It=2500,Pt=2501,Rt=0,Dt=1,kt=2,Bt=3e3,Ot=3001,Lt=3200,Ut=3201,Nt=0,Ft=1,jt="",zt="srgb",Gt="srgb-linear",Vt="display-p3",Ht="rgbm-16",Qt=0,Wt=7680,qt=7681,Xt=7682,Yt=7683,Kt=34055,Jt=34056,Zt=5386,$t=512,en=513,tn=514,nn=515,rn=516,sn=517,on=518,an=519,ln=512,cn=513,un=514,dn=515,hn=516,pn=517,fn=518,mn=519,gn=35044,_n=35048,vn=35040,yn=35045,bn=35049,An=35041,wn=35046,xn=35050,En=35042,Cn="100",Sn="300 es",Mn=1035,Tn=2e3,In=2001;class Pn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const Rn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Dn=1234567;const kn=Math.PI/180,Bn=180/Math.PI;function On(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Rn[255&e]+Rn[e>>8&255]+Rn[e>>16&255]+Rn[e>>24&255]+"-"+Rn[255&t]+Rn[t>>8&255]+"-"+Rn[t>>16&15|64]+Rn[t>>24&255]+"-"+Rn[63&n|128]+Rn[n>>8&255]+"-"+Rn[n>>16&255]+Rn[n>>24&255]+Rn[255&i]+Rn[i>>8&255]+Rn[i>>16&255]+Rn[i>>24&255]).toLowerCase()}function Ln(e,t,n){return Math.max(t,Math.min(n,e))}function Un(e,t){return(e%t+t)%t}function Nn(e,t,n){return(1-n)*e+n*t}function Fn(e){return 0==(e&e-1)&&0!==e}function jn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function zn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Gn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Vn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const Hn={DEG2RAD:kn,RAD2DEG:Bn,generateUUID:On,clamp:Ln,euclideanModulo:Un,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Nn,damp:function(e,t,n,i){return Nn(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Un(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Dn=e);let t=Dn+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*kn},radToDeg:function(e){return e*Bn},isPowerOfTwo:Fn,ceilPowerOfTwo:jn,floorPowerOfTwo:zn,setQuaternionFromProperEuler:function(e,t,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((t+i)/2),u=o((t+i)/2),d=s((t-i)/2),h=o((t-i)/2),p=s((i-t)/2),f=o((i-t)/2);switch(r){case"XYX":e.set(a*u,l*d,l*h,a*c);break;case"YZY":e.set(l*h,a*u,l*d,a*c);break;case"ZXZ":e.set(l*d,l*h,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Vn,denormalize:Gn};class Qn{constructor(e=0,t=0){Qn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ln(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Wn{constructor(e,t,n,i,r,s,o,a,l){Wn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,o,a,l)}set(e,t,n,i,r,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],p=n[8],f=i[0],m=i[3],g=i[6],_=i[1],v=i[4],y=i[7],b=i[2],A=i[5],w=i[8];return r[0]=s*f+o*_+a*b,r[3]=s*m+o*v+a*A,r[6]=s*g+o*y+a*w,r[1]=l*f+c*_+u*b,r[4]=l*m+c*v+u*A,r[7]=l*g+c*y+u*w,r[2]=d*f+h*_+p*b,r[5]=d*m+h*v+p*A,r[8]=d*g+h*y+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-n*r*c+n*o*a+i*r*l-i*s*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=c*s-o*l,d=o*a-c*r,h=l*r-s*a,p=t*u+n*d+i*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(o*n-i*s)*f,e[3]=d*f,e[4]=(c*t-i*a)*f,e[5]=(i*r-o*t)*f,e[6]=h*f,e[7]=(n*a-l*t)*f,e[8]=(s*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*s+l*o)+s+e,-i*l,i*a,-i*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(qn.makeScale(e,t)),this}rotate(e){return this.premultiply(qn.makeRotation(-e)),this}translate(e,t){return this.premultiply(qn.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const qn=new Wn;function Xn(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const Yn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Kn(e,t){return new Yn[e](t)}function Jn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const Zn={};function $n(e){e in Zn||(Zn[e]=!0,console.warn(e))}function ei(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ti(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const ni=(new Wn).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),ii=(new Wn).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),ri={[Gt]:e=>e,[zt]:e=>e.convertSRGBToLinear(),[Vt]:function(e){return e.convertSRGBToLinear().applyMatrix3(ii)}},si={[Gt]:e=>e,[zt]:e=>e.convertLinearToSRGB(),[Vt]:function(e){return e.applyMatrix3(ni).convertLinearToSRGB()}},oi={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return Gt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=ri[t],r=si[n];if(void 0===i||void 0===r)throw new Error(`Unsupported color space conversion, "${t}" to "${n}".`);return r(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let ai;class li{static getDataURL(e,t=!1){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{void 0===ai&&(ai=Jn("canvas")),ai.width=e.width,ai.height=e.height;const t=ai.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),n=ai}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Jn("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*ei(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ei(t[e]/255)):t[e]=ei(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ci=0;class ui{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ci++}),this.uuid=On(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(di(i[t].image)):e.push(di(i[t]))}else e=di(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function di(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return li.getDataURL(e);if(e.data){let t=[];try{t=Array.from(e.data)}catch(n){n.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(n),t=e.data}return{data:t,width:e.width,height:e.height,type:e.data.constructor.name}}return void 0!==e.url?e.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let hi=0;class pi extends Pn{constructor(e=pi.DEFAULT_IMAGE,t=pi.DEFAULT_MAPPING,n=ue,i=ue,r=_e,s=be,o=Be,a=we,l=pi.DEFAULT_ANISOTROPY,c=jt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:hi++}),this.uuid=On(),this.name="",this.source=new ui(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Qn(0,0),this.repeat=new Qn(1,1),this.center=new Qn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:($n("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===Ot?zt:jt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&e.textures&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===zt?Ot:Bt,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),!t&&e.textures&&(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ie)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ce:e.x=e.x-Math.floor(e.x);break;case ue:e.x=e.x<0?0:1;break;case de:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ce:e.y=e.y-Math.floor(e.y);break;case ue:e.y=e.y<0?0:1;break;case de:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return $n("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===zt?Ot:Bt}set encoding(e){$n("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Ot?zt:jt}}pi.DEFAULT_IMAGE=null,pi.DEFAULT_MAPPING=ie,pi.DEFAULT_ANISOTROPY=1;class fi{constructor(e=0,t=0,n=0,i=1){fi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,o=.1,a=e.elements,l=a[0],c=a[4],u=a[8],d=a[1],h=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-d)<s&&Math.abs(u-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+d)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+h+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(h+1)/2,_=(g+1)/2,v=(c+d)/4,y=(u+f)/4,b=(p+m)/4;return e>a&&e>_?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=v/n,r=y/n):a>_?a<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=v/i,r=b/i):_<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=y/r,i=b/r),this.set(n,i,r,t),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(d-c)*(d-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(d-c)/_,this.w=Math.acos((l+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class mi extends Pn{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new fi(0,0,e,t),this.scissorTest=!1,this.viewport=new fi(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==n.encoding&&($n("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Ot?zt:jt),this.texture=new pi(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:_e,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ui(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class gi extends pi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=he,this.minFilter=he,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _i extends mi{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new gi(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class vi extends pi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=he,this.minFilter=he,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class yi extends mi{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new vi(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class bi extends mi{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let s=0;s<n;s++)this.texture[s]=r.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Ai{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,o){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const d=r[s+0],h=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==d||l!==h||c!==p){let e=1-o;const t=a*d+l*h+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,t*n);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*e+d*r,l=l*e+h*r,c=c*e+p*r,u=u*e+f*r,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,s){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[s],d=r[s+1],h=r[s+2],p=r[s+3];return e[t]=o*p+c*u+a*h-l*d,e[t+1]=a*p+c*d+l*u-o*h,e[t+2]=l*p+c*h+o*d-a*u,e[t+3]=c*p-o*u-a*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),d=a(n/2),h=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"YXZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"ZXY":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"ZYX":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"YZX":this._x=d*c*u+l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u-d*h*p;break;case"XZY":this._x=d*c*u-l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],u=t[10],d=n+o+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ln(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+s*o+i*l-r*a,this._y=i*c+s*a+r*o-n*l,this._z=r*c+s*l+n*a-i*o,this._w=s*c-n*o-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=s*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class wi{constructor(e=0,t=0,n=0){wi.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ei.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ei.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*i-o*n,c=a*n+o*t-r*i,u=a*i+r*n-s*t,d=-r*t-s*n-o*i;return this.x=l*a+d*-r+c*-o-u*-s,this.y=c*a+d*-s+u*-r-l*-o,this.z=u*a+d*-o+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return xi.copy(this).projectOnVector(e),this.sub(xi)}reflect(e){return this.sub(xi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ln(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const xi=new wi,Ei=new Ai;class Ci{constructor(e=new wi(1/0,1/0,1/0),t=new wi(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Mi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Mi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Mi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Ti.copy(e.boundingBox),Ti.applyMatrix4(e.matrixWorld),this.union(Ti);else{const n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)Mi.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(Mi)}else null===n.boundingBox&&n.computeBoundingBox(),Ti.copy(n.boundingBox),Ti.applyMatrix4(e.matrixWorld),this.union(Ti)}const n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Mi),Mi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Oi),Li.subVectors(this.max,Oi),Ii.subVectors(e.a,Oi),Pi.subVectors(e.b,Oi),Ri.subVectors(e.c,Oi),Di.subVectors(Pi,Ii),ki.subVectors(Ri,Pi),Bi.subVectors(Ii,Ri);let t=[0,-Di.z,Di.y,0,-ki.z,ki.y,0,-Bi.z,Bi.y,Di.z,0,-Di.x,ki.z,0,-ki.x,Bi.z,0,-Bi.x,-Di.y,Di.x,0,-ki.y,ki.x,0,-Bi.y,Bi.x,0];return!!Fi(t,Ii,Pi,Ri,Li)&&(t=[1,0,0,0,1,0,0,0,1],!!Fi(t,Ii,Pi,Ri,Li)&&(Ui.crossVectors(Di,ki),t=[Ui.x,Ui.y,Ui.z],Fi(t,Ii,Pi,Ri,Li)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Mi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Mi).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Si[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Si[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Si[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Si[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Si[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Si[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Si[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Si[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Si)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Si=[new wi,new wi,new wi,new wi,new wi,new wi,new wi,new wi],Mi=new wi,Ti=new Ci,Ii=new wi,Pi=new wi,Ri=new wi,Di=new wi,ki=new wi,Bi=new wi,Oi=new wi,Li=new wi,Ui=new wi,Ni=new wi;function Fi(e,t,n,i,r){for(let s=0,o=e.length-3;s<=o;s+=3){Ni.fromArray(e,s);const o=r.x*Math.abs(Ni.x)+r.y*Math.abs(Ni.y)+r.z*Math.abs(Ni.z),a=t.dot(Ni),l=n.dot(Ni),c=i.dot(Ni);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const ji=new Ci,zi=new wi,Gi=new wi;class Vi{constructor(e=new wi,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):ji.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;zi.subVectors(e,this.center);const t=zi.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(zi,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Gi.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(zi.copy(e.center).add(Gi)),this.expandByPoint(zi.copy(e.center).sub(Gi))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Hi=new wi,Qi=new wi,Wi=new wi,qi=new wi,Xi=new wi,Yi=new wi,Ki=new wi;class Ji{constructor(e=new wi,t=new wi(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Hi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Hi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Hi.copy(this.origin).addScaledVector(this.direction,t),Hi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Qi.copy(e).add(t).multiplyScalar(.5),Wi.copy(t).sub(e).normalize(),qi.copy(this.origin).sub(Qi);const r=.5*e.distanceTo(t),s=-this.direction.dot(Wi),o=qi.dot(this.direction),a=-qi.dot(Wi),l=qi.lengthSq(),c=Math.abs(1-s*s);let u,d,h,p;if(c>0)if(u=s*a-o,d=s*o-a,p=r*c,u>=0)if(d>=-p)if(d<=p){const e=1/c;u*=e,d*=e,h=u*(u+s*d+2*o)+d*(s*u+d+2*a)+l}else d=r,u=Math.max(0,-(s*d+o)),h=-u*u+d*(d+2*a)+l;else d=-r,u=Math.max(0,-(s*d+o)),h=-u*u+d*(d+2*a)+l;else d<=-p?(u=Math.max(0,-(-s*r+o)),d=u>0?-r:Math.min(Math.max(-r,-a),r),h=-u*u+d*(d+2*a)+l):d<=p?(u=0,d=Math.min(Math.max(-r,-a),r),h=d*(d+2*a)+l):(u=Math.max(0,-(s*r+o)),d=u>0?r:Math.min(Math.max(-r,-a),r),h=-u*u+d*(d+2*a)+l);else d=s>0?-r:r,u=Math.max(0,-(s*d+o)),h=-u*u+d*(d+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Qi).addScaledVector(Wi,d),h}intersectSphere(e,t){Hi.subVectors(e.center,this.origin);const n=Hi.dot(this.direction),i=Hi.dot(Hi)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,s=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,s=(e.min.y-d.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),u>=0?(o=(e.min.z-d.z)*u,a=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,a=(e.min.z-d.z)*u),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Hi)}intersectTriangle(e,t,n,i,r){Xi.subVectors(t,e),Yi.subVectors(n,e),Ki.crossVectors(Xi,Yi);let s,o=this.direction.dot(Ki);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}qi.subVectors(this.origin,e);const a=s*this.direction.dot(Yi.crossVectors(qi,Yi));if(a<0)return null;const l=s*this.direction.dot(Xi.cross(qi));if(l<0)return null;if(a+l>o)return null;const c=-s*qi.dot(Ki);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Zi{constructor(e,t,n,i,r,s,o,a,l,c,u,d,h,p,f,m){Zi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,o,a,l,c,u,d,h,p,f,m)}set(e,t,n,i,r,s,o,a,l,c,u,d,h,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Zi).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/$i.setFromMatrixColumn(e,0).length(),r=1/$i.setFromMatrixColumn(e,1).length(),s=1/$i.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*u,i=o*c,r=o*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-o*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*o,t[4]=i*o-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-o,t[2]=n*o-i,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*o,t[4]=-s*u,t[8]=i+n*o,t[1]=n+i*o,t[5]=s*c,t[9]=r-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,n=s*u,i=o*c,r=o*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,n=s*l,i=o*a,r=o*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=s*a,n=s*l,i=o*a,r=o*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=s*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=o*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(tr,e,nr)}lookAt(e,t,n){const i=this.elements;return sr.subVectors(e,t),0===sr.lengthSq()&&(sr.z=1),sr.normalize(),ir.crossVectors(n,sr),0===ir.lengthSq()&&(1===Math.abs(n.z)?sr.x+=1e-4:sr.z+=1e-4,sr.normalize(),ir.crossVectors(n,sr)),ir.normalize(),rr.crossVectors(sr,ir),i[0]=ir.x,i[4]=rr.x,i[8]=sr.x,i[1]=ir.y,i[5]=rr.y,i[9]=sr.y,i[2]=ir.z,i[6]=rr.z,i[10]=sr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],b=n[15],A=i[0],w=i[4],x=i[8],E=i[12],C=i[1],S=i[5],M=i[9],T=i[13],I=i[2],P=i[6],R=i[10],D=i[14],k=i[3],B=i[7],O=i[11],L=i[15];return r[0]=s*A+o*C+a*I+l*k,r[4]=s*w+o*S+a*P+l*B,r[8]=s*x+o*M+a*R+l*O,r[12]=s*E+o*T+a*D+l*L,r[1]=c*A+u*C+d*I+h*k,r[5]=c*w+u*S+d*P+h*B,r[9]=c*x+u*M+d*R+h*O,r[13]=c*E+u*T+d*D+h*L,r[2]=p*A+f*C+m*I+g*k,r[6]=p*w+f*S+m*P+g*B,r[10]=p*x+f*M+m*R+g*O,r[14]=p*E+f*T+m*D+g*L,r[3]=_*A+v*C+y*I+b*k,r[7]=_*w+v*S+y*P+b*B,r[11]=_*x+v*M+y*R+b*O,r[15]=_*E+v*T+y*D+b*L,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+r*a*u-i*l*u-r*o*d+n*l*d+i*o*h-n*a*h)+e[7]*(+t*a*h-t*l*d+r*s*d-i*s*h+i*l*c-r*a*c)+e[11]*(+t*l*u-t*o*h-r*s*u+n*s*h+r*o*c-n*l*c)+e[15]*(-i*o*c-t*a*u+t*o*d+i*s*u-n*s*d+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*d*l+f*a*h-o*m*h-u*a*g+o*d*g,v=p*d*l-c*m*l-p*a*h+s*m*h+c*a*g-s*d*g,y=c*f*l-p*u*l+p*o*h-s*f*h-c*o*g+s*u*g,b=p*u*a-c*f*a-p*o*d+s*f*d+c*o*m-s*u*m,A=t*_+n*v+i*y+r*b;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/A;return e[0]=_*w,e[1]=(f*d*r-u*m*r-f*i*h+n*m*h+u*i*g-n*d*g)*w,e[2]=(o*m*r-f*a*r+f*i*l-n*m*l-o*i*g+n*a*g)*w,e[3]=(u*a*r-o*d*r-u*i*l+n*d*l+o*i*h-n*a*h)*w,e[4]=v*w,e[5]=(c*m*r-p*d*r+p*i*h-t*m*h-c*i*g+t*d*g)*w,e[6]=(p*a*r-s*m*r-p*i*l+t*m*l+s*i*g-t*a*g)*w,e[7]=(s*d*r-c*a*r+c*i*l-t*d*l-s*i*h+t*a*h)*w,e[8]=y*w,e[9]=(p*u*r-c*f*r-p*n*h+t*f*h+c*n*g-t*u*g)*w,e[10]=(s*f*r-p*o*r+p*n*l-t*f*l-s*n*g+t*o*g)*w,e[11]=(c*o*r-s*u*r-c*n*l+t*u*l+s*n*h-t*o*h)*w,e[12]=b*w,e[13]=(c*f*i-p*u*i+p*n*d-t*f*d-c*n*m+t*u*m)*w,e[14]=(p*o*i-s*f*i-p*n*a+t*f*a+s*n*m-t*o*m)*w,e[15]=(s*u*i-c*o*i+c*n*a-t*u*a-s*n*d+t*o*d)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,o=e.y,a=e.z,l=r*s,c=r*o;return this.set(l*s+n,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+n,c*a-i*s,0,l*a-i*o,c*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,c=s+s,u=o+o,d=r*l,h=r*c,p=r*u,f=s*c,m=s*u,g=o*u,_=a*l,v=a*c,y=a*u,b=n.x,A=n.y,w=n.z;return i[0]=(1-(f+g))*b,i[1]=(h+y)*b,i[2]=(p-v)*b,i[3]=0,i[4]=(h-y)*A,i[5]=(1-(d+g))*A,i[6]=(m+_)*A,i[7]=0,i[8]=(p+v)*w,i[9]=(m-_)*w,i[10]=(1-(d+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=$i.set(i[0],i[1],i[2]).length();const s=$i.set(i[4],i[5],i[6]).length(),o=$i.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],er.copy(this);const a=1/r,l=1/s,c=1/o;return er.elements[0]*=a,er.elements[1]*=a,er.elements[2]*=a,er.elements[4]*=l,er.elements[5]*=l,er.elements[6]*=l,er.elements[8]*=c,er.elements[9]*=c,er.elements[10]*=c,t.setFromRotationMatrix(er),n.x=r,n.y=s,n.z=o,this}makePerspective(e,t,n,i,r,s,o=Tn){const a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),d=(n+i)/(n-i);let h,p;if(o===Tn)h=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(o!==In)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);h=-s/(s-r),p=-s*r/(s-r)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,s,o=Tn){const a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),d=(t+e)*l,h=(n+i)*c;let p,f;if(o===Tn)p=(s+r)*u,f=-2*u;else{if(o!==In)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=r*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const $i=new wi,er=new Zi,tr=new wi(0,0,0),nr=new wi(1,1,1),ir=new wi,rr=new wi,sr=new wi,or=new Zi,ar=new Ai;class lr{constructor(e=0,t=0,n=0,i=lr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],u=i[2],d=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(Ln(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ln(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ln(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Ln(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Ln(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-Ln(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return or.makeRotationFromQuaternion(e),this.setFromRotationMatrix(or,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ar.setFromEuler(this),this.setFromQuaternion(ar,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}lr.DEFAULT_ORDER="XYZ";class cr{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&1<<e)}}let ur=0;const dr=new wi,hr=new Ai,pr=new Zi,fr=new wi,mr=new wi,gr=new wi,_r=new Ai,vr=new wi(1,0,0),yr=new wi(0,1,0),br=new wi(0,0,1),Ar={type:"added"},wr={type:"removed"};class xr extends Pn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ur++}),this.uuid=On(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=xr.DEFAULT_UP.clone();const e=new wi,t=new lr,n=new Ai,i=new wi(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Zi},normalMatrix:{value:new Wn}}),this.matrix=new Zi,this.matrixWorld=new Zi,this.matrixAutoUpdate=xr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=xr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new cr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(e,t,n,i,r,s){this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,material:r,group:s})}onAfterRender(e,t,n,i,r,s){this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,material:r,group:s})}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return hr.setFromAxisAngle(e,t),this.quaternion.multiply(hr),this}rotateOnWorldAxis(e,t){return hr.setFromAxisAngle(e,t),this.quaternion.premultiply(hr),this}rotateX(e){return this.rotateOnAxis(vr,e)}rotateY(e){return this.rotateOnAxis(yr,e)}rotateZ(e){return this.rotateOnAxis(br,e)}translateOnAxis(e,t){return dr.copy(e).applyQuaternion(this.quaternion),this.position.add(dr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(vr,e)}translateY(e){return this.translateOnAxis(yr,e)}translateZ(e){return this.translateOnAxis(br,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(pr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?fr.copy(e):fr.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),mr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pr.lookAt(mr,fr,this.up):pr.lookAt(fr,mr,this.up),this.quaternion.setFromRotationMatrix(pr),i&&(pr.extractRotation(i.matrixWorld),hr.setFromRotationMatrix(pr),this.quaternion.premultiply(hr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Ar)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(wr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(wr)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),pr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),pr.multiply(e.parent.matrixWorld)),e.applyMatrix4(pr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectsByProperty(e,t);r.length>0&&(n=n.concat(r))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mr,e,gr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mr,_r,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData={};for(const[n,i]of Object.entries(e.userData))this.userData[n]=!i||i&&(i.isTexture||i.isObject3D)?i:JSON.parse(JSON.stringify(i));if(!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}xr.DEFAULT_UP=new wi(0,1,0),xr.DEFAULT_MATRIX_AUTO_UPDATE=!0,xr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Er=new wi,Cr=new wi,Sr=new wi,Mr=new wi,Tr=new wi,Ir=new wi,Pr=new wi,Rr=new wi,Dr=new wi,kr=new wi;let Br=!1;class Or{constructor(e=new wi,t=new wi,n=new wi){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Er.subVectors(e,t),i.cross(Er);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Er.subVectors(i,t),Cr.subVectors(n,t),Sr.subVectors(e,t);const s=Er.dot(Er),o=Er.dot(Cr),a=Er.dot(Sr),l=Cr.dot(Cr),c=Cr.dot(Sr),u=s*l-o*o;if(0===u)return r.set(-2,-1,-1);const d=1/u,h=(l*a-o*c)*d,p=(s*c-o*a)*d;return r.set(1-h-p,p,h)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Mr),Mr.x>=0&&Mr.y>=0&&Mr.x+Mr.y<=1}static getUV(e,t,n,i,r,s,o,a){return!1===Br&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Br=!0),this.getInterpolation(e,t,n,i,r,s,o,a)}static getInterpolation(e,t,n,i,r,s,o,a){return this.getBarycoord(e,t,n,i,Mr),a.setScalar(0),a.addScaledVector(r,Mr.x),a.addScaledVector(s,Mr.y),a.addScaledVector(o,Mr.z),a}static isFrontFacing(e,t,n,i){return Er.subVectors(n,t),Cr.subVectors(e,t),Er.cross(Cr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Er.subVectors(this.c,this.b),Cr.subVectors(this.a,this.b),.5*Er.cross(Cr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Or.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Or.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return!1===Br&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Br=!0),Or.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}getInterpolation(e,t,n,i,r){return Or.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Or.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Or.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,o;Tr.subVectors(i,n),Ir.subVectors(r,n),Rr.subVectors(e,n);const a=Tr.dot(Rr),l=Ir.dot(Rr);if(a<=0&&l<=0)return t.copy(n);Dr.subVectors(e,i);const c=Tr.dot(Dr),u=Ir.dot(Dr);if(c>=0&&u<=c)return t.copy(i);const d=a*u-c*l;if(d<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(n).addScaledVector(Tr,s);kr.subVectors(e,r);const h=Tr.dot(kr),p=Ir.dot(kr);if(p>=0&&h<=p)return t.copy(r);const f=h*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector(Ir,o);const m=c*p-h*u;if(m<=0&&u-c>=0&&h-p>=0)return Pr.subVectors(r,i),o=(u-c)/(u-c+(h-p)),t.copy(i).addScaledVector(Pr,o);const g=1/(m+f+d);return s=f*g,o=d*g,t.copy(n).addScaledVector(Tr,s).addScaledVector(Ir,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Lr=0;class Ur extends Pn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Lr++}),this.uuid=On(),this.name="",this.type="Material",this.blending=y,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=k,this.blendDst=B,this.blendEquation=E,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=an,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Wt,this.stencilZFail=Wt,this.stencilZPass=Wt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i&&(i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):Array.isArray(n)&&i&&"function"==typeof i.fromArray?i.fromArray(n):this[t]=n)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==y&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=Nr({},e.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}function Nr(e,t){if(!t)return e;for(const n of Object.keys(t)){if(n.startsWith("__"))continue;if("function"==typeof e[n]||"function"==typeof t[n])continue;const i=t[n],r=!i||i.isTexture||i.isObject3D||i.isMaterial;r||"function"!=typeof t[n].clone?r||"object"!=typeof t[n]&&!Array.isArray(t[n])?e[n]=t[n]:e[n]=Nr(Array.isArray(t[n])?[]:{},t[n]):e[n]=t[n].clone()}return e}const Fr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jr={h:0,s:0,l:0},zr={h:0,s:0,l:0};function Gr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Vr{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=zt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,oi.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=oi.workingColorSpace){return this.r=e,this.g=t,this.b=n,oi.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=oi.workingColorSpace){if(e=Un(e,1),t=Ln(t,0,1),n=Ln(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Gr(r,i,e+1/3),this.g=Gr(r,i,e),this.b=Gr(r,i,e-1/3)}return oi.toWorkingColorSpace(this,i),this}setStyle(e,t=zt){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=zt){const n=Fr[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ei(e.r),this.g=ei(e.g),this.b=ei(e.b),this}copyLinearToSRGB(e){return this.r=ti(e.r),this.g=ti(e.g),this.b=ti(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=zt){return oi.fromWorkingColorSpace(Hr.copy(this),e),65536*Math.round(Ln(255*Hr.r,0,255))+256*Math.round(Ln(255*Hr.g,0,255))+Math.round(Ln(255*Hr.b,0,255))}getHexString(e=zt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=oi.workingColorSpace){oi.fromWorkingColorSpace(Hr.copy(this),t);const n=Hr.r,i=Hr.g,r=Hr.b,s=Math.max(n,i,r),o=Math.min(n,i,r);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const e=s-o;switch(l=c<=.5?e/(s+o):e/(2-s-o),s){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=oi.workingColorSpace){return oi.fromWorkingColorSpace(Hr.copy(this),t),e.r=Hr.r,e.g=Hr.g,e.b=Hr.b,e}getStyle(e=zt){oi.fromWorkingColorSpace(Hr.copy(this),e);const t=Hr.r,n=Hr.g,i=Hr.b;return e!==zt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(jr),jr.h+=e,jr.s+=t,jr.l+=n,this.setHSL(jr.h,jr.s,jr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(jr),e.getHSL(zr);const n=Nn(jr.h,zr.h,t),i=Nn(jr.s,zr.s,t),r=Nn(jr.l,zr.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Hr=new Vr;Vr.NAMES=Fr;class Qr extends Ur{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Vr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Wr=qr();function qr(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0==(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,s[l]=e|t}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Xr(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Ln(e,-65504,65504),Wr.floatView[0]=e;const t=Wr.uint32View[0],n=t>>23&511;return Wr.baseTable[n]+((8388607&t)>>Wr.shiftTable[n])}function Yr(e){const t=e>>10;return Wr.uint32View[0]=Wr.mantissaTable[Wr.offsetTable[t]+(1023&e)]+Wr.exponentTable[t],Wr.floatView[0]}const Kr={toHalfFloat:Xr,fromHalfFloat:Yr},Jr=new wi,Zr=new Qn;class $r{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=gn,this.updateRange={offset:0,count:-1},this.gpuType=Te,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Zr.fromBufferAttribute(this,t),Zr.applyMatrix3(e),this.setXY(t,Zr.x,Zr.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Jr.fromBufferAttribute(this,t),Jr.applyMatrix3(e),this.setXYZ(t,Jr.x,Jr.y,Jr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Jr.fromBufferAttribute(this,t),Jr.applyMatrix4(e),this.setXYZ(t,Jr.x,Jr.y,Jr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Jr.fromBufferAttribute(this,t),Jr.applyNormalMatrix(e),this.setXYZ(t,Jr.x,Jr.y,Jr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Jr.fromBufferAttribute(this,t),Jr.transformDirection(e),this.setXYZ(t,Jr.x,Jr.y,Jr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Gn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Gn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Gn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Gn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array),i=Vn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array),i=Vn(i,this.array),r=Vn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==gn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class es extends $r{constructor(e,t,n){super(new Int8Array(e),t,n)}}class ts extends $r{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class ns extends $r{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class is extends $r{constructor(e,t,n){super(new Int16Array(e),t,n)}}class rs extends $r{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class ss extends $r{constructor(e,t,n){super(new Int32Array(e),t,n)}}class os extends $r{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class as extends $r{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Yr(this.array[e*this.itemSize]);return this.normalized&&(t=Gn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize]=Xr(t),this}getY(e){let t=Yr(this.array[e*this.itemSize+1]);return this.normalized&&(t=Gn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize+1]=Xr(t),this}getZ(e){let t=Yr(this.array[e*this.itemSize+2]);return this.normalized&&(t=Gn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize+2]=Xr(t),this}getW(e){let t=Yr(this.array[e*this.itemSize+3]);return this.normalized&&(t=Gn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Vn(t,this.array)),this.array[e*this.itemSize+3]=Xr(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array)),this.array[e+0]=Xr(t),this.array[e+1]=Xr(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array),i=Vn(i,this.array)),this.array[e+0]=Xr(t),this.array[e+1]=Xr(n),this.array[e+2]=Xr(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array),i=Vn(i,this.array),r=Vn(r,this.array)),this.array[e+0]=Xr(t),this.array[e+1]=Xr(n),this.array[e+2]=Xr(i),this.array[e+3]=Xr(r),this}}class ls extends $r{constructor(e,t,n){super(new Float32Array(e),t,n)}}class cs extends $r{constructor(e,t,n){super(new Float64Array(e),t,n)}}let us=0;const ds=new Zi,hs=new xr,ps=new wi,fs=new Ci,ms=new Ci,gs=new wi;class _s extends Pn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:us++}),this.uuid=On(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Xn(e)?os:rs)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Wn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ds.makeRotationFromQuaternion(e),this.applyMatrix4(ds),this}rotateX(e){return ds.makeRotationX(e),this.applyMatrix4(ds),this}rotateY(e){return ds.makeRotationY(e),this.applyMatrix4(ds),this}rotateZ(e){return ds.makeRotationZ(e),this.applyMatrix4(ds),this}translate(e,t,n){return ds.makeTranslation(e,t,n),this.applyMatrix4(ds),this}scale(e,t,n){return ds.makeScale(e,t,n),this.applyMatrix4(ds),this}lookAt(e){return hs.lookAt(e),hs.updateMatrix(),this.applyMatrix4(hs.matrix),this}center(e=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(ps).negate(),this.translate(ps.x,ps.y,ps.z),e&&e.copy(ps),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ls(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ci);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new wi(-1/0,-1/0,-1/0),new wi(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];fs.setFromBufferAttribute(e),this.morphTargetsRelative?(gs.addVectors(this.boundingBox.min,fs.min),this.boundingBox.expandByPoint(gs),gs.addVectors(this.boundingBox.max,fs.max),this.boundingBox.expandByPoint(gs)):(this.boundingBox.expandByPoint(fs.min),this.boundingBox.expandByPoint(fs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Vi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new wi,1/0);if(e){const n=this.boundingSphere.center;if(fs.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];ms.setFromBufferAttribute(n),this.morphTargetsRelative?(gs.addVectors(fs.min,ms.min),fs.expandByPoint(gs),gs.addVectors(fs.max,ms.max),fs.expandByPoint(gs)):(fs.expandByPoint(ms.min),fs.expandByPoint(ms.max))}fs.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)gs.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(gs));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)gs.fromBufferAttribute(s,t),o&&(ps.fromBufferAttribute(e,t),gs.add(ps)),i=Math.max(i,n.distanceToSquared(gs))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new $r(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let C=0;C<o;C++)l[C]=new wi,c[C]=new wi;const u=new wi,d=new wi,h=new wi,p=new Qn,f=new Qn,m=new Qn,g=new wi,_=new wi;function v(e,t,n){u.fromArray(i,3*e),d.fromArray(i,3*t),h.fromArray(i,3*n),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*n),d.sub(u),h.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(h,-f.y).multiplyScalar(r),_.copy(h).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(_),c[t].add(_),c[n].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let C=0,S=y.length;C<S;++C){const e=y[C],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)v(n[i+0],n[i+1],n[i+2])}const b=new wi,A=new wi,w=new wi,x=new wi;function E(e){w.fromArray(r,3*e),x.copy(w);const t=l[e];b.copy(t),b.sub(w.multiplyScalar(w.dot(t))).normalize(),A.crossVectors(x,t);const n=A.dot(c[e])<0?-1:1;a[4*e]=b.x,a[4*e+1]=b.y,a[4*e+2]=b.z,a[4*e+3]=n}for(let C=0,S=y.length;C<S;++C){const e=y[C],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)E(n[i+0]),E(n[i+1]),E(n[i+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new $r(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new wi,r=new wi,s=new wi,o=new wi,a=new wi,l=new wi,c=new wi,u=new wi;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);i.fromBufferAttribute(t,h),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),o.fromBufferAttribute(n,h),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(h,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)gs.fromBufferAttribute(e,t),gs.normalize(),e.setXYZ(t,gs.x,gs.y,gs.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let o=0,a=0;for(let l=0,c=t.length;l<c;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)s[a++]=n[o++]}return new $r(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new _s,n=this.index.array,i=this.attributes;for(const o in i){const r=e(i[o],n);t.setAttribute(o,r)}const r=this.morphAttributes;for(const o in r){const i=[],s=r[o];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);i.push(r)}t.morphAttributes[o]=i}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,a=s.length;o<a;o++){const e=s[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a];e.data.attributes[a]=t.toJSON(e.data)}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let l=0,c=s.length;l<c;l++){const e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const vs=new Zi,ys=new Ji,bs=new Vi,As=new wi,ws=new wi,xs=new wi,Es=new wi,Cs=new wi,Ss=new wi,Ms=new Qn,Ts=new Qn,Is=new Qn,Ps=new wi,Rs=new wi,Ds=new wi,ks=new wi,Bs=new wi;class Os extends xr{constructor(e=new _s,t=new Qr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.isMesh?(void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this):this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(r&&o){Ss.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=o[n],a=r[n];0!==i&&(Cs.fromBufferAttribute(a,e),s?Ss.addScaledVector(Cs,i):Ss.addScaledVector(Cs.sub(t),i))}t.add(Ss)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),bs.copy(n.boundingSphere),bs.applyMatrix4(r),ys.copy(e.ray).recast(e.near),!1===bs.containsPoint(ys.origin)){if(null===ys.intersectSphere(bs,As))return;if(ys.origin.distanceToSquared(As)>(e.far-e.near)**2)return}vs.copy(r).invert(),ys.copy(e.ray).applyMatrix4(vs),null!==n.boundingBox&&!1===ys.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,ys)}}_computeIntersections(e,t,n){let i;const r=this.geometry,s=this.material,o=r.index,a=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,d=r.groups,h=r.drawRange;if(null!==o)if(Array.isArray(s))for(let p=0,f=d.length;p<f;p++){const r=d[p],a=s[r.materialIndex];for(let s=Math.max(r.start,h.start),d=Math.min(o.count,Math.min(r.start+r.count,h.start+h.count));s<d;s+=3)i=Ls(this,a,e,n,l,c,u,o.getX(s),o.getX(s+1),o.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,t.push(i))}else for(let p=Math.max(0,h.start),f=Math.min(o.count,h.start+h.count);p<f;p+=3)i=Ls(this,s,e,n,l,c,u,o.getX(p),o.getX(p+1),o.getX(p+2)),i&&(i.faceIndex=Math.floor(p/3),t.push(i));else if(void 0!==a)if(Array.isArray(s))for(let p=0,f=d.length;p<f;p++){const r=d[p],o=s[r.materialIndex];for(let s=Math.max(r.start,h.start),d=Math.min(a.count,Math.min(r.start+r.count,h.start+h.count));s<d;s+=3)i=Ls(this,o,e,n,l,c,u,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,t.push(i))}else for(let p=Math.max(0,h.start),f=Math.min(a.count,h.start+h.count);p<f;p+=3)i=Ls(this,s,e,n,l,c,u,p,p+1,p+2),i&&(i.faceIndex=Math.floor(p/3),t.push(i))}}function Ls(e,t,n,i,r,s,o,a,l,c){e.getVertexPosition(a,ws),e.getVertexPosition(l,xs),e.getVertexPosition(c,Es);const u=function(e,t,n,i,r,s,o,a){let l;if(l=t.side===m?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,t.side===f,a),null===l)return null;Bs.copy(a),Bs.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Bs);return c<n.near||c>n.far?null:{distance:c,point:Bs.clone(),object:e}}(e,t,n,i,ws,xs,Es,ks);if(u){r&&(Ms.fromBufferAttribute(r,a),Ts.fromBufferAttribute(r,l),Is.fromBufferAttribute(r,c),u.uv=Or.getInterpolation(ks,ws,xs,Es,Ms,Ts,Is,new Qn)),s&&(Ms.fromBufferAttribute(s,a),Ts.fromBufferAttribute(s,l),Is.fromBufferAttribute(s,c),u.uv1=Or.getInterpolation(ks,ws,xs,Es,Ms,Ts,Is,new Qn),u.uv2=u.uv1),o&&(Ps.fromBufferAttribute(o,a),Rs.fromBufferAttribute(o,l),Ds.fromBufferAttribute(o,c),u.normal=Or.getInterpolation(ks,ws,xs,Es,Ps,Rs,Ds,new wi),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const e={a:a,b:l,c:c,normal:new wi,materialIndex:0};Or.getNormal(ws,xs,Es,e.normal),u.face=e}return u}class Us extends _s{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],u=[];let d=0,h=0;function p(e,t,n,i,r,s,p,f,m,g,_){const v=s/m,y=p/g,b=s/2,A=p/2,w=f/2,x=m+1,E=g+1;let C=0,S=0;const M=new wi;for(let o=0;o<E;o++){const s=o*y-A;for(let a=0;a<x;a++){const d=a*v-b;M[e]=d*i,M[t]=s*r,M[n]=w,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(a/m),u.push(1-o/g),C+=1}}for(let o=0;o<g;o++)for(let e=0;e<m;e++){const t=d+e+x*o,n=d+e+x*(o+1),i=d+(e+1)+x*(o+1),r=d+(e+1)+x*o;a.push(t,n,r),a.push(n,i,r),S+=6}o.addGroup(h,S,_),h+=S,d+=C}p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new ls(l,3)),this.setAttribute("normal",new ls(c,3)),this.setAttribute("uv",new ls(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Us(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ns(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Fs(e){const t={};for(let n=0;n<e.length;n++){const i=Ns(e[n]);for(const e in i)t[e]=i[e]}return t}function js(e){return null===e.getRenderTarget()?e.outputColorSpace:Gt}const zs={clone:Ns,merge:Fs};class Gs extends Ur{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ns(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Vs extends xr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Zi,this.projectionMatrix=new Zi,this.projectionMatrixInverse=new Zi,this.coordinateSystem=Tn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Hs extends Vs{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Bn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*kn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Bn*Math.atan(Math.tan(.5*kn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*kn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/o,i*=s.width/e,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Qs=-90;class Ws extends xr{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null;const i=new Hs(Qs,1,e,t);i.layers=this.layers,this.add(i);const r=new Hs(Qs,1,e,t);r.layers=this.layers,this.add(r);const s=new Hs(Qs,1,e,t);s.layers=this.layers,this.add(s);const o=new Hs(Qs,1,e,t);o.layers=this.layers,this.add(o);const a=new Hs(Qs,1,e,t);a.layers=this.layers,this.add(a);const l=new Hs(Qs,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,s,o,a]=t;for(const l of t)this.remove(l);if(e===Tn)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==In)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,r,s,o,a,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,d=e.xr.enabled;e.toneMapping=J,e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=d,n.texture.needsPMREMUpdate=!0}}class qs extends pi{constructor(e,t,n,i,r,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:re,n,i,r,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Xs extends mi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];void 0!==t.encoding&&($n("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Ot?zt:jt),this.texture=new qs(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:_e}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Us(5,5,5),o=new Gs({name:"CubemapFromEquirect",uniforms:Ns(n),vertexShader:i,fragmentShader:r,side:m,blending:v});o.uniforms.tEquirect.value=t;const a=new Os(s,o),l=t.minFilter;return t.minFilter===be&&(t.minFilter=_e),new Ws(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}}const Ys=new wi,Ks=new wi,Js=new Wn;class Zs{constructor(e=new wi(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Ys.subVectors(n,t).cross(Ks.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Ys),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Js.getNormalMatrix(e),i=this.coplanarPoint(Ys).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const $s=new Vi,eo=new wi;class to{constructor(e=new Zs,t=new Zs,n=new Zs,i=new Zs,r=new Zs,s=new Zs){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Tn){const n=this.planes,i=e.elements,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],h=i[8],p=i[9],f=i[10],m=i[11],g=i[12],_=i[13],v=i[14],y=i[15];if(n[0].setComponents(a-r,d-l,m-h,y-g).normalize(),n[1].setComponents(a+r,d+l,m+h,y+g).normalize(),n[2].setComponents(a+s,d+c,m+p,y+_).normalize(),n[3].setComponents(a-s,d-c,m-p,y-_).normalize(),n[4].setComponents(a-o,d-u,m-f,y-v).normalize(),t===Tn)n[5].setComponents(a+o,d+u,m+f,y+v).normalize();else{if(t!==In)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(o,u,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),$s.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),$s.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere($s)}intersectsSprite(e){return $s.center.set(0,0,0),$s.radius=.7071067811865476,$s.applyMatrix4(e.matrixWorld),this.intersectsSphere($s)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(eo.x=i.normal.x>0?e.max.x:e.min.x,eo.y=i.normal.y>0?e.max.y:e.min.y,eo.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(eo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function no(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function io(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,function(t,i){const r=t.array,s=t.usage,o=e.createBuffer();let a;if(e.bindBuffer(i,o),e.bufferData(i,r,s),t.onUploadCallback(),r instanceof Float32Array)a=e.FLOAT;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=e.HALF_FLOAT}else a=e.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=e.SHORT;else if(r instanceof Uint32Array)a=e.UNSIGNED_INT;else if(r instanceof Int32Array)a=e.INT;else if(r instanceof Int8Array)a=e.BYTE;else if(r instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=e.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,i,r){const s=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(n?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),i.onUploadCallback()}(s.buffer,t,r),s.version=t.version)}}}class ro extends _s{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,o=Math.floor(n),a=Math.floor(i),l=o+1,c=a+1,u=e/o,d=t/a,h=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*d-s;for(let t=0;t<l;t++){const n=t*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/o),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let e=0;e<o;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;h.push(t,n,r),h.push(n,i,r)}this.setIndex(h),this.setAttribute("position",new ls(p,3)),this.setAttribute("normal",new ls(f,3)),this.setAttribute("uv",new ls(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ro(e.width,e.height,e.widthSegments,e.heightSegments)}}const so={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\t#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1\n\tdiffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;\n\t#else\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n\t#endif\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\treflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tmat4 rotationMatrix(vec3 axis, float angle) {\n\t\taxis = normalize(axis);\n\t\tfloat s = sin(angle);\n\t\tfloat c = cos(angle);\n\t\tfloat oc = 1.0 - c;\n\t\treturn mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n\t\t\t\t\toc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n\t\t\t\t\toc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n\t\t\t\t\t0.0,                                0.0,                                0.0,                                1.0);\n\t}\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform float envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t#if defined( FIX_ENV_DIRECTION )\n\t\t\tvec3 worldNormal = normal;\n\t\t#else\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#endif\n\t\t\tworldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#if !defined( FIX_ENV_DIRECTION )\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\t#endif\n\t\t\treflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\ndiffuseColor.a = min(max(diffuseColor.a, 0.), 1.);\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\t#ifndef WebGL2Context\n\t#define textureLod texture2DLodEXT\n\t#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))\n\t#define isinf(x) (x > 1e20 || x < -1e20)\n\t#endif\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tif(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"#ifdef HAS_TEXTURE\nvarying vec2 vUv;\nuniform mat3 uvTransform;\nuniform bool flipX;\nuniform bool flipY;\n#endif\nvoid main() {\n#ifdef HAS_TEXTURE\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;\n    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;\n#endif\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"#ifdef HAS_TEXTURE\nuniform sampler2D t2D;\nvarying vec2 vUv;\n#endif\nuniform float backgroundIntensity;\nuniform vec3 backgroundColor;\nvoid main() {\n#ifdef HAS_TEXTURE\n\tvec4 texColor = texture2D( t2D, vUv );\n#else\n\tvec4 texColor = vec4( 1.0 );\n#endif\n\ttexColor.rgb *= backgroundColor * backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#include <envmap_common_pars_fragment>\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\tvReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\ttexColor.rgb *= envMapIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},oo={common:{diffuse:{value:new Vr(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Wn},alphaMap:{value:null},alphaMapTransform:{value:new Wn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Wn}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Wn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Wn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Wn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Wn},normalScale:{value:new Qn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Wn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Wn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Wn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Wn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Vr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Vr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Wn},alphaTest:{value:0},uvTransform:{value:new Wn}},sprite:{diffuse:{value:new Vr(16777215)},opacity:{value:1},center:{value:new Qn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Wn},alphaMap:{value:null},alphaMapTransform:{value:new Wn},alphaTest:{value:0}}},ao={basic:{uniforms:Fs([oo.common,oo.specularmap,oo.envmap,oo.aomap,oo.lightmap,oo.fog]),vertexShader:so.meshbasic_vert,fragmentShader:so.meshbasic_frag},lambert:{uniforms:Fs([oo.common,oo.specularmap,oo.envmap,oo.aomap,oo.lightmap,oo.emissivemap,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.fog,oo.lights,{emissive:{value:new Vr(0)}}]),vertexShader:so.meshlambert_vert,fragmentShader:so.meshlambert_frag},phong:{uniforms:Fs([oo.common,oo.specularmap,oo.envmap,oo.aomap,oo.lightmap,oo.emissivemap,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.fog,oo.lights,{emissive:{value:new Vr(0)},specular:{value:new Vr(1118481)},shininess:{value:30}}]),vertexShader:so.meshphong_vert,fragmentShader:so.meshphong_frag},standard:{uniforms:Fs([oo.common,oo.envmap,oo.aomap,oo.lightmap,oo.emissivemap,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.roughnessmap,oo.metalnessmap,oo.fog,oo.lights,{emissive:{value:new Vr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:so.meshphysical_vert,fragmentShader:so.meshphysical_frag},toon:{uniforms:Fs([oo.common,oo.aomap,oo.lightmap,oo.emissivemap,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.gradientmap,oo.fog,oo.lights,{emissive:{value:new Vr(0)}}]),vertexShader:so.meshtoon_vert,fragmentShader:so.meshtoon_frag},matcap:{uniforms:Fs([oo.common,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.fog,{matcap:{value:null}}]),vertexShader:so.meshmatcap_vert,fragmentShader:so.meshmatcap_frag},points:{uniforms:Fs([oo.points,oo.fog]),vertexShader:so.points_vert,fragmentShader:so.points_frag},dashed:{uniforms:Fs([oo.common,oo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:so.linedashed_vert,fragmentShader:so.linedashed_frag},depth:{uniforms:Fs([oo.common,oo.displacementmap]),vertexShader:so.depth_vert,fragmentShader:so.depth_frag},normal:{uniforms:Fs([oo.common,oo.bumpmap,oo.normalmap,oo.displacementmap,{opacity:{value:1}}]),vertexShader:so.meshnormal_vert,fragmentShader:so.meshnormal_frag},sprite:{uniforms:Fs([oo.sprite,oo.fog]),vertexShader:so.sprite_vert,fragmentShader:so.sprite_frag},background:{uniforms:{uvTransform:{value:new Wn},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new Vr(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:so.background_vert,fragmentShader:so.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:so.backgroundCube_vert,fragmentShader:so.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:so.cube_vert,fragmentShader:so.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:so.equirect_vert,fragmentShader:so.equirect_frag},distanceRGBA:{uniforms:Fs([oo.common,oo.displacementmap,{referencePosition:{value:new wi},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:so.distanceRGBA_vert,fragmentShader:so.distanceRGBA_frag},shadow:{uniforms:Fs([oo.lights,oo.fog,{color:{value:new Vr(0)},opacity:{value:1}}]),vertexShader:so.shadow_vert,fragmentShader:so.shadow_frag}};ao.physical={uniforms:Fs([ao.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Wn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Wn},clearcoatNormalScale:{value:new Qn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Wn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Wn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Wn},sheen:{value:0},sheenColor:{value:new Vr(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Wn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Wn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Wn},transmissionSamplerSize:{value:new Qn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Wn},attenuationDistance:{value:0},attenuationColor:{value:new Vr(0)},specularColor:{value:new Vr(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Wn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Wn},anisotropyVector:{value:new Qn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Wn}}]),vertexShader:so.meshphysical_vert,fragmentShader:so.meshphysical_frag};const lo={r:0,b:0,g:0};function co(e,t,n,i,r,s,o){const a=new Vr(0);let l,c,u=!0===s?0:1,d=null,h=0,p=null;function g(t,n){t.getRGB(lo,js(e)),i.buffers.color.setClear(lo.r,lo.g,lo.b,n,o)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),u=t,g(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,g(a,u)},getPlaneMesh:function(){return l},getBoxMesh:function(){return c},getBoxMesh2:function(){return void 0===c&&(c=new Os(new Us(1,1,1),new Gs({name:"BackgroundCubeMaterial",uniforms:Ns(ao.backgroundCube.uniforms),vertexShader:ao.backgroundCube.vertexShader,fragmentShader:ao.backgroundCube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c},render:function(s,_){let v=!1,y=!0===_.isScene?_.background:null;const b=_.isScene&&void 0!==_.backgroundColor?_.backgroundColor:null;switch("environment"===y&&(y=_.environment),y&&y.isTexture&&(y=(_.backgroundBlurriness>0?n:t).get(y)),null===y?g(a,u):y&&y.isColor&&(g(y,1),v=!0),e.xr.getEnvironmentBlendMode()){case"opaque":v=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,o),v=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,o),v=!0}if((e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||y.mapping===le))void 0===c&&(c=new Os(new Us(1,1,1),new Gs({name:"BackgroundCubeMaterial",uniforms:Ns(ao.backgroundCube.uniforms),vertexShader:ao.backgroundCube.vertexShader,fragmentShader:ao.backgroundCube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.envMapRotation.value=y&&y.rotation||0,c.material.uniforms.envMapIntensity.value=y===_.environment&&_.envMapIntensity||1,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.toneMapped=y.colorSpace!==zt,d===y&&h===y.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=y,h=y.version,p=e.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null);else if(y&&y.isTexture||!y&&b){void 0===l&&(l=new Os(new ro(2,2),new Gs({name:"BackgroundMaterial",uniforms:Ns(ao.background.uniforms),vertexShader:ao.background.vertexShader,fragmentShader:ao.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.backgroundColor.value.set(b||16777215),l.material.uniforms.t2D.value=y,l.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,y?(l.material.toneMapped=y.colorSpace!==zt,l.material.uniforms.flipX.value=y.userData.flipX||!1,l.material.uniforms.flipY.value=y.userData.flipY||!1,!0===y.matrixAutoUpdate&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),l.material.defines.HAS_TEXTURE="1"):l.material.defines.HAS_TEXTURE&&delete l.material.defines.HAS_TEXTURE;const t=y?y.version:-1;d===y&&h===t&&p===e.toneMapping||(l.material.needsUpdate=!0,d=y,h=t,p=e.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null)}}}}function uo(e,t,n,i){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=p(null);let c=l,u=!1;function d(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let s=0;s<r;s++)t[s]=0,n[s]=0,i[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,r){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),a[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r)}function _(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,i,r,s,o,a){!0===a?e.vertexAttribIPointer(t,n,i,s,o):e.vertexAttribPointer(t,n,i,r,s,o)}function y(){b(),u=!0,c!==l&&(c=l,d(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,b){let A=!1;if(o){const t=function(t,n,r){const o=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];return void 0===u&&(u=p(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(y,h,l);c!==t&&(c=t,d(c.object)),A=function(e,t,n,i){const r=c.attributes,s=t.attributes;let o=0;const a=n.getAttributes();for(const l in a)if(a[l].location>=0){const t=r[l];let n=s[l];if(void 0===n&&("instanceMatrix"===l&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}return c.attributesNum!==o||c.index!==i}(r,y,h,b),A&&function(e,t,n,i){const r={},s=t.attributes;let o=0;const a=n.getAttributes();for(const l in a)if(a[l].location>=0){let t=s[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[l]=n,o++}c.attributes=r,c.attributesNum=o,c.index=i}(r,y,h,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,A=!0)}null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),(A||u)&&(u=!1,function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const t in c){const s=c[t];if(s.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&r.instanceMatrix&&(o=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(o=r.instanceColor)),void 0!==o){const t=o.normalized,l=o.itemSize,c=n.get(o);if(void 0===c)continue;const u=c.buffer,d=c.type,h=c.bytesPerElement,p=!0===i.isWebGL2&&(d===e.INT||d===e.UNSIGNED_INT||o.gpuType===Se);if(o.isInterleavedBufferAttribute){const n=o.data,i=n.stride,c=o.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)g(s.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,d,t,i*h,(c+l/s.locationSize*e)*h,p)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)g(s.location+e,o.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,d,t,l*h,l/s.locationSize*e*h,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(s.location,n);break;case 3:e.vertexAttrib3fv(s.location,n);break;case 4:e.vertexAttrib4fv(s.location,n);break;default:e.vertexAttrib1fv(s.location,n)}}}}_()}(r,l,h,y),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const n in t){const e=t[n];for(const t in e)h(e[t].object),delete e[t];delete t[n]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)h(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function ho(e,t,n,i){const r=i.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,i){e.drawArrays(s,t,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,o,a),n.update(o,s,a)}}function po(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=d>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}function fo(e){const t=this;let n=null,i=0,r=!1,s=!1;const o=new Zs,a=new Wn,l={value:null,needsUpdate:!1};function c(e,n,i,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==s;++n,l+=4)o.copy(e[n]).applyMatrix4(r,a),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,a,u){const d=o.clippingPlanes,h=o.clipIntersection,p=o.clipShadows,f=e.get(o);if(!r||null===d||0===d.length||s&&!p)s?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0);else{const e=s?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(d,a,t,u);for(let i=0;i!==t;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function mo(e){let t=new WeakMap;function n(e,t){return t===oe?e.mapping=re:t===ae&&(e.mapping=se),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===oe||s===ae){if(t.has(r)){const e=t.get(r).texture;return e.rotation=r.rotation,n(e,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=new Xs(s.height/2);return o.fromEquirectangularTexture(e,r),o.texture.rotation=r.rotation,t.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class go extends Vs{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,o=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const _o=[.125,.215,.35,.446,.526,.582],vo=20,yo=new go,bo=new Vr;let Ao=null;const wo=(1+Math.sqrt(5))/2,xo=1/wo,Eo=[new wi(1,1,1),new wi(-1,1,1),new wi(1,1,-1),new wi(-1,1,-1),new wi(0,wo,xo),new wi(0,wo,-xo),new wi(xo,0,wo),new wi(-xo,0,wo),new wi(wo,xo,0),new wi(-wo,xo,0)];class Co{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Ao=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Io(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=To(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ao),e.scissorTest=!1,Mo(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===re||e.mapping===se?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ao=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:_e,minFilter:_e,generateMipmaps:!1,type:Ie,format:Be,colorSpace:Gt,depthBuffer:!1},i=So(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=So(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const s=e-4+1+_o.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>e-4?a=_o[o-e+4-1]:0===o&&(a=0),i.push(a);const l=1/(s-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*h),v=new Float32Array(m*p*h),y=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];_.set(i,f*p*e),v.set(d,m*p*e);const r=[e,e,e,e,e,e];y.set(r,g*p*e)}const b=new _s;b.setAttribute("position",new $r(_,f)),b.setAttribute("uv",new $r(v,m)),b.setAttribute("faceIndex",new $r(y,g)),t.push(b),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(vo),r=new wi(0,1,0);return new Gs({name:"SphericalGaussianBlur",defines:{n:vo,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){const t=new Os(this._lodPlanes[0],e);this._renderer.compile(t,yo)}_sceneToCubeUV(e,t,n,i){const r=new Hs(90,1,t,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(bo),a.toneMapping=J,a.autoClear=!1;const u=new Qr({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),d=new Os(new Us,u);let h=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,h=!0):(u.color.copy(bo),h=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(r.up.set(0,s[f],0),r.lookAt(o[f],0,0)):1===t?(r.up.set(0,0,s[f]),r.lookAt(0,o[f],0)):(r.up.set(0,s[f],0),r.lookAt(0,0,o[f]));const n=this._cubeSize;Mo(i,t*n,f>2?n:0,n,n),a.setRenderTarget(i),h&&a.render(d,r),a.render(e,r)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===re||e.mapping===se;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Io()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=To());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Os(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const o=this._cubeSize;Mo(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(s,yo)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=Eo[(i-1)%Eo.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Os(this._lodPlanes[i],l),u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/h,f=isFinite(r)?1+Math.floor(3*p):vo;f>vo&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let y=0;y<vo;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=h,u.mipInt.value=_-n;const v=this._sizeLods[i];Mo(t,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(t),a.render(c,yo)}}function So(e,t,n){const i=new mi(e,t,n);return i.texture.mapping=le,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Mo(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function To(){return new Gs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function Io(){return new Gs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function Po(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=s===oe||s===ae,a=s===re||s===se;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new Co(e)),i=o?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(s)){null===n&&(n=new Co(e));const s=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ro(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Do(e,t,n,i){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const n in a.attributes)t.remove(a.attributes[n]);for(const n in a.morphAttributes){const e=a.morphAttributes[n];for(let n=0,i=e.length;n<i;n++)t.remove(e[n])}a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let o=0;if(null!==i){const e=i.array;o=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{const e=r.array;o=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const a=new(Xn(n)?os:rs)(n,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const s in i)t.update(i[s],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const s in r){const n=r[s];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return s.get(e)}}}function ko(e,t,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(s,i,o,t*a),n.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,d;if(r)u=e,d="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](s,l,o,i*a,c),n.update(l,s,c)}}function Bo(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Oo(e,t){return e[0]-t[0]}function Lo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Uo(e,t,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new fi,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function(l,c,u){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const i=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==i?i.length:0;let a=s.get(c);if(void 0===a||a.count!==r){void 0!==a&&a.texture.dispose();const e=void 0!==c.morphAttributes.position,n=void 0!==c.morphAttributes.normal,i=void 0!==c.morphAttributes.color,l=c.morphAttributes.position||[],u=c.morphAttributes.normal||[],d=c.morphAttributes.color||[];let h=0;!0===e&&(h=1),!0===n&&(h=2),!0===i&&(h=3);let p=c.attributes.position.count*h,f=1;p>t.maxTextureSize&&(f=Math.ceil(p/t.maxTextureSize),p=t.maxTextureSize);const m=new Float32Array(p*f*4*r),g=new gi(m,p,f,r);g.type=Te,g.needsUpdate=!0;const _=4*h;for(let t=0;t<r;t++){const r=l[t],s=u[t],a=d[t],c=p*f*4*t;for(let t=0;t<r.count;t++){const l=t*_;!0===e&&(o.fromBufferAttribute(r,t),m[c+l+0]=o.x,m[c+l+1]=o.y,m[c+l+2]=o.z,m[c+l+3]=0),!0===n&&(o.fromBufferAttribute(s,t),m[c+l+4]=o.x,m[c+l+5]=o.y,m[c+l+6]=o.z,m[c+l+7]=0),!0===i&&(o.fromBufferAttribute(a,t),m[c+l+8]=o.x,m[c+l+9]=o.y,m[c+l+10]=o.z,m[c+l+11]=4===a.itemSize?o.w:1)}}a={count:r,texture:g,size:new Qn(p,f)},s.set(c,a),c.addEventListener("dispose",(function e(){g.dispose(),s.delete(c),c.removeEventListener("dispose",e)}))}let l=0;for(let e=0;e<d.length;e++)l+=d[e];const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",h),u.getUniforms().setValue(e,"morphTargetInfluences",d),u.getUniforms().setValue(e,"morphTargetsTexture",a.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",a.size)}else{const t=void 0===d?0:d.length;let n=i[c.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];i[c.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=d[e]}n.sort(Lo);for(let e=0;e<8;e++)e<t&&n[e][1]?(a[e][0]=n[e][0],a[e][1]=n[e][1]):(a[e][0]=Number.MAX_SAFE_INTEGER,a[e][1]=0);a.sort(Oo);const s=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=a[e],n=t[0],i=t[1];n!==Number.MAX_SAFE_INTEGER&&i?(s&&c.getAttribute("morphTarget"+e)!==s[n]&&c.setAttribute("morphTarget"+e,s[n]),o&&c.getAttribute("morphNormal"+e)!==o[n]&&c.setAttribute("morphNormal"+e,o[n]),r[e]=i,l+=i):(s&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),o&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),r[e]=0)}const h=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",h),u.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function No(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const a=i.render.frame,l=o.geometry,c=t.get(o,l);return r.get(c)!==a&&(t.update(c),r.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER)),c},dispose:function(){r=new WeakMap}}}const Fo=new pi,jo=new gi,zo=new vi,Go=new qs,Vo=[],Ho=[],Qo=new Float32Array(16),Wo=new Float32Array(9),qo=new Float32Array(4);function Xo(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=Vo[r];if(void 0===s&&(s=new Float32Array(r),Vo[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function Yo(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Ko(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function Jo(e,t){let n=Ho[t];void 0===n&&(n=new Int32Array(t),Ho[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Zo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function $o(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yo(n,t))return;e.uniform2fv(this.addr,t),Ko(n,t)}}function ea(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Yo(n,t))return;e.uniform3fv(this.addr,t),Ko(n,t)}}function ta(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yo(n,t))return;e.uniform4fv(this.addr,t),Ko(n,t)}}function na(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Yo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ko(n,t)}else{if(Yo(n,i))return;qo.set(i),e.uniformMatrix2fv(this.addr,!1,qo),Ko(n,i)}}function ia(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Yo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ko(n,t)}else{if(Yo(n,i))return;Wo.set(i),e.uniformMatrix3fv(this.addr,!1,Wo),Ko(n,i)}}function ra(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Yo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ko(n,t)}else{if(Yo(n,i))return;Qo.set(i),e.uniformMatrix4fv(this.addr,!1,Qo),Ko(n,i)}}function sa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function oa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yo(n,t))return;e.uniform2iv(this.addr,t),Ko(n,t)}}function aa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Yo(n,t))return;e.uniform3iv(this.addr,t),Ko(n,t)}}function la(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yo(n,t))return;e.uniform4iv(this.addr,t),Ko(n,t)}}function ca(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function ua(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yo(n,t))return;e.uniform2uiv(this.addr,t),Ko(n,t)}}function da(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Yo(n,t))return;e.uniform3uiv(this.addr,t),Ko(n,t)}}function ha(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yo(n,t))return;e.uniform4uiv(this.addr,t),Ko(n,t)}}function pa(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||Fo,r)}function fa(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||zo,r)}function ma(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Go,r)}function ga(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||jo,r)}function _a(e,t){e.uniform1fv(this.addr,t)}function va(e,t){const n=Xo(t,this.size,2);e.uniform2fv(this.addr,n)}function ya(e,t){const n=Xo(t,this.size,3);e.uniform3fv(this.addr,n)}function ba(e,t){const n=Xo(t,this.size,4);e.uniform4fv(this.addr,n)}function Aa(e,t){const n=Xo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function wa(e,t){const n=Xo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function xa(e,t){const n=Xo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ea(e,t){e.uniform1iv(this.addr,t)}function Ca(e,t){e.uniform2iv(this.addr,t)}function Sa(e,t){e.uniform3iv(this.addr,t)}function Ma(e,t){e.uniform4iv(this.addr,t)}function Ta(e,t){e.uniform1uiv(this.addr,t)}function Ia(e,t){e.uniform2uiv(this.addr,t)}function Pa(e,t){e.uniform3uiv(this.addr,t)}function Ra(e,t){e.uniform4uiv(this.addr,t)}function Da(e,t,n){const i=this.cache,r=t.length,s=Jo(n,r);Yo(i,s)||(e.uniform1iv(this.addr,s),Ko(i,s));for(let o=0;o!==r;++o)n.setTexture2D(t[o]||Fo,s[o])}function ka(e,t,n){const i=this.cache,r=t.length,s=Jo(n,r);Yo(i,s)||(e.uniform1iv(this.addr,s),Ko(i,s));for(let o=0;o!==r;++o)n.setTexture3D(t[o]||zo,s[o])}function Ba(e,t,n){const i=this.cache,r=t.length,s=Jo(n,r);Yo(i,s)||(e.uniform1iv(this.addr,s),Ko(i,s));for(let o=0;o!==r;++o)n.setTextureCube(t[o]||Go,s[o])}function Oa(e,t,n){const i=this.cache,r=t.length,s=Jo(n,r);Yo(i,s)||(e.uniform1iv(this.addr,s),Ko(i,s));for(let o=0;o!==r;++o)n.setTexture2DArray(t[o]||jo,s[o])}class La{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Zo;case 35664:return $o;case 35665:return ea;case 35666:return ta;case 35674:return na;case 35675:return ia;case 35676:return ra;case 5124:case 35670:return sa;case 35667:case 35671:return oa;case 35668:case 35672:return aa;case 35669:case 35673:return la;case 5125:return ca;case 36294:return ua;case 36295:return da;case 36296:return ha;case 35678:case 36198:case 36298:case 36306:case 35682:return pa;case 35679:case 36299:case 36307:return fa;case 35680:case 36300:case 36308:case 36293:return ma;case 36289:case 36303:case 36311:case 36292:return ga}}(t.type)}}class Ua{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return _a;case 35664:return va;case 35665:return ya;case 35666:return ba;case 35674:return Aa;case 35675:return wa;case 35676:return xa;case 5124:case 35670:return Ea;case 35667:case 35671:return Ca;case 35668:case 35672:return Sa;case 35669:case 35673:return Ma;case 5125:return Ta;case 36294:return Ia;case 36295:return Pa;case 36296:return Ra;case 35678:case 36198:case 36298:case 36306:case 35682:return Da;case 35679:case 36299:case 36307:return ka;case 35680:case 36300:case 36308:case 36293:return Ba;case 36289:case 36303:case 36311:case 36292:return Oa}}(t.type)}}class Na{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}}}const Fa=/(\w+)(\])?(\[|\.)?/g;function ja(e,t){e.seq.push(t),e.map[t.id]=t}function za(e,t,n){const i=e.name,r=i.length;for(Fa.lastIndex=0;;){const s=Fa.exec(i),o=Fa.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===r){ja(n,void 0===c?new La(a,e,t):new Ua(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new Na(a),ja(n,e)),n=e}}}class Ga{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);za(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function Va(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let Ha=0;function Qa(e){switch(e){case jt:case Gt:return["Linear","( value )"];case zt:return["sRGB","( value )"];case Ht:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}function Wa(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let o=r;o<s;o++){const e=o+1;i.push(`${e===t?">":" "} ${e}: ${n[o]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function qa(e,t){const n=Qa(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Xa(e,t){const n=Qa(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ya(e,t){let n;switch(t){case Z:n="Linear";break;case $:n="Reinhard";break;case ee:n="OptimizedCineon";break;case te:n="ACESFilmic";break;case ne:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Ka(e){return""!==e}function Ja(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Za(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const $a=/^[ \t]*#include +<([\w\d./]+)>/gm;function el(e){return e.replace($a,tl)}function tl(e,t){const n=so[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return el(n)}const nl=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function il(e){return e.replace(nl,rl)}function rl(e,t,n,i){let r="";for(let s=parseInt(t);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function sl(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ol(e,t,n,i){const r=e.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===p&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case re:case se:t="ENVMAP_TYPE_CUBE";break;case le:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===se&&(t="ENVMAP_MODE_REFRACTION"),t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case X:t="ENVMAP_BLENDING_MULTIPLY";break;case Y:t="ENVMAP_BLENDING_MIX";break;case K:t="ENVMAP_BLENDING_ADD"}return t}(n),m=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),g=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ka).join("\n")}(n),_=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),v=r.createProgram();let y,b,A=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_].filter(Ka).join("\n"),y.length>0&&(y+="\n"),b=[g,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_].filter(Ka).join("\n"),b.length>0&&(b+="\n")):(y=[sl(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ka).join("\n"),b=[g,sl(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,_,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==J?"#define TONE_MAPPING":"",n.toneMapping!==J?so.tonemapping_pars_fragment:"",n.toneMapping!==J?Ya("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",so.encodings_pars_fragment,Xa("linearToOutputTexel",n.outputColorSpace),n.transmissionSamplerMapEncoding?qa("transmissionSamplerMapTexelToLinear",n.transmissionSamplerMapEncoding):"",n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ka).join("\n")),o=el(o),o=Ja(o,n),o=Za(o,n),a=el(a),a=Ja(a,n),a=Za(a,n),o=il(o),a=il(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(A="#version 300 es\n",y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,b=["#define varying in",n.glslVersion===Sn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Sn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join("\n")+"\n"+b);const w=A+y+o,x=A+b+a,E=Va(r,r.VERTEX_SHADER,w),C=Va(r,r.FRAGMENT_SHADER,x);if(r.attachShader(v,E),r.attachShader(v,C),void 0!==n.index0AttributeName?r.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v),e.debug.checkShaderErrors){const t=r.getProgramInfoLog(v).trim(),n=r.getShaderInfoLog(E).trim(),i=r.getShaderInfoLog(C).trim();let s=!0,o=!0;if(!1===r.getProgramParameter(v,r.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,v,E,C);else{const e=Wa(r,E,"vertex"),n=Wa(r,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==n&&""!==i||(o=!1);o&&(this.diagnostics={runnable:s,programLog:t,vertexShader:{log:n,prefix:y},fragmentShader:{log:i,prefix:b}})}let S,M;return r.deleteShader(E),r.deleteShader(C),this.getUniforms=function(){return void 0===S&&(S=new Ga(r,v)),S},this.getAttributes=function(){return void 0===M&&(M=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),s=i.name;let o=1;i.type===e.FLOAT_MAT2&&(o=2),i.type===e.FLOAT_MAT3&&(o=3),i.type===e.FLOAT_MAT4&&(o=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:o}}return n}(r,v)),M},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Ha++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=E,this.fragmentShader=C,this}let al=0;class ll{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new cl(e),t.set(e,n)),n}}class cl{constructor(e){this.id=al++,this.code=e,this.usedTimes=0}}function ul(e,t,n,i,r,s,o){const a=new cr,l=new ll,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,h=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(s,a,c,v,b){const A=v.fog,w=b.geometry,x=s.isMeshStandardMaterial?v.environment:null,E=(s.isMeshStandardMaterial?n:t).get(s.envMap||x),C=E&&E.mapping===le?E.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const M=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,T=void 0!==M?M.length:0;let I,P,R,D,k=0;if(void 0!==w.morphAttributes.position&&(k=1),void 0!==w.morphAttributes.normal&&(k=2),void 0!==w.morphAttributes.color&&(k=3),S){const e=ao[S];I=e.vertexShader,P=e.fragmentShader}else I=s.vertexShader,P=s.fragmentShader,l.update(s),R=l.getVertexShaderID(s),D=l.getFragmentShaderID(s);const B=e.getRenderTarget(),O=e.userData&&e.userData.transmissionRenderTarget,L=B?Array.isArray(B.texture)?B.texture[0]:B.texture:null,U=!0===b.isInstancedMesh,N=!!s.map,F=!!s.matcap,j=!!E,z=!!s.aoMap,G=!!s.lightMap,V=!!s.bumpMap,H=!!s.normalMap,Q=!!s.displacementMap,W=!!s.emissiveMap,q=!!s.metalnessMap,X=!!s.roughnessMap,Y=s.anisotropy>0,K=s.clearcoat>0,Z=s.iridescence>0,$=s.sheen>0,ee=s.transmission>0,te=Y&&!!s.anisotropyMap,ne=K&&!!s.clearcoatMap,ie=K&&!!s.clearcoatNormalMap,re=K&&!!s.clearcoatRoughnessMap,se=Z&&!!s.iridescenceMap,oe=Z&&!!s.iridescenceThicknessMap,ae=$&&!!s.sheenColorMap,ce=$&&!!s.sheenRoughnessMap,ue=!!s.specularMap,de=!!s.specularColorMap,he=!!s.specularIntensityMap,pe=ee&&!!s.transmissionMap,fe=ee&&!!s.thicknessMap,me=!!s.gradientMap,ge=!!s.alphaMap,_e=s.alphaTest>0,ve=!!s.extensions,ye=!!w.attributes.uv1,be=!!w.attributes.uv2,Ae=!!w.attributes.uv3;return{isWebGL2:u,shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:I,fragmentShader:P,defines:s.defines,customVertexShaderID:R,customFragmentShaderID:D,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:U,instancingColor:U&&null!==b.instanceColor,supportsVertexTextures:h,outputColorSpace:null===B?e.outputColorSpace:!0===B.isXRRenderTarget||L.colorSpace&&L.colorSpace!==zt?L.colorSpace:Gt,map:N,matcap:F,envMap:j,envMapMode:j&&E.mapping,envMapCubeUVHeight:C,aoMap:z,lightMap:G,bumpMap:V,normalMap:H,displacementMap:h&&Q,emissiveMap:W,normalMapObjectSpace:H&&s.normalMapType===Ft,normalMapTangentSpace:H&&s.normalMapType===Nt,metalnessMap:q,roughnessMap:X,anisotropy:Y,anisotropyMap:te,clearcoat:K,clearcoatMap:ne,clearcoatNormalMap:ie,clearcoatRoughnessMap:re,iridescence:Z,iridescenceMap:se,iridescenceThicknessMap:oe,sheen:$,sheenColorMap:ae,sheenRoughnessMap:ce,specularMap:ue,specularColorMap:de,specularIntensityMap:he,transmission:ee,transmissionMap:pe,thicknessMap:fe,transmissionSamplerMapEncoding:O&&O.texture.colorSpace||Gt,gradientMap:me,opaque:!1===s.transparent&&s.blending===y&&!(s.transmission>0),alphaMap:ge,alphaTest:_e,combine:s.combine,mapUv:N&&_(s.map.channel),aoMapUv:z&&_(s.aoMap.channel),lightMapUv:G&&_(s.lightMap.channel),bumpMapUv:V&&_(s.bumpMap.channel),normalMapUv:H&&_(s.normalMap.channel),displacementMapUv:Q&&_(s.displacementMap.channel),emissiveMapUv:W&&_(s.emissiveMap.channel),metalnessMapUv:q&&_(s.metalnessMap.channel),roughnessMapUv:X&&_(s.roughnessMap.channel),anisotropyMapUv:te&&_(s.anisotropyMap.channel),clearcoatMapUv:ne&&_(s.clearcoatMap.channel),clearcoatNormalMapUv:ie&&_(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:re&&_(s.clearcoatRoughnessMap.channel),iridescenceMapUv:se&&_(s.iridescenceMap.channel),iridescenceThicknessMapUv:oe&&_(s.iridescenceThicknessMap.channel),sheenColorMapUv:ae&&_(s.sheenColorMap.channel),sheenRoughnessMapUv:ce&&_(s.sheenRoughnessMap.channel),specularMapUv:ue&&_(s.specularMap.channel),specularColorMapUv:de&&_(s.specularColorMap.channel),specularIntensityMapUv:he&&_(s.specularIntensityMap.channel),transmissionMapUv:pe&&_(s.transmissionMap.channel),thicknessMapUv:fe&&_(s.thicknessMap.channel),alphaMapUv:ge&&_(s.alphaMap.channel),vertexTangents:!!w.attributes.tangent&&(H||Y),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!w.attributes.color&&4===w.attributes.color.itemSize,vertexUv1s:ye,vertexUv2s:be,vertexUv3s:Ae,pointsUvs:!0===b.isPoints&&!!w.attributes.uv&&(N||ge),fog:!!A,useFog:!0===s.fog,fogExp2:A&&A.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===b.isSkinnedMesh,morphTargets:void 0!==w.morphAttributes.position,morphNormals:void 0!==w.morphAttributes.normal,morphColors:void 0!==w.morphAttributes.color,morphTargetsCount:T,morphTextureStride:k,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:J,useLegacyLights:e.useLegacyLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===g,flipSided:s.side===m,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:ve&&!0===s.extensions.derivatives,extensionFragDepth:ve&&!0===s.extensions.fragDepth,extensionDrawBuffers:ve&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:ve&&!0===s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0),t.supportsVertexTextures&&a.enable(1),t.instancing&&a.enable(2),t.instancingColor&&a.enable(3),t.matcap&&a.enable(4),t.envMap&&a.enable(5),t.normalMapObjectSpace&&a.enable(6),t.normalMapTangentSpace&&a.enable(7),t.clearcoat&&a.enable(8),t.iridescence&&a.enable(9),t.alphaTest&&a.enable(10),t.vertexColors&&a.enable(11),t.vertexAlphas&&a.enable(12),t.vertexUv1s&&a.enable(13),t.vertexUv2s&&a.enable(14),t.vertexUv3s&&a.enable(15),t.vertexTangents&&a.enable(16),t.anisotropy&&a.enable(17),e.push(a.mask),a.disableAll(),t.fog&&a.enable(0),t.useFog&&a.enable(1),t.flatShading&&a.enable(2),t.logarithmicDepthBuffer&&a.enable(3),t.skinning&&a.enable(4),t.morphTargets&&a.enable(5),t.morphNormals&&a.enable(6),t.morphColors&&a.enable(7),t.premultipliedAlpha&&a.enable(8),t.shadowMapEnabled&&a.enable(9),t.useLegacyLights&&a.enable(10),t.doubleSided&&a.enable(11),t.flipSided&&a.enable(12),t.useDepthPacking&&a.enable(13),t.dithering&&a.enable(14),t.transmission&&a.enable(15),t.sheen&&a.enable(16),t.opaque&&a.enable(17),t.pointsUvs&&a.enable(18),e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=ao[t];n=zs.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=c.length;e<r;e++){const t=c[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new ol(e,n,t,s),c.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function dl(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function hl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function pl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function fl(){const e=[];let t=0;const n=[],i=[],r=[];function s(n,i,r,s,o,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||hl),i.length>1&&i.sort(t||pl),r.length>1&&r.sort(t||pl)}}}function ml(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new fl,e.set(t,[r])):n>=i.length?(r=new fl,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function gl(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new wi,color:new Vr};break;case"SpotLight":n={position:new wi,direction:new wi,color:new Vr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new wi,color:new Vr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new wi,skyColor:new Vr,groundColor:new Vr};break;case"RectAreaLight":n={color:new Vr,position:new wi,halfWidth:new wi,halfHeight:new wi}}return e[t.id]=n,n}}}let _l=0;function vl(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function yl(e,t){const n=new gl,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)r.probe.push(new wi);const s=new wi,o=new Zi,a=new Zi;return{setup:function(s,o){let a=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,d=0,h=0,p=0,f=0,m=0,g=0,_=0,v=0,y=0;s.sort(vl);const b=!0===o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,A=t.intensity,w=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*A*b,l+=o.g*A*b,c+=o.b*A*b;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],A);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=x,r.directionalShadowMatrix[u]=t.shadow.matrix,m++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(A*b),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[h]=e;const s=t.shadow;if(t.map&&(r.spotLightMap[v]=t.map,v++,s.updateMatrices(t),t.castShadow&&y++),r.spotLightMatrix[h]=s.matrix,t.castShadow){const e=i.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[h]=e,r.spotShadowMap[h]=x,_++}h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(A),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[d]=n,r.pointShadowMap[d]=x,r.pointShadowMatrix[d]=t.shadow.matrix,g++}r.point[d]=e,d++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(A*b),e.groundColor.copy(t.groundColor).multiplyScalar(A*b),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=oo.LTC_FLOAT_1,r.rectAreaLTC2=oo.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=oo.LTC_HALF_1,r.rectAreaLTC2=oo.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=c;const A=r.hash;A.directionalLength===u&&A.pointLength===d&&A.spotLength===h&&A.rectAreaLength===p&&A.hemiLength===f&&A.numDirectionalShadows===m&&A.numPointShadows===g&&A.numSpotShadows===_&&A.numSpotMaps===v||(r.directional.length=u,r.spot.length=h,r.rectArea.length=p,r.point.length=d,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=_+v-y,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=y,A.directionalLength=u,A.pointLength=d,A.spotLength=h,A.rectAreaLength=p,A.hemiLength=f,A.numDirectionalShadows=m,A.numPointShadows=g,A.numSpotShadows=_,A.numSpotMaps=v,r.version=_l++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let h=0,p=e.length;h<p;h++){const t=e[h];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),a.identity(),o.copy(t.matrixWorld),o.premultiply(d),a.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(t.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),i++}else if(t.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),u++}}},state:r}}function bl(e,t){const n=new yl(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Al(e,t){let n=new WeakMap;return{get:function(i,r=0){const s=n.get(i);let o;return void 0===s?(o=new bl(e,t),n.set(i,[o])):r>=s.length?(o=new bl(e,t),s.push(o)):o=s[r],o},dispose:function(){n=new WeakMap}}}class wl extends Ur{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Lt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class xl extends Ur{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const El="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Cl="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Sl(e,t,n){let i=new to;const r=new Qn,s=new Qn,o=new fi,a=new wl({depthPacking:Ut}),l=new xl,c={},u=n.maxTextureSize,h={[f]:m,[m]:f,[g]:g},_=new Gs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Qn},radius:{value:4}},vertexShader:El,fragmentShader:Cl}),y=_.clone();y.defines.HORIZONTAL_PASS=1;const b=new _s;b.setAttribute("position",new $r(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new Os(b,_),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d;let x=this.type;function E(n,i){const s=t.update(A);_.defines.VSM_SAMPLES!==n.blurSamples&&(_.defines.VSM_SAMPLES=n.blurSamples,y.defines.VSM_SAMPLES=n.blurSamples,_.needsUpdate=!0,y.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new mi(r.x,r.y)),_.uniforms.shadow_pass.value=n.map.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,_,A,null),y.uniforms.shadow_pass.value=n.mapPass.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,y,A,null)}function C(t,n,i,r){let s=null;const o=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===i.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=s.clone(),i[t]=r),s=r}return s.visible=n.visible,s.wireframe=n.wireframe,s.side=r===p?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial&&(e.properties.get(s).light=i),s}function S(n,r,s,o,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===p)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=r[c.materialIndex];if(u&&u.visible){const t=C(n,u,o,a);e.renderBufferDirect(s,null,i,t,n,c)}}}else if(r.visible){const t=C(n,r,o,a);e.renderBufferDirect(s,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)S(l[e],r,s,o,a)}this.render=function(t,n,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(v),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const f=x!==p&&this.type===p,m=x===p&&this.type!==p;for(let g=0,_=t.length;g<_;g++){const l=t[g],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const d=c.getFrameExtents();if(r.multiply(d),s.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/d.x),r.x=s.x*d.x,c.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/d.y),r.y=s.y*d.y,c.mapSize.y=s.y)),null===c.map||!0===f||!0===m){const e=this.type!==p?{minFilter:he,magFilter:he}:{};null!==c.map&&c.map.dispose(),c.map=new mi(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const _=c.getViewportCount();for(let e=0;e<_;e++){const t=c.getViewport(e);o.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),h.viewport(o),c.updateMatrices(l,e),i=c.getFrustum(),S(n,a,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===p&&E(c,a),c.needsUpdate=!1}x=this.type,w.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function Ml(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new fi;let i=null;const r=new fi(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,o,a){!0===a&&(t*=o,i*=o,s*=o),n.set(t,i,s,o),!1===r.equals(n)&&(e.clearColor(t,i,s,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(t){t?Ae(e.DEPTH_TEST):we(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case j:e.depthFunc(e.NEVER);break;case z:e.depthFunc(e.ALWAYS);break;case G:e.depthFunc(e.LESS);break;case V:e.depthFunc(e.LEQUAL);break;case H:e.depthFunc(e.EQUAL);break;case Q:e.depthFunc(e.GEQUAL);break;case W:e.depthFunc(e.GREATER);break;case q:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},c=new function(){let t=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?Ae(e.STENCIL_TEST):we(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&s===o||(e.stencilFunc(t,n,o),i=t,r=n,s=o)},setOp:function(t,n,i){o===t&&a===n&&l===i||(e.stencilOp(t,n,i),o=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,c=null}}},u=new WeakMap,d=new WeakMap;let h={},p={},f=new WeakMap,_=[],X=null,Y=!1,K=null,J=null,Z=null,$=null,ee=null,te=null,ne=null,ie=!1,re=null,se=null,oe=null,ae=null,le=null;const ce=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ue=!1,de=0;const he=e.getParameter(e.VERSION);-1!==he.indexOf("WebGL")?(de=parseFloat(/^WebGL (\d)/.exec(he)[1]),ue=de>=1):-1!==he.indexOf("OpenGL ES")&&(de=parseFloat(/^OpenGL ES (\d)/.exec(he)[1]),ue=de>=2);let pe=null,fe={};const me=e.getParameter(e.SCISSOR_BOX),ge=e.getParameter(e.VIEWPORT),_e=(new fi).fromArray(me),ve=(new fi).fromArray(ge);function ye(t,n,r,s){const o=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let l=0;l<r;l++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+l,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,o);return a}const be={};function Ae(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function we(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}be[e.TEXTURE_2D]=ye(e.TEXTURE_2D,e.TEXTURE_2D,1),be[e.TEXTURE_CUBE_MAP]=ye(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(be[e.TEXTURE_2D_ARRAY]=ye(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),be[e.TEXTURE_3D]=ye(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),s.setClear(1),c.setClear(0),Ae(e.DEPTH_TEST),s.setFunc(V),Se(!1),Me(a),Ae(e.CULL_FACE),Ce(v);const xe={[E]:e.FUNC_ADD,[C]:e.FUNC_SUBTRACT,[S]:e.FUNC_REVERSE_SUBTRACT};if(i)xe[M]=e.MIN,xe[T]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(xe[M]=e.MIN_EXT,xe[T]=e.MAX_EXT)}const Ee={[I]:e.ZERO,[P]:e.ONE,[R]:e.SRC_COLOR,[k]:e.SRC_ALPHA,[F]:e.SRC_ALPHA_SATURATE,[U]:e.DST_COLOR,[O]:e.DST_ALPHA,[D]:e.ONE_MINUS_SRC_COLOR,[B]:e.ONE_MINUS_SRC_ALPHA,[N]:e.ONE_MINUS_DST_COLOR,[L]:e.ONE_MINUS_DST_ALPHA};function Ce(t,n,i,r,s,o,a,l){if(t!==v){if(!1===Y&&(Ae(e.BLEND),Y=!0),t===x)s=s||n,o=o||i,a=a||r,n===J&&s===ee||(e.blendEquationSeparate(xe[n],xe[s]),J=n,ee=s),i===Z&&r===$&&o===te&&a===ne||(e.blendFuncSeparate(Ee[i],Ee[r],Ee[o],Ee[a]),Z=i,$=r,te=o,ne=a),K=t,ie=!1;else if(t!==K||l!==ie){if(J===E&&ee===E||(e.blendEquation(e.FUNC_ADD),J=E,ee=E),l)switch(t){case y:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case b:e.blendFunc(e.ONE,e.ONE);break;case A:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case w:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case y:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case b:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case A:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case w:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,$=null,te=null,ne=null,K=t,ie=l}}else!0===Y&&(we(e.BLEND),Y=!1)}function Se(t){re!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),re=t)}function Me(t){t!==o?(Ae(e.CULL_FACE),t!==se&&(t===a?e.cullFace(e.BACK):t===l?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):we(e.CULL_FACE),se=t}function Te(t,n,i){t?(Ae(e.POLYGON_OFFSET_FILL),ae===n&&le===i||(e.polygonOffset(n,i),ae=n,le=i)):we(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:s,stencil:c},enable:Ae,disable:we,bindFramebuffer:function(t,n){return p[t]!==n&&(e.bindFramebuffer(t,n),p[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(p[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(p[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let s=_,o=!1;if(i)if(s=f.get(r),void 0===s&&(s=[],f.set(r,s)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(s.length!==t.length||s[0]!==e.COLOR_ATTACHMENT0){for(let n=0,i=t.length;n<i;n++)s[n]=e.COLOR_ATTACHMENT0+n;s.length=t.length,o=!0}}else s[0]!==e.COLOR_ATTACHMENT0&&(s[0]=e.COLOR_ATTACHMENT0,o=!0);else s[0]!==e.BACK&&(s[0]=e.BACK,o=!0);o&&(n.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return X!==t&&(e.useProgram(t),X=t,!0)},setBlending:Ce,setMaterial:function(t,n){t.side===g?we(e.CULL_FACE):Ae(e.CULL_FACE);let i=t.side===m;n&&(i=!i),Se(i),t.blending===y&&!1===t.transparent?Ce(v):Ce(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);const o=t.stencilWrite;c.setTest(o),o&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Te(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?Ae(e.SAMPLE_ALPHA_TO_COVERAGE):we(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Se,setCullFace:Me,setLineWidth:function(t){t!==oe&&(ue&&e.lineWidth(t),oe=t)},setPolygonOffset:Te,setScissorTest:function(t){t?Ae(e.SCISSOR_TEST):we(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+ce-1),pe!==t&&(e.activeTexture(t),pe=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===pe?e.TEXTURE0+ce-1:pe);let r=fe[i];void 0===r&&(r={type:void 0,texture:void 0},fe[i]=r),r.type===t&&r.texture===n||(pe!==i&&(e.activeTexture(i),pe=i),e.bindTexture(t,n||be[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=fe[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=d.get(n);void 0===i&&(i=new WeakMap,d.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=d.get(n).get(t);u.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),u.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===_e.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),_e.copy(t))},viewport:function(t){!1===ve.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ve.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},pe=null,fe={},p={},f=new WeakMap,_=[],X=null,Y=!1,K=null,J=null,Z=null,$=null,ee=null,te=null,ne=null,ie=!1,re=null,se=null,oe=null,ae=null,le=null,_e.set(0,0,e.canvas.width,e.canvas.height),ve.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),c.reset()}}}function Tl(e,t,n,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,h=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return _?new OffscreenCanvas(e,t):Jn("canvas")}function y(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?zn:Math.floor,s=i(r*e.width),o=i(r*e.height);void 0===m&&(m=v(s,o));const a=n?v(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return Fn(e.width)&&Fn(e.height)}function A(e,t){return e.generateMipmaps&&t&&e.minFilter!==he&&e.minFilter!==_e}function w(t){e.generateMipmap(t)}function x(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;return i===e.RED&&(r===e.FLOAT&&(l=e.R32F),r===e.HALF_FLOAT&&(l=e.R16F),r===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RG&&(r===e.FLOAT&&(l=e.RG32F),r===e.HALF_FLOAT&&(l=e.RG16F),r===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RGBA&&(r===e.FLOAT&&(l=e.RGBA32F),r===e.HALF_FLOAT&&(l=e.RGBA16F),r===e.UNSIGNED_BYTE&&(l=s===zt&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)),l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function E(e,t,n){return!0===A(e,n)||e.isFramebufferTexture&&e.minFilter!==he&&e.minFilter!==_e?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function C(t){return t===he||t===pe||t===me?e.NEAREST:e.LINEAR}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=g.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&T(e),0===Object.keys(r).length&&g.delete(n)}i.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=t.texture,r=i.get(t),s=i.get(n);if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)e.deleteFramebuffer(r.__webglFramebuffer[i]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[i]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let a=0,l=n.length;a<l;a++){const t=i.get(n[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),i.remove(n[a])}i.remove(n),i.remove(t)}(n)}function T(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete g.get(r)[n.__cacheKey],o.memory.textures--}let I=0;function P(t,r){const s=i.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void L(s,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+r)}const R={[ce]:e.REPEAT,[ue]:e.CLAMP_TO_EDGE,[de]:e.MIRRORED_REPEAT},D={[he]:e.NEAREST,[pe]:e.NEAREST_MIPMAP_NEAREST,[me]:e.NEAREST_MIPMAP_LINEAR,[_e]:e.LINEAR,[ve]:e.LINEAR_MIPMAP_NEAREST,[be]:e.LINEAR_MIPMAP_LINEAR},k={[ln]:e.NEVER,[mn]:e.ALWAYS,[cn]:e.LESS,[dn]:e.LEQUAL,[un]:e.EQUAL,[fn]:e.GEQUAL,[hn]:e.GREATER,[pn]:e.NOTEQUAL};function B(n,s,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,R[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,R[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,R[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,D[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,D[s.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),s.wrapS===ue&&s.wrapT===ue||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,C(s.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,C(s.minFilter)),s.minFilter!==he&&s.minFilter!==_e&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,k[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===he)return;if(s.minFilter!==me&&s.minFilter!==be)return;if(s.type===Te&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===Ie&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function O(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const r=n.source;let s=g.get(r);void 0===s&&(s={},g.set(r,s));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===s[a]&&(s[a]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&T(n)),t.__cacheKey=a,t.__webglTexture=s[a].texture}return i}function L(t,r,o){let l=e.TEXTURE_2D;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),r.isData3DTexture&&(l=e.TEXTURE_3D);const c=O(t,r),d=r.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=i.get(d);if(d.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=function(e){return!a&&(e.wrapS!==ue||e.wrapT!==ue||e.minFilter!==he&&e.minFilter!==_e)}(r)&&!1===b(r.image);let i=y(r.image,t,!1,u);i=G(r,i);const p=b(i)||a,f=s.convert(r.format,r.colorSpace);let m,g=s.convert(r.type),_=x(r.internalFormat,f,g,r.colorSpace);B(l,r,p);const v=r.mipmaps,C=a&&!0!==r.isVideoTexture,S=void 0===h.__version||!0===c,M=E(r,i,p);if(r.isDepthTexture)_=e.DEPTH_COMPONENT,a?_=r.type===Te?e.DEPTH_COMPONENT32F:r.type===Me?e.DEPTH_COMPONENT24:r.type===De?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===Te&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Ue&&_===e.DEPTH_COMPONENT&&r.type!==Ce&&r.type!==Me&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Me,g=s.convert(r.type)),r.format===Ne&&_===e.DEPTH_COMPONENT&&(_=e.DEPTH_STENCIL,r.type!==De&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=De,g=s.convert(r.type))),S&&(C?n.texStorage2D(e.TEXTURE_2D,1,_,i.width,i.height):n.texImage2D(e.TEXTURE_2D,0,_,i.width,i.height,0,f,g,null));else if(r.isDataTexture)if(v.length>0&&p){C&&S&&n.texStorage2D(e.TEXTURE_2D,M,_,v[0].width,v[0].height);for(let t=0,i=v.length;t<i;t++)m=v[t],C?n.texSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,f,g,m.data);r.generateMipmaps=!1}else C?(S&&n.texStorage2D(e.TEXTURE_2D,M,_,i.width,i.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,i.width,i.height,f,g,i.data)):n.texImage2D(e.TEXTURE_2D,0,_,i.width,i.height,0,f,g,i.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){C&&S&&n.texStorage3D(e.TEXTURE_2D_ARRAY,M,_,v[0].width,v[0].height,i.depth);for(let t=0,s=v.length;t<s;t++)m=v[t],r.format!==Be?null!==f?C?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,m.width,m.height,i.depth,f,m.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,_,m.width,m.height,i.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,m.width,m.height,i.depth,f,g,m.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,_,m.width,m.height,i.depth,0,f,g,m.data)}else{C&&S&&n.texStorage2D(e.TEXTURE_2D,M,_,v[0].width,v[0].height);for(let t=0,i=v.length;t<i;t++)m=v[t],r.format!==Be?null!==f?C?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,m.data):n.compressedTexImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?n.texSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,f,g,m.data)}else if(r.isDataArrayTexture)C?(S&&n.texStorage3D(e.TEXTURE_2D_ARRAY,M,_,i.width,i.height,i.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isData3DTexture)C?(S&&n.texStorage3D(e.TEXTURE_3D,M,_,i.width,i.height,i.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(e.TEXTURE_3D,0,_,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isFramebufferTexture){if(S)if(C)n.texStorage2D(e.TEXTURE_2D,M,_,i.width,i.height);else{let t=i.width,r=i.height;for(let i=0;i<M;i++)n.texImage2D(e.TEXTURE_2D,i,_,t,r,0,f,g,null),t>>=1,r>>=1}}else if(v.length>0&&p){C&&S&&n.texStorage2D(e.TEXTURE_2D,M,_,v[0].width,v[0].height);for(let t=0,i=v.length;t<i;t++)m=v[t],C?n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,g,m):n.texImage2D(e.TEXTURE_2D,t,_,f,g,m);r.generateMipmaps=!1}else C?(S&&n.texStorage2D(e.TEXTURE_2D,M,_,i.width,i.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,g,i)):n.texImage2D(e.TEXTURE_2D,0,_,f,g,i);A(r,p)&&w(l),h.__version=d.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function U(t,r,o,a,l){const c=s.convert(o.format,o.colorSpace),u=s.convert(o.type),d=x(o.internalFormat,c,u,o.colorSpace);i.get(r).__hasExternalTextures||(l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,0,d,r.width,r.height,r.depth,0,c,u,null):n.texImage2D(l,0,d,r.width,r.height,0,c,u,null)),n.bindFramebuffer(e.FRAMEBUFFER,t),z(r)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,l,i.get(o).__webglTexture,0,j(r)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,a,l,i.get(o).__webglTexture,0),n.bindFramebuffer(e.FRAMEBUFFER,null)}function N(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let r=e.DEPTH_COMPONENT16;if(i||z(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Te?r=e.DEPTH_COMPONENT32F:t.type===Me&&(r=e.DEPTH_COMPONENT24));const i=j(n);z(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=j(n);i&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):z(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const o=t[r],a=s.convert(o.format,o.colorSpace),l=s.convert(o.type),c=x(o.internalFormat,a,l,o.colorSpace),u=j(n);i&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,n.width,n.height):z(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function F(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),P(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=j(r);if(r.depthTexture.format===Ue)z(r)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==Ne)throw new Error("Unknown depthTexture format");z(r)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),N(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),N(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function j(e){return Math.min(d,e.samples)}function z(e){const n=i.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function G(e,n){const i=e.colorSpace,r=e.format,s=e.type;return!0===e.isCompressedTexture||e.format===Mn||i!==Gt&&i!==jt&&(i===zt?!1===a?!0===t.has("EXT_sRGB")&&r===Be?(e.format=Mn,e.minFilter=_e,e.generateMipmaps=!1):n=li.sRGBToLinear(n):r===Be&&s===we||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):i===Ht||console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const e=I;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),I+=1,e},this.resetTextureUnits=function(){I=0},this.setTexture2D=P,this.setTexture2DArray=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?L(s,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const s=i.get(t);t.version>0&&s.__version!==t.version?L(s,t,r):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,r,o){if(6!==r.image.length)return;const l=O(t,r),u=r.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const d=i.get(u);if(u.version!==d.__version||!0===l){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=r.isCompressedTexture||r.image[0].isCompressedTexture,i=r.image[0]&&r.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=t||i?i?r.image[e].image:r.image[e]:y(r.image[e],!1,!0,c),h[e]=G(r,h[e]);const p=h[0],f=b(p)||a,m=s.convert(r.format,r.colorSpace),g=s.convert(r.type),_=x(r.internalFormat,m,g,r.colorSpace),v=a&&!0!==r.isVideoTexture,C=void 0===d.__version||!0===l;let S,M=E(r,p,f);if(B(e.TEXTURE_CUBE_MAP,r,f),t){v&&C&&n.texStorage2D(e.TEXTURE_CUBE_MAP,M,_,p.width,p.height);for(let t=0;t<6;t++){S=h[t].mipmaps;for(let i=0;i<S.length;i++){const s=S[i];r.format!==Be?null!==m?v?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,s.width,s.height,m,s.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,_,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,s.width,s.height,m,g,s.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,_,s.width,s.height,0,m,g,s.data)}}}else{S=r.mipmaps,v&&C&&(S.length>0&&M++,n.texStorage2D(e.TEXTURE_CUBE_MAP,M,_,h[0].width,h[0].height));for(let t=0;t<6;t++)if(i){v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,h[t].width,h[t].height,m,g,h[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,h[t].width,h[t].height,0,m,g,h[t].data);for(let i=0;i<S.length;i++){const r=S[i].image[t].image;v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,m,g,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,_,r.width,r.height,0,m,g,r.data)}}else{v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m,g,h[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,m,g,h[t]);for(let i=0;i<S.length;i++){const r=S[i];v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,m,g,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,_,m,g,r.image[t])}}}A(r,f)&&w(e.TEXTURE_CUBE_MAP),d.__version=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,r):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+r)},this.rebindTextures=function(t,n,r){const s=i.get(t);void 0!==n&&U(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),void 0!==r&&F(t)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),u=i.get(l);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,o.memory.textures++);const d=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,p=b(t)||a;if(d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),h)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===z(t)){const i=h?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const o=s.convert(r.format,r.colorSpace),a=s.convert(r.type),l=x(r.internalFormat,o,a,r.colorSpace,!0===t.isXRRenderTarget),u=j(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),N(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(d){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),B(e.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)U(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n);A(l,p)&&w(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){const r=t.texture;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i.get(o);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),B(e.TEXTURE_2D,o,p),U(c.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D),A(o,p)&&w(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,u.__webglTexture),B(i,l,p),U(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i),A(l,p)&&w(i),n.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(t){const r=b(t)||a,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D;for(let e=0,a=s.length;e<a;e++){const t=s[e],a=i.get(t),l=a.__webglTexture;a.__version!==t.version&&(n.bindTexture(o,l),B(o,t,r),n.unbindTexture(),a.__version=t.version),A(t,r)&&(n.bindTexture(o,l),w(o),n.unbindTexture())}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===z(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,o=t.height;let a=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const h=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===h&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===h&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),d){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,o,0,0,s,o,a,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=U,this.useMultisampledRTT=z}function Il(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=jt){let s;if(n===we)return e.UNSIGNED_BYTE;if(n===Pe)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Re)return e.UNSIGNED_SHORT_5_5_5_1;if(n===xe)return e.BYTE;if(n===Ee)return e.SHORT;if(n===Ce)return e.UNSIGNED_SHORT;if(n===Se)return e.INT;if(n===Me)return e.UNSIGNED_INT;if(n===Te)return e.FLOAT;if(n===Ie)return i?e.HALF_FLOAT:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(n===ke)return e.ALPHA;if(n===Be)return e.RGBA;if(n===Oe)return e.LUMINANCE;if(n===Le)return e.LUMINANCE_ALPHA;if(n===Ue)return e.DEPTH_COMPONENT;if(n===Ne)return e.DEPTH_STENCIL;if(n===Mn)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(n===Fe)return e.RED;if(n===je)return e.RED_INTEGER;if(n===ze)return e.RG;if(n===Ge)return e.RG_INTEGER;if(n===Ve)return e.RGBA_INTEGER;if(n===He||n===Qe||n===We||n===qe)if(r===zt){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===He)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Qe)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===We)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===qe)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===He)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Qe)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===We)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===qe)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Xe||n===Ye||n===Ke||n===Je){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===Xe)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ye)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ke)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Je)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Ze)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===$e||n===et){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===$e)return r===zt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===et)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===tt||n===nt||n===it||n===rt||n===st||n===ot||n===at||n===lt||n===ct||n===ut||n===dt||n===ht||n===pt||n===ft){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===tt)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===nt)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===it)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===rt)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===st)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ot)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===at)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===lt)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ct)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===ut)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===dt)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===ht)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===pt)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ft)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===mt){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(n===mt)return r===zt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(n===gt||n===_t||n===vt||n===yt){if(s=t.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===mt)return s.COMPRESSED_RED_RGTC1_EXT;if(n===_t)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===vt)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===yt)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===De?i?e.UNSIGNED_INT_24_8:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class Pl extends Hs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Rl extends xr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Dl={type:"move"};class kl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Rl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Rl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new wi,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new wi),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Rl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new wi,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new wi),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const s of e.hand.values()){const e=t.getJointPose(s,n),i=this._getHandJoint(l,s);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Dl)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Rl;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Bl extends pi{constructor(e,t,n,i,r,s,o,a,l,c){if((c=void 0!==c?c:Ue)!==Ue&&c!==Ne)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Ue&&(n=Me),void 0===n&&c===Ne&&(n=De),super(null,i,r,s,o,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:he,this.minFilter=void 0!==a?a:he,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class Ol extends Pn{constructor(e,t){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=1,l=null,c=null,u=null,d=null,h=null,p=null;const f=t.getContextAttributes();let m=null,g=null;const _=[],v=[];let y=null;const b=new Hs;b.layers.enable(1),b.viewport=new fi;const A=new Hs;A.layers.enable(2),A.viewport=new fi;const w=[b,A],x=new Pl;x.layers.enable(1),x.layers.enable(2);let E=null,C=null;function S(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function M(){i.removeEventListener("select",S),i.removeEventListener("selectstart",S),i.removeEventListener("selectend",S),i.removeEventListener("squeeze",S),i.removeEventListener("squeezestart",S),i.removeEventListener("squeezeend",S),i.removeEventListener("end",M),i.removeEventListener("inputsourceschange",T);for(let e=0;e<_.length;e++){const t=v[e];null!==t&&(v[e]=null,_[e].disconnect(t))}E=null,C=null,e.setRenderTarget(m),h=null,d=null,u=null,i=null,g=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function T(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=v.indexOf(n);i>=0&&(v[i]=null,_[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=v.indexOf(n);if(-1===i){for(let e=0;e<_.length;e++){if(e>=v.length){v.push(n),i=e;break}if(null===v[e]){v[e]=n,i=e;break}}if(-1===i)break}const r=_[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(e){y=e},this.getController=function(e){let t=_[e];return void 0===t&&(t=new kl,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new kl,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new kl,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",S),i.addEventListener("selectstart",S),i.addEventListener("selectend",S),i.addEventListener("squeeze",S),i.addEventListener("squeezestart",S),i.addEventListener("squeezeend",S),i.addEventListener("end",M),i.addEventListener("inputsourceschange",T),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:h}),g=new mi(h.framebufferWidth,h.framebufferHeight,{format:Be,type:we,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,s=null,o=null;f.depth&&(o=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?Ne:Ue,s=f.stencil?De:Me);const a={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:r};u=new XRWebGLBinding(i,t),d=u.createProjectionLayer(a),i.updateRenderState({layers:[d]}),g=new mi(d.textureWidth,d.textureHeight,{format:Be,type:we,depthTexture:new Bl(d.textureWidth,d.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await i.requestReferenceSpace(o),k.setContext(i),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const I=new wi,P=new wi;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCameraXR=function(e){if(null===i)return e;y&&(e=y),x.near=A.near=b.near=e.near,x.far=A.far=b.far=e.far,E===x.near&&C===x.far||(i.updateRenderState({depthNear:x.near,depthFar:x.far}),E=x.near,C=x.far);const t=e.parent,n=x.cameras;R(x,t);for(let i=0;i<n.length;i++)R(n[i],t);return 2===n.length?function(e,t,n){I.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const i=I.distanceTo(P),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],d=(s[8]+1)/s[0],h=o*u,p=o*d,f=i/(-u+d),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,_=a+f,v=h-m,y=p+(i-m),b=l*a/_*g,A=c*a/_*g;e.projectionMatrix.makePerspective(v,y,b,A,g,_),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(x,b,A):x.projectionMatrix.copy(b.projectionMatrix),y&&function(e,t){const n=y;null===t?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0);const i=n.children;for(let r=0,s=i.length;r<s;r++)i[r].updateMatrixWorld(!0);n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=2*Bn*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}(x,t),x},this.getFoveation=function(){if(null!==d||null!==h)return a},this.setFoveation=function(e){a=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let D=null;this.onPreAnimationFrameCallback=null;const k=new no;k.setAnimationLoop((function(t,i){if(n.onPreAnimationFrameCallback&&n.onPreAnimationFrameCallback(t,i),c=i.getViewerPose(l||s),p=i,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(g,h.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==x.cameras.length&&(x.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let s=null;if(null!==h)s=h.getViewport(r);else{const t=u.getViewSubImage(d,r);s=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let o=w[i];void 0===o&&(o=new Hs,o.layers.enable(i),o.viewport=new fi,w[i]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&(x.matrix.copy(o.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),!0===n&&x.cameras.push(o)}}for(let e=0;e<_.length;e++){const t=v[e],n=_[e];null!==t&&void 0!==n&&n.update(t,i,l||s)}D&&D(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(e){D=e},this.dispose=function(){}}}function Ll(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,r.side===m&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),r.side===m&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const s=t.get(r).envMap;if(s){i.envMap.value=s;const e=r.envMap||t.get(r).environment||s;i.envMapRotation.value=e?e.rotation:0,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio}if(r.lightMap){i.lightMap.value=r.lightMap;const t=!0===e.useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshTransformUniform:n,refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,js(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,s,o,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform)),e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform)),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===m&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,a)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,s,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(void 0!==r.transmission&&(e.transmission&&(e.transmission.value=r.transmission),e.transmissionSamplerMap&&a&&(e.transmissionSamplerMap.value=a?a.texture:null),e.transmissionSamplerSize&&a&&e.transmissionSamplerSize.value.set(a.width,a.height)),r.uniformsNeedUpdate=!1)}}}function Ul(e,t,n,i){let r={},s={},o=[];const a=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const i=e.value;if(void 0===n[t]){if("number"==typeof i)n[t]=i;else{const e=Array.isArray(i)?i:[i],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());n[t]=r}return!0}if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],r=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(r[t]))return n.copy(r[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,d){let h=r[n.id];void 0===h&&(function(e){const t=e.uniforms;let n=0,i=0;for(let r=0,s=t.length;r<s;r++){const e=t[r],s={boundary:0,storage:0},o=Array.isArray(e.value)?e.value:[e.value];for(let t=0,n=o.length;t<n;t++){const e=c(o[t]);s.boundary+=e.boundary,s.storage+=e.storage}e.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,r>0&&(i=n%16,0!==i&&16-i-s.boundary<0&&(n+=16-i,e.__offset=n)),n+=s.storage}i=n%16,i>0&&(n+=16-i),e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=h,n.addEventListener("dispose",u));const p=d.program;i.updateUBOMapping(n,p);const f=t.render.frame;s[n.id]!==f&&(function(t){const n=r[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,o=i.length;r<o;r++){const t=i[r];if(!0===l(t,r,s)){const n=t.__offset,i=Array.isArray(t.value)?t.value:[t.value];let r=0;for(let s=0;s<i.length;s++){const o=i[s],a=c(o);"number"==typeof o?(t.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,n+r,t.__data)):o.isMatrix3?(t.__data[0]=o.elements[0],t.__data[1]=o.elements[1],t.__data[2]=o.elements[2],t.__data[3]=o.elements[0],t.__data[4]=o.elements[3],t.__data[5]=o.elements[4],t.__data[6]=o.elements[5],t.__data[7]=o.elements[0],t.__data[8]=o.elements[6],t.__data[9]=o.elements[7],t.__data[10]=o.elements[8],t.__data[11]=o.elements[0]):(o.toArray(t.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,n,t.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);o=[],r={},s={}}}}function Nl(){const e=Jn("canvas");return e.style.display="block",e}class Fl{constructor(e={}){const{canvas:t=Nl(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;let h;this.isWebGLRenderer=!0,h=null!==n?n.getContextAttributes().alpha:o;const p=new Uint32Array(4),_=new Int32Array(4);let v=null,y=null;const b=[],A=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=zt,this.useLegacyLights=!0,this.toneMapping=J,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const w=this;let x=!1,E=0,C=0,S=null,M=-1,T=null;const I=new fi,P=new fi;let R=null;const D=new Vr(0);let k=0,B=t.width,O=t.height,L=1,U=null,N=null;const F=new fi(0,0,B,O),j=new fi(0,0,B,O);let z=!1;const G=new to;let V=!1,H=!1,Q=null;const W=new Zi,q=new Qn,X=new wi,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return null===S?L:1}let Z,$,ee,te,ne,ie,re,se,oe,ae,le,ce,ue,de,he,pe,fe,me,ge,_e,ve,ye,Ae,xe,Ee=n;function Se(e,n){for(let i=0;i<e.length;i++){const r=e[i],s=t.getContext(r,n);if(null!==s)return s}return null}try{const e={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${i}`),t.addEventListener("webglcontextlost",Le,!1),t.addEventListener("webglcontextrestored",Ue,!1),t.addEventListener("webglcontextcreationerror",Ne,!1),null===Ee){const t=["webgl2","webgl","experimental-webgl"];if(!0===w.isWebGL1Renderer&&t.shift(),Ee=Se(t,e),null===Ee)throw Se(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ee instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Ee.getShaderPrecisionFormat&&(Ee.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ke(){Z=new Ro(Ee),$=new po(Ee,Z,e),Z.init($),ye=new Il(Ee,Z,$),ee=new Ml(Ee,Z,$),te=new Bo(Ee),ne=new dl,ie=new Tl(Ee,Z,ee,ne,$,ye,te),re=new mo(w),se=new Po(w),oe=new io(Ee,$),Ae=new uo(Ee,Z,oe,$),ae=new Do(Ee,oe,te,Ae),le=new No(Ee,ae,oe,te),ge=new Uo(Ee,$,ie),pe=new fo(ne),ce=new ul(w,re,se,Z,$,Ae,pe),ue=new Ll(w,ne),de=new ml,he=new Al(Z,$),me=new co(w,re,se,ee,le,h,l),fe=new Sl(w,le,$),xe=new Ul(Ee,te,$,ee),_e=new ho(Ee,Z,te,$),ve=new ko(Ee,Z,te,$),te.programs=ce.programs,w.capabilities=$,w.extensions=Z,w.properties=ne,w.renderLists=de,w.shadowMap=fe,w.state=ee,w.info=te,w.background=me,w.cubemaps=re,w.cubeuvmaps=se,w.materials=ue}ke();const Oe=new Ol(w,Ee);function Le(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0,w.onContextLost(e)}function Ue(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const e=w.info?w.info.autoReset:void 0,t=fe.enabled,n=fe.autoUpdate,i=fe.needsUpdate,r=fe.type;ke(),w.info&&void 0!==e&&(w.info.autoReset=e),fe.enabled=t,fe.autoUpdate=n,fe.needsUpdate=i,fe.type=r,w.onContextRestore&&w.onContextRestore(),console.log("restored")}function Ne(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage),w.onContextCreationError(e)}function Fe(e){const t=e.target;t.removeEventListener("dispose",Fe),function(e){(function(e){const t=ne.get(e).programs;void 0!==t&&(t.forEach((function(e){ce.releaseProgram(e)})),e.isShaderMaterial&&ce.releaseShaderCache(e))})(e),ne.remove(e)}(t)}this.xr=Oe,this.getContext=function(){return Ee},this.getContextAttributes=function(){return Ee.getContextAttributes()},this.forceContextLoss=function(){const e=Z.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Z.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(B,O,!1))},this.getSize=function(e){return e.set(B,O)},this.setSize=function(e,n,i=!0){Oe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(B=e,O=n,t.width=Math.floor(e*L),t.height=Math.floor(n*L),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(B*L,O*L).floor()},this.setDrawingBufferSize=function(e,n,i){B=e,O=n,L=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(I)},this.getViewport=function(e){return e.copy(F)},this.setViewport=function(e,t,n,i){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,n,i),ee.viewport(I.copy(F).multiplyScalar(L).floor())},this.getScissor=function(e){return e.copy(j)},this.setScissor=function(e,t,n,i){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,n,i),ee.scissor(P.copy(j).multiplyScalar(L).floor())},this.getScissorTest=function(){return z},this.setScissorTest=function(e){ee.setScissorTest(z=e)},this.setOpaqueSort=function(e){U=e},this.setTransparentSort=function(e){N=e},this.getClearColor=function(e){return e.copy(me.getClearColor())},this.setClearColor=function(){me.setClearColor.apply(me,arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha.apply(me,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==S){const t=S.texture.format;e=t===Ve||t===Ge||t===je}if(e){const e=S.texture.type,t=e===we||e===Me||e===Ce||e===De||e===Pe||e===Re,n=me.getClearColor(),i=me.getClearAlpha(),r=n.r,s=n.g,o=n.b,a=ne.get(S).__webglFramebuffer;t?(p[0]=r,p[1]=s,p[2]=o,p[3]=i,Ee.clearBufferuiv(Ee.COLOR,a,p)):(_[0]=r,_[1]=s,_[2]=o,_[3]=i,Ee.clearBufferiv(Ee.COLOR,a,_))}else i|=Ee.COLOR_BUFFER_BIT}t&&(i|=Ee.DEPTH_BUFFER_BIT),n&&(i|=Ee.STENCIL_BUFFER_BIT),Ee.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Le,!1),t.removeEventListener("webglcontextrestored",Ue,!1),t.removeEventListener("webglcontextcreationerror",Ne,!1),de.dispose(),he.dispose(),ne.dispose(),re.dispose(),se.dispose(),le.dispose(),Ae.dispose(),xe.dispose(),ce.dispose(),Oe.dispose(),Oe.removeEventListener("sessionstart",He),Oe.removeEventListener("sessionend",Qe),Q&&(Q.dispose(),Q=null),We.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=Y);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,n,i,r){!0!==t.isScene&&(t=Y),ie.resetTextureUnits();const s=t.fog,o=i.userData&&i.userData.envMapSlotKey&&t.textureSlots&&t.textureSlots[i.userData.envMapSlotKey]?t.textureSlots[i.userData.envMapSlotKey]:i.isMeshStandardMaterial?t.environment:null,a=null===S?w.outputColorSpace:!0===S.isXRRenderTarget||S.texture.colorSpace&&S.texture.colorSpace!==zt?S.texture.colorSpace:Gt,l=(i.isMeshStandardMaterial?se:re).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,f=i.toneMapped?w.toneMapping:J,m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,_=ne.get(i),v=y.state.lights;if(!0===V&&(!0===H||e!==T)){const t=e===T&&i.id===M;pe.setState(i,e,t)}let b=!1;i.version===_.__version?_.needsLights&&_.lightsStateVersion!==v.state.version||_.outputColorSpace!==a||r.isInstancedMesh&&!1===_.instancing?b=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?b=!0:r.isSkinnedMesh||!0!==_.skinning?_.envMap!==l||!0===i.fog&&_.fog!==s?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===pe.numPlanes&&_.numIntersection===pe.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==u||_.morphTargets!==d||_.morphNormals!==h||_.morphColors!==p||_.toneMapping!==f||!0===$.isWebGL2&&_.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,_.__version=i.version);let A=_.currentProgram;!0===b&&(A=Je(i,t,r));let x=!1,E=!1,C=!1;const I=A.getUniforms(),P=_.uniforms;if(ee.useProgram(A.program)&&(x=!0,E=!0,C=!0),i.id!==M&&(M=i.id,E=!0),x||T!==e){if(I.setValue(Ee,"projectionMatrix",e.projectionMatrix),$.logarithmicDepthBuffer&&I.setValue(Ee,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),T!==e&&(T=e,E=!0,C=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=I.map.cameraPosition;void 0!==t&&t.setValue(Ee,X.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&I.setValue(Ee,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&I.setValue(Ee,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){I.setOptional(Ee,r,"bindMatrix"),I.setOptional(Ee,r,"bindMatrixInverse");const e=r.skeleton;e&&($.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),I.setValue(Ee,"boneTexture",e.boneTexture,ie),I.setValue(Ee,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const R=n.morphAttributes;var D,k;(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===$.isWebGL2)&&ge.update(r,n,A),(E||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,I.setValue(Ee,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),E&&(I.setValue(Ee,"toneMappingExposure",w.toneMappingExposure),_.needsLights&&(k=C,(D=P).ambientLightColor.needsUpdate=k,D.lightProbe.needsUpdate=k,D.directionalLights.needsUpdate=k,D.directionalLightShadows.needsUpdate=k,D.pointLights.needsUpdate=k,D.pointLightShadows.needsUpdate=k,D.spotLights.needsUpdate=k,D.spotLightShadows.needsUpdate=k,D.rectAreaLights.needsUpdate=k,D.hemisphereLights.needsUpdate=k),s&&!0===i.fog&&ue.refreshFogUniforms(P,s),ue.refreshMaterialUniforms(P,i,L,O,w.userData.transmissionRenderTarget||Q),Ga.upload(Ee,_.uniformsList,P,ie)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Ga.upload(Ee,_.uniformsList,P,ie),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&I.setValue(Ee,"center",r.center),I.setValue(Ee,"modelViewMatrix",r.modelViewMatrix),I.setValue(Ee,"normalMatrix",r.normalMatrix),I.setValue(Ee,"modelMatrix",r.matrixWorld);const B=i.extraUniformsToUpload;if(B&&Object.entries(B).forEach((([e,t])=>I.setValue(Ee,e,t.value,ie))),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if($.isWebGL2){const n=e[t];xe.update(n,A),xe.bind(n,A)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return A}(e,t,n,i,r);ee.setMaterial(i,o);let l=n.index,c=1;!0===i.wireframe&&(l=ae.getWireframeAttribute(n),c=2);const u=n.drawRange,d=n.attributes.position;let h=u.start*c,p=(u.start+u.count)*c;null!==s&&(h=Math.max(h,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):null!=d&&(h=Math.max(h,0),p=Math.min(p,d.count));const f=p-h;if(f<0||f===1/0)return;let m;Ae.setup(r,i,a,n,l);let g=_e;if(null!==l&&(m=oe.get(l),g=ve,g.setIndex(m)),r.isMesh)!0===i.wireframe?(ee.setLineWidth(i.wireframeLinewidth*K()),g.setMode(Ee.LINES)):g.setMode(Ee.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),ee.setLineWidth(e*K()),r.isLineSegments?g.setMode(Ee.LINES):r.isLineLoop?g.setMode(Ee.LINE_LOOP):g.setMode(Ee.LINE_STRIP)}else r.isPoints?g.setMode(Ee.POINTS):r.isSprite&&g.setMode(Ee.TRIANGLES);if(r.isInstancedMesh)g.renderInstances(h,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(h,f,t)}else g.render(h,f)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===g&&!1===e.forceSinglePass?(e.side=m,e.needsUpdate=!0,Je(e,t,n),e.side=f,e.needsUpdate=!0,Je(e,t,n),e.side=g):Je(e,t,n)}y=he.get(e),y.init(),A.push(y),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(y.pushLight(e),e.castShadow&&y.pushShadow(e))})),y.setupLights(w.useLegacyLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++)n(i[r],e,t);else n(i,e,t)})),A.pop(),y=null};let ze=null;function He(){We.stop()}function Qe(){We.start()}const We=new no;function qe(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)y.pushLight(e),e.castShadow&&y.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||G.intersectsSprite(e)){i&&X.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);const t=le.update(e),r=e.material;r.visible&&v.push(e,t,r,n,X.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||G.intersectsObject(e))){e.isSkinnedMesh&&e.skeleton.frame!==te.render.frame&&(e.skeleton.update(),e.skeleton.frame=te.render.frame);const t=le.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),X.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),X.copy(t.boundingSphere.center)),X.applyMatrix4(e.matrixWorld).applyMatrix4(W)),Array.isArray(r)){const i=t.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r[o.materialIndex];a&&a.visible&&v.push(e,t,a,n,X.z,o)}}else r.visible&&v.push(e,t,r,n,X.z,null)}const r=e.children;for(let s=0,o=r.length;s<o;s++)qe(r[s],t,n,i)}function Xe(e,t,n,i){const r=e.opaque,s=e.transmissive,o=e.transparent;if(y.setupLightsView(n),!0===V&&pe.setGlobalState(w.clippingPlanes,n),void 0===w.userData.transmissionRender&&!1!==w.userData.renderTransmissionPass&&s.length>0&&function(e,t,n,i){console.warn("three.js internal render transmission pass should not be called");const r=$.isWebGL2;null===Q&&(Q=new mi(1,1,{generateMipmaps:!0,type:Z.has("EXT_color_buffer_half_float")?Ie:we,minFilter:be,samples:r&&!0===a?4:0})),w.getDrawingBufferSize(q),r?Q.setSize(q.x,q.y):Q.setSize(zn(q.x),zn(q.y));const s=w.getRenderTarget();w.setRenderTarget(Q),w.getClearColor(D),k=w.getClearAlpha(),k<1&&w.setClearColor(16777215,.5),w.clear();const o=w.toneMapping;w.toneMapping=J,Ye(e,n,i),ie.updateMultisampleRenderTarget(Q),ie.updateRenderTargetMipmap(Q);let l=!1;for(let a=0,c=t.length;a<c;a++){const e=t[a],r=e.object,s=e.geometry,o=e.material,c=e.group;if(o.side===g&&r.layers.test(i.layers)){const e=o.side;o.side=m,o.needsUpdate=!0,Ke(r,n,i,s,o,c),o.side=e,o.needsUpdate=!0,l=!0}}!0===l&&(ie.updateMultisampleRenderTarget(Q),ie.updateRenderTargetMipmap(Q)),w.setRenderTarget(s),w.setClearColor(D,k),w.toneMapping=o}([...r,...o],s,t,n),i&&ee.viewport(I.copy(i)),!1!==w.userData.opaqueRender&&r.length>0&&Ye(r,t,n),!1!==w.userData.transparentRender&&o.length>0&&Ye(o,t,n),!1!==w.userData.transmissionRender&&s.length>0){Q||(Q=new mi(1,1));const e=(w.userData.transmissionRenderTarget||Q).texture,i=$.isWebGL2,r=e.generateMipmaps,o=e.minFilter;i&&w.userData.blurTransmissionTarget&&w.userData.transmissionRenderTarget&&(e.generateMipmaps=!0,e.minFilter=be,e.needsUpdate=!0,ie.updateMultisampleRenderTarget(w.userData.transmissionRenderTarget),ie.updateRenderTargetMipmap(w.userData.transmissionRenderTarget)),Ye(s,t,n),i&&w.userData.blurTransmissionTarget&&w.userData.transmissionRenderTarget&&(e.generateMipmaps=r,e.minFilter=o,e.needsUpdate=!0,ie.updateMultisampleRenderTarget(w.userData.transmissionRenderTarget),ie.updateRenderTargetMipmap(w.userData.transmissionRenderTarget))}ee.buffers.depth.setTest(!0),ee.buffers.depth.setMask(!0),ee.buffers.color.setMask(!0),ee.setPolygonOffset(!1)}function Ye(e,t,n){const i={...w.userData};w.userData.opaqueRender=void 0,w.userData.transparentRender=void 0,w.userData.transmissionRender=void 0,w.userData.backgroundRender=void 0;const r=!0===t.isScene?t.overrideMaterial:null;for(let s=0,o=e.length;s<o;s++){const i=e[s],o=i.object,a=i.geometry,l=null===r?i.material:r,c=i.group;o.layers.test(n.layers)&&Ke(o,t,n,a,l,c)}Object.assign(w.userData,i)}function Ke(e,t,n,i,r,s){e.onBeforeRender(w,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(w,t,n,i,e,s),!0===r.transparent&&r.side===g&&!1===r.forceSinglePass?(r.side=m,r.needsUpdate=!0,w.renderBufferDirect(n,t,i,r,e,s),r.side=f,r.needsUpdate=!0,w.renderBufferDirect(n,t,i,r,e,s),r.side=g):w.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(w,t,n,i,r,s),r.onAfterRender(w,t,n,i,e,s)}function Je(e,t,n){!0!==t.isScene&&(t=Y);const i=ne.get(e),r=y.state.lights,s=y.state.shadowsArray,o=r.state.version,a=ce.getParameters(e,r.state,s,t,n),l=ce.getProgramCacheKey(a);let c=i.programs;i.environment=e.userData&&e.userData.envMapSlotKey&&t.textureSlots&&t.textureSlots[e.userData.envMapSlotKey]?t.textureSlots[e.userData.envMapSlotKey]:e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?se:re).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Fe),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Ze(e,a),u}else a.uniforms=ce.getUniforms(e),e.onBuild(n,a,w),e.onBeforeCompile(a,w),u=ce.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const d=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=pe.uniform),Ze(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix);const h=u.getUniforms(),p=Ga.seqWithValue(h.seq,d);return i.currentProgram=u,i.uniformsList=p,u}function Ze(e,t){const n=ne.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}We.setAnimationLoop((function(e){ze&&ze(e)})),"undefined"!=typeof self&&We.setContext(self),this.setAnimationLoop=function(e){ze=e,Oe.setAnimationLoop(e),null===e?We.stop():We.start()},Oe.addEventListener("sessionstart",He),Oe.addEventListener("sessionend",Qe),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==x){if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Oe.enabled&&!0===Oe.isPresenting&&(t=Oe.updateCameraXR(t)),!0===e.isScene&&e.onBeforeRender(w,e,t,S),y=he.get(e,A.length),y.init(),A.push(y),W.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),G.setFromProjectionMatrix(W),H=this.localClippingEnabled,V=pe.init(this.clippingPlanes,H),v=de.get(e,b.length),v.init(),b.push(v),qe(e,t,0,w.sortObjects),v.finish(),!0===w.sortObjects&&v.sort(U,N),!1!==w.userData.shadowMapRender){!0===V&&pe.beginShadows();const n=y.state.shadowsArray;n.length>0&&fe.render(n,e,t),!0===V&&pe.endShadows()}if(!0===this.info.autoReset&&this.info.reset(),this.info.render.frame++,!1!==w.userData.backgroundRender&&me.render(v,e),!1!==w.userData.sceneRender)if(y.setupLights(w.useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];Xe(v,e,i,i.viewport)}}else Xe(v,e,t);null!==S&&(ie.updateMultisampleRenderTarget(S),ie.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(w,e,t),Ae.resetDefaultState(),M=-1,T=null,A.pop(),y=A.length>0?A[A.length-1]:null,b.pop(),v=b.length>0?b[b.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,n){ne.get(e.texture).__webglTexture=t,ne.get(e.depthTexture).__webglTexture=n;const i=ne.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===Z.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=ne.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){S=e,E=t,C=n;let i=!0,r=null,s=!1,o=!1;if(e){const n=ne.get(e);void 0!==n.__useDefaultFramebuffer?(ee.bindFramebuffer(Ee.FRAMEBUFFER,null),i=!1):void 0===n.__webglFramebuffer?ie.setupRenderTarget(e):n.__hasExternalTextures&&ie.rebindTextures(e,ne.get(e.texture).__webglTexture,ne.get(e.depthTexture).__webglTexture);const a=e.texture;(a.isData3DTexture||a.isDataArrayTexture||a.isCompressedArrayTexture)&&(o=!0);const l=ne.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=l[t],s=!0):r=$.isWebGL2&&e.samples>0&&!1===ie.useMultisampledRTT(e)?ne.get(e).__webglMultisampledFramebuffer:l,I.copy(e.viewport),P.copy(e.scissor),R=e.scissorTest}else I.copy(F).multiplyScalar(L).floor(),P.copy(j).multiplyScalar(L).floor(),R=z;if(ee.bindFramebuffer(Ee.FRAMEBUFFER,r)&&$.drawBuffers&&i&&ee.drawBuffers(e,r),ee.viewport(I),ee.scissor(P),ee.setScissorTest(R),s){const i=ne.get(e.texture);Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(o){const i=ne.get(e.texture),r=t||0;Ee.framebufferTextureLayer(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}M=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=ne.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){ee.bindFramebuffer(Ee.FRAMEBUFFER,l);try{const o=Array.isArray(e.texture)?e.texture[a||0]:e.texture,l=o.format,c=o.type;if(l!==Be&&ye.convert(l)!==Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=c===Ie&&(Z.has("EXT_color_buffer_half_float")||$.isWebGL2&&Z.has("EXT_color_buffer_float"));if(!(c===we||ye.convert(c)===Ee.getParameter(Ee.IMPLEMENTATION_COLOR_READ_TYPE)||c===Te&&($.isWebGL2||Z.has("OES_texture_float")||Z.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&(e.isWebGLMultipleRenderTargets&&Ee.readBuffer(Ee.COLOR_ATTACHMENT0+a),Ee.readPixels(t,n,i,r,ye.convert(l),ye.convert(c),s))}finally{const e=S?ne.get(S).__webglFramebuffer:null;ee.bindFramebuffer(Ee.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);ie.setTexture2D(t,0),Ee.copyTexSubImage2D(Ee.TEXTURE_2D,n,0,0,e.x,e.y,r,s),ee.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,s=t.image.height,o=ye.convert(n.format),a=ye.convert(n.type);ie.setTexture2D(n,0),Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,n.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?Ee.texSubImage2D(Ee.TEXTURE_2D,i,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?Ee.compressedTexSubImage2D(Ee.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Ee.texSubImage2D(Ee.TEXTURE_2D,i,e.x,e.y,o,a,t.image),0===i&&n.generateMipmaps&&Ee.generateMipmap(Ee.TEXTURE_2D),ee.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(w.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=ye.convert(i.format),c=ye.convert(i.type);let u;if(i.isData3DTexture)ie.setTexture3D(i,0),u=Ee.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ie.setTexture2DArray(i,0),u=Ee.TEXTURE_2D_ARRAY}Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,i.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,i.unpackAlignment);const d=Ee.getParameter(Ee.UNPACK_ROW_LENGTH),h=Ee.getParameter(Ee.UNPACK_IMAGE_HEIGHT),p=Ee.getParameter(Ee.UNPACK_SKIP_PIXELS),f=Ee.getParameter(Ee.UNPACK_SKIP_ROWS),m=Ee.getParameter(Ee.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,g.width),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,g.height),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,e.min.x),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,e.min.y),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?Ee.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ee.compressedTexSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,g.data)):Ee.texSubImage3D(u,r,t.x,t.y,t.z,s,o,a,l,c,g),Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,d),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,h),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,p),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,f),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,m),0===r&&i.generateMipmaps&&Ee.generateMipmap(u),ee.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?ie.setTextureCube(e,0):e.isData3DTexture?ie.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ie.setTexture2DArray(e,0):ie.setTexture2D(e,0),ee.unbindTexture()},this.resetState=function(){E=0,C=0,S=null,ee.reset(),Ae.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Tn}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===zt?Ot:Bt}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Ot?zt:Gt}}class jl extends Fl{}jl.prototype.isWebGL1Renderer=!0;class zl{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Vr(e),this.density=t}clone(){return new zl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Gl{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Vr(e),this.near=t,this.far=n}clone(){return new Gl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Vl extends xr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class Hl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=gn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=On()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=On()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=On()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ql=new wi;class Wl{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Ql.fromBufferAttribute(this,t),Ql.applyMatrix4(e),this.setXYZ(t,Ql.x,Ql.y,Ql.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ql.fromBufferAttribute(this,t),Ql.applyNormalMatrix(e),this.setXYZ(t,Ql.x,Ql.y,Ql.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ql.fromBufferAttribute(this,t),Ql.transformDirection(e),this.setXYZ(t,Ql.x,Ql.y,Ql.z);return this}setX(e,t){return this.normalized&&(t=Vn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Vn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Vn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Vn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Gn(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Gn(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Gn(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Gn(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array),i=Vn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Vn(t,this.array),n=Vn(n,this.array),i=Vn(i,this.array),r=Vn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new $r(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Wl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ql extends Ur{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Vr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Xl;const Yl=new wi,Kl=new wi,Jl=new wi,Zl=new Qn,$l=new Qn,ec=new Zi,tc=new wi,nc=new wi,ic=new wi,rc=new Qn,sc=new Qn,oc=new Qn;class ac extends xr{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Xl){Xl=new _s;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Hl(e,5);Xl.setIndex([0,1,2,0,2,3]),Xl.setAttribute("position",new Wl(t,3,0,!1)),Xl.setAttribute("uv",new Wl(t,2,3,!1))}this.geometry=Xl,this.material=void 0!==e?e:new ql,this.center=new Qn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Kl.setFromMatrixScale(this.matrixWorld),ec.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Jl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Kl.multiplyScalar(-Jl.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;lc(tc.set(-.5,-.5,0),Jl,s,Kl,i,r),lc(nc.set(.5,-.5,0),Jl,s,Kl,i,r),lc(ic.set(.5,.5,0),Jl,s,Kl,i,r),rc.set(0,0),sc.set(1,0),oc.set(1,1);let o=e.ray.intersectTriangle(tc,nc,ic,!1,Yl);if(null===o&&(lc(nc.set(-.5,.5,0),Jl,s,Kl,i,r),sc.set(0,1),o=e.ray.intersectTriangle(tc,ic,nc,!1,Yl),null===o))return;const a=e.ray.origin.distanceTo(Yl);a<e.near||a>e.far||t.push({distance:a,point:Yl.clone(),uv:Or.getInterpolation(Yl,tc,nc,ic,rc,sc,oc,new Qn),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function lc(e,t,n,i,r,s){Zl.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?($l.x=s*Zl.x-r*Zl.y,$l.y=r*Zl.x+s*Zl.y):$l.copy(Zl),e.copy(t),e.x+=$l.x,e.y+=$l.y,e.applyMatrix4(ec)}const cc=new wi,uc=new wi;class dc extends xr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){cc.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(cc);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){cc.setFromMatrixPosition(e.matrixWorld),uc.setFromMatrixPosition(this.matrixWorld);const n=cc.distanceTo(uc)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const hc=new wi,pc=new fi,fc=new fi,mc=new wi,gc=new Zi,_c=new wi,vc=new Vi,yc=new Zi,bc=new Ji;class Ac extends Os{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Zi,this.bindMatrixInverse=new Zi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Ci),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)_c.fromBufferAttribute(t,n),this.applyBoneTransform(n,_c),this.boundingBox.expandByPoint(_c)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Vi),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)_c.fromBufferAttribute(t,n),this.applyBoneTransform(n,_c),this.boundingSphere.expandByPoint(_c)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),vc.copy(this.boundingSphere),vc.applyMatrix4(i),!1!==e.ray.intersectsSphere(vc)&&(yc.copy(i).invert(),bc.copy(e.ray).applyMatrix4(yc),null!==this.boundingBox&&!1===bc.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,bc)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new fi,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;pc.fromBufferAttribute(i.attributes.skinIndex,e),fc.fromBufferAttribute(i.attributes.skinWeight,e),hc.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=fc.getComponent(r);if(0!==e){const i=pc.getComponent(r);gc.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(mc.copy(hc).applyMatrix4(gc),e)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class wc extends xr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class xc extends pi{constructor(e=null,t=1,n=1,i,r,s,o,a,l=he,c=he,u,d){super(null,s,o,a,l,c,i,r,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ec=new Zi,Cc=new Zi;class Sc{constructor(e=[],t=[]){this.uuid=On(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Zi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Zi;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=e.length;r<s;r++){const i=e[r]?e[r].matrixWorld:Cc;Ec.multiplyMatrices(i,t[r]),Ec.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new Sc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=jn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new xc(t,e,e,Be,Te);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new wc),this.bones.push(r),this.boneInverses.push((new Zi).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const s=n[i];e.boneInverses.push(s.toArray())}return e}}class Mc extends $r{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Tc=new Zi,Ic=new Zi,Pc=[],Rc=new Ci,Dc=new Zi,kc=new Os,Bc=new Vi;class Oc extends Os{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Mc(new Float32Array(16*n),16),this.instanceColor=null,this.sourceTrs=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Dc)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Ci),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Tc),Rc.copy(e.boundingBox).applyMatrix4(Tc),this.boundingBox.union(Rc)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Vi),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Tc),Bc.copy(e.boundingSphere).applyMatrix4(Tc),this.boundingSphere.union(Bc)}copy(e,t){return super.copy(e,t),e.isInstancedMesh?(this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this):this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(kc.geometry=this.geometry,kc.material=this.material,void 0!==kc.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Bc.copy(this.boundingSphere),Bc.applyMatrix4(n),!1!==e.ray.intersectsSphere(Bc)))for(let r=0;r<i;r++){this.getMatrixAt(r,Tc),Ic.multiplyMatrices(n,Tc),kc.matrixWorld=Ic,kc.raycast(e,Pc);for(let e=0,n=Pc.length;e<n;e++){const n=Pc[e];n.instanceId=r,n.object=this,t.push(n)}Pc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Mc(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Lc extends Ur{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Vr(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Uc=new wi,Nc=new wi,Fc=new Zi,jc=new Ji,zc=new Vi;class Gc extends xr{constructor(e=new _s,t=new Lc){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Uc.fromBufferAttribute(t,e-1),Nc.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Uc.distanceTo(Nc);e.setAttribute("lineDistance",new ls(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),zc.copy(n.boundingSphere),zc.applyMatrix4(i),zc.radius+=r,!1===e.ray.intersectsSphere(zc))return;Fc.copy(i).invert(),jc.copy(e.ray).applyMatrix4(Fc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new wi,c=new wi,u=new wi,d=new wi,h=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p)for(let m=Math.max(0,s.start),g=Math.min(p.count,s.start+s.count)-1;m<g;m+=h){const n=p.getX(m),i=p.getX(m+1);if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,i),jc.distanceSqToSegment(l,c,d,u)>a)continue;d.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(d);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(let m=Math.max(0,s.start),g=Math.min(f.count,s.start+s.count)-1;m<g;m+=h){if(l.fromBufferAttribute(f,m),c.fromBufferAttribute(f,m+1),jc.distanceSqToSegment(l,c,d,u)>a)continue;d.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(d);n<e.near||n>e.far||t.push({distance:n,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const Vc=new wi,Hc=new wi;class Qc extends Gc{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Vc.fromBufferAttribute(t,e),Hc.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Vc.distanceTo(Hc);e.setAttribute("lineDistance",new ls(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Wc extends Gc{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class qc extends Ur{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Vr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Xc=new Zi,Yc=new Ji,Kc=new Vi,Jc=new wi;class Zc extends xr{constructor(e=new _s,t=new qc){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Kc.copy(n.boundingSphere),Kc.applyMatrix4(i),Kc.radius+=r,!1===e.ray.intersectsSphere(Kc))return;Xc.copy(i).invert(),Yc.copy(e.ray).applyMatrix4(Xc);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=n.index,c=n.attributes.position;if(null!==l)for(let u=Math.max(0,s.start),d=Math.min(l.count,s.start+s.count);u<d;u++){const n=l.getX(u);Jc.fromBufferAttribute(c,n),$c(Jc,n,a,i,e,t,this)}else for(let u=Math.max(0,s.start),d=Math.min(c.count,s.start+s.count);u<d;u++)Jc.fromBufferAttribute(c,u),$c(Jc,u,a,i,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function $c(e,t,n,i,r,s,o){const a=Yc.distanceSqToPoint(e);if(a<n){const n=new wi;Yc.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:o})}}class eu extends pi{constructor(e,t,n,i,r,s,o,a,l){super(e,t,n,i,r,s,o,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:_e,this.magFilter=void 0!==r?r:_e,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class tu extends pi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=he,this.minFilter=he,this.generateMipmaps=!1,this.needsUpdate=!0}}class nu extends pi{constructor(e,t,n,i,r,s,o,a,l,c,u,d){super(null,s,o,a,l,c,i,r,u,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class iu extends nu{constructor(e,t,n,i,r,s){super(e,t,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=ue}}class ru extends pi{constructor(e,t,n,i,r,s,o,a,l){super(e,t,n,i,r,s,o,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class su{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let o,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=n[i]-s,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),o=this.getPoint(r),a=t||(s.isVector2?new Qn:new wi);return a.copy(o).sub(s).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new wi,i=[],r=[],s=[],o=new wi,a=new Zi;for(let h=0;h<=e;h++){const t=h/e;i[h]=this.getTangentAt(t,new wi)}r[0]=new wi,s[0]=new wi;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),d=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),d<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let h=1;h<=e;h++){if(r[h]=r[h-1].clone(),s[h]=s[h-1].clone(),o.crossVectors(i[h-1],i[h]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(Ln(i[h-1].dot(i[h]),-1,1));r[h].applyMatrix4(a.makeRotationAxis(o,e))}s[h].crossVectors(i[h],r[h])}if(!0===t){let t=Math.acos(Ln(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class ou extends su{constructor(e=0,t=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const n=t||new Qn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const o=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class au extends ou{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function lu(){let e=0,t=0,n=0,i=0;function r(r,s,o,a){e=r,t=o,n=-3*r+3*s-2*o-a,i=2*r-2*s+o+a}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,o,a){let l=(t-e)/s-(n-e)/(s+o)+(n-t)/o,c=(n-t)/o-(i-t)/(o+a)+(i-n)/a;l*=o,c*=o,r(t,n,l,c)},calc:function(r){const s=r*r;return e+t*r+n*s+i*(s*r)}}}const cu=new wi,uu=new lu,du=new lu,hu=new lu;class pu extends su{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new wi){const n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?o=i[(l-1)%r]:(cu.subVectors(i[0],i[1]).add(i[0]),o=cu);const u=i[l%r],d=i[(l+1)%r];if(this.closed||l+2<r?a=i[(l+2)%r]:(cu.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=cu),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(d),e),i=Math.pow(d.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),uu.initNonuniformCatmullRom(o.x,u.x,d.x,a.x,t,n,i),du.initNonuniformCatmullRom(o.y,u.y,d.y,a.y,t,n,i),hu.initNonuniformCatmullRom(o.z,u.z,d.z,a.z,t,n,i)}else"catmullrom"===this.curveType&&(uu.initCatmullRom(o.x,u.x,d.x,a.x,this.tension),du.initCatmullRom(o.y,u.y,d.y,a.y,this.tension),hu.initCatmullRom(o.z,u.z,d.z,a.z,this.tension));return n.set(uu.calc(c),du.calc(c),hu.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new wi).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function fu(e,t,n,i,r){const s=.5*(i-t),o=.5*(r-n),a=e*e;return(2*n-2*i+s+o)*(e*a)+(-3*n+3*i-2*s-o)*a+s*e+n}function mu(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function gu(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class _u extends su{constructor(e=new Qn,t=new Qn,n=new Qn,i=new Qn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Qn){const n=t,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(gu(e,i.x,r.x,s.x,o.x),gu(e,i.y,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class vu extends su{constructor(e=new wi,t=new wi,n=new wi,i=new wi){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new wi){const n=t,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(gu(e,i.x,r.x,s.x,o.x),gu(e,i.y,r.y,s.y,o.y),gu(e,i.z,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class yu extends su{constructor(e=new Qn,t=new Qn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Qn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Qn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class bu extends su{constructor(e=new wi,t=new wi){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new wi){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new wi){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Au extends su{constructor(e=new Qn,t=new Qn,n=new Qn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Qn){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(mu(e,i.x,r.x,s.x),mu(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wu extends su{constructor(e=new wi,t=new wi,n=new wi){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new wi){const n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(mu(e,i.x,r.x,s.x),mu(e,i.y,r.y,s.y),mu(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class xu extends su{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Qn){const n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),o=r-s,a=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],u=i[s>i.length-3?i.length-1:s+2];return n.set(fu(o,a.x,l.x,c.x,u.x),fu(o,a.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Qn).fromArray(n))}return this}}var Eu=Object.freeze({__proto__:null,ArcCurve:au,CatmullRomCurve3:pu,CubicBezierCurve:_u,CubicBezierCurve3:vu,EllipseCurve:ou,LineCurve:yu,LineCurve3:bu,QuadraticBezierCurve:Au,QuadraticBezierCurve3:wu,SplineCurve:xu});class Cu extends su{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new yu(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,s=this.curves[r],o=s.getLength(),a=0===o?0:1-e/o;return s.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],o=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Eu[n.type]).fromJSON(n))}return this}}class Su extends Cu{constructor(e){super(),this.type="Path",this.currentPoint=new Qn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new yu(this.currentPoint.clone(),new Qn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new Au(this.currentPoint.clone(),new Qn(e,t),new Qn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){const o=new _u(this.currentPoint.clone(),new Qn(e,t),new Qn(n,i),new Qn(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new xu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,s,o,a),this}absellipse(e,t,n,i,r,s,o,a){const l=new ou(e,t,n,i,r,s,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Mu extends _s{constructor(e=[new Qn(0,-.5),new Qn(.5,0),new Qn(0,.5)],t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Ln(i,0,2*Math.PI);const r=[],s=[],o=[],a=[],l=[],c=1/t,u=new wi,d=new Qn,h=new wi,p=new wi,f=new wi;let m=0,g=0;for(let _=0;_<=e.length-1;_++)switch(_){case 0:m=e[_+1].x-e[_].x,g=e[_+1].y-e[_].y,h.x=1*g,h.y=-m,h.z=0*g,f.copy(h),h.normalize(),a.push(h.x,h.y,h.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[_+1].x-e[_].x,g=e[_+1].y-e[_].y,h.x=1*g,h.y=-m,h.z=0*g,p.copy(h),h.x+=f.x,h.y+=f.y,h.z+=f.z,h.normalize(),a.push(h.x,h.y,h.z),f.copy(p)}for(let _=0;_<=t;_++){const r=n+_*c*i,h=Math.sin(r),p=Math.cos(r);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*h,u.y=e[n].y,u.z=e[n].x*p,s.push(u.x,u.y,u.z),d.x=_/t,d.y=n/(e.length-1),o.push(d.x,d.y);const i=a[3*n+0]*h,r=a[3*n+1],c=a[3*n+0]*p;l.push(i,r,c)}}for(let _=0;_<t;_++)for(let t=0;t<e.length-1;t++){const n=t+_*e.length,i=n,s=n+e.length,o=n+e.length+1,a=n+1;r.push(i,s,a),r.push(o,a,s)}this.setIndex(r),this.setAttribute("position",new ls(s,3)),this.setAttribute("uv",new ls(o,2)),this.setAttribute("normal",new ls(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mu(e.points,e.segments,e.phiStart,e.phiLength)}}class Tu extends Mu{constructor(e=1,t=1,n=4,i=8){const r=new Su;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new Tu(e.radius,e.length,e.capSegments,e.radialSegments)}}class Iu extends _s{constructor(e=1,t=32,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],s=[],o=[],a=[],l=new wi,c=new Qn;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const r=n+u/t*i;l.x=e*Math.cos(r),l.y=e*Math.sin(r),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[d]/e+1)/2,c.y=(s[d+1]/e+1)/2,a.push(c.x,c.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new ls(s,3)),this.setAttribute("normal",new ls(o,3)),this.setAttribute("uv",new ls(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Iu(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Pu extends _s{constructor(e=1,t=1,n=1,i=32,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],d=[],h=[];let p=0;const f=[],m=n/2;let g=0;function _(n){const r=p,s=new Qn,f=new wi;let _=0;const v=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*y,0),d.push(0,y,0),h.push(.5,.5),p++;const b=p;for(let e=0;e<=i;e++){const t=e/i*a+o,n=Math.cos(t),r=Math.sin(t);f.x=v*r,f.y=m*y,f.z=v*n,u.push(f.x,f.y,f.z),d.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,h.push(s.x,s.y),p++}for(let e=0;e<i;e++){const t=r+e,i=b+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),_+=3}l.addGroup(g,_,!0===n?1:2),g+=_}!function(){const s=new wi,_=new wi;let v=0;const y=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+o,l=Math.sin(r),f=Math.cos(r);_.x=v*l,_.y=-g*n+m,_.z=v*f,u.push(_.x,_.y,_.z),s.set(l,y,f).normalize(),d.push(s.x,s.y,s.z),h.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],s=f[t][e+1];c.push(n,i,s),c.push(i,r,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new ls(u,3)),this.setAttribute("normal",new ls(d,3)),this.setAttribute("uv",new ls(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ru extends Pu{constructor(e=1,t=1,n=32,i=1,r=!1,s=0,o=2*Math.PI){super(0,e,t,n,i,r,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(e){return new Ru(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Du extends _s{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],s=[];function o(e,t,n,i){const r=i+1,s=[];for(let o=0;o<=r;o++){s[o]=[];const i=e.clone().lerp(n,o/r),a=t.clone().lerp(n,o/r),l=r-o;for(let e=0;e<=l;e++)s[o][e]=0===e&&o===r?i:i.clone().lerp(a,e/l)}for(let o=0;o<r;o++)for(let e=0;e<2*(r-o)-1;e++){const t=Math.floor(e/2);e%2==0?(a(s[o][t+1]),a(s[o+1][t]),a(s[o][t])):(a(s[o][t+1]),a(s[o+1][t+1]),a(s[o+1][t]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new wi,i=new wi,r=new wi;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],i),l(t[s+2],r),o(n,i,r,e)}(i),function(e){const t=new wi;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new wi;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=u(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(i,1-o)}var t;(function(){const e=new wi,t=new wi,n=new wi,i=new wi,o=new Qn,a=new Qn,l=new Qn;for(let d=0,h=0;d<r.length;d+=9,h+=6){e.set(r[d+0],r[d+1],r[d+2]),t.set(r[d+3],r[d+4],r[d+5]),n.set(r[d+6],r[d+7],r[d+8]),o.set(s[h+0],s[h+1]),a.set(s[h+2],s[h+3]),l.set(s[h+4],s[h+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=u(i);c(o,h+0,e,p),c(a,h+2,t,p),c(l,h+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new ls(r,3)),this.setAttribute("normal",new ls(r.slice(),3)),this.setAttribute("uv",new ls(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Du(e.vertices,e.indices,e.radius,e.details)}}class ku extends Du{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ku(e.radius,e.detail)}}const Bu=new wi,Ou=new wi,Lu=new wi,Uu=new Or;class Nu extends _s{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(kn*t),s=e.getIndex(),o=e.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),d={},h=[];for(let e=0;e<a;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:a}=Uu;if(t.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),Uu.getNormal(Lu),u[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,u[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,u[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],i=u[t],s=Uu[c[e]],o=Uu[c[t]],a=`${n}_${i}`,p=`${i}_${n}`;p in d&&d[p]?(Lu.dot(d[p].normal)<=r&&(h.push(s.x,s.y,s.z),h.push(o.x,o.y,o.z)),d[p]=null):a in d||(d[a]={index0:l[e],index1:l[t],normal:Lu.clone()})}}for(const e in d)if(d[e]){const{index0:t,index1:n}=d[e];Bu.fromBufferAttribute(o,t),Ou.fromBufferAttribute(o,n),h.push(Bu.x,Bu.y,Bu.z),h.push(Ou.x,Ou.y,Ou.z)}this.setAttribute("position",new ls(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Fu extends Su{constructor(e){super(e),this.uuid=On(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Su).fromJSON(n))}return this}}function ju(e,t,n,i,r){let s,o;if(r===function(e,t,n,i){let r=0;for(let s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,n,i)>0)for(s=t;s<n;s+=i)o=ad(s,e[s],e[s+1],o);else for(s=n-i;s>=t;s-=i)o=ad(s,e[s],e[s+1],o);return o&&td(o,o.next)&&(ld(o),o=o.next),o}function zu(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!td(i,i.next)&&0!==ed(i.prev,i,i.next))i=i.next;else{if(ld(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Gu(e,t,n,i,r,s,o){if(!e)return;!o&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Ku(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,s,o,a,l,c=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(e,i,r,s);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,s?Hu(e,i,r,s):Vu(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),ld(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Gu(e=Qu(zu(e),t,n),t,n,i,r,s,2):2===o&&Wu(e,t,n,i,r,s):Gu(zu(e),t,n,i,r,s,1);break}}function Vu(e){const t=e.prev,n=e,i=e.next;if(ed(t,n,i)>=0)return!1;const r=t.x,s=n.x,o=i.x,a=t.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,d=a<l?a<c?a:c:l<c?l:c,h=r>s?r>o?r:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=h&&f.y>=d&&f.y<=p&&Zu(r,a,s,l,o,c,f.x,f.y)&&ed(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Hu(e,t,n,i){const r=e.prev,s=e,o=e.next;if(ed(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,d=s.y,h=o.y,p=a<l?a<c?a:c:l<c?l:c,f=u<d?u<h?u:h:d<h?d:h,m=a>l?a>c?a:c:l>c?l:c,g=u>d?u>h?u:h:d>h?d:h,_=Ku(p,f,t,n,i),v=Ku(m,g,t,n,i);let y=e.prevZ,b=e.nextZ;for(;y&&y.z>=_&&b&&b.z<=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==r&&y!==o&&Zu(a,u,l,d,c,h,y.x,y.y)&&ed(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&Zu(a,u,l,d,c,h,b.x,b.y)&&ed(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;y&&y.z>=_;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==r&&y!==o&&Zu(a,u,l,d,c,h,y.x,y.y)&&ed(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==o&&Zu(a,u,l,d,c,h,b.x,b.y)&&ed(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Qu(e,t,n){let i=e;do{const r=i.prev,s=i.next.next;!td(r,s)&&nd(r,i,i.next,s)&&sd(r,s)&&sd(s,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),ld(i),ld(i.next),i=e=s),i=i.next}while(i!==e);return zu(i)}function Wu(e,t,n,i,r,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&$u(o,e)){let a=od(o,e);return o=zu(o,o.next),a=zu(a,a.next),Gu(o,t,n,i,r,s,0),void Gu(a,t,n,i,r,s,0)}e=e.next}o=o.next}while(o!==e)}function qu(e,t){return e.x-t.x}function Xu(e,t){const n=function(e,t){let n,i=t,r=-1/0;const s=e.x,o=e.y;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){const e=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=s&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===s))return n}i=i.next}while(i!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let u,d=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&Zu(o<c?s:r,o,l,c,o<c?r:s,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(s-i.x),sd(i,e)&&(u<d||u===d&&(i.x>n.x||i.x===n.x&&Yu(n,i)))&&(n=i,d=u)),i=i.next}while(i!==a);return n}(e,t);if(!n)return t;const i=od(n,e);return zu(i,i.next),zu(n,n.next)}function Yu(e,t){return ed(e.prev,e,t.prev)<0&&ed(t.next,e,e.next)<0}function Ku(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ju(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Zu(e,t,n,i,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(i-a)>=(n-o)*(t-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function $u(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&nd(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(sd(e,t)&&sd(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(ed(e.prev,e,t.prev)||ed(e,t.prev,t))||td(e,t)&&ed(e.prev,e,e.next)>0&&ed(t.prev,t,t.next)>0)}function ed(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function td(e,t){return e.x===t.x&&e.y===t.y}function nd(e,t,n,i){const r=rd(ed(e,t,n)),s=rd(ed(e,t,i)),o=rd(ed(n,i,e)),a=rd(ed(n,i,t));return r!==s&&o!==a||!(0!==r||!id(e,n,t))||!(0!==s||!id(e,i,t))||!(0!==o||!id(n,e,i))||!(0!==a||!id(n,t,i))}function id(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function rd(e){return e>0?1:e<0?-1:0}function sd(e,t){return ed(e.prev,e,e.next)<0?ed(e,t,e.next)>=0&&ed(e,e.prev,t)>=0:ed(e,t,e.prev)<0||ed(e,e.next,t)<0}function od(e,t){const n=new cd(e.i,e.x,e.y),i=new cd(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function ad(e,t,n,i){const r=new cd(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function ld(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function cd(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ud{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return ud.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];dd(e),hd(n,e);let s=e.length;t.forEach(dd);for(let a=0;a<t.length;a++)i.push(s),s+=t[a].length,hd(n,t[a]);const o=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let s=ju(e,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,d,h,p;if(i&&(s=function(e,t,n,i){const r=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;s++)a=t[s]*i,l=s<o-1?t[s+1]*i:e.length,c=ju(e,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Ju(c));for(r.sort(qu),s=0;s<r.length;s++)n=Xu(r[s],n);return n}(e,t,s,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)d=e[t],h=e[t+1],d<a&&(a=d),h<l&&(l=h),d>c&&(c=d),h>u&&(u=h);p=Math.max(c-a,u-l),p=0!==p?32767/p:0}return Gu(s,o,n,a,l,p,0),o}(n,i);for(let a=0;a<o.length;a+=3)r.push(o.slice(a,a+3));return r}}function dd(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function hd(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class pd extends _s{constructor(e=new Fu([new Qn(.5,.5),new Qn(-.5,.5),new Qn(-.5,-.5),new Qn(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let o=0,a=e.length;o<a;o++)s(e[o]);function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:u-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:fd;let g,_,v,y,b,A=!1;f&&(g=f.getSpacedPoints(a),A=!0,c=!1,_=f.computeFrenetFrames(a,!1),v=new wi,y=new wi,b=new wi),c||(p=0,u=0,d=0,h=0);const w=e.extractPoints(o);let x=w.shape;const E=w.holes;if(!ud.isClockWise(x)){x=x.reverse();for(let e=0,t=E.length;e<t;e++){const t=E[e];ud.isClockWise(t)&&(E[e]=t.reverse())}}const C=ud.triangulateShape(x,E),S=x;for(let t=0,n=E.length;t<n;t++){const e=E[t];x=x.concat(e)}function M(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const T=x.length,I=C.length;function P(e,t,n){let i,r,s;const o=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+a*a,d=o*c-a*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(u),h=Math.sqrt(l*l+c*c),p=t.x-a/d,f=t.y+o/d,m=((n.x-c/h-p)*c-(n.y+l/h-f)*l)/(o*c-a*l);i=p+o*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new Qn(i,r);s=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(i=-a,r=o,s=Math.sqrt(u)):(i=o,r=a,s=Math.sqrt(u/2))}return new Qn(i/s,r/s)}const R=[];for(let t=0,n=S.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),R[t]=P(S[t],S[i],S[r]);const D=[];let k,B=R.concat();for(let t=0,n=E.length;t<n;t++){const e=E[t];k=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),k[t]=P(e[t],e[i],e[r]);D.push(k),B=B.concat(k)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,r=S.length;t<r;t++){const e=M(S[t],R[t],i);U(e.x,e.y,-n)}for(let t=0,r=E.length;t<r;t++){const e=E[t];k=D[t];for(let t=0,r=e.length;t<r;t++){const r=M(e[t],k[t],i);U(r.x,r.y,-n)}}}const O=d+h;for(let t=0;t<T;t++){const e=c?M(x[t],B[t],O):x[t];A?(y.copy(_.normals[0]).multiplyScalar(e.x),v.copy(_.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(y).add(v),U(b.x,b.y,b.z)):U(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<T;e++){const n=c?M(x[e],B[e],O):x[e];A?(y.copy(_.normals[t]).multiplyScalar(n.x),v.copy(_.binormals[t]).multiplyScalar(n.y),b.copy(g[t]).add(y).add(v),U(b.x,b.y,b.z)):U(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,r=S.length;t<r;t++){const e=M(S[t],R[t],i);U(e.x,e.y,l+n)}for(let t=0,r=E.length;t<r;t++){const e=E[t];k=D[t];for(let t=0,r=e.length;t<r;t++){const r=M(e[t],k[t],i);A?U(r.x,r.y+g[a-1].y,g[a-1].x+n):U(r.x,r.y,l+n)}}}function L(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=T*e,s=T*(e+1);F(t+i+n,t+r+n,t+r+s,t+i+s)}}}function U(e,t,n){s.push(e),s.push(t),s.push(n)}function N(e,t,r){j(e),j(t),j(r);const s=i.length/3,o=m.generateTopUV(n,i,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[2])}function F(e,t,r,s){j(e),j(t),j(s),j(t),j(r),j(s);const o=i.length/3,a=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[3]),z(a[1]),z(a[2]),z(a[3])}function j(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function z(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=T*e;for(let n=0;n<I;n++){const e=C[n];N(e[2]+t,e[1]+t,e[0]+t)}e=a+2*p,t=T*e;for(let n=0;n<I;n++){const e=C[n];N(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<I;e++){const t=C[e];N(t[2],t[1],t[0])}for(let e=0;e<I;e++){const t=C[e];N(t[0]+T*a,t[1]+T*a,t[2]+T*a)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;L(S,t),t+=S.length;for(let n=0,i=E.length;n<i;n++){const e=E[n];L(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new ls(i,3)),this.setAttribute("uv",new ls(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const i=t[e.shapes[r]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Eu[i.type]).fromJSON(i)),new pd(n,e.options)}}const fd={generateTopUV:function(e,t,n,i,r){const s=t[3*n],o=t[3*n+1],a=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new Qn(s,o),new Qn(a,l),new Qn(c,u)]},generateSideWallUV:function(e,t,n,i,r,s){const o=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],d=t[3*i+2],h=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*s],g=t[3*s+1],_=t[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new Qn(o,1-l),new Qn(c,1-d),new Qn(h,1-f),new Qn(m,1-_)]:[new Qn(a,1-l),new Qn(u,1-d),new Qn(p,1-f),new Qn(g,1-_)]}};class md extends Du{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new md(e.radius,e.detail)}}class gd extends Du{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new gd(e.radius,e.detail)}}class _d extends _s{constructor(e=.5,t=1,n=32,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const o=[],a=[],l=[],c=[];let u=e;const d=(t-e)/(i=Math.max(1,i)),h=new wi,p=new Qn;for(let f=0;f<=i;f++){for(let e=0;e<=n;e++){const i=r+e/n*s;h.x=u*Math.cos(i),h.y=u*Math.sin(i),a.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,c.push(p.x,p.y)}u+=d}for(let f=0;f<i;f++){const e=f*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,s=i+n+1,a=i+n+2,l=i+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new ls(a,3)),this.setAttribute("normal",new ls(l,3)),this.setAttribute("uv",new ls(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _d(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class vd extends _s{constructor(e=new Fu([new Qn(0,.5),new Qn(-.5,-.5),new Qn(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(o,a,c),o+=a,a=0;function l(e){const o=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===ud.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===ud.isClockWise(e)&&(u[t]=e.reverse())}const d=ud.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,i=d.length;t<i;t++){const e=d[t],i=e[0]+o,r=e[1]+o,s=e[2]+o;n.push(i,r,s),a+=3}}this.setIndex(n),this.setAttribute("position",new ls(i,3)),this.setAttribute("normal",new ls(r,3)),this.setAttribute("uv",new ls(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new vd(n,e.curveSegments)}}class yd extends _s{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new wi,d=new wi,h=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const h=[],_=g/n;let v=0;0===g&&0===s?v=.5/t:g===n&&a===Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(s+_*o),u.y=e*Math.cos(s+_*o),u.z=e*Math.sin(i+a*r)*Math.sin(s+_*o),p.push(u.x,u.y,u.z),d.copy(u).normalize(),f.push(d.x,d.y,d.z),m.push(a+v,1-_),h.push(l++)}c.push(h)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],o=c[g+1][e+1];(0!==g||s>0)&&h.push(t,i,o),(g!==n-1||a<Math.PI)&&h.push(i,r,o)}this.setIndex(h),this.setAttribute("position",new ls(p,3)),this.setAttribute("normal",new ls(f,3)),this.setAttribute("uv",new ls(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yd(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class bd extends Du{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bd(e.radius,e.detail)}}class Ad extends _s{constructor(e=1,t=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],o=[],a=[],l=[],c=new wi,u=new wi,d=new wi;for(let h=0;h<=n;h++)for(let s=0;s<=i;s++){const p=s/i*r,f=h/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),o.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(u,c).normalize(),a.push(d.x,d.y,d.z),l.push(s/i),l.push(h/n)}for(let h=1;h<=n;h++)for(let e=1;e<=i;e++){const t=(i+1)*h+e-1,n=(i+1)*(h-1)+e-1,r=(i+1)*(h-1)+e,o=(i+1)*h+e;s.push(t,n,o),s.push(n,r,o)}this.setIndex(s),this.setAttribute("position",new ls(o,3)),this.setAttribute("normal",new ls(a,3)),this.setAttribute("uv",new ls(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ad(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class wd extends _s{constructor(e=1,t=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],l=[],c=[],u=new wi,d=new wi,h=new wi,p=new wi,f=new wi,m=new wi,g=new wi;for(let v=0;v<=n;++v){const o=v/n*r*Math.PI*2;_(o,r,s,e,h),_(o+.01,r,s,e,p),m.subVectors(p,h),g.addVectors(p,h),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,s=-t*Math.cos(r),o=t*Math.sin(r);u.x=h.x+(s*g.x+o*f.x),u.y=h.y+(s*g.y+o*f.y),u.z=h.z+(s*g.z+o*f.z),a.push(u.x,u.y,u.z),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(v/n),c.push(e/i)}}for(let v=1;v<=n;v++)for(let e=1;e<=i;e++){const t=(i+1)*(v-1)+(e-1),n=(i+1)*v+(e-1),r=(i+1)*v+e,s=(i+1)*(v-1)+e;o.push(t,n,s),o.push(n,r,s)}function _(e,t,n,i,r){const s=Math.cos(e),o=Math.sin(e),a=n/t*e,l=Math.cos(a);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new ls(a,3)),this.setAttribute("normal",new ls(l,3)),this.setAttribute("uv",new ls(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wd(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class xd extends _s{constructor(e=new wu(new wi(-1,-1,0),new wi(-1,1,0),new wi(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new wi,a=new wi,l=new Qn;let c=new wi;const u=[],d=[],h=[],p=[];function f(r){c=e.getPointAt(r/t,c);const l=s.normals[r],h=s.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);a.x=s*l.x+r*h.x,a.y=s*l.y+r*h.y,a.z=s*l.z+r*h.z,a.normalize(),d.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,h.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),s=(i+1)*e+t,o=(i+1)*(e-1)+t;p.push(n,r,o),p.push(r,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new ls(u,3)),this.setAttribute("normal",new ls(d,3)),this.setAttribute("uv",new ls(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new xd((new Eu[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Ed extends _s{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new wi,r=new wi;if(null!==e.index){const s=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let l=0;l<3;l++){const a=o.getX(e+l),c=o.getX(e+(l+1)%3);i.fromBufferAttribute(s,a),r.fromBufferAttribute(s,c),!0===Cd(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const s=e.attributes.position;for(let e=0,o=s.count/3;e<o;e++)for(let a=0;a<3;a++){const o=3*e+a,l=3*e+(a+1)%3;i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Cd(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new ls(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Cd(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Sd=Object.freeze({__proto__:null,BoxGeometry:Us,CapsuleGeometry:Tu,CircleGeometry:Iu,ConeGeometry:Ru,CylinderGeometry:Pu,DodecahedronGeometry:ku,EdgesGeometry:Nu,ExtrudeGeometry:pd,IcosahedronGeometry:md,LatheGeometry:Mu,OctahedronGeometry:gd,PlaneGeometry:ro,PolyhedronGeometry:Du,RingGeometry:_d,ShapeGeometry:vd,SphereGeometry:yd,TetrahedronGeometry:bd,TorusGeometry:Ad,TorusKnotGeometry:wd,TubeGeometry:xd,WireframeGeometry:Ed});class Md extends Ur{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Vr(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Td extends Gs{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Id extends Ur{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Vr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nt,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Pd extends Id{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Qn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ln(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Vr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Vr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Vr(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Rd extends Ur{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Vr(16777215),this.specular=new Vr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nt,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Dd extends Ur{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Vr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nt,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class kd extends Ur{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nt,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Bd extends Ur{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Vr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nt,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Od extends Ur{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Vr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nt,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ld extends Lc{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Ud(e,t,n){return Fd(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function Nd(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Fd(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function jd(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function zd(e,t,n){const i=e.length,r=new e.constructor(i);for(let s=0,o=0;o!==i;++s){const i=n[s]*t;for(let n=0;n!==t;++n)r[o++]=e[i+n]}return r}function Gd(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(t.push(s.time),n.push.apply(n,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(t.push(s.time),o.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(t.push(s.time),n.push(o)),s=e[r++]}while(void 0!==s)}const Vd={arraySlice:Ud,convertArray:Nd,isTypedArray:Fd,getKeyframeOrder:jd,sortedArray:zd,flattenJSON:Gd,subclip:function(e,t,n,i,r=30){const s=e.clone();s.name=t;const o=[];for(let l=0;l<s.tracks.length;++l){const e=s.tracks[l],t=e.getValueSize(),a=[],c=[];for(let s=0;s<e.times.length;++s){const o=e.times[s]*r;if(!(o<n||o>=i)){a.push(e.times[s]);for(let n=0;n<t;++n)c.push(e.values[s*t+n])}}0!==a.length&&(e.times=Nd(a,e.times.constructor),e.values=Nd(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,s=t/i;for(let o=0;o<r;++o){const t=n.tracks[o],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const r=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===i}));if(void 0===r)continue;let a=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const d=t.times.length-1;let h;if(s<=t.times[0]){const e=a,n=l-a;h=Ud(t.values,e,n)}else if(s>=t.times[d]){const e=d*l+a,n=e+l-a;h=Ud(t.values,e,n)}else{const e=t.createInterpolant(),n=a,i=l-a;e.evaluate(s),h=Ud(e.resultBuffer,n,i)}"quaternion"===i&&(new Ai).fromArray(h).normalize().conjugate().toArray(h);const p=r.times.length;for(let e=0;e<p;++e){const t=e*u+c;if("quaternion"===i)Ai.multiplyQuaternionsFlat(r.values,t,h,0,r.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)r.values[t+n]-=h[n]}}}return e.blendMode=Pt,e}};class Hd{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(e>=r)break e;{const o=t[1];e<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0}}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Qd extends Hd{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:St,endingEnd:St}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case Mt:r=e,o=2*t-n;break;case Tt:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Mt:s=e,a=2*n-t;break;case Tt:s=1,a=n+i[1]-i[0];break;default:s=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,_=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,v=(-1-h)*m+(1.5+h)*f+.5*p,y=h*m-h*f;for(let b=0;b!==o;++b)r[b]=g*s[c+b]+_*s[l+b]+v*s[a+b]+y*s[u+b];return r}}class Wd extends Hd{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(n-t)/(i-t),u=1-c;for(let d=0;d!==o;++d)r[d]=s[l+d]*u+s[a+d]*c;return r}}class qd extends Hd{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Xd{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Nd(t,this.TimeBufferType),this.values=Nd(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Nd(e.times,Array),values:Nd(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new qd(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Wd(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Qd(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case xt:t=this.InterpolantFactoryMethodDiscrete;break;case Et:t=this.InterpolantFactoryMethodLinear;break;case Ct:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xt;case this.InterpolantFactoryMethodLinear:return Et;case this.InterpolantFactoryMethodSmooth:return Ct}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=Ud(n,r,s),this.values=Ud(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let o=0;o!==r;o++){const t=n[o];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==s&&s>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,t,s),e=!1;break}s=t}if(void 0!==i&&Fd(i))for(let o=0,a=i.length;o!==a;++o){const t=i[o];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=Ud(this.times),t=Ud(this.values),n=this.getValueSize(),i=this.getInterpolation()===Ct,r=e.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(i)r=!0;else{const e=o*n,i=e-n,s=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[i+o]||n!==t[s+o]){r=!0;break}}}if(r){if(o!==s){e[s]=e[o];const i=o*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,o=0;o!==n;++o)t[i+o]=t[e+o];++s}return s!==e.length?(this.times=Ud(e,0,s),this.values=Ud(t,0,s*n)):(this.times=e,this.values=t),this}clone(){const e=Ud(this.times,0),t=Ud(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Xd.prototype.TimeBufferType=Float32Array,Xd.prototype.ValueBufferType=Float32Array,Xd.prototype.DefaultInterpolation=Et;class Yd extends Xd{}Yd.prototype.ValueTypeName="bool",Yd.prototype.ValueBufferType=Array,Yd.prototype.DefaultInterpolation=xt,Yd.prototype.InterpolantFactoryMethodLinear=void 0,Yd.prototype.InterpolantFactoryMethodSmooth=void 0;class Kd extends Xd{}Kd.prototype.ValueTypeName="color";class Jd extends Xd{}Jd.prototype.ValueTypeName="number";class Zd extends Hd{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-t)/(i-t);let l=e*o;for(let c=l+o;l!==c;l+=4)Ai.slerpFlat(r,0,s,l-o,s,l,a);return r}}class $d extends Xd{InterpolantFactoryMethodLinear(e){return new Zd(this.times,this.values,this.getValueSize(),e)}}$d.prototype.ValueTypeName="quaternion",$d.prototype.DefaultInterpolation=Et,$d.prototype.InterpolantFactoryMethodSmooth=void 0;class eh extends Xd{}eh.prototype.ValueTypeName="string",eh.prototype.ValueBufferType=Array,eh.prototype.DefaultInterpolation=xt,eh.prototype.InterpolantFactoryMethodLinear=void 0,eh.prototype.InterpolantFactoryMethodSmooth=void 0;class th extends Xd{}th.prototype.ValueTypeName="vector";class nh{constructor(e,t=-1,n,i=It){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=On(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,o=n.length;s!==o;++s)t.push(ih(n[s]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=n.length;r!==s;++r)t.push(Xd.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,s=[];for(let o=0;o<r;o++){let e=[],a=[];e.push((o+r-1)%r,o,(o+1)%r),a.push(0,1,0);const l=jd(e);e=zd(e,1,l),a=zd(a,1,l),i||0!==e[0]||(e.push(r),a.push(a[0])),s.push(new Jd(".morphTargetInfluences["+t[o].name+"]",e,a).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,a=e.length;o<a;o++){const t=e[o],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const s=[];for(const o in i)s.push(this.CreateFromMorphTargetSequence(o,i[o],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const s=[],o=[];Gd(n,s,o,i),0!==s.length&&r.push(new e(t,s,o))}},i=[],r=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],s=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),s.push(i.morphTarget===r?1:0)}i.push(new Jd(".morphTargetInfluence["+r+"]",t,s))}a=t.length*s}else{const r=".bones["+t[c].name+"]";n(th,r+".position",e,"pos",i),n($d,r+".quaternion",e,"rot",i),n(th,r+".scale",e,"scl",i)}}return 0===i.length?null:new this(r,a,i,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ih(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Jd;case"vector":case"vector2":case"vector3":case"vector4":return th;case"color":return Kd;case"quaternion":return $d;case"bool":case"boolean":return Yd;case"string":return eh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Gd(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const rh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e,t){return!1===this.enabled?t?Promise.resolve():void 0:t?Promise.resolve(this.files[e]):this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class sh{constructor(e,t,n){const i=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===s&&void 0!==i.onStart&&i.onStart(e,o,a),s=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const oh=new sh;class ah{constructor(e){this.manager=void 0!==e?e:oh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const lh={};class ch extends Error{constructor(e,t){super(e),this.response=t}}class uh extends ah{constructor(e){super(e),this.responseType="text",this.useCache=!0}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),(this.useCache?rh.get(e,this.responseType,this.mimeType):Promise.resolve(void 0)).then((r=>{if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==lh[e])return void lh[e].push({onLoad:t,onProgress:n,onError:i});lh[e]=[],lh[e].push({onLoad:t,onProgress:n,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=lh[e],i=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}))}()}});return new Response(l)}throw new ch(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,o)));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{this.useCache&&rh.add(e,t,this.responseType);const n=lh[e];delete lh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=lh[e];if(void 0===n)throw this.manager.itemError(e),t;delete lh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.useCache&&this.manager.itemEnd(e)})),this.useCache&&this.manager.itemStart(e)}))}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class dh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new uh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=nh.parse(e[n]);t.push(i)}return t}}class hh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=this,s=[],o=new nu,a=new uh(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const n=r.parse(e,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=_e),o.image=s,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,i)}if(Array.isArray(e))for(let u=0,d=e.length;u<d;++u)c(u);else a.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}o.image=s}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=_e),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,i);return o}}class ph extends ah{constructor(e){super(e)}load(e,t,n,i){const r=e;void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=rh.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout((function(){t&&t(o),s.manager.itemEnd(e)}),0),o;const a=Jn("img");function l(){u(),rh.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(t){u(),i&&i(t),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),rh.get(e,"blob").then((t=>{if(void 0!==t&&!t.type.startsWith("text/plain"))return t.type||(e.endsWith(".svg")||e.startsWith("data:image/svg"))&&(t=new Blob([t],{type:"image/svg+xml"})),void(a.src=URL.createObjectURL(t));const s=new uh(this.manager);s.useCache=!1,s.setPath(this.path),s.setCrossOrigin(this.crossOrigin),s.setResponseType("blob"),s.load(r,(function(t){t.type||(e.endsWith(".svg")||e.startsWith("data:image/svg"))&&(t=new Blob([t],{type:"image/svg+xml"})),rh.add(e,t,"blob"),a.src=URL.createObjectURL(t)}),n,(e=>{u(),i&&i(e)}))})),a}}class fh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=new qs;r.colorSpace=zt;const s=new ph(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(e[n],(function(e){r.images[n]=e,o++,6===o&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let l=0;l<e.length;++l)a(l);return r}}class mh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new xc,o=new uh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){const n=r.parse(e);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data,s.image.complete=!0),s.wrapS=void 0!==n.wrapS?n.wrapS:ue,s.wrapT=void 0!==n.wrapT?n.wrapT:ue,s.magFilter=void 0!==n.magFilter?n.magFilter:_e,s.minFilter=void 0!==n.minFilter?n.minFilter:_e,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?s.colorSpace=n.colorSpace:void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=be),1===n.mipmapCount&&(s.minFilter=_e),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n))}),n,i),s}}class gh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=new pi,s=new ph(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class _h extends xr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Vr(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class vh extends _h{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(xr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Vr(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const yh=new Zi,bh=new wi,Ah=new wi;class wh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Qn(512,512),this.map=null,this.mapPass=null,this.matrix=new Zi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new to,this._frameExtents=new Qn(1,1),this._viewportCount=1,this._viewports=[new fi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;bh.setFromMatrixPosition(e.matrixWorld),t.position.copy(bh),Ah.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Ah),t.updateMatrixWorld(),yh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(yh)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.normalBias=e.normalBias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class xh extends wh{constructor(){super(new Hs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Bn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Eh extends _h{constructor(e,t,n=0,i=Math.PI/3,r=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(xr.DEFAULT_UP),this.updateMatrix(),this.target=new xr,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new xh}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Ch=new Zi,Sh=new wi,Mh=new wi;class Th extends wh{constructor(){super(new Hs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Qn(4,2),this._viewportCount=6,this._viewports=[new fi(2,1,1,1),new fi(0,1,1,1),new fi(3,1,1,1),new fi(1,1,1,1),new fi(3,0,1,1),new fi(1,0,1,1)],this._cubeDirections=[new wi(1,0,0),new wi(-1,0,0),new wi(0,0,1),new wi(0,0,-1),new wi(0,1,0),new wi(0,-1,0)],this._cubeUps=[new wi(0,1,0),new wi(0,1,0),new wi(0,1,0),new wi(0,1,0),new wi(0,0,1),new wi(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Sh.setFromMatrixPosition(e.matrixWorld),n.position.copy(Sh),Mh.copy(n.position),Mh.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Mh),n.updateMatrixWorld(),i.makeTranslation(-Sh.x,-Sh.y,-Sh.z),Ch.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ch)}}class Ih extends _h{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Th}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Ph extends wh{constructor(){super(new go(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Rh extends _h{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(xr.DEFAULT_UP),this.updateMatrix(),this.target=new xr,this.shadow=new Ph}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Dh extends _h{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class kh extends _h{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Bh{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new wi)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*i*1.092548),t.addScaledVector(s[5],i*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],n*r*1.092548),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*i),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*i),t.addScaledVector(s[5],.858086*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class Oh extends _h{constructor(e=new Bh,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Lh extends ah{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,s=new uh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=e.metadata&&e.metadata.version<=4.5?Gt:void 0,r=Lh.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color,i),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new Vr).setHex(e.sheenColor,i)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive,i),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular,i),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor,i),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor,i),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const s in e.uniforms){const t=e.uniforms[s];switch(r.uniforms[s]={},t.type){case"t":r.uniforms[s].value=n(t.value);break;case"c":r.uniforms[s].value=(new Vr).setHex(t.value,i);break;case"v2":r.uniforms[s].value=(new Qn).fromArray(t.value);break;case"v3":r.uniforms[s].value=(new wi).fromArray(t.value);break;case"v4":r.uniforms[s].value=(new fi).fromArray(t.value);break;case"m3":r.uniforms[s].value=(new Wn).fromArray(t.value);break;case"m4":r.uniforms[s].value=(new Zi).fromArray(t.value);break;default:r.uniforms[s].value=t.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new Qn).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Qn).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Md,SpriteMaterial:ql,RawShaderMaterial:Td,ShaderMaterial:Gs,PointsMaterial:qc,MeshPhysicalMaterial:Pd,MeshStandardMaterial:Id,MeshPhongMaterial:Rd,MeshToonMaterial:Dd,MeshNormalMaterial:kd,MeshLambertMaterial:Bd,MeshDepthMaterial:wl,MeshDistanceMaterial:xl,MeshBasicMaterial:Qr,MeshMatcapMaterial:Od,LineDashedMaterial:Ld,LineBasicMaterial:Lc,Material:Ur}[e]}}class Uh{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Nh extends _s{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Fh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new uh(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],s=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}(e,r.buffer),o=Kn(r.type,s),a=new Hl(o,r.stride);return a.uuid=r.uuid,t[i]=a,a}const r=e.isInstancedBufferGeometry?new Nh:new _s,s=e.data.index;if(void 0!==s){const e=Kn(s.type,s.array);r.setIndex(new $r(e,1))}const o=e.data.attributes;for(const u in o){const t=o[u];let n;if(t.isInterleavedBufferAttribute){const r=i(e.data,t.data);n=new Wl(r,t.itemSize,t.offset,t.normalized)}else{const e=Kn(t.type,t.array);n=new(t.isInstancedBufferAttribute?Mc:$r)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),void 0!==t.updateRange&&(n.updateRange.offset=t.updateRange.offset,n.updateRange.count=t.updateRange.count),r.setAttribute(u,n)}const a=e.data.morphAttributes;if(a)for(const u in a){const t=a[u],n=[];for(let r=0,s=t.length;r<s;r++){const s=t[r];let o;if(s.isInterleavedBufferAttribute){const t=i(e.data,s.data);o=new Wl(t,s.itemSize,s.offset,s.normalized)}else{const e=Kn(s.type,s.array);o=new $r(e,s.itemSize,s.normalized)}void 0!==s.name&&(o.name=s.name),n.push(o)}r.morphAttributes[u]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,d=l.length;u!==d;++u){const e=l[u];r.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new wi;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Vi(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class jh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===this.path?Uh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new uh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){let s=null;try{s=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);r.parse(s,t)}),n,i)}async loadAsync(e,t){const n=""===this.path?Uh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new uh(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),s=JSON.parse(r),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,s),a=this.parseObject(e.object,i,o,s,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new Fu).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let r=0,s=e.length;r<s;r++){const t=(new Sc).fromJSON(e[r],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new Fh;for(let r=0,s=e.length;r<s;r++){let s;const o=e[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(o);break;default:o.type in Sd?s=Sd[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.userData&&(s.userData=o.userData),n[o.uuid]=s}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new Lh;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=nh.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function s(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Kn(e.type,e.data),width:e.width,height:e.height,complete:!0}:null}if(void 0!==e&&e.length>0){const n=new sh(t);r=new ph(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const n=e[t],r=n.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=s(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new xc(n.data,n.width,n.height)))}i[n.uuid]=new ui(e)}else{const e=s(n.url);i[n.uuid]=new ui(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"==typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:Kn(e.type,e.data),width:e.width,height:e.height,complete:!0}:null}if(void 0!==e&&e.length>0){i=new ph(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],i=await r(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new xc(i.data,i.width,i.height)))}n[i.uuid]=new ui(e)}else{const e=await r(i.url);n[i.uuid]=new ui(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=t[s.image],a=o?o.data:void 0;let l;Array.isArray(a)?(l=new qs,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new xc:new pi,a&&a.complete&&(l.needsUpdate=!0)),l.source=o,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,zh)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Gh),l.wrapT=n(s.wrap[1],Gh)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace?l.colorSpace=s.colorSpace:void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,Vh)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,Vh)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(e,t,n,i,r){let s;const o=e.metadata&&e.metadata.version<=4.5?Gt:void 0;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}let u,d;switch(e.type){case"Scene":s=new Vl,void 0!==e.background&&(Number.isInteger(e.background)?s.background=(new Vr).setHex(e.background,o):s.background=c(e.background)),void 0!==e.environment&&(s.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new Gl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new zl(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(s.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":s=new Hs(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new go(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new Dh(e.color,e.intensity);break;case"DirectionalLight":s=new Rh(e.color,e.intensity);break;case"PointLight":s=new Ih(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new kh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Eh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new vh(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new Oh).fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),d=l(e.material),s=new Ac(u,d),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),d=l(e.material),s=new Os(u,d);break;case"InstancedMesh":u=a(e.geometry),d=l(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;s=new Oc(u,d,t),s.instanceMatrix=new Mc(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new Mc(new Float32Array(i.array),i.itemSize));break;case"LOD":s=new dc;break;case"Line":s=new Gc(a(e.geometry),l(e.material));break;case"LineLoop":s=new Wc(a(e.geometry),l(e.material));break;case"LineSegments":s=new Qc(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new Zc(a(e.geometry),l(e.material));break;case"Sprite":s=new ac(l(e.material));break;case"Group":s=new Rl;break;case"Bone":s=new wc;break;default:s=new xr}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.up&&s.up.fromArray(e.up),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)s.add(this.parseObject(o[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];s.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance,n.hysteresis)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}}const zh={UVMapping:ie,CubeReflectionMapping:re,CubeRefractionMapping:se,EquirectangularReflectionMapping:oe,EquirectangularRefractionMapping:ae,CubeUVReflectionMapping:le},Gh={RepeatWrapping:ce,ClampToEdgeWrapping:ue,MirroredRepeatWrapping:de},Vh={NearestFilter:he,NearestMipmapNearestFilter:pe,NearestMipmapLinearFilter:me,LinearFilter:_e,LinearMipmapNearestFilter:ve,LinearMipmapLinearFilter:be};class Hh extends ah{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this;rh.get(e,"blob").then((n=>{if(void 0!==n)return r.manager.itemStart(e),void createImageBitmap(n,Object.assign(r.options,{colorSpaceConversion:"none"})).then((function(n){t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}));const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then((function(e){return e.blob()})).then((function(t){return rh.add(e,t,"blob"),createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}))}}let Qh;class Wh{static getContext(){return void 0===Qh&&(Qh=new(window.AudioContext||window.webkitAudioContext)),Qh}static setContext(e){Qh=e}}class qh extends ah{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new uh(this.manager);function o(t){i?i(t):console.error(t),r.manager.itemError(e)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){try{const n=e.slice(0);Wh.getContext().decodeAudioData(n,(function(e){t(e)}),o)}catch(e){o(e)}}),n,i)}}class Xh extends Oh{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const i=(new Vr).set(e),r=(new Vr).set(t),s=new wi(i.r,i.g,i.b),o=new wi(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}class Yh extends Oh{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=(new Vr).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const Kh=new Zi,Jh=new Zi,Zh=new Zi;class $h{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Hs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Hs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Zh.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,r=t.near*Math.tan(kn*t.fov*.5)/t.zoom;let s,o;Jh.elements[12]=-n,Kh.elements[12]=n,s=-r*t.aspect+i,o=r*t.aspect+i,Zh.elements[0]=2*t.near/(o-s),Zh.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(Zh),s=-r*t.aspect-i,o=r*t.aspect-i,Zh.elements[0]=2*t.near/(o-s),Zh.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(Zh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Jh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Kh)}}class ep{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=tp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=tp();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function tp(){return("undefined"==typeof performance?Date:performance).now()}const np=new wi,ip=new Ai,rp=new wi,sp=new wi;class op extends xr{constructor(){super(),this.type="AudioListener",this.context=Wh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ep}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(np,ip,rp),sp.set(0,0,-1).applyQuaternion(ip),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(np.x,e),t.positionY.linearRampToValueAtTime(np.y,e),t.positionZ.linearRampToValueAtTime(np.z,e),t.forwardX.linearRampToValueAtTime(sp.x,e),t.forwardY.linearRampToValueAtTime(sp.y,e),t.forwardZ.linearRampToValueAtTime(sp.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(np.x,np.y,np.z),t.setOrientation(sp.x,sp.y,sp.z,n.x,n.y,n.z)}}class ap extends xr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const lp=new wi,cp=new Ai,up=new wi,dp=new wi;class hp extends ap{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(lp,cp,up),dp.set(0,0,1).applyQuaternion(cp);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(lp.x,e),t.positionY.linearRampToValueAtTime(lp.y,e),t.positionZ.linearRampToValueAtTime(lp.z,e),t.orientationX.linearRampToValueAtTime(dp.x,e),t.orientationY.linearRampToValueAtTime(dp.y,e),t.orientationZ.linearRampToValueAtTime(dp.z,e)}else t.setPosition(lp.x,lp.y,lp.z),t.setOrientation(dp.x,dp.y,dp.z)}}class pp{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class fp{constructor(e,t,n){let i,r,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)n[r+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){o.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){Ai.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const s=this._workIndex*r;Ai.multiplyQuaternionsFlat(e,s,e,t,e,n),Ai.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){const s=1-i;for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]*s+e[n+o]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[n+s]*i}}}const mp="\\[\\]\\.:\\/",gp=new RegExp("["+mp+"]","g"),_p="[^"+mp+"]",vp="[^"+mp.replace("\\.","")+"]",yp=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",_p)+/(WCOD+)?/.source.replace("WCOD",vp)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_p)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_p)+"$"),bp=["material","materials","bones","map"];class Ap{constructor(e,t,n){this.path=t,this.parsedPath=n||Ap.parseTrackName(t),this.node=Ap.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Ap.Composite(e,t,n):new Ap(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(gp,"")}static parseTrackName(e){const t=yp.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==bp.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Ap.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ap.Composite=class{constructor(e,t,n){const i=n||Ap.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Ap.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ap.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ap.prototype.GetterByBindingType=[Ap.prototype._getValue_direct,Ap.prototype._getValue_array,Ap.prototype._getValue_arrayElement,Ap.prototype._getValue_toArray],Ap.prototype.SetterByBindingTypeAndVersioning=[[Ap.prototype._setValue_direct,Ap.prototype._setValue_direct_setNeedsUpdate,Ap.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ap.prototype._setValue_array,Ap.prototype._setValue_array_setNeedsUpdate,Ap.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ap.prototype._setValue_arrayElement,Ap.prototype._setValue_arrayElement_setNeedsUpdate,Ap.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ap.prototype._setValue_fromArray,Ap.prototype._setValue_fromArray_setNeedsUpdate,Ap.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class wp{constructor(){this.isAnimationObjectGroup=!0,this.uuid=On(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let o,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],d=u.uuid;let h=t[d];if(void 0===h){h=a++,t[d]=h,e.push(u);for(let e=0,t=s;e!==t;++e)r[e].push(new Ap(u,n[e],i[e]))}else if(h<l){o=e[h];const a=--l,c=e[a];t[c.uuid]=h,e[h]=c,t[d]=a,e[a]=u;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[a];let o=t[h];t[h]=s,void 0===o&&(o=new Ap(u,n[e],i[e])),t[a]=o}}else e[h]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=t[a];if(void 0!==l&&l>=r){const s=r++,c=e[s];t[c.uuid]=l,e[l]=c,t[a]=s,e[s]=o;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[l];t[l]=i,t[s]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=e.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<r){const o=--r,a=e[o],c=--s,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=o,e[o]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[o],r=t[c];t[l]=i,t[o]=r,t.pop()}}else{const r=--s,o=e[r];r>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,s.push(e),o.push(t),r.push(u);for(let d=c,h=a.length;d!==h;++d){const n=a[d];u[d]=new Ap(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];t[e[o]]=n,s[n]=a,s.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}class xp{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,s=r.length,o=new Array(s),a={endingStart:St,endingEnd:St};for(let l=0;l!==s;++l){const e=r[l].createInterpolant(null);o[l]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=At,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,s=n/i;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Pt)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulateAdditive(o);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulate(i,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const s=n===wt;if(0===e)return-1===r?i:s&&1==(1&r)?t-i:i;if(n===bt){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Mt,i.endingEnd=Mt):(i.endingStart=e?this.zeroSlopeAtStart?Mt:St:Tt,i.endingEnd=t?this.zeroSlopeAtEnd?Mt:St:Tt)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=t,o[1]=r+e,a[1]=n,this}}const Ep=new Float32Array(1);class Cp extends Pn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,o=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==r;++u){const e=i[u],r=e.name;let l=c[r];if(void 0!==l)++l.referenceCount,s[u]=l;else{if(l=s[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,r));continue}const i=t&&t._propertyBindings[u].binding.parsedPath;l=new fp(Ap.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,r),s[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0==--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[t];void 0===s&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Wd(new Float32Array(2),new Float32Array(2),1,Ep),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let s="string"==typeof e?nh.findByName(i,e):e;const o=null!==s?s.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:It),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new xp(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?nh.findByName(n,e):e,s=r?r.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==n;++l)t[l]._update(i,e,r,s);const o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const r in i){const e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Sp{constructor(e){this.value=e}clone(){return new Sp(void 0===this.value.clone?this.value:this.value.clone())}}let Mp=0;class Tp extends Pn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Mp++}),this.name="",this.usage=gn,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++)this.uniforms.push(t[n].clone());return this}clone(){return(new this.constructor).copy(this)}}class Ip extends Hl{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Pp{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class Rp{constructor(e,t,n=0,i=1/0){this.ray=new Ji(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new cr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return kp(e,this,n,t),n.sort(Dp),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)kp(e[i],this,n,t);return n.sort(Dp),n}}function Dp(e,t){return e.distance-t.distance}function kp(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)kp(i[e],t,n,!0)}}class Bp{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ln(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Op{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Lp=new Qn;class Up{constructor(e=new Qn(1/0,1/0),t=new Qn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Lp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Lp).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Np=new wi,Fp=new wi;class jp{constructor(e=new wi,t=new wi){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Np.subVectors(e,this.start),Fp.subVectors(this.end,this.start);const n=Fp.dot(Fp);let i=Fp.dot(Np)/n;return t&&(i=Ln(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const zp=new wi;class Gp extends xr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new _s,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,o=1,a=32;s<a;s++,o++){const e=s/a*Math.PI*2,t=o/a*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new ls(i,3));const r=new Lc({fog:!1,toneMapped:!1});this.cone=new Qc(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),zp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(zp),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Vp=new wi,Hp=new Zi,Qp=new Zi;class Wp extends Qc{constructor(e){const t=qp(e),n=new _s,i=[],r=[],s=new Vr(0,0,1),o=new Vr(0,1,0);for(let a=0;a<t.length;a++){const e=t[a];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new ls(i,3)),n.setAttribute("color",new ls(r,3)),super(n,new Lc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Qp.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<t.length;r++){const e=t[r];e.parent&&e.parent.isBone&&(Hp.multiplyMatrices(Qp,e.matrixWorld),Vp.setFromMatrixPosition(Hp),i.setXYZ(s,Vp.x,Vp.y,Vp.z),Hp.multiplyMatrices(Qp,e.parent.matrixWorld),Vp.setFromMatrixPosition(Hp),i.setXYZ(s+1,Vp.x,Vp.y,Vp.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function qp(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,qp(e.children[n]));return t}class Xp extends Os{constructor(e,t,n){super(new yd(t,4,2),new Qr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Yp=new wi,Kp=new Vr,Jp=new Vr;class Zp extends xr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new gd(t);i.rotateY(.5*Math.PI),this.material=new Qr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new $r(s,3)),this.add(new Os(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Kp.copy(this.light.color),Jp.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?Kp:Jp;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Yp.setFromMatrixPosition(this.light.matrixWorld).negate())}}class $p extends Qc{constructor(e=10,t=10,n=4473924,i=8947848){n=new Vr(n),i=new Vr(i);const r=t/2,s=e/t,o=e/2,a=[],l=[];for(let u=0,d=0,h=-o;u<=t;u++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=u===r?n:i;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const c=new _s;c.setAttribute("position",new ls(a,3)),c.setAttribute("color",new ls(l,3)),super(c,new Lc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class ef extends Qc{constructor(e=10,t=16,n=8,i=64,r=4473924,s=8947848){r=new Vr(r),s=new Vr(s);const o=[],a=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),i=Math.sin(n)*e,l=Math.cos(n)*e;o.push(0,0,0),o.push(i,0,l);const u=1&c?r:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const t=1&c?r:s,l=e-e/n*c;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l;o.push(r,0,s),a.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l,o.push(r,0,s),a.push(t.r,t.g,t.b)}}const l=new _s;l.setAttribute("position",new ls(o,3)),l.setAttribute("color",new ls(a,3)),super(l,new Lc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const tf=new wi,nf=new wi,rf=new wi;class sf extends xr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new _s;i.setAttribute("position",new ls([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Lc({fog:!1,toneMapped:!1});this.lightPlane=new Gc(i,r),this.add(this.lightPlane),i=new _s,i.setAttribute("position",new ls([0,0,0,0,0,1],3)),this.targetLine=new Gc(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),tf.setFromMatrixPosition(this.light.matrixWorld),nf.setFromMatrixPosition(this.light.target.matrixWorld),rf.subVectors(nf,tf),this.lightPlane.lookAt(nf),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(nf),this.targetLine.scale.z=rf.length()}}const of=new wi,af=new Vs;class lf extends Qc{constructor(e){const t=new _s,n=new Lc({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function o(e,t){a(e),a(t)}function a(e){i.push(0,0,0),r.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),t.setAttribute("position",new ls(i,3)),t.setAttribute("color",new ls(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new Vr(16755200),c=new Vr(16711680),u=new Vr(43775),d=new Vr(16777215),h=new Vr(3355443);this.setColors(l,c,u,d,h)}setColors(e,t,n,i,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;af.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),cf("c",t,e,af,0,0,-1),cf("t",t,e,af,0,0,1),cf("n1",t,e,af,-1,-1,-1),cf("n2",t,e,af,1,-1,-1),cf("n3",t,e,af,-1,1,-1),cf("n4",t,e,af,1,1,-1),cf("f1",t,e,af,-1,-1,1),cf("f2",t,e,af,1,-1,1),cf("f3",t,e,af,-1,1,1),cf("f4",t,e,af,1,1,1),cf("u1",t,e,af,.7,1.1,-1),cf("u2",t,e,af,-.7,1.1,-1),cf("u3",t,e,af,0,2,-1),cf("cf1",t,e,af,-1,0,1),cf("cf2",t,e,af,1,0,1),cf("cf3",t,e,af,0,-1,1),cf("cf4",t,e,af,0,1,1),cf("cn1",t,e,af,-1,0,-1),cf("cn2",t,e,af,1,0,-1),cf("cn3",t,e,af,0,-1,-1),cf("cn4",t,e,af,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function cf(e,t,n,i,r,s,o){of.set(r,s,o).unproject(i);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],of.x,of.y,of.z)}}const uf=new Ci;class df extends Qc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new _s;r.setIndex(new $r(n,1)),r.setAttribute("position",new $r(i,3)),super(r,new Lc({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&uf.setFromObject(this.object),uf.isEmpty())return;const t=uf.min,n=uf.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hf extends Qc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new _s;i.setIndex(new $r(n,1)),i.setAttribute("position",new ls([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Lc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class pf extends Gc{constructor(e,t=1,n=16776960){const i=n,r=new _s;r.setAttribute("position",new ls([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Lc({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new _s;s.setAttribute("position",new ls([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Os(s,new Qr({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const ff=new wi;let mf,gf;class _f extends xr{constructor(e=new wi(0,0,1),t=new wi(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===mf&&(mf=new _s,mf.setAttribute("position",new ls([0,0,0,0,1,0],3)),gf=new Pu(0,.5,1,5,1),gf.translate(0,-.5,0)),this.position.copy(t),this.line=new Gc(mf,new Lc({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Os(gf,new Qr({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{ff.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(ff,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class vf extends Qc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new _s;n.setAttribute("position",new ls(t,3)),n.setAttribute("color",new ls([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new Lc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new Vr,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yf{constructor(){this.type="ShapePath",this.color=new Vr,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Su,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=t[r],o=t[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],a=-a,o=t[r],l=-l),e.y<n.y||e.y>o.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(o.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=o.x)return!0}}return i}const n=ud.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,o;const a=[];if(1===i.length)return s=i[0],o=new Fu,o.curves=s.curves,a.push(o),a;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],u=[];let d,h,p=[],f=0;u[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)s=i[m],d=s.getPoints(),r=n(d),r=e?!r:r,r?(!l&&u[f]&&f++,u[f]={s:new Fu,p:d},u[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:d[0]});if(!u[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new Fu;r.curves=i.curves,t.push(r)}return t}(i);if(u.length>1){let e=!1,n=0;for(let t=0,i=u.length;t<i;t++)c[t]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<u.length;r++)t(o.p,u[r].p)&&(i!==r&&n++,a?(a=!1,c[r].push(o)):e=!0);a&&c[i].push(o)}}n>0&&!1===e&&(p=c)}for(let m=0,g=u.length;m<g;m++){o=u[m].s,a.push(o),h=p[m];for(let e=0,t=h.length;e<t;e++)o.holes.push(h[e].h)}return a}}class bf extends Us{constructor(e,t,n,i,r,s){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,i,r,s)}}class Af extends Tu{constructor(e,t,n,i){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,i)}}class wf extends Iu{constructor(e,t,n,i){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,i)}}class xf extends Ru{constructor(e,t,n,i,r,s,o){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,i,r,s,o)}}class Ef extends Pu{constructor(e,t,n,i,r,s,o,a){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,i,r,s,o,a)}}class Cf extends ku{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class Sf extends pd{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class Mf extends md{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class Tf extends Mu{constructor(e,t,n,i){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,i)}}class If extends gd{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class Pf extends ro{constructor(e,t,n,i){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,i)}}class Rf extends Du{constructor(e,t,n,i){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,i)}}class Df extends _d{constructor(e,t,n,i,r,s){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,i,r,s)}}class kf extends vd{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class Bf extends yd{constructor(e,t,n,i,r,s,o){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,i,r,s,o)}}class Of extends bd{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class Lf extends Ad{constructor(e,t,n,i,r){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,i,r)}}class Uf extends wd{constructor(e,t,n,i,r,s){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,i,r,s)}}class Nf extends xd{constructor(e,t,n,i,r){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,i,r)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},553:function(e,t,n){n.d(t,{_:function(){return s}});var i=n(988);const r=new WeakMap;class s extends i.aNw{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const s=new i.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(e=>{this.parse(e,t,r)}),n,r)}parse(e,t,n){this.decodeDracoFile(e,t,null,null,i.KI_).catch(n)}decodeDracoFile(e,t,n,r,s=i.GUF){const o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:s};return this.decodeGeometry(e,o).then(t)}decodeGeometry(e,t){const n=JSON.stringify(t);if(r.has(e)){const t=r.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then((n=>(i=n,new Promise(((n,r)=>{i._callbacks[s]={resolve:n,reject:r},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{i&&s&&this._releaseTask(i,s)})),r.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new i.u9r;e.index&&t.setIndex(new i.TlE(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],s=r.name,o=r.array,a=r.itemSize,l=new i.TlE(o,a);"color"===s&&(this._assignVertexColorSpace(l,r.vertexColorSpace),l.normalized=o instanceof Float32Array==0),t.setAttribute(s,l)}return t}_assignVertexColorSpace(e,t){if(t!==i.KI_)return;const n=new i.Ilk;for(let i=0,r=e.count;i<r;i++)n.fromBufferAttribute(e,i).convertSRGBToLinear(),e.setXYZ(i,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new i.hH6(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{n.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=o,r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}const o="\nfunction DRACOWorker() {\n\n\tlet decoderConfig;\n\tlet decoderPending;\n\n\tonmessage = function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tdecoderConfig = message.decoderConfig;\n\t\t\t\tdecoderPending = new Promise( function ( resolve/*, reject*/ ) {\n\n\t\t\t\t\tdecoderConfig.onModuleLoaded = function ( draco ) {\n\n\t\t\t\t\t\t// Module is Promise-like. Wrap before resolving to avoid loop.\n\t\t\t\t\t\tresolve( { draco: draco } );\n\n\t\t\t\t\t};\n\n\t\t\t\t\tDracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t\tcase 'decode':\n\t\t\t\tconst buffer = message.buffer;\n\t\t\t\tconst taskConfig = message.taskConfig;\n\t\t\t\tdecoderPending.then( ( module ) => {\n\n\t\t\t\t\tconst draco = module.draco;\n\t\t\t\t\tconst decoder = new draco.Decoder();\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );\n\n\t\t\t\t\t\tconst buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );\n\n\t\t\t\t\t\tif ( geometry.index ) buffers.push( geometry.index.array.buffer );\n\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, geometry }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t} finally {\n\n\t\t\t\t\t\tdraco.destroy( decoder );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction decodeGeometry( draco, decoder, array, taskConfig ) {\n\n\t\tconst attributeIDs = taskConfig.attributeIDs;\n\t\tconst attributeTypes = taskConfig.attributeTypes;\n\n\t\tlet dracoGeometry;\n\t\tlet decodingStatus;\n\n\t\tconst geometryType = decoder.GetEncodedGeometryType( array );\n\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tdracoGeometry = new draco.Mesh();\n\t\t\tdecodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );\n\n\t\t} else if ( geometryType === draco.POINT_CLOUD ) {\n\n\t\t\tdracoGeometry = new draco.PointCloud();\n\t\t\tdecodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );\n\n\t\t}\n\n\t\tif ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );\n\n\t\t}\n\n\t\tconst geometry = { index: null, attributes: [] };\n\n\t\t// Gather all vertex attributes.\n\t\tfor ( const attributeName in attributeIDs ) {\n\n\t\t\tconst attributeType = self[ attributeTypes[ attributeName ] ];\n\n\t\t\tlet attribute;\n\t\t\tlet attributeID;\n\n\t\t\t// A Draco file may be created with default vertex attributes, whose attribute IDs\n\t\t\t// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\n\t\t\t// a Draco file may contain a custom set of attributes, identified by known unique\n\t\t\t// IDs. glTF files always do the latter, and .drc files typically do the former.\n\t\t\tif ( taskConfig.useUniqueIDs ) {\n\n\t\t\t\tattributeID = attributeIDs[ attributeName ];\n\t\t\t\tattribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );\n\n\t\t\t} else {\n\n\t\t\t\tattributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );\n\n\t\t\t\tif ( attributeID === - 1 ) continue;\n\n\t\t\t\tattribute = decoder.GetAttribute( dracoGeometry, attributeID );\n\n\t\t\t}\n\n\t\t\tconst attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );\n\n\t\t\tif ( attributeName === 'color' ) {\n\n\t\t\t\tattributeResult.vertexColorSpace = taskConfig.vertexColorSpace;\n\n\t\t\t}\n\n\t\t\tgeometry.attributes.push( attributeResult );\n\n\t\t}\n\n\t\t// Add index.\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tgeometry.index = decodeIndex( draco, decoder, dracoGeometry );\n\n\t\t}\n\n\t\tdraco.destroy( dracoGeometry );\n\n\t\treturn geometry;\n\n\t}\n\n\tfunction decodeIndex( draco, decoder, dracoGeometry ) {\n\n\t\tconst numFaces = dracoGeometry.num_faces();\n\t\tconst numIndices = numFaces * 3;\n\t\tconst byteLength = numIndices * 4;\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );\n\t\tconst index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn { array: index, itemSize: 1 };\n\n\t}\n\n\tfunction decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {\n\n\t\tconst numComponents = attribute.num_components();\n\t\tconst numPoints = dracoGeometry.num_points();\n\t\tconst numValues = numPoints * numComponents;\n\t\tconst byteLength = numValues * attributeType.BYTES_PER_ELEMENT;\n\t\tconst dataType = getDracoDataType( draco, attributeType );\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );\n\t\tconst array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn {\n\t\t\tname: attributeName,\n\t\t\tarray: array,\n\t\t\titemSize: numComponents\n\t\t};\n\n\t}\n\n\tfunction getDracoDataType( draco, attributeType ) {\n\n\t\tswitch ( attributeType ) {\n\n\t\t\tcase Float32Array: return draco.DT_FLOAT32;\n\t\t\tcase Int8Array: return draco.DT_INT8;\n\t\t\tcase Int16Array: return draco.DT_INT16;\n\t\t\tcase Int32Array: return draco.DT_INT32;\n\t\t\tcase Uint8Array: return draco.DT_UINT8;\n\t\t\tcase Uint16Array: return draco.DT_UINT16;\n\t\t\tcase Uint32Array: return draco.DT_UINT32;\n\n\t\t}\n\n\t}\n\n}\n"}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(e){var t=__webpackgi_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpackgi_module_cache__[e]={id:e,exports:{}};return __webpackgi_modules__[e].call(n.exports,n,n.exports,__webpackgi_require__),n.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpackgi_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},__webpackgi_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);__webpackgi_require__.r(n);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var r=2&t&&e;"object"==typeof r&&!~leafPrototypes.indexOf(r);r=getProto(r))Object.getOwnPropertyNames(r).forEach((function(t){i[t]=function(){return e[t]}}));return i.default=function(){return e},__webpackgi_require__.d(n,i),n},__webpackgi_require__.d=function(e,t){for(var n in t)__webpackgi_require__.o(t,n)&&!__webpackgi_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(e){return Promise.all(Object.keys(__webpackgi_require__.f).reduce((function(t,n){return __webpackgi_require__.f[n](e,t),t}),[]))},__webpackgi_require__.u=function(e){return e+".mjs"},__webpackgi_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(e,t,n,i){if(inProgress[e])inProgress[e].push(t);else{var r,s;if(void 0!==n)for(var o=document.getElementsByTagName("script"),a=0;a<o.length;a++){var l=o[a];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==dataWebpackPrefix+n){r=l;break}}r||(s=!0,(r=document.createElement("script")).type="module",r.charset="utf-8",r.timeout=120,__webpackgi_require__.nc&&r.setAttribute("nonce",__webpackgi_require__.nc),r.setAttribute("data-webpack",dataWebpackPrefix+n),r.src=e),inProgress[e]=[t];var c=function(t,n){r.onerror=r.onload=null,clearTimeout(u);var i=inProgress[e];if(delete inProgress[e],r.parentNode&&r.parentNode.removeChild(r),i&&i.forEach((function(e){return e(n)})),t)return t(n)},u=setTimeout(c.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=c.bind(null,r.onerror),r.onload=c.bind(null,r.onload),s&&document.head.appendChild(r)}},__webpackgi_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;if(e="file:///Users/vesnabozic/Documents/vue-ring/vue2/node_modules/webgi/dist/examples/runtime/bundle.m.js",!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=e+"../../"}(),function(){var e={698:0};__webpackgi_require__.f.j=function(t,n){var i=__webpackgi_require__.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((function(n,r){i=e[t]=[n,r]}));n.push(i[2]=r);var s=__webpackgi_require__.p+__webpackgi_require__.u(t),o=new Error;__webpackgi_require__.l(s,(function(n){if(__webpackgi_require__.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",o.name="ChunkLoadError",o.type=r,o.request=s,i[1](o)}}),"chunk-"+t,t)}};var t=function(t,n){var i,r,s=n[0],o=n[1],a=n[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(i in o)__webpackgi_require__.o(o,i)&&(__webpackgi_require__.m[i]=o[i]);a&&a(__webpackgi_require__)}for(t&&t(n);l<s.length;l++)r=s[l],__webpackgi_require__.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunkwebgi=self.webpackChunkwebgi||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};!function(){var e;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return xc},LY2:function(){return n.LY2},GYo:function(){return HT},GPz:function(){return _C},HRj:function(){return Lt},li4:function(){return rC},FO5:function(){return dC},Nlh:function(){return oC},Mp4:function(){return lt},QvI:function(){return _t},PrA:function(){return SU},JHp:function(){return Co},bGH:function(){return n.bGH},NDo:function(){return n.NDo},gSk:function(){return n.gSk},WMw:function(){return n.WMw},OTo:function(){return n.OTo},T6w:function(){return n.T6w},Se2:function(){return n.Se2},cum:function(){return n.cum},Mig:function(){return n.Mig},B$7:function(){return li},i_9:function(){return n.i_9},bBp:function(){return n.bBp},m7l:function(){return n.m7l},sYA:function(){return n.sYA},Xcj:function(){return n.Xcj},mzJ:function(){return n.mzJ},ZZA:function(){return n.ZZA},$Ph:function(){return Sl},T__:function(){return n.T__},HkE:function(){return n.HkE},tGC:function(){return n.tGC},g1S:function(){return lb},I$C:function(){return ub},QIH:function(){return Ds},_JE:function(){return bv},SwW:function(){return Tv},ksm:function(){return Ls},jl_:function(){return Nr},b7R:function(){return es},BDV:function(){return Pr},Ea_:function(){return Gr},qff:function(){return Nr},tmC:function(){return Br},BON:function(){return Ms},P40:function(){return Kr},wLL:function(){return As},iHO:function(){return Wr},BbS:function(){return n.BbS},kqm:function(){return n.kqm},Hmr:function(){return n.Hmr},SJI:function(){return n.SJI},mTL:function(){return n.mTL},y8_:function(){return n.y8_},_Li:function(){return n._Li},w7U:function(){return No},g56:function(){return j_},bj3:function(){return fe},z81:function(){return n.z81},_MY:function(){return n._MY},L7J:function(){return RP},yEv:function(){return ny},dFZ:function(){return yo},N$j:function(){return n.N$j},_YM:function(){return n._YM},TUj:function(){return n.TUj},ZzF:function(){return n.ZzF},qzb:function(){return p},GQ:function(){return n.GQ},nvb:function(){return n.nvb},DvJ:function(){return n.DvJ},fQA:function(){return n.fQA},cPz:function(){return oa},TlE:function(){return n.TlE},u9r:function(){return n.u9r},s4_:function(){return n.s4_},T95:function(){return n.T95},F5w:function(){return aS},NlP:function(){return VT},$8Z:function(){return sS},YYN:function(){return HE},CtF:function(){return n.CtF},V1s:function(){return n.V1s},jOv:function(){return nt},Rki:function(){return n.Rki},pzV:function(){return oL},itZ:function(){return jd},MMq:function(){return DI},qKx:function(){return zd},Hmi:function(){return PO},X4S:function(){return yC},vlJ:function(){return cU},nPO:function(){return wC},zcQ:function(){return Lc},GH1:function(){return Nc},ROQ:function(){return n.ROQ},YN5:function(){return n.YN5},BVQ:function(){return n.BVQ},YT8:function(){return n.YT8},_DE:function(){return ro},YGz:function(){return n.YGz},trn:function(){return n.trn},zf8:function(){return n.zf8},uWy:function(){return n.uWy},wYQ:function(){return Wh},SUY:function(){return n.SUY},Ilk:function(){return n.Ilk},R2R:function(){return n.R2R},epp:function(){return n.epp},xmJ:function(){return Qs},GD$:function(){return Ur},Z_g:function(){return n.Z_g},EB7:function(){return n.EB7},DqL:function(){return n.DqL},_3:function(){return n._3},b_z:function(){return n.b_z},OCn:function(){return SC},N_j:function(){return bN},hNv:function(){return rv},_am:function(){return n._am},kB7:function(){return zl},fY$:function(){return n.fY$},vxC:function(){return n.vxC},BtG:function(){return n.BtG},cBK:function(){return n.cBK},g8_:function(){return n.g8_},AXT:function(){return n.AXT},yj7:function(){return n.yj7},dYG:function(){return n.dYG},tm_:function(){return n.tm_},S2y:function(){return n.S2y},B02:function(){return n.B02},PeU:function(){return n.PeU},Hyl:function(){return n.Hyl},Wqd:function(){return n.Wqd},c0Q:function(){return TI},re0:function(){return II},Xaj:function(){return n.Xaj},DUb:function(){return Ha},dZ3:function(){return n.dZ3},m_w:function(){return n.m_w},fHI:function(){return n.fHI},LBq:function(){return n.LBq},Qww:function(){return ii.Q},CGV:function(){return t.Damper},JUT:function(){return n.JUT},p3g:function(){return n.p3g},IEO:function(){return n.IEO},yxD:function(){return n.yxD},CUS:function(){return iy},A5E:function(){return n.A5E},zqG:function(){return bp},PfX:function(){return ls},Q1o:function(){return $r},jfJ:function(){return n.jfJ},T_J:function(){return n.T_J},tEQ:function(){return n.tEQ},gb4:function(){return Ir},qkB:function(){return n.qkB},cvk:function(){return Eo},HWo:function(){return Ro},brP:function(){return n.brP},$YQ:function(){return n.$YQ},X8d:function(){return ZT},Zdt:function(){return $T},yNB:function(){return Kl},h7x:function(){return Bc},Ox3:function(){return n.Ox3},qtn:function(){return si},cBI:function(){return n.cBI},cU9:function(){return n.cU9},ntt:function(){return n.ntt},DT1:function(){return n.DT1},Kgo:function(){return n.Kgo},ehD:function(){return n.ehD},fhJ:function(){return Us},y1s:function(){return Ns},fSK:function(){return n.fSK},Vdb:function(){return n.Vdb},l8J:function(){return n.l8J},dj0:function(){return n.dj0},QM0:function(){return n.QM0},n94:function(){return ab},OIS:function(){return H_},q8b:function(){return kd},TOt:function(){return n.TOt},xaN:function(){return h},Ny0:function(){return n.Ny0},NeD:function(){return FC},Zof:function(){return cs},N1Y:function(){return cb},itK:function(){return Fo},F1y:function(){return n.F1y},eD:function(){return n.eD},jwo:function(){return n.jwo},dSO:function(){return n.dSO},Bf4:function(){return n.Bf4},USm:function(){return n.USm},pBf:function(){return n.pBf},eBg:function(){return UL},$Vf:function(){return n.$Vf},O7d:function(){return n.O7d},ksq:function(){return nm},hFL:function(){return bC},gXf:function(){return B_},hH6:function(){return n.hH6},izP:function(){return PI},kpi:function(){return Yo},DwZ:function(){return sI},kN3:function(){return oI},e62:function(){return n.e62},a$l:function(){return n.a$l},OM3:function(){return n.OM3},VzW:function(){return n.VzW},ybr:function(){return n.ybr},yo9:function(){return n.yo9},Dzq:function(){return Rl},zCA:function(){return Dl},$Bt:function(){return Io},Wzm:function(){return n.Wzm},Wl3:function(){return n.Wl3},iWj:function(){return n.iWj},DNz:function(){return Ah},m1M:function(){return At},ylh:function(){return n.ylh},v9Y:function(){return n.v9Y},LSk:function(){return n.LSk},LHE:function(){return Ya},KE0:function(){return uE},KCF:function(){return cE},a4n:function(){return Uy},NKC:function(){return Mh},jrv:function(){return Ih},zIH:function(){return Ln},Hfk:function(){return Jn},png:function(){return Yn},tAj:function(){return Kn},Eb_:function(){return Zn},SJj:function(){return Eh},cF0:function(){return _e},BT2:function(){return ev},_8p:function(){return By},V5Z:function(){return Oh},s5b:function(){return Lh},BHZ:function(){return jo},hkn:function(){return ft},GFY:function(){return yt},hZr:function(){return SP},Zen:function(){return n.Zen},w$m:function(){return n.w$m},Jjb:function(){return n.Jjb},ksN:function(){return n.ksN},j4z:function(){return n.j4z},OAl:function(){return n.OAl},VLJ:function(){return n.VLJ},C73:function(){return G_},ZAu:function(){return n.ZAu},ibP:function(){return zr},lth:function(){return lh},_fI:function(){return Ur},hUN:function(){return Ul},cLu:function(){return n.cLu},vmT:function(){return n.vmT},Qpg:function(){return n.Qpg},So8:function(){return n.So8},eOv:function(){return eL},Wjw:function(){return n.Wjw},cJO:function(){return n.cJO},QRU:function(){return n.QRU},S3k:function(){return n.S3k},OPJ:function(){return vC},PpQ:function(){return n.PpQ},q_9:function(){return Nt},ZRs:function(){return n.ZRs},oqc:function(){return n.oqc},T_x:function(){return kr},lb7:function(){return n.lb7},L5s:function(){return n.L5s},$TI:function(){return n.$TI},SPe:function(){return n.SPe},aVm:function(){return n.aVm},j87:function(){return n.j87},RNb:function(){return n.RNb},Kz5:function(){return n.Kz5},LYt:function(){return iv},vpT:function(){return n.vpT},kB5:function(){return n.kB5},_C8:function(){return n._C8},Syv:function(){return n.Syv},NMF:function(){return n.NMF},pIN:function(){return n.pIN},eMJ:function(){return n.eMJ},rN7:function(){return _p},iUp:function(){return vp},GFd:function(){return ty},x5V:function(){return n.x5V},tUh:function(){return n.tUh},z8B:function(){return n.z8B},vcl:function(){return ah},GZb:function(){return n.GZb},p7y:function(){return n.p7y},e6l:function(){return Gh},S9g:function(){return n.S9g},D67:function(){return n.D67},Zr5:function(){return n.Zr5},M$G:function(){return n.M$G},vCF:function(){return n.vCF},yt0:function(){return n.yt0},uXU:function(){return n.uXU},_kC:function(){return n._kC},lk7:function(){return n.lk7},USc:function(){return tL},x12:function(){return n.x12},w_R:function(){return Zv},Zzh:function(){return n.Zzh},nls:function(){return n.nls},g_z:function(){return n.g_z},U7:function(){return n.U7},FT0:function(){return n.FT0},L1_:function(){return Jv},blk:function(){return n.blk},YRm:function(){return ta},ejS:function(){return n.ejS},wUb:function(){return Kv},zOz:function(){return $o},rnI:function(){return n.rnI},wem:function(){return n.wem},lfu:function(){return n.lfu},FDw:function(){return n.FDw},lRj:function(){return n.lRj},D1R:function(){return n.D1R},qyh:function(){return n.qyh},GUF:function(){return n.GUF},EoG:function(){return n.EoG},aNw:function(){return n.aNw},Zp0:function(){return n.Zp0},lLk:function(){return n.lLk},NHT:function(){return Sc},jAl:function(){return n.jAl},uEv:function(){return n.uEv},YKA:function(){return n.YKA},cRx:function(){return n.cRx},Y8D:function(){return n.Y8D},RsA:function(){return n.RsA},Y0m:function(){return Ap},F5T:function(){return n.F5T},EDU:function(){return om},z$Q:function(){return I_},KA8:function(){return at},ZqF:function(){return Go},XUj:function(){return D_},Me$:function(){return k_},u7G:function(){return n.u7G},PEk:function(){return Ut},BG4:function(){return sm},M8C:function(){return n.M8C},Vkp:function(){return n.Vkp},yGw:function(){return n.yGw},Sm8:function(){return n.Sm8},Kj0:function(){return n.Kj0},vBJ:function(){return n.vBJ},QfV:function(){return Dt},lRF:function(){return n.lRF},Lun:function(){return n.Lun},YBo:function(){return n.YBo},kaV:function(){return n.kaV},RSm:function(){return n.RSm},NDk:function(){return MI},xoR:function(){return n.xoR},EJi:function(){return n.EJi},Wid:function(){return n.Wid},iuj:function(){return Pt},IKL:function(){return n.IKL},r_:function(){return n.r_},OoA:function(){return n.OoA},qhX:function(){return n.qhX},CRe:function(){return ch},qPT:function(){return so},M5h:function(){return n.M5h},Ns1:function(){return n.Ns1},TyD:function(){return n.TyD},vZf:function(){return n.vZf},HTd:function(){return n.HTd},aH4:function(){return n.aH4},YLQ:function(){return n.YLQ},xoQ:function(){return n.xoQ},BVF:function(){return n.BVF},MyG:function(){return n.MyG},jFi:function(){return n.jFi},aCh:function(){return n.aCh},uL9:function(){return n.uL9},TNj:function(){return fh},IFH:function(){return n.IFH},bdR:function(){return n.bdR},RPs:function(){return al},kM_:function(){return Gl},O78:function(){return n.O78},M6v:function(){return n.M6v},RvT:function(){return n.RvT},dUE:function(){return n.dUE},oe_:function(){return Op},BuN:function(){return Lp},Tme:function(){return n.Tme},N9P:function(){return Ft},tfP:function(){return YL},Gql:function(){return n.Gql},$XY:function(){return Fn},O9d:function(){return Ko},zEO:function(){return zt},qfx:function(){return RC},PA7:function(){return n.PA7},REq:function(){return n.REq},pQR:function(){return n.pQR},ghN:function(){return n.ghN},Hy8:function(){return n.Hy8},Wpd:function(){return n.Wpd},LgZ:function(){return n.LgZ},iWC:function(){return n.iWC},mqn:function(){return lU},SKe:function(){return et},iKG:function(){return n.iKG},rCq:function(){return $E},_iA:function(){return n._iA},ntZ:function(){return n.ntZ},anP:function(){return n.anP},X2e:function(){return BE},oxT:function(){return hh},FCo:function(){return BC},y$t:function(){return n.y$t},cPb:function(){return n.cPb},lmx:function(){return za},JOQ:function(){return n.JOQ},BKK:function(){return n.BKK},_12:function(){return n._12},tJx:function(){return n.tJx},mjX:function(){return zo},cek:function(){return n.cek},qD0:function(){return ai},xG9:function(){return n.xG9},eqi:function(){return t.PointerDragHelper},wI8:function(){return fI},Sgv:function(){return mI},woe:function(){return n.woe},UY4:function(){return n.UY4},aq0:function(){return n.aq0},ujx:function(){return n.ujx},Uol:function(){return n.Uol},JiH:function(){return jC},VYz:function(){return n.VYz},B2H:function(){return Uo},_Pm:function(){return Ho},EsW:function(){return To},iUV:function(){return n.iUV},tf:function(){return n.tf},ZQ6:function(){return n.ZQ6},mXe:function(){return n.mXe},_fP:function(){return n._fP},iLg:function(){return n.iLg},zbs:function(){return n.zbs},ZTh:function(){return n.ZTh},HdW:function(){return n.HdW},UZH:function(){return n.UZH},mSO:function(){return n.mSO},wk1:function(){return n.wk1},E2K:function(){return n.E2K},FUD:function(){return n.FUD},pKu:function(){return n.pKu},GG6:function(){return n.GG6},Gih:function(){return n.Gih},iiP:function(){return n.iiP},SvJ:function(){return n.SvJ},ptH:function(){return n.ptH},jZA:function(){return n.jZA},y2t:function(){return n.y2t},gi4:function(){return n.gi4},Djp:function(){return n.Djp},BG$:function(){return n.BG$},NYV:function(){return n.NYV},xJs:function(){return n.xJs},bsb:function(){return n.bsb},ekQ:function(){return n.ekQ},CaW:function(){return n.CaW},eaV:function(){return n.eaV},BFQ:function(){return n.BFQ},v3W:function(){return n.v3W},ILR:function(){return n.ILR},G_r:function(){return n.G_r},N3F:function(){return D},fto:function(){return n.fto},l0P:function(){return n.l0P},vCx:function(){return n.vCx},_AM:function(){return n._AM},wuA:function(){return n.wuA},av9:function(){return n.av9},CtA:function(){return n.CtA},fpq:function(){return PP},BvQ:function(){return _l},FZJ:function(){return bl},FIo:function(){return n.FIo},zHn:function(){return n.zHn},iMs:function(){return n.iMs},T_f:function(){return n.T_f},hEm:function(){return n.hEm},D9w:function(){return n.D9w},sHH:function(){return N_},CdI:function(){return n.CdI},rkc:function(){return sL},rpg:function(){return n.rpg},ce8:function(){return n.ce8},rOj:function(){return n.rOj},P6m:function(){return J_},JA6:function(){return K_},V4E:function(){return n.V4E},o8S:function(){return n.o8S},flB:function(){return rt},lGU:function(){return n.lGU},vuL:function(){return n.vuL},KI_:function(){return n.KI_},iLN:function(){return fo},X6w:function(){return Rh},rz_:function(){return Dh},jsw:function(){return jl},srG:function(){return rl},i6Z:function(){return El},vfv:function(){return $_},xsS:function(){return n.xsS},or:function(){return nL},EQj:function(){return Zd},Rnn:function(){return kI},TyN:function(){return LI},ov0:function(){return sa},WdD:function(){return n.WdD},Vj0:function(){return n.Vj0},jyz:function(){return n.jyz},mTM:function(){return ct},Mn1:function(){return ut},Hlq:function(){return ht},Fi7:function(){return L_},Tn7:function(){return n.Tn7},bnF:function(){return n.bnF},HW6:function(){return n.HW6},oa8:function(){return n.oa8},T_1:function(){return n.T_1},zHJ:function(){return NC},iDF:function(){return n.iDF},iAb:function(){return n.iAb},d4E:function(){return Iv},lBg:function(){return KO},JeJ:function(){return Pv},FKY:function(){return t.SimpleEventDispatcher},zlZ:function(){return ry},vkg:function(){return Gt},brh:function(){return sy},kZK:function(){return XC},puG:function(){return JO},VJK:function(){return EI},OdW:function(){return n.OdW},_YX:function(){return n._YX},TUv:function(){return n.TUv},Hw6:function(){return n.Hw6},aLr:function(){return n.aLr},Aip:function(){return n.Aip},xo$:function(){return n.xo$},bIn:function(){return uU},$V:function(){return n.$V},lDi:function(){return n.lDi},gti:function(){return n.gti},PMe:function(){return n.PMe},iwP:function(){return oi},FvO:function(){return n.FvO},jyi:function(){return n.jyi},xeV:function(){return n.xeV},k74:function(){return n.k74},RlZ:function(){return n.RlZ},KhW:function(){return n.KhW},HgB:function(){return n.HgB},W2J:function(){return n.W2J},JWc:function(){return n.JWc},u37:function(){return n.u37},Z6B:function(){return n.Z6B},QZ1:function(){return n.QZ1},Ir4:function(){return n.Ir4},NwF:function(){return n.NwF},Wbm:function(){return n.Wbm},N4l:function(){return n.N4l},Jxm:function(){return P_},ej9:function(){return R_},QmN:function(){return n.QmN},Y4W:function(){return t.TYPED_ARRAYS},IOt:function(){return n.IOt},NOD:function(){return yh},L5g:function(){return n.L5g},H$k:function(){return n.H$k},cuP:function(){return QC},xEZ:function(){return n.xEZ},dpR:function(){return n.dpR},wOD:function(){return ko},KNb:function(){return Os},IiN:function(){return eo},Cne:function(){return n.Cne},XvJ:function(){return n.XvJ},XZw:function(){return n.XZw},FE5:function(){return n.FE5},lUF:function(){return wI},Mck:function(){return fP},lVp:function(){return Fa},Lpo:function(){return TP},CJI:function(){return n.CJI},z$h:function(){return n.z$h},UlW:function(){return n.UlW},WwZ:function(){return n.WwZ},zG7:function(){return Nh},Lcc:function(){return n.Lcc},WXh:function(){return n.WXh},Vjr:function(){return OC},LuM:function(){return YO},LP5:function(){return zO},ub3:function(){return n.ub3},OV:function(){return lP},G_n:function(){return cP},xfE:function(){return n.xfE},qlB:function(){return n.qlB},lCJ:function(){return n.lCJ},WTc:function(){return n.WTc},rAo:function(){return n.rAo},LZj:function(){return Zs},xWb:function(){return n.xWb},gH0:function(){return n.gH0},rBU:function(){return n.rBU},rDY:function(){return n.rDY},ywz:function(){return n.ywz},wJv:function(){return n.wJv},JQ4:function(){return n.JQ4},k0A:function(){return n.k0A},irR:function(){return n.irR},LsT:function(){return n.LsT},q5h:function(){return Ts},TKh:function(){return Ss},tyg:function(){return Cs},Ro5:function(){return Yr},Saj:function(){return Vo},CHp:function(){return mC},dwk:function(){return n.dwk},t0w:function(){return pP},M7$:function(){return hP},ML4:function(){return dP},FM8:function(){return n.FM8},Pa4:function(){return n.Pa4},Ltg:function(){return n.Ltg},yC1:function(){return n.yC1},lHq:function(){return nh},fO1:function(){return n.fO1},oMA:function(){return zs},JzW:function(){return e},QEt:function(){return Kd},IFZ:function(){return gP},b5g:function(){return n.b5g},Ywn:function(){return n.Ywn},GVz:function(){return n.GVz},_RZ:function(){return n._RZ},oAp:function(){return n.oAp},kFz:function(){return n.kFz},dd2:function(){return n.dd2},CP7:function(){return n.CP7},fQK:function(){return n.fQK},JCZ:function(){return n.JCZ},Wd$:function(){return pv},t1_:function(){return TL},v27:function(){return ra},Uk6:function(){return n.Uk6},H7Z:function(){return ea},_sL:function(){return n._sL},czO:function(){return uP},Pnf:function(){return n.Pnf},c8b:function(){return n.c8b},_lf:function(){return n._lf},ad5:function(){return n.ad5},sZV:function(){return ws},TfA:function(){return bs},sKX:function(){return Rs},UdM:function(){return ys},P0y:function(){return Qr},L_r:function(){return n.L_r},zC5:function(){return t.absMax},Bve:function(){return sv},b5G:function(){return vo},UeO:function(){return ri},qCx:function(){return AN},$nx:function(){return jy},Bk6:function(){return zn},EER:function(){return oh},y4l:function(){return Ht},P39:function(){return Ph},HI1:function(){return t.aesGcmDecrypt},ZYi:function(){return t.aesGcmEncrypt},wXW:function(){return Jm},r5x:function(){return Xm},MSI:function(){return eg},EUu:function(){return kU},jtH:function(){return Dd},T0T:function(){return Ud},gAb:function(){return hU},je_:function(){return fU},wBP:function(){return Ld},LU2:function(){return eu},wQL:function(){return BU},Zs7:function(){return _g},sMc:function(){return t.arrayBufferToBase64},x7s:function(){return Dg},Mnd:function(){return UU},A0_:function(){return NU},d73:function(){return Lm},HCD:function(){return Q},YQ8:function(){return ge},RG9:function(){return W},G2P:function(){return Jc},XLf:function(){return $c},CGN:function(){return Zc},RGi:function(){return t.base64ToArrayBuffer},mvg:function(){return Um},Hiy:function(){return Rt},XMc:function(){return Ym},N7M:function(){return Wm},iv:function(){return Zm},n55:function(){return t.blobToDataURL},IaC:function(){return km},h9t:function(){return nu},yDW:function(){return iu},gJv:function(){return tu},l$g:function(){return oS},vQi:function(){return GT},$MY:function(){return St},wJl:function(){return Et},Z7Y:function(){return Xc},X7D:function(){return Kc},BnX:function(){return Yc},uZ5:function(){return lu},zVI:function(){return jm},Wz1:function(){return t.colorToDataUrl},DpF:function(){return wo},nNb:function(){return Fr},cqZ:function(){return jr},pKN:function(){return WE},CN8:function(){return ql},DdI:function(){return qE},rrX:function(){return XE},uqj:function(){return g},Z9P:function(){return S},KlC:function(){return Hl},KVn:function(){return R},oau:function(){return gg},aw9:function(){return K},Aap:function(){return Ee},Dxg:function(){return t.copyProps},MjT:function(){return Z},F7Q:function(){return Vc},IFq:function(){return LU},IJl:function(){return Gc},O5A:function(){return t.createCanvasElement},wCn:function(){return t.createDiv},gGT:function(){return zc},hqj:function(){return gE},pEc:function(){return QE},Bi6:function(){return t.createImage},fi_:function(){return Lg},TT:function(){return og},q2Z:function(){return KL},NyK:function(){return me},bgu:function(){return t.createScriptFromURL},kcS:function(){return t.createStyles},rRN:function(){return rS},ivY:function(){return t.css},_s1:function(){return lN},_HO:function(){return G},tpL:function(){return V},DMK:function(){return hd},LjN:function(){return ts},iFs:function(){return ns},qTg:function(){return t.deepAccessObject},J4G:function(){return y},Zj8:function(){return IU},Wtl:function(){return Rr},DmK:function(){return Dr},Htt:function(){return FU},Nv0:function(){return A},tCp:function(){return w},Hx7:function(){return ce},imt:function(){return ae},US6:function(){return Tg},vZs:function(){return Xl},TE$:function(){return VU},lmu:function(){return t.downloadBlob},SvO:function(){return t.downloadFile},YQY:function(){return Qc},mZN:function(){return qc},VvG:function(){return Wc},omp:function(){return t.embedUrlRefs},utz:function(){return Fm},TFV:function(){return Gs},hrz:function(){return t.escapeRegExp},H$s:function(){return x},JKM:function(){return lg},jZf:function(){return dU},RjL:function(){return GO},RRI:function(){return Ig},RUq:function(){return WC},_t4:function(){return He},YHh:function(){return Qe},R8g:function(){return k},f1L:function(){return t.getFileHandle},Bbl:function(){return t.getFilenameFromPath},V9r:function(){return t.getKeyByValue},a95:function(){return t.getNewFileHandle},PZ2:function(){return t.getOrCall},w7A:function(){return t.getPropertyDescriptor},N6S:function(){return L},Uxp:function(){return U},tAz:function(){return O},R$F:function(){return F},N33:function(){return N},JFD:function(){return B},gw2:function(){return ks},rfc:function(){return t.getTypedArray},wo6:function(){return t.getUrlQueryParam},V4T:function(){return Un},H4P:function(){return t.glsl},NLp:function(){return Th},swA:function(){return Vr},_Z3:function(){return Hr},ivc:function(){return Fr},rZ1:function(){return jr},CpZ:function(){return Og},dyc:function(){return t.html},MxZ:function(){return t.htmlToCanvas},btp:function(){return t.htmlToPng},mXy:function(){return t.htmlToSvg},Ej0:function(){return we},ep4:function(){return Y},DQP:function(){return xe},VNr:function(){return J},V7q:function(){return t.imageBitmapToBase64},hiB:function(){return t.imageDataToCanvas},zEk:function(){return t.imageToCanvas},qfq:function(){return t.imageUrlToImageData},piB:function(){return t.includesAll},IIc:function(){return RU},rrF:function(){return Or},naq:function(){return Lr},zlD:function(){return b},sXR:function(){return cd},p5I:function(){return Od},wps:function(){return jU},wuo:function(){return zU},GpE:function(){return t.isPropertyWritable},F4b:function(){return dd},NN$:function(){return xh},t$v:function(){return Om},tdn:function(){return Vd},Y9t:function(){return Hd},GEo:function(){return Hc},GGm:function(){return t.longestCommonPrefix},DH3:function(){return Km},uxM:function(){return t.makeColorSvg},zH3:function(){return t.makeColorSvgCircle},MLs:function(){return vt},xXG:function(){return X},YM4:function(){return Bd},iAx:function(){return t.makeTextSvg},lDn:function(){return z},P1O:function(){return v},iib:function(){return P},qf5:function(){return I},n4s:function(){return _},fr:function(){return M},Z9s:function(){return E},oaQ:function(){return jc},CD7:function(){return wu},Rc0:function(){return Hu},iPG:function(){return ad},TIc:function(){return t.mobileAndTabletCheck},xsC:function(){return tg},zOc:function(){return t.now},i8W:function(){return t.objectHasOwn},r46:function(){return vg},z2C:function(){return t.onChange},N4A:function(){return t.onChange2},hjq:function(){return t.onChange3},_X$:function(){return t.parseFileExtension},_yn:function(){return dt},Dyg:function(){return t.pathJoin},cUc:function(){return It},zGw:function(){return nd},Ctq:function(){return Qm},$ch:function(){return HU},k5b:function(){return Gm},kZl:function(){return sg},OCg:function(){return pg},Kd3:function(){return t.prettyScrollbar},YjH:function(){return Rg},Ui8:function(){return Ny},YD2:function(){return Au},vi9:function(){return DU},ij3:function(){return qm},pJq:function(){return t.readFile},YPW:function(){return Vm},_tY:function(){return t.remoteWorkerURL},Bg1:function(){return $L},kon:function(){return t.replaceAll},M3g:function(){return Fc},F2z:function(){return Bm},pJF:function(){return TC},knz:function(){return n.knz},Ejo:function(){return t.safeSetProperty},BgY:function(){return de},qCG:function(){return re},HD9:function(){return le},Rgz:function(){return he},fEB:function(){return se},Udc:function(){return Ae},ZQg:function(){return be},ofC:function(){return H},yRy:function(){return t.setUrlQueryParam},_NL:function(){return xN},LCA:function(){return ye},Sy1:function(){return OL},Vs_:function(){return LL},j1w:function(){return jt},i8J:function(){return wN},p7C:function(){return ot},Y8s:function(){return MU},ZAS:function(){return Wd},ipH:function(){return qU},$TF:function(){return WU},uZI:function(){return XU},VWG:function(){return rm},pQ7:function(){return Gd},STw:function(){return yu},jc8:function(){return Tt},BL_:function(){return Nm},S6:function(){return cN},T8U:function(){return ds},TD6:function(){return us},BTW:function(){return TU},akS:function(){return t.svgToCanvas},QKE:function(){return t.svgToPng},dKx:function(){return t.svgUrl},doP:function(){return te},$jA:function(){return $},T99:function(){return ee},LJS:function(){return ne},VsW:function(){return t.timeout},LZE:function(){return T},YMc:function(){return QU},aPg:function(){return q},LFn:function(){return t.toTitleCase},VsX:function(){return C},wey:function(){return Dm},MaE:function(){return je},s4x:function(){return Ge},FJA:function(){return Be},vIA:function(){return Fe},Spv:function(){return We},w8l:function(){return Ve},riG:function(){return ze},Kbh:function(){return Le},BFq:function(){return qe},t8K:function(){return Ue},Q7n:function(){return Oe},KGF:function(){return Ne},e5:function(){return j},Rik:function(){return Is},GZo:function(){return Ps},Bds:function(){return Jr},HTu:function(){return Zr},cTq:function(){return t.uploadFile},X_Y:function(){return Ct},dA8:function(){return xt},NSm:function(){return Xe},bwS:function(){return Hm},Lks:function(){return YU},Rvq:function(){return PU},P4F:function(){return t.verifyPermission},Pd0:function(){return jn},Pjo:function(){return zm},Tum:function(){return Gn},dRH:function(){return Hn},RX0:function(){return Vn},reQ:function(){return KU},cWm:function(){return $m},NC9:function(){return t.writeFile},$Re:function(){return xs},Xo9:function(){return Es},LNO:function(){return qr},iZP:function(){return Xr}}),function(e){e[e.Error=-2]="Error",e[e.Destroyed=-1]="Destroyed",e[e.None=0]="None",e[e.Running=1]="Running",e[e.Paused=2]="Paused"}(e||(e={}));var t=__webpackgi_require__(8),n=__webpackgi_require__(988);const i={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class r{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const s=new n.iKG(-1,1,1,-1,0,1),o=new n.u9r;o.setAttribute("position",new n.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new n.a$l([0,2,0,0,2,0],2));class a{constructor(e){this._mesh=new n.Kj0(o,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,s)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class l extends r{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof n.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=n.rDY.clone(e.uniforms),this.material=new n.jyz({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new a(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&n&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class c extends r{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;let s,o;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),r.buffers.stencil.setClear(o),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class u extends r{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class d{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const i=e.getSize(new n.FM8);this._width=i.width,this._height=i.height,(t=new n.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:n.cLu})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new l(i),this.clock=new n.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,r=this.passes.length;i<r;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==c&&(t instanceof c?n=!0:t instanceof u&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new n.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class h extends d{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}class p extends n.ZzF{expandByObject(e,t=!1,n=!1,i){var r;if(!1===(null===(r=e.userData)||void 0===r?void 0:r.bboxVisible))return this;if(!e.visible&&n)return this;if(i&&i(e))return this;if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),f.copy(e.boundingBox),f.applyMatrix4(e.matrixWorld),this.union(f);else{const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)m.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(m)}else null===n.boundingBox&&n.computeBoundingBox(),f.copy(n.boundingBox),f.applyMatrix4(e.matrixWorld),this.union(f)}const s=e.children;for(let o=0,a=s.length;o<a;o++)this.expandByObject(s[o],t,n,i);return this}expandByObjects(e,t=!1,n=!1,i){for(let r=0,s=e.length;r<s;r++)this.expandByObject(e[r],t,n,i);return this}getPoints(){return[new n.Pa4(this.min.x,this.min.y,this.min.z),new n.Pa4(this.min.x,this.min.y,this.max.z),new n.Pa4(this.min.x,this.max.y,this.min.z),new n.Pa4(this.min.x,this.max.y,this.max.z),new n.Pa4(this.max.x,this.min.y,this.min.z),new n.Pa4(this.max.x,this.min.y,this.max.z),new n.Pa4(this.max.x,this.max.y,this.min.z),new n.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),i=new n.TUj;for(const n of t){const t=n.project(e);i.min.min(t),i.max.max(t)}return i}}const f=new p,m=new n.Pa4;function g(e,t,i=!0){if(!t||!t.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function r(e){if(e.normalized||e.isInterleavedBufferAttribute){const t=new Float32Array(e.count*e.itemSize);for(let n=0,i=0;n<e.count;n++)t[i++]=e.getX(n),t[i++]=e.getY(n),e.itemSize>2&&(t[i++]=e.getZ(n));return t}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}const s=e.index?e.toNonIndexed():e,o=t.generateTangents(r(s.attributes.position),r(s.attributes.normal),r(s.attributes.uv));if(i)for(let n=3;n<o.length;n+=4)o[n]*=-1;return s.setAttribute("tangent",new n.TlE(o,4)),e!==s&&e.copy(s),e}function _(e,t=!1){const i=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),o={},a={},l=e[0].morphTargetsRelative,c=new n.u9r;let u=0;for(let n=0;n<e.length;++n){const d=e[n];let h=0;if(i!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in d.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[e]&&(o[e]=[]),o[e].push(d.attributes[e]),h++}if(h!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". Make sure all geometries have the same number of attributes."),null;if(l!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in d.morphAttributes){if(!s.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[e]&&(a[e]=[]),a[e].push(d.morphAttributes[e])}if(t){let e;if(i)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}c.addGroup(u,e,n),u+=e}}if(i){let t=0;const n=[];for(let i=0;i<e.length;++i){const r=e[i].index;for(let e=0;e<r.count;++e)n.push(r.getX(e)+t);t+=e[i].attributes.position.count}c.setIndex(n)}for(const n in o){const e=v(o[n]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+n+" attribute."),null;c.setAttribute(n,e)}for(const n in a){const e=a[n][0].length;if(0===e)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[n]=[];for(let t=0;t<e;++t){const e=[];for(let r=0;r<a[n].length;++r)e.push(a[n][r][t]);const i=v(e);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+n+" morphAttribute."),null;c.morphAttributes[n].push(i)}}return c}function v(e){let t,i,r,s=-1,o=0;for(let n=0;n<e.length;++n){const a=e[n];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=a.normalized),r!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===s&&(s=a.gpuType),s!==a.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=a.array.length}const a=new t(o);let l=0;for(let n=0;n<e.length;++n)a.set(e[n].array,l),l+=e[n].array.length;const c=new n.TlE(a,i,r);return void 0!==s&&(c.gpuType=s),c}function y(e){return e.isInstancedInterleavedBufferAttribute||e.isInterleavedBufferAttribute?A(e):e.isInstancedBufferAttribute?(new n.lb7).copy(e):(new n.TlE).copy(e)}function b(e){let t,i=0,r=0;for(let n=0,u=e.length;n<u;++n){const s=e[n];if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=s.array.length,r+=s.itemSize}const s=new n.vpT(new t(i),r);let o=0;const a=[],l=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let u=0,d=e.length;u<d;u++){const t=e[u],i=t.itemSize,r=t.count,d=new n.kB5(s,i,o,t.normalized);a.push(d),o+=i;for(let e=0;e<r;e++)for(let n=0;n<i;n++)d[c[n]](e,t[l[n]](e))}return a}function A(e){const t=e.data.array.constructor,i=e.count,r=e.itemSize,s=e.normalized,o=new t(i*r);let a;a=e.isInstancedInterleavedBufferAttribute?new n.lb7(o,r,s,e.meshPerAttribute):new n.TlE(o,r,s);for(let n=0;n<i;n++)a.setX(n,e.getX(n)),r>=2&&a.setY(n,e.getY(n)),r>=3&&a.setZ(n,e.getZ(n)),r>=4&&a.setW(n,e.getW(n));return a}function w(e){const t=e.attributes,n=e.morphTargets,i=new Map;for(const r in t){const e=t[r];e.isInterleavedBufferAttribute&&(i.has(e)||i.set(e,A(e)),t[r]=i.get(e))}for(const r in n){const e=n[r];e.isInterleavedBufferAttribute&&(i.has(e)||i.set(e,A(e)),n[r]=i.get(e))}}function x(e){let t=0;for(const i in e.attributes){const n=e.getAttribute(i);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function E(e,t=1e-4){const i=t>0;t=Math.max(t,Number.EPSILON);const r={},s=e.getIndex(),o=e.getAttribute("position"),a=s?s.count:o.count;let l=0;const c=Object.keys(e.attributes),u={},d={},h=[],p=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let v=0,y=c.length;v<y;v++){const t=c[v],i=e.attributes[t];u[t]=new n.TlE(new i.array.constructor(i.count*i.itemSize),i.itemSize,i.normalized);const r=e.morphAttributes[t];r&&(d[t]=new n.TlE(new r.array.constructor(r.count*r.itemSize),r.itemSize,r.normalized))}const m=Math.log10(1/t),g=Math.pow(10,m);for(let n=0;n<a;n++){const t=s?s.getX(n):n;let o="";for(let n=0,r=c.length;n<r&&i;n++){const i=c[n],r=e.getAttribute(i),s=r.itemSize;for(let e=0;e<s;e++)o+=~~(r[p[e]](t)*g)+","}if(i&&o in r)h.push(r[o]);else{for(let n=0,i=c.length;n<i;n++){const i=c[n],r=e.getAttribute(i),s=e.morphAttributes[i],o=r.itemSize,a=u[i],h=d[i];for(let e=0;e<o;e++){const n=p[e],i=f[e];if(a[i](l,r[n](t)),s)for(let e=0,r=s.length;e<r;e++)h[e][i](l,s[e][n](t))}}i&&(r[o]=l),h.push(l),l++}}const _=e.clone();for(const v in e.attributes){const e=u[v];if(_.setAttribute(v,new n.TlE(e.array.slice(0,l*e.itemSize),e.itemSize,e.normalized)),v in d)for(let t=0;t<d[v].length;t++){const e=d[v][t];_.morphAttributes[v][t]=new n.TlE(e.array.slice(0,l*e.itemSize),e.itemSize,e.normalized)}}return _.setIndex(h),_}function C(e,t){if(t===n.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===n.z$h||t===n.UlW){let i=e.getIndex();if(null===i){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const r=i.count-2,s=[];if(t===n.z$h)for(let e=1;e<=r;e++)s.push(i.getX(0)),s.push(i.getX(e)),s.push(i.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(s.push(i.getX(e)),s.push(i.getX(e+1)),s.push(i.getX(e+2))):(s.push(i.getX(e+2)),s.push(i.getX(e+1)),s.push(i.getX(e)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(s),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function S(e){const t=new n.Pa4,i=new n.Pa4,r=new n.Pa4,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=new n.Pa4,u=new n.Pa4;function d(e,n,d,h,p,f,m,g){t.fromBufferAttribute(n,p),i.fromBufferAttribute(n,f),r.fromBufferAttribute(n,m);const _=e.morphTargetInfluences;if(d&&_){l.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(let e=0,n=d.length;e<n;e++){const n=_[e],g=d[e];0!==n&&(s.fromBufferAttribute(g,p),o.fromBufferAttribute(g,f),a.fromBufferAttribute(g,m),h?(l.addScaledVector(s,n),c.addScaledVector(o,n),u.addScaledVector(a,n)):(l.addScaledVector(s.sub(t),n),c.addScaledVector(o.sub(i),n),u.addScaledVector(a.sub(r),n)))}t.add(l),i.add(c),r.add(u)}e.isSkinnedMesh&&(e.applyBoneTransform(p,t),e.applyBoneTransform(f,i),e.applyBoneTransform(m,r)),g[3*p+0]=t.x,g[3*p+1]=t.y,g[3*p+2]=t.z,g[3*f+0]=i.x,g[3*f+1]=i.y,g[3*f+2]=i.z,g[3*m+0]=r.x,g[3*m+1]=r.y,g[3*m+2]=r.z}const h=e.geometry,p=e.material;let f,m,g;const _=h.index,v=h.attributes.position,y=h.morphAttributes.position,b=h.morphTargetsRelative,A=h.attributes.normal,w=h.morphAttributes.position,x=h.groups,E=h.drawRange;let C,S,M,T,I,P,R;const D=new Float32Array(v.count*v.itemSize),k=new Float32Array(A.count*A.itemSize);if(null!==_)if(Array.isArray(p))for(C=0,M=x.length;C<M;C++)for(I=x[C],P=Math.max(I.start,E.start),R=Math.min(I.start+I.count,E.start+E.count),S=P,T=R;S<T;S+=3)f=_.getX(S),m=_.getX(S+1),g=_.getX(S+2),d(e,v,y,b,f,m,g,D),d(e,A,w,b,f,m,g,k);else for(P=Math.max(0,E.start),R=Math.min(_.count,E.start+E.count),C=P,M=R;C<M;C+=3)f=_.getX(C),m=_.getX(C+1),g=_.getX(C+2),d(e,v,y,b,f,m,g,D),d(e,A,w,b,f,m,g,k);else if(Array.isArray(p))for(C=0,M=x.length;C<M;C++)for(I=x[C],P=Math.max(I.start,E.start),R=Math.min(I.start+I.count,E.start+E.count),S=P,T=R;S<T;S+=3)f=S,m=S+1,g=S+2,d(e,v,y,b,f,m,g,D),d(e,A,w,b,f,m,g,k);else for(P=Math.max(0,E.start),R=Math.min(v.count,E.start+E.count),C=P,M=R;C<M;C+=3)f=C,m=C+1,g=C+2,d(e,v,y,b,f,m,g,D),d(e,A,w,b,f,m,g,k);return{positionAttribute:v,normalAttribute:A,morphedPositionAttribute:new n.a$l(D,3),morphedNormalAttribute:new n.a$l(k,3)}}function M(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let t=e.groups;if(t=t.sort(((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start)),null===e.getIndex()){const t=e.getAttribute("position"),n=[];for(let e=0;e<t.count;e+=3)n.push(e,e+1,e+2);e.setIndex(n)}const n=e.getIndex(),i=[];for(let o=0;o<t.length;o++){const e=t[o],r=e.start,s=r+e.count;for(let t=r;t<s;t++)i.push(n.getX(t))}e.dispose(),e.setIndex(i);let r=0;for(let o=0;o<t.length;o++){const e=t[o];e.start=r,r+=e.count}let s=t[0];e.groups=[s];for(let o=1;o<t.length;o++){const n=t[o];s.materialIndex===n.materialIndex?s.count+=n.count:(s=n,e.groups.push(s))}return e}function T(e,t=Math.PI/3){const i=Math.cos(t),r=100*(1+1e-10),s=[new n.Pa4,new n.Pa4,new n.Pa4],o=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=new n.Pa4;function u(e){return`${~~(e.x*r)},${~~(e.y*r)},${~~(e.z*r)}`}const d=e.toNonIndexed(),h=d.attributes.position,p={};for(let g=0,_=h.count/3;g<_;g++){const e=3*g,t=s[0].fromBufferAttribute(h,e+0),i=s[1].fromBufferAttribute(h,e+1),r=s[2].fromBufferAttribute(h,e+2);o.subVectors(r,i),a.subVectors(t,i);const l=(new n.Pa4).crossVectors(o,a).normalize();for(let n=0;n<3;n++){const e=u(s[n]);e in p||(p[e]=[]),p[e].push(l)}}const f=new Float32Array(3*h.count),m=new n.TlE(f,3,!1);for(let n=0,g=h.count/3;n<g;n++){const e=3*n,t=s[0].fromBufferAttribute(h,e+0),r=s[1].fromBufferAttribute(h,e+1),d=s[2].fromBufferAttribute(h,e+2);o.subVectors(d,r),a.subVectors(t,r),l.crossVectors(o,a).normalize();for(let n=0;n<3;n++){const t=p[u(s[n])];c.set(0,0,0);for(let e=0,n=t.length;e<n;e++){const n=t[e];l.dot(n)>i&&c.add(n)}c.normalize(),m.setXYZ(e+n,c.x,c.y,c.z)}}return d.setAttribute("normal",m),d}function I(e,t=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),_(e,t)}function P(e){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),v(e)}function R(e,t){let i,r;if(Array.isArray(e))for(const n of e){const e=R(n,t);void 0===i||void 0===r?(i=e.min.clone(),r=e.max.clone()):(i.min(e.min),r.max(e.max))}const s=e;if(void 0!==s.geometry){const o=s.geometry.vertices;if(void 0===o&&void 0!==s.geometry.attributes&&"position"in s.geometry.attributes){const o=new n.Pa4,a=s.geometry.attributes.position;for(let s=0;s<a.count*a.itemSize;s+=a.itemSize){o.set(a.array[s],a.array[s+1],a.array[3]);const l=o.applyMatrix4(e.matrixWorld).project(t),c=new n.FM8(l.x,l.y);void 0===i||void 0===r?(i=c.clone(),r=c.clone()):(i.min(c),r.max(c))}}else for(const s of o){const o=s.clone().applyMatrix4(e.matrixWorld).project(t),a=new n.FM8(o.x,o.y);void 0===i||void 0===r?(i=a.clone(),r=a.clone()):(i.min(a),r.max(a))}}if(void 0!==e.children)for(const n of e.children){const e=R(n,t);void 0===i||void 0===r?(i=e.min.clone(),r=e.max.clone()):(i.min(e.min),r.max(e.max))}return new n.TUj(i,r)}const D="rgbm-16";function k(e){switch(e){case n.aCh:case n.GUF:return["Linear","( value )"];case n.KI_:return["sRGB","( value )"];case D:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",e),["Linear","( value )"]}}function B(e,t){let i;return e&&e.isTexture?i=e.colorSpace:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.colorSpace):i=n.GUF,t&&e&&e.isTexture&&e.format===n.wk1&&e.type===n.ywz&&e.colorSpace===n.KI_&&(i=n.GUF),i}function O(e,t){const n=k(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function L(e,t,n){return O(e+"TexelToLinear",B(t,n))+"\n"}function U(e,t){return O(e+"TexelToLinear",t)+"\n"}function N(e,t){const n=k(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function F(e,t,n){return N(e,B(t,n))}function j({uniforms:e,propKey:n,thisTarget:i=!1}={}){const r=!!e,s=!!n,o=i;return(i,a)=>{const l=t=>{const i=o?t:r?e:t.uniforms||t._uniforms;let l=s?n:a;o&&(l="_"+l);let c=i[l];return c||(c={value:null},i[l]=c),c};Object.defineProperty(i,a,{get(){return l(this).value},set(e){l(this).value=e,(0,t.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function z(e,n,i=!1,r){const s=!!n,o=!!e;return(a,l)=>{const c=t=>({t:s?n:t.defines||t._defines,p:o?e:l});Object.defineProperty(a,l,{get(){const{t:e,p:t}=c(i?this:this.material);return e[t]},set(e){const{t:n,p:s}=c(i?this:this.material);if((0,t.safeSetProperty)(n,s,e,!0),"function"==typeof r){const t=[s,e];if(r.name){const e=this[r.name];e===r?r.call(this,...t):e.name===`bound ${r.name}`?e(...t):r(...t)}else r(...t)}else(0,t.safeSetProperty)(i?this:this.material,"needsUpdate",!0,!0)}})}}function G(e){const t=new n.IEO(new Uint8Array([Math.floor(255*e.r),Math.floor(255*e.g),Math.floor(255*e.b),255]),1,1,n.wk1,n.ywz);return t.needsUpdate=!0,t.colorSpace=n.aCh,t}function V(e){const t=new n.IEO(new Uint8Array([Math.floor(255*e.x),Math.floor(255*e.y),Math.floor(255*e.z),Math.floor(255*e.w)]),1,1,n.wk1,n.ywz);return t.needsUpdate=!0,t}function H(e,t,n){const i=e.userData,{backgroundRender:r,transparentRender:s,shadowMapRender:o,mainRenderPass:a,opaqueRender:l,transmissionRender:c,sceneRender:u,screenSpaceRendering:d}=i;void 0!==t.backgroundRender&&(i.backgroundRender=t.backgroundRender),void 0!==t.transparentRender&&(i.transparentRender=t.transparentRender),void 0!==t.shadowMapRender&&(i.shadowMapRender=t.shadowMapRender),void 0!==t.mainRenderPass&&(i.mainRenderPass=t.mainRenderPass),void 0!==t.opaqueRender&&(i.opaqueRender=t.opaqueRender),void 0!==t.sceneRender&&(i.sceneRender=t.sceneRender),void 0!==t.transmissionRender&&(i.transmissionRender=t.transmissionRender),void 0!==t.screenSpaceRendering&&(i.screenSpaceRendering=t.screenSpaceRendering),n(),i.backgroundRender=r,i.transparentRender=s,i.shadowMapRender=o,i.mainRenderPass=a,i.opaqueRender=l,i.sceneRender=u,i.transmissionRender=c,i.screenSpaceRendering=d}function Q(e){const t=(new p).expandByObject(e,!0,!0).getCenter(new n.Pa4);e.position.sub(t),e.updateMatrix(),e.userData.autoCentered=!0,e.userData.isCentered=!0}function W(e,t,i){const r=.5*(new p).expandByObject(e,!0,!0).getSize(new n.Pa4).length();void 0===t&&(t=e.userData.autoScaleRadius||1);const s=t/r;return isFinite(s)&&(e.userData.pseudoCentered?e.children.forEach((e=>{e.scale.multiplyScalar(s)})):e.scale.multiplyScalar(s),(i||e.userData.isCentered)&&e.position.multiplyScalar(s),e.traverse((e=>{var t,n;e.isLight&&(null===(n=null===(t=e.shadow)||void 0===t?void 0:t.camera)||void 0===n?void 0:n.right)&&(e.shadow.camera.right*=s,e.shadow.camera.left*=s,e.shadow.camera.top*=s,e.shadow.camera.bottom*=s),e.isCamera&&e.right&&(e.right*=s,e.left*=s,e.top*=s,e.bottom*=s)})),e.userData.autoScaled=!0,e.userData.autoScaleRadius=t,e.dispatchEvent({type:"objectUpdate"})),e}function q(e,t=-1){return E(e,t)}function X(e,t){return{type:"folder",label:t+" Sampler",hidden:()=>!e[t],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[e[t],"repeat"],onChange:null==e?void 0:e.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[e[t],"offset"],onChange:null==e?void 0:e.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[e[t],"center"],onChange:null==e?void 0:e.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[e[t],"rotation"],onChange:null==e?void 0:e.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[e[t],"colorSpace"],children:[["Linear",n.GUF],["sRGB",n.KI_]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{const n=e[t];n&&(n.needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var n,i;return null!==(i=null===(n=e[t])||void 0===n?void 0:n.flipY)&&void 0!==i&&i},setValue:n=>{var i;const r=e[t];if(r&&r.flipY!==n)if(r.image&&ImageBitmap&&r.image instanceof ImageBitmap){const t=r,i=r.source.data;createImageBitmap(i,{imageOrientation:"flipY"}).then((r=>{var s;i.close&&i.close(),t.flipY=n,t.source.data=r,t.source.needsUpdate=!0,t.needsUpdate=!0,null===(s=null==e?void 0:e.setDirty)||void 0===s||s.call(e)}))}else r.flipY=n,r.needsUpdate=!0,null===(i=null==e?void 0:e.setDirty)||void 0===i||i.call(e)}}),()=>({type:"dropdown",label:"Wrap S",property:[e[t],"wrapS"],children:[["ClampToEdge",n.uWy],["MirroredRepeat",n.OoA],["Repeat",n.rpg]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[e[t],"wrapT"],children:[["ClampToEdge",n.uWy],["MirroredRepeat",n.OoA],["Repeat",n.rpg]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[e[t],"anisotropy"],onChange:[()=>{e[t]&&(e[t].needsUpdate=!0),e.needsUpdate=!0},null==e?void 0:e.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[e[t],"minFilter"],children:[["Linear",n.wem],["Nearest",n.TyD],["NearestMipmapNearest",n.YLQ],["NearestMipmapLinear",n.vZf],["LinearMipmapNearest",n.qyh],["LinearMipmapLinear",n.D1R]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[e[t],"magFilter"],children:[["Linear",n.wem],["Nearest",n.TyD]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]})]}}const Y=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function K(e,t,n=!0){if(!t)return e;for(const i of Object.keys(t)){if(n&&Y.includes(i))continue;if(i.startsWith("__"))continue;const r=t[i];if("function"==typeof e[i]||"function"==typeof r)continue;const s=!r||r.isTexture||r.isObject3D||r.isMaterial;s||"function"!=typeof r.clone?s||"object"!=typeof r&&!Array.isArray(r)?e[i]=r:e[i]=K(Array.isArray(r)?[]:{},r,!1):e[i]=r.clone()}return e}const J=["appliedMaterials","uuid"];function Z(e,t){if(t)for(const n of Object.keys(t))J.includes(n)||n.startsWith("__")||"function"!=typeof e[n]&&"function"!=typeof t[n]&&(e[n]=t[n]);return e}function $(e,i,r){var s;const o=null!==(s=null==r?void 0:r.data)&&void 0!==s?s:new Uint8ClampedArray(e.height*e.width*4),a=e.data instanceof Float32Array,l=e.data instanceof Uint16Array;for(let c=0;c<o.length;c++)o[c]=a?255*e.data[c]:l?255*n.A5E.fromHalfFloat(e.data[c]):e.data[c],i===n.GUF&&(o[c]=255*(0,t.LinearToSRGB)(o[c]/255));return null!=r?r:new ImageData(o,e.width,e.height)}function ee(e,t,n=!1){let i;return i=e.isDataTexture?$(e.image,e.colorSpace):e.image,te(i,t,n)}function te(e,n,i=!1){const r=document.createElement("canvas");r.width=Math.min(n,e.width),r.height=Math.floor(1+r.width*e.height/e.width);const s=r.getContext("2d");if(!s)return console.error("textureToDataUrl: could not get canvas context"),r;!0===i&&(s.translate(0,r.height),s.scale(1,-1));let o=!1;if(void 0!==e.data){const t=e;if(e.width!==r.width||e.height!==r.height){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i?(i.putImageData(t,0,0),s.drawImage(n,0,0,r.width,r.height)):(console.error("textureToDataUrl: could not get temp canvas context"),s.putImageData(t,0,0))}else s.putImageData(t,0,0),i&&(o=!0)}else s.drawImage(e,0,0,r.width,r.height);return o?(0,t.canvasFlipY)(r):r}function ne(e,t,n,i,r){return ee(e,t,n).toDataURL(i,r)}String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)});const ie=new Map;function re(e){return(t,n)=>{const i=t.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");ie.has(i)||ie.set(i,[]),ie.get(i).push([e||n,n])}}const se={obj:(e,t)=>Object.fromEntries(Object.entries(e).map((([e,n])=>[e,le(n,!1,t)]))),vec4:e=>({x:e.x,y:e.y,z:e.z,w:e.w,isVector4:!0}),vec3:e=>({x:e.x,y:e.y,z:e.z,isVector3:!0}),vec2:e=>({x:e.x,y:e.y,isVector2:!0}),color:e=>({r:e.r,g:e.g,b:e.b,isColor:!0}),quat:e=>({x:e.x,y:e.y,z:e.z,w:e.w,isQuaternion:!0}),texture:(e,t)=>{var n;if(!(null==e?void 0:e.isTexture))throw new Error("Expected a texture");if(null==t?void 0:t.textures[e.uuid])return{uuid:e.uuid,resource:"textures"};if(e.isRenderTargetTexture&&!(null===(n=e.userData)||void 0===n?void 0:n.serializableRenderTarget))return;const i=e.source.data,r=!e.isRenderTargetTexture&&e.userData.rootPath;r&&e.source.data&&(e.userData.__embedUrlImagePreviews?e.source.data=ee(e,16,e.flipY):e.source.data=null);const s=e.userData;e.userData={};const o={images:{}};let a={};try{a=e.toJSON(t||o),!t&&a.image&&(a.image=r&&!e.userData.__embedUrlImagePreviews?void 0:o.images[a.image]),a.userData=le(Z({},s),!1,t)}catch(e){console.error(e)}return e.userData=s,r&&(t&&!e.userData.__embedUrlImagePreviews&&delete t.images[e.source.uuid],e.source.data=i),(null==t?void 0:t.textures)&&!a.resource&&(t.textures[a.uuid]||(t.textures[a.uuid]=a),a={uuid:a.uuid,resource:"textures"}),a},material:(e,t)=>{if(!(null==e?void 0:e.isMaterial))throw new Error("Expected a material");if(null==t?void 0:t.materials[e.uuid])return{uuid:e.uuid,resource:"materials"};e.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const n=null!=t?t:{textures:{},images:{}},i={},r={};for(const[o,a]of Object.entries(e))if((null==a?void 0:a.isTexture)&&!o.startsWith("__")){const t=se.texture(a,n);i[o]=t,r[o]=a,e[o]=t?{isTexture:!0,toJSON:()=>t}:null}let s=e.toJSON(t);for(const[o,a]of Object.entries(r))e[o]=a,delete r[o];if(t){for(const[e,t]of Object.entries(i))t&&(s[e]=t);(null==t?void 0:t.materials)&&(t.materials[s.uuid]||(t.materials[s.uuid]=s),s={uuid:s.uuid,resource:"materials"})}else{for(const[e,t]of Object.entries(i))t&&(s[e]=t.uuid);s.textures=Object.values(n.textures),s.images=Object.values(n.images)}return s}},oe=e=>(t,n)=>{var i,r;return null!==(r=null===(i=null==n?void 0:n.copy)||void 0===i?void 0:i.call(n,t))&&void 0!==r?r:(new e).copy(t)},ae={obj:(e,t,n)=>Object.assign(t,Object.fromEntries(Object.entries(e).map((([e,i])=>[e,ce(i,null==t?void 0:t[e],!1,n)])))),vec4:oe(n.Ltg),vec3:oe(n.Pa4),vec2:oe(n.FM8),color:oe(n.Ilk),quat:oe(n._fP)};function le(e,t,n){var i,r;if("function"==typeof e)return;if(Array.isArray(e))return e.map((e=>le(e,!1,n)));if("object"!=typeof e){if("number"==typeof e){if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN"}return e}if(!e)return e;let s=null!==(i=e.constructor)&&void 0!==i?i:Object;if(s===Object)return se.obj(e,n);if(e.isVector2)return se.vec2(e);if(e.isVector3)return se.vec3(e);if(e.isVector4)return se.vec4(e);if(e.isColor)return se.color(e);if(e.isQuaternion)return se.quat(e);if(e.isTexture)return se.texture(e,n);if(e.isMaterial)return se.material(e,n);if(!t&&"function"==typeof e.toJSON){const t=e.toJSON(n);return e.serializableClassId&&t&&(t.serializableClassId=e.serializableClassId),t}const o={};for(;s&&s!==Object;)null===(r=ie.get(s))||void 0===r||r.forEach((([t,i])=>{const r=e[i];o[t]=le(r,!1,n)})),s=Object.getPrototypeOf(s);return e.serializableClassId&&(o.serializableClassId=e.serializableClassId),o}function ce(e,n,i,r){var s,o,a;let l=n;if(void 0===e)return l;if("number"==typeof n){if("Infinity"===e)return 1/0;if("-Infinity"===e)return-1/0;if("NaN"===e)return NaN;if("number"==typeof e||!e)return e}if(Array.isArray(e)){const t=e.length;Array.isArray(l)||(l=[]);for(let n=0;n<t;n++){const t=e[n],i=l.length>n?ce(t,l[n],!1,r):ce(t,void 0,!1,r);l.length<=n?l.push(i):l[n]=i}return l}let c=!1;if(e&&e.resource&&"string"==typeof e.resource&&(e=null===(s=r[e.resource])||void 0===s?void 0:s[e.uuid],c=!0),!l&&e&&!c)if(e.serializableClassId){const t=ue.get(e.serializableClassId);t&&(l=t.DataInConstructor?new t(e):new t)}else"object"!=typeof e||e.constructor&&e.constructor!==Object||(l={});if("function"==typeof l)return console.error("cannot deserialize over function",l,e),l;if(e&&"object"==typeof e&&!c){if(e.isVector2)return ae.vec2(e,l);if(e.isVector3)return ae.vec3(e,l);if(e.isVector4)return ae.vec4(e,l);if(e.isColor)return ae.color(e,l);if(e.isQuaternion)return ae.quat(e,l)}if(null==e||null==l||"object"!=typeof l||l.isTexture)return c&&(e?e.__useCount=e.__useCount?e.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),e;let u=null!==(o=l.constructor)&&void 0!==o?o:Object;if(u===Object)return ae.obj(e,l,r);if(!i&&"function"==typeof l.fromJSON)return l.isMaterial&&(Object.entries(e).forEach((([t,n])=>{var i;if(!n||!n.resource||"string"!=typeof n.resource)return;const s=null===(i=r[n.resource])||void 0===i?void 0:i[n.uuid];e[t]=s||null})),e.userData&&(e.userData=ce(e.userData,void 0,!1,r))),l.fromJSON(e,r),l;for(;u&&u!==Object;)null===(a=ie.get(u))||void 0===a||a.forEach((([n,i])=>{const s=l[i],o=ce(e[n],s,!1,r);o!==s&&(0,t.safeSetProperty)(l,i,o,!0)})),u=Object.getPrototypeOf(u);return l}const ue=new Map;function de(e){return t=>(t=class extends t{constructor(){super(...arguments),this.serializableClassId=e}},ue.set(e,t),t)}function he(e,t,n,i){var r,s,o;if(null==t?void 0:t.extras[e.uuid])return{uuid:e.uuid,resource:"extras"};let a="";if((null===(r=e.source)||void 0===r?void 0:r._sourceImgBuffer)||e.userData.__sourceBuffer){const t=new Uint8Array((null===(s=e.source)||void 0===s?void 0:s._sourceImgBuffer)||e.userData.__sourceBuffer),n=i||e.userData.mimeType||"";a={data:Array.from(t),type:t.constructor.name,path:(null===(o=e.userData.__sourceBlob)||void 0===o?void 0:o.name)||e.userData.rootPath||"file."+n.split("/")[1]},n&&(a.mimeType=n)}else e.userData.rootPath?a=e.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const l={uuid:e.uuid,url:a,userData:Z({},e.userData),type:e.type,name:n||e.name};return(null==t?void 0:t.extras)?(t.extras[e.uuid]=l,{uuid:e.uuid,resource:"extras"}):l}var pe=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let fe=class extends t.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,n,i;const r=this._passes,s=[],o={};for(const t of r){if(!1===t.enabled)continue;const r={after:null!==(e=t.after)&&void 0!==e?e:[],before:null!==(n=t.before)&&void 0!==n?n:[],dependencies:new Set(null!==(i=t.required)&&void 0!==i?i:[])};o[t.passId]=r}for(const[t,a]of Object.entries(o)){const e=new Set([...a.after,...a.before]);a.dependencies.forEach((t=>e.has(t)&&e.delete(t))),e.forEach((e=>{const n=o[e];if(n){if(n.dependencies.has(t))throw console.error("cyclic",t,e),"Cyclic dependency";a.dependencies.add(e)}}))}for(;;){let e=!1;const n=[...Object.entries(o)];for(const[i,a]of n)if(!s.includes(i)&&(0,t.includesAll)(s,a.dependencies.values())){const t=Math.max(-1,...a.after.map((e=>s.indexOf(e)))),n=Math.min(s.length,...a.before.map((e=>{const t=s.indexOf(e);return t<0?s.length:t})));if(t>=n)throw console.error(a,r,s,t,n),"Not possible";s.splice(a.after.length>0?t+1:n,0,i),e=!0,delete o[i]}if(Object.keys(o).length<1)break;if(!e)throw console.error(n,o,s),"Not possible 2"}return this.pipeline=s,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,t){const n=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=n,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:n,time:e,renderer:this,xrFrame:t}))}get clock(){return this._composer.clock}registerPass(e,t=!0){var n;if(t)for(const i of[...this._passes])e.passId===i.passId&&this.unregisterPass(i);this._passes.push(e),null===(n=e.onRegister)||void 0===n||n.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var t;const n=this._passes.indexOf(e);n>=0&&(null===(t=e.onUnregister)||void 0===t||t.call(e,this),this._passes.splice(n,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:e,canvas:t,alpha:i=!0,targetOptions:r}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new n.FM8(512,512),this._frameCount=0,this.defaultRenderToScreen=!0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new n.CP7({canvas:t,antialias:!1,alpha:i,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=e=>{this.dispatchEvent({type:"contextLost",event:e})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new n.FM8(t.clientWidth,t.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=n.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=n.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=n._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(r,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new h(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}setSize(e,t,n=!1){!n&&(e?Math.abs(e-this._renderSize.width):0)+(t?Math.abs(t-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),t&&(this._renderSize.height=t),this.rendererObject.xr.enabled&&this.rendererObject.xr.isPresenting||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach((e=>{const t=e,n=t.sizeMultiplier;if(n){const e=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*n);t.setSize(Math.floor(e.width),Math.floor(e.height))}})),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,t,{viewport:i,material:r,shader:s,pass:o,clear:a=!0}={}){const l=this._composer.copyPass,{renderToScreen:c,material:u,uniforms:d,clear:h}=l;r&&(l.material=r);const p=this._renderer.getViewport(new n.Ltg),f=this._renderer.autoClear,m=this._renderer.getRenderTarget();i&&this._renderer.setViewport((new n.Ltg).fromArray(i)),this._renderer.autoClear=!1,l.uniforms=l.material.uniforms,l.renderToScreen=!1,l.clear=a,H(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},(()=>{l.render(this._renderer,null!=t?t:null,{texture:e},0,!1)})),l.renderToScreen=c,l.clear=h,l.material=u,l.uniforms=d,this._renderer.autoClear=f,i&&this._renderer.setViewport(p),this._renderer.setRenderTarget(m)}clearColor({r:e,g:t,b:i,a:r,target:s,depth:o=!0,stencil:a=!0}){var l;const c=this._renderer.getClearColor(new n.Ilk),u=this._renderer.getClearAlpha();this._renderer.setClearColor(new n.Ilk(null!=e?e:c.r,null!=t?t:c.g,null!=i?i:c.b),null!=r?r:u);const d=this._renderer.getRenderTarget(),h=this._renderer.getActiveCubeFace(),p=this._renderer.getActiveMipmapLevel();s&&"function"==typeof s.clear?s.clear(this._renderer,!0,o,a):(this._renderer.setRenderTarget(null!==(l=s)&&void 0!==l?l:null),this._renderer.clear(!0,o,a)),this._renderer.setRenderTarget(d,h,p),this._renderer.setClearColor(c,u)}renderModel(e,t){this._renderer.render(e.modelObject,t.cameraObject)}renderScene(e){const t=e.activeCamera;t&&this.renderModel(e,t)}_updated(){this.dispatchEvent({type:"update"})}render(e){var t;this._passesNeedsUpdate&&this.refreshPasses();for(const n of this._passes)n.passObject.enabled&&(null===(t=n.update)||void 0===t||t.call(n));e=null!=e?e:this.defaultRenderToScreen,this._composer.renderToScreen=e,this._composer.render(),this._composer.renderToScreen=!0,e&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex((e=>e.dirty))>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const t of this._pipeline){const n=this._passes.find((e=>e.passId===t));n?e.push(n.passObject):console.warn("WebGi BaseRenderer: Unable to find pass: ",t)}[...this._composer.passes].forEach((e=>this._composer.removePass(e))),e.forEach((e=>this._composer.addPass(e))),this._updated()}dispose(){this._trackedTargets.forEach((e=>e.dispose())),this._trackedTargets=[],this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const t=this._trackedTargets.indexOf(e);t>=0&&this._trackedTargets.splice(t,1)}createTarget({sizeMultiplier:e,samples:t=0,colorSpace:i=n.aCh,type:r=n.ywz,format:s=n.wk1,depthBuffer:o=!0,depthTexture:a=!1,depthTextureType:l=n.JQ4,depthTextureFormat:c=n.qkB,size:u,textureCount:d=1,...h}={},p=!0){this.isWebGL2||(t=0),void 0!==e&&void 0!==u&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(u=u||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1))).width=Math.floor(u.width),u.height=Math.floor(u.height);const f=a?new n.$YQ(u.width,u.height,l):void 0;f&&(f.format=c);const m=this.createTargetCustom(d>1?{width:u.width,height:u.height,count:d}:u,{samples:t,colorSpace:i,type:r,format:s,depthBuffer:o,depthTexture:f},d>1?n.kFz:n.dd2);return this._processNewTarget(m,e,p),this._setTargetOptions(m,h),m}_processNewTarget(e,t,n){return void 0!==t&&(e.sizeMultiplier=t),n&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:t,count:i},r={},s){var o;const a=this._processNewTarget,l=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let c=[e,t];if(i&&i>1&&c.push(i),(null==s?void 0:s.prototype)===n.oAp.prototype){if(e!==t)throw"Width and height of cube render target must be equal";c=[e]}r={format:n.wk1,minFilter:n.wem,magFilter:n.wem,generateMipmaps:!1,type:n.ywz,colorSpace:n.aCh,...r};const u=[this,...c,r];return new class extends(null!==(o=s)&&void 0!==o?o:n.dd2){constructor(e,...t){super(...t),this.renderer=e,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach((e=>{e.__target=this,e.userData||(e.userData={}),e.colorSpace=r.colorSpace,e.toJSON=()=>(console.warn("WebGi RenderTarget: Multiple render target texture.toJSON not supported yet."),{})})):(this.texture.userData||(this.texture.userData={}),this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(e){console.warn("WebGi RenderTarget: Render target texture.toJSON might be buggy."),this.source.data.url=l(this.__target,"image/png",90);const t=this.__toJSON.call(this,e);return delete this.source.data.url,t.isRenderTargetTexture=!0,t})}setSize(e,t,n){super.setSize(Math.floor(e),Math.floor(t),n)}clone(e=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const t=super.clone();return t.texture.isRenderTargetTexture=!0,a(t,this.sizeMultiplier||1,e)}}(...u)}getTempTarget(e={}){var t;const n=me(e);let i;return(null===(t=this._tempTargets[n])||void 0===t?void 0:t.length)&&(i=this._tempTargets[n].pop()),i?this._setTargetOptions(i,e):(i=this.createTarget(e),this._processNewTempTarget(i,n)),i}_processNewTempTarget(e,t){return e.isTemporary=!0,e.targetKey=t,void 0===this._tempTargets[t]&&(this._tempTargets[t]=[]),e}releaseTempTarget(e){const t=e.targetKey;if(!t||!e.isTemporary)throw"Not a temp target";this._tempTargets[t].length>this.maxTempPerKey?(this.removeTrackedTarget(e),e.dispose()):this._tempTargets[t].push(e)}updateShaderProperties(e){return this.stableNoise?e.uniforms.frameCount?e.uniforms.frameCount.value=this._totalFrameCount:console.warn("WebGi BaseRenderer: no uniform: frameCount"):e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("WebGi BaseRenderer:  no uniform: frameCount"),e.uniforms.frameCount2&&(e.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(e,t){var i,r,s;e.texture.minFilter=null!==(i=t.minFilter)&&void 0!==i?i:n.wem,e.texture.magFilter=null!==(r=t.magFilter)&&void 0!==r?r:n.wem,e.texture.generateMipmaps=null!==(s=t.generateMipmaps)&&void 0!==s&&s,e.texture.generateMipmaps&&e.texture.minFilter===n.wem&&(e.texture.minFilter=n.FDw),e.texture.generateMipmaps||e.texture.minFilter!==n.FDw||(e.texture.minFilter=n.wem)}renderTargetToDataUrl(e,t="image/png",i=90,r=0){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const o=s.getContext("2d");if(!o)throw new Error("Unable to get 2d context");const a=Array.isArray(e.texture)?e.texture[r]:e.texture,l=o.createImageData(e.width,e.height,{colorSpace:["display-p3","srgb"].includes(a.colorSpace)?a.colorSpace:void 0});if(a.type===n.cLu){const t=new Uint16Array(e.width*e.height*4);this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,t,void 0,r),$({data:t,width:e.width,height:e.height},a.colorSpace,l)}else if(a.type===n.VzW){const t=new Float32Array(e.width*e.height*4);this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,t,void 0,r),$({data:t,width:e.width,height:e.height},a.colorSpace,l)}else this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,l.data,void 0,r);o.putImageData(l,0,0);const c=s.toDataURL(t,i);return s.remove(),c}renderTargetToBuffer(e,t=0){const i=(Array.isArray(e.texture)?e.texture[t]:e.texture).type===n.cLu?new Uint16Array(e.width*e.height*4):new Uint8Array(e.width*e.height*4);return this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,i,void 0,t),i}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(e){this.rendererObject.useLegacyLights=e,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(e){console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=e}get renderScale(){return this.displayCanvasScaling}set renderScale(e){this.displayCanvasScaling=e}};function me(e={}){var t,n;return[e.sizeMultiplier,e.samples,e.colorSpace,e.type,e.format,e.depthBuffer,e.depthTexture,null===(t=e.size)||void 0===t?void 0:t.width,null===(n=e.size)||void 0===n?void 0:n.height].join(";")}function ge(e){var t,i,r,s,o,a,l,c;if(!e.isMaterial&&!e.isBufferGeometry)return;const u=Array.from(e.userData.__appliedMeshes).filter((e=>!e.isInstancedMesh&&!!e.parent&&0===e.children.length&&!Array.isArray(e.material)));if(u.length<2)return;const d=e=>{var t;return e.parent.uuid+"_"+e.geometry.uuid+"_"+(null===(t=e.material)||void 0===t?void 0:t.uuid)},h=new Map;for(const n of u){const e=d(n);h.has(e)||h.set(e,[]),h.get(e).push(n),n.updateMatrix()}const p=h.keys();for(const f of p){const e=h.get(f),u=e[0];if(!u)continue;if(e.length<2)continue;const d=new n.SPe(u.geometry,u.material,e.length),p=u.userData;u.userData={},d.copy(u),Ee(d.userData,p);const m=u.parent;d.position.set(0,0,0),d.rotation.set(0,0,0),d.scale.set(1,1,1),d.updateMatrix();const g=new Float32Array(3*d.count),_=new Float32Array(4*d.count),v=new Float32Array(3*d.count);for(let n=0;n<e.length;n++){const l=e[n],c=l.matrix;c.determinant()<0&&(c.elements[0]*=-1,c.elements[1]*=-1,c.elements[2]*=-1),d.setMatrixAt(n,c),l.position.toArray(g,3*n),l.quaternion.toArray(_,4*n),l.scale.toArray(v,3*n),l.removeFromParent(),null===(r=null===(i=null===(t=l.material)||void 0===t?void 0:t.userData)||void 0===i?void 0:i.__appliedMeshes)||void 0===r||r.delete(l),null===(a=null===(o=null===(s=l.geometry)||void 0===s?void 0:s.userData)||void 0===o?void 0:o.__appliedMeshes)||void 0===a||a.delete(l)}null===(c=null===(l=d.material.userData)||void 0===l?void 0:l.__appliedMeshes)||void 0===c||c.add(d),d.geometry.userData.__appliedMeshes.add(d),d.sourceTrs={TRANSLATION:new n.TlE(g,3),ROTATION:new n.TlE(_,4),SCALE:new n.TlE(v,3)},d.instanceMatrix.needsUpdate=!0,m.add(d),m.setDirty()}}pe([re()],fe.prototype,"stableNoise",void 0),pe([re()],fe.prototype,"useLegacyLights",null),fe=pe([de("RenderManager")],fe);class _e{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,r=e;let s=r.sourceTrs;if(!s){const e=new Float32Array(3*r.count),t=new Float32Array(4*r.count),i=new Float32Array(3*r.count),o=new n.yGw,a=new n.Pa4,l=new n._fP,c=new n.Pa4;for(let n=0;n<r.count;n++)r.getMatrixAt(n,o),o.decompose(a,l,c),a.toArray(e,3*n),l.toArray(t,4*n),c.toArray(i,3*n);s={TRANSLATION:new n.TlE(e,3),ROTATION:new n.TlE(t,4),SCALE:new n.TlE(i,3)}}s={TRANSLATION:i.processAccessor(s.TRANSLATION),ROTATION:i.processAccessor(s.ROTATION),SCALE:i.processAccessor(s.SCALE)},r.instanceColor&&(s.COLOR=i.processAccessor(new n.TlE(r.instanceColor.array,3))),i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0,t.extensions=t.extensions||{},t.extensions[this.name]={attributes:s}}}function ve(e,t){if(e.uiConfig)return e.uiConfig;const i={type:"folder",label:()=>e.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[e,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{e.dispatchEvent({type:"select",ui:!0,value:e,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!e.parent,value:()=>{const t=e.parent;t&&t.dispatchEvent({type:"select",ui:!0,value:t})}},{type:"input",label:"Name",property:[e,"name"],onChange:t=>{var n;t.last&&(null===(n=e.setDirty)||void 0===n||n.call(e,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!e.isMesh,property:[e,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!e.isMesh,property:[e,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[e,"frustumCulled"]},{type:"vec3",label:"Position",property:[e,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[e,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[e,"scale"]},{type:"input",label:"Render Order",property:[e,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",e.userData.autoScaleRadius||"2",!0],value:t=>{if(!t)return;const n=parseFloat(t);Math.abs(n)>0&&W(e,n)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&Q(e)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map((t=>({type:"button",label:"Rotate "+t+"90",value:()=>{var i;e.rotateOnAxis(new n.Pa4(t.includes("X")?1:0,t.includes("Y")?1:0,t.includes("Z")?1:0),Math.PI/2*(t.includes("-")?-1:1)),null===(i=e.setDirty)||void 0===i||i.call(e,{sceneUpdate:!0,refreshUi:!1})}})))},void 0!==e.userData.license?{type:"input",label:"License/Credits",property:[e.userData,"license"],limitedUi:!0}:{}]},r=e;if((null==r?void 0:r.isMesh)&&!1!==t){const t=[()=>{const t=Object.entries(r.morphTargetDictionary||{});return t.length?{label:"Morph Targets",type:"folder",children:t.map((([t,n])=>({type:"slider",label:t,bounds:[0,1],stepSize:1e-4,property:[r.morphTargetInfluences,n],onChange:t=>{var n;null===(n=e.setDirty)||void 0===n||n.call(e,{sceneUpdate:t.last,frameFade:!1,refreshUi:!1})}})))}:void 0},()=>{var e;return null===(e=r.geometry)||void 0===e?void 0:e.uiConfig},()=>{var e;return Array.isArray(r.material)?r.material.length<1?void 0:{label:"Materials",type:"folder",children:r.material.map((e=>null==e?void 0:e.uiConfig)).filter((e=>e))}:null===(e=r.material)||void 0===e?void 0:e.uiConfig}];i.children.push(...t)}if(null==e?void 0:e.isCamera){const t=[{type:"button",label:"Set View",value:()=>{var t;e.dispatchEvent({type:"setView",ui:!0,camera:e}),null===(t=i.uiRefresh)||void 0===t||t.call(i,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var t;return null===(t=e.userData.iCamera)||void 0===t?void 0:t.isActiveCamera},value:()=>{var t;e.dispatchEvent({type:"activateMain",ui:!0,camera:e}),null===(t=i.uiRefresh)||void 0===t||t.call(i,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var t;return!(null===(t=e.userData.iCamera)||void 0===t?void 0:t.isActiveCamera)},value:()=>{var t;e.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),null===(t=i.uiRefresh)||void 0===t||t.call(i,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>{var t;return null!==(t=e.userData.autoLookAtTarget)&&void 0!==t&&t},setValue:t=>{var n;e.userData.autoLookAtTarget=t,null===(n=i.uiRefresh)||void 0===n||n.call(i,"postFrame",!0)}}];i.children.push(...t)}return e.uiConfig=i,i}function ye(e,t,n){var i;if(!e)return void console.warn("WebGi: setupIModel: object is undefined");if(e.__disposed&&(console.warn("WebGi: re-init/re-add disposed object, things might not work as intended",e),delete e.__disposed),e.userData||(e.userData={}),e.userData.__iModelSetup&&e.modelObject)return e;e.userData.__iModelSetup=!0;let r=[];r.push((()=>{[...e.children].forEach((t=>{var n;null===(n=null==t?void 0:t.dispose)||void 0===n||n.call(t),e.add(t)})),e.parent&&e.removeFromParent()})),e.isLight&&!e.assetType?(e.assetType="light",e.lightObject=e):e.isCamera?(e.assetType="camera",e.cameraObject=e):e.assetType||(e.assetType="model"),e.modelObject||(e.modelObject=e),e.setDirty||(e.setDirty=(t={})=>{e.dispatchEvent({...t,type:"objectUpdate",object:e})},e.userData.setDirty&&console.warn("WebGi: userData.setDirty already defined",e.userData.setDirty,e),e.userData.setDirty=t=>{var n;console.warn("WebGi: userData.setDirty is deprecated, use setDirty directly"),null===(n=e.setDirty)||void 0===n||n.call(e,t)}),e.addEventListener("added",(t=>{var n,i,r;const s=null!==(i=null===(n=e.parent)||void 0===n?void 0:n.userData.parentRoot)&&void 0!==i?i:e.parent;s!==e.userData.parentRoot&&e.traverse((e=>{e.userData.parentRoot=s})),null===(r=e.setDirty)||void 0===r||r.call(e,{change:"addedToParent"})})),e.addEventListener("removed",(()=>{var t;null===(t=e.setDirty)||void 0===t||t.call(e,{change:"removedFromParent"}),void 0!==e.userData.parentRoot&&e.traverse((e=>{e.userData.parentRoot=void 0}))})),r.push((()=>{}));const s=e.dispose;e.dispose=()=>{e.dispatchEvent({type:"dispose"}),null==s||s.call(e)},e.userData.dispose&&console.warn("WebGi: userData.dispose already defined"),e.userData.dispose=()=>{var t;console.warn("WebGi: userData.dispose is deprecated, use dispose directly"),null===(t=e.dispose)||void 0===t||t.call(e)};const o=e;!o.isMesh&&!o.isLine||o.userData.__meshSetup||(o.userData.__meshSetup=!0,o.setMaterial||(o.setMaterial=e=>be(o,e)),o.setGeometry||(o.setGeometry=(e,t=!1)=>Ae(o,e,t),o.setGeometry(o.geometry,!0)),e.userData.setMaterial&&console.warn("WebGi: userData.setMaterial already defined"),e.userData.setMaterial=t=>{var n;console.warn("WebGi: userData.setMaterial is deprecated, use setMaterial directly"),null===(n=e.setMaterial)||void 0===n||n.call(e,t)},e.userData.setGeometry&&console.warn("WebGi: userData.setGeometry already defined"),e.userData.setGeometry=(t,...n)=>{var i;console.warn("WebGi: userData.setGeometry is deprecated, use setGeometry directly"),null===(i=e.setGeometry)||void 0===i||i.call(e,t,...n)},e.userData.__keepShadowDef||(e.castShadow=!0,e.receiveShadow=!0,e.userData.__keepShadowDef=!0),r.push((()=>{var e,t,n,i;const r=(null===(e=o.setMaterial)||void 0===e?void 0:e.call(o,void 0))||[],s=null===(t=o.setGeometry)||void 0===t?void 0:t.call(o,void 0);for(const o of r)o&&o.userData&&!1!==o.userData.disposeOnIdle&&o.dispose();s&&s.userData&&!1!==s.userData.disposeOnIdle&&s.dispose(),null===(n=o.setMaterial)||void 0===n||n.call(o,r),null===(i=o.setGeometry)||void 0===i||i.call(o,s)}))),e.uiConfig||"model"!==e.assetType&&"camera"!==e.assetType||(ve(e),r.push((()=>{}))),e.addEventListener("objectUpdate",(({refreshUi:t})=>{var n,i;return!1!==t&&(null===(i=null===(n=e.uiConfig)||void 0===n?void 0:n.uiRefresh)||void 0===i?void 0:i.call(n,"postFrame",!0,1))})),e.userData.__autoParentDispatchEvents?console.warn("WebGi: object.userData.__autoParentDispatchEvents already set"):(e.userData.__autoParentDispatchEvents=e.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],e.isCamera&&e.userData.__autoParentDispatchEvents.push("activateMain","setView")),t&&(e.userData.parentRoot=t);const a=e.dispatchEvent;e.dispatchEvent=t=>{var n;(null===(n=e.userData.__autoParentDispatchEvents)||void 0===n?void 0:n.includes(t.type))&&(t.parentDispatch=!0),t.parentDispatch&&(t=>{var n;const i=null!==(n=e.userData.parentRoot)&&void 0!==n?n:e.parent;(null==i?void 0:i.modelObject)&&i.dispatchEvent(t)})(t),a.call(e,t)};const l=e.clone;e.clone=(...t)=>{const i=e.userData;e.userData={};let r=l.call(e,...t);e.userData=i,Ee(r.userData,i);const s=e.userData.parentRoot;return s&&"model"!==s.assetType&&console.warn("WebGi: Cloning an object with a parent that is not an IModel is not supported"),r=ye(r,s,n),r.userData.cloneParent=e.uuid,r};const c=e.copy;e.copy=(t,...n)=>{const i=t.userData;t.userData={};const r=c.call(e,t,...n);return t.userData=i,Ee(e.userData,t),r};const u=e.add;return e.add=(...t)=>(t.forEach((t=>ye(t,e.userData.parentRoot||e,n))),u.call(e,...t)),(e=null!==(i=null==n?void 0:n(e))&&void 0!==i?i:e).addEventListener("dispose",(()=>{r.forEach((e=>e())),r=[]})),[...e.children].forEach((t=>ye(t,e,n))),e}function be(e,t){var n,i,r,s,o;const a=(Array.isArray(t)?t:[t]).map((e=>null==e?void 0:e.materialObject)).filter((e=>e));if(e.material==a||1===a.length&&e.material===a[0])return[];e.userData.__materialUpdater||(e.userData.__materialUpdater=()=>{e.dispatchEvent({type:"materialUpdate"})}),e.userData.__textureUpdater||(e.userData.__textureUpdater=()=>{e.dispatchEvent({type:"textureUpdate"})});const l=Array.isArray(e.material)?[...e.material]:[e.material];for(const u of l)u&&(u.removeEventListener("materialUpdate",e.userData.__materialUpdater),u.removeEventListener("textureUpdate",e.userData.__textureUpdater),null===(i=null===(n=u.userData)||void 0===n?void 0:n.__appliedMeshes)||void 0===i||i.delete(e));const c=[];for(const u of a)u.userData.__appliedMeshes||(u.userData.__appliedMeshes=new Set),c.push(u),u&&(u.addEventListener("materialUpdate",e.userData.__materialUpdater),u.addEventListener("textureUpdate",e.userData.__textureUpdater),u.userData.__appliedMeshes.add(e));return e.material=1!==c.length?c:null!==(r=c[0])&&void 0!==r?r:void 0,e.dispatchEvent({type:"materialChanged",material:t,mesh:e}),null===(o=null===(s=e.uiConfig)||void 0===s?void 0:s.uiRefresh)||void 0===o||o.call(s,"postFrame",!0),l}function Ae(e,t,i=!1){var r,s,o,a,l,c,u;e.userData.__objectUpdater||(e.userData.__objectUpdater=t=>{e.dispatchEvent({...t,type:"objectUpdate"})});let d=e.geometry;const h=d;return(d!==t||i)&&(d&&(d.removeEventListener("geometryUpdate",e.userData.__objectUpdater),null===(s=null===(r=d.userData)||void 0===r?void 0:r.__appliedMeshes)||void 0===s||s.delete(e)),d=t,d&&!d.userData.__appliedMeshes&&(d.userData.__appliedMeshes=new Set),e.geometry=null!==(o=d)&&void 0!==o?o:void 0,d&&(e.updateMorphTargets(),d.addEventListener("geometryUpdate",e.userData.__objectUpdater),null===(l=null===(a=d.userData)||void 0===a?void 0:a.__appliedMeshes)||void 0===l||l.add(e))),t&&!t.uiConfig&&(t.uiConfig=function(e){return{label:"Geometry",type:"folder",children:[{type:"input",property:[e,"uuid"],disabled:!0},{type:"input",property:[e,"name"]},{type:"button",label:"Center Geometry",value:()=>{e.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const t=new n.Pa4;e.center(t),t.negate();const i=e.userData.__appliedMeshes;for(const e of i)e.updateMatrix(),e.position.copy(t).applyMatrix4(e.matrix),e.setDirty&&e.setDirty()}},{type:"button",label:"Compute vertex normals",value:()=>{e.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{e.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{e.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!e.index,value:()=>{var t;if(e.attributes.index)return;const n=parseFloat(null!==(t=prompt("Tolerance","-1"))&&void 0!==t?t:"-1");q(e,n)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!e.index,value:()=>{e.attributes.index&&e.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{e.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||e.setAttribute("uv1",e.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!e.hasAttribute("color"),value:()=>{e.hasAttribute("color")?confirm("Remove color attribute?")&&e.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!e.userData.__appliedMeshes||e.userData.__appliedMeshes.size<2,value:()=>{ge(e)}},{type:"input",label:"Mesh count",get value(){var t,n,i;return null!==(i=null===(n=null===(t=e.userData)||void 0===t?void 0:t.__appliedMeshes)||void 0===n?void 0:n.size)&&void 0!==i?i:0},set value(e){},disabled:!0}]}}(e.geometry)),e.dispatchEvent({type:"geometryChanged",geometry:t}),null===(u=null===(c=e.uiConfig)||void 0===c?void 0:c.uiRefresh)||void 0===u||u.call(c,"postFrame",!0),h===d?void 0:h||void 0}const we=["appliedMeshes"],xe=["parentRoot","iCamera","iModel"];function Ee(e,t){if(t)for(const n of Object.keys(t))xe.includes(n)||n.startsWith("__")||"function"!=typeof e[n]&&"function"!=typeof t[n]&&(e[n]=t[n]);return e}var Ce,Se=new Uint8Array(16);function Me(){if(!Ce&&!(Ce="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ce(Se)}for(var Te=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Ie=[],Pe=0;Pe<256;++Pe)Ie.push((Pe+256).toString(16).substr(1));var Re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Ie[e[t+0]]+Ie[e[t+1]]+Ie[e[t+2]]+Ie[e[t+3]]+"-"+Ie[e[t+4]]+Ie[e[t+5]]+"-"+Ie[e[t+6]]+Ie[e[t+7]]+"-"+Ie[e[t+8]]+Ie[e[t+9]]+"-"+Ie[e[t+10]]+Ie[e[t+11]]+Ie[e[t+12]]+Ie[e[t+13]]+Ie[e[t+14]]+Ie[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Te.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n},De=function(e,t,n){var i=(e=e||{}).random||(e.rng||Me)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return Re(i)};const ke=new Map;function Be(e,t){return(n,i)=>{const r=n.constructor;if(r===Object)throw new Error("All properties in an object are serialized by default");ke.has(r)||ke.set(r,[]);const s=ke.get(r);if(!(s.findIndex((e=>e.propKey===i))<0))throw new Error(`Property ${i} already has a uiConfig decorator`);s.push({params:t||{},propKey:i,uiType:e})}}function Oe(e,t){return Be("checkbox",{label:e,params:t})}function Le(e,t){return Be("monitor",{label:e,params:t})}function Ue(e,t,n,i){return Be("slider",{label:e,bounds:t,stepSize:n,params:i})}function Ne(e,t,n,i){return Be("vec",{label:e,bounds:t,stepSize:n,params:i})}function Fe(e,t,n){return Be("dropdown",{label:e,children:t,params:n})}function je(e,t){return Be("button",{label:e,params:t})}function ze(e,t){return Be("input",{label:e,params:t})}function Ge(e,t){return Be("color",{label:e,params:t})}function Ve(e,t){return Be("image",{label:e,params:t})}function He(e){let t=null==e?void 0:e.constructor;if(!e||!t)return[];const n=[],i=[];for(;t&&t!==Object;)i.push(t),t=Object.getPrototypeOf(t);if(!i.length||Array.isArray(e)){const t="object"==typeof e?Object.keys(e):Array.isArray(e)?e.map(((e,t)=>t)):[];for(const i of t){const t=e[i];if(null==t)continue;const r=null==t?void 0:t.uiConfig;if(r)n.push(r);else{const r=Xe(t);"folder"===r?n.push(Qe(i+"",t,void 0,"folder",!0)):r&&n.push({type:r,label:i+"",property:[e,i]})}}}return i.reverse().forEach((t=>{var i;null===(i=ke.get(t))||void 0===i||i.forEach((({params:t,propKey:i,uiType:r})=>{let s;if(!r){const t=e[i];s=null==t?void 0:t.uiConfig,s?n.push(s):null!=t&&("folder"===(r=Xe(t))?s=Qe(i+"",t,void 0,"folder",!0):r&&(s={type:r,label:i+"",property:[e,i]}))}if(s||(s={property:[e,i],type:r||"input"}),t){const n="function"==typeof t.params?t.params(e):t.params||{};delete t.params,Object.assign(s,{...t,...n})}n.push(s)}))})),n}function Qe(e,t,n={},i="folder",r=!1){return{type:i,label:e,children:r?[()=>He(t)]:He(t),uuid:De(),...n}}function We(e,t,n="folder"){return i=>class extends i{constructor(){super(...arguments),this.uiConfig=Qe(e,this,t||{},n)}}}function qe(e,t){return We(e,t,"panel")}function Xe(e){return null==e?null:Array.isArray(e)?"folder":"boolean"==typeof e?"checkbox":"number"==typeof e?"number":"string"==typeof e?"input":"function"==typeof e?"button":"number"==typeof e.x?"vec":"number"==typeof e.r?"color":e.isTexture?"image":"object"==typeof e?"folder":null}const Ye={type:"change"},Ke={type:"start"},Je={type:"end"};class Ze extends n.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new n.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new n.Pa4(1/0,1/0,1/0),this.clampMin=new n.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n.RsA.ROTATE,MIDDLE:n.RsA.DOLLY,RIGHT:n.RsA.PAN},this.touches={ONE:n.QmN.ROTATE,TWO:n.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",V),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",V),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Ye),i.update(),s=r.NONE},this.update=function(){const t=new n.Pa4,h=(new n._fP).setFromUnitVectors(e.up,new n.Pa4(0,1,0)),p=h.clone().invert(),f=new n.Pa4,m=new n._fP,g=new n.Pa4,_=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(h),a.setFromVector3(t),i.autoRotate&&s===r.NONE&&E(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let n=i.minAzimuthAngle,v=i.maxAzimuthAngle;isFinite(n)&&isFinite(v)&&(n<-Math.PI?n+=_:n>Math.PI&&(n-=_),v<-Math.PI?v+=_:v>Math.PI&&(v-=_),a.theta=n<=v?Math.max(n,Math.min(v,a.theta)):a.theta>(n+v)/2?Math.max(n,a.theta):Math.min(v,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),Math.abs(l.radius)>0&&(i.dollyZoom&&(i.object.zoom=Math.max(Math.max(i.minZoom,.1),Math.min(Math.min(i.maxZoom,20),i.object.zoom*(1+l.radius*(i.enableDamping?i.dampingFactor:1)))),i.object.updateProjectionMatrix(),(i.object.zoom>=Math.min(i.maxZoom,20)||i.object.zoom<=Math.max(i.minZoom,.1))&&(l.radius=0)),a.radius*=1+l.radius*(i.enableDamping?i.dampingFactor:1)),Math.abs(c-1)>1e-5&&(i.dollyZoom&&(i.object.zoom=Math.max(Math.max(i.minZoom,.1),Math.min(Math.min(i.maxZoom,20),i.object.zoom*c)),i.object.updateProjectionMatrix(),(i.object.zoom>=Math.min(i.maxZoom,20)||i.object.zoom<=Math.max(i.minZoom,.1))&&(c=1)),a.radius*=c);let y=0;i.autoPushTarget&&a.radius<i.minDistance&&(y=i.minDistance-a.radius),i.autoPullTarget&&a.radius>i.maxDistance&&(y=i.maxDistance-a.radius),a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),t.setFromSpherical(a),t.applyQuaternion(p),e.copy(i.target).add(t),i.target.add(t.normalize().multiplyScalar(-y)),e.clamp(i.clampMin,i.clampMax),i.target.clamp(i.clampMin,i.clampMax),i.object.lookAt(i.target);let b=!1;return!0===i.enableDamping&&Math.abs(l.theta)+Math.abs(l.phi)+Math.abs(l.radius)+u.length()>.001?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,l.radius*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor),b=!0):(l.set(0,0,0),u.set(0,0,0)),c=1,!!(d||b||f.distanceToSquared(i.object.position)>o||8*(1-m.dot(i.object.quaternion))>o||g.distanceToSquared(i.target)>0)&&(i.dispatchEvent(Ye),f.copy(i.object.position),m.copy(i.object.quaternion),g.copy(i.target),d=!1,!0)}}(),this.stopDamping=function(){l.set(0,0,0),u.set(0,0,0)},this.dispose=function(){i.domElement.removeEventListener("contextmenu",H),i.domElement.removeEventListener("pointerdown",F),i.domElement.removeEventListener("pointercancel",z),i.domElement.removeEventListener("wheel",G),i.domElement.removeEventListener("pointermove",j),i.domElement.removeEventListener("pointerup",z),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",V),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,a=new n.$V,l=new n.$V(0,0,0);let c=1;const u=new n.Pa4;let d=!1;const h=new n.FM8,p=new n.FM8,f=new n.FM8,m=new n.FM8,g=new n.FM8,_=new n.FM8,v=new n.FM8,y=new n.FM8,b=new n.FM8,A=[],w={};function x(){return i.enableDamping?1:Math.pow(.95,i.zoomSpeed)}function E(e){l.theta-=e}function C(e){l.phi-=e}this.rotateUp=C,this.rotateLeft=E;const S=function(){const e=new n.Pa4;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),u.add(e)}}(),M=function(){const e=new n.Pa4;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),u.add(e)}}(),T=function(){const e=new n.Pa4;return function(t,n){const r=i.domElement;if(i.object.isPerspectiveCamera){const s=i.object.position;e.copy(s).sub(i.target);let o=e.length();o*=Math.tan(i.object.fov/2*Math.PI/180),S(2*t*o/r.clientHeight,i.object.matrix),M(2*n*o/r.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(S(t*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),M(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function I(e,t=0){i.object.isPerspectiveCamera?(c/=e,l.radius=Math.max(-i.maxZoomSpeed,Math.min(i.maxZoomSpeed,l.radius-t))):i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function P(e,t=0){i.object.isPerspectiveCamera?(c*=e,l.radius=Math.max(-i.maxZoomSpeed,Math.min(i.maxZoomSpeed,l.radius+t))):i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function R(e){h.set(e.clientX,e.clientY)}function D(e){m.set(e.clientX,e.clientY)}function k(){if(1===A.length)h.set(A[0].pageX,A[0].pageY);else{const e=.5*(A[0].pageX+A[1].pageX),t=.5*(A[0].pageY+A[1].pageY);h.set(e,t)}}function B(){if(1===A.length)m.set(A[0].pageX,A[0].pageY);else{const e=.5*(A[0].pageX+A[1].pageX),t=.5*(A[0].pageY+A[1].pageY);m.set(e,t)}}function O(){const e=A[0].pageX-A[1].pageX,t=A[0].pageY-A[1].pageY,n=Math.sqrt(e*e+t*t);v.set(0,n)}function L(e){if(1==A.length)p.set(e.pageX,e.pageY);else{const t=W(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);p.set(n,i)}f.subVectors(p,h).multiplyScalar(i.rotateSpeed);const t=i.domElement;E(2*Math.PI*f.x/t.clientHeight),C(2*Math.PI*f.y/t.clientHeight),h.copy(p)}function U(e){if(1===A.length)g.set(e.pageX,e.pageY);else{const t=W(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);g.set(n,i)}_.subVectors(g,m).multiplyScalar(i.panSpeed),T(_.x,_.y),m.copy(g)}function N(e){const t=W(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);y.set(0,s),b.set(0,Math.pow(y.y/v.y,6*i.zoomSpeed)),I(b.y),v.copy(y)}function F(e){!1!==i.enabled&&(0===A.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",j),i.domElement.addEventListener("pointerup",z)),function(e){A.push(e)}(e),"touch"===e.pointerType?function(e){switch(Q(e),A.length){case 1:switch(i.touches.ONE){case n.QmN.ROTATE:if(!1===i.enableRotate)return;k(),s=r.TOUCH_ROTATE;break;case n.QmN.PAN:if(!1===i.enablePan)return;B(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(i.touches.TWO){case n.QmN.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&O(),i.enablePan&&B(),s=r.TOUCH_DOLLY_PAN;break;case n.QmN.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&O(),i.enableRotate&&k(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(Ke)}(e):function(e){let t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.RsA.DOLLY:if(!1===i.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(e),s=r.DOLLY;break;case n.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;D(e),s=r.PAN}else{if(!1===i.enableRotate)return;R(e),s=r.ROTATE}break;case n.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;R(e),s=r.ROTATE}else{if(!1===i.enablePan)return;D(e),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(Ke)}(e))}function j(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(Q(e),s){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;L(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;U(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&N(e),i.enablePan&&U(e)}(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&N(e),i.enableRotate&&L(e)}(e),i.update();break;default:s=r.NONE}}(e):e.buttons?function(e){switch(s){case r.ROTATE:if(!1===i.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),f.subVectors(p,h).multiplyScalar(i.rotateSpeed);const t=i.domElement;E(2*Math.PI*f.x/t.clientHeight),C(2*Math.PI*f.y/t.clientHeight),h.copy(p),i.update()}(e);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,v),b.y>0?I(x()):b.y<0&&P(x()),v.copy(y),i.update()}(e);break;case r.PAN:if(!1===i.enablePan)return;!function(e){g.set(e.clientX,e.clientY),_.subVectors(g,m).multiplyScalar(i.panSpeed),T(_.x,_.y),m.copy(g),i.update()}(e)}}(e):z(e))}function z(e){!function(e){delete w[e.pointerId];for(let t=0;t<A.length;t++)if(A[t].pointerId==e.pointerId)return void A.splice(t,1)}(e),0===A.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",j),i.domElement.removeEventListener("pointerup",z)),i.dispatchEvent(Je),s=r.NONE}function G(e){!1!==i.enabled&&!1!==i.enableZoom&&s===r.NONE&&(e.preventDefault(),i.dispatchEvent(Ke),function(e){let t=0;switch(e.deltaMode){case 2:t+=1*e.deltaY;break;case 1:t+=.4*e.deltaY;break;default:t+=.01*e.deltaY}e.deltaY<0?P(1,t*i.zoomSpeed):e.deltaY>0&&I(1,-t*i.zoomSpeed),i.update()}(e),i.dispatchEvent(Je))}function V(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?C(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?C(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?E(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?E(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function H(e){!1!==i.enabled&&e.preventDefault()}function Q(e){let t=w[e.pointerId];void 0===t&&(t=new n.FM8,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function W(e){const t=e.pointerId===A[0].pointerId?A[1]:A[0];return w[t.pointerId]}this.zoomIn=function(e){I(1,e*i.zoomSpeed)},this.zoomOut=function(e){P(1,e*i.zoomSpeed)},i.domElement.addEventListener("contextmenu",H),i.domElement.addEventListener("pointerdown",F),i.domElement.addEventListener("pointercancel",z),i.domElement.addEventListener("wheel",G,{passive:!1}),this.update()}}var $e=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let et=class extends Ze{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new n.Pa4(-1e4,-1e4,-1e4),this.clampMax=new n.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(e){super.zoomIn(e)}zoomOut(e){super.zoomOut(e)}dispatchEvent(e){super.dispatchEvent(e)}};$e([re()],et.prototype,"type",void 0),$e([Oe()],et.prototype,"enabled",void 0),$e([Oe(),re()],et.prototype,"dollyZoom",void 0),$e([Oe(),re()],et.prototype,"enableDamping",void 0),$e([ze(),re()],et.prototype,"dampingFactor",void 0),$e([Oe(),re()],et.prototype,"autoRotate",void 0),$e([ze(),re()],et.prototype,"autoRotateSpeed",void 0),$e([Oe(),re()],et.prototype,"enableZoom",void 0),$e([ze(),re()],et.prototype,"zoomSpeed",void 0),$e([ze(),re()],et.prototype,"maxZoomSpeed",void 0),$e([Oe(),re()],et.prototype,"enableRotate",void 0),$e([ze(),re()],et.prototype,"rotateSpeed",void 0),$e([Oe(),re()],et.prototype,"enablePan",void 0),$e([ze(),re()],et.prototype,"panSpeed",void 0),$e([ze(),re()],et.prototype,"autoPushTarget",void 0),$e([ze(),re()],et.prototype,"autoPullTarget",void 0),$e([ze(),re()],et.prototype,"minDistance",void 0),$e([ze(),re()],et.prototype,"maxDistance",void 0),$e([ze(),re()],et.prototype,"minZoom",void 0),$e([ze(),re()],et.prototype,"maxZoom",void 0),$e([ze(),re()],et.prototype,"minPolarAngle",void 0),$e([ze(),re()],et.prototype,"maxPolarAngle",void 0),$e([ze(),re()],et.prototype,"minAzimuthAngle",void 0),$e([ze(),re()],et.prototype,"maxAzimuthAngle",void 0),$e([Ne(),re()],et.prototype,"clampMin",void 0),$e([Ne(),re()],et.prototype,"clampMax",void 0),$e([re()],et.prototype,"screenSpacePanning",void 0),$e([re()],et.prototype,"keyPanSpeed",void 0),et=$e([qe("Orbit Controls")],et);var tt=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class nt extends t.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(e){this._camera.modelObject.userData=e}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>0;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>0;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var n,i;const r={...e};(null===(n=r.position)||void 0===n?void 0:n.isVector3)&&(r.position=[r.position.x,r.position.y,r.position.z]),(null===(i=r.target)||void 0===i?void 0:i.isVector3)&&(r.target=[r.target.x,r.target.y,r.target.z]),Object.keys(r).forEach((e=>"frustumSize"!==e&&void 0===r[e]&&delete r[e])),Object.assign(this._options,r),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty({optionsUpdate:!0})}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const e="PerspectiveCamera"===this._options.type?new n.cPb:new n.iKG;e.name=this._camera.name,e.near=this._camera.modelObject.near,e.far=this._camera.modelObject.far,e.zoom=this._camera.modelObject.zoom,e.scale.copy(this._camera.modelObject.scale);const i=this._isActiveCamera;i&&this.deactivateMain(),this._camera=this._setCameraObject(e),t=this._camera.modelObject,i&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let i=this._options.aspect;if("auto"===i&&(i=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),"PerspectiveCamera"===this._options.type&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=i),"OrthographicCamera"===this._options.type){const e=this._options.frustumSize;void 0!==e?(t.top=e/2,t.bottom=-e/2,t.left=i*e/2,t.right=-i*e/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=ye(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return 0===this._interactionsDisabledBy.size&&this._isActiveCamera&&this._options.controlsEnabled&&""!==this._options.controlsMode}set interactionsEnabled(e){this.setInteractions(e,"_default")}setInteractions(e,t){const n=this._interactionsDisabledBy.size;e?this._interactionsDisabledBy.delete(t):this._interactionsDisabledBy.add(t),n!==this._interactionsDisabledBy.size&&this.refreshCameraControls(!0)}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,t,i){var r;super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=e=>{this.setDirty(e)},this._interactionsDisabledBy=new Set,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new n.Pa4(0,0,10),this._target=new n.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(e,t)=>{const n=new et(e,t.ownerDocument?t:t.documentElement);return n.screenSpacePanning=!0,n}]]),this._positionWorld=new n.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>{var e;return null===(e=this._camera.userData.autoNearFar)||void 0===e||e},setValue:e=>this._camera.userData.autoNearFar=e,onChange:()=>this.setDirty()},{type:"checkbox",label:"Auto Camera Position",getValue:()=>{var e;return null!==(e=this._camera.userData.autoCameraPosition)&&void 0!==e&&e},setValue:e=>this._camera.userData.autoCameraPosition=e,onChange:()=>this.setDirty()},{type:"input",label:()=>{var e;return null===(e=this._camera.userData.autoNearFar)||void 0===e||e?"Min Near":"Near"},getValue:()=>{var e;return null!==(e=this._camera.userData.minNearPlane)&&void 0!==e?e:.5},setValue:e=>this._camera.userData.minNearPlane=e,onChange:()=>this.setDirty()},{type:"input",label:()=>{var e;return null===(e=this._camera.userData.autoNearFar)||void 0===e||e?"Max Far":"Far"},getValue:()=>{var e;return null!==(e=this._camera.userData.maxFarPlane)&&void 0!==e?e:1e3},setValue:e=>this._camera.userData.maxFarPlane=e,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map((e=>({label:""===e?"none":e,value:e}))),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var e;return(null===(e=this._controls)||void 0===e?void 0:e.zoomIn)?{type:"button",label:"Zoom in",value:()=>{var e;null===(e=this._controls)||void 0===e||e.zoomIn(1)}}:{}},()=>{var e;return(null===(e=this._controls)||void 0===e?void 0:e.zoomOut)?{type:"button",label:"Zoom out",value:()=>{var e;null===(e=this._controls)||void 0===e||e.zoomOut(1)}}:{}},()=>{var e;return null===(e=this._controls)||void 0===e?void 0:e.uiConfig}]},this.assetType="model",this.uuid=n.M8C.generateUUID(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=null!=i?i:document.body;const s=null!==(r={...t})&&void 0!==r?r:this._options;this._camera=this._setCameraObject(null!=e?e:"OrthographicCamera"===s.type?new n.iKG(-1,1,1,-1):new n.cPb),this._camera.modelObject.userData.iCamera=this;const o=e;e&&(o.isPerspectiveCamera?(s.fov=o.fov,s.focus=o.focus,s.aspect=o.aspect<=0||o.userData.autoAspect?"auto":o.aspect,s.zoom=o.zoom):o.isOrthographicCamera&&(s.left=o.left,s.right=o.right,s.top=o.top,s.bottom=o.bottom,s.zoom=o.zoom),this.near=o.near,this.far=o.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(s)}refreshAspect(e=!0){"auto"===this._options.aspect&&this._refreshCameraOptions(e)}refreshTarget(e=4){var t;(null===(t=this._controls)||void 0===t?void 0:t.enabled)&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new n.Pa4))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,t,n;const i=this._options.controlsMode;this._controls=null!==(t=null===(e=this._controlsCtors.get(i))||void 0===e?void 0:e(this._camera.modelObject,this._container))&&void 0!==t?t:void 0,this._controls||""===i||console.error("Unable to create controls with mode "+i+". Are you missing a plugin?"),null===(n=this._controls)||void 0===n||n.addEventListener("change",this.setDirty),this._controlsMode=this._controls?i:""}_disposeCameraControls(){var e,t;this._controlsMode,null===(e=this._controls)||void 0===e||e.removeEventListener("change",this.setDirty),null===(t=this._controls)||void 0===t||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,i;if(this._options.controlsEnabled){const e=this._options.controlsMode;this._controls?this._controlsMode===e&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=e}if(this._controls){const e=this.interactionsEnabled;this._controls.enabled=e,e&&this._camera.modelObject.up.copy(n.Tme.DEFAULT_UP)}e&&this.setDirty(),null===(i=(t=this.uiConfig).uiRefresh)||void 0===i||i.call(t,"postFrame",!0)}setDirty(e){var t,n;this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),void 0!==this._camera.modelObject.fov&&(this._options.fov=this._camera.modelObject.fov),void 0!==this._camera.modelObject.focus&&(this._options.focus=this._camera.modelObject.focus),void 0!==this._camera.modelObject.zoom&&(this._options.zoom=this._camera.modelObject.zoom),null===(n=(t=this.cameraObject).updateProjectionMatrix)||void 0===n||n.call(t),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach((e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e,"postFrame",!1,1)}))}activateMain(e=!0){var t,i;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new n.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),null===(i=(t=this._camera).setDirty)||void 0===i||i.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var t,n;const i=this.target;null===(n=null===(t=this._controls)||void 0===t?void 0:t.target)||void 0===n||n.set(i.x,i.y,i.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(void 0!==this._camera.userData.autoLookAtTarget&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(i),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t,n,i,r;return null===(n=null===(t=e.uniforms.cameraPositionWorld)||void 0===t?void 0:t.value)||void 0===n||n.copy(this._positionWorld),null===(r=null===(i=e.uniforms.cameraNearFar)||void 0===i?void 0:i.value)||void 0===r||r.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA="PerspectiveCamera"===this._camera.modelObject.type?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA="OrthographicCamera"===this._camera.modelObject.type?"1":"0",this}toJSON(e){const t={};return Ee(t,this.userData),Object.assign({userData:t},le(this,!0,e))}fromJSON(e,t){return e.userData&&(Ee(this.userData,e.userData),delete(e={...e}).userData),e.camOptions&&(this.setCameraOptions(e.camOptions,!1),this.refreshCameraOptions(!1)),ce(e,this,!0,t),this.positionUpdated(!1),this.refreshCameraOptions(!1),this.setDirty({change:"deserialize"}),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}tt([re("camControls")],nt.prototype,"_controls",void 0),tt([(0,t.onChange)(nt.prototype._nearFarChanged)],nt.prototype,"near",void 0),tt([(0,t.onChange)(nt.prototype._nearFarChanged)],nt.prototype,"far",void 0),tt([re("camOptions")],nt.prototype,"_options",void 0),tt([re("position")],nt.prototype,"_position",void 0),tt([re("target")],nt.prototype,"_target",void 0);var it=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class rt extends n.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let t=this._cameras.indexOf(e);t<0&&(this._cameras.push(e),t=this._cameras.length-1),this._activeCamera=t}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get renderCamera(){var e;return null!==(e=this._renderCamera)&&void 0!==e?e:this.activeCamera}set renderCamera(e){const t=this._renderCamera;this._renderCamera=e,this.dispatchEvent({type:"renderCameraChange",lastCamera:t,camera:e})}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new p,this._modelBounds=new p,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new nt(new n.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.textureSlots={},this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._optionsUpdate=this._optionsUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=ye(new n.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new n.GQ(this.getBounds())}addModel(e,t={}){return"model"!==e.assetType&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){"widget"!==e.assetType&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(null==e?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let i=!1;switch(n){case"model":i=e.modelObject.isCamera,i&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("WebGi RootScene: Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e,options:t}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:i=!1}={}){const r=e;r?(t&&!r.userData.autoScaled&&W(r,r.userData.autoScaleRadius||n),r.traverse((e=>{e.isMesh&&!e.userData.__keepShadowDef&&(e.castShadow=!0,e.receiveShadow=!0,e.userData.__keepShadowDef=!0)})),i?this.modelObject.add(r):this.modelRoot.add(r),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach((e=>{var t,n;(null!==(t=e.dispose)&&void 0!==t?t:null===(n=e.modelObject)||void 0===n?void 0:n.removeFromParent)()})),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;(null===(e=this.environment)||void 0===e?void 0:e.mapping)===n.xfE&&(this.environment.mapping=n.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map((e=>ye(e)))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);"texture"!==e.assetType&&console.warn("Environment asset not processed",e);const t=e.textureObject||e;this.environment=t}getEnvironment(){return this.environment}setBackground(e){let t;if(!e||"texture"===e.assetType||e.isTexture||e.isColor||"environment"===e)t=("texture"===(null==e?void 0:e.assetType)||e.isTexture)&&e.textureObject||e;else{if("string"!=typeof e&&"number"!=typeof e)return void console.error("Unknown Background type",e);t=new n.Ilk(e)}this.background=t}setBackgroundColor(e){this.backgroundColor=e?new n.Ilk(e):null}getBackground(){return this.background}setDirty(e){return(null==e?void 0:e.sceneUpdate)||(null==e?void 0:e.refreshScene)?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(e){e.optionsUpdate&&this._optionsUpdate(e),this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({...e,type:"activeCameraUpdate"})}_optionsUpdate(e){if(!this.activeCamera.userData.autoCameraPosition)return;const t=(new p).expandByObject(this.modelRoot.modelObject,!1,!0),i=(t.getCenter(new n.Pa4),t.getSize(new n.Pa4));let r=this.activeCamera.cameraObject,s=1;if(r.isPerspectiveCamera){const e=Math.max(1,r.fov)*(Math.PI/180),t=2*Math.atan(Math.tan(e/2)*r.aspect),n=i.z/2+Math.abs(i.x/2/Math.tan(t/2)),o=i.z/2+Math.abs(i.y/2/Math.tan(e/2));s=1.5*Math.max(n,o)}const o=this.activeCamera.target,a=(new n.Pa4).subVectors(o,r.position).normalize();this.activeCamera.position=a.multiplyScalar(-s).add(o)}_onSceneUpdate(e={}){var t,i,r,s;return!1===e.sceneUpdate&&!1===e.refreshScene||(null===(t=e.object)||void 0===t?void 0:t.isCamera)?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),null===(s=null===(r=null===(i=this.boxHelper)||void 0===i?void 0:i.box)||void 0===r?void 0:r.copy)||void 0===s||s.call(r,this._sceneBounds),this._modelBounds=this.getModelBounds(!1,!0),this._sceneBoundingRadius=this._modelBounds.getSize(new n.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),null===(e=this.environment)||void 0===e||e.dispose()}findObjectsByName(e,t){const n=[];return(null!=t?t:this.modelObject).traverse((t=>{t.name===e&&n.push(t)})),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var n;const i=e.lightObject;i&&(null===(n=i.children)||void 0===n||n.length,t?this.add(i):this.modelRoot.add(i))}getBounds(e=!1,t=!0,n=!0,i){return(new p).expandByObject(this.modelObject,e,t,(e=>{var t;return!(!n||"widget"!==e.assetType)||null!==(t=null==i?void 0:i(e))&&void 0!==t&&t}))}getModelBounds(e=!1,t=!0,n=!0,i){return null==this.modelRoot?new p:(new p).expandByObject(this.modelRoot,e,t,(e=>{var t;return!(!n||"widget"!==e.assetType)||null!==(t=null==i?void 0:i(e))&&void 0!==t&&t}))}refreshActiveCameraNearFar(){var e,t,i,r;const s=this.activeCamera;if(!s)return;if(!1===s.cameraObject.userData.autoNearFar)return s.near=null!==(e=s.cameraObject.userData.minNearPlane)&&void 0!==e?e:.5,void(s.far=null!==(t=s.cameraObject.userData.maxFarPlane)&&void 0!==t?t:1e3);const o=this.getBounds(!1),a=s.cameraObject.getWorldPosition(new n.Pa4).sub(o.getCenter(new n.Pa4)),l=1.5*o.getSize(new n.Pa4).length()/2,c=Math.max(.1,-a.clone().normalize().dot(s.cameraObject.getWorldDirection(new n.Pa4))),u=a.length(),d=Math.max(Math.max(null!==(i=s.cameraObject.userData.minNearPlane)&&void 0!==i?i:.5,.001),c*(u-l)),h=Math.min(Math.max(d+l,c*(u+l)),null!==(r=s.cameraObject.userData.maxFarPlane)&&void 0!==r?r:1e3);s.near=d,s.far=h}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return le(this,!0,e)}fromJSON(e,t){const n=e.environment;return void 0!==n&&(this.setEnvironment(ce(n,this.getEnvironment(),!1,t)),delete e.environment),ce(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get minNearDistance(){var e;return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),null!==(e=this.activeCamera.userData.minNearPlane)&&void 0!==e?e:.5}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}it([re()],rt.prototype,"defaultCamera",void 0),it([(0,t.onChange2)(rt.prototype.setDirty),re()],rt.prototype,"envMapIntensity",void 0),it([(0,t.onChange2)(rt.prototype.setDirty),re()],rt.prototype,"fixedEnvMapDirection",void 0),it([(0,t.onChange2)(rt.prototype.setDirty),re()],rt.prototype,"backgroundIntensity",void 0),it([re(),(0,t.onChange)(rt.prototype._onEnvironmentChange.name)],rt.prototype,"environment",void 0),it([re()],rt.prototype,"textureSlots",void 0),it([re(),(0,t.onChange)(rt.prototype._onBackgroundChange)],rt.prototype,"background",void 0),it([re(),(0,t.onChange)(rt.prototype._onBackgroundChange)],rt.prototype,"backgroundColor",void 0);const st=!0;function ot(e,t,n,{replaceAll:i=!1,prepend:r=!1,append:s=!1}={}){if(st&&!e.includes(t))return console.error(`${t} not found in shader`),e;let o=n;return r?o=n+t:s&&(o=t+n),i?e.replaceAll(t,o):e.replace(t,o)}class at{static ApplyMaterialExtensions(e,t,n,i){for(const r of n)this.ApplyMaterialExtension(e,t,r,i)}static ApplyMaterialExtension(e,n,i,r){var s,o;let a=null!==(s=(0,t.getOrCall)(i.parsFragmentSnippet,r,e))&&void 0!==s?s:"";a.length&&(n.fragmentShader=ot(n.fragmentShader,this.VoidMain,"\n"+a+"\n",{prepend:!0})),a=null!==(o=(0,t.getOrCall)(i.parsVertexSnippet,r,e))&&void 0!==o?o:"",a.length&&(n.vertexShader=ot(n.vertexShader,this.VoidMain,"\n"+a+"\n",{prepend:!0})),i.extraUniforms&&(n.uniforms=Object.assign(n.uniforms,i.extraUniforms)),i.extraDefines&&function(e,t){let n=!1;t.materialObject&&void 0===t.materialObject.defines&&(t.materialObject.defines={});const i=Object.entries(e);for(const[r,s]of i)void 0===s?void 0!==t.materialObject.defines[r]&&(delete t.materialObject.defines[r],n=!0):t.materialObject.defines[r]!==s&&(t.materialObject.defines[r]=s,n=!0);n&&(t.materialObject.needsUpdate=!0)}(i.extraDefines,e),i.shaderExtender&&i.shaderExtender(n,e,r),e.lastShader=n}static CacheKeyForExtensions(e,t){let n="";for(const i of t)n+=this.CacheKeyForExtension(e,i);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),t.extraDefines&&Object.values(t.extraDefines).forEach((e=>n+=e)),n}static RegisterExtensions(e,n){const i=[];if(n)for(const t of n)t.isCompatible&&t.isCompatible(e)&&(i.push(t),t.uuid||(t.uuid=De()),t.__setDirty||(t.__setDirty=()=>{t.updateVersion||(t.updateVersion=0),t.updateVersion++}),t.setDirty||(t.setDirty=t.__setDirty));return e.materialExtensions=i,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",(n=>function(e,{object:n,renderer:i}){var r;if(e.materialExtensions)for(const s of e.materialExtensions){if(null===(r=s.onObjectRender)||void 0===r||r.call(s,n,e,i),e.lastShader){const n=(0,t.getOrCall)(s.updaters)||[];for(const t of n)t&&t.updateShaderProperties(e.lastShader)}s.updateVersion!==e.materialObject.userData["_"+s.uuid+"_version"]&&(e.materialObject.userData["_"+s.uuid+"_version"]=s.updateVersion,e.materialObject.needsUpdate=!0)}}(e,n)))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",(t=>function(e,{object:t,renderer:n}){var i;if(e.materialExtensions)for(const r of e.materialExtensions)null===(i=r.onAfterRender)||void 0===i||i.call(r,t,e,n)}(e,t)))),i}}at.VoidMain="void main()";class lt extends n.jyz{constructor(e,t=!1){var n;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=at.RegisterExtensions(this,null!==(n=null==e?void 0:e.customMaterialExtensions)&&void 0!==n?n:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...at.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){at.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+at.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,n,i,r){super.onBeforeRender(e,t,n,i,r),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:r})}onAfterRender(e,t,n,i,r){super.onAfterRender(e,t,n,i,r),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:r})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class ct extends lt{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class ut extends ct{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map((e=>e.id)).join(";")!==e.join(";")&&(this.textures=e.map((e=>({id:e,colorSpace:n.aCh}))),this.setDirty())}_setUniformTexSize(e,t){var n,i,r,s;if(!t||!e)return;const o=null!==(i=null===(n=t.image)||void 0===n?void 0:n.width)&&void 0!==i?i:512,a=null!==(s=null===(r=t.image)||void 0===r?void 0:r.height)&&void 0!==s?s:512,l=e.value;l.isVector2||console.warn("uniform is not a Vector2"),l&&Math.abs(l.x-o)+Math.abs(l.y-a)>.1&&(l.x=o,l.y=a,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,i,r){var s,o;this._setUniformTexSize(this.uniforms.screenSize,null===(s=e.getRenderTarget())||void 0===s?void 0:s.texture);for(const a of this.textures){const e=a.id,t=null===(o=this.uniforms[e])||void 0===o?void 0:o.value;t&&(this._setUniformTexSize(this.uniforms[e+"Size"],t),t.colorSpace!==a.colorSpace&&(a.colorSpace=t.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,i,r)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map((e=>{var t,i;return`uniform sampler2D ${e.id}; \n`+U(null!==(t=e.id)&&void 0!==t?t:"input",null!==(i=e.colorSpace)&&void 0!==i?i:n.aCh)})).join("\n")+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map((e=>e.id+e.colorSpace)).join(";")}}function dt(e,...t){const n=e.fragmentShader;return new ut({defines:Object.assign({},e.defines),uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:n},t)}class ht extends l{constructor(e,...t){super(e.isMaterial?e:dt(e,...t),t.length<1?ht.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,n,i;null===(t=null===(e=this.material)||void 0===e?void 0:e.dispose)||void 0===t||t.call(e),null===(i=null===(n=this.fsQuad)||void 0===n?void 0:n.dispose)||void 0===i||i.call(n),this.onDirty=[]}setDirty(){this.onDirty.forEach((e=>e()))}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach((e=>null==e?void 0:e.updateShaderProperties(this.material))))}render(e,t,n,i,r){this.enabled&&super.render(e,t||null,n,i,r)}}ht.DEFAULT_TEX_ID="tDiffuse",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe("Enabled"),re()],ht.prototype,"enabled",void 0);class pt extends r{constructor(e,t,i,r,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=void 0!==s?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new n.Ilk}render(e,t,n,i,r,s){if(!this.scene||!this.camera)return;const o=e.autoClear;let a,l;if(e.autoClear=!1,void 0!==this.overrideMaterial&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),a=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),s){const t=e.getContext();t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,s)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),s){const t=e.getContext();t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,a),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=l),e.autoClear=o}}class ft extends ht{constructor(e,n="c = a + b;",r="",s){super({vertexShader:i.vertexShader,fragmentShader:t.glsl`
                varying vec2 vUv;
                
                ${r}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${n}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:s},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class mt extends ct{constructor(e=!0){super({vertexShader:"#define DEPTH_NORMAL \n#if IS_GLSL3 > 0\nout vec3 vViewPosition;\n#else\nvarying vec3 vViewPosition;\n#endif\n#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;}",fragmentShader:"#define DEPTH_NORMAL \n#if IS_GLSL3 > 0\nin vec3 vViewPosition;\n#else\nvarying vec3 vViewPosition;\n#endif\n#ifdef USE_ALPHAMAP\n#define USE_UV \n#include <packing>\n#endif\n#if IS_GLSL3 > 0\n#ifndef gl_FragColor \nlayout(location=0)out vec4 A;layout(location=1)out vec4 B;\n#endif\n#endif\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nuniform vec2 cameraNearFar;uniform vec4 flags;vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float getSSCurvature(in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-dx;vec3 xpos=n+dx;vec3 yneg=n-dy;vec3 ypos=n+dy;float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x);return curvature;}void main(){\n#glMarker mainStart\n#include <clipping_planes_fragment>\nvec4 diffuseColor=vec4(1.);\n#include <map_fragment>\n#ifdef USE_ALPHAMAP\nfloat alphaMapValue=\n#ifdef ALPHA_I_RGBA_PACKING\n1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv));\n#else\ntexture2D(alphaMap,vAlphaMapUv).g;\n#endif\n#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1\ndiffuseColor.a*=1.-alphaMapValue;\n#else\ndiffuseColor.a*=alphaMapValue;\n#endif\n#endif\n#include <alphatest_fragment>\n#include <logdepthbuf_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#ifdef FORCED_LINEAR_DEPTH\nfloat linearZ=float(FORCED_LINEAR_DEPTH);\n#else\nfloat linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);\n#endif\nvec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);\n#if IS_GLSL3 > 0\n#ifndef gl_FragColor \nA=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;B.x=getSSCurvature(normal)*0.5+0.5;\n#else\ngl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);\n#endif\n#else\ngl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);\n#endif\n}",uniforms:n.rDY.merge([n.rBU.common,n.rBU.bumpmap,n.rBU.normalmap,n.rBU.displacementmap,{cameraNearFar:{value:new n.FM8(.1,1e3)},flags:{value:new n.Ltg(255,255,255,255)}}]),defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?n.LSk:n.v9Y}),this.normalMapType=n.IOt,this.flatShading=!1,this._updaters=[]}onBeforeRender(e,t,i,r,s){var o,a,l,c,u,d,h,p,f,m,g,_,v;super.onBeforeRender(e,t,i,r,s);let y=s.material;Array.isArray(y)&&(y=y[0]),this.uniforms.map.value=null!==(o=null==y?void 0:y.map)&&void 0!==o?o:null,this.uniforms.map.value&&e.materials.refreshTransformUniform(this.uniforms.map.value,this.uniforms.mapTransform),this.uniforms.alphaMap.value=null!==(a=null==y?void 0:y.alphaMap)&&void 0!==a?a:null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.alphaTest=!y||!y.alphaTest||y.alphaTest<1e-7?.001:y.alphaTest,this.uniforms.alphaTest.value=this.alphaTest,this.uniforms.displacementMap.value=null!==(l=null==y?void 0:y.displacementMap)&&void 0!==l?l:null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=null!==(c=null==y?void 0:y.displacementScale)&&void 0!==c?c:1,this.uniforms.displacementBias.value=null!==(u=null==y?void 0:y.displacementBias)&&void 0!==u?u:0,this.uniforms.bumpMap.value=null!==(d=null==y?void 0:y.bumpMap)&&void 0!==d?d:null,this.uniforms.bumpMap.value&&e.materials.refreshTransformUniform(this.uniforms.bumpMap.value,this.uniforms.bumpMapTransform),this.uniforms.bumpScale.value=null!==(h=null==y?void 0:y.bumpScale)&&void 0!==h?h:1,this.uniforms.normalMap.value=null!==(p=null==y?void 0:y.normalMap)&&void 0!==p?p:null,this.uniforms.normalMap.value&&e.materials.refreshTransformUniform(this.uniforms.normalMap.value,this.uniforms.normalMapTransform),this.uniforms.normalScale.value&&this.uniforms.normalScale.value.copy(null!==(f=null==y?void 0:y.normalScale)&&void 0!==f?f:new n.FM8(1,1)),this.normalMapType=null!==(m=null==y?void 0:y.normalMapType)&&void 0!==m?m:n.IOt,this.flatShading=null!==(g=null==y?void 0:y.flatShading)&&void 0!==g&&g,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=((null==y?void 0:y.userData.matId)?null==y?void 0:y.userData.matId:0)/255,this._updaters.forEach((e=>{e(s,this.uniforms.flags.value)})),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let b=this.uniforms.alphaMap.value?1:void 0;b!==this.defines.USE_ALPHAMAP&&(void 0===b?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=b,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),b=this.uniforms.map.value?1:void 0,b!==this.defines.USE_MAP&&(void 0===b?(delete this.defines.USE_MAP,delete this.defines.MAP_UV):(this.defines.USE_MAP=b,this.defines.MAP_UV="uv"),this.needsUpdate=!0),b=this.uniforms.bumpMap.value?1:void 0,b!==this.defines.USE_BUMPMAP&&(void 0===b?(delete this.defines.USE_BUMPMAP,delete this.defines.BUMPMAP_UV):(this.defines.USE_BUMPMAP=b,this.defines.BUMPMAP_UV="uv"),this.needsUpdate=!0),b=this.uniforms.normalMap.value?1:void 0,b!==this.defines.USE_NORMALMAP&&(void 0===b?(delete this.defines.USE_NORMALMAP,delete this.defines.NORMALMAP_UV):(this.defines.USE_NORMALMAP=b,this.defines.NORMALMAP_UV="uv"),this.needsUpdate=!0),b=this.uniforms.displacementMap.value?1:void 0,b!==this.defines.USE_DISPLACEMENTMAP&&(void 0===b?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=b,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),b=y.userData.ALPHA_I_RGBA_PACKING?1:void 0,b!==this.defines.ALPHA_I_RGBA_PACKING&&(void 0===b?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=b,this.needsUpdate=!0),b=null!==(_=y.userData.forcedLinearDepth)&&void 0!==_?_:void 0,b!==this.defines.FORCED_LINEAR_DEPTH&&(void 0===b?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=b,this.needsUpdate=!0),this.side=null!==(v=y.side)&&void 0!==v?v:n.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const t=this._updaters.indexOf(e);-1!==t&&this._updaters.splice(t,1)}}var gt="#ifndef UNPACK_GBUFFER_SNIPPET\n#define UNPACK_GBUFFER_SNIPPET \nuniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}\n#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1\nuniform sampler2D tGBufferFlags;\n#endif\nivec4 getGBufferFlags(const in vec2 uv){\n#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1\nreturn ivec4(texture2D(tGBufferFlags,uv)*255.);\n#else\nreturn ivec4(1);\n#endif\n}\n#endif\n";class _t extends t.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}get viewer(){return this._viewer}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=le(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(ce(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(null!=e?e:"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,t,n,i;return null!==(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("AssetManager"))||void 0===t?void 0:t.exportPluginPreset(this))&&void 0!==n?n:null===(i=this.toJSON)||void 0===i?void 0:i.call(this)}async importState(e){var t,n;const i=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("AssetManager");i?await i.importPluginPreset(e,this):null===(n=this.fromJSON)||void 0===n||n.call(this,e)}storeState(e,t,n){(t=t||(window?window.localStorage:void 0))?(void 0===n&&(n=this.exportState()),n&&t.setItem(this._storeKey(e),JSON.stringify(n))):console.warn("Unable to store state")}async loadState(e,t){if(!(t=t||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const n=t.getItem(this._storeKey(e));n&&await this.importState(JSON.parse(n))}}function vt(e,n,i){return{...n,get dirty(){return n.dirty||!1},set dirty(e){(0,t.safeSetProperty)(n,"dirty",e,!0)},update(){var e,r,s;this.passObject.enabled&&(null===(r=(e=this.passObject).updateShaderProperties)||void 0===r||r.call(e,(0,t.getOrCall)(i)),null===(s=n.update)||void 0===s||s.call(this))},onRegister(t){var i,r,s;this.passObject.materialExtension&&(null===(r=null===(i=e.getPluginByType("AssetManager"))||void 0===i?void 0:i.materials)||void 0===r||r.registerMaterialExtension(this.passObject.materialExtension)),null===(s=n.onRegister)||void 0===s||s.call(this,t)},onUnregister(t){var i,r,s;this.passObject.materialExtension&&(null===(r=null===(i=e.getPluginByType("AssetManager"))||void 0===i?void 0:i.materials)||void 0===r||r.unregisterMaterialExtension(this.passObject.materialExtension)),null===(s=n.onUnregister)||void 0===s||s.call(this,t)},dispose(){var e,t,i;null===(t=(e=this.passObject).dispose)||void 0===t||t.call(e),null===(i=n.dispose)||void 0===i||i.call(this)}}}class yt extends _t{_update(e){var t;return(null===(t=this._pass)||void 0===t?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t,n;return null!==(n=null===(t=null===(e=this._pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)&&void 0!==n?n:this._enabledTemp}set enabled(e){var t;(null===(t=this._pass)||void 0===t?void 0:t.passObject)&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(t){t&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=vt(e,t),void 0!==t.passObject.onDirty&&t.passObject.onDirty.push((()=>t.dirty=!0)),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,n;this._pass&&e.renderer.unregisterPass(this._pass),null===(n=null===(t=this._pass)||void 0===t?void 0:t.dispose)||void 0===n||n.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var t;const n=super.toJSON(e);if(!n.type)return n;const i=this.pass;return i&&(n.pass=le(null!==(t=null==i?void 0:i.passObject)&&void 0!==t?t:i,!1,e)),n}fromJSON(e,t){var n;if(!super.fromJSON(e,t))return null;if(e.pass){const i=this.pass;i&&ce(e.pass,null!==(n=null==i?void 0:i.passObject)&&void 0!==n?n:i,!1,t)}return this}}!function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([re()],yt.prototype,"enabled",null);class bt extends pt{constructor(e,t,i=new n.Ilk(1,1,1),r=1){super(void 0,void 0,t,i,r),this.target=e,this._transparentMats=new Set,this._transmissiveMats=new Set}render(e,t,n,i,r){var s;const o=e.getRenderTarget(),a=e.getActiveCubeFace(),l=e.getActiveMipmapLevel();null===(s=this.scene)||void 0===s||s.traverse((({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(this._transparentMats.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(this._transmissiveMats.add([e,e.transmission]),e.transmission=0))})),H(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},(()=>super.render(e,t,this.target,i,r))),this._transparentMats.forEach((e=>e.transparent=!e.transparent)),this._transparentMats.clear(),this._transmissiveMats.forEach((([e,t])=>e.transmission=t)),this._transmissiveMats.clear(),e.setRenderTarget(o,a,l)}}class At extends yt{get material(){return this._material}passCtor(e){var t,i,r;const s=(null===(t=this._viewer)||void 0===t?void 0:t.renderer.isWebGL2)&&this.renderFlagsBuffer,o=e.renderer.createTarget({depthBuffer:!0,samples:(null===(i=this._viewer)||void 0===i?void 0:i.useGBufferDepth)&&(null===(r=this._viewer)||void 0===r?void 0:r.renderer.composerTarget.samples)||0,type:n.ywz,textureCount:s?2:1,depthTexture:this.renderDepthTexture,depthTextureType:this.depthTextureType});return Array.isArray(o.texture)?(o.texture[0].name="gbufferDepthNormal",o.texture[1].name="gbufferFlags",this._gbufferTextures=o.texture):(o.texture.name="gbufferDepthNormal",this._gbufferTextures.push(o.texture)),this._gbufferTarget=o,this._material=new mt(s),this._material.userData.isGBufferMaterial=!0,new bt(o,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0,t=!1,i=n.JQ4){super(),this.renderFlagsBuffer=e,this.renderDepthTexture=t,this.depthTextureType=i,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getDepthTexture(){var e;return null===(e=this._gbufferTarget)||void 0===e?void 0:e.depthTexture}getUnpackSnippet(){return gt}updateShaderProperties(e){var t,n,i;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=null!==(t=this.getDepthNormal())&&void 0!==t?t:void 0:null===(n=this._viewer)||void 0===n||n.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=null!==(i=this.getFlagsTexture())&&void 0!==i?i:void 0;const t=e.uniforms.tGBufferFlags.value?1:0;t!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=t,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}At.PluginType="GBuffer";class wt extends pt{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:n.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?n.cLu:n.ywz,format:n.wk1,minFilter:n.wem,magFilter:n.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,t=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new n.Ilk(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new ft({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,t,n,i,r){var s;let o=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,i,r),this.needsSwap=o,void(e.userData.mainRenderPass=void 0);const a=e.userData;a||console.error("threejs is not patched?");const l=this._viewer.useGBufferDepth;let c;if(l){const t=null===(s=this._viewer.getPlugin(At))||void 0===s?void 0:s.getTarget();if(t){const n=e.properties.get(t);c=n.__webglDepthRenderbuffer||n.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let u=(t=!1)=>{super.render(e,void 0,n,i,r,c)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(o=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const t=e.autoClearDepth;e.autoClearDepth=!l,H(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},u),e.autoClearDepth=t}if(!l){const t=e.properties.get(n);c=t.__webglDepthRenderbuffer||t.__webglDepthbuffer}u=()=>{super.render(e,void 0,this.transparentTarget,i,r,c)};{const t=this.clear,n=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,H(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},u),this.clear=t,e.autoClearDepth=n}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,r),o=!0);{const i=this.clear;this.clear=!1,a.transmissionRenderTarget=o?t:n,a.blurTransmissionTarget=this.blurTransmissionTarget&&0===a.transmissionRenderTarget.samples,H(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},u),a.blurTransmissionTarget=void 0,a.transmissionRenderTarget=void 0,this.clear=i}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,r),o=!0)}}else{{const t=this.clear,n=e.autoClearDepth;e.autoClearDepth=!l,this.clear=!0,H(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},u),this.clear=t,e.autoClearDepth=n}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const i=this.clear;this.clear=!1,a.transmissionRenderTarget=t,a.blurTransmissionTarget=this.blurTransmissionTarget,H(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},u),a.blurTransmissionTarget=void 0,a.transmissionRenderTarget=void 0,this.clear=i}o=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=o,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function xt(e,t){return e.multiplyScalar(e.w*t),e.w=1,e}function Et(e,t){return xt(e,t),new n.Ilk(e.x,e.y,e.z)}function Ct(e,t){const n=Math.max(e.x,Math.max(e.y,e.z));let i=Math.max(Math.min(n/t,1),0);return i=Math.ceil(255*i)/255,e.divideScalar(i*t),e.w=i,e}function St(e,t){return Ct(new n.Ltg(e.r,e.g,e.b,1),t)}const Mt={name:"",blending:n.bdR,side:n.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:n.k74,blendDst:n.LgZ,blendEquation:n.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:n.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:n.cum,stencilRef:0,stencilFuncMask:255,stencilFail:n.x5V,stencilZFail:n.x5V,stencilZPass:n.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},Tt={...Mt,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:n.IOt,normalScale:new n.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},It={...Tt,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new n.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new n.Ilk(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new n.Ilk(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new n.Ilk(1,1,1),specularColorMap:null};class Pt extends n.EJi{constructor(e){var t;super(e),this.typeSlug=Pt.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=e=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=at.RegisterExtensions(this,null!==(t=null==e?void 0:e.customMaterialExtensions)&&void 0!==t?t:[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),null===(n=null===(t=this._uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===n||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...at.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},X(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},X(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},X(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},X(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",n.IOt],["ObjectSpace",n.PA7]].map((e=>({label:e[0],value:e[1]})))},X(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},X(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},X(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},X(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},X(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},X(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},X(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},X(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},X(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},X(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",n.BVF],["Always",n.Se2],["Less",n.Zr5],["LessEqual",n.vCF],["Equal",n.eD],["GreaterEqual",n.ksN],["Greater",n.w$m],["NotEqual",n.M6v]].map((e=>({label:e[0],value:e[1]})))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",n.jFi],["Normal",n.bdR],["Additive",n.WMw],["Subtractive",n.N4l],["Multiply",n.M5h]].map((e=>({label:e[0],value:e[1]})))},{type:"image",property:[this,"alphaMap"]},X(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>!0===this.userData.renderToDepth,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>!0===this.userData.inverseAlphaMap,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},X(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},X(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},X(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},X(this,"iridescenceThicknessMap")]},{type:"folder",label:"Environment",children:[{type:"checkbox",label:"Override Environment",getValue:()=>!0===this.userData.separateEnvMapIntensity,setValue:e=>{this.userData.separateEnvMapIntensity=e,e||delete this.userData.separateEnvMapIntensity},onChange:this.setDirty},{type:"slider",bounds:[0,10],hidden:()=>!this.userData.separateEnvMapIntensity,label:"Environment Intensity",property:[this,"envMapIntensity"]},{type:"dropdown",hidden:()=>!this.userData.separateEnvMapIntensity&&!this.userData.envMapSlotKey,label:"Environment Map",children:["","environment1","environment2"].map((e=>({label:e||"default",value:e}))),getValue:()=>this.userData.envMapSlotKey||"",setValue:e=>{this.userData.envMapSlotKey=e,e||delete this.userData.envMapSlotKey,this.setDirty()}}]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",n.Wl3],["Back",n._Li],["Double",n.ehD]].map((e=>({label:e[0],value:e[1]})))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,t,n;return null!==(n=null===(t=null===(e=this.userData)||void 0===e?void 0:e.__appliedMeshes)||void 0===t?void 0:t.size)&&void 0!==n?n:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(le(this,!1),null,2)],{type:"application/json"});(0,t.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map((e=>{var t;return null===(t=e.getUiConfig)||void 0===t?void 0:t.call(e,this)}))].filter((e=>e)),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const r of i)e.vertexShader=ot(e.vertexShader,r[0],"#glMarker "+r[1]+"\n"+r[0]);for(const r of n)e.fragmentShader=ot(e.fragmentShader,r[0],"#glMarker "+r[1]+"\n"+r[0]);at.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+at.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,r){super.onBeforeRender(e,t,n,i,r),void 0===this.envMapIntensity||this.userData.separateEnvMapIntensity||void 0===t.envMapIntensity||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),void 0!==this.envMap&&void 0!==t.fixedEnvMapDirection&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):void 0!==this.defines.FIX_ENV_DIRECTION&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:r});const s=this.userData.inverseAlphaMap?1:0;s!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=s,this.needsUpdate=!0)}onAfterRender(e,t,n,i,r){super.onAfterRender(e,t,n,i,r),void 0!==this.userData.__envIntensity&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:r})}copyProps(e,n=!1,i=!0){if(!n&&!["MeshStandardMaterial",Pt.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const r={},s=Array.from(Object.keys(It));(0,t.copyProps)(e,r,s);const o=r.userData;delete r.userData;for(const t of Object.keys(r))void 0===r[t]&&delete r[t];if(this.setValues(r),i){const e={};for(const t of Y)void 0!==this.userData[t]&&(e[t]=this.userData[t])}return o&&K(this.userData,o),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var t,n;const i=this.userData;this.userData={};const r=super.toJSON(e);this.userData=i,r.userData={},K(r.userData,i),r.userData.uuid=this.userData.uuid;const s=e||{textures:Object.fromEntries((null===(t=r.textures)||void 0===t?void 0:t.map((e=>[e.uuid,e])))||[]),images:Object.fromEntries((null===(n=r.images)||void 0===n?void 0:n.map((e=>[e.uuid,e])))||[])};r.userData=le(r.userData,!1,s),e||(Object.keys(s.textures).length>0&&(r.textures=Object.values(s.textures)),Object.keys(s.images).length>0&&(r.images=Object.values(s.images))),r.type=Pt.TYPE;for(const o of Object.keys(r))void 0===r[o]&&delete r[o];return r}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Pt.TypeSlug="pmat",Pt.TYPE="MeshStandardMaterial2";const Rt={...Mt,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:n.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class Dt extends n.vBJ{constructor(e){var t;super(e),this.typeSlug=Dt.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=e=>{console.warn("WebGi: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)},this.materialExtensions=at.RegisterExtensions(this,null!==(t=null==e?void 0:e.customMaterialExtensions)&&void 0!==t?t:[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),null===(n=null===(t=this._uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===n||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...at.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},X(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",n.jFi],["Normal",n.bdR],["Additive",n.WMw],["Subtractive",n.N4l],["Multiply",n.M5h]].map((e=>({label:e[0],value:e[1]})))},{type:"image",property:[this,"alphaMap"]},X(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>!0===this.userData.renderToDepth,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},X(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},X(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",n.Wl3],["Back",n._Li],["Double",n.ehD]].map((e=>({label:e[0],value:e[1]})))},{type:"input",label:"Mesh count",getValue:()=>{var e,t,n;return null!==(n=null===(t=null===(e=this.userData)||void 0===e?void 0:e.__appliedMeshes)||void 0===t?void 0:t.size)&&void 0!==n?n:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(le(this,!1),null,2)],{type:"application/json"});(0,t.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map((e=>{var t;return null===(t=e.getUiConfig)||void 0===t?void 0:t.call(e,this)}))].filter((e=>e)),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const r of i)e.vertexShader=ot(e.vertexShader,r[0],"#glMarker "+r[1]+"\n"+r[0]);for(const r of n)e.fragmentShader=ot(e.fragmentShader,r[0],"#glMarker "+r[1]+"\n"+r[0]);at.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+at.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,r){super.onBeforeRender(e,t,n,i,r),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:r})}onAfterRender(e,t,n,i,r){super.onAfterRender(e,t,n,i,r),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:r})}copyProps(e,n=!1){if(!n&&!["MeshBasicMaterial",Dt.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const i={},r=Array.from(Object.keys(Rt));(0,t.copyProps)(e,i,r);const s=i.userData;delete i.userData;for(const t of Object.keys(i))void 0===i[t]&&delete i[t];return this.setValues(i),s&&K(this.userData,s),this.setDirty(),this}toJSON(e){var t,n;const i=this.userData;this.userData={};const r=super.toJSON(e);this.userData=i,r.userData={},K(r.userData,i),r.userData.uuid=this.userData.uuid;const s=e||{textures:Object.fromEntries((null===(t=r.textures)||void 0===t?void 0:t.map((e=>[e.uuid,e])))||[]),images:Object.fromEntries((null===(n=r.images)||void 0===n?void 0:n.map((e=>[e.uuid,e])))||[])};r.userData=le(r.userData,!1,s),e||(Object.keys(s.textures).length>0&&(r.textures=Object.values(s.textures)),Object.keys(s.images).length>0&&(r.images=Object.values(s.images))),r.type=Dt.TYPE;for(const o of Object.keys(r))void 0===r[o]&&delete r[o];return r}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Dt.TypeSlug="bmat",Dt.TYPE="MeshBasicMaterial2";const kt={materialType:Pt.TYPE,name:"standard",color:"#ffffff"},Bt={materialType:Dt.TYPE,name:"basic",color:"#ffffff"},Ot={[Pt.TYPE]:kt.name,MeshStandardMaterial:kt.name,MeshPhysicalMaterial:kt.name,[Dt.TYPE]:Bt.name,MeshBasicMaterial:Bt.name};class Lt extends t.SimpleEventDispatcher{constructor(){super(),this._templates=[kt,Bt],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||"material"!==t.assetType)return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),i=[];n.forEach((e=>{const n=e.userData.__appliedMaterials;null==n||n.delete(t),n&&!1!==e.userData.disposeOnIdle&&0===n.size&&i.push(e)})),i.forEach((e=>{e.dispose()}))},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,null!=t?t:{})}generateFromTemplateType(e,t){const n=this._templates.find((t=>t.materialType===e));if(n)return this._generateFromTemplate(n,null!=t?t:{})}findTemplate(e){return this._templates.find((t=>t.name===e))}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach((e=>{this._getMapsForMaterial(e).forEach((t=>{let n=t.userData.__appliedMaterials;n||(t.userData.__appliedMaterials=n=new Set),t.addEventListener("update",(()=>e.dispatchEvent({type:"textureUpdate",texture:t}))),n.add(e)}))}))}_getMapsForMaterial(e){var t;const n=new Set;for(const i of Object.values(e))i&&i.isTexture&&n.add(i);for(const i of Object.values(null!==(t=e.userData)&&void 0!==t?t:{}))i&&i.isTexture&&n.add(i);return n}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("WebGi MaterialManager: Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter((t=>t.uuid!==e.uuid)),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=De());const t=this._templates.find((t=>t.templateUUID===e.templateUUID));t?console.warn("WebGi Material Manager: MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter((t=>t.templateUUID!==e.templateUUID))}dispose(e=!0){const t=this._materials;this._materials=[];for(const n of t)e||!n.userData.runtimeMaterial?n.dispose():this._materials.push(n)}findMaterial(e){return e?this._materials.find((t=>t.uuid===e)):void 0}findMaterialsByName(e,t=!1){return this._materials.filter((n=>"string"!=typeof e||t?null!==n.name.match("string"==typeof e?"^"+e+"$":e):n.name===e))}getMaterialsOfType(e){return e?this._materials.filter((t=>t.typeSlug===e)):[]}getAllMaterials(){return[...this._materials]}processModel(e,n){const i=this._processModel(e,n);return(0,t.safeSetProperty)(e,"modelObject",i),e}_processMaterial(e,t){var n,i;if(!e)return;if(null===(n=e.materialObject)||void 0===n?void 0:n.isMaterial)return e;let r=e.mmMaterial;if(!r){const n=(null===(i=e.userData)||void 0===i?void 0:i.uuid)||e.uuid;if(r=this.findMaterial(n),r)r.copyProps(e);else{const n=!1===t.useSourceMaterial||!e.isMaterial,i=t.materialTemplate||(n?"standard":Ot[e.type]||"standard");r=this.generateFromTemplate(i,n?{}:e)}e.mmMaterial=r}return r}processMaterial(e,t){return e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),!1!==t.register&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,n,i=!0,r=!1){const s=le(e,!1),o=JSON.stringify(s,null,i?0:2),a=(n||e.name||"physical_material")+"."+e.typeSlug,l=new File([o],a,{type:"application/json"});return r&&(0,t.downloadFile)(l),l}applyMaterial(e,t,n=!0){var i;const r=Object.getPrototypeOf(e).constructor.TYPE;let s=this.findMaterialsByName(t,n);(!s||s.length<1)&&(s=[this.findMaterial(t)]);let o=!1;for(const a of s)if(a&&!a.userData.__isVariation&&a!==e)if(Object.getPrototypeOf(a).constructor.TYPE===r){const t=a.name;a.copyProps(e),a.name=t,o=!0}else{const t=a["__"+r]||this.generateFromTemplateType(r);if(!t)continue;const n=a.name;t.copyProps(e),t.name=n;const s=a.userData.__appliedMeshes;for(const e of[...null!=s?s:[]])null===(i=null==e?void 0:e.setMaterial)||void 0===i||i.call(e,t),e&&(o=!0);a["__"+r]=t}return o}}class Ut extends Lt{_generateFromTemplate(e,i){var r,s,o,a,l,c;let u;const d={...e};d.customMaterialExtensions=[...null!==(r=d.customMaterialExtensions)&&void 0!==r?r:[],...this._materialExtensions];const h=(null==i?void 0:i.metadata)&&(null==i?void 0:i.metadata.version)<=4.5;h&&(n.epp.enabled=!1);let p={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&(0,t.copyProps)(i,d,Array.from(Object.keys(It))),"MeshBasicMaterial"===(null==i?void 0:i.type)&&(d.roughness=.9,d.metalness=0,(null===(s=d.userData)||void 0===s?void 0:s.uuid)&&delete d.userData.uuid),p=null===(o=d.userData)||void 0===o?void 0:o.uuid,p&&delete d.userData.uuid,u=new Pt({customMaterialExtensions:d.customMaterialExtensions}).fromJSON(d,void 0,!0),p&&(u.uuid=p),u.userData.uuid=u.uuid,u.setDirty(),(null==i?void 0:i.isMaterial)&&void 0!==i.userData&&(i.userData.iMaterial=u);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&(0,t.copyProps)(i,d,Array.from(Object.keys(Rt))),p=null===(a=d.userData)||void 0===a?void 0:a.uuid,p&&delete d.userData.uuid,u=new Dt({customMaterialExtensions:d.customMaterialExtensions}).fromJSON(d,void 0,!0),p&&(u.uuid=p,d.userData.uuid=p),u.userData.uuid=u.uuid,u.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:p=null,i&&i.userData&&(p=i.userData,delete i.userData),u=(null===(l=e.generator)||void 0===l?void 0:l.call(e,d,i))||void 0,i&&p&&(i.userData=p),p&&u&&(K(u.userData,p),(null==p?void 0:p.uuid)&&(u.uuid=p.uuid),p=null),u&&(u.userData.uuid=u.uuid)}if(u){i.runtimeMaterial&&(u.userData.runtimeMaterial=!0);const t=u;if(u.clone=()=>{t.userData.cloneId||(t.userData.cloneId="0"),t.userData.cloneCount||(t.userData.cloneCount=0),t.userData.cloneCount+=1;const n=this.generateFromTemplate(e.name);return n&&(n.copyProps(t),n.userData.cloneId=n.userData.cloneId+"_"+t.userData.cloneCount,n.userData.cloneCount=0,n.name=n.name+"_"+n.userData.cloneId,n.userData.uuid=n.uuid),null==n?void 0:n.materialObject},i){let e=this.findMaterial(null==i?void 0:i.uuid);e&&this.unregisterMaterial(e),e=this.findMaterial(null===(c=null==i?void 0:i.materialObject)||void 0===c?void 0:c.uuid),e&&this.unregisterMaterial(e)}}return h&&(n.epp.enabled=!0),u?this.registerMaterialObject(u):void 0}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let i=!0;Array.isArray(n)||(n=[n],i=!1);const r=[];for(const e of n){const n=this._processMaterial(e,t);r.push(null==n?void 0:n.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(i?r:r[0]))}if(!1!==t.recursive)for(let i=0;i<e.modelObject.children.length;i++)e.modelObject.children[i]=this._processModel(e.modelObject.children[i],t);return e}}class Nt{ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return"function"==typeof this.onCtor?this.onCtor(t,e):t}constructor(e,t,n,i){this.cls=e,this.ext=t,this.root=n,this.onCtor=i}}class Ft{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:t=!1,autoCenter:i=!1,autoScale:r=!1,autoScaleRadius:s=2,license:o=""}={}){if(this.assetType="model",this._modelObject=ye(new n.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!i||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||i||(e.userData.isCentered=!0):Q(e),this._modelObject=e;else{i&&console.error("cannot use pseudoCenter and autoCenter at the same time");const t=(new p).expandByObject(e,!0,!0).getCenter(new n.Pa4);this._modelObject.position.copy(t).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}r&&!this._modelObject.userData.autoScaled?W(this._modelObject,e.userData.autoScaleRadius||s):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",(()=>{this.__disposed=!0})),this._modelObject.userData.iModel=this,this.license=o}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&"function"==typeof e?e():(console.warn("WebGi Object3DModel: no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,n,i,r;null===(n=null===(t=this._modelObject)||void 0===t?void 0:t.setDirty)||void 0===n||n.call(t,e),null===(r=null===(i=this._uiConfig)||void 0===i?void 0:i.uiRefresh)||void 0===r||r.call(i,"postFrame",!0)}setMaterial(e){var t,n;return this._modelObject.isMesh?(null===(n=(t=this._modelObject).setMaterial)||void 0===n?void 0:n.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var n,i;if(this._modelObject.isMesh)return null===(i=(n=this._modelObject).setGeometry)||void 0===i?void 0:i.call(n,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("WebGi Object3DModel: updateBounds: NOT IMPLEMENTED, don't use"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=ve(this._modelObject,!1)),this._uiConfig}clone(){return new Ft(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function jt(e,t){return[e.modelObject,...e.modelObject.children].forEach((n=>{ye(n,n!==e.modelObject?e:void 0,t)})),e}class zt{constructor(){this._processors=new Map}add(e,t){var n;this._processors.has(e)||this._processors.set(e,[]),null===(n=this._processors.get(e))||void 0===n||n.push(t)}remove(e,t){const n=this._processors.get(e),i=(null==n?void 0:n.indexOf(t))||(null==n?void 0:n.findIndex((e=>e.process&&e.process===t.process||e.processAsync&&e.processAsync===t.processAsync)));!n||!i||i<0||n.splice(i,1)}get(e){var t;return null!==(t=this._processors.get(e))&&void 0!==t?t:[]}async process(e,t,n){var i,r,s,o;const a=this.get(e),l=t.assetType;for(const c of a)c.forAssetType===l&&(t=null!==(r=null===(i=c.process)||void 0===i?void 0:i.call(c,t,n))&&void 0!==r?r:t,t=null!==(o=await(null===(s=c.processAsync)||void 0===s?void 0:s.call(c,t,n)))&&void 0!==o?o:t);return t}dispose(){this._processors.clear()}}class Gt extends n.hH6{load(e,t,n,i){return super.load(e,(e=>{try{if("string"!=typeof e)throw new Error("Invalid JSON");null==t||t(JSON.parse(e))}catch(e){null==i||i(e)}}),n,i)}}class Vt extends n.yxD{constructor(e){super(e),this.type=n.cLu}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},i=function(e,t,n){t=t||1024;let i=e.pos,r=-1,s=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(r=a.indexOf("\n"))&&s<t&&i<e.byteLength;)o+=a,s+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(!1!==n&&(e.pos+=s+r+1),o+a.slice(0,r))},r=function(e,t,n,i){const r=e[t+3],s=Math.pow(2,r-128)/255;n[i+0]=e[t+0]*s,n[i+1]=e[t+1]*s,n[i+2]=e[t+2]*s,n[i+3]=1},s=function(e,t,i,r){const s=e[t+3],o=Math.pow(2,s-128)/255;i[r+0]=n.A5E.toHalfFloat(Math.min(e[t+0]*o,65504)),i[r+1]=n.A5E.toHalfFloat(Math.min(e[t+1]*o,65504)),i[r+2]=n.A5E.toHalfFloat(Math.min(e[t+2]*o,65504)),i[r+3]=n.A5E.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const a=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=i(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(a.valid|=1,a.programtype=c[1],a.string+=l+"\n";l=i(e),!1!==l;)if(a.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(n))&&(a.gamma=parseFloat(c[1])),(c=l.match(r))&&(a.exposure=parseFloat(c[1])),(c=l.match(s))&&(a.valid|=2,a.format=c[1]),(c=l.match(o))&&(a.valid|=4,a.height=parseInt(c[1],10),a.width=parseInt(c[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=l+"\n";return 2&a.valid?4&a.valid?a:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==a){const e=a.width,i=a.height,l=function(e,n,i){const r=n;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(r!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const s=new Uint8Array(4*n*i);if(!s.length)return t(4,"unable to allocate buffer space");let o=0,a=0;const l=4*r,c=new Uint8Array(4),u=new Uint8Array(l);let d=i;for(;d>0&&a<e.byteLength;){if(a+4>e.byteLength)return t(1);if(c[0]=e[a++],c[1]=e[a++],c[2]=e[a++],c[3]=e[a++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=r)return t(3,"bad rgbe scanline format");let n,i=0;for(;i<l&&a<e.byteLength;){n=e[a++];const r=n>128;if(r&&(n-=128),0===n||i+n>l)return t(3,"bad scanline data");if(r){const t=e[a++];for(let e=0;e<n;e++)u[i++]=t}else u.set(e.subarray(a,a+n),i),i+=n,a+=n}const h=r;for(let e=0;e<h;e++){let t=0;s[o]=u[e+t],t+=r,s[o+1]=u[e+t],t+=r,s[o+2]=u[e+t],t+=r,s[o+3]=u[e+t],o+=4}d--}return s}(o.subarray(o.pos),e,i);if(-1!==l){let t,o,c;switch(this.type){case n.VzW:c=l.length/4;const e=new Float32Array(4*c);for(let t=0;t<c;t++)r(l,4*t,e,4*t);t=e,o=n.VzW;break;case n.cLu:c=l.length/4;const i=new Uint16Array(4*c);for(let t=0;t<c;t++)s(l,4*t,i,4*t);t=i,o=n.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:i,data:t,header:a.string,gamma:a.gamma,exposure:a.exposure,type:o}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,r){return super.load(e,(function(e,i){switch(e.type){case n.VzW:case n.cLu:e.colorSpace=n.GUF,e.minFilter=n.wem,e.magFilter=n.wem,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,i)}),i,r)}}function Ht(e){return new Nt(class extends Vt{constructor(t){super(t),this.setDataType(ks(e.renderer.rendererObject))}},["hdr"],!1)}class Qt extends n.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new Jt(e)})),this.register((function(e){return new on(e)})),this.register((function(e){return new an(e)})),this.register((function(e){return new ln(e)})),this.register((function(e){return new $t(e)})),this.register((function(e){return new en(e)})),this.register((function(e){return new tn(e)})),this.register((function(e){return new nn(e)})),this.register((function(e){return new Kt(e)})),this.register((function(e){return new rn(e)})),this.register((function(e){return new Zt(e)})),this.register((function(e){return new sn(e)})),this.register((function(e){return new Xt(e)})),this.register((function(e){return new cn(e)})),this.register((function(e){return new un(e)}))}load(e,t,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.Zp0.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){r?r(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},l=new n.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{s.parse(n,o,(function(n){t(n),s.manager.itemEnd(e)}),a,e)}catch(e){a(e)}}),i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,r){let s;const o={},a={},l=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===dn){try{o[qt.KHR_BINARY_GLTF]=new hn(e)}catch(e){return void(i&&i(e))}s=JSON.parse(o[qt.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new Bn(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const e=this.pluginCallbacks[u](c);a[e.name]=e,o[e.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const e=s.extensionsUsed[u],t=s.extensionsRequired||[];switch(e){case qt.KHR_MATERIALS_UNLIT:o[e]=new Yt;break;case qt.KHR_DRACO_MESH_COMPRESSION:o[e]=new pn(s,this.dracoLoader);break;case qt.KHR_TEXTURE_TRANSFORM:o[e]=new fn;break;case qt.KHR_MESH_QUANTIZATION:o[e]=new mn;break;default:t.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(n,i)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}}function Wt(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}Qt.ObjectConstructors={DirectionalLight:n.Ox3,PointLight:n.cek,SpotLight:n.PMe,MeshStandardMaterial:n.Wid,MeshBasicMaterial:n.vBJ,MeshPhysicalMaterial:n.EJi,LineBasicMaterial:n.nls,PointsMaterial:n.UY4,PerspectiveCamera:n.cPb,OrthographicCamera:n.iKG};const qt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Xt{constructor(e){this.parser=e,this.name=qt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const l=new n.Ilk(16777215);void 0!==o.color&&l.fromArray(o.color);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new Qt.ObjectConstructors.DirectionalLight(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Qt.ObjectConstructors.PointLight(l),a.distance=c;break;case"spot":a=new Qt.ObjectConstructors.SpotLight(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,Tn(a,o),void 0!==o.intensity&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(a),t.cache.add(i,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class Yt{constructor(){this.name=qt.KHR_MATERIALS_UNLIT}getMaterialType(){return Qt.ObjectConstructors.MeshBasicMaterial}extendParams(e,t,i){const r=[];e.color=new n.Ilk(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(e,"map",s.baseColorTexture,n.KI_))}return Promise.all(r)}}class Kt{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class Jt{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qt.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.FM8(e,e)}return Promise.all(s)}}class Zt{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qt.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class $t{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qt.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new n.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,n.KI_)),void 0!==o.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),r.extras&&void 0!==r.extras.sheenFactor&&(t.sheen=r.extras.sheenFactor,delete r.extras.sheenFactor),Promise.all(s)}}class en{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qt.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class tn{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qt.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new n.Ilk(a[0],a[1],a[2]),Promise.all(s)}}class nn{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qt.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class rn{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qt.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new n.Ilk(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,n.KI_)),Promise.all(s)}}class sn{constructor(e){this.parser=e,this.name=qt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class on{constructor(e){this.parser=e,this.name=qt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class an{constructor(e){this.parser=e,this.name=qt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class ln{constructor(e){this.parser=e,this.name=qt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class cn{constructor(e){this.name=qt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(s*o);return r.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t}))}))}return null}}class un{constructor(e){this.name=qt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const r=t.meshes[i.mesh];for(const n of r.primitives)if(n.mode!==yn.TRIANGLES&&n.mode!==yn.TRIANGLE_STRIP&&n.mode!==yn.TRIANGLE_FAN&&void 0!==n.mode)return null;const s=i.extensions[this.name].attributes,o=[],a={};for(const n in s)o.push(this.parser.getDependency("accessor",s[n]).then((e=>(a[n]=e,a[n]))));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then((e=>{const t=e.pop(),i=t.isGroup?t.children:[t],r=e[0].count,s=[];for(const o of i){const e=new n.yGw,t=new n.Pa4,i=new n._fP,l=new n.Pa4(1,1,1),c=new n.SPe(o.geometry,o.material,r);for(let n=0;n<r;n++)a.TRANSLATION&&t.fromBufferAttribute(a.TRANSLATION,n),a.ROTATION&&i.fromBufferAttribute(a.ROTATION,n),a.SCALE&&l.fromBufferAttribute(a.SCALE,n),c.setMatrixAt(n,e.compose(t,i,l));c.sourceTrs=a;for(const n in a)"TRANSLATION"!==n&&"ROTATION"!==n&&"SCALE"!==n&&o.geometry.setAttribute(n,a[n]);n.Tme.prototype.copy.call(c,o),this.parser.assignFinalMaterial(c),s.push(c)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]})))}}const dn="glTF";class hn{constructor(e){this.name=qt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==dn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(e,12);let s=0;for(;s<i;){const t=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,1313821514===i){const i=new Uint8Array(e,12+s,t);this.content=n.decode(i)}else if(5130562===i){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class pn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=qt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const e=En[c]||c.toLowerCase();o[e]=s[c]}for(const c in e.attributes){const t=En[c]||c.toLowerCase();if(void 0!==s[c]){const i=n.accessors[e.attributes[c]],r=bn[i.componentType];l[t]=r.name,a[t]=!0===i.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=a[t];void 0!==i&&(n.normalized=i)}t(e)}),o,l)}))}))}}class fn{constructor(){this.name=qt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e.__hasGLTFUuid||(e=e.clone()),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class mn{constructor(){this.name=qt.KHR_MESH_QUANTIZATION}}class gn extends n._C8{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let s=0;s!==i;s++)t[s]=n[r+s];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=i-t,u=(n-t)/c,d=u*u,h=d*u,p=e*l,f=p-l,m=-2*h+3*d,g=h-d,_=1-m,v=g-d+u;for(let y=0;y!==o;y++){const e=s[f+y+o],t=s[f+y+a]*c,n=s[p+y+o],i=s[p+y]*c;r[y]=_*e+v*t+m*n+g*i}return r}}const _n=new n._fP;class vn extends gn{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return _n.fromArray(r).normalize().toArray(r),r}}const yn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},bn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},An={9728:n.TyD,9729:n.wem,9984:n.YLQ,9985:n.qyh,9986:n.aH4,9987:n.D1R},wn={33071:n.uWy,33648:n.OoA,10497:n.rpg},xn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},En={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Cn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Sn={CUBICSPLINE:void 0,LINEAR:n.NMF,STEP:n.Syv};function Mn(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Tn(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function In(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Pn(e){let t;const n=e.extensions&&e.extensions[qt.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+Rn(n.attributes):e.indices+":"+Rn(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,r=e.targets.length;i<r;i++)t+=":"+Rn(e.targets[i]);return t}function Rn(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function Dn(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const kn=new n.yGw;class Bn{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Wt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;"undefined"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||i||r&&s<98?this.textureLoader=new n.dpR(this.options.manager):this.textureLoader=new n.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};Mn(r,s,i),Tn(s,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[i,s]of e.children.entries())r(s,t.children[i])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[qt.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,s){i.load(n.Zp0.resolveURL(t.uri,r.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=xn[r.type],t=bn[r.componentType],i=!0===r.normalized,s=new t(r.count*e);return Promise.resolve(new n.TlE(s,e,i))}const s=[];return void 0!==r.bufferView?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],o=xn[r.type],a=bn[r.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,u=r.byteOffset||0,d=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,h=!0===r.normalized;let p,f;if(d&&d!==c){const e=Math.floor(u/d),i="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let c=t.cache.get(i);c||(p=new a(s,e*d,r.count*d/l),c=new n.vpT(p,d/l),t.cache.add(i,c)),f=new n.kB5(c,o,u%d/l,h)}else p=null===s?new a(r.count*o):new a(s,u,r.count*o),f=new n.TlE(p,o,h);if(void 0!==r.sparse){const t=xn.SCALAR,i=bn[r.sparse.indices.componentType],l=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,u=new i(e[1],l,r.sparse.count*t),d=new a(e[2],c,r.sparse.count*o);null!==s&&(f=new n.TlE(f.array.slice(),f.itemSize,f.normalized));for(let e=0,n=u.length;e<n;e++){const t=u[e];if(f.setX(t,d[e*o]),o>=2&&f.setY(t,d[e*o+1]),o>=3&&f.setZ(t,d[e*o+2]),o>=4&&f.setW(t,d[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let s=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then((function(t){t.name=o.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const i=(s.samplers||{})[o.sampler]||{};return t.magFilter=An[i.magFilter]||n.wem,t.minFilter=An[i.minFilter]||n.D1R,t.wrapS=wn[i.wrapS]||n.rpg,t.wrapT=wn[i.wrapT]||n.rpg,i.extras&&void 0!==i.extras.uuid&&(t.uuid=i.extras.uuid,t.__hasGLTFUuid=!0),r.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[l]=c,c}loadImageSource(e,t,i=!1,r=!1){const s=this,o=this.json,a=this.options;if(!r&&void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const l=o.images[e],c=self.URL||self.webkitURL;void 0===l.uri&&l.extras&&l.extras.uri&&(l.uri=l.extras.uri);let u=l.uri||"",d=!1,h=null;if(void 0===l.bufferView||i&&u){if(void 0===l.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else u=s.getDependency("bufferView",l.bufferView).then((function(e){d=!0;const t=new Blob([e],{type:l.mimeType});return u=c.createObjectURL(t),h=t,u}));const p=Promise.resolve(u).then((function(e){return new Promise((function(i,r){let o=i;!0===t.isImageBitmapLoader&&(o=function(e){const t=new n.xEZ(e);t.needsUpdate=!0,i(t)}),t.load(n.Zp0.resolveURL(e,a.path),o,void 0,(function(l){!0===t.isImageBitmapLoader?(t=new n.dpR(s.options.manager),o=i,t.setCrossOrigin(s.options.crossOrigin),t.setRequestHeader(s.options.requestHeader),t.load(n.Zp0.resolveURL(e,a.path),o,void 0,r)):r(l)}))}))})).then((function(r){var o;if(!0===d&&c.revokeObjectURL(u),r.userData.mimeType=l.mimeType||((o=l.uri).search(/\.jpe?g($|\?)/i)>0||0===o.search(/^data\:image\/jpeg/)?"image/jpeg":o.search(/\.webp($|\?)/i)>0||0===o.search(/^data\:image\/webp/)?"image/webp":"image/png"),r.flipY=!1,l.extras){if(void 0!==l.extras.flipY){if(!0===t.isImageBitmapLoader&&void 0!==typeof createImageBitmap){let e=r;const t=l.extras.flipY&&!e.flipY;createImageBitmap(e.source.data,{imageOrientation:t?"flipY":"none"}).then((function(t){e._newTex&&(e=e._newTex),e.source.data.close&&e.source.data.close(),e.source.data=t,e.source.needsUpdate=!0,e.needsUpdate=!0}))}r.flipY=l.extras.flipY,r.needsUpdate=!0,delete l.extras.flipY}void 0!==l.extras.uuid&&(r.source.uuid=l.extras.uuid),void 0!==l.extras.t_uuid&&(r.uuid=l.extras.t_uuid,r.__hasGLTFUuid=!0)}return l.uri&&"string"==typeof l.uri&&!1===d&&!l.uri.startsWith("/")&&(r.userData.rootPath=n.Zp0.resolveURL(l.uri,a.path)),h&&(r.userData.__sourceBlob=h),!i&&l.uri&&l.uri!==u&&s.loadImageSource(e,t,!0,!0).then((function(e){r.source.data&&r.source.data.close&&r.source.data.close(),r.dispose(),r.source=e.source,r.source.needsUpdate=!0,r.needsUpdate=!0,r.uuid=e.uuid,e.__hasGLTFUuid&&(r.__hasGLTFUuid=!0),r.flipY=e.flipY,r.userData=e.userData,r.setDirty&&r.setDirty(),e._newTex=r})),r})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),e}));return this.sourceCache[e]=p,p}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),r.extensions[qt.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[qt.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[qt.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==i&&(s.colorSpace=i),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new Qt.ObjectConstructors.PointsMaterial,n.F5T.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){const e="LineBasicMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new Qt.ObjectConstructors.LineBasicMaterial,n.F5T.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}const a=!(!i.userData||!i.userData.gltfExtensions||!i.userData.gltfExtensions.WEBGI_material_extras);if((r||s||o)&&!a){let e="ClonedMaterial:"+i.uuid+":";r&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return Qt.ObjectConstructors.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const a={},l=[];if((s.extensions||{})[qt.KHR_MATERIALS_UNLIT]){const e=r[qt.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),l.push(e.extendParams(a,s,t))}else{const i=s.pbrMetallicRoughness||{};if(a.color=new n.Ilk(1,1,1),a.opacity=1,Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==i.baseColorTexture&&l.push(t.assignTexture(a,"map",i.baseColorTexture,n.KI_)),a.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,a.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(l.push(t.assignTexture(a,"metalnessMap",i.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",i.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===s.doubleSided&&(a.side=n.ehD);const c=s.alphaMode||"OPAQUE";if("BLEND"===c?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===c&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==Qt.ObjectConstructors.MeshBasicMaterial&&(l.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new n.FM8(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&o!==Qt.ObjectConstructors.MeshBasicMaterial&&(l.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==Qt.ObjectConstructors.MeshBasicMaterial&&(a.emissive=(new n.Ilk).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==Qt.ObjectConstructors.MeshBasicMaterial&&l.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,n.KI_)),Promise.all(l).then((function(){const n=new o(a);return s.extras&&s.extras.uuid&&(n.uuid=s.extras.uuid),s.name&&(n.name=s.name),Tn(n,s),t.associations.set(n,{materials:e}),s.extensions&&Mn(r,n,s),n}))}createUniqueName(e){const t=n.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(e){return i[qt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return On(n,e,t)}))}const o=[];for(let a=0,l=e.length;a<l;a++){const i=e[a],l=Pn(i),c=r[l];if(c)o.push(c.promise);else{let e;e=i.extensions&&i.extensions[qt.KHR_DRACO_MESH_COMPRESSION]?s(i):On(new n.u9r,i,t),r[l]={primitive:i,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let c=0,u=o.length;c<u;c++){const e=void 0===o[c].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new Qt.ObjectConstructors.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.Wl3})),l.DefaultMaterial):this.getDependency("material",o[c].material);a.push(e)}var l;return a.push(t.loadGeometries(o)),Promise.all(a).then((function(i){const a=i.slice(0,i.length-1),l=i[i.length-1],c=[];for(let d=0,h=l.length;d<h;d++){const i=l[d],u=o[d];let h;const p=a[d];if(u.mode===yn.TRIANGLES||u.mode===yn.TRIANGLE_STRIP||u.mode===yn.TRIANGLE_FAN||void 0===u.mode)h=!0===s.isSkinnedMesh?new n.TUv(i,p):new n.Kj0(i,p),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),u.mode===yn.TRIANGLE_STRIP?h.geometry=C(h.geometry,n.UlW):u.mode===yn.TRIANGLE_FAN&&(h.geometry=C(h.geometry,n.z$h));else if(u.mode===yn.LINES)h=new n.ejS(i,p);else if(u.mode===yn.LINE_STRIP)h=new n.x12(i,p);else if(u.mode===yn.LINE_LOOP)h=new n.blk(i,p);else{if(u.mode!==yn.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new n.woe(i,p)}Object.keys(h.geometry.morphAttributes).length>0&&In(h,s),h.name=t.createUniqueName(s.name||"mesh_"+e),h.geometry&&s.extras&&s.extras.isGeometryUserData?(Tn(h.geometry,s),u.extensions&&Mn(r,h.geometry,u)):(Tn(h,s),u.extensions&&Mn(r,h,u)),t.assignFinalMaterial(h),c.push(h)}s.extensions&&c.forEach((e=>Mn(r,e,s)));for(let n=0,r=c.length;n<r;n++)t.associations.set(c[n],{meshes:e,primitives:n});if(1===c.length)return s.extensions&&Mn(r,c[0],s),c[0];const u=new n.ZAu;s.extensions&&Mn(r,u,s),t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new Qt.ObjectConstructors.PerspectiveCamera(n.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new Qt.ObjectConstructors.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Tn(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(e){const i=e.pop(),r=e,s=[],o=[];for(let a=0,l=r.length;a<l;a++){const e=r[a];if(e){s.push(e);const t=new n.yGw;null!==i&&t.fromArray(i.array,16*a),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}return new n.OdW(s,o)}))}loadAnimation(e){const t=this.json.animations[e],i=t.name?t.name:"animation_"+e,r=[],s=[],o=[],a=[],l=[];for(let n=0,c=t.channels.length;n<c;n++){const e=t.channels[n],i=t.samplers[e.sampler],c=e.target,u=c.node,d=void 0!==t.parameters?t.parameters[i.input]:i.input,h=void 0!==t.parameters?t.parameters[i.output]:i.output;void 0!==c.node&&(r.push(this.getDependency("node",u)),s.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",h)),a.push(i),l.push(c))}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const t=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=[];for(let i=0,c=t.length;i<c;i++){const e=t[i],c=r[i],u=s[i],d=o[i],h=a[i];if(void 0===e)continue;let p;switch(e.updateMatrix(),Cn[h.path]){case Cn.weights:p=n.dUE;break;case Cn.rotation:p=n.iLg;break;default:p=n.yC1}const f=e.name?e.name:e.uuid,m=void 0!==d.interpolation?Sn[d.interpolation]:n.NMF,g=[];Cn[h.path]===Cn.weights?e.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(f);let _=u.array;if(u.normalized){const e=Dn(_.constructor),t=new Float32Array(_.length);for(let n=0,i=_.length;n<i;n++)t[n]=_[n]*e;_=t}for(let t=0,i=g.length;t<i;t++){const e=new p(g[t]+"."+Cn[h.path],c.array,_,m);"CUBICSPLINE"===d.interpolation&&(e.createInterpolant=function(e){return new(this instanceof n.iLg?vn:gn)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}return new n.m7l(i,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),r=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)r.push(t.getDependency("node",s[a]));const o=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),o]).then((function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,kn)}));for(let r=0,s=n.length;r<s;r++)t.add(n[r]);return t}))}_loadNodeShallow(e){const t=this.json,i=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return l&&a.push(l),void 0!==s.camera&&a.push(r.getDependency("camera",s.camera).then((function(e){return r._getNodeRef(r.cameraCache,s.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===s.isBone?new n.N$j:t.length>1?new n.ZAu:1===t.length?t[0]:new n.Tme,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(s.name&&(a.userData.name=s.name,a.name=o),Tn(a,s),s.extensions&&Mn(i,a,s),void 0!==s.matrix){const e=new n.yGw;e.fromArray(s.matrix),a.applyMatrix4(e)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return r.associations.has(a)||r.associations.set(a,{}),r.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new n.ZAu;i.name&&(s.name=r.createUniqueName(i.name)),Tn(s,i),i.extensions&&Mn(t,s,i);const o=i.nodes||[],a=[];for(let n=0,l=o.length;n<l;n++)a.push(r.getDependency("node",o[n]));return Promise.all(a).then((function(e){for(let t=0,n=e.length;t<n;t++)s.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[i,s]of r.associations)(i instanceof n.F5T||i instanceof n.xEZ)&&t.set(i,s);return e.traverse((e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)})),t})(s),s}))}}function On(e,t,i){const r=t.attributes,s=[];function o(t,n){return i.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const n in r){const t=En[n]||n.toLowerCase();t in e.attributes||s.push(o(r[n],t))}if(void 0!==t.indices&&!e.index){const n=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));s.push(n)}return Tn(e,t),function(e,t,i){const r=t.attributes,s=new n.ZzF;if(void 0===r.POSITION)return;{const e=i.json.accessors[r.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new n.Pa4(t[0],t[1],t[2]),new n.Pa4(o[0],o[1],o[2])),e.normalized){const t=Dn(bn[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new n.Pa4,t=new n.Pa4;for(let n=0,r=o.length;n<r;n++){const r=o[n];if(void 0!==r.POSITION){const n=i.json.accessors[r.POSITION],s=n.min,o=n.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),n.normalized){const e=Dn(bn[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const a=new n.aLr;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}(e,t,i),Promise.all(s).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(r=!0),void 0!==e.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(i){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const n=t[0],o=t[1],a=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}class Ln extends Qt{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(Un)}async preparse(e,t){for(const n of this.preparsers)e=await n.process(e,t);return e}parse(e,t,n,i,r){this.preparse.call(this,e,r||t).then((e=>e?super.parse(e,t,n,i):i&&i(new ErrorEvent("no data")))).catch((e=>{console.error(e),i&&i(null!=e?e:new ErrorEvent("unknown error"))}))}transform(e,t){const n=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return n&&e.animations.length>0&&(n.animations=e.animations),null==n||n.traverse((e=>{e.userData.gltfUUID&&(e.uuid=e.userData.gltfUUID,delete e.userData.gltfUUID)})),n}register(e){return super.register(e)}}const Un={key:(e,t,n)=>e.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+n)||"",async process(e,n){var i;if("string"==typeof e)return e;if(!(new TextDecoder).decode(new Uint8Array(e,0,100)).includes("WebGiGLBWrapper"))return e;const r=new hn(e),s=JSON.parse(r.content||"{}");let o=r.body||e;const a=null===(i=s.asset)||void 0===i?void 0:i.encryption;if(!a)return o;const l=a.type,c=a.version;if("aesgcm"===l&&1===c){const i=await(0,t.getOrCall)(this.key,a,s,n)||"";try{o=(await(0,t.aesGcmDecrypt)(new Uint8Array(o),i)).buffer}catch(e){throw new ErrorEvent("decryption error")}}return o}};class Nn extends n.hH6{constructor(e){super(e),this.type=n.cLu}async loadAsync(e,t){const i=await this.parseAsync(e,t,!1),r=new n.IEO(i.data,i.width,i.height,n.wk1,this.type);return r.needsUpdate=!0,r.flipY=!0,r.colorSpace=n.KI_,r.minFilter=n.wem,r.magFilter=n.wem,r.source.data.complete=!0,r}async parseAsync(e,i,r=!1){let s=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const t=await super.loadAsync(e,i);e=URL.createObjectURL(t),s=!0}const o=await(0,t.imageUrlToImageData)(e);s&&URL.revokeObjectURL(e);let a=Uint8Array;this.type===n.cLu?a=Uint16Array:this.type===n.VzW&&(a=Uint32Array);const l=function(e,t=3,i=Uint16Array,r=!1){let s;const o=e.byteLength>>2,a=new i(o*t);for(let l=0;l<o;l++)s=Math.pow(2,e[4*l+3]-136),r?(a[l*t]=Math.min(e[4*l]*s,65504),a[l*t+1]=Math.min(e[4*l+1]*s,65504),a[l*t+2]=Math.min(e[4*l+2]*s,65504)):(a[l*t]=n.A5E.toHalfFloat(Math.min(e[4*l]*s,65504)),a[l*t+1]=n.A5E.toHalfFloat(Math.min(e[4*l+1]*s,65504)),a[l*t+2]=n.A5E.toHalfFloat(Math.min(e[4*l+2]*s,65504))),4===t&&(a[l*t+3]=n.A5E.toHalfFloat(1));return a}(o.data,4,a,r);return{data:l,width:o.width,height:o.height}}setDataType(e){return this.type=e,this}}class Fn extends n.Gql{constructor(e){super(e),this._imageLoader=new n.S3k(e)}static async LoadRootPathTextures(e,t,i,r=!0){var s;const o=[];for(const a of Array.isArray(e)?e:Object.values(null!=e?e:{})){const e=null===(s=null==a?void 0:a.userData)||void 0===s?void 0:s.rootPath,l=r&&a.image&&t[a.image];if(!e)continue;const c=i.importPath(e,{processImported:!1}).then((e=>{const i=null==e?void 0:e[0],r=null==i?void 0:i.source;if(!i||!r)return null;const s=new n.Hw6(r.data);return a.image&&(s.uuid=a.image),a.image=s.uuid,l||(t[s.uuid]=s),i.dispose(),s})).catch((e=>(console.error(e),delete a.userData.rootPath,null)));l?a.rootPathPromise=c:o.push(c)}await Promise.allSettled(o)}parseTextures2(e,t,i){var r,s;for(const l of e){const e=null===(r=null==l?void 0:l.userData)||void 0===r?void 0:r.rootPath;if(e&&(!l.image||!t[l.image])){const r=new n.Hw6(this._imageLoader.load(e,i));if(!r)continue;l.image&&(r.uuid=l.image),t[r.uuid]=r,l.image=r.uuid}l.userData=ce(l.userData,void 0,!1,{images:t})}const o=super.parseTextures(e,t),a={...o};for(const n of e)null===(s=n.rootPathPromise)||void 0===s||s.then((e=>{if(!e)return;const t=a[n.uuid];t.dispose(),t.source=e,t.source.needsUpdate=!0,t.needsUpdate=!0}));return o}parseMaterials2(e,t,n){const i={};return e.forEach((e=>{if(!e)return;const r={...e},s=Object.keys(r);for(const n of s)if("map"===n||n.endsWith("Map")){const e=r[n];"string"==typeof e&&(t[e]?r[n]=t[e]:(console.warn(`Texture ${e} not found`),delete r[n]))}r.userData&&(r.userData=ce(r.userData,void 0,!1,{textures:t}),r.userData.cloneId&&r.userData.uuid!==e.uuid&&(r.userData.uuid=e.uuid));const o=n.generateFromTemplateType(r.type,r);o&&(i[e.uuid]=o)})),i}}const jn="WEBGI_viewer";function zn(e){return new Nt(Ln,["gltf","glb","data:model/gltf"],!0,((t,n)=>{if(!t)return t;const i=t,r=new Fn(n.loadingManager);return i.register(Wn(r,e)),i.register(Qn(r)),i.register(qn(r)),i.register((e=>new $n(e))),i.register((e=>new ei(e))),i.register((e=>new ti(e))),i.register((e=>new ni(e))),i.register((t=>{var s,o,a,l,c,u,d,h,p;const f=t.getDependency;t.getDependency=async(e,n)=>{const i=await f.call(t,e,n);if(i&&i.userData){const e=i.userData.gltfExtensions;delete i.userData.gltfExtensions,i.userData=ce(i.userData,{},!1,{}),i.userData.gltfExtensions=e}return i};const m=De()+".drc",g=De()+".ktx2",_=null===(a=null===(o=null===(s=t.json)||void 0===s?void 0:s.extensionsRequired)||void 0===o?void 0:o.includes)||void 0===a?void 0:a.call(o,"KHR_draco_mesh_compression");if(_){const e=n.registerFile(m);e&&i.setDRACOLoader(e)}(null===(u=null===(c=null===(l=t.json)||void 0===l?void 0:l.extensionsUsed)||void 0===c?void 0:c.includes)||void 0===u?void 0:u.call(c,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(i.setMeshoptDecoder(window.MeshoptDecoder),t.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const v=null===(p=null===(h=null===(d=t.json)||void 0===d?void 0:d.extensionsUsed)||void 0===h?void 0:h.includes)||void 0===p?void 0:p.call(h,"KHR_texture_basisu");if(v){const e=n.registerFile(g);e&&(i.setKTX2Loader(e),t.options.ktx2Loader=e)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async i=>{_&&n.unregisterFile(m),v&&n.unregisterFile(g);const s=await Xn(t,e,r);i.scene&&(i.scene.__importedViewerConfig=s)}}})),i}))}const Gn="WEBGI_light_extras",Vn="WEBGI_object3d_extras",Hn="WEBGI_material_extras",Qn=e=>e=>({name:"__"+Vn,afterRoot:async e=>{(e.scenes||(e.scene?[e.scene]:[])).forEach((e=>{e.traverse((e=>{var t,n;if(!e||!e.isObject3D)return;const i=null===(n=null===(t=e.userData)||void 0===t?void 0:t.gltfExtensions)||void 0===n?void 0:n[Vn];if(!i)return void(e.isLight&&!e.isAmbientLight&&(e.castShadow=!0));const r=void 0!==i.castShadow||void 0!==i.receiveShadow;void 0!==i.castShadow&&(e.castShadow=i.castShadow),void 0!==i.receiveShadow&&(e.receiveShadow=i.receiveShadow),void 0!==i.visible&&(e.visible=i.visible),void 0!==i.frustumCulled&&(e.frustumCulled=i.frustumCulled),void 0!==i.renderOrder&&(e.renderOrder=i.renderOrder),void 0!==i.layers&&(e.layers.mask=i.layers),r&&(e.userData.__keepShadowDef=!0),delete e.userData.gltfExtensions[Vn]}))}))}}),Wn=(e,t)=>e=>({name:"__"+Hn,afterRoot:async e=>{var n,i,r;const s=e.scenes||(e.scene?[e.scene]:[]);for(const o of s){const e=null===(i=null===(n=o.userData)||void 0===n?void 0:n.gltfExtensions)||void 0===i?void 0:i[Hn],s=e&&await(null===(r=t.getPlugin(Ls))||void 0===r?void 0:r.importConfigResources(e.resources||{}))||{};o.traverse((e=>{var n,i;const r=null==e?void 0:e.material;if(!(null==r?void 0:r.isMaterial))return;const o=null===(i=null===(n=r.userData)||void 0===n?void 0:n.gltfExtensions)||void 0===i?void 0:i[Hn];o&&(void 0!==o.emissiveIntensity&&(r.emissiveIntensity=o.emissiveIntensity),void 0!==o.fog&&(r.fog=o.fog),void 0!==o.flatShading&&(r.flatShading=o.flatShading),void 0!==o.blending&&(r.blending=o.blending),void 0!==o.side&&(r.side=o.side),void 0!==o.shadowSide&&(r.shadowSide=o.shadowSide),void 0!==o.depthFunc&&(r.depthFunc=o.depthFunc),void 0!==o.depthTest&&(r.depthTest=o.depthTest),void 0!==o.depthWrite&&(r.depthWrite=o.depthWrite),void 0!==o.colorWrite&&(r.colorWrite=o.colorWrite),void 0!==o.vertexColors&&(r.vertexColors=o.vertexColors),void 0!==o.alphaTest&&(r.alphaTest=o.alphaTest),void 0!==o.envMapIntensity&&(r.envMapIntensity=o.envMapIntensity),void 0!==o.wireframe&&(r.wireframe=o.wireframe),void 0!==o.wireframeLinewidth&&(r.wireframeLinewidth=o.wireframeLinewidth),void 0!==o.wireframeLinecap&&(r.wireframeLinecap=o.wireframeLinecap),void 0!==o.wireframeLinejoin&&(r.wireframeLinejoin=o.wireframeLinejoin),void 0!==o.rotation&&(r.rotation=o.rotation),void 0!==o.polygonOffset&&(r.polygonOffset=o.polygonOffset),void 0!==o.polygonOffsetFactor&&(r.polygonOffsetFactor=o.polygonOffsetFactor),void 0!==o.polygonOffsetUnits&&(r.polygonOffsetUnits=o.polygonOffsetUnits),void 0!==o.dithering&&(r.dithering=o.dithering),void 0!==o.alphaToCoverage&&(r.alphaToCoverage=o.alphaToCoverage),void 0!==o.premultipliedAlpha&&(r.premultipliedAlpha=o.premultipliedAlpha),void 0!==o.toneMapped&&(r.toneMapped=o.toneMapped),void 0!==o.normalScale&&void 0!==r.normalScale&&(Array.isArray(o.normalScale)?r.normalScale.fromArray(o.normalScale):"number"==typeof o.normalScale?r.normalScale.set(o.normalScale,o.normalScale):t.console.warn("normalScale is not an array or number",o.normalScale)),void 0!==o.reflectivity&&(r.reflectivity=o.reflectivity),Object.entries(o).forEach((([e,t])=>{e.startsWith("_")||t&&t.resource&&"string"==typeof t.resource&&(r[e]=ce(t,r[e],!1,s))})),delete r.userData.gltfExtensions[Hn])})),e&&delete o.userData.gltfExtensions[Hn]}}}),qn=e=>t=>({name:"__"+Gn,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach((t=>{t.traverse((t=>{var n,i;if(!t.isLight)return;const r=null===(i=null===(n=t.userData)||void 0===n?void 0:n.gltfExtensions)||void 0===i?void 0:i[Gn];r&&(!t.shadow&&r.shadow&&console.error("Light has no shadow, cannot import",t,r),r.shadow&&t.shadow&&(void 0!==r.shadow.bias&&(t.shadow.bias=r.shadow.bias),void 0!==r.shadow.normalBias&&(t.shadow.normalBias=r.shadow.normalBias),void 0!==r.shadow.radius&&(t.shadow.radius=r.shadow.radius),void 0!==r.shadow.mapSize&&t.shadow.mapSize.fromArray(r.shadow.mapSize),void 0!==r.shadow.camera&&(t.shadow.camera=e.parseObject(r.shadow.camera))),delete t.userData.gltfExtensions[Gn])}))}))}});async function Xn(e,t,n,i){var r,s,o;if(!i){const r=e.json.scenes||[];if(1!==r.length){for(const i of r)await Xn(e,t,n,i);return}i=r[0]}const a=null===(r=i.extensions)||void 0===r?void 0:r[jn];if(!a)return;const l=[];Object.values(a.resources).forEach((e=>{Object.values(e).forEach((e=>{e.url&&("Uint16Array"===e.url.type&&e.url.data&&l.push(e.url),"Uint8Array"===e.url.type&&e.url.data&&l.push(e.url))}))}));for(const d of l){const t=d.data.image,n=e.json.images[t],i=await e.getDependency("bufferView",n.bufferView);if(n.mimeType.startsWith("image/")&&"Uint16Array"===d.type&&"rgbe"===d.encoding){const e=new Blob([i]);let t=URL.createObjectURL(e);(d.encodingVersion||1)<2&&(t="data:image/png;base64,"+btoa(await e.text())),d.data=(await(new Nn).parseAsync(t,void 0,!0)).data,URL.revokeObjectURL(t),delete d.encoding,delete d.encodingVersion}else d.data=i}const c={textures:{},materials:{}},u=a.resources;if(u.textures&&e.json.textures)for(const[d,h]of[...Object.entries(u.textures)]){if(h.uuid||!d)continue;delete u.textures[d];const t=e.json.textures.findIndex((t=>{var n,i,r,s,o,a,l;return(null===(n=t.extras)||void 0===n?void 0:n.uuid)===d||(null===(s=null===(r=null===(i=e.json.samplers)||void 0===i?void 0:i[t.sampler])||void 0===r?void 0:r.extras)||void 0===s?void 0:s.uuid)===d||(null===(l=null===(a=null===(o=e.json.images)||void 0===o?void 0:o[t.source])||void 0===a?void 0:a.extras)||void 0===l?void 0:l.t_uuid)===d}));t>=0&&(c.textures[d]=await e.getDependency("texture",t))}if(u.materials&&e.json.materials)for(const[d,h]of[...Object.entries(u.materials)]){if(h.uuid||!d)continue;delete u.materials[d];const n=e.json.materials.findIndex((e=>{var t;return(null===(t=e.extras)||void 0===t?void 0:t.uuid)===d}));n>=0&&(c.materials[d]=await e.getDependency("material",n),c.materials[d]=null===(o=null===(s=t.getPlugin(Ls))||void 0===s?void 0:s.materials)||void 0===o?void 0:o.processMaterial(c.materials[d],{}))}return a.resources=await t.getPlugin(Ls).importConfigResources(u||{},n,c),a}const Yn="WEBGI_materials_bumpmap",Kn="WEBGI_materials_displacementmap",Jn="WEBGI_materials_alphamap",Zn="WEBGI_materials_lightmap";class $n{constructor(e){this.parser=e,this.name=Yn}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.bumpScale&&(t.bumpScale=s.bumpScale),void 0!==s.bumpTexture&&r.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(r)}}class ei{constructor(e){this.parser=e,this.name=Kn}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.displacementScale&&(t.displacementScale=s.displacementScale),void 0!==s.displacementBias&&(t.displacementBias=s.displacementBias),void 0!==s.displacementTexture&&r.push(n.assignTexture(t,"displacementMap",s.displacementTexture)),Promise.all(r)}}class ti{constructor(e){this.parser=e,this.name=Zn}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.lightMapIntensity&&(t.lightMapIntensity=s.lightMapIntensity),void 0!==s.lightMapTexture&&r.push(n.assignTexture(t,"lightMap",s.lightMapTexture)),Promise.all(r)}}class ni{constructor(e){this.parser=e,this.name=Jn}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.alphaTexture&&r.push(n.assignTexture(t,"alphaMap",s.alphaTexture)),Promise.all(r)}}var ii=__webpackgi_require__(23);function ri(){return new Nt(ii.Q,["drc"],!0)}class si extends n.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new n.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),Ee(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[null==this?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;null===(e=this.shadow.map)||void 0===e||e.dispose(),null===(t=this.shadow.mapPass)||void 0===t||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[null==this?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[null==this?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[null==this?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=le(Ee({},t),!1),this.userData={},this.children=n,i.type="DirectionalLight2",i.target=this.target.position.toArray(),Object.assign(i,le(this,!0,e))}fromJSON(e,t){if("DirectionalLight2"!==e.type)return null;const n=e.target,i=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,ce(e,this,!0,t),n&&(e.target=n),i&&(void 0!==i.color&&this.color.set(i.color),void 0!==i.intensity&&(this.intensity=i.intensity),e.object=i),this}}class oi extends n.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i,r,s){super(e,t,n,i,r,s),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),Ee(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[null==this?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;null===(e=this.shadow.map)||void 0===e||e.dispose(),null===(t=this.shadow.mapPass)||void 0===t||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[null==this?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[null==this?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=le(Ee({},t),!1),this.userData={},this.children=n,i.type="SpotLight2",i.target=this.target.position.toArray(),Object.assign(i,le(this,!0,e))}fromJSON(e,t){return"SpotLight2"!==e.type?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),void 0!==e.object.distance&&(this.distance=e.object.distance),void 0!==e.object.angle&&(this.angle=e.object.angle),void 0!==e.object.decay&&(this.decay=e.object.decay),void 0!==e.object.penumbra&&(this.penumbra=e.object.penumbra),ce(e,this,!0,t),this):this)}}class ai extends n.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i){super(e,t,n,i),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),Ee(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[null==this?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;null===(e=this.shadow.map)||void 0===e||e.dispose(),null===(t=this.shadow.mapPass)||void 0===t||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[null==this?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[null==this?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=le(Ee({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,le(this,!0,e))}fromJSON(e,t){return"PointLight2"!==e.type?null:e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),void 0!==e.object.distance&&(this.distance=e.object.distance),void 0!==e.object.decay&&(this.decay=e.object.decay),ce(e,this,!0,t),this):this}}class li extends n.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(e,t),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),Ee(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=le(Ee({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,le(this,!0,e))}fromJSON(e,t){return"AmbientLight2"!==e.type?null:e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),ce(e,this,!0,t),this):this}}class ci extends n.aNw{load(e,t,i,r){const s=new n.hH6(this.manager);s.setPath(this.path),s.setResponseType("text"),s.load(e,(n=>{try{t(this.parse(n))}catch(t){r?r(t):console.error(t),this.manager.itemError(e)}}),i,r)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,i=null;const r=new n.Pa4(0,0,0),s=new n.Pa4(1,1,1),o=e.split(/[\n\r]+/g);let a=null,l=0;for(let n=0,d=o.length;n<d;n++){const e=o[n].trim(),c=e.split(/\s/g);switch(c[0]){case"TITLE":t=e.substring(7,e.length-1);break;case"LUT_3D_SIZE":const n=c[1];i=parseFloat(n),a=new Uint8Array(i*i*i*4);break;case"DOMAIN_MIN":r.x=parseFloat(c[1]),r.y=parseFloat(c[2]),r.z=parseFloat(c[3]);break;case"DOMAIN_MAX":s.x=parseFloat(c[1]),s.y=parseFloat(c[2]),s.z=parseFloat(c[3]);break;default:const o=parseFloat(c[0]),u=parseFloat(c[1]),d=parseFloat(c[2]);if(o>1||o<0||u>1||u<0||d>1||d<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");a[l+0]=255*o,a[l+1]=255*u,a[l+2]=255*d,a[l+3]=255,l+=4}}const c=new n.IEO;c.image.data=a,c.image.width=i,c.image.height=i*i,c.type=n.ywz,c.magFilter=n.wem,c.minFilter=n.wem,c.wrapS=n.uWy,c.wrapT=n.uWy,c.generateMipmaps=!1,c.needsUpdate=!0;const u=new n.JUT;return u.image.data=a,u.image.width=i,u.image.height=i,u.image.depth=i,u.type=n.ywz,u.magFilter=n.wem,u.minFilter=n.wem,u.wrapS=n.uWy,u.wrapT=n.uWy,u.wrapR=n.uWy,u.generateMipmaps=!1,u.needsUpdate=!0,{title:t,size:i,domainMin:r,domainMax:s,texture:c,texture3D:u}}}let ui=class{constructor({domainMax:e,domainMin:t,size:i,texture:r,texture3D:s,title:o}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=e,this.domainMin=t,this.size=i,this.texture=r,this.texture3D=s,this.title=o,this.uuid=n.M8C.generateUUID(),this.userData.__needsSourceBuffer=!0}fromJSON(e,t){return e.type!==this.type&&console.warn("WebGi LUTCubeLoader2: type mismatch while import",e,this),console.error("not supported"),this}toJSON(e){return he(this,e,this.texture.name)}};ui=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([de("LUTCubeTextureWrapper")],ui);class di extends ci{parse(e){const t=super.parse(e);return new ui(t)}}var hi={},pi=Uint8Array,fi=Uint16Array,mi=Uint32Array,gi=new pi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_i=new pi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vi=new pi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yi=function(e,t){for(var n=new fi(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new mi(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},bi=yi(gi,2),Ai=bi[0],wi=bi[1];Ai[28]=258,wi[258]=28;for(var xi=yi(_i,0),Ei=xi[0],Ci=xi[1],Si=new fi(32768),Mi=0;Mi<32768;++Mi){var Ti=(43690&Mi)>>>1|(21845&Mi)<<1;Ti=(61680&(Ti=(52428&Ti)>>>2|(13107&Ti)<<2))>>>4|(3855&Ti)<<4,Si[Mi]=((65280&Ti)>>>8|(255&Ti)<<8)>>>1}var Ii=function(e,t,n){for(var i=e.length,r=0,s=new fi(t);r<i;++r)++s[e[r]-1];var o,a=new fi(t);for(r=0;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){o=new fi(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],d=a[e[r]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)o[Si[d]>>>l]=c}else for(o=new fi(i),r=0;r<i;++r)e[r]&&(o[r]=Si[a[e[r]-1]++]>>>15-e[r]);return o},Pi=new pi(288);for(Mi=0;Mi<144;++Mi)Pi[Mi]=8;for(Mi=144;Mi<256;++Mi)Pi[Mi]=9;for(Mi=256;Mi<280;++Mi)Pi[Mi]=7;for(Mi=280;Mi<288;++Mi)Pi[Mi]=8;var Ri=new pi(32);for(Mi=0;Mi<32;++Mi)Ri[Mi]=5;var Di=Ii(Pi,9,0),ki=Ii(Pi,9,1),Bi=Ii(Ri,5,0),Oi=Ii(Ri,5,1),Li=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Ui=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},Ni=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Fi=function(e){return(e/8|0)+(7&e&&1)},ji=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof fi?fi:e instanceof mi?mi:pi)(n-t);return i.set(e.subarray(t,n)),i},zi=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new pi(0);var r=!t||n,s=!n||n.i;n||(n={}),t||(t=new pi(3*i));var o=function(e){var n=t.length;if(e>n){var i=new pi(Math.max(2*n,e));i.set(t),t=i}},a=n.f||0,l=n.p||0,c=n.b||0,u=n.l,d=n.d,h=n.m,p=n.n,f=8*i;do{if(!u){n.f=a=Ui(e,l,1);var m=Ui(e,l+1,3);if(l+=3,!m){var g=e[(M=Fi(l)+4)-4]|e[M-3]<<8,_=M+g;if(_>i){if(s)throw"unexpected EOF";break}r&&o(c+g),t.set(e.subarray(M,_),c),n.b=c+=g,n.p=l=8*_;continue}if(1==m)u=ki,d=Oi,h=9,p=5;else{if(2!=m)throw"invalid block type";var v=Ui(e,l,31)+257,y=Ui(e,l+10,15)+4,b=v+Ui(e,l+5,31)+1;l+=14;for(var A=new pi(b),w=new pi(19),x=0;x<y;++x)w[vi[x]]=Ui(e,l+3*x,7);l+=3*y;var E=Li(w),C=(1<<E)-1,S=Ii(w,E,1);for(x=0;x<b;){var M,T=S[Ui(e,l,C)];if(l+=15&T,(M=T>>>4)<16)A[x++]=M;else{var I=0,P=0;for(16==M?(P=3+Ui(e,l,3),l+=2,I=A[x-1]):17==M?(P=3+Ui(e,l,7),l+=3):18==M&&(P=11+Ui(e,l,127),l+=7);P--;)A[x++]=I}}var R=A.subarray(0,v),D=A.subarray(v);h=Li(R),p=Li(D),u=Ii(R,h,1),d=Ii(D,p,1)}if(l>f){if(s)throw"unexpected EOF";break}}r&&o(c+131072);for(var k=(1<<h)-1,B=(1<<p)-1,O=l;;O=l){var L=(I=u[Ni(e,l)&k])>>>4;if((l+=15&I)>f){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(L<256)t[c++]=L;else{if(256==L){O=l,u=null;break}var U=L-254;if(L>264){var N=gi[x=L-257];U=Ui(e,l,(1<<N)-1)+Ai[x],l+=N}var F=d[Ni(e,l)&B],j=F>>>4;if(!F)throw"invalid distance";if(l+=15&F,D=Ei[j],j>3&&(N=_i[j],D+=Ni(e,l)&(1<<N)-1,l+=N),l>f){if(s)throw"unexpected EOF";break}r&&o(c+131072);for(var z=c+U;c<z;c+=4)t[c]=t[c-D],t[c+1]=t[c+1-D],t[c+2]=t[c+2-D],t[c+3]=t[c+3-D];c=z}}n.l=u,n.p=O,n.b=c,u&&(a=1,n.m=h,n.d=d,n.n=p)}while(!a);return c==t.length?t:ji(t,0,c)},Gi=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8},Vi=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},Hi=function(e,t){for(var n=[],i=0;i<e.length;++i)e[i]&&n.push({s:i,f:e[i]});var r=n.length,s=n.slice();if(!r)return[Ji,0];if(1==r){var o=new pi(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,d=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=r-1;)a=n[n[c].f<n[d].f?c++:d++],l=n[c!=u&&n[c].f<n[d].f?c++:d++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var h=s[0].s;for(i=1;i<r;++i)s[i].s>h&&(h=s[i].s);var p=new fi(h+1),f=Qi(n[u-1],p,0);if(f>t){i=0;var m=0,g=f-t,_=1<<g;for(s.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));i<r;++i){var v=s[i].s;if(!(p[v]>t))break;m+=_-(1<<f-p[v]),p[v]=t}for(m>>>=g;m>0;){var y=s[i].s;p[y]<t?m-=1<<t-p[y]++-1:++i}for(;i>=0&&m;--i){var b=s[i].s;p[b]==t&&(--p[b],++m)}f=t}return[new pi(p),f]},Qi=function(e,t,n){return-1==e.s?Math.max(Qi(e.l,t,n+1),Qi(e.r,t,n+1)):t[e.s]=n},Wi=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new fi(++t),i=0,r=e[0],s=1,o=function(e){n[i++]=e},a=1;a<=t;++a)if(e[a]==r&&a!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(r);s=1,r=e[a]}return[n.subarray(0,i),t]},qi=function(e,t){for(var n=0,i=0;i<t.length;++i)n+=e[i]*t[i];return n},Xi=function(e,t,n){var i=n.length,r=Fi(t+2);e[r]=255&i,e[r+1]=i>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var s=0;s<i;++s)e[r+s+4]=n[s];return 8*(r+4+i)},Yi=function(e,t,n,i,r,s,o,a,l,c,u){Gi(t,u++,n),++r[256];for(var d=Hi(r,15),h=d[0],p=d[1],f=Hi(s,15),m=f[0],g=f[1],_=Wi(h),v=_[0],y=_[1],b=Wi(m),A=b[0],w=b[1],x=new fi(19),E=0;E<v.length;++E)x[31&v[E]]++;for(E=0;E<A.length;++E)x[31&A[E]]++;for(var C=Hi(x,7),S=C[0],M=C[1],T=19;T>4&&!S[vi[T-1]];--T);var I,P,R,D,k=c+5<<3,B=qi(r,Pi)+qi(s,Ri)+o,O=qi(r,h)+qi(s,m)+o+14+3*T+qi(x,S)+(2*x[16]+3*x[17]+7*x[18]);if(k<=B&&k<=O)return Xi(t,u,e.subarray(l,l+c));if(Gi(t,u,1+(O<B)),u+=2,O<B){I=Ii(h,p,0),P=h,R=Ii(m,g,0),D=m;var L=Ii(S,M,0);for(Gi(t,u,y-257),Gi(t,u+5,w-1),Gi(t,u+10,T-4),u+=14,E=0;E<T;++E)Gi(t,u+3*E,S[vi[E]]);u+=3*T;for(var U=[v,A],N=0;N<2;++N){var F=U[N];for(E=0;E<F.length;++E){var j=31&F[E];Gi(t,u,L[j]),u+=S[j],j>15&&(Gi(t,u,F[E]>>>5&127),u+=F[E]>>>12)}}}else I=Di,P=Pi,R=Bi,D=Ri;for(E=0;E<a;++E)if(i[E]>255){j=i[E]>>>18&31,Vi(t,u,I[j+257]),u+=P[j+257],j>7&&(Gi(t,u,i[E]>>>23&31),u+=gi[j]);var z=31&i[E];Vi(t,u,R[z]),u+=D[z],z>3&&(Vi(t,u,i[E]>>>5&8191),u+=_i[z])}else Vi(t,u,I[i[E]]),u+=P[i[E]];return Vi(t,u,I[256]),u+P[256]},Ki=new mi([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ji=new pi(0),Zi=function(e,t,n,i,r,s){var o=e.length,a=new pi(i+o+5*(1+Math.ceil(o/7e3))+r),l=a.subarray(i,a.length-r),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var d=u+65535;d<o?c=Xi(l,c,e.subarray(u,d)):(l[u]=s,c=Xi(l,c,e.subarray(u,o)))}else{for(var h=Ki[t-1],p=h>>>13,f=8191&h,m=(1<<n)-1,g=new fi(32768),_=new fi(m+1),v=Math.ceil(n/3),y=2*v,b=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<y)&m},A=new mi(25e3),w=new fi(288),x=new fi(32),E=0,C=0,S=(u=0,0),M=0,T=0;u<o;++u){var I=b(u),P=32767&u,R=_[I];if(g[P]=R,_[I]=P,M<=u){var D=o-u;if((E>7e3||S>24576)&&D>423){c=Yi(e,l,0,A,w,x,C,S,T,u-T,c),S=E=C=0,T=u;for(var k=0;k<286;++k)w[k]=0;for(k=0;k<30;++k)x[k]=0}var B=2,O=0,L=f,U=P-R&32767;if(D>2&&I==b(u-U))for(var N=Math.min(p,D)-1,F=Math.min(32767,u),j=Math.min(258,D);U<=F&&--L&&P!=R;){if(e[u+B]==e[u+B-U]){for(var z=0;z<j&&e[u+z]==e[u+z-U];++z);if(z>B){if(B=z,O=U,z>N)break;var G=Math.min(U,z-2),V=0;for(k=0;k<G;++k){var H=u-U+k+32768&32767,Q=H-g[H]+32768&32767;Q>V&&(V=Q,R=H)}}}U+=(P=R)-(R=g[P])+32768&32767}if(O){A[S++]=268435456|wi[B]<<18|Ci[O];var W=31&wi[B],q=31&Ci[O];C+=gi[W]+_i[q],++w[257+W],++x[q],M=u+B,++E}else A[S++]=e[u],++w[e[u]]}}c=Yi(e,l,s,A,w,x,C,S,T,u-T,c),!s&&7&c&&(c=Xi(l,c+1,Ji))}return ji(a,0,i+Fi(c)+r)},$i=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,i=9;--i;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),er=function(){var e=-1;return{p:function(t){for(var n=e,i=0;i<t.length;++i)n=$i[255&n^t[i]]^n>>>8;e=n},d:function(){return~e}}},tr=function(){var e=1,t=0;return{p:function(n){for(var i=e,r=t,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)r+=i+=n[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}e=i,t=r},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},nr=function(e,t,n,i,r){return Zi(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,i,!r)},ir=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n},rr=function(e,t,n){for(var i=e(),r=e.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=s[o];if("function"==typeof a){t+=";"+l+"=";var c=a.toString();if(a.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else for(var d in t+=c,a.prototype)t+=";"+l+".prototype."+d+"="+a.prototype[d].toString();else t+=c}else n[l]=a}return[t,n]},sr=[],or=function(e,t,n,i){var r;if(!sr[n]){for(var s="",o={},a=e.length-1,l=0;l<a;++l)s=(r=rr(e[l],s,o))[0],o=r[1];sr[n]=rr(e[a],s,o)}var c=ir({},sr[n][1]);return function(e,t,n,i,r){var s=new Worker(hi[t]||(hi[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))));return s.onerror=function(e){return r(e.error,null)},s.onmessage=function(e){return r(null,e.data)},s.postMessage(n,i),s}(sr[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,c,function(e){var t=[];for(var n in e)(e[n]instanceof pi||e[n]instanceof fi||e[n]instanceof mi)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(c),i)},ar=function(){return[pi,fi,mi,gi,_i,vi,Ai,Ei,ki,Oi,Si,Ii,Li,Ui,Ni,Fi,ji,zi,Lr,pr,fr]},lr=function(){return[pi,fi,mi,gi,_i,vi,wi,Ci,Di,Pi,Bi,Ri,Si,Ki,Ji,Ii,Gi,Vi,Hi,Qi,Wi,qi,Xi,Yi,Fi,ji,Zi,nr,Dr,pr]},cr=function(){return[wr,Cr,Ar,er,$i]},ur=function(){return[xr,Er]},dr=function(){return[Sr,Ar,tr]},hr=function(){return[Mr]},pr=function(e){return postMessage(e,[e.buffer])},fr=function(e){return e&&e.size&&new pi(e.size)},mr=function(e,t,n,i,r,s){var o=or(n,i,r,(function(e,t){o.terminate(),s(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},gr=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},_r=function(e,t,n,i,r){var s,o=or(e,i,r,(function(e,n){e?(o.terminate(),t.ondata.call(t,e)):(n[1]&&o.terminate(),t.ondata.call(t,e,n[0],n[1]))}));o.postMessage(n),t.push=function(e,n){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,s=n],[e.buffer])},t.terminate=function(){o.terminate()}},vr=function(e,t){return e[t]|e[t+1]<<8},yr=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},br=function(e,t){return yr(e,t)+4294967296*yr(e,t+4)},Ar=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},wr=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Ar(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var i=0;i<=n.length;++i)e[i+10]=n.charCodeAt(i)}},xr=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[n++]);return n+(2&t)},Er=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Cr=function(e){return 10+(e.filename&&e.filename.length+1||0)},Sr=function(e,t){var n=t.level,i=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},Mr=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Tr(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Ir=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(nr(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Pr=function(){return function(e,t){_r([lr,function(){return[gr,Ir]}],this,Tr.call(this,e,t),(function(e){var t=new Ir(e.data);onmessage=gr(t)}),6)}}();function Rr(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return mr(e,t,[lr],(function(e){return pr(Dr(e.data[0],e.data[1]))}),0,n)}function Dr(e,t){return nr(e,t||{},0,0)}var kr=function(){function e(e){this.s={},this.p=new pi(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new pi(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=zi(this.p,this.o,this.s);this.ondata(ji(n,t,this.s.b),this.d),this.o=ji(n,this.s.b-32768),this.s.b=this.o.length,this.p=ji(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Br=function(){return function(e){this.ondata=e,_r([ar,function(){return[gr,kr]}],this,0,(function(){var e=new kr;onmessage=gr(e)}),7)}}();function Or(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return mr(e,t,[ar],(function(e){return pr(Lr(e.data[0],fr(e.data[1])))}),1,n)}function Lr(e,t){return zi(e,t)}var Ur=function(){function e(e,t){this.c=er(),this.l=0,this.v=1,Ir.call(this,e,t)}return e.prototype.push=function(e,t){Ir.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=nr(e,this.o,this.v&&Cr(this.o),t&&8,!t);this.v&&(wr(n,this.o),this.v=0),t&&(Ar(n,n.length-8,this.c.d()),Ar(n,n.length-4,this.l)),this.ondata(n,t)},e}(),Nr=function(){return function(e,t){_r([lr,cr,function(){return[gr,Ir,Ur]}],this,Tr.call(this,e,t),(function(e){var t=new Ur(e.data);onmessage=gr(t)}),8)}}();function Fr(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return mr(e,t,[lr,cr,function(){return[jr]}],(function(e){return pr(jr(e.data[0],e.data[1]))}),2,n)}function jr(e,t){t||(t={});var n=er(),i=e.length;n.p(e);var r=nr(e,t,Cr(t),8),s=r.length;return wr(r,t),Ar(r,s-8,n.d()),Ar(r,s-4,i),r}var zr=function(){function e(e){this.v=1,kr.call(this,e)}return e.prototype.push=function(e,t){if(kr.prototype.e.call(this,e),this.v){var n=this.p.length>3?xr(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}kr.prototype.c.call(this,t)},e}(),Gr=function(){return function(e){this.ondata=e,_r([ar,ur,function(){return[gr,kr,zr]}],this,0,(function(){var e=new zr;onmessage=gr(e)}),9)}}();function Vr(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return mr(e,t,[ar,ur,function(){return[Hr]}],(function(e){return pr(Hr(e.data[0]))}),3,n)}function Hr(e,t){return zi(e.subarray(xr(e),-8),t||new pi(Er(e)))}var Qr=function(){function e(e,t){this.c=tr(),this.v=1,Ir.call(this,e,t)}return e.prototype.push=function(e,t){Ir.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=nr(e,this.o,this.v&&2,t&&4,!t);this.v&&(Sr(n,this.o),this.v=0),t&&Ar(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),Wr=function(){return function(e,t){_r([lr,dr,function(){return[gr,Ir,Qr]}],this,Tr.call(this,e,t),(function(e){var t=new Qr(e.data);onmessage=gr(t)}),10)}}();function qr(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return mr(e,t,[lr,dr,function(){return[Xr]}],(function(e){return pr(Xr(e.data[0],e.data[1]))}),4,n)}function Xr(e,t){t||(t={});var n=tr();n.p(e);var i=nr(e,t,2,4);return Sr(i,t),Ar(i,i.length-4,n.d()),i}var Yr=function(){function e(e){this.v=1,kr.call(this,e)}return e.prototype.push=function(e,t){if(kr.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}kr.prototype.c.call(this,t)},e}(),Kr=function(){return function(e){this.ondata=e,_r([ar,hr,function(){return[gr,kr,Yr]}],this,0,(function(){var e=new Yr;onmessage=gr(e)}),11)}}();function Jr(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return mr(e,t,[ar,hr,function(){return[Zr]}],(function(e){return pr(Zr(e.data[0],fr(e.data[1])))}),5,n)}function Zr(e,t){return zi((Mr(e),e.subarray(2,-4)),t)}var $r=function(){function e(e){this.G=zr,this.I=kr,this.Z=Yr,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new pi(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(r):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},e}(),es=function(){function e(e){this.G=Gr,this.I=Br,this.Z=Kr,this.ondata=e}return e.prototype.push=function(e,t){$r.prototype.push.call(this,e,t)},e}();function ts(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Vr(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Or(e,t,n):Jr(e,t,n)}function ns(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Hr(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Lr(e,t):Zr(e,t)}var is=function(e,t,n,i){for(var r in e){var s=e[r],o=t+r;s instanceof pi?n[o]=[s,i]:Array.isArray(s)?n[o]=[s[0],ir(i,s[1])]:is(s,o+"/",n,i)}},rs="undefined"!=typeof TextEncoder&&new TextEncoder,ss="undefined"!=typeof TextDecoder&&new TextDecoder,os=0;try{ss.decode(Ji,{stream:!0}),os=1}catch(fl){}var as=function(e){for(var t="",n=0;;){var i=e[n++],r=(i>127)+(i>223)+(i>239);if(n+r>e.length)return[t,ji(e,n-1)];r?3==r?(i=((15&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|i>>10,56320|1023&i)):t+=1&r?String.fromCharCode((31&i)<<6|63&e[n++]):String.fromCharCode((15&i)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(i)}},ls=function(){function e(e){this.ondata=e,os?this.t=new TextDecoder:this.p=Ji}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new pi(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=as(n),r=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,t)}},e}(),cs=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(us(e),this.d=t||!1)},e}();function us(e,t){if(t){for(var n=new pi(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}if(rs)return rs.encode(e);var r=e.length,s=new pi(e.length+(e.length>>1)),o=0,a=function(e){s[o++]=e};for(i=0;i<r;++i){if(o+5>s.length){var l=new pi(o+8+(r-i<<1));l.set(s),s=l}var c=e.charCodeAt(i);c<128||t?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(a(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++i))>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return ji(s,0,o)}function ds(e,t){if(t){for(var n="",i=0;i<e.length;i+=16384)n+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return n}if(ss)return ss.decode(e);var r=as(e),s=r[0];if(r[1].length)throw"invalid utf-8 data";return s}var hs=function(e){return 1==e?3:e<6?2:9==e?1:0},ps=function(e,t){return t+30+vr(e,t+26)+vr(e,t+28)},fs=function(e,t,n){var i=vr(e,t+28),r=ds(e.subarray(t+46,t+46+i),!(2048&vr(e,t+8))),s=t+46+i,o=yr(e,t+20),a=n&&4294967295==o?ms(e,s):[o,yr(e,t+24),yr(e,t+42)],l=a[0],c=a[1],u=a[2];return[vr(e,t+10),l,c,r,s+vr(e,t+30)+vr(e,t+32),u]},ms=function(e,t){for(;1!=vr(e,t);t+=4+vr(e,t+2));return[br(e,t+12),br(e,t+4),br(e,t+20)]},gs=function(e){var t=0;if(e)for(var n in e){var i=e[n].length;if(i>65535)throw"extra field too long";t+=i+4}return t},_s=function(e,t,n,i,r,s,o,a){var l=i.length,c=n.extra,u=a&&a.length,d=gs(c);Ar(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==s&&8),e[t++]=r&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var h=new Date(null==n.mtime?Date.now():n.mtime),p=h.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Ar(e,t,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),t+=4,null!=s&&(Ar(e,t,n.crc),Ar(e,t+4,s),Ar(e,t+8,n.size)),Ar(e,t+12,l),Ar(e,t+14,d),t+=16,null!=o&&(Ar(e,t,u),Ar(e,t+6,n.attrs),Ar(e,t+10,o),t+=14),e.set(i,t),t+=l,d)for(var f in c){var m=c[f],g=m.length;Ar(e,t,+f),Ar(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(a,t),t+=u),t},vs=function(e,t,n,i,r){Ar(e,t,101010256),Ar(e,t+8,n),Ar(e,t+10,n),Ar(e,t+12,i),Ar(e,t+16,r)},ys=function(){function e(e){this.filename=e,this.c=er(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),bs=function(){function e(e,t){var n=this;t||(t={}),ys.call(this,e),this.d=new Ir(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=hs(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){ys.prototype.push.call(this,e,t)},e}(),As=function(){function e(e,t){var n=this;t||(t={}),ys.call(this,e),this.d=new Pr(t,(function(e,t,i){n.ondata(e,t,i)})),this.compression=8,this.flag=hs(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){ys.prototype.push.call(this,e,t)},e}(),ws=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=us(e.filename),i=n.length,r=e.comment,s=r&&us(r),o=i!=e.filename.length||s&&r.length!=s.length,a=i+gs(e.extra)+30;if(i>65535)throw"filename too long";var l=new pi(a);_s(l,0,e,n,o);var c=[l],u=function(){for(var e=0,n=c;e<n.length;e++){var i=n[e];t.ondata(null,i,!1)}c=[]},d=this.d;this.d=0;var h=this.u.length,p=ir(e,{f:n,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),d){var e=t.u[h+1];e?e.r():t.d=1}d=1}}),f=0;e.ondata=function(n,i,r){if(n)t.ondata(n,i,r),t.terminate();else if(f+=i.length,c.push(i),r){var s=new pi(16);Ar(s,0,134695760),Ar(s,4,e.crc),Ar(s,8,f),Ar(s,12,e.size),c.push(s),p.c=f,p.b=a+f+16,p.crc=e.crc,p.size=e.size,d&&p.r(),d=1}else d&&u()},this.u.push(p)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,i=0,r=this.u;i<r.length;i++)n+=46+(l=r[i]).f.length+gs(l.extra)+(l.o?l.o.length:0);for(var s=new pi(n+22),o=0,a=this.u;o<a.length;o++){var l=a[o];_s(s,e,l,l.f,l.u,l.c,t,l.o),e+=46+l.f.length+gs(l.extra)+(l.o?l.o.length:0),t+=l.b}vs(s,e,this.u.length,n,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();function xs(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var i={};is(e,"",i,t);var r=Object.keys(i),s=r.length,o=0,a=0,l=s,c=new Array(s),u=[],d=function(){for(var e=0;e<u.length;++e)u[e]()},h=function(){var e=new pi(a+22),t=o,i=a-o;a=0;for(var r=0;r<l;++r){var s=c[r];try{var u=s.c.length;_s(e,a,s,s.f,s.u,u);var d=30+s.f.length+gs(s.extra),h=a+d;e.set(s.c,h),_s(e,o,s,s.f,s.u,u,a,s.m),o+=16+d+(s.m?s.m.length:0),a=h+u}catch(e){return n(e,null)}}vs(e,o,c.length,i,t),n(null,e)};s||h();for(var p=function(e){var t=r[e],l=i[t],p=l[0],f=l[1],m=er(),g=p.length;m.p(p);var _=us(t),v=_.length,y=f.comment,b=y&&us(y),A=b&&b.length,w=gs(f.extra),x=0==f.level?0:8,E=function(i,r){if(i)d(),n(i,null);else{var l=r.length;c[e]=ir(f,{size:g,crc:m.d(),c:r,f:_,m:b,u:v!=t.length||b&&y.length!=A,compression:x}),o+=30+v+w+l,a+=76+2*(v+w)+(A||0)+l,--s||h()}};if(v>65535&&E("filename too long",null),x)if(g<16e4)try{E(null,Dr(p,f))}catch(e){E(e,null)}else u.push(Rr(p,f,E));else E(null,p)},f=0;f<l;++f)p(f);return d}function Es(e,t){t||(t={});var n={},i=[];is(e,"",n,t);var r=0,s=0;for(var o in n){var a=n[o],l=a[0],c=a[1],u=0==c.level?0:8,d=(x=us(o)).length,h=c.comment,p=h&&us(h),f=p&&p.length,m=gs(c.extra);if(d>65535)throw"filename too long";var g=u?Dr(l,c):l,_=g.length,v=er();v.p(l),i.push(ir(c,{size:l.length,crc:v.d(),c:g,f:x,m:p,u:d!=o.length||p&&h.length!=f,o:r,compression:u})),r+=30+d+m+_,s+=76+2*(d+m)+(f||0)+_}for(var y=new pi(s+22),b=r,A=s-r,w=0;w<i.length;++w){var x=i[w];_s(y,x.o,x,x.f,x.u,x.c.length);var E=30+x.f.length+gs(x.extra);y.set(x.c,x.o+E),_s(y,r,x,x.f,x.u,x.c.length,x.o,x.m),r+=16+E+(x.m?x.m.length:0)}return vs(y,r,i.length,A,b),y}var Cs=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),Ss=function(){function e(){var e=this;this.i=new kr((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}(),Ms=function(){function e(e,t){var n=this;t<32e4?this.i=new kr((function(e,t){n.ondata(null,e,t)})):(this.i=new Br((function(e,t,i){n.ondata(e,t,i)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=ji(e,0)),this.i.push(e,t)},e.compression=8,e}(),Ts=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Cs},this.p=Ji}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),(e=e.subarray(i)).length)return this.push(e,t)}else{var s=0,o=0,a=void 0,l=void 0;this.p.length?e.length?((l=new pi(this.p.length+e.length)).set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var c=l.length,u=this.c,d=u&&this.d,h=function(){var e,t=yr(l,o);if(67324752==t){s=1,a=o,p.d=null,p.c=0;var i=vr(l,o+6),r=vr(l,o+8),d=2048&i,h=8&i,f=vr(l,o+26),m=vr(l,o+28);if(c>o+30+f+m){var g=[];p.k.unshift(g),s=2;var _,v=yr(l,o+18),y=yr(l,o+22),b=ds(l.subarray(o+30,o+=30+f),!d);4294967295==v?(e=h?[-2]:ms(l,o),v=e[0],y=e[1]):h&&(v=-1),o+=m,p.c=v;var A={name:b,compression:r,start:function(){if(!A.ondata)throw"no callback";if(v){var e=n.o[r];if(!e)throw"unknown compression type "+r;(_=v<0?new e(b):new e(b,v,y)).ondata=function(e,t,n){A.ondata(e,t,n)};for(var t=0,i=g;t<i.length;t++){var s=i[t];_.push(s,!1)}n.k[0]==g&&n.c?n.d=_:_.push(Ji,!0)}else A.ondata(null,Ji,!0)},terminate:function(){_&&_.terminate&&_.terminate()}};v>=0&&(A.size=v,A.originalSize=y),p.onfile(A)}return"break"}if(u){if(134695760==t)return a=o+=12+(-2==u&&8),s=3,p.c=0,"break";if(33639248==t)return a=o-=4,s=3,p.c=0,"break"}},p=this;o<c-4&&"break"!==h();++o);if(this.p=Ji,u<0){var f=s?l.subarray(0,a-12-(-2==u&&8)-(134695760==yr(l,a-16)&&4)):l.subarray(0,o);d?d.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(o),t);this.p=l.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function Is(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],i=function(){for(var e=0;e<n.length;++e)n[e]()},r={},s=e.length-22;101010256!=yr(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var o=vr(e,s+8);o||t(null,{});var a=o,l=yr(e,s+16),c=4294967295==l;if(c){if(s=yr(e,s-12),101075792!=yr(e,s))return void t("invalid zip file",null);a=o=yr(e,s+32),l=yr(e,s+48)}for(var u=function(s){var a=fs(e,l,c),u=a[0],d=a[1],h=a[2],p=a[3],f=a[4],m=a[5],g=ps(e,m);l=f;var _=function(e,n){e?(i(),t(e,null)):(r[p]=n,--o||t(null,r))};if(u)if(8==u){var v=e.subarray(g,g+d);if(d<32e4)try{_(null,Lr(v,new pi(h)))}catch(e){_(e,null)}else n.push(Or(v,{size:h},_))}else _("unknown compression type "+u,null);else _(null,ji(e,g,g+d))},d=0;d<a;++d)u();return i}function Ps(e){for(var t={},n=e.length-22;101010256!=yr(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var i=vr(e,n+8);if(!i)return{};var r=yr(e,n+16),s=4294967295==r;if(s){if(n=yr(e,n-12),101075792!=yr(e,n))throw"invalid zip file";i=yr(e,n+32),r=yr(e,n+48)}for(var o=0;o<i;++o){var a=fs(e,r,s),l=a[0],c=a[1],u=a[2],d=a[3],h=a[4],p=a[5],f=ps(e,p);if(r=h,l){if(8!=l)throw"unknown compression type "+l;t[d]=Lr(e.subarray(f,f+c),new pi(u))}else t[d]=ji(e,f,f+c)}return t}class Rs extends n.hH6{load(e,t,n,i){return this.setResponseType("arraybuffer"),super.load(e,(e=>{const n=Ps(new Uint8Array(e)),i=new Map(Object.entries(n).map((([e,t])=>[e,new File([t],e)])));null==t||t(i)}),n,i)}}class Ds extends t.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,t=!1){super(),this._processors=new zt,this._logger=console.log,this.Importers=[new Nt(Gt,["json"],!1),new Nt(n.hH6,["txt"],!1),new Nt(Nn,["rgbe.png","hdr.png","hdrpng"],!1),new Nt(n.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Nt(di,["cube"],!1),new Nt(Rs,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new n.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(Ht(e)),this.Importers.push(zn(e)),this.Importers.push(ri())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){var t;let n=decodeURI(e);const i=null===(t=this._rootContext)||void 0===t?void 0:t.rootUrl;n.includes("://")||!i||n.startsWith(i)||(n=i+n),n=n.replace("./",""),n=n.replace(/^(\/\/)/,"/"),n=n.replace(/\?.*$/,"");const r=this._fileDatabase.get(n);return r?r.ext?(r.objectUrl||(r.objectUrl=URL.createObjectURL(r)+"#"+n),r.objectUrl):(console.error("Unable to determine file extension",r),e):e}_createLoader(e){const t=this._getImporter(e),n=null==t?void 0:t.ctor(this);return n&&(null==t||t.ext.forEach((e=>{const t=new RegExp(e.startsWith("data:")?"^"+e+"\\/":"\\."+e+"$","i");this._loadingManager.addHandler(t,n)}))),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}addEventListener(e,t){if(super.addEventListener(e,t),"loaderCreate"===e)for(const n of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:n.loader})}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:i}=t;if(i&&i.length<1&&(i=void 0),0===e.size)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const r=[],s=[];if(e.forEach(((e,t)=>{var n;this.registerFile(t,e);const o=e.ext;o&&(null===(n=null==i?void 0:i.includes(o.toLowerCase()))||void 0===n||n)&&(this._isRootFileExtension(o)?r.push(t):s.push(t))})),r.length>0)for(const o of r){let e=await this._importFile(o,void 0,t);e&&(e=await this.processImported(e,t)),n.set(o,e)}else for(const o of s){let e=await this._importFile(o,void 0,t);e&&(e=await this.processImported(e,t)),n.set(o,e)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach(((e,t)=>{this.unregisterFile(t)})),n}registerFile(e,n){var i,r,s;e=e.replace(/\?.*$/,"");const o=null!==(i=null==n?void 0:n.ext)&&void 0!==i?i:null===(s=(0,t.parseFileExtension)(null!==(r=null==n?void 0:n.name)&&void 0!==r?r:e.trim()))||void 0===s?void 0:s.toLowerCase();n&&(n.ext||(n.ext=o),this._fileDatabase.set(e,n));let a=this._getLoader(e);if(a||(a=this._createLoader(null!=n?n:{name:e,ext:o})),a)for(const t of this._loaderCache)if(t.loader===a){t.files.push(e);break}return a}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);(null==t?void 0:t.objectUrl)&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return null!=this.Importers.find((t=>t.root&&t.ext.includes(e.toLowerCase())))}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,i={},r){var s,o;if(null==t?void 0:t.__imported)return t.__imported;let a;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const o=this.resolveURL(e),l=e.replace(/\?.*$/,"").trim(),c=null!==(s=i.fileHandler)&&void 0!==s?s:await this._loadingManager.getHandler(l)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0);if(!c)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:o,rootUrl:n.Zp0.extractUrlBase(e),baseUrl:n.Zp0.extractUrlBase(o)},a=await c.loadAsync(e+(i.queryString?(e.includes("?")?"&":"?")+i.queryString:""),(t=>{r&&r(t),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:t.loaded||void 0,totalBytes:t.total||void 0,progress:t.total>0?t.loaded/t.total:1})})),c.transform&&(a=await c.transform(a,i)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(n){return console.error("AssetImporter: Unable to import file",e,t),console.error(n),console.error(null==n?void 0:n.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:n}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t&&a){t.__imported=a;let e=[];Array.isArray(a)?e=a:(null===(o=a.userData)||void 0===o?void 0:o.rootSceneModelRoot)?e.push(...a.children):e.push(a),e.forEach((e=>{e.addEventListener&&e.addEventListener("dispose",(()=>{t.__imported=void 0}))}))}if(a&&"object"==typeof a){a.__rootPath=e;const n=t||this._fileDatabase.get(e);n&&(a.__rootBlob=n)}return a}_getImporter(e,t=!1){return this.Importers.find((n=>{if(t&&!n.root)return!1;const i=n.ext.find((t=>{var n,i,r;return e.ext&&t===e.ext.toLowerCase()||(null===(i=null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||void 0===i?void 0:i.endsWith("."+t.toLowerCase()))||(null==t?void 0:t.startsWith("data:"))&&(null===(r=e.name)||void 0===r?void 0:r.startsWith(t))}));return!!i&&(e.ext=i,!0)}))}_getLoader(e){var t;return null!==(t=this._loadingManager.getHandler(e.trim()))&&void 0!==t?t:void 0}async importAsset(e,t={},n){var i,r,s;if(!e)return[];if(!this._cachedAssets.includes(e)){if(1===Object.entries(e).length&&e.path){const t=this._cachedAssets.find((t=>t.path===e.path));t&&Object.assign(e,t)}const t=this._cachedAssets.findIndex((t=>t.path===e.path));t>=0&&this._cachedAssets.splice(t,1),this._cachedAssets.push(e)}let o;if((null==e?void 0:e.preImported)&&(o=await e.preImported),!t.forceImport&&o){const e=await this.processImported(o,t);let n=!1;for(const t of e){if((null===(i=t.userData)||void 0===i?void 0:i.rootSceneModelRoot)&&[...t.children,...t.__processedChildren||[]].find((e=>e.__disposed))){n=!0;break}if(t.__disposed){n=!0;break}}if(!n||!1===t.reimportDisposed)return e}const a=t.pathOverride||e.path;if(e.preImported=this._importFile(a,"function"==typeof(null===(r=e.file)||void 0===r?void 0:r.arrayBuffer)?e.file:void 0,t,n),o=await e.preImported,o&&(this.dispatchEvent({type:"processFileStart",path:a,result:o}),o=await this.processImported(o,t),this.dispatchEvent({type:"processFileEnd",path:a,result:o})),o){const t=[];Array.isArray(o)?t.push(...o):(null===(s=o.userData)||void 0===s?void 0:s.rootSceneModelRoot)?t.push(...o.children):t.push(o),t.forEach((t=>{var n;return null===(n=t.addEventListener)||void 0===n?void 0:n.call(t,"dispose",(()=>{(null==e?void 0:e.preImported)&&(e.preImported=void 0)}))}))}return o}async importSingle(e,t={}){var n;return"string"==typeof e?await this.importSinglePath(e,t):null===(n=await this.importAsset(e,t))||void 0===n?void 0:n[0]}async importSinglePath(e,t){var n;return null===(n=await this.importPath(e,t))||void 0===n?void 0:n[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed,delete n.fileHandler,delete n.importedFile;const i=JSON.stringify(n);let r;return r=this._cachedAssets.find((t=>t.path===e&&t._options===i))||{path:e},r._options=i,t.importedFile&&(r.file=t.importedFile),await this.importAsset(r,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var i,r,s,o,a,l,c,u;let d=e;if(!d)return[];if(!1===t.processImported)return[d];if(Array.isArray(d)){const e=[];for(const n of d)e.push(...await this.processImported(n,t));return e}if(null===(i=d.userData)||void 0===i?void 0:i.rootSceneModelRoot){if(t._rootSceneImported=!0,d.__processedChildren&&!t.forceImporterReprocess)return d.__processedChildren;if(!(d.children.length<1))return d.animations&&(d.children[0].animations||(d.children[0].animations=[]),d.children[0].animations.push(...d.animations)),d.__importedViewerConfig&&(d.children[0].__importedViewerConfig=d.__importedViewerConfig),d.userData.__importData&&(d.children[0].userData.__importData=d.userData.__importData),d.__processedChildren=await this.processImported([...d.children],t),d.__processedChildren;if((null===(r=d.animations)||void 0===r?void 0:r.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",d.animations),!d.__importedViewerConfig)return[];d=d.__importedViewerConfig}if((null===(s=d.userData)||void 0===s?void 0:s.iModel)&&(d=d.userData.iModel),(null===(o=d.userData)||void 0===o?void 0:o.iMaterial)&&(d=d.userData.iMaterial),d.assetImporterProcessed&&!t.forceImporterReprocess)return[d];const h=d.__rootPath,p=d.__rootBlob;if(!d.assetType){if(d.isBufferGeometry&&(d=new n.Kj0(d,new n.Wid)),d.isObject3D)if(d.isLight)d=Bs(d);else{const e=[];d.traverse((t=>{t!==d&&t.isLight&&e.push(t)}));for(const t of e)Bs(t);d=new Ft(d,t)}d.isTexture&&(d.assetType="texture",t._testDataTextureComplete&&(d.isDataTexture&&(null===(a=d.image)||void 0===a?void 0:a.data)&&(d.image.complete=!0),(null===(l=d.image)||void 0===l?void 0:l.complete)&&(d.needsUpdate=!0)),void 0!==t.generateMipmaps&&(d.generateMipmaps=t.generateMipmaps),d.generateMipmaps||d.isRenderTargetTexture||(d.minFilter=d.minFilter===n.D1R?n.wem:d.minFilter,d.magFilter=d.magFilter===n.D1R?n.wem:d.magFilter)),d.isMaterial&&(d.assetType="material")}if(null!=d.assetType)return d.userData&&(d.userData.rootPath||!h||h.startsWith("blob:")||h.startsWith("/")||(d.userData.rootPath=h),p&&(d.userData.__sourceBlob=p,d.userData.__needsSourceBuffer&&(d.userData.__sourceBuffer=await p.arrayBuffer(),delete d.userData.__needsSourceBuffer))),d=await this._processors.process(d.assetType,d,{}),d.assetImporterProcessed=!0,[d];if(d instanceof Map)return[...(await this.importFiles(d,t)).values()].flat();if(d.type&&"ViewerApp"!==d.type&&"ThreeViewer"!==d.type){const e=this._viewer.getPluginByType(d.type);if(e){let t=d._importedResources||{};return d.resources&&(t=await(null===(c=this._viewer.getManager())||void 0===c?void 0:c.importConfigResources(d.resources)),delete d.resources,d._importedResources=t),"function"==typeof e.fromJSON&&(await Promise.resolve(e.fromJSON(d,t)),d.assetImporterProcessed=!1),[]}}return d.plugins||"ViewerApp"===d.type||"ThreeViewer"===d.type?(d.resources=await(null===(u=this._viewer.getManager())||void 0===u?void 0:u.importConfigResources(d.resources)),await this._viewer.getManager().importViewerConfig(d),d.assetImporterProcessed=!1,[]):(console.warn("WebGi AssetImporter: unknown/null asset type: ",d,d.plugins),[d])}dispose(){var e;this.clearCache(),null===(e=this._processors)||void 0===e||e.dispose()}clearLoaderCache(){this._loaderCache.forEach((e=>{e.loader.dispose&&e.loader.dispose()})),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function ks(e){if(!e)return n.ywz;const t=e.extensions.has("EXT_color_buffer_half_float")||e.capabilities.isWebGL2&&e.extensions.has("EXT_color_buffer_float"),i=e.capabilities.isWebGL2||e.extensions.has("OES_texture_float")||e.extensions.has("WEBGL_color_buffer_float");return t?n.cLu:i?n.VzW:n.ywz}function Bs(e){var t,n;if(!e.isLight)return e;if("light"===e.assetType)return e;if(e.uiConfig)return console.warn("ui config already exists, not supported",e),e;let i;if(e.children.length,e.isDirectionalLight&&(i=new si),e.isAmbientLight&&(i=new li),e.isSpotLight&&(i=new oi),e.isPointLight&&(i=new ai),i){null===(n=(t=i.lightObject).copy)||void 0===n||n.call(t,e);const r=e.parent;(null==r?void 0:r.isObject3D)&&(r.remove(e),e.dispose(),e.userData.iModel=i,r.add(i.lightObject),i.uuid=e.uuid),ye(i.lightObject,r)}else console.warn("unknown light type: ",e);return i}class Os extends n.u7G{constructor(e){super(e)}async loadAsync(e,t){var i;const r=new n.hH6(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const s=await r.loadAsync(e,t);try{const e=JSON.parse(s);if(e.images&&this.importer){const t={};let r=e.images;Array.isArray(r)||(r=Object.values(r));for(const s of e.images){if(!s.url||!s.uuid)continue;const e=null===(i=await this.importer.importPath(s.url,{processImported:!1}))||void 0===i?void 0:i[0],r=null==e?void 0:e.source;if(!e||!r)continue;const o=new n.Hw6(r.data);o.uuid=s.uuid,t[o.uuid]=o,e.dispose()}return await Fn.LoadRootPathTextures(e.textures,t||e.images,this.importer),this.parse(e,t)}return this.parse(e)}catch(t){throw console.error(t),this.manager.itemError(e),t}}parse(e,t){var n,i;let r;const s={p:new Promise((e=>{r=e}))};if(e.images||e.textures){const n=new Fn(this.manager);let i={};const o=e=>{r(),s.p=void 0,Object.values(i).forEach((e=>{var t;e.isTexture&&(null===(t=e.image)||void 0===t?void 0:t.complete)&&(e.needsUpdate=!0)}))};let a=e.images||[];Array.isArray(a)||(a=Object.values(a));const l=t||n.parseImages(a,o);let c=e.textures;Array.isArray(c)||(c=Object.values(c)),i=n.parseTextures2(c,l,o),this.setTextures(i)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const o={...e};if(Object.entries(o).forEach((([e,t])=>{t&&"string"==typeof t&&this.textures[t]&&(o[e]=this.textures[t])})),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),void 0!==e.normalScale){const t=e.normalScale;!1===Array.isArray(t)&&(o.normalScale=[t,t])}let a=e.type;"MeshPhysicalMaterial"!==a&&"MeshStandardMaterial"!==a&&"PhysicalMaterial"!==a||(a=Pt.TYPE),o.userData=ce(o.userData,void 0,!1,this);const l=null!==(i=null===(n=this.materials)||void 0===n?void 0:n.generateFromTemplateType(a,o))&&void 0!==i?i:super.parse(e);return this.setTextures({}),l.userData.imageLoadAwaiter=s,l}}class Ls extends t.SimpleEventDispatcher{constructor(e,t,{simpleCache:i=!1,storage:r}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(i||r)&&(i&&(n.CtF.enabled=!0),r&&window.Cache&&"function"==typeof window.Cache&&r instanceof window.Cache)){const e={...n.CtF};n.CtF.get=(t,n,i)=>n?t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")?Promise.resolve(void 0):r.match(t).then((e=>{if(e)switch(n){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,null!=i?i:"text/html")));case"json":return e.json();default:if(void 0===i)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(i),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((e=>r.decode(e)))}}})):e.get(t),n.CtF.add=async(t,n,i)=>{if(!i)return e.add(t,n);t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")||(await r.match(t)&&await r.delete(t),await r.put(t,new Response(n,{status:200})))},n.CtF.remove=(t,n)=>{if(!n)return e.remove(t);r.delete(t)}}this.storage=r,this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("WebGi AssetManager: Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(e&&!e.split("?")[0].endsWith(".vjson")&&console.warn("WebGi AssetManager: Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map((n=>{var i;return null===(i=this._viewer)||void 0===i?void 0:i.scene.addSceneObject(n,{...t,allImported:e})}))}async addAssetSingle(e,t={}){var n;return e?null===(n=await("string"==typeof e?this.addFromPath:this.addAsset).call(this,e,t))||void 0===n?void 0:n[0]:void 0}async addImported(e,t={}){var n;return null===(n=this._importer)||void 0===n?void 0:n.processImported(e,t).then((e=>(this.addProcessedAssets(e,t),e)))}async addImportedSingle(e,t={}){return this.addImported(e,t).then((e=>null==e?void 0:e[0]))}_sceneUpdated(e){var t;if("addSceneObject"===e.type){const n=e.object;"material"===n.assetType&&(null===(t=this._materials)||void 0===t||t.processMaterial(n,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new Ut,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new Ds(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(e,t)=>(jt(e,(e=>{var t;return null===(t=this._materials)||void 0===t?void 0:t.processModel(e,{recursive:!1})})),e)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(e,t)=>{var i;return(null===(i=this.materials)||void 0===i?void 0:i.findMaterial(e.uuid))&&(console.warn("WebGi AssetManager: Material with same UUID already exists, creating new UUID"),e.uuid=n.M8C.generateUUID(),e.userData.uuid&&(e.userData.uuid=e.uuid)),this._materials.processMaterial(e,t)}})),this._importer.Importers.push(new Nt(Os,[Pt.TypeSlug],!1,(e=>(e&&(e.materials=this._materials),e&&(e.importer=this._importer),e))));const t=this.importViewerConfig.bind(this);this._importer.Importers.push(new Nt(class extends Gt{async loadAsync(e,n){return t(await super.loadAsync(e,n))}},[Ls.ViewerTypeSlug],!0))}onRemove(e){var t,n;e===this._viewer&&(null===(t=this._importer)||void 0===t||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),null===(n=this._materials)||void 0===n||n.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("AssetExporterPlugin"))||void 0===t?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,n){if(!this._viewer)return{};const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...n},r=this._viewer.toJSON(i);return e||Object.values(i).forEach((e=>{e&&Object.values(e).forEach((e=>{e.url&&(e.url.data instanceof ArrayBuffer||Array.isArray(e.url.data))&&("Uint16Array"===e.url.type?(e.url.data instanceof Uint16Array||(e.url.data=new Uint16Array(e.url.data)),e.url.data="data:application/octet-stream;base64,"+(0,t.arrayBufferToBase64)(e.url.data.buffer)):"Uint8Array"===e.url.type?(e.url.data instanceof Uint8Array||(e.url.data=new Uint8Array(e.url.data)),e.url.data="data:application/octet-stream;base64,"+(0,t.arrayBufferToBase64)(e.url.data.buffer)):e.url.data instanceof ArrayBuffer?e.url.data="data:application/octet-stream;base64,"+(0,t.arrayBufferToBase64)(e.url.data.buffer):console.warn("Unsupported buffer type",e.url.type))}))})),r.resources=i,r}exportPluginPresets(e){var t;const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:null===(t=this._viewer)||void 0===t?void 0:t.serializePlugins(n,e),resources:n}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){var n;const i=e.type;if(!(t=t||(null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType(i))))return void console.warn(`WebGi: No plugin found for type ${i} to import preset`);if(!t.fromJSON)return void console.warn(`WebGi: Plugin ${i} does not support importing presets`);const r=e.resources||{};e.resources&&delete e.resources;const s=await this.importConfigResources(r);return await t.fromJSON(e,s),s&&(e.resources=s),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("WebGi: No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){var n;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const e of Object.values(t.materials))e.__useCount?delete e.__useCount:null===(n=this._materials)||void 0===n||n.unregisterMaterial(e);for(const e of Object.values(t.textures))e.__useCount&&delete e.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("WebGi: No viewer or importer")}async importConfigResources(e,n,i){var r,s,o;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const a={};Object.values(e).forEach((e=>{e&&Object.values(e).forEach((e=>{if(!e||!e.url)return;if("string"!=typeof e.url.data)return;const n=e.url.data.match(/^data:.*;base64,(.*)$/);(null==n?void 0:n[1])?e.url.data=(0,t.base64ToArrayBuffer)(null==n?void 0:n[1]):("Uint8Array"!==e.url.type&&console.error("Unsupported buffer type string for ",e.url.type,"use base64"),e.url.data=(new TextEncoder).encode(e.url.data).buffer)}))})),n=null!=n?n:new Fn(this._importer.loadingManager),a.animations=e.animations?n.parseAnimations(e.animations):{},i&&i.animations&&(a.animations={...a.animations,...i.animations}),a.shapes=e.shapes?n.parseShapes(e.shapes):{},i&&i.shapes&&(a.shapes={...a.shapes,...i.shapes}),a.geometries=e.geometries?n.parseGeometries(e.geometries,a.shapes):{},i&&i.geometries&&(a.geometries={...a.geometries,...i.geometries}),a.images=e.images?await n.parseImagesAsync(Object.values(e.images)):{},i&&i.images&&(a.images={...a.images,...i.images}),await Fn.LoadRootPathTextures(e.textures,a.images,this._importer),a.textures=e.textures?n.parseTextures2(Object.values(e.textures),a.images,(()=>{Object.values(a.textures).forEach((e=>{var t;e.isTexture&&(null===(t=e.image)||void 0===t?void 0:t.complete)&&(e.needsUpdate=!0)}))})):{};for(const t of Object.entries(a.textures))t[1]=null===(r=await this._importer.processImported(t[1],{}))||void 0===r?void 0:r[0],t[1]?a.textures[t[0]]=t[1]:delete a.textures[t[0]];i&&i.textures&&(a.textures={...a.textures,...i.textures});const l=e.materials?Object.values(e.materials):[];for(const t of l)Object.entries(t).forEach((([e,n])=>{n&&n.resource&&n.uuid&&"textures"===n.resource&&(t[e]=n.uuid)}));if(a.materials=n.parseMaterials2(l,a.textures,this._materials),i&&i.materials&&(a.materials={...a.materials,...i.materials}),e.object&&(a.object=n.parseObject(e.object,a.geometries,a.materials,a.textures,a.animations),e.skeletons&&(a.skeletons=n.parseSkeletons(e.skeletons,a.object),n.bindSkeletons(a.object,a.skeletons))),e.extras){a.extras=e.extras;for(const n of Object.values(e.extras))if(n.uuid&&n.url)if("string"==typeof n.url){const e=await(null===(s=this._importer)||void 0===s?void 0:s.importPath(n.url));(null==e?void 0:e.length)>0&&(a.extras[n.uuid]=e[0])}else if(n.url.data){const e=new File([(0,t.getTypedArray)(n.url.type,n.url.data)],n.url.path),i=await(null===(o=this._importer)||void 0===o?void 0:o.importAsset({path:e.name,file:e}));(null==i?void 0:i.length)>0&&(a.extras[n.uuid]=i[0])}else console.warn("WebGi: invalid URL type while loading extra resource")}return i&&i.extras&&(a.extras={...a.extras,...i.extras}),a.__isLoadedResources=!0,a}}Ls.PluginType="AssetManager",Ls.ViewerTypeSlug="vjson";class Us{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),null==e||e.addEventListener("dragover",this._onDragover,!1),null==e||e.addEventListener("drop",this._onDrop,!1),null==t||t.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach((([e,t])=>t&&this.on(e,t)))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach((e=>e(t))),this}destroy(){const e=this._el,t=this._inputEl;null==e||e.removeEventListener("dragover",this._onDragover),null==e||e.removeEventListener("drop",this._onDrop),null==t||t.removeEventListener("change",this._onSelect)}_onDrop(e){var t,n;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const i=Array.from((null===(t=e.dataTransfer)||void 0===t?void 0:t.files)||[]),r=Array.from((null===(n=e.dataTransfer)||void 0===n?void 0:n.items)||[]);if(0!==i.length||0!==r.length)if(r.length>0){const e=r.map((e=>e.webkitGetAsEntry()));this._loadNextEntry(new Map,e)}else this._emit("drop",{files:new Map(i.map((e=>(e.filePath=e.name,[e.filePath,e]))))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var t;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const n=[].slice.call(null!==(t=this._inputEl.files)&&void 0!==t?t:new FileList),i=new Map;n.forEach((e=>{e.filePath=e.webkitRelativePath||e.name,i.set(e.filePath,e)})),this._emit("drop",{files:i})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file((i=>{i.filePath=n.fullPath,e.set(n.fullPath,i),this._loadNextEntry(e,t)}),(()=>console.error("Could not load file: %s",n.fullPath)));else if(n.isDirectory){const i=n.createReader(),r=n=>{n.length?(t=t.concat(n),i.readEntries(r)):this._loadNextEntry(e,t)};i.readEntries(r)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Ns extends t.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new n.Pa4(.5,.5,3)},this.dependencies=[Ls],this.uiConfig={type:"folder",label:"Drop Options",expanded:!0,children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new Us(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var t,n,i,r,s,o;if(!e)return;const a=this._viewer;if(!a)return;if(void 0!==this._allowedExtensions)for(const u of e.keys())this._allowedExtensions.includes(null!==(n=null===(t=u.split(".").pop())||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"")||e.delete(u);if(e.size<1)return;const l=a.getPlugin(Ls),c={type:"drop",files:e};if(this.importerParams.autoImport){const t={allowedExtensions:this.allowedExtensions,...this.importerParams};if(c.imported=await(null===(i=l.importer)||void 0===i?void 0:i.importFiles(e,t)),this.importerParams.autoAdd){const e=null!==(o=[...null!==(s=null===(r=c.imported)||void 0===r?void 0:r.values())&&void 0!==s?s:[]].flat(2).filter((e=>!!e)))&&void 0!==o?o:[];if(c.assets=l.addProcessedAssets(e,{...this.importerParams}),!t._rootSceneImported)for(const t of c.assets)t.modelObject&&t.modelObject.dispatchEvent({type:"select",value:t.modelObject})}}this.dispatchEvent(c)}promptForFile(){var e;null===(e=this._inputEl)||void 0===e||e.click()}onRemove(e){var t;null===(t=this._dropzone)||void 0===t||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map((e=>"."+e)).join(", "):"")}}Ns.PluginType="Dropzone";var Fs=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};function js(e){return Object.getPrototypeOf(e).constructor.PluginType}class zs extends t.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:i=!1,useRgbm:r=!0,useGBufferDepth:s=!1,screenShader:o="",...a}){var l;super(),this.console=console,this._state=e.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver((e=>this.resize())):void 0,this._lastSize=new n.FM8,this._onContextRestore=e=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=e=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this.rendersPerFrame=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===Gs&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=e=>{var t;if(!e||!e.object)return;const n=e.object.__importedViewerConfig||(null===(t=e.object.modelObject)||void 0===t?void 0:t.__importedViewerConfig);if(!n)return;const i=this.getManager();!function(e,t){var n;const i=(t.version?t.version:"0.0.0").split(".").map((e=>parseInt(e)));if("ViewerApp"!==t.type||0!==i[0]||!(i[1]<7||7===i[1]&&i[2].toString()[0]<"6"))return;const r=new Set;((null===(n=e.options)||void 0===n?void 0:n.allImported)?e.options.allImported:[e.object]).forEach((e=>e.traverse((e=>{e.material&&r.add(e.material)})))),r.forEach((e=>{const t=e.map;if(!t)return;const n=t.repeat,i=t.offset,r=t.center,s=t.rotation;["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","lightMap","metalnessMap","normalMap","roughnessMap","transmissionMap"].forEach((t=>{const o=e[t];o&&(o.repeat.copy(n),o.offset.copy(i),o.center.copy(r),o.rotation=s,o.needsUpdate=!0)})),e.needsUpdate=!0}))}(e,n),i?i.applyViewerConfig(n,n.resources):this.fromJSON(n,n.resources)},this.alert=async e=>alert(e),this.confirm=async e=>confirm(e),this.prompt=async(e,t,n=!0)=>prompt(e,t),this._useRgbm=r,this._useGBufferDepth=s,this._screenShader=o,this._canvas=a.canvas||(0,t.createCanvasElement)();let c=a.container;if(c&&!a.canvas&&c.appendChild(this._canvas),c||(c=null!==(l=this._canvas.parentElement)&&void 0!==l?l:void 0),!c)throw new Error("No container.");this._container=c,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var e;const n=window.location.href,i="https://dev-sandbox.pixotronics.com/webgi/";if(!n.startsWith(i))return!0;if(null!==(0,t.getUrlQueryParam)("noUpdate"))return!0;const r=null===(e=n.match(/\/webgi\/([0-9.a-zA-Z-]+)/))||void 0===e?void 0:e[1],s=(await(await fetch(i+"version.txt")).text()).split("\n")[0];if(r&&r!==s){if(confirm(`New version ${s} is available, do you want to open?`)){const e=window.location.href.replace(r,s);return window.location.href=e,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const u=new nt(void 0,void 0,this._canvas);u.autoLookAtTarget=!0,this.addEventListener("postFrame",(()=>{var e,t;const n=h.scene.activeCamera;if(n&&n.interactionsEnabled){const i=null===(e=this.getPluginByType("Progressive"))||void 0===e?void 0:e.postFrameConvergedRecordingDelta();if(void 0!==i&&0===i)return;null===(t=n.controls)||void 0===t||t.update()}})),this.scene=new rt(u),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new fe({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:i?4:0,colorSpace:r?D:n.aCh,type:r?n.ywz:n.cLu,depthBuffer:!s,generateMipmaps:!!i,minFilter:i?n.FDw:n.wem}}),this._isAntialiased=i&&this._renderer.isWebGL2;let d=!0;this._renderer.rendererObject.userData||(d=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!d;const h=this;this.renderFilter={passId:"render",passObject:new wt(this,d),update(){const e=this.passObject;e.scene=h.scene.modelObject,e.camera=h.scene.renderCamera.cameraObject}};const p={passId:"screen",after:["render"],required:["render"],passObject:Vs(o)};[this.renderFilter,p].forEach((e=>this._renderer.registerPass(e))),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",(e=>this.setDirty(this.scene,e))),this.scene.addEventListener("sceneMaterialUpdate",(e=>this.setDirty(this.scene,e))),this.scene.addEventListener("sceneUpdate",(e=>{this.setDirty(this.scene,e),!1!==e.geometryChanged&&this.renderer.resetShadows()})),this.scene.addEventListener("update",(e=>this.setDirty(this.scene,e))),this._renderer.addEventListener("update",(e=>this.setDirty(this._renderer,e))),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",(()=>{this.scene.activeCamera.refreshAspect()})),this.scene.setBackgroundColor("#ffffff"),a.assetManager&&this.addPluginSync(new Ls(void 0,void 0,"boolean"==typeof a.assetManager?{}:a.assetManager)),a.dropzone&&this.addPluginSync(new Ns),this.console.log("WebGi Viewer instance initialized, version: ",zs.VERSION)}setDirty(e,t){this._needsReset=!0,e=null!=e?e:this,this.dispatchEvent({...null!=t?t:{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const t of[...Object.values(this.plugins)])this.removePlugin(t,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),null===(e=window.webGiViewers)||void 0===e||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){var i,r;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let s=0;s<this.maxFramePerLoop;s++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const e=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const t=null===(r=null===(i=this._renderer.rendererObject.xr.getCamera())||void 0===i?void 0:i.cameras[0])||void 0===r?void 0:r.viewport;t?(0===t.x&&0===t.y||this.console.warn("x and y must be 0?"),e[0]=t.width,e[1]=t.height,this.console.log("resize for xr",e)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...e),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const s=Object.values(this.plugins).filter((e=>e.dirty));s.length>0&&this.setDirty(s),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const o=this._renderer.dirty;if(o)for(let t=0;t<this.rendersPerFrame;t++){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(this._renderer.defaultRenderToScreen)}catch(e){this.console.error(e),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!o)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._canvas.parentElement!==this._container&&this.console.error("ViewerApp: Canvas is not in the container, this might cause issues with some plugins."),this._container}get canvas(){return this._canvas}get canvasTexture(){if(!this._canvas)throw new Error("Canvas not found");return this._canvasTexture||(this._canvasTexture=new n.ROQ(this._canvas),this._canvasTexture.flipY=!1,this._canvasTexture.needsUpdate=!0),this._canvasTexture}getPlugin(e){return"string"==typeof e?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...t){return this.getPlugin(e)||this.addPlugin(e,...t)}getOrAddPluginSync(e,...t){return this.getPlugin(e)||this.addPluginSync(e,...t)}async addPlugin(e,...t){let n;if(e.prototype){const i=this.getPlugin(e);if(i)return console.error(`Plugin of type ${js(i)} already exists, no new plugin created`,i),i;n=new e(...t)}else n=e;const i=js(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const r of n.dependencies||[])await this.getOrAddPlugin(r);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),await this.removePlugin(this.plugins[i],!0)),this.plugins[i]=n,await n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}addPluginSync(e,...t){let n;if(e.prototype){const i=this.getPlugin(e);if(i)return console.error(`Plugin of type ${js(i)} already exists, no new plugin created`,i),i;n=new e(...t)}else n=e;const i=js(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const r of n.dependencies||[])this.getOrAddPluginSync(r);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),this.removePluginSync(this.plugins[i],!0)),this.plugins[i]=n,n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}async addPlugins(e){for(const t of e)await this.addPlugin(t)}async addPluginsSync(e){for(const t of e)this.addPluginSync(t)}async removePlugin(e,t=!0){const n=js(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,t=!0){const n=js(e);this.plugins[n]&&(e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){var t;const n=null!==(t=e.userData.iCamera)&&void 0!==t?t:new nt(e,{controlsMode:"",aspect:"auto"},this._canvas);return void 0===e.userData.autoLookAtTarget?(n.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):n.autoLookAtTarget=e.userData.autoLookAtTarget,n}setSize(e){this._canvas.style.width=(null==e?void 0:e.width)?e.width+"px":"100%",this._canvas.style.height=(null==e?void 0:e.height)?e.height+"px":"100%",this.resize()}async doOnce(e,t){return new Promise((n=>{const i=async(...r)=>{this.removeEventListener(e,i),n(await(null==t?void 0:t(...r)))};this.addEventListener(e,i)}))}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,null==e||"string"!=typeof e&&"number"!=typeof e&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===Gs)return this.scene.setBackground("environment");!e||(null==e?void 0:e.isTexture)?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){var t;if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let n=null!==(t=this._rawBackground)&&void 0!==t?t:this.scene.getBackground();return n?((null==n?void 0:n.isVector4)&&(n=Et(n,7).getHexString()),(null==n?void 0:n.isColor)?n.getHexString():this._rawBackground===Gs?this.scene.getEnvironment():n):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(Ls)}resetCamera({rootObject:e,centerOffset:t=new n.Pa4(1,1,1),targetOffset:i=new n.Pa4(0,0,0),...r}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const r=e?(new p).expandByObject(e,!0,!0):this.scene.getBounds(!0),s=r.getCenter(new n.Pa4),o=.5*r.getSize(new n.Pa4).length();s.add(i.clone().multiplyScalar(o)),this.scene.activeCamera.position=new n.Pa4(s.x+t.x*o,s.y+t.y*o,s.z+t.z*o),this.scene.activeCamera.target=s,this.setDirty()}}async fitToView(e,t=1.5,n,i){var r,s;const o=this.getPluginByType("CameraViews");o?await(null==o?void 0:o.animateToFitObject(e,t,n,i,{min:(null!==(s=null===(r=this.scene.activeCamera.getControls())||void 0===r?void 0:r.minDistance)&&void 0!==s?s:.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e,t=!1){var i;return null===(i=this.getManager())||void 0===i?void 0:i.addImportedSingle(e||new n.Tme,{autoScale:!1,pseudoCenter:!1,addToRoot:t})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var n,i,r,s;if(null==t?void 0:t.isMaterial){const e=null===(i=null===(n=this.getManager())||void 0===n?void 0:n.materials)||void 0===i?void 0:i.findMaterial(t.uuid);if(e)return e}return null===(s=null===(r=this.getManager())||void 0===r?void 0:r.materials)||void 0===s?void 0:s.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map((n=>{var i,r;if(!t||t.includes(n[1].constructor.PluginType))return!1!==n[1].serializeWithViewer?null===(r=(i=n[1]).toJSON)||void 0===r?void 0:r.call(i,e):void 0})).filter((e=>!!e))}deserializePlugins(e,t){return e.forEach((e=>{var n;if(!e.type)return void this.console.warn("Invalid plugin to import ",e);const i=this.getPluginByType(e.type);i&&(null===(n=i.fromJSON)||void 0===n||n.call(i,e,t))})),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){const n=Object.assign({version:zs.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,t)},le(this,!0,e));return n.backgroundIntensity=this.scene.backgroundIntensity,n.useLegacyLights=this.renderer.useLegacyLights,n.background=n.scene.background||n.scene.backgroundColor,"environment"===n.background&&(n.background="envMapBackground"),n}fromJSON(e,t){var i,r,s,o,a;const l={...e};return void 0!==l.backgroundIntensity&&void 0===(null===(i=l.scene)||void 0===i?void 0:i.backgroundIntensity)&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=l.backgroundIntensity,delete l.backgroundIntensity),void 0!==l.useLegacyLights&&void 0===(null===(r=l.renderManager)||void 0===r?void 0:r.useLegacyLights)&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=l.useLegacyLights,delete l.useLegacyLights),void 0!==l.background&&void 0===(null===(s=l.scene)||void 0===s?void 0:s.background)&&(this.console.warn("old file format, background moved to RootScene"),"envMapBackground"===l.background?l.background="environment":"number"==typeof l.background?l.background=(new n.Ilk).setHex(l.background,n.GUF):"string"==typeof l.background?l.background=(new n.Ilk).setStyle(l.background,n.GUF):(null===(o=l.background)||void 0===o?void 0:o.isColor)&&(l.background=new n.Ilk(l.background)),(null===(a=l.background)||void 0===a?void 0:a.isColor)?(this.scene.backgroundColor=l.background,this.scene.background=null):l.background?(this.scene.backgroundColor=new n.Ilk("#ffffff"),l.scene.background=l.background):(this.scene.backgroundColor=null,this.scene.background=null),delete l.background),ce(l,this,!0,t),Array.isArray(l.plugins)&&this.deserializePlugins(l.plugins,t),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,t){if(e)return await this.assetManager.addAssetSingle(e,t)}async setEnvironmentMap(e,{setBackground:t=!1,...n}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:t=!1,...n}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if("setView"===e.type){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else"activateMain"===e.type&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}zs.VERSION="0.9.20",Fs([re("renderManager")],zs.prototype,"_renderer",void 0),Fs([re()],zs.prototype,"scene",void 0),Fs([(0,t.onChange)(zs.prototype._renderEnabledChanged)],zs.prototype,"renderEnabled",void 0);const Gs="envMapBackground";function Vs(e){return(null==e?void 0:e.isShaderPass2)?e:new ht({...i,fragmentShader:`\n                       varying vec2 vUv;\n                       \n                       ${Array.isArray(e)?e[0]:(null==e?void 0:e.pars)||""}\n                       \n                       void main() {\n\n                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));\n                            \n                            ${Array.isArray(e)?e[1]:"string"==typeof e?e:(null==e?void 0:e.main)||""}\n                            \n                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class Hs extends ht{constructor(e){super({vertexShader:i.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`\n                varying vec2 vUv;\n                ${e[0]}\n                void main() {\n                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));\n                    #glMarker\n                    ${e[1]}\n                    \n                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha\n                }\n                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=n.Wl3}render(e,t,n,i,r){super.render(e,t,n,i,r),this._lastReadBuffer=n,this.needsSwap=!0}reRender(e,t,n,i){this._lastReadBuffer&&this.render(e,t,this._lastReadBuffer,n,i)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class Qs extends yt{get renderToScreen(){return this._renderToScreen}constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[At],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var e,t;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,null===(t=(e=this.pass).update)||void 0===t||t.call(e),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}async onAdded(e){var n,i;return(null===(i=null===(n=this._viewer)||void 0===n?void 0:n.screenShader)||void 0===i?void 0:i.isShaderPass2)&&(this._renderToScreen=!1),this._renderToScreen&&(0,t.safeSetProperty)(e.renderer.passes.find((e=>"screen"===e.passId)),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,t.safeSetProperty)(e.renderer.passes.find((e=>"screen"===e.passId)),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var n,i;const r=e.screenShader,s=["",""];this._renderToScreen&&!r.isShaderPass2&&(s[0]=Array.isArray(r)?r[0]:(null==r?void 0:r.pars)||"",s[1]=Array.isArray(r)?r[1]:"string"==typeof r?r:(null==r?void 0:r.main)||"");const o=new Hs(s);return(0,t.safeSetProperty)(null===(i=null===(n=o.uiConfig)||void 0===n?void 0:n.children)||void 0===i?void 0:i.find((e=>"Enabled"===(null==e?void 0:e.label))),"hidden",!0,!0),o}_update(e){var t,n,i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties(null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(At)),this._pass.passObject.material.uniforms.tTransparent.value=(null===(i=null===(n=this._viewer)||void 0===n?void 0:n.renderFilter.passObject.transparentTarget)||void 0===i?void 0:i.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t,n;return null!==(n=null===(t=null===(e=this.pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig)&&void 0!==n?n:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}Qs.PluginType="CombinedPostPlugin";var Ws=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class qs extends _t{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Qs]}get uiConfig(){var e;return null===(e=this._extension)||void 0===e?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),null===(t=e.getPlugin(Qs))||void 0===t||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function Xs(e,t,n){return e&~(1<<t)|(n?1:0)<<t}function Ys(e,t){return e&~(1<<t)}Ws([re("extension")],qs.prototype,"_extension",void 0),Ws([re()],qs.prototype,"enabled",void 0);var Ks,Js=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const Zs=n.dZ3;let $s=Ks=class{constructor(e,i=!0){this.depthTonemap=i,this.toneMapping=n.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            ${this.depthTonemap?gt:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${"int getToneMapBit(in int number){\n#ifdef WebGL2Context\nreturn(number/2)%2;\n#else\nreturn int(mod(floor(float(number)/2.),2.));\n#endif\n}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;\n#if USE_DEPTH_TONEMAP > 0\nbool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));\n#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0\nbool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;\n#endif\nif(doTonemap){\n#endif\n#if defined( TONE_MAPPING )\noutColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);\n#endif\n#if USE_DEPTH_TONEMAP > 0\n}\n#if TRANSPARENT_BACKGROUND > 0\nif(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;\n#endif\nif(depth<0.00001)outColor.a=0.;\n#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0\noutColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);\n#endif\n#endif\nreturn outColor;}"}
        `:"",this._combinedPostPlugin=e.getPlugin(Qs),this._setDirty=this._setDirty.bind(this),this.depthTonemap=i}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker","\ngl_FragColor = ToneMapping(gl_FragColor);\n",{prepend:!0}))}onObjectRender(e,t,i){if(!this.enabled)return;const{toneMapping:r,toneMappingExposure:s,outputColorSpace:o}=i;this._rendererState.toneMapping=r,this._rendererState.toneMappingExposure=s,this._rendererState.outputColorSpace=o;let a=this.tonemapBackground?"1":"0";t.materialObject.defines.TONEMAP_BACKGROUND!==a&&(t.materialObject.defines.TONEMAP_BACKGROUND=a,t.materialObject.needsUpdate=!0),a=this.clipBackground?"1":"0",t.materialObject.defines.TRANSPARENT_BACKGROUND!==a&&(t.materialObject.defines.TRANSPARENT_BACKGROUND=a,t.materialObject.needsUpdate=!0),a=this.renderDepth?"1":"0",t.materialObject.defines.DEBUG_DEPTH!==a&&(t.materialObject.defines.DEBUG_DEPTH=a,t.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputColorSpace=n.KI_,t.materialObject.toneMapped=!0,t.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(e,t,n){n.toneMapping=this._rendererState.toneMapping,n.toneMappingExposure=this._rendererState.toneMappingExposure,n.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};$s.PluginType="Tonemap",Js([Fe("Mode",[["Linear",n.EoG],["Reinhard",n.CdI],["Cineon",n.YGz],["ACESFilmic",n.LY2],["Uncharted2",Zs]].map((e=>({label:e[0],value:e[1]}))),{limitedUi:!0}),(0,t.onChange)(Ks.prototype._setDirty),re()],$s.prototype,"toneMapping",void 0),Js([(0,t.onChange)(Ks.prototype._setDirty),Oe("Tonemap Background",{limitedUi:!0}),re()],$s.prototype,"tonemapBackground",void 0),Js([(0,t.onChange)(Ks.prototype._setDirty),Oe("Clip Background"),re()],$s.prototype,"clipBackground",void 0),Js([(0,t.onChange)(Ks.prototype._setDirty),Ue("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),re()],$s.prototype,"exposure",void 0),Js([(0,t.onChange)(Ks.prototype._setDirty),Ue("Saturation",[0,2],.01,{limitedUi:!0}),re()],$s.prototype,"saturation",void 0),Js([(0,t.onChange)(Ks.prototype._setDirty),Ue("Contrast",[0,2],.01,{limitedUi:!0}),re()],$s.prototype,"contrast",void 0),Js([(0,t.onChange)(Ks.prototype._setDirty),Oe("Render Depth")],$s.prototype,"renderDepth",void 0),$s=Ks=Js([We("Tonemapping")],$s);class eo extends qs{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPlugin(At))||void 0===t||t.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new $s(e,this.depthTonemap)}get exposure(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.exposure)&&void 0!==t?t:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.saturation)&&void 0!==t?t:1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.contrast)&&void 0!==t?t:1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.toneMapping)&&void 0!==t?t:n.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){var i,r;if(e instanceof n.Kj0&&(null===(i=e.material)||void 0===i?void 0:i.userData)){const n=!1===(null===(r=e.material)||void 0===r?void 0:r.userData.postTonemap)?0:1;t.w=Xs(t.w,1,n)}}}eo.PluginType="Tonemap",n.WdD.tonemapping_pars_fragment=n.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }","\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n\t// John Hable's filmic operator from Uncharted 2 video game\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }\n\n");var to,no=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let io=to=class{constructor(e){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=e.getPlugin(Qs),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker"," \n            gl_FragColor = chromaticAberration();\n            #glMarker\n        "))}onObjectRender(e,t,n){this.enabled&&(this.extraUniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};io.PluginType="ChromaticAberration",no([(0,t.onChange)(to.prototype._setDirty),Oe("Enable"),re()],io.prototype,"enabled",void 0),no([(0,t.onChange)(to.prototype._setDirty),Ue("Intensity",[0,.1],.001,{limitedUi:!0}),re()],io.prototype,"aberrationIntensity",void 0),io=to=no([We("ChromaticAberration")],io);class ro extends qs{constructor(){super()}generateExtension(e){return new io(e)}get intensity(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.aberrationIntensity)&&void 0!==t?t:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}ro.PluginType="ChromaticAberration";class so extends _t{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map((t=>(t.passId||(console.warn("no id found for pass",t),t.passId=De()),e.renderer.registerPass(t,!0),[t.passId,t]))))}async onRemove(e){var t;if(this._passes){for(const n of[...Object.values(this._passes)]){const i=n;e.renderer.unregisterPass(i),null===(t=null==i?void 0:i.dispose)||void 0===t||t.call(i)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var t;const n=super.toJSON(e);if(!n.type)return n;const i=Object.entries(this.passes);n.passes={};for(const[r,s]of i)n.passes[r]=le(null!==(t=null==s?void 0:s.passObject)&&void 0!==t?t:s,!1,e);return n}fromJSON(e,t){var n;if(!super.fromJSON(e,t))return null;if(e.passes){const i=Object.entries(this.passes);for(const[r,s]of i)ce(e.passes[r],null!==(n=null==s?void 0:s.passObject)&&void 0!==n?n:s,!1,t)}return this}}var oo=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class ao extends ht{constructor(e,t,r="rgba"){super({vertexShader:i.vertexShader,fragmentShader:t+"uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;\n#pragma unroll_loop_start\nfor(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}\n#pragma unroll_loop_end\nfinal_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}",uniforms:{bilDirection:{value:new n.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new n.FM8}},defines:{B_SRC_ACCESSOR:r}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,i,r){var s,o,a,l;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set((null===(s=this.uniforms.tDiffuse.value)||void 0===s?void 0:s.image.width)||0,(null===(o=this.uniforms.tDiffuse.value)||void 0===o?void 0:o.image.height)||0),super.render(e,t,this._target,i,r),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set((null===(a=this.uniforms.tDiffuse.value)||void 0===a?void 0:a.image.width)||0,(null===(l=this.uniforms.tDiffuse.value)||void 0===l?void 0:l.image.height)||0),super.render(e,this._target,t,i,r))}}oo([re(),j()],ao.prototype,"smoothEnabled",void 0),oo([re(),j()],ao.prototype,"edgeSharpness",void 0);var lo="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",co="#ifndef BASIC_RANDOM_HELPERS\n#define BASIC_RANDOM_HELPERS \nuniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}\n#endif\n",uo="#ifndef SIMPLE_CAMERA_HELPERS\n#define SIMPLE_CAMERA_HELPERS \n#ifndef USE_TRANSMISSION\nuniform mat4 projectionMatrix;\n#endif\nvec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}\n#endif\n",ho=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class po extends ht{constructor(e,i,r){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1,CHECK_GBUFFER_FLAG:0},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new n.FM8(512,512)},saoData:{value:new n.Ltg},frameCount:{value:0},cameraNearFar:{value:new n.FM8(.1,1e3)},projection:{value:new n.yGw},saoBiasEpsilon:{value:new n.Ltg(1,1,1,1)},sceneBoundingRadius:{value:0}},vertexShader:lo,fragmentShader:`\n\n${co}\n\n${r}\n\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec4 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){\n#ifdef WebGL2Context\nreturn(number/8)%2;\n#else\nreturn int(mod(floor(float(number)/4.),2.));\n#endif\n}float getViewZFromNDCZ(const in float depth){\n#if PERSPECTIVE_CAMERA == 1\nreturn perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#endif\n}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;\n#if DEPTH_PACKING_MODE == 2\nuncodedDepth=texture2D(tNormalDepth,uv);\n#else\nuncodedDepth=texture2D(tDepth,uv);\n#endif\n#if DEPTH_PACKING_MODE == 0\nreturn uncodedDepth.x;\n#elif DEPTH_PACKING_MODE == 1\n#if LINEAR_DEPTH == 1\nreturn pow2(unpackRGBAToDepth(uncodedDepth));\n#else\nreturn unpackRGBAToDepth(uncodedDepth);\n#endif\n#else\nreturn pow2(unpack16(uncodedDepth.xy));\n#endif\n}vec3 getPositionFromOffset(const in vec2 uvOffset){float d=decodeDepth(uvOffset);\n#if LINEAR_DEPTH == 0\nfloat centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);\n#else\nd=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);\n#endif\n}float getCavityAO(){float cutoff=-0.65;float curvature=float(getGBufferFlags(vUv).r)/255.;curvature=2.*curvature-1.;curvature=curvature*4.;float smoothCurvature=smoothstep(0.,1.,curvature-cutoff);smoothCurvature+=saoData.x;smoothCurvature=clamp(smoothCurvature,0.,1.);return 1.-smoothCurvature;}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28318)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 uvOffset=uv+floor(screenSpaceRadius*vec2(cos(angle),sin(angle)))/screenSize;\n#if CHECK_GBUFFER_FLAG == 1\nif(getSelectionBit(getGBufferFlags(uvOffset.xy).a)<1)return 0.;\n#endif\nvec3 samplePosition=getPositionFromOffset(uvOffset);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction)/(saoBiasEpsilon.w*saoBiasEpsilon.w);float ao=max((dot(centerNormal,direction)/saoBiasEpsilon.w-saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);\n#if LINEAR_DEPTH == 0\nfloat centerViewZ=getViewZFromNDCZ(centerDepth);\n#else\nfloat centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);\n#endif\nvec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=0.09*saoData.z*saoBiasEpsilon.w/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#if NUM_SAMPLES > 1\nsum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 2\nsum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 3\nsum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 4\nsum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 5\nsum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 6\nsum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 7\nsum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 8\nsum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 9\nsum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 10\nsum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\nfloat aoValue=sum*saoData.y*INV_NUM_SAMPLES;float cavityAO=getCavityAO();aoValue=saoData.w>0.?max(aoValue,cavityAO):aoValue;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}\n\n            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1.3,useSmallScaleAO:!1,intensitySmallAO:.2,autoRadius:!1,projScale:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(e,t,n)=>{e.defines.SSAO_ENABLED&&(e.fragmentShader=ot(e.fragmentShader,"#include <aomap_fragment>","#ifndef USE_TRANSMISSION\n#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0\nfloat ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined( USE_ENVMAP )\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);\n#endif\n#else\n#include <aomap_fragment>\n#endif\n#endif\n"))},onObjectRender:(e,t,n)=>{var i,r;this.materialExtension.extraUniforms.tSSAOMap.value=null===(i=this._target)||void 0===i?void 0:i.texture;const s=t.materialObject;let o=this.enabled&&!1!==n.userData.screenSpaceRendering&&!(null===(r=t.userData)||void 0===r?void 0:r.ssaoDisabled)?1:0;s.defines.SSAO_ENABLED!==o&&(s.defines.SSAO_ENABLED=o,s.needsUpdate=!0),o=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==o&&(this.materialExtension.extraUniforms.tSSAOMap.value=o,s.needsUpdate=!0)},parsFragmentSnippet:e=>{var n;return t.glsl`
             uniform sampler2D tSSAOMap;
             ${L("tSSAOMap",null===(n=this._target)||void 0===n?void 0:n.texture,e.capabilities.isWebGL2)}
            ${uo}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:e=>{var t,n;return this.enabled?"1":"0"+(null===(n=null===(t=this._target)||void 0===t?void 0:t.texture)||void 0===n?void 0:n.colorSpace)},isCompatible:e=>{var t;return!(null===(t=e.materialObject.userData)||void 0===t?void 0:t.ssaoDisabled)&&e.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new ao(this._target,r,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,i,r){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,r),this._smoothEnabled&&this.bilateralPass.render(e,t,n,i,r))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.x=this.parameters.intensitySmallAO,e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius,e.w=this.parameters.useSmallScaleAO,e.z*=this.parameters.projScale;const t=this.material.uniforms.saoBiasEpsilon.value;if(t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff,this.parameters.autoRadius){const e=this.material.uniforms.sceneBoundingRadius.value;t.w=e}else t.w=1}}ho([re()],po.prototype,"bilateralPass",void 0),ho([re()],po.prototype,"parameters",void 0);class fo extends so{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[Ls,At],this.setDirty=this.setDirty.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var t;return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),null===(t=e.getPlugin(At))||void 0===t||t.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}updateGBuffer(e,t){var i;if(e instanceof n.Kj0&&(null===(i=e.material)||void 0===i?void 0:i.userData)){const n=e.material.userData.ssaoCastDisabled||e.material.userData.pluginsDisabled,i=n?0:1;t.w=Xs(t.w,3,i),n&&this.passes.ssao.passObject&&1!==this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG&&(this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG=1,this.passes.ssao.passObject.material.needsUpdate=!0)}}createPasses(e){var t,i;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[vt(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new po(e.renderer,this._aoTarget,null!==(i=null===(t=e.getPlugin(At))||void 0===t?void 0:t.getUnpackSnippet())&&void 0!==i?i:""),update(){var t;const i=Math.max(1,null!==(t=(null==e?void 0:e.scene.activeCamera.modelObject).fov)&&void 0!==t?t:1),r=((null==e?void 0:e.canvas.height)||1)/(2*Math.tan(.5*i*n.M8C.DEG2RAD));this.passObject.parameters.projScale=r,this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(At)])}},(()=>[e.getPlugin(At),e.scene.activeCamera,e.renderer,e.scene]))]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get enabled(){var e,t;return(null===(t=null===(e=this.passes.ssao)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)||!1}set enabled(e){var t;(null===(t=this.passes.ssao)||void 0===t?void 0:t.passObject)&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const t=this,n=t.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[n,"enabled"],onChange:t.setDirty},{type:"checkbox",label:"Enable Cavity",property:[n.parameters,"useSmallScaleAO"],onChange:t.setDirty},{type:"slider",label:"Cavity Brightness",bounds:[0,.5],stepSize:.01,property:[n.parameters,"intensitySmallAO"],onChange:t.setDirty},{type:"slider",label:"Intensity",bounds:[0,5],property:[n.parameters,"intensity"],onChange:t.setDirty},{type:"slider",label:"Radius",bounds:[.1,20],property:[n.parameters,"occlusionWorldRadius"],onChange:t.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[n.parameters,"bias"],onChange:t.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[n.parameters,"falloff"],onChange:t.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[null===(e=n.material)||void 0===e?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>n.material.needsUpdate=!0,t.setDirty]},{type:"checkbox",property:[n.bilateralPass,"smoothEnabled"],onChange:t.setDirty},{type:"checkbox",property:[n.parameters,"autoRadius"],onChange:t.setDirty},{type:"vec4",property:[n.bilateralPass,"edgeSharpness"],onChange:t.setDirty}]}}}fo.PluginType="SSAO";var mo,go=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let _o=mo=class extends ht{constructor(){super({vertexShader:i.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new n.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:gt+"\nuniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;\n#if PASS_STEP == 0\nuniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}\n#endif\nvec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){\n#ifdef WebGL2Context\nreturn(number/4)%2;\n#else\nreturn int(mod(floor(float(number)/4.),2.));\n#endif\n}void main(){\n#if PASS_STEP == 0 \nint doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;\n#elif PASS_STEP == 1 \ngl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;\n#elif PASS_STEP == 2 \ngl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;\n#elif PASS_STEP == 3 \nvec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;\n#elif PASS_STEP == 4 \nvec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;\n#endif\n#include <encodings_fragment>\n}"},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new n.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.2,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(e,t,i,r,s){const o=e.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const a=i;let l=.5,c=a.width*l,u=a.height*l;const d=[];let h=o.getTempTarget({sizeMultiplier:1,type:n.cLu});d.push(h);let p=a;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(e,h,p,r,s),p=h;let f=1;for(;f<this.bloomIterations&&(c/=2,u/=2,l/=2,!(u<2||c<2));f++){h=o.getTempTarget({sizeMultiplier:l,type:n.cLu}),d.push(h),this.material.defines.PASS_STEP=1;let t=this._weights[f];t=0!==this._weights[f-1]?this._weights[f]/this._weights[f-1]:this._weights[f],this.material.uniforms.weight.value=t,this.material.needsUpdate=!0,super.render(e,h,p,r,s),p=h}this.clear=!1;const m=e.autoClear;for(e.autoClear=!1,f-=2;f>=0;f--)h=d[f],d[f]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=n.WMw,this.material.needsUpdate=!0,e.autoClear=!1,super.render(e,h,p,r,s),this.material.blending=n.jFi,o.releaseTempTarget(p),p=h;this.clear=!0,e.autoClear=m,e.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(e,t,p,r,s)):(this.uniforms.tSource.value=a.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(e,t,p,r,s),this.uniforms.tSource.value=null),o.releaseTempTarget(p)}_updateWeights(){if(!this._weights)return;const e=Math.max(Math.min(this.radius,1),0),t=1/(this.bloomIterations-1);for(let n=0;n<this.bloomIterations;n++){let i=n*t+.1,r=1.2-i;i=Math.pow(i,this.power),r=Math.pow(r,this.power),this._weights[n]=r*(1-e)+i*e}this.setDirty()}};function vo(e){const t=null==e?void 0:e.userData;return!!t&&(t[yo.PluginType]||(t[yo.PluginType]={}),t[yo.PluginType].enable=!0,e.isMaterial&&(e.needsUpdate=!0),!0)}go([j()],_o.prototype,"prefilter",void 0),go([Ue("Threshold",[0,2]),(0,t.onChange)(mo.prototype._thresholdsUpdated),re()],_o.prototype,"threshold",void 0),go([Ue("Soft Threshold",[0,1]),(0,t.onChange)(mo.prototype._thresholdsUpdated),re()],_o.prototype,"softThreshold",void 0),go([Ue("Intensity",[0,3]),re(),j()],_o.prototype,"intensity",void 0),go([Ue("Iterations",[0,7],1),(0,t.onChange)(mo.prototype._updateWeights),re()],_o.prototype,"bloomIterations",void 0),go([Ue("Radius",[0,1],.01),(0,t.onChange)(mo.prototype._updateWeights),re()],_o.prototype,"radius",void 0),go([Ue("Power",[.2,10],.01),(0,t.onChange)(mo.prototype._updateWeights),re()],_o.prototype,"power",void 0),go([Oe("Debug")],_o.prototype,"bloomDebug",void 0),_o=mo=go([We("Bloom")],_o);class yo extends yt{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:De(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const t={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var t,n;return null===(n=null===(t=e.materialObject.userData[yo.PluginType])||void 0===t?void 0:t.enable)||void 0===n||n},set value(n){var i;const r=e.materialObject.userData[yo.PluginType];n!==(null==r?void 0:r.enable)&&(r||vo(e.materialObject),e.materialObject.userData[yo.PluginType].enable=n,null===(i=t.uiRefresh)||void 0===i||i.call(t,"postFrame",!0))},onChange:this.setDirty}]};return t}passCtor(e){const t=new _o;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),t}async onAdded(e){var t,n;await super.onAdded(e),null===(t=e.getPlugin(At))||void 0===t||t.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Ls);null===(n=null==i?void 0:i.materials)||void 0===n||n.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,t){var i,r,s,o;if(e instanceof n.Kj0&&(null===(i=e.material)||void 0===i?void 0:i.userData)){const n=!1===(null===(s=null===(r=e.material)||void 0===r?void 0:r.userData[yo.PluginType])||void 0===s?void 0:s.enable)||(null===(o=e.material)||void 0===o?void 0:o.userData.pluginsDisabled)?0:1;t.w=Xs(t.w,2,n)}}_update(e){var t,n;return null===(t=e.getPlugin(At))||void 0===t||t.updateShaderProperties(null===(n=this.pass)||void 0===n?void 0:n.passObject.material),super._update(e)}get uiConfig(){var e;return null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig}}yo.PluginType="Bloom";var bo="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",Ao=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const wo={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new n.FM8},cameraNearFar:{value:new n.FM8}},vertexShader:lo,fragmentShader:gt+"\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}\n#include <encodings_fragment>\n}"},xo=(dt({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new n.FM8},direction:{value:new n.FM8}},vertexShader:lo,fragmentShader:"#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);\n#include <encodings_fragment>\n}"},"colorTexture","cocTexture"),dt({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new n.FM8},direction:{value:new n.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:lo,fragmentShader:co+"\n"+bo+"\n#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));\n#ifdef DOF_MODE\nfloat blurDist=blurRadius*(2.*color.a-1.);\n#else\nfloat blurDist=blurRadius*color.a;\n#endif\nfloat rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();\n#pragma unroll_loop_start\nfor(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));\n#ifdef DOF_MODE\nsampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;\n#endif\ncolorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}\n#pragma unroll_loop_end\ncolorSum/=weightSum;return vec4(min(vec3(72.),max(vec3(0.),colorSum)),1.);}void main(){gl_FragColor=CircularBlur();\n#include <encodings_fragment>\n}",defines:{DOF_MODE:1}},"colorTexture"));class Eo extends ht{constructor(){super(wo,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=xo,this.nearFarBlurScale=new n.FM8(.25,.25),this.focalDepthRange=new n.FM8(.5,1.5),this.crossCenter=new n.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new n.Ilk(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=dt({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:lo,fragmentShader:gt+"\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);\n#include <encodings_fragment>\n}"},"colorTexture"),this.expandCocMaterial=dt({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new n.FM8},direction:{value:new n.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:lo,fragmentShader:gt+"\n#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);\n#include <encodings_fragment>\n}"},"colorTexture")}render(e,t,i,r,s){if(!this.enabled)return;const o=e.baseRenderer,a={minFilter:n.TyD,magFilter:n.TyD,type:n.cLu,colorSpace:n.GUF,sizeMultiplier:.5,format:n.wk1,depthBuffer:!1,generateMipmaps:!1},l=o.getTempTarget(a),c=o.getTempTarget(a);if(this.computeCocMaterial.uniforms.colorTexture.value=i.texture,o.blit(void 0,l,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=l.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,c,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=c.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,l,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=l.texture,o.blit(void 0,c,{material:this.dofBlurMaterial});else{const e=o.getTempTarget(a);this.dofBlurMaterial.uniforms.cocTexture.value=l.texture,this.dofBlurMaterial.uniforms.colorTexture.value=l.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,e,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=e.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,c,{material:this.dofBlurMaterial}),o.releaseTempTarget(e)}this.material.uniforms.blurTexture.value=c.texture,this.material.uniforms.cocTexture.value=l.texture,super.render(e,t,i,r,s),o.releaseTempTarget(l),o.releaseTempTarget(c)}}Ao([re(),j()],Eo.prototype,"nearFarBlurScale",void 0),Ao([re(),j()],Eo.prototype,"focalDepthRange",void 0),Ao([j()],Eo.prototype,"crossCenter",void 0),Ao([j()],Eo.prototype,"crossRadius",void 0),Ao([j()],Eo.prototype,"crossAlpha",void 0),Ao([j()],Eo.prototype,"crossColor",void 0);class Co extends ht{constructor(e){super({vertexShader:i.vertexShader,fragmentShader:t.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new n.Ltg(1,1,1,1)},weight2:{value:new n.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var So=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const Mo=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class To extends so{constructor(e=2*Mo.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=e=>{const t=e.object;(t.modelObject||t.lightObject)&&(t.modelObject||t.lightObject).traverse((e=>{var t;(null===(t=null==e?void 0:e.shadow)||void 0===t?void 0:t.camera)&&e.shadow.mapSize&&this.trackedJitterCameras.add([e.shadow.camera,e.shadow.mapSize])}))},this._jitterCamera=e=>{var t;const n=e.target;if(this.jitter&&n.renderer.frameCount>1){const e=(e,t)=>{const i={...Mo[n.renderer.frameCount%Mo.length]};e.setViewOffset(t.width,t.height,i.x,i.y,t.width,t.height)},i=n.scene.activeCamera.cameraObject;e(i,{width:n.canvas.clientWidth*n.renderer.displayCanvasScaling,height:n.canvas.clientHeight*n.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach((t=>e(...t))),this._hasSetOffset=!0,null===(t=this._viewer)||void 0===t||t.renderer.resetShadows()}},this._resetCameraJitter=e=>{const t=e.target;this._hasSetOffset&&(t.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=Qe("Progressive",this),this.maxFrameCount=e}async onAdded(e){return await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach((t=>e.renderer.disposeTarget(t))),this._lastFrames.clear(),await super.onRemove(e)}get lastFrame(){var e;return this._lastFrames.get(null===(e=this._viewer)||void 0===e?void 0:e.scene.renderCamera.cameraObject.uuid)}getLastFrame(e){return e?this._lastFrames.get(e.cameraObject.uuid):this.lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this,n=vt(e,{passId:"progressive",get dirty(){var e;return t.jitter&&((null===(e=t._viewer)||void 0===e?void 0:e.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends Co{render(n,i,r,s,o){if(t.lastFrame){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((null==r?void 0:r.texture)&&e.renderer.blit(r.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(n,i,r,s,o),e.renderer.blit(i.texture,t.lastFrame,{})}else e.console.error("lastFrame render target undefined")}},update(){if(!t.lastFrame&&e.scene.renderCamera&&t._lastFrames.set(e.scene.renderCamera.cameraObject.uuid,e.renderer.composerTarget.clone(!0)),!t.lastFrame)return void console.error("lastFrame render target undefined");let n=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(n,n,n,n),n=1-n,this.passObject.weights2.set(n,n,n,n),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}});return[n]}isConverged(e=!1){var t;return((null===(t=this._viewer)||void 0===t?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t,n;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=null!==(n=null===(t=this.lastFrame)||void 0===t?void 0:t.texture)&&void 0!==n?n:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}To.PluginType="Progressive",So([re(),ze("Frame count")],To.prototype,"maxFrameCount",void 0),So([re(),Oe("Jitter")],To.prototype,"jitter",void 0);class Io extends yt{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:n.wem,magFilter:n.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState<500&&(this._toSaveFrame=!0),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this.setDirty(),await(0,t.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[To],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>!1!==e.frameFade&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{!1!==e.frameFade&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{!1!==e.frameFade&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var t;const n=null===(t=this._viewer)||void 0===t?void 0:t.canvas;if(!n)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==n)return void(this.pointerEnabled=!0);const i=n.getBoundingClientRect(),r=(e.clientX-i.left)/i.width,s=(e.clientY-i.top)/i.height;this.pointerEnabled=r<0||r>1||s<0||s>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const n=this,i=e.getPlugin(To),r=new class extends Co{constructor(){super(...arguments),this._lastTime=0,this._saveNextFrame=!1,this.uiConfig=Qe("Frame Fade",this)}render(r,s,o,a,l){this.needsSwap=!1;const c=n._target;if(!c||!n.pointerEnabled||!this.enabled||!n.dirty||n._fadeTimeState<.001||e.scene.renderCamera!==e.scene.activeCamera)return;n._toSaveFrame&&(this._saveNextFrame=!0,n._toSaveFrame=!1),this._saveNextFrame&&i.lastFrame&&(e.renderer.blit(i.lastFrame.texture,c),this._lastTime=0,this._saveNextFrame=!1),this.blendTexture=null==c?void 0:c.texture;const u=n._fadeTimeState/n._fadeTime;this.weights2.setScalar(u),this.weights2.w=1,this.weights1.setScalar(1-u),this.weights1.w=1,super.render(r,s,o,a,l),this.needsSwap=!0;const d=(0,t.now)();this._lastTime<10&&(this._lastTime=d-10);const h=d-this._lastTime;this._lastTime=d,n._fadeTimeState-=h}};return r.enabled=!0,r}setDirty(){var e;this.enabled&&(null===(e=this._viewer)||void 0===e||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<1&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return null===(t=null===(e=this.pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}Io.PluginType="FrameFade";var Po=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Ro extends yt{passCtor(e){return new Eo}constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[At],this.enableEdit=!1,this._focalPointHit=new n.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new n.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,n=!0,i=!1){var r,s;this._focalPointHit.copy(e),n&&(null===(s=null===(r=this._viewer)||void 0===r?void 0:r.getPlugin(Io))||void 0===s||s.startTransition(this._frameFadeTime)),i&&(this._focalPointHitTime=(0,t.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,t;return null!==(t=null===(e=this.pass)||void 0===e?void 0:e.passObject.focalDepthRange.y)&&void 0!==t?t:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,t;return null!==(t=null===(e=this.pass)||void 0===e?void 0:e.passObject.nearFarBlurScale.x)&&void 0!==t?t:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,t;return null!==(t=null===(e=this.pass)||void 0===e?void 0:e.passObject.nearFarBlurScale.y)&&void 0!==t?t:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,n;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(Io))||void 0===n||n.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPluginByType("Picking"))||void 0===t||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return null===(t=e.getPluginByType("Picking"))||void 0===t||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}_update(e){var i,r;if(!super._update(e))return!1;const s=null===(i=this.pass)||void 0===i?void 0:i.passObject;if(!s)return!1;const o=e.getPlugin(At);null==o||o.updateShaderProperties(s.material),s.dofBlurMaterial.uniforms.frameCount&&(null===(r=e.renderer)||void 0===r||r.updateShaderProperties(s.dofBlurMaterial));const a=e.scene.renderCamera;if(!a)return!1;a.cameraObject.updateMatrixWorld(!0),a.updateShaderProperties(s.material),a.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),s.focalDepthRange.x=this._tempVec.length(),s.focalDepthRange.x*=a.cameraObject.getWorldDirection(new n.Pa4).dot(this._tempVec.normalize());let l=((0,t.now)()-this._focalPointHitTime)/this.crossFadeTime;if(l=1-Math.min(1,Math.max(0,l)),Math.abs(l-s.crossAlpha)>.01&&(s.crossAlpha=l,this.setDirty()),l>0){const e=this._tempVec.copy(this._focalPointHit).project(a.cameraObject).addScalar(1).divideScalar(2);s.crossCenter.set(e.x,e.y),s.computeCocMaterial.uniformsNeedUpdate=!0,s.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,n,i,r,s;if(this._uiConfig)return this._uiConfig;const o=null===(n=null===(e=this._pass)||void 0===e?void 0:e.passObject)||void 0===n?void 0:n.uiConfig;return o?(null===(r=null===(i=o.children)||void 0===i?void 0:i.map((e=>(0,t.getOrCall)(e))))||void 0===r||r.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),null===(s=o.children)||void 0===s||s.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=o,o):{}}}Ro.PluginType="DepthOfField",Po([re()],Ro.prototype,"enableEdit",void 0),Po([re("focalPoint")],Ro.prototype,"_focalPointHit",void 0),Po([re()],Ro.prototype,"crossFadeTime",void 0);var Do=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let ko=class extends _t{addThinFilmLayer(e){return Bo(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Oo(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new n.Ltg},thinNoiseLayerFactors:{value:new n.Ltg},thinColorNoiseParams:{value:new n.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(e,t)=>{var n;return this.enabled&&(null===(n=null==t?void 0:t.materialObject.userData._thinFilmLayer)||void 0===n?void 0:n.hasThinFilm)?co+"\n#ifndef VORONOISE_HELPER\n#define VORONOISE_HELPER \nfloat voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}\n#endif\n\n#ifndef HSV_HELPERS\n#define HSV_HELPERS \nvec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}\n#endif \n\nuniform vec4 thinBaseLayerFactors;\nuniform vec4 thinNoiseLayerFactors;\nuniform vec4 thinColorNoiseParams;\nuniform float thinFilmFactor;\n        ":""},shaderExtender:(e,t,n)=>{var i;if(!this.enabled||!(null===(i=t.materialObject.userData._thinFilmLayer)||void 0===i?void 0:i.hasThinFilm))return;const r="#glMarker beforeAccumulation";e.fragmentShader=e.fragmentShader.replace(r,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+r),e.defines.USE_UV=""},onObjectRender:(e,t)=>{var n;const i=null===(n=t.materialObject.userData)||void 0===n?void 0:n._thinFilmLayer;if(!(null==i?void 0:i.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(i.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(i.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(i.colorNoiseParams),this._uniforms.thinFilmFactor.value=i.filmFactor;const r=this.enabled?1:0;t.materialObject.defines.THIN_FILM_LAYER_ENABLED!==r&&(t.materialObject.defines.THIN_FILM_LAYER_ENABLED=r,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n;return(this.enabled?"1":"0")+((null===(n=null===(t=e.materialObject.userData)||void 0===t?void 0:t._thinFilmLayer)||void 0===n?void 0:n.hasThinFilm)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2||e.isDiamondMaterial,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)||!1},set value(i){var r,s;i!==(null===(r=e.materialObject.userData._thinFilmLayer)||void 0===r?void 0:r.hasThinFilm)&&(i?Bo(e.materialObject)||t.alert("Cannot add thin film."):e.materialObject.userData._thinFilmLayer&&(e.materialObject.userData._thinFilmLayer.hasThinFilm=!1,e.materialObject.needsUpdate=!0),null===(s=n.uiRefresh)||void 0===s||s.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s;await super.onAdded(e);const o=e.getPlugin(Ls);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==o?void 0:o.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(Lo)}async onRemove(e){var t,n,i,r;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function Bo(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._thinFilmLayer||(t._thinFilmLayer={});const n=t._thinFilmLayer;return n.hasThinFilm=!0,void 0===n.baseLayerFactors&&(n.baseLayerFactors=[.3,.6,1,.9]),void 0===n.noiseLayerFactors&&(n.noiseLayerFactors=[.7,.5,.9,.7]),void 0===n.colorNoiseParams&&(n.colorNoiseParams=[.5,.5,.5,.7]),void 0===n.filmFactor&&(n.filmFactor=.3),e.isMaterial&&(e.needsUpdate=!0),!0}ko.PluginType="ThinFilmLayerPlugin",ko.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",Do([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],ko.prototype,"enabled",void 0),ko=Do([We("ThinFilmLayer Materials")],ko);class Oo{constructor(e){this.parser=e,this.name=ko.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Bo(t),t.userData._thinFilmLayer=ce(i,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const Lo=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._thinFilmLayer)return;if(!t.userData._thinFilmLayer.hasThinFilm)return;n.extensions=n.extensions||{};const i=le(t.userData._thinFilmLayer,!1);n.extensions[ko.THIN_FILM_LAYER_GLTF_EXTENSION]=i,e.extensionsUsed[ko.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class Uo{async apply(e,t,n){var i,r,s,o;if(!t)return void(this.selected=void 0);let a=this.presets.find((e=>function(e,t){return("string"==typeof e?e:e.path)===("string"==typeof t?t:t.path)}(e,t)));return a||(this.presets.push(t),a=t),this.selected=a,"string"!=typeof a?null===(r=null===(i=e.getManager())||void 0===i?void 0:i.importer)||void 0===r?void 0:r.importAsset(a,n):null===(o=null===(s=e.getManager())||void 0===s?void 0:s.importer)||void 0===o?void 0:o.importPath(a,n)}clear(){this.selected=void 0}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class No extends Uo{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const i=await super.apply(e,t),r=null==i?void 0:i[0];return r&&(r.colorSpace=n.KI_,e.scene.background=r,e.scene.backgroundColor=new n.Ilk(1,1,1)),r}}class Fo extends Uo{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),i=null==n?void 0:n[0];return i&&(e.scene.environment=i),i}}class jo extends Uo{constructor(e="envMap"){super(),this.key=e,this.name="GemEnvironment",this.name+=e.split("Map")[1]}async apply(e,n){const i=await super.apply(e,n),r=null==i?void 0:i[0];return(0,t.safeSetProperty)(e.getPluginByType("Diamond"),this.key,r),r}}class zo extends Uo{async apply(e,t){var n,i;const r=await super.apply(e,t,{processImported:!1});return r?null===(i=null===(n=e.getManager())||void 0===n?void 0:n.importer)||void 0===i?void 0:i.processImported(r):void 0}}class Go extends zo{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class Vo extends Uo{constructor(){super(...arguments),this.name="VJSON",this.usePresetCamera=!1}async apply(e,t){const n=e.scene.activeCamera.toJSON(),i=await super.apply(e,t);return this.usePresetCamera||e.scene.activeCamera.fromJSON(n),i}}class Ho extends _t{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map((e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map((e=>{var t;return{label:(null===(t=Qo(e))||void 0===t?void 0:t.split("/").pop())||"",value:Qo(e)}}))],getValue:()=>Qo(e.selected)||"",setValue:t=>{e.apply(this._viewer,e.presets.find((e=>Qo(e)===t)))}}))),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,t.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,t.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,n;await super.onAdded(e),this.presetGroups.push(new No),this.presetGroups.push(new Fo),this.presetGroups.push(new jo),this.presetGroups.push(new jo("envMap2")),this.presetGroups.push(new jo("envMap3")),this.presetGroups.push(new zo("Ground")),this.presetGroups.push(new zo("CameraViews")),this.presetGroups.push(new zo("MaterialConfiguration")),this.presetGroups.push(new Go),null===(n=(t=this.uiConfig).uiRefresh)||void 0===n||n.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map((e=>[e.name,Qo(e.selected)||void 0])).filter((([,e])=>e)));return e.type=Ho.PluginType,e}async fromJSON(e,t){var n,i;if(!super.fromJSON(e,t))return null;const r={...e};if(delete r.type,r.VJSON&&this._viewer){const e=this.presetGroups.find((e=>"VJSON"===e.name)),t=null==e?void 0:e.presets;e&&t&&await e.apply(this._viewer,{path:r.VJSON}),delete r.VJSON}const s=[];for(const[o,a]of Object.entries(r)){const e=this.presetGroups.find((e=>e.name===o)),t=null==e?void 0:e.presets;if(!e||!t)continue;const n="string"==typeof a?{path:a}:a;s.push(e.apply(this._viewer,n))}return await Promise.all(s),null===(i=(n=this.uiConfig).uiRefresh)||void 0===i||i.call(n,"postFrame",!0),this}async loadPresetGroups(e){var t;"string"==typeof e&&e.startsWith("http")&&(e=await fetch(e).then((async e=>e.json())));for(const[n,i]of Object.entries(e)){const e=null===(t=this.presetGroups.find((e=>e.name===n)))||void 0===t?void 0:t.presets;null==e||e.push(...i)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map((e=>[e.name,e.presets.map(Qo)])).filter((([,e])=>e.length>0)))}clear(){this.presetGroups.forEach((e=>{e.clear()}))}}function Qo(e){return e&&"string"!=typeof e?e.path:e}Ho.PluginType="PresetLibraryPlugin";var Wo,qo=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Xo=Wo=class{constructor(e){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=e.getPlugin(Qs),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker"," \n            gl_FragColor = grain(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,n){this.enabled&&(this.extraUniforms.grainIntensity.value=this.grainIntensity,this.extraUniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};qo([(0,t.onChange)(Wo.prototype._setDirty),Oe("Enable"),re()],Xo.prototype,"enabled",void 0),qo([(0,t.onChange)(Wo.prototype._setDirty),Oe("Multiply"),re()],Xo.prototype,"grainMultiply",void 0),qo([(0,t.onChange)(Wo.prototype._setDirty),Ue("Intensity",[0,20],.01,{limitedUi:!0}),re()],Xo.prototype,"grainIntensity",void 0),Xo=Wo=qo([We("FilmicGrain")],Xo);class Yo extends qs{constructor(){super()}generateExtension(e){return new Xo(e)}get intensity(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.grainIntensity)&&void 0!==t?t:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.grainMultiply)&&void 0!==t&&t}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}Yo.PluginType="FilmicGrain";class Ko extends t.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var t;null===(t=this._scene)||void 0===t||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,t,i,r){super(),this.hoverEnabled=!1,this._mouseDownPos=new n.FM8,this._scene=e,this._camera=null!=i?i:this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=null!=r?r:e=>!1!==e.userData.userSelectable&&!1!==e.userData.bboxVisible&&null!=e.material&&"ShadowMaterial"!==e.material.type,this.raycaster=new n.iMs,this.mouse=new n.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",(e=>this.onPointerMove(e))),this.domElement.addEventListener("pointerleave",(e=>this.onPointerLeave(e))),this.domElement.addEventListener("pointerout",(e=>this.onPointerLeave(e))),this.domElement.addEventListener("pointercancel",(e=>this.onPointerCancel(e))),this.domElement.addEventListener("pointerenter",(e=>this.onPointerEnter(e))),this.domElement.addEventListener("pointerdown",(e=>this.onPointerDown(e))),this.domElement.addEventListener("pointerup",(e=>this.onPointerUp(e)))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){1===this._selected.length&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,t.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var t,n;!1!==e.isPrimary&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=null!==(n=null===(t=this.checkIntersection())||void 0===t?void 0:t.intersects[0].object)&&void 0!==n?n:null))}onPointerLeave(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time,this._mouseDownPos.copy(this.mouse))}onDoubleClick(e){console.log("double click")}onPointerUp(e){if(!1===e.isPrimary)return;this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time;const t=this.mouseDownDeltaTime,n=this._mouseDownPos.distanceTo(this.mouse);t<Ko.PointerClickMaxTime&&n<Ko.PointerClickMaxDistance&&this.onPointerClick(e)}onPointerClick(e){if(!1===e.isPrimary)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(null==t?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var e;const t=null===(e=this._camera)||void 0===e?void 0:e.cameraObject;if(!t)return null;this.raycaster.setFromCamera(this.mouse,t);let n=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const i=[],r=n.filter((e=>!i.includes(e.object.id)&&(i.push(e.object.id),!0)));n=r;let s,o=null;const a=[];for(const l of n){for(o=l.object,s=l;!(null==o||o.visible&&this.selectionCondition(o));)o=o.parent;null!=o&&a.push(l)}if(n=a,n.length>0){if(o=n[0].object,s=n[0],this._firstHit&&o.id!==this._firstHit.id)o=s.object;else for(let e=0;e<n.length;e++)if(this.selectedObject&&this.selectedObject.id===n[e].object.id){const t=e+1;if(!(t<n.length))return null;s=n[t],o=s.object}this._firstHit=n[0].object}return o&&s&&o?{selectedObject:o,intersect:s,intersects:n,mouse:this.mouse.toArray()}:null}isHovering(){return null!=this.hoverObject}isSelected(){return null!=this.selectedObject}}Ko.PointerClickMaxTime=200,Ko.PointerClickMaxDistance=.1;const Jo=new n.ZzF,Zo=new n.Pa4;class $o extends n.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new n.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new n.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new n.$TI(t,6,1);return this.setAttribute("instanceStart",new n.kB5(i,3,0)),this.setAttribute("instanceEnd",new n.kB5(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new n.$TI(t,6,1);return this.setAttribute("instanceColorStart",new n.kB5(i,3,0)),this.setAttribute("instanceColorEnd",new n.kB5(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new n.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new n.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),Jo.setFromBufferAttribute(t),this.boundingBox.union(Jo))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new n.aLr),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let r=0,s=e.count;r<s;r++)Zo.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(Zo)),Zo.fromBufferAttribute(t,r),i=Math.max(i,n.distanceToSquared(Zo));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class ea extends $o{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new n.Uk6(e))}}n.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new n.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},n.Vj0.line={uniforms:n.rDY.merge([n.rBU.common,n.rBU.fog,n.rBU.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class ta extends n.jyz{constructor(e){super({type:"LineMaterial",uniforms:n.rDY.clone(n.Vj0.line.uniforms),vertexShader:n.Vj0.line.vertexShader,fragmentShader:n.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const na=new n.Pa4,ia=new n.Pa4;class ra extends n.Kj0{constructor(e=new $o,t=new ta({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let n=0,o=0,a=t.count;n<a;n++,o+=2)na.fromBufferAttribute(t,n),ia.fromBufferAttribute(i,n),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+na.distanceTo(ia);const s=new n.$TI(r,2,1);return e.setAttribute("instanceDistanceStart",new n.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new n.kB5(s,1,1)),this}}class sa extends n.ZAu{_updater(){const e=this._object;if(e){const t=(new p).expandByObject(e,!1);t.getCenter(this.position);const i=t.getBoundingSphere(new n.aLr).radius;this.scale.setScalar(i*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const t=new ea(e);this._geometry=t;const i=new ta({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new n.FM8(1024,1024),dashed:!1,toneMapped:!1}),r=new ra(t,i);r.computeLineDistances(),r.scale.set(1,1,1),r.visible=!0,this.add(r)}setVisible(e){var t;e!==this.visible&&(this.visible=e,null===(t=this.setDirty)||void 0===t||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?(null===(e=this._object)||void 0===e||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class oa extends sa{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new n.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&((new p).expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const aa=new n.iMs,la=new n.Pa4,ca=new n.Pa4,ua=new n._fP,da={X:new n.Pa4(1,0,0),Y:new n.Pa4(0,1,0),Z:new n.Pa4(0,0,1)},ha={type:"change"},pa={type:"mouseDown"},fa={type:"mouseUp",mode:null},ma={type:"objectChange"};class ga extends n.Tme{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new Ua;this._gizmo=i,this.add(i);const r=new Na;this._plane=r,this.add(r);const s=this;function o(e,t){let n=t;Object.defineProperty(s,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,r[e]=t,i[e]=t,s.dispatchEvent({type:e+"-changed",value:t}),s.dispatchEvent(ha))}}),s[e]=t,r[e]=t,i[e]=t}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new n.Pa4,l=new n.Pa4,c=new n._fP,u=new n._fP,d=new n.Pa4,h=new n._fP,p=new n.Pa4,f=new n.Pa4,m=new n.Pa4,g=new n.Pa4;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",d),o("cameraQuaternion",h),o("pointStart",p),o("pointEnd",f),o("rotationAxis",m),o("rotationAngle",0),o("eye",g),this._offset=new n.Pa4,this._startNorm=new n.Pa4,this._endNorm=new n.Pa4,this._cameraScale=new n.Pa4,this._parentPosition=new n.Pa4,this._parentQuaternion=new n._fP,this._parentQuaternionInv=new n._fP,this._parentScale=new n.Pa4,this._worldScaleStart=new n.Pa4,this._worldQuaternionInv=new n._fP,this._worldScale=new n.Pa4,this._positionStart=new n.Pa4,this._quaternionStart=new n._fP,this._scaleStart=new n.Pa4,this._getPointer=_a.bind(this),this._onPointerDown=ya.bind(this),this._onPointerHover=va.bind(this),this._onPointerMove=ba.bind(this),this._onPointerUp=Aa.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;aa.setFromCamera(e,this.camera);const t=wa(this._gizmo.picker[this.mode],aa);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){aa.setFromCamera(e,this.camera);const t=wa(this._plane,aa,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,pa.mode=this.mode,this.dispatchEvent(pa)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let r=this.space;if("scale"===n?r="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(r="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;aa.setFromCamera(e,this.camera);const s=wa(this._plane,aa,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===r&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===r&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===r&&(i.position.applyQuaternion(ua.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===r&&(i.parent&&i.position.add(la.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(la.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),ca.set(e,e,e)}else la.copy(this.pointStart),ca.copy(this.pointEnd),la.applyQuaternion(this._worldQuaternionInv),ca.applyQuaternion(this._worldQuaternionInv),ca.divide(la),-1===t.search("X")&&(ca.x=1),-1===t.search("Y")&&(ca.y=1),-1===t.search("Z")&&(ca.z=1);i.scale.copy(this._scaleStart).multiply(ca),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(la.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(la.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(da[t]),la.copy(da[t]),"local"===r&&la.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(la.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===r&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(ua.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(ua.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ha),this.dispatchEvent(ma)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(fa.mode=this.mode,this.dispatchEvent(fa)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ha),this.dispatchEvent(ma),this.pointStart.copy(this.pointEnd))}getRaycaster(){return aa}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function _a(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function va(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function ya(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function ba(e){this.enabled&&this.pointerMove(this._getPointer(e))}function Aa(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function wa(e,t,n){const i=t.intersectObject(e,!0);for(let r=0;r<i.length;r++)if(i[r].object.visible||n)return i[r];return!1}const xa=new n.USm,Ea=new n.Pa4(0,1,0),Ca=new n.Pa4(0,0,0),Sa=new n.yGw,Ma=new n._fP,Ta=new n._fP,Ia=new n.Pa4,Pa=new n.yGw,Ra=new n.Pa4(1,0,0),Da=new n.Pa4(0,1,0),ka=new n.Pa4(0,0,1),Ba=new n.Pa4,Oa=new n.Pa4,La=new n.Pa4;class Ua extends n.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new n.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new n.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const r=t.clone();r.opacity=.5;const s=e.clone();s.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const d=e.clone();d.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const f=new n.fHI(0,.04,.1,12);f.translate(0,.05,0);const m=new n.DvJ(.08,.08,.08);m.translate(0,.04,0);const g=new n.u9r;g.setAttribute("position",new n.a$l([0,0,0,1,0,0],3));const _=new n.fHI(.0075,.0075,.5,3);function v(e,t){const i=new n.XvJ(e,.0075,3,64,t*Math.PI*2);return i.rotateY(Math.PI/2),i.rotateX(Math.PI/2),i}_.translate(0,.25,0);const y={X:[[new n.Kj0(f,s),[.5,0,0],[0,0,-Math.PI/2]],[new n.Kj0(f,s),[-.5,0,0],[0,0,Math.PI/2]],[new n.Kj0(_,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new n.Kj0(f,o),[0,.5,0]],[new n.Kj0(f,o),[0,-.5,0],[Math.PI,0,0]],[new n.Kj0(_,o)]],Z:[[new n.Kj0(f,a),[0,0,.5],[Math.PI/2,0,0]],[new n.Kj0(f,a),[0,0,-.5],[-Math.PI/2,0,0]],[new n.Kj0(_,a),null,[Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.pQR(.1,0),d.clone()),[0,0,0]]],XY:[[new n.Kj0(new n.DvJ(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},b={X:[[new n.Kj0(new n.fHI(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new n.Kj0(new n.fHI(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,.3,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.pQR(.2,0),i)]],XY:[[new n.Kj0(new n.DvJ(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},A={START:[[new n.Kj0(new n.pQR(.01,2),r),null,null,null,"helper"]],END:[[new n.Kj0(new n.pQR(.01,2),r),null,null,null,"helper"]],DELTA:[[new n.x12(function(){const e=new n.u9r;return e.setAttribute("position",new n.a$l([0,0,0,1,1,1],3)),e}(),r),null,null,null,"helper"]],X:[[new n.x12(g,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new n.x12(g,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new n.x12(g,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},w={XYZE:[[new n.Kj0(v(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new n.Kj0(v(.5,.5),s)]],Y:[[new n.Kj0(v(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new n.Kj0(v(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new n.Kj0(v(.75,1),h),null,[0,Math.PI/2,0]]]},x={AXIS:[[new n.x12(g,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new n.Kj0(new n.xo$(.25,10,8),i)]],X:[[new n.Kj0(new n.XvJ(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n.Kj0(new n.XvJ(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n.Kj0(new n.XvJ(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n.Kj0(new n.XvJ(.75,.1,2,24),i)]]},C={X:[[new n.Kj0(m,s),[.5,0,0],[0,0,-Math.PI/2]],[new n.Kj0(_,s),[0,0,0],[0,0,-Math.PI/2]],[new n.Kj0(m,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new n.Kj0(m,o),[0,.5,0]],[new n.Kj0(_,o)],[new n.Kj0(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new n.Kj0(m,a),[0,0,.5],[Math.PI/2,0,0]],[new n.Kj0(_,a),[0,0,0],[Math.PI/2,0,0]],[new n.Kj0(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new n.Kj0(new n.DvJ(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.DvJ(.1,.1,.1),d.clone())]]},S={X:[[new n.Kj0(new n.fHI(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new n.Kj0(new n.fHI(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,.3,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new n.Kj0(new n.DvJ(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.DvJ(.2,.2,.2),i),[0,0,0]]]},M={X:[[new n.x12(g,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new n.x12(g,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new n.x12(g,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function T(e){const t=new n.Tme;for(const n in e)for(let i=e[n].length;i--;){const r=e[n][i][0].clone(),s=e[n][i][1],o=e[n][i][2],a=e[n][i][3],l=e[n][i][4];r.name=n,r.tag=l,s&&r.position.set(s[0],s[1],s[2]),o&&r.rotation.set(o[0],o[1],o[2]),a&&r.scale.set(a[0],a[1],a[2]),r.updateMatrix();const c=r.geometry.clone();c.applyMatrix4(r.matrix),r.geometry=c,r.renderOrder=1/0,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=T(y)),this.add(this.gizmo.rotate=T(w)),this.add(this.gizmo.scale=T(C)),this.add(this.picker.translate=T(b)),this.add(this.picker.rotate=T(E)),this.add(this.picker.scale=T(S)),this.add(this.helper.translate=T(A)),this.add(this.helper.rotate=T(x)),this.add(this.helper.scale=T(M)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:Ta;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const e=n[i];let r;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),r=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(r*this.size/4),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const n=.99,i=.2;"X"===e.name&&Math.abs(Ea.copy(Ra).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"===e.name&&Math.abs(Ea.copy(Da).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"===e.name&&Math.abs(Ea.copy(ka).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(Ea.copy(ka).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(Ea.copy(Ra).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(Ea.copy(Da).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)}else"rotate"===this.mode&&(Ma.copy(t),Ea.copy(this.eye).applyQuaternion(ua.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(Sa.lookAt(this.eye,Ca,Da)),"X"===e.name&&(ua.setFromAxisAngle(Ra,Math.atan2(-Ea.y,Ea.z)),ua.multiplyQuaternions(Ma,ua),e.quaternion.copy(ua)),"Y"===e.name&&(ua.setFromAxisAngle(Da,Math.atan2(Ea.x,Ea.z)),ua.multiplyQuaternions(Ma,ua),e.quaternion.copy(ua)),"Z"===e.name&&(ua.setFromAxisAngle(ka,Math.atan2(Ea.y,Ea.x)),ua.multiplyQuaternions(Ma,ua),e.quaternion.copy(ua)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some((function(t){return e.name===t})))&&(e.material.color.setHex(16776960),e.material.opacity=1)}else e.visible=!1,"AXIS"===e.name?(e.visible=!!this.axis,"X"===this.axis&&(ua.setFromEuler(xa.set(0,0,0)),e.quaternion.copy(t).multiply(ua),Math.abs(Ea.copy(Ra).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(ua.setFromEuler(xa.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(ua),Math.abs(Ea.copy(Da).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(ua.setFromEuler(xa.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(ua),Math.abs(Ea.copy(ka).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(ua.setFromEuler(xa.set(0,Math.PI/2,0)),Ea.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(Sa.lookAt(Ca,Ea,Da)),e.quaternion.multiply(ua),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),la.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),la.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(la),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld(e)}}class Na extends n.Kj0{constructor(){super(new n._12(1e5,1e5,2,2),new n.vBJ({visible:!1,wireframe:!0,side:n.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Ba.copy(Ra).applyQuaternion("local"===t?this.worldQuaternion:Ta),Oa.copy(Da).applyQuaternion("local"===t?this.worldQuaternion:Ta),La.copy(ka).applyQuaternion("local"===t?this.worldQuaternion:Ta),Ea.copy(Oa),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ea.copy(this.eye).cross(Ba),Ia.copy(Ba).cross(Ea);break;case"Y":Ea.copy(this.eye).cross(Oa),Ia.copy(Oa).cross(Ea);break;case"Z":Ea.copy(this.eye).cross(La),Ia.copy(La).cross(Ea);break;case"XY":Ia.copy(La);break;case"YZ":Ia.copy(Ba);break;case"XZ":Ea.copy(La),Ia.copy(Oa);break;case"XYZ":case"E":Ia.set(0,0,0)}break;default:Ia.set(0,0,0)}0===Ia.length()?this.quaternion.copy(this.cameraQuaternion):(Pa.lookAt(la.set(0,0,0),Ia,Ea),this.quaternion.setFromRotationMatrix(Pa)),super.updateMatrixWorld(e)}}class Fa extends ga{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace("local"===this.space?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(n.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(16===e.keyCode&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",(()=>{var e;null===(e=null==this?void 0:this.object)||void 0===e||e.dispatchEvent({type:"objectUpdate",fadeFrame:!1})})),this.addEventListener("dragging-changed",(t=>{const n=null==e?void 0:e.getPlugin(Io);n&&(t.value?n.disable("TransformControls"):n.enable("TransformControls")),this._scene.activeCamera.setInteractions(!t.value,this.uuid)})),this._keyDownListener=this._keyDownListener.bind(this),this._keyUpListener=this._keyUpListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var ja=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class za extends _t{get picker(){return this._picker}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}constructor(e=oa,t=!1,n=!0,i=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=e=>{this._viewer&&(this.enabled?this.dispatchEvent(e):e.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const e=this.getSelectedObject();this.autoFocus&&e&&this.setSelectedObject(e,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=i}getSelectedObject(){var e;if(this.enabled)return(null===(e=this._picker)||void 0===e?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled)return;if(!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new Ko(e.scene,e.canvas,void 0,(e=>{var t,n;if(!e.material)return!1;let i=e,r=!1;for(;i;){if(!i.visible)return!1;if("model"===(null!==(t=i.userData.iModel)&&void 0!==t?t:i).assetType&&(r=!0),"widget"===(null!==(n=i.userData.iModel)&&void 0!==n?n:i).assetType)return!1;if(!1===i.userData.userSelectable)return!1;if(!1===i.userData.bboxVisible)return!1;i=i.parent}return r})),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new Fa(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",(t=>{var n,i,r;this.dispatchEvent(t);const s=(null===(n=this._picker)||void 0===n?void 0:n.selectedObject)||void 0;if(this._pickUi){const e=null==s?void 0:s.uiConfig,t=this.uiConfig;t.children=[...this._uiConfigChildren],e&&t.children.push(e),null===(i=t.uiRefresh)||void 0===i||i.call(t)}const o=this._widget;o&&this._enableWidget&&(s?o.attach(s):o.detach());const a=this._transformControls;a&&(null===(r=this._viewer)||void 0===r?void 0:r.scene.activeCamera.controls)&&(s&&a.enabled?a.attach(s):a.detach()),e.setDirty(),this.autoFocus&&this.focusObject(s)})),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",(e=>{void 0===e.value?console.warn("WebGi: e.value must be set for picking, can be null to unselect"):this.setSelectedObject(e.value,this.autoFocus||e.focusCamera)})),e.scene.addEventListener("addSceneObject",(async t=>{var n,i,r;const s=t.object,o=this.getSelectedObject();if(o&&"material"===(null==s?void 0:s.assetType)&&"function"==typeof(null==o?void 0:o.setMaterial)&&(null===(n=null==o?void 0:o.modelObject)||void 0===n?void 0:n.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const t=o.material;if(Array.isArray(t))console.warn("WebGi: Dropping on material array not yet fully supported."),o.setMaterial(s);else{let n=Array.from(null!==(i=null==t?void 0:t.userData.__appliedMeshes)&&void 0!==i?i:[]);(n.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):n.length<1)&&(n=[o]);for(const e of n)e&&(null===(r=e.setMaterial)||void 0===r||r.call(e,s))}}})),e.scene.addEventListener("sceneUpdate",(t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let i=!1;null==n||n.traverseAncestors((t=>{t===e.scene.modelObject&&(i=!0)})),i||this.setSelectedObject(void 0)}))}async focusObject(e){var t,n,i,r;const s=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("CameraViews");await(null==s?void 0:s.animateToFitObject(e,1.25,1e3,"easeOut",{min:(null!==(r=null===(i=null===(n=this._viewer)||void 0===n?void 0:n.scene.activeCamera.getControls())||void 0===i?void 0:i.minDistance)&&void 0!==r?r:.5)+.5,max:50}))}enableWidget(e){var t,n,i;if(this._enableWidget=e,e){const e=(null===(t=this._picker)||void 0===t?void 0:t.selectedObject)||void 0;e&&(null===(n=this._widget)||void 0===n||n.attach(e))}else null===(i=this._widget)||void 0===i||i.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}za.PluginType="Picking",ja([re()],za.prototype,"enabled",void 0),ja([re()],za.prototype,"autoFocus",void 0);var Ga,Va=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Ha=Ga=class extends _t{enableCustomBump(e,t,n){var i,r;const s=null===(i=e.materialObject)||void 0===i?void 0:i.userData;if(!s)return!1;if(void 0===s._hasCustomBump){const e=s.__appliedMeshes;let t=!0;if(e)for(const{geometry:n}of e)!n||n.attributes.position&&n.attributes.normal&&n.attributes.uv||(t=!1);if(!t)return!1}return s._hasCustomBump=!0,s._customBumpScale=null!==(r=null!=n?n:s._customBumpScale)&&void 0!==r?r:.001,s._customBumpMap=null!=t?t:s._customBumpMap,e.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Qa(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new n.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(e,t)=>this.enabled&&(null==t?void 0:t.materialObject.userData._hasCustomBump)?"#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n#if CUSTOM_BUMP_MAP_BICUBIC > 0  \nvec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}\n#endif\nvarying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);\n#if CUSTOM_BUMP_MAP_BICUBIC > 0\nfloat Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;\n#else\nfloat Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;\n#endif\nreturn vec2(dBx,dBy);}\n#ifndef USE_BUMPMAP\nvec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}\n#endif\n#endif\n":"",shaderExtender:(e,t,n)=>{var i;this.enabled&&t.materialObject.userData._hasCustomBump&&(null===(i=t.materialObject.userData)||void 0===i?void 0:i._customBumpMap)&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker beforeAccumulation","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );\n#endif\n                ",{prepend:!0}),e.vertexShader=ot(e.vertexShader,"#include <uv_pars_vertex>","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n                varying vec2 vCustomBumpUv;\n                uniform mat3 customBumpUvTransform;\n#endif\n                ",{prepend:!0}),e.vertexShader=ot(e.vertexShader,"#include <uv_vertex>","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;\n#endif\n                ",{prepend:!0}),e.defines.USE_UV="")},onObjectRender:(e,t)=>{var n;const i=t.materialObject.userData;if(!(null==i?void 0:i._hasCustomBump))return;const r=e;if(!r.isMesh||!r.geometry)return;const s=(null===(n=i._customBumpMap)||void 0===n?void 0:n.isTexture)?i._customBumpMap:null;this._uniforms.customBumpMap.value=s,this._uniforms.customBumpScale.value=s?i._customBumpScale:0,s&&(s.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(s.matrix));let o=this.enabled&&s?1:0;t.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==o&&(t.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=o,t.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_DEBUG,t.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==o&&(t.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=o,t.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,t.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==o&&(t.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=o,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n,i;return(this.enabled?"1":"0")+((null===(t=e.materialObject.userData)||void 0===t?void 0:t._hasCustomBump)?"1":"0")+(null===(i=null===(n=e.materialObject.userData)||void 0===n?void 0:n._customBumpMap)||void 0===i?void 0:i.uuid)},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n=this.enableCustomBump,i={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._hasCustomBump||!1},set value(r){var s;r!==e.materialObject.userData._hasCustomBump&&(r?n(e)||t.alert("One or more geometries cannot be made anisotropic."):(e.materialObject.userData._hasCustomBump=!1,e.materialObject.needsUpdate=!0),null===(s=i.uiRefresh)||void 0===s||s.call(i,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!e.materialObject.userData._hasCustomBump,property:[e.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!e.materialObject.userData._hasCustomBump,property:[e.materialObject.userData,"_customBumpMap"],onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}},X(e.materialObject.userData,"_customBumpMap")]};return i}},this.setDirty=()=>{var e,t,n;null===(t=(e=this.materialExtension).setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()},this.enableCustomBumpSelected=()=>{var e,t,n;const i=null===(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject())||void 0===n?void 0:n.material;return"material"===(null==i?void 0:i.assetType)&&this.enableCustomBump(i)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s;await super.onAdded(e);const o=e.getPlugin(Ls);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==o?void 0:o.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(Wa)}async onRemove(e){var t,n,i,r,s,o,a,l,c,u,d,h;null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate);const p=null===(l=null===(a=null===(o=null===(s=e.getPlugin(Ls))||void 0===s?void 0:s.exporter)||void 0===o?void 0:o.getExporter("gltf","glb"))||void 0===a?void 0:a.extensions)||void 0===l?void 0:l.indexOf(Wa);return void 0!==p&&-1!==p&&(null===(h=null===(d=null===(u=null===(c=e.getPlugin(Ls))||void 0===c?void 0:c.exporter)||void 0===u?void 0:u.getExporter("gltf","glb"))||void 0===d?void 0:d.extensions)||void 0===h||h.splice(p,1)),super.onRemove(e)}};Ha.PluginType="CustomBumpMapPlugin",Ha.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",Va([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],Ha.prototype,"enabled",void 0),Va([Oe("Bicubic",(e=>({onChange:e.setDirty}))),z("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,Ga.prototype.setDirty),re()],Ha.prototype,"bicubicFiltering",void 0),Va([je("Enable CustomBumpMap",(e=>({hidden:()=>{var t;return!(null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))}})))],Ha.prototype,"enableCustomBumpSelected",void 0),Ha=Ga=Va([We("CustomBumpMap Materials")],Ha);class Qa{constructor(e){this.parser=e,this.name=Ha.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){var i;const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],a=s.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=null!==(i=a.customBumpScale)&&void 0!==i?i:0;const l=a.customBumpMap;return l&&o.push(r.assignTexture(t.userData,"_customBumpMap",l).then((e=>{e.colorSpace=n.KI_}))),Promise.all(o)}}const Wa=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._hasCustomBump)return;if((t.userData._customBumpScale||0)<.001)return;n.extensions=n.extensions||{};const i={};if(i.customBumpScale=t.userData._customBumpScale||1,t.userData._customBumpMap){const n={index:e.processTexture(t.userData._customBumpMap)};e.applyTextureTransform(n,t.userData._customBumpMap),i.customBumpMap=n}n.extensions[Ha.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=i,e.extensionsUsed[Ha.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var qa,Xa=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Ya=qa=class extends _t{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(e){this._animationTime=Math.max(0,Math.min(e,this._animationDuration))}_wheel({deltaY:e}){this.enabled&&Math.abs(e)>.001&&(this._scrollAnimationState=-1*Math.sign(e))}_drag(e){this.enabled&&this._viewer&&("x"===this.dragAxis?this._dragAnimationState=e.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=e.delta.y*this._viewer.canvas.height/4)}_postFrame(){var e,n;if(!this._viewer)return;const i=this._viewer,r=this.animateOnScroll,s=this.animateOnDrag;if(!this.enabled||this.animations.length<1||"playing"!==this._animationState&&!r&&!s)return this._lastFrameTime=0,void(this._fadeDisabled&&(null===(e=this._viewer.getPluginByType("FrameFade"))||void 0===e||e.enable(qa.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const e=(0,t.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/30);let i=e-this._lastFrameTime;if(i*=this.animationSpeed,this._lastFrameTime=e,r&&s?i*=(0,t.absMax)(this._scrollAnimationState,this._dragAnimationState):r?i*=this._scrollAnimationState:s&&(i*=this._dragAnimationState),Math.abs(i)<1e-4)return;const o=null===(n=this._viewer.getPluginByType("Progressive"))||void 0===n?void 0:n.postFrameConvergedRecordingDelta();if(o&&o>0&&(i=o),0===o)return;const a=Math.abs(this.timeScale);this._animationTime+=i*(a>0?a:1)}const o=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const a=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map((e=>{e.mixer.setTime(a)})),!(Math.abs(o)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:o,time:a}),i.scene.activeCamera.cameraObject.userData.__animatingCamera&&i.scene.activeCamera.setDirty(),i.scene.refreshActiveCameraNearFar(),i.renderer.resetShadows(),i.setDirty(),!this._fadeDisabled){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(qa.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[Ls],this._pointerDragHelper=new t.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=e=>{const t=e.object;if("model"!==t.assetType||!t.modelObject)return;if(!this._viewer)return;let i=!1;t.modelObject.traverse((e=>{var r;const s=e.animations;if(s.length<1)return;const o=Math.max(...s.map((e=>e.duration)));(null!==(r=t.modelObject.userData.gltfAnim_SyncMaxDuration)&&void 0!==r?r:this.syncMaxDuration)&&(s.forEach((e=>e.duration=o)),t.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const a=new n.Xcj(this._viewer.scene.modelRoot.modelObject),l=s.map((e=>a.clipAction(e).setLoop(this.loopAnimations?n.YKA:n.jAl,this.loopRepetitions)));l.forEach((e=>e.clampWhenFinished=!0)),this.animations.push({mixer:a,clips:s,actions:l,duration:o}),i=!0})),i&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Ka(e,this)))}async onAdded(e){var t,n,i,r,s,o;null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),e.scene.addEventListener("addSceneObject",this._objectAdded),null===(o=null===(s=null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.exporter)||void 0===r?void 0:r.getExporter("gltf","glb"))||void 0===s?void 0:s.extensions)||void 0===o||o.push(Ja),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=e.canvas;let a=-1;return Object.defineProperty(e.scene.modelRoot,"currentTimelineMarker",{get:()=>a,set:t=>e.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[a=t]})}),e.scene.modelRoot.addEventListener("animationTimelineMarker",(({marker:e})=>{var t;if(!this._viewer)return;if(!e)return this._viewer.scene.activeCamera=null===(t=this._viewer)||void 0===t?void 0:t.scene.defaultCamera,void this._viewer.setDirty();const n=e.camera;n&&(n.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(n))})),super.onAdded(e)}async onRemove(e){for(var t,n;this.animations.length;)this.animations.pop();return e.scene.removeEventListener("addSceneObject",this._objectAdded),null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(e)}_onPropertyChange(e=!0){this._animationDuration=Math.max(...this.animations.map((({duration:e})=>e)))*(this.loopAnimations?this.loopRepetitions:1),"playing"===this._animationState&&e&&this.playAnimation()}onStateChange(){var e,n;null===(n=null===(e=this.uiConfig)||void 0===e?void 0:e.children)||void 0===n||n.map((e=>e&&(0,t.getOrCall)(e))).flat(2).forEach((e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e)}))}playPauseAnimation(){"playing"===this._animationState?this.pauseAnimation():this.playAnimation()}async playClip(e,t=!1){return this.playClips([e],t)}async playClips(e,t=!1){const n=[];return this.animations.forEach((({actions:t})=>{t.forEach((t=>{e.includes(t.getClip().name)&&n.push(t)}))})),this.playAnimation(t,n)}async playAnimation(e=!1,t){var i;if(!this.enabled)return;let r=!1;"playing"===this._animationState&&(this.stopAnimation(!1),r=!0);let s=0;const o=!t;t||(t=[],this.animations.forEach((({mixer:e,actions:n,clips:i})=>{t.push(...n)}))),r?this.resetAnimation():"paused"!==this.animationState&&(t.forEach((e=>{e.reset()})),this._animationTime=0);const a=De();this._lastAnimId=a;for(const l of t)l.setLoop(this.loopAnimations?n.YKA:n.jAl,this.loopRepetitions),l.play(),s=Math.max(s,l.getClip().duration/Math.abs(l.timeScale));if(this._animationState="playing",null===(i=this._viewer)||void 0===i||i.setDirty(),o){if(!isFinite(this._animationDuration))return;await new Promise(((e,t)=>{const n=()=>{this.removeEventListener("checkpointEnd",n),e()};this.addEventListener("checkpointEnd",n)}))}else{const e=this.loopAnimations?this.loopRepetitions:1;if(s*=e,!isFinite(s))return;await new Promise(((e,t)=>{const n=t=>{t.time>=s&&(this.removeEventListener("animationStep",n),e())};this.addEventListener("animationStep",n)}))}a===this._lastAnimId&&this.stopAnimation(e)}pauseAnimation(){var e;"playing"===this._animationState?(this._animationState="paused",null===(e=this._viewer)||void 0===e||e.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var e;"paused"===this._animationState?(this._animationState="playing",null===(e=this._viewer)||void 0===e||e.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(e=!1){var t,n;this._animationState="stopped",e?this.resetAnimation():null===(t=this._viewer)||void 0===t||t.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&(null===(n=this._viewer.getPluginByType("FrameFade"))||void 0===n||n.enable(qa.PluginType),this._fadeDisabled=!1)}resetAnimation(){var e;"stopped"===this._animationState||"none"===this._animationState?(this.animations.forEach((({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)})),this._animationTime=0,null===(e=this._viewer)||void 0===e||e.setDirty()):this.stopAnimation(!0)}};Ya.PluginType="GLTFAnimation",Ya.AnimationMarkersExtension="WEBGI_animation_markers",Xa([re()],Ya.prototype,"autoIncrementTime",void 0),Xa([Le()],Ya.prototype,"animationState",null),Xa([Le()],Ya.prototype,"animationTime",null),Xa([Le()],Ya.prototype,"animationDuration",null),Xa([(0,t.onChange2)(qa.prototype._onPropertyChange),Oe("Loop",{limitedUi:!0}),re()],Ya.prototype,"loopAnimations",void 0),Xa([(0,t.onChange2)(qa.prototype._onPropertyChange),re()],Ya.prototype,"loopRepetitions",void 0),Xa([Ue("Timescale",[-2,2],.01),re()],Ya.prototype,"timeScale",void 0),Xa([Ue("Speed",[.1,4],.1,{limitedUi:!0}),re()],Ya.prototype,"animationSpeed",void 0),Xa([Oe(),re()],Ya.prototype,"animateOnScroll",void 0),Xa([Oe(),re()],Ya.prototype,"animateOnDrag",void 0),Xa([Fe("Drag Axis",[{label:"x"},{label:"y"}]),re()],Ya.prototype,"dragAxis",void 0),Xa([Oe(),re()],Ya.prototype,"autoplayOnLoad",void 0),Xa([Oe("syncMaxDuration(dev)"),re()],Ya.prototype,"syncMaxDuration",void 0),Xa([(0,t.onChange)(qa.prototype.onStateChange)],Ya.prototype,"_animationState",void 0),Xa([je("Play/Pause",(e=>({label:()=>"playing"===e.animationState?"Pause":"Play",limitedUi:!0})))],Ya.prototype,"playPauseAnimation",null),Xa([je("Stop",{limitedUi:!0})],Ya.prototype,"stopAnimation",null),Xa([je("Reset",{limitedUi:!0})],Ya.prototype,"resetAnimation",null),Ya=qa=Xa([We("GLTF Animations")],Ya);class Ka{constructor(e,t){this.parser=e,this.name=Ya.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){var t;let i=[];for(const n of this.parser.json.scenes||[]){if(!n.extensions)continue;const e=n.extensions[this.name];for(const t of(null==e?void 0:e.markers)||[]){const e=void 0!==t.camera?await this.parser.getDependency("camera",t.camera):void 0;if(void 0===t.time){const e=30;t.time=t.frame/e,console.error("Update timeline markers plugin for correct times.")}i.push({name:t.name,frame:t.frame,time:t.time,camera:e})}}if(i.length<1)return;i=i.sort(((e,t)=>e.frame-t.frame));const r=null!==(t=e.scene)&&void 0!==t?t:e.scenes[0];if(!r)return;r.userData.__markers=i;const s=this.plugin.timelineMarkers,o=i.map((e=>e.time));let a=s.length;const l=i.map((e=>a++)),c=Math.max(...o)+.01;s.push(...i);const u=new n.dUE(".currentTimelineMarker",o,l,n.Syv),d=new n.m7l("animationTimelineMarker",c,[u]);d.__gltfExport=!1,e.animations.push(d)}}const Ja=e=>({afterParse(t){const n=e.json.scenes[e.json.scene||0];n.extensions=n.extensions||{};const i={markers:[]},r=[];if((Array.isArray(t)?t:[t]).forEach((e=>e.traverse((e=>{e.userData.__markers&&r.push(...e.userData.__markers)})))),r.sort(((e,t)=>e.frame-t.frame)),!(r.length<1)){for(const t of r){const n=t.camera;if(n){const r=e.nodeMap.get(n);if(void 0===r){console.warn("Camera not found in gltf export",n,e.nodeMap);continue}const s=e.json.nodes[r].camera;t.camera=s,i.markers.push(t)}}n.extensions[Ya.AnimationMarkersExtension]=i,e.extensionsUsed[Ya.AnimationMarkersExtension]=!0}}});var Za="#ifndef BASIC_CAMERA_HELPERS\n#define BASIC_CAMERA_HELPERS \nuniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;\n#ifndef THREE_PACKING_INCLUDED\n#define THREE_PACKING_INCLUDED \n#include <packing>\n#endif\nfloat linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}\n#endif\n",$a="#define PI  3.141592653589793\nmat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}",el="#ifndef SSRT_PARS_SNIP\n#define SSRT_PARS_SNIP \n#define pow2(a)a*a\nfloat getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}\n#define LOD_DEPTH  1.0\n#define LOD_COLOR  5.0\nvoid _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;\n#pragma unroll_loop_start\nfor(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}\n#pragma unroll_loop_end\n}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}\n#endif\n",tl="#ifndef BASIC_HELPERS\n#define BASIC_HELPERS \nfloat saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}\n#endif\n",nl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class il extends ht{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,i,r,s=!1){super({vertexShader:lo,fragmentShader:`\n\n${tl}\n${Za}\n${co}\n${$a}\n${r}\n\n${el}\n\nvarying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\nvec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);\n#endif\nreturn vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}\n\n            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!s},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new n.yGw},screenSize:{value:new n.FM8},cameraPositionWorld:{value:new n.Pa4},cameraNearFar:{value:new n.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:s?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(e,t,n)=>{var i;if(!e.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=null===(i=this._target)||void 0===i?void 0:i.texture;const r=t.materialObject;let s=this.material.defines.SSGI_ENABLED;r.defines.SSGI_ENABLED!==s&&(r.defines.SSGI_ENABLED=s,r.needsUpdate=!0),s=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==s&&(this.materialExtension.extraUniforms.tSSGIMap.value=s,r.needsUpdate=!0);const o="vec3 totalDiffuse =";e.fragmentShader=e.fragmentShader.replace(o,`\n\n            \n            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0\nvec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\nvec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);\n#endif\n#if defined( USE_ENVMAP )\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\n#if !defined(SSR_ENABLED) || SSR_ENABLED < 1\nreflectedLight.indirectSpecular+=ssgiColor*material.specularColor;\n#endif\n#endif\n#endif\n#endif\n\n            \n            // reflectedLight.directDiffuse = vec3(0.);\n            // reflectedLight.indirectDiffuse = vec3(0.);\n            // reflectedLight.directSpecular = vec3(0.);\n            // reflectedLight.indirectSpecular = vec3(0.);\n            \n            \n${o}`),e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",""),e.defines.USE_UV=""},onObjectRender:(e,t,n)=>{var i,r,s;const o=t.materialObject,a=!o.transparent&&o.transmission<.001,l=this.enabled&&a&&(this.renderWithCamera||this._renderer.frameCount>1)&&!1!==n.userData.screenSpaceRendering&&!(null===(i=o.userData)||void 0===i?void 0:i.ssrtaoDisabled)&&!(null===(r=o.userData)||void 0===r?void 0:r.ssaoDisabled)&&!(null===(s=o.userData)||void 0===s?void 0:s.pluginsDisabled)?1:0;o.defines.SSRTAO_ENABLED!==l&&(o.defines.SSRTAO_ENABLED=l,o.needsUpdate=!0)},parsFragmentSnippet:e=>{var n;return t.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${L("tSSGIMap",null===(n=this._target)||void 0===n?void 0:n.texture,e.capabilities.isWebGL2)}

            ${uo}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:e=>{var t,n,i,r;return this.enabled?"1":"0"+(null===(n=null===(t=this._target)||void 0===t?void 0:t.texture)||void 0===n?void 0:n.colorSpace)+(null===(r=null===(i=this._target)||void 0===i?void 0:i.texture)||void 0===r?void 0:r.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:e=>{var t;return!(null===(t=e.materialObject.userData)||void 0===t?void 0:t.ssaoDisabled)&&e.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...He(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=s,this.ssgiEnabled=s,this.bilateralPass=new ao(this._target,r,"rgba")}render(e,t,n,i,r){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,r),this.smoothEnabled&&this.bilateralPass.render(e,t,n,i,r))}}nl([re()],il.prototype,"bilateralPass",void 0),nl([Ue("Intensity",[0,4]),re(),j()],il.prototype,"intensity",void 0),nl([Ue("Power",[0,3]),re(),j()],il.prototype,"power",void 0),nl([Oe("Auto radius"),re(),j()],il.prototype,"autoRadius",void 0),nl([Ue("Object Radius",[.01,10]),re(),j()],il.prototype,"objectRadius",void 0),nl([Ue("Tolerance",[.1,5]),re(),j()],il.prototype,"tolerance",void 0),nl([Ue("Bias",[-.3,.3]),re(),j()],il.prototype,"bias",void 0),nl([Ue("Falloff",[1e-4,4]),re(),j()],il.prototype,"falloff",void 0),nl([Ue("Ray Count",[1,5],1),re(),j()],il.prototype,"rayCount",void 0),nl([Ue("Step count",[1,16],1),re(),z("RTAO_STEP_COUNT")],il.prototype,"stepCount",void 0),nl([Oe("Smooth Enabled"),re()],il.prototype,"smoothEnabled",void 0),nl([Oe("Render with Camera")],il.prototype,"renderWithCamera",void 0);class rl extends so{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[Ls,At,To],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var t,n;await super.onAdded(e),this.enabled=this._initEnabled,null===(n=(t=this.uiConfig).uiRefresh)||void 0===n||n.call(t,"postFrame",!0)}get enabled(){var e,t;return(null===(t=null===(e=this.passes.ssrtgi)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)||!1}set enabled(e){var t;(null===(t=this.passes.ssrtgi)||void 0===t?void 0:t.passObject)&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,n,i;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),null===(t=this._viewer)||void 0===t||t.getPluginByType("debug"),[vt(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new il(e.renderer,this._rtgiTarget,null!==(i=null===(n=e.getPlugin(At))||void 0===n?void 0:n.getUnpackSnippet())&&void 0!==i?i:"",!0),update:()=>{var t;const n=this.enabled;if(n){const e=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("SSAO");(null==e?void 0:e.enabled)&&(e.enabled=!1)}n&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(At)])}},(()=>[e.getPlugin(At),e.getPlugin(To),e.scene.activeCamera,e.renderer]))]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get uiConfig(){var e,n,i,r,s;const o=null!==(i=null===(n=null===(e=this.passes.ssrtgi)||void 0===e?void 0:e.passObject)||void 0===n?void 0:n.uiConfig)&&void 0!==i?i:{};return null===(s=null===(r=o.children)||void 0===r?void 0:r.map((e=>(0,t.getOrCall)(e))))||void 0===s||s.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),o}}rl.PluginType="SSGI";let sl=class extends pt{constructor(e,t,i){super(e,t,null!=i?i:new ol,new n.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(e,t,n,i,r){this.enabled&&super.render(e,t,n,i,r)}};sl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([We("High Precision Normal Buffer")],sl);class ol extends n.RSm{constructor(){super()}onBeforeRender(e,t,i,r,s){var o,a,l;let c=s.material;Array.isArray(c)&&(c=c[0]),this.normalMap=null!==(o=null==c?void 0:c.normalMap)&&void 0!==o?o:null,this.bumpMap=null!==(a=null==c?void 0:c.bumpMap)&&void 0!==a?a:null,this.bumpScale=null==c?void 0:c.bumpScale,(null==c?void 0:c.normalScale)&&this.normalScale.copy(null==c?void 0:c.normalScale),this.needsUpdate=!0,this.side=null!==(l=c.side)&&void 0!==l?l:n.ehD}}class al extends yt{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:n.cLu,minFilter:n.TyD,magFilter:n.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,i=new Set,r=new Set;return new class extends sl{render(e,n,s,o,a){const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel();this.scene&&(this.scene.traverse((({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(i.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(r.add([e,e.transmission]),e.transmission=0))})),H(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},(()=>super.render(e,n,t,o,a))),i.forEach((e=>e.transparent=!e.transparent)),i.clear(),r.forEach((([e,t])=>e.transmission=t)),r.clear(),e.setRenderTarget(l,c,u))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,n;return e.renderer.disposeTarget(null===(n=null===(t=this._normalTarget)||void 0===t?void 0:t.dispose)||void 0===n?void 0:n.call(t)),super.onRemove(e)}updateShaderProperties(e){var t,n;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&null!==(n=null===(t=this.getNormalBuffer())||void 0===t?void 0:t.texture)&&void 0!==n?n:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig}}al.PluginType="NormalBufferPlugin";var ll=function(e,t){return ll=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ll(e,t)};function cl(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ll(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ul,dl=function(){function e(){}return e._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},e}(),hl=function(e){function t(n){var i=e.call(this)||this;return i.a=t._xfnv1a(n)(),i}return cl(t,e),t.prototype.next=function(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296},t}(dl),pl=function(e){function t(n){var i=e.call(this)||this,r=t._xfnv1a(n);return i.a=r(),i.b=r(),i.c=r(),i.d=r(),i}return cl(t,e),t.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var e=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,e=e+this.d|0,this.c=this.c+e|0,(e>>>0)/4294967296},t}(dl),fl=function(e){function t(n){var i=e.call(this)||this,r=t._xfnv1a(n);return i.a=r(),i.b=r(),i.c=r(),i.d=r(),i}return cl(t,e),t.prototype.next=function(){var e=this.b<<9,t=5*this.a;return t=t<<7|9*(t>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=e,this.d=this.d<<11|this.d>>>21,(t>>>0)/4294967296},t}(dl);!function(e){e.sfc32="sfc32",e.mulberry32="mulberry32",e.xoshiro128ss="xoshiro128ss"}(ul||(ul={}));var ml=function(){function e(e,t){void 0===t&&(t=ul.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return e.prototype.next=function(){return this.generator.next()},e.prototype._initializeGenerator=function(){if(function(e){return null===e}(e=this.str)||function(e){return void 0===e}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new pl(this.str);case"mulberry32":return new hl(this.str);case"xoshiro128ss":return new fl(this.str);default:return this.wrap()}},e.prototype.wrap=function(){return{next:function(){return Math.random()}}},e}(),gl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class _l extends si{constructor(e,t,i,r){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new n.Pa4(10,10,10),normalDirection:new n.Pa4(.01,.98,.01).normalize(),direction:new n.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=null!=i?i:{},this.randomParams=null!=r?r:{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach((t=>void 0===e[t]&&delete e[t])),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach((t=>void 0===e[t]&&delete e[t])),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,i=null){const r=new ml(e.toString()),s=new n.FM8(r.next()*Math.PI*2,Math.asin(2*r.next()-1));let o=new n.Pa4(Math.cos(s.x)*Math.cos(s.y),Math.sin(s.y),Math.sin(s.x)*Math.cos(s.y));const a=new n.FM8;for(let n=0;n<5;n++){a.set(r.next(),r.next()),o=vl(a,this._randomParams.normalDirection,.4),r.next()<Math.sqrt(null!=t?t:this._randomParams.focus)&&(a.set(r.next(),r.next()),o=vl(a,this._randomParams.direction,Math.pow((null!=i?i:this._randomParams.spread)/2,2)));const e=o.dot(this._randomParams.normalDirection);if(e>0&&e<.4)break}o.normalize(),o.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(o.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=(new n.Pa4).subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function vl(e,t,i){t=t.clone().normalize();const r=new n.Pa4(0,-t.z,t.y).normalize(),s=(new n.Pa4).crossVectors(t,r).normalize(),o=e;o.x=2*o.x*Math.PI,o.y=1-o.y*i;const a=Math.sqrt(1-o.y*o.y);return r.multiplyScalar(Math.cos(o.x)*a).add(s.multiplyScalar(Math.sin(o.x)*a)).add(t.multiplyScalar(o.y))}gl([re("shadowParams")],_l.prototype,"_shadowParams",void 0),gl([re("randomParams")],_l.prototype,"_randomParams",void 0);var yl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class bl extends _t{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new _l("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var e,t,n;if(!this.enabled)return void(this.light.layers.mask=0);const i=null!==(t=null===(e=this._viewer)||void 0===e?void 0:e.renderer.frameCount)&&void 0!==t?t:0;this.light.randomizePosition(i<5?0:i),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),null===(n=this._cameraHelper)||void 0===n||n.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new n.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,n;e?null===(t=this._viewer)||void 0===t||t.scene.setDirty():null===(n=this._viewer)||void 0===n||n.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}bl.PluginType="RandomizedDirectionalLight",yl([re()],bl.prototype,"enabled",void 0),yl([re("rdLight")],bl.prototype,"light",void 0),yl([re()],bl.prototype,"lightLayers",void 0);var Al="uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;\n#ifndef D_sceneBoundingRadius\n#define D_sceneBoundingRadius \nuniform float sceneBoundingRadius;\n#endif\nvec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}",wl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let xl=class extends ht{constructor(e,t,i,r=!0){super({vertexShader:lo,fragmentShader:`\n\nvarying vec2 vUv;\n\n${tl}\n${Za}\n${co}\n${$a}\n${i}\n\n${el}\n\n${Al}\n\nuniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}\n#include <encodings_fragment>\n}\n\n\n            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new n.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new n.yGw},cameraPositionWorld:{value:new n.Pa4},cameraNearFar:{value:new n.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:r?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(e,t,n)=>{var i,r,s,o,a;let l=!this.enabled||!1===n.userData.screenSpaceRendering||(null===(i=t.materialObject.userData)||void 0===i?void 0:i.pluginsDisabled)||(null===(r=t.materialObject.userData)||void 0===r?void 0:r.ssreflDisabled)?0:1;if(t.materialObject.defines.SSR_ENABLED!==l&&(t.materialObject.defines.SSR_ENABLED=l,t.materialObject.needsUpdate=!0),!e.defines.SSR_ENABLED)return;l=this.material.defines.SSR_STEP_COUNT,t.materialObject.defines.SSR_STEP_COUNT!==l&&(t.materialObject.defines.SSR_STEP_COUNT=l,t.materialObject.needsUpdate=!0),l=this.material.defines.SSR_LOW_QUALITY_FRAMES,t.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==l&&(t.materialObject.defines.SSR_LOW_QUALITY_FRAMES=l,t.materialObject.needsUpdate=!0),l=this.material.defines.PERSPECTIVE_CAMERA,t.materialObject.defines.PERSPECTIVE_CAMERA!==l&&(t.materialObject.defines.PERSPECTIVE_CAMERA=l,t.materialObject.needsUpdate=!0),l=this.material.defines.SSR_INLINE,t.materialObject.defines.SSR_INLINE!==l&&(t.materialObject.defines.SSR_INLINE=l,t.materialObject.needsUpdate=!0),l=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,t.materialObject.defines.SSR_MASK_FRONT_RAYS!==l&&(t.materialObject.defines.SSR_MASK_FRONT_RAYS=l,t.materialObject.needsUpdate=!0),l=(null===(s=t.materialObject.userData)||void 0===s?void 0:s.ssreflNonPhysical)?"1":"0",t.materialObject.defines.SSR_NON_PHYSICAL!==l&&(t.materialObject.defines.SSR_NON_PHYSICAL=l,t.materialObject.needsUpdate=!0),l=null!==(a=null===(o=this._target)||void 0===o?void 0:o.texture)&&void 0!==a?a:null,this.materialExtension.extraUniforms.tSSRMap.value!==l&&(this.materialExtension.extraUniforms.tSSRMap.value=l,t.materialObject.needsUpdate=!0);const c="#glMarker beforeModulation";e.fragmentShader=e.fragmentShader.replace(c,`\n\n            \n            #if defined(SSR_ENABLED) && SSR_ENABLED > 0\nvec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;\n#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0\nalphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);\n#endif\n#ifdef USE_TRANSMISSION\nalphaModifier*=1.-transmission;\n#endif\nfloat vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){\n#if defined(SSR_INLINE) && SSR_INLINE > 0\nssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);\n#else\nssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));\n#endif \n}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);\n#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0\ndiffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);\n#else\nreflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);\n#endif\n#endif\n\n            \n            // reflectedLight.directDiffuse = vec3(0.);\n            // reflectedLight.indirectDiffuse = vec3(0.);\n            // reflectedLight.directSpecular = vec3(0.);\n            // reflectedLight.indirectSpecular = vec3(0.);\n            \n            \n${c}`)},onObjectRender:(e,t,n)=>{var i,r;const s=!this.enabled||!1===n.userData.screenSpaceRendering||(null===(i=t.materialObject.userData)||void 0===i?void 0:i.pluginsDisabled)||(null===(r=t.materialObject.userData)||void 0===r?void 0:r.ssreflDisabled)?0:1;t.materialObject.defines.SSR_ENABLED!==s&&(t.materialObject.defines.SSR_ENABLED=s,t.materialObject.needsUpdate=!0)},parsFragmentSnippet:(e,t)=>{var n,i,r;return!this.enabled||!1===e.userData.screenSpaceRendering||(null===(n=null==t?void 0:t.materialObject.userData)||void 0===n?void 0:n.ssreflDisabled)||(null===(i=null==t?void 0:t.materialObject.userData)||void 0===i?void 0:i.pluginsDisabled)?"":"\nuniform float ssrPower;\nuniform float ssrIntensity;\nuniform float ssrMaskFrontFactor;\nuniform vec3 ssrBoost;\nuniform sampler2D tSSRMap;\nuniform sampler2D tLastFrame;\n"+L("tSSRMap",null===(r=this._target)||void 0===r?void 0:r.texture,e.capabilities.isWebGL2)+L("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,e.capabilities.isWebGL2)+(this._inline?`\n#if 1\n// #if SSR_INLINE\n    ${tl}\n    \n    #define THREE_PACKING_INCLUDED\n    ${Za}\n    \n    ${co}\n    ${$a}\n    ${gt}\n    \n    ${el}\n    \n    ${Al}\n// #endif // SSR_INLINE\n#endif\n`:"")+`\n${uo}\n        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:e=>{var t,n,i;return this.enabled?"1":"0"+(null===(n=null===(t=this._target)||void 0===t?void 0:t.texture)||void 0===n?void 0:n.colorSpace)+(this.enabled&&!(null===(i=e.materialObject.userData)||void 0===i?void 0:i.ssreflDisabled)?1:0)+Object.values(this.material.defines).map((e=>e+"")).join(",")},isCompatible:e=>{var t;return!(null===(t=e.materialObject.userData)||void 0===t?void 0:t.ssreflDisabled)&&e.isMeshStandardMaterial2}},this.intensity=1,this.boost=new n.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=e,this._target=t,this.needsSwap=!1,this._inline=r}render(e,t,n,i,r){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,r),this.needsSwap=!1}}};wl([Ue("Intensity",[0,4]),re(),j()],xl.prototype,"intensity",void 0),wl([Ne("Boost"),re(),j()],xl.prototype,"boost",void 0),wl([Ue("Object Radius",[.01,2]),re(),j()],xl.prototype,"objectRadius",void 0),wl([Oe("Auto radius"),re(),j()],xl.prototype,"autoRadius",void 0),wl([Ue("Power",[0,3]),re(),j()],xl.prototype,"power",void 0),wl([Ue("Tolerance",[.1,5]),re(),j()],xl.prototype,"tolerance",void 0),wl([Ue("Step count",[1,32],1),re(),z("SSR_STEP_COUNT")],xl.prototype,"stepCount",void 0),wl([Ue("Low Quality Frames",[0,4],1),re(),z("SSR_LOW_QUALITY_FRAMES")],xl.prototype,"lowQualityFrames",void 0),wl([Oe("Ignore front rays"),re(),z("SSR_MASK_FRONT_RAYS")],xl.prototype,"maskFrontRays",void 0),wl([Ue("Mask front rays factor",[-1,1],.01,(e=>({hidden:()=>!e.maskFrontRays}))),re(),j()],xl.prototype,"maskFrontFactor",void 0),xl=wl([We("Screen Space Reflections")],xl);class El extends so{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[Ls,At,To],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,t;return(null===(t=null===(e=this.passes.ssr)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)||!1}set enabled(e){var t;(null===(t=this.passes.ssr)||void 0===t?void 0:t.passObject)&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,n;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),null===(n=(t=this.uiConfig).uiRefresh)||void 0===n||n.call(t,"postFrame",!0)}createPasses(e){var t,n;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[vt(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new xl(e.renderer,this._ssrTarget,null!==(n=null===(t=e.getPlugin(At))||void 0===t?void 0:t.getUnpackSnippet())&&void 0!==n?n:"",this.inlineSSR)},(()=>[e.getPlugin(At),e.getPlugin(To),e.scene.activeCamera,e.renderer,e.scene]))]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get uiConfig(){var e,n,i,r,s;const o=null!==(i=null===(n=null===(e=this.passes.ssr)||void 0===e?void 0:e.passObject)||void 0===n?void 0:n.uiConfig)&&void 0!==i?i:{};return null===(s=null===(r=o.children)||void 0===r?void 0:r.map((e=>(0,t.getOrCall)(e))))||void 0===s||s.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),o}}El.PluginType="SSReflection";var Cl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Sl=class extends _t{makeAnisotropic(e){var t;const n=null===(t=e.materialObject)||void 0===t?void 0:t.userData;if(!n)return!1;if(void 0===n._isAnisotropic){const e=n.__appliedMeshes;let t=!0;if(e)for(const{geometry:n}of e)!n||n.index&&n.attributes.position&&n.attributes.normal&&n.attributes.uv||(t=!1),t&&!n.attributes.tangent&&n.computeTangents();if(!t)return!1}return n._isAnisotropic=!0,void 0===n._anisotropyFactor&&(n._anisotropyFactor=1),void 0===n._anisotropyNoise&&(n._anisotropyNoise=0),void 0===n._anisotropyDirectionMode&&(n._anisotropyDirectionMode="DIRECTION"),e.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Ml(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(e,i,r)=>{var s;if(!this.enabled||!i.materialObject.userData._isAnisotropic)return;const o=null===(s=i.materialObject.userData)||void 0===s?void 0:s._anisotropyDirectionMap,a=t.glsl`
                //#if ANISOTROPY_ENABLED
                ${co}
                ${"uniform float anisotropyFactor;uniform float anisotropyNoise;\n#if ANISOTROPY_TEX_MODE == 0\nuniform float anisotropyDirection;\n#else\nuniform sampler2D anisotropyDirectionMap;\n#endif\nconst float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}"}
            `+(o?L("anisotropyDirectionMap",o,r.capabilities.isWebGL2):"")+"\n";e.fragmentShader=ot(e.fragmentShader,"#include <common>",a,{append:!0}),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",n.WdD.lights_fragment_begin),e.fragmentShader=ot(ot(e.fragmentShader,"IncidentLight directLight;","float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;\n#if ANISOTROPY_TEX_MODE < 2\n#if ANISOTROPY_TEX_MODE == 0 \nfloat rot=saturate(anisotropyDirection);\n#else \nfloat rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);\n#endif\nrot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));\n#else \nvec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);\n#endif\nvec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));",{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let l=ot(n.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");l=ot(l,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),e.fragmentShader=ot(e.fragmentShader,"#include <lights_physical_pars_fragment>",l),e.fragmentShader=ot(e.fragmentShader,"#include <normal_fragment_begin>",n.WdD.normal_fragment_begin),e.fragmentShader=ot(e.fragmentShader,"#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) || defined( USE_TANGENT )");let c=t.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+n.WdD.lights_fragment_maps;c=ot(c,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),c=ot(c,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),e.fragmentShader=ot(e.fragmentShader,"#include <lights_fragment_maps>",c),e.defines.USE_UV="",e.vertexTangents=!0},onObjectRender:(e,t)=>{var n;const i=t.materialObject.userData;if(!(null==i?void 0:i._isAnisotropic))return;const r=e;if(!r.isMesh||!r.geometry)return;if(!r.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=i._anisotropyFactor,this._uniforms.anisotropyNoise.value=i._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(null===(n=i._anisotropyDirectionMap)||void 0===n?void 0:n.isTexture)?i._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=i._anisotropyDirection;let s=this.enabled?1:0;t.materialObject.defines.ANISOTROPY_ENABLED!==s&&(t.materialObject.defines.ANISOTROPY_ENABLED=s,t.materialObject.needsUpdate=!0),s=+this._defines.ANISOTROPY_DEBUG,t.materialObject.defines.ANISOTROPY_DEBUG!==s&&(t.materialObject.defines.ANISOTROPY_DEBUG=s,t.materialObject.needsUpdate=!0),s=i._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(s="CONSTANT"),s="DIRECTION"===s?2:"ROTATION"===s?1:0,t.materialObject.defines.ANISOTROPY_TEX_MODE!==s&&(t.materialObject.defines.ANISOTROPY_TEX_MODE=s,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n,i;return(this.enabled?"1":"0")+((null===(t=e.materialObject.userData)||void 0===t?void 0:t._isAnisotropic)?"1":"0")+(null===(i=null===(n=e.materialObject.userData)||void 0===n?void 0:n._anisotropyDirectionMap)||void 0===i?void 0:i.uuid)},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e;return[null===(e=this._viewer)||void 0===e?void 0:e.renderer]},getUiConfig:e=>{const t=this._viewer,n=this.makeAnisotropic,i={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._isAnisotropic||!1},set value(r){var s;r!==e.materialObject.userData._isAnisotropic&&(r?n(e)||t.alert("One or more geometries cannot be made anisotropic."):(e.materialObject.userData._isAnisotropic=!1,e.materialObject.needsUpdate=!0),null===(s=i.uiRefresh)||void 0===s||s.call(i,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map((e=>({label:e}))),onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}}]};return i}},this.setDirty=()=>{var e,t,n;null===(t=(e=this.materialExtension).setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()},this.makeSelectedAnisotropic=()=>{var e,t,n;const i=null===(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject())||void 0===n?void 0:n.material;return"material"===(null==i?void 0:i.assetType)&&this.makeAnisotropic(i)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s;await super.onAdded(e);const o=e.getPlugin(Ls);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==o?void 0:o.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(Tl)}async onRemove(e){var t,n,i,r;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};Sl.PluginType="AnisotropyPlugin",Sl.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",Cl([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],Sl.prototype,"enabled",void 0),Cl([je("Make Anisotropy",(e=>({hidden:()=>{var t;return!(null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))}})))],Sl.prototype,"makeSelectedAnisotropic",void 0),Sl=Cl([We("Anisotropy Materials")],Sl);class Ml{constructor(e){this.parser=e,this.name=Sl.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){var i,r,s;const o=this.parser,a=o.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const l=[],c=a.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=null!==(i=c.anisotropyFactor)&&void 0!==i?i:0,t.userData._anisotropyNoise=null!==(s=null!==(r=c.anisotropyNoiseFactor)&&void 0!==r?r:c.anisotropyNoise)&&void 0!==s?s:0;let{anisotropyDirectionMode:u,anisotropyDirection:d}=c;return u||(u=c.anisotropyTextureMode),d||(d=c.anisotropyRotation),t.userData._anisotropyDirectionMode=u&&"number"==typeof(null==d?void 0:d.index)?u:"CONSTANT","ROTATION"===u||"DIRECTION"===u?l.push(o.assignTexture(t.userData,"_anisotropyDirectionMap",d).then((e=>{e.colorSpace=n.KI_}))):t.userData._anisotropyDirection=null!=d?d:0,Promise.all(l)}afterRoot(e){var t;return null===(t=e.scene)||void 0===t||t.traverse((e=>{var t,n;if(!(null===(n=null===(t=e.material)||void 0===t?void 0:t.userData)||void 0===n?void 0:n._isAnisotropic))return;const i=e.geometry;i.attributes.tangent||(i.computeTangents(),i.attributes.tangent.needsUpdate=!0)})),null}}const Tl=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._isAnisotropic)return;if((t.userData._anisotropyFactor||0)<.001)return;n.extensions=n.extensions||{};const i={};if(i.anisotropyFactor=t.userData._anisotropyFactor||1,i.anisotropyNoiseFactor=t.userData._anisotropyNoise||0,i.anisotropyDirectionMode=t.userData._anisotropyDirectionMode||"CONSTANT",t.userData._anisotropyDirectionMap&&"CONSTANT"!==i.anisotropyDirectionMode){const n={index:e.processTexture(t.userData._anisotropyDirectionMap)};e.applyTextureTransform(n,t.userData._anisotropyDirectionMap),i.anisotropyDirection=n}else i.anisotropyDirectionMode="CONSTANT",i.anisotropyDirection=t.userData._anisotropyDirection||0;n.extensions[Sl.ANISOTROPY_GLTF_EXTENSION]=i,e.extensionsUsed[Sl.ANISOTROPY_GLTF_EXTENSION]=!0}});var Il,Pl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Rl=Il=class extends _t{static AddFragmentClipping(e,t,n,i,r){var s,o,a;const l=null===(s=e.materialObject)||void 0===s?void 0:s.userData;if(!l)return!1;l._fragmentClippingExt||(l._fragmentClippingExt={});const c=l._fragmentClippingExt;return c.clipEnabled=!0,void 0===c.clipPosition&&(c.clipPosition=null!==(o=null==t?void 0:t.toArray())&&void 0!==o?o:[0,0,0,0]),void 0===c.clipParams&&(c.clipParams=null!==(a=null==n?void 0:n.toArray())&&void 0!==a?a:[1,0,0,0]),void 0===c.clipMode&&(c.clipMode=null!=i?i:Dl.Circle),void 0===c.clipInvert&&(c.clipInvert=null!=r&&r),e.materialObject.isMaterial&&(e.needsUpdate=!0),!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new kl(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls,At],this._plane=new n.JOQ,this._viewNormalMatrix=new n.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new n.Ltg},fragClippingParams:{value:new n.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(e,n)=>{var i;return this.enabled&&(null===(i=null==n?void 0:n.materialObject.userData._fragmentClippingExt)||void 0===i?void 0:i.clipEnabled)?uo+t.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${Dl.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${Dl.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${Dl.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${Dl.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${Dl.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(e,n,i)=>{var r;this.enabled&&(null===(r=n.materialObject.userData._fragmentClippingExt)||void 0===r?void 0:r.clipEnabled)&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker mainStart",t.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${Dl.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${Dl.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${Dl.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${Dl.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${Dl.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(e,t)=>{var i,r,s,o,a,l;let c=null===(i=t.materialObject.userData)||void 0===i?void 0:i._fragmentClippingExt;if(t.materialObject.userData.isGBufferMaterial&&e&&(c=null===(s=null===(r=e.material)||void 0===r?void 0:r.userData)||void 0===s?void 0:s._fragmentClippingExt),!(null==c?void 0:c.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(c.clipPosition),c.clipMode===Dl.Plane){const e=null===(o=this._viewer)||void 0===o?void 0:o.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(c.clipParams[0],c.clipParams[1],c.clipParams[2]),this._plane.constant=c.clipParams[3],this._viewNormalMatrix.getNormalMatrix(e),this._plane.applyMatrix4(e,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(c.clipParams);(null===(a=this._viewer)||void 0===a?void 0:a.scene.activeCamera.cameraObject)instanceof n.cPb?this._uniforms.fragClippingCamAspect.value=null===(l=this._viewer)||void 0===l?void 0:l.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let u=this.enabled?1:0;u=+this._defines.FRAG_CLIPPING_DEBUG,t.materialObject.defines.FRAG_CLIPPING_DEBUG!==u&&(t.materialObject.defines.FRAG_CLIPPING_DEBUG=u,t.materialObject.needsUpdate=!0),u=+c.clipMode,t.materialObject.defines.FRAG_CLIPPING_MODE!==u&&(t.materialObject.defines.FRAG_CLIPPING_MODE=u,t.materialObject.needsUpdate=!0),u=+c.clipInvert,t.materialObject.defines.FRAG_CLIPPING_INVERSE!==u&&(t.materialObject.defines.FRAG_CLIPPING_INVERSE=u,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n;return(this.enabled?"1":"0")+((null===(n=null===(t=e.materialObject.userData)||void 0===t?void 0:t._fragmentClippingExt)||void 0===n?void 0:n.clipEnabled)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2||e.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var t;return(null===(t=e.materialObject.userData._fragmentClippingExt)||void 0===t?void 0:t.clipEnabled)||!1},setValue:i=>{var r,s;i!==(null===(r=e.materialObject.userData._fragmentClippingExt)||void 0===r?void 0:r.clipEnabled)&&(i?Il.AddFragmentClipping(e.materialObject)||t.alert("Cannot add fragment clipping extension."):e.materialObject.userData._fragmentClippingExt&&(e.materialObject.userData._fragmentClippingExt.clipEnabled=!1,e.materialObject.needsUpdate=!0),null===(s=n.uiRefresh)||void 0===s||s.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(Dl).map((e=>({label:e[0],value:e[1]}))),hidden:()=>{var t;return!(null===(t=e.materialObject.userData._fragmentClippingExt)||void 0===t?void 0:t.clipEnabled)},property:[e.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._fragmentClippingExt)||void 0===t?void 0:t.clipEnabled)},property:[e.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._fragmentClippingExt)||void 0===t?void 0:t.clipEnabled)},property:[e.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._fragmentClippingExt)||void 0===t?void 0:t.clipEnabled)},property:[e.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var e,t,n;null===(t=(e=this.materialExtension).setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s,o,a;await super.onAdded(e);const l=e.getPlugin(Ls);null===(t=null==l?void 0:l.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==l?void 0:l.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==l?void 0:l.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(Bl),null===(a=null===(o=e.getPlugin(At))||void 0===o?void 0:o.material)||void 0===a||a.registerMaterialExtensions([this.materialExtension])}async onRemove(e){var t,n,i,r;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};var Dl;Rl.PluginType="FragmentClippingExtensionPlugin1",Rl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",Pl([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],Rl.prototype,"enabled",void 0),Rl=Il=Pl([We("FragmentClipping Materials")],Rl),function(e){e[e.Circle=0]="Circle",e[e.Ellipse=1]="Ellipse",e[e.Rectangle=2]="Rectangle",e[e.Plane=3]="Plane",e[e.Sphere=4]="Sphere"}(Dl||(Dl={}));class kl{constructor(e){this.parser=e,this.name=Rl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Rl.AddFragmentClipping(t),t.userData._fragmentClippingExt=ce(i,t.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const Bl=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._fragmentClippingExt)return;if(!t.userData._fragmentClippingExt.clipEnabled)return;n.extensions=n.extensions||{};const i=le(t.userData._fragmentClippingExt,!1);n.extensions[Rl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=i,e.extensionsUsed[Rl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var Ol,Ll=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Ul=Ol=class extends _t{constructor(e=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new n.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=e,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var e,t,i,r;if(!this._viewer)return;const s=this._viewer.scene.background;if(this.enabled&&s!==this._viewer.scene.environment&&"environment"!==s)if(s&&s.isDataTexture)s.mapping=n.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const n=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");n?(n.envmapBg=!0,null===(t=(e=n.uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const o=null===(i=this._viewer.renderer.rendererObject.background.getBoxMesh2())||void 0===i?void 0:i.material,a=null!==(r=null==o?void 0:o.uniforms)&&void 0!==r?r:n.Vj0.backgroundCube.uniforms;a.tripodHeight||(a.tripodHeight={value:1}),a.worldRadius||(a.worldRadius={value:1}),a.originPosition||(a.originPosition={value:new n.Pa4}),a.tripodHeight.value=this.tripodHeight,a.worldRadius.value=this.worldRadius,a.originPosition.value.copy(this.originPosition),o&&(!this.enabled&&o.defines.HDRi_GROUND_PROJ?delete o.defines.HDRi_GROUND_PROJ:this.enabled&&(o.defines.HDRi_GROUND_PROJ="1"),o.needsUpdate=!0),this._viewer.setDirty()}async onAdded(e){var t,i,r;await super.onAdded(e),(null===(r=null===(i=null===(t=this._viewer)||void 0===t?void 0:t.renderer)||void 0===i?void 0:i.rendererObject)||void 0===r?void 0:r.background.getBoxMesh())&&e.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),n.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(n.Vj0.backgroundCube.fragmentShader=ot(n.Vj0.backgroundCube.fragmentShader,"void main() {","#ifdef HDRi_GROUND_PROJ\nfloat intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}\n#define PI_HALF  1.5707963267948966\nuniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}\n#endif\n",{prepend:!0}),n.Vj0.backgroundCube.fragmentShader=ot(n.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;","\nvec3 vReflect = \n#ifdef HDRi_GROUND_PROJ\nhdriProject()\n#else\nvWorldDirection\n#endif\n;\n")),e.scene.addEventListener("environmentChanged",this._paramsChanged)}};Ul.PluginType="HDRiGroundPlugin",Ll([re(),(0,t.onChange)(Ol.prototype._paramsChanged),Oe("Enabled")],Ul.prototype,"enabled",void 0),Ll([re(),(0,t.onChange)(Ol.prototype._paramsChanged),Ue("World Radius",[1,1e3],.01)],Ul.prototype,"worldRadius",void 0),Ll([re(),(0,t.onChange)(Ol.prototype._paramsChanged),Ue("Tripod height",[0,50],.01)],Ul.prototype,"tripodHeight",void 0),Ll([re(),(0,t.onChange)(Ol.prototype._paramsChanged),Ne("Origin Position",void 0,.001,(e=>({onChange:e._paramsChanged})))],Ul.prototype,"originPosition",void 0),Ul=Ol=Ll([We("HDRi Ground")],Ul);var Nl,Fl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let jl=Nl=class extends _t{constructor(e=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[At,Ls],this.materialExtension={shaderExtender:(e,i,r)=>{if(!e.defines.SSCS_ENABLED)return;const s=t.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,o=`\n#if SSCS_ENABLED\n\n    uniform float sscsIntensity;\n    uniform float sscsRadius;\n    uniform float sscsTolerance;\n\n    ${tl}\n    \n    #define THREE_PACKING_INCLUDED\n    ${Za}\n    \n    ${gt}\n    ${co}\n    \n    ${el}\n\n#endif\n            \n            `+n.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${s}\n`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",n.WdD.lights_fragment_begin),e.fragmentShader=ot(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=ot(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{var i,r;const s=t.materialObject;let o=!this.enabled||!1===n.userData.screenSpaceRendering||(null===(i=s.userData)||void 0===i?void 0:i.sscsDisabled)||(null===(r=s.userData)||void 0===r?void 0:r.pluginsDisabled)?0:1;s.defines.SSCS_ENABLED!==o&&(s.defines.SSCS_ENABLED=o,s.needsUpdate=!0),o=this._defines.SSCS_STEP_COUNT,s.defines.SSCS_STEP_COUNT!==o&&(s.defines.SSCS_STEP_COUNT=o,s.needsUpdate=!0),o=+this._defines.SSCS_DEBUG,s.defines.SSCS_DEBUG!==o&&(s.defines.SSCS_DEBUG=o,s.needsUpdate=!0)},parsFragmentSnippet:()=>"\n",extraUniforms:{...Nl._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,n,i,r;return[null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(At),null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(To),null===(n=this._viewer)||void 0===n?void 0:n.scene.renderCamera,null===(i=this._viewer)||void 0===i?void 0:i.renderer,null===(r=this._viewer)||void 0===r?void 0:r.scene]}},this.enabled=e,this.userData={setDirty:()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()}}}async onAdded(e){var t,n;await super.onAdded(e),null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.registerMaterialExtension(this.materialExtension)}async onRemove(e){var t,n;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),super.onRemove(e)}};jl.PluginType="SSContactShadows",jl._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new n.yGw},cameraPositionWorld:{value:new n.Pa4},cameraNearFar:{value:new n.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},Fl([Oe("Enabled"),re()],jl.prototype,"enabled",void 0),Fl([j({uniforms:Nl._uniforms,propKey:"sscsRadius"}),Ue("Radius",[1e-4,.1],1e-4),re()],jl.prototype,"radius",void 0),Fl([j({uniforms:Nl._uniforms,propKey:"sscsIntensity"}),Ue("Intensity",[1e-4,1],1e-4),re()],jl.prototype,"intensity",void 0),Fl([j({uniforms:Nl._uniforms,propKey:"sscsTolerance"}),Ue("Tolerance",[.1,5]),re()],jl.prototype,"tolerance",void 0),Fl([z("SSCS_DEBUG",void 0,!0),Oe("Debug only SSCS"),re()],jl.prototype,"onlySSCSDebug",void 0),Fl([z("SSCS_STEP_COUNT",void 0,!0),Ue("Step count",[1,8],1),re()],jl.prototype,"stepCount",void 0),jl=Nl=Fl([We("Screen Space Contact Shadows")],jl);class zl{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new n.xsS,this._mesh=new n.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new Gl}dispose(){var e;null===(e=this._mesh.geometry)||void 0===e||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach((e=>{var t;return null===(t=this._normalsCache[e])||void 0===t?void 0:t.dispose()}))}disposeAllTargets(){Object.values(this._normalsCache).forEach((e=>e.dispose())),this._normalsCache={}}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}_getPrecisionType(e){return"low"===e?n.ywz:"medium"===e?n.cLu:"high"===e?n.VzW:n.cLu}captureNormalMap(e,t,i=512,r="medium",s){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const o=null==t?void 0:t.split(";").find((e=>this._normalsCache[e]));if(o){const n=this._normalsCache[o];return null==t||t.split(";").forEach((e=>e!==o&&(this._normalsCache[e]=n))),n.width!==i&&console.warn("last cacheKey normalMapRes mismatch, check model",i),e.userData._normalsCaptureMap=n,!1}const a=this._renderer.createTargetCustom({width:i,height:i},{minFilter:n.TyD,magFilter:n.TyD,generateMipmaps:!1,type:this._getPrecisionType(r)},n.oAp);if(a.attachedGeometries=[],a.autoDispose=zl.AutoDisposeTargets,!a)throw"Unable to create render target";const l=()=>{var t;const i=new n._am(1e-4,100,a);this._scene.add(i);const r=e.userData.normalsCaptureOffsets;void 0!==r.center&&this._mesh.material.uniforms.offsetCenter.value.fromArray(r.center),void 0!==r.offsetMatrixInv&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(r.offsetMatrixInv),void 0!==r.radius&&(this._mesh.material.uniforms.radius.value=r.radius),this._mesh.geometry=e,(null==s?void 0:s.morphTargetInfluences)&&(null===(t=e.morphAttributes)||void 0===t?void 0:t.position)&&(this._mesh.morphTargetInfluences=s.morphTargetInfluences,this._mesh.morphTargetDictionary=s.morphTargetDictionary);const o=this._renderer.rendererObject.getClearColor(new n.Ilk),l=this._renderer.rendererObject.getClearAlpha();this._renderer.rendererObject.setClearColor(new n.Ilk(0,0,0),1),i.update(this._renderer.rendererObject,this._scene),this._renderer.rendererObject.setClearColor(o,l),this._mesh.morphTargetInfluences=void 0,this._mesh.morphTargetDictionary=void 0,this._scene.remove(i),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=a};return l(),this._renderer.addEventListener("contextRestored",l),a.attachedGeometries.push(e),e.addEventListener("dispose",(()=>{var t,n;a.attachedGeometries=null!==(n=null===(t=a.attachedGeometries)||void 0===t?void 0:t.filter((t=>t!==e)))&&void 0!==n?n:[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",l),a.autoDispose&&!a.attachedGeometries.length&&a.dispose()})),null==t||t.split(";").forEach((e=>this._normalsCache[e]=a)),a.addEventListener("dispose",(()=>{var e;null==t||t.split(";").forEach((e=>delete this._normalsCache[e])),this._renderer.removeEventListener("contextRestored",l),null===(e=a.attachedGeometries)||void 0===e||e.forEach((e=>delete e.userData._normalsCaptureMap))})),!0}}zl.AutoDisposeTargets=!0;class Gl extends n.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;\n#include <morphtarget_pars_vertex>\nvoid main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);\n#include <begin_vertex>\ntransformed-=offsetCenter;\n#include <morphtarget_vertex>\nvec4 offsetPos=offsetMatrixInv*vec4(transformed,1.);vecPosition=(modelMatrix*offsetPos).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetPos;}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:n.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:(new n.yGw).identity()},offsetCenter:{value:new n.Pa4}}})}}var Vl=__webpackgi_require__(654);function Hl(e){const t=new n.Pa4(0,0,0),i=new n.Pa4(0,0,0),r=new n.Pa4(0,0,0),s=new n.Pa4(0,0,0),o=e.getAttribute("position"),a=e.index;if(a)for(let n=Math.max(0,e.drawRange.start),p=Math.min(a.count,e.drawRange.start+e.drawRange.count)-1;n<p/3;n+=3){const e=a.getX(n),l=a.getX(n+1),c=a.getX(n+2);i.set(o.getX(e),o.getY(e),o.getZ(e)),r.set(o.getX(l),o.getY(l),o.getZ(l)),s.set(o.getX(c),o.getY(c),o.getZ(c)),r.sub(i),s.sub(i),s.cross(r),s.normalize(),t.add(s)}else for(let n=0;n<o.count;n+=3)i.set(o.getX(n),o.getY(n),o.getZ(n)),r.set(o.getX(n+1),o.getY(n+1),o.getZ(n+1)),s.set(o.getX(n+2),o.getY(n+2),o.getZ(n+2)),r.sub(i),s.sub(i),s.cross(r),s.normalize(),t.add(s);t.normalize();let l=!1,c=0;for(;!l;){const e=c/3,n=a?a.getX(e):e,s=a?a.getX(e+1):e+1;i.set(o.getX(n),o.getY(n),o.getZ(n)),r.set(o.getX(s),o.getY(s),o.getZ(s)),i.sub(r),i.normalize();const u=t.dot(i);Math.abs(u-1)>.001&&i.length()>.5&&(l=!0),c+=3}r.crossVectors(i,t),r.normalize(),i.crossVectors(t,r),i.normalize();const u=new n.yGw;u.elements[0]=i.x,u.elements[1]=i.y,u.elements[2]=i.z,u.elements[3]=0,u.elements[4]=t.x,u.elements[5]=t.y,u.elements[6]=t.z,u.elements[7]=0,u.elements[8]=r.x,u.elements[9]=r.y,u.elements[10]=r.z,u.elements[11]=0,u.elements[12]=0,u.elements[13]=0,u.elements[14]=0,u.elements[15]=1,e.computeBoundingSphere();const d=e.boundingSphere.radius,h=(new n.yGw).makeScale(d,d,d);return u.multiply(h),u}function Ql(e,t,i){const r=(new n.Pa4).copy(e),s=(new n.Pa4).copy(t),o=(new n.Pa4).copy(i);return r.dot(s.cross(o))/6}function Wl(e,t,i){const r=(new n.Pa4).copy(e),s=(new n.Pa4).copy(t),o=(new n.Pa4).copy(i);return s.sub(r),o.sub(r),o.cross(s),.5*o.length()}function ql(e){const t=e.getAttribute("position"),i=e.getAttribute("normal");if(t.count/3>1500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",t.count/3),Hl(e);const r=new n.Pa4(0,0,0),s=new n.Pa4(0,0,0),o=new n.Pa4(0,0,0),a=e.index,l=[];if(a)for(let n=Math.max(0,e.drawRange.start),v=Math.min(a.count,e.drawRange.start+e.drawRange.count)-1;n<v;n+=3){const e=a.getX(n),i=a.getX(n+1),c=a.getX(n+2);r.set(t.getX(e),t.getY(e),t.getZ(e)),s.set(t.getX(i),t.getY(i),t.getZ(i)),o.set(t.getX(c),t.getY(c),t.getZ(c)),l.push(r.toArray(),s.toArray(),o.toArray())}else for(let n=0;n<t.count;n++)r.set(t.getX(n),t.getY(n),t.getZ(n)),l.push(r.toArray());const c=function(e,t){const i=new n.Pa4;for(let n=0;n<e.length;n+=3)i.x+=e[n],i.y+=e[n+1],i.z+=e[n+2];i.multiplyScalar(1/(e.length/3));const r=new n.Pa4,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4,l=new n.Pa4;let c=0,u=0,d=t.length;d%3!=0&&(d-=d%3);for(let n=0;n<d;n+=3){r.set(t[n][0],t[n][1],t[n][2]),s.set(t[n+1][0],t[n+1][1],t[n+1][2]),o.set(t[n+2][0],t[n+2][1],t[n+2][2]),l.copy(r).add(s).add(o);const e=Wl(r,s,o);l.multiplyScalar(e/3),a.add(l),c+=e,u+=Ql(r,s,o)}return a.multiplyScalar(1/c),{centre:i,com:a,volume:u,area:c}}(t.array,l);if(c.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let e=0;e<i.count;e++)i.setX(e,-i.getX(e)),i.setY(e,-i.getY(e)),i.setZ(e,-i.getZ(e));i.needsUpdate=!0}const u=[];for(let n=0;n<t.array.length;n+=3)u.push([t.array[n],t.array[n+1],t.array[n+2]]);const d=console.log;console.log=()=>{};const h=(0,Vl.getEigenVectors)(u);console.log=d;const p=new n.yGw;p.elements[0]=h[0].vector[0],p.elements[1]=h[0].vector[1],p.elements[2]=h[0].vector[2],p.elements[3]=0,p.elements[4]=h[1].vector[0],p.elements[5]=h[1].vector[1],p.elements[6]=h[1].vector[2],p.elements[7]=0,p.elements[8]=h[2].vector[0],p.elements[9]=h[2].vector[1],p.elements[10]=h[2].vector[2],p.elements[11]=0,p.elements[12]=0,p.elements[13]=0,p.elements[14]=0,p.elements[15]=1;const f=new n.Pa4;f.copy(c.com).sub(c.centre),f.normalize();const m=new n.Pa4(h[2].vector[0],h[2].vector[1],h[2].vector[2]);f.dot(m)<0&&(p.elements[4]=-h[1].vector[0],p.elements[5]=-h[1].vector[1],p.elements[6]=-h[1].vector[2],p.elements[8]=-h[2].vector[0],p.elements[9]=-h[2].vector[1],p.elements[10]=-h[2].vector[2]),e.computeBoundingSphere();const g=e.boundingSphere.radius,_=(new n.yGw).makeScale(g,g,g);return p.multiply(_),p}const Xl={...Mt,color:new n.Ilk(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new n.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var Yl=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Kl extends n.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,i,r,s){var o,a;super.onBeforeRender(e,t,i,r,s),void 0===this.envMapIntensity||this.userData.separateEnvMapIntensity||void 0===t.envMapIntensity||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),void 0!==this.envMap&&void 0!==t.fixedEnvMapDirection&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):void 0!==this.defines.FIX_ENV_DIRECTION&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=((null===(o=this.envMap)||void 0===o?void 0:o.rotation)||0)+this.envMapRotationOffset,this.uniforms.envMapRotationQuat.value.setFromEuler(new n.USm(this.envMapRotationOffsetX,this.envMapRotationOffsetY,this.envMapRotationOffsetZ)),this.extraUniformsToUpload.inverseModelMatrix.value.copy(s.matrixWorld).invert();const l=r.userData.normalsCaptureOffsets;l&&(this.extraUniformsToUpload.centerOffset.value.fromArray(l.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(l.offsetMatrix).premultiply(s.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=l.radius);const c=null===(a=r.userData._normalsCaptureMap)||void 0===a?void 0:a.texture;this.normalsCaptureMap!==c&&(this.normalsCaptureMap=c),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}onAfterRender(e,t,n,i,r){super.onAfterRender(e,t,n,i,r),void 0!==this.userData.__envIntensity&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:r})}constructor(e){var t;super({side:n.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:"#ifndef USE_ENVMAP\n#define USE_ENVMAP  \n#endif\nvarying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;\n#ifdef USE_INSTANCING\nuniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;\n#endif\n#include <morphtarget_pars_vertex>\n#ifdef USE_MORPHTARGETS\nvarying vec3 vCenterOffset;\n#ifndef USE_INSTANCING\nuniform mat4 modelOffsetMatrixInv;\n#endif\n#endif\nvoid main(){\n#ifdef USE_INSTANCING\nvWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;\n#else\nvWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;\n#endif\n#include <beginnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#ifdef USE_MORPHTARGETS\nvCenterOffset=transformed;\n#include <morphtarget_vertex>\nvCenterOffset=transformed-vCenterOffset;\n#ifndef USE_INSTANCING\nvCenterOffset=(modelOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;\n#endif\n#endif\n#include <project_vertex>\nvViewPosition=-mvPosition.xyz;vUv=uv;\n#include <worldpos_vertex>\nvWorldPosition=worldPosition.xyz;\n#ifdef USE_INSTANCING\nvModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);\n#ifdef USE_MORPHTARGETS\nvCenterOffset=(vModelInstanceOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;\n#endif\n#endif\n}",fragmentShader:"varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;\n#ifdef USE_INSTANCING\nvarying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;\n#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix\n#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv\n#else\nuniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;\n#define MODEL_OFFSET_MATRIX  modelOffsetMatrix\n#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv\n#endif\n#ifdef USE_MORPHTARGETS\nvarying vec3 vCenterOffset;\n#define CENTER_OFFSET  (centerOffset + vCenterOffset)\n#else\n#define CENTER_OFFSET  (centerOffset) \n#endif\nuniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;\n#if ENV_MAP_TYPE == 0\nuniform samplerCube envMap;\n#elif ENV_MAP_TYPE == 1\nuniform sampler2D envMap;\n#endif\nuniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform vec4 envMapRotationQuat;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){\n#if !defined(USE_ENVMAP)\nreturn vec4(direction,1);\n#else\nfloat cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;vec3 t=2.*cross(envMapRotationQuat.xyz,direction);direction+=envMapRotationQuat.w*t+cross(envMapRotationQuat.xyz,t);\n#if ENV_MAP_TYPE == 0\nreturn(textureCube(envMap,direction));\n#elif ENV_MAP_TYPE == 1\nreturn(texture2D(envMap,cartesianToPolar(direction)));\n#endif\nreturn vec4(1,0,1,1);\n#endif\n}vec4 SampleSpecularReflection(vec3 direction){\n#if defined(FIX_ENV_DIRECTION)\ndirection=(viewMatrix*vec4(direction,0.)).xyz;\n#endif\nreturn envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){\n#if DIA_ORIENT_ENVMAP < 1\ndirection=mat3(MODEL_OFFSET_MATRIX)*direction;\n#endif\n#if defined(FIX_ENV_DIRECTION)\ndirection=(viewMatrix*vec4(direction,0.)).xyz;\n#endif\ndirection=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);\n#glMarker beforeAccumulation\ngl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));\n#include <encodings_fragment>\n}",uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},envMapRotationQuat:{value:new n._fP},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new n.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new n.Pa4(1,1,1)}}}),this.typeSlug=Kl.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new n.Ilk(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.envMapRotationOffsetX=0,this.envMapRotationOffsetY=0,this.envMapRotationOffsetZ=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new n.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:(new n.yGw).identity()},radius:{value:1},centerOffset:{value:new n.Pa4(0,0,0)},modelOffsetMatrix:{value:(new n.yGw).identity()},modelOffsetMatrixInv:{value:(new n.yGw).identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=e=>{console.warn("WebGi DiamondMaterial: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=at.RegisterExtensions(this,null!==(t=null==e?void 0:e.customMaterialExtensions)&&void 0!==t?t:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...at.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){at.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+at.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate",frameFade:null==e?void 0:e.last}),null===(n=null===(t=this._uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===n||n.call(t,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=(null===(e=this.uniforms.envMap.value)||void 0===e?void 0:e.isCubeTexture)?0:1,this.needsUpdate=!0}get envMap(){var e,t;return null!==(t=null!==(e=this.__envMap[this.envMapIndex])&&void 0!==e?e:this.__envMap[0])&&void 0!==t?t:null}set envMap(e){console.error("Setting separate envmap for individual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const t={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.envMapIndex=this.envMapIndex,t.envMapRotationOffset=this.envMapRotationOffset,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=Kl.TYPE,t.userData={},K(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map((e=>({label:"env"+(e+1),value:e})))},...He(this),{type:"input",label:"Mesh count",get value(){var t,n,i;return null!==(i=null===(n=null===(t=e.userData)||void 0===t?void 0:t.__appliedMeshes)||void 0===n?void 0:n.size)&&void 0!==i?i:0},set value(e){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(e){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>0===this.transmission,get value(){return!0===e.userData.renderToDepth},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{const n=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,t.downloadBlob)(n,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map((e=>{var t;return null===(t=e.getUiConfig)||void 0===t?void 0:t.call(e,this)}))].filter((e=>e)),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Kl.TYPE)return console.warn("WebGi DiamondMaterial: Material type is not supported",e),this;const n={},i=Array.from(Object.keys(Xl));(0,t.copyProps)(e,n,i);const r=n.userData;return delete n.userData,this.setValues(n),K(this.userData,r),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}Kl.TypeSlug="dmat",Kl.TYPE="DiamondMaterial",Yl([Ge("Color",{limitedUi:!0}),j()],Kl.prototype,"color",void 0),Yl([Ue("Env Intensity",[0,5],.01,{limitedUi:!0}),j()],Kl.prototype,"envMapIntensity",void 0),Yl([Ue("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,t.onChange2)(Kl.prototype.setDirty)],Kl.prototype,"envMapRotationOffset",void 0),Yl([Ue("Env Rotation Offset X",[-Math.PI,Math.PI],.01),(0,t.onChange2)(Kl.prototype.setDirty)],Kl.prototype,"envMapRotationOffsetX",void 0),Yl([Ue("Env Rotation Offset Y",[-Math.PI,Math.PI],.01),(0,t.onChange2)(Kl.prototype.setDirty)],Kl.prototype,"envMapRotationOffsetY",void 0),Yl([Ue("Env Rotation Offset Z",[-Math.PI,Math.PI],.01),(0,t.onChange2)(Kl.prototype.setDirty)],Kl.prototype,"envMapRotationOffsetZ",void 0),Yl([Ue("Dispersion",[0,.1],1e-4,{limitedUi:!0}),j({propKey:"rIndexDelta"})],Kl.prototype,"dispersion",void 0),Yl([Ue("Absorption",[0,15],.01,{limitedUi:!0}),j()],Kl.prototype,"absorptionFactor",void 0),Yl([Ue("Refractive Index",[0,4],.01,{limitedUi:!0}),j()],Kl.prototype,"refractiveIndex",void 0),Yl([j()],Kl.prototype,"squashFactor",void 0),Yl([j()],Kl.prototype,"geometryFactor",void 0),Yl([Ue("Gamma",[.1,4],.01,{limitedUi:!0}),j()],Kl.prototype,"gammaFactor",void 0),Yl([Ne("RGB Boost",void 0,void 0,{limitedUi:!0}),j()],Kl.prototype,"boostFactors",void 0),Yl([Ue("Transmission",[0,1],.01,{limitedUi:!0}),j()],Kl.prototype,"transmission",void 0),Yl([Ue("Reflectivity",[0,2],.01,{limitedUi:!0}),j()],Kl.prototype,"reflectivity",void 0),Yl([z("RAY_BOUNCES",void 0,!0),Ue("Ray Bounces",[1,16],1)],Kl.prototype,"rayBounces",void 0),Yl([z("DIA_ORIENT_ENVMAP",void 0,!0),Ue("Diamond Oriented Lighting",[0,1],1)],Kl.prototype,"diamondOrientedEnvMap",void 0),Yl([j({propKey:"tCubeMapNormals"})],Kl.prototype,"normalsCaptureMap",void 0),Yl([(0,t.onChange)(Kl.prototype.refreshEnvUniform)],Kl.prototype,"envMapIndex",void 0);const Jl={ES256:{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}},ES384:{name:"ECDSA",namedCurve:"P-384",hash:{name:"SHA-384"}},ES512:{name:"ECDSA",namedCurve:"P-521",hash:{name:"SHA-512"}},HS256:{name:"HMAC",hash:{name:"SHA-256"}},HS384:{name:"HMAC",hash:{name:"SHA-384"}},HS512:{name:"HMAC",hash:{name:"SHA-512"}},RS256:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},RS384:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},RS512:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}},Zl=function(e){return JSON.parse(atob(e.split(".")[1]))},$l=async function(e,t,n){const i=Jl[n.algorithm||"RS512"],r=await crypto.subtle.importKey("jwk",t,i,!0,["verify"]),s=e.split("."),o=new Uint8Array(atob(s[2].replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")).split("").map((e=>e.charCodeAt(0)))),a=new Uint8Array((s[0]+"."+s[1]).split("").map((e=>e.charCodeAt(0))));return await crypto.subtle.verify(i,r,o,a)};class ec{constructor(e,t){this.PRODUCT_ID="IJewel3D_WebGi_V0",this.KEY_TYPE_ID="online-v1",this.TOKEN_FILE="0.txt",this.PUBLIC_KEY_FILE="1.json",this.KEY_SERVER="https://license.ijewel3d.com",this.KEY_SERVER_VERIFY="/api/v1/verify",this.KEY_SERVER_CERTS="/api/v1/certs/"+this.KEY_TYPE_ID,this.id="",this.idHash="",this.appVersion="",this.appName="",this._storage={getItem:async e=>localStorage.getItem(e),setItem:async(e,t)=>(localStorage.setItem(e,t),t)},this.silent=!0,this.appVersion=t,this.appName=e}_getOriginId(){const e=function(e){let t,n,i,r;const s=function(e,t,n){if(e.length!=t)return!1;for(let i=0;i<t;i++)for(let t=0;t<n.length;t+=2)if(i==n[t]&&e.charCodeAt(i)!=n[t+1])return!1;return!0},o=function(e,t,n){return s(t,n,e)},a=function(e,t,n){return o(t,e,n)};for(let d in e)if(s(d,8,[7,116,5,101,3,117,0,100])){t=d;break}for(let d in e[t])if(a(d,[5,110,0,100],6)){n=d;break}for(let d in e[t])if(a(d,[7,110,0,108],8)){i=d;break}if(!("~">n))for(let d in e[t][i])if(o([7,101,0,104],d,8)){r=d;break}if(!t||!e[t])return;const l=e[t][n],c=!!e[t][i]&&e[t][i][r],u=l||c;return u||void 0}(window);if(!e)throw new Error("Failed to get origin");return e}_getStorage(){return this._storage}async init(){var e,t;if(this.id=this.id||this._getOriginId(),!this.id)throw new Error("Failed to get machine id");this.idHash=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(this.id);const n=this._getStorage(),i=this.idHash+this.TOKEN_FILE;let r=null!==(e=await n.getItem(i))&&void 0!==e?e:await n.setItem(i,"");const s=this.idHash+this.PUBLIC_KEY_FILE,o=null!==(t=await n.getItem(s))&&void 0!==t?t:null;let a=await this.getPublicKey().catch((()=>null));return!a&&o&&(a=JSON.parse(o)),a!==o&&await n.setItem(s,JSON.stringify(a)),a||this._throw(new Error("Failed to get public key")),{token:r,publicKey:a}}async verify(e,t){var n;try{let i,r=(t=null!=t?t:await this.init()).token;r&&!await $l(r,t.publicKey,{algorithm:"RS512",throwError:!1})&&(r=""),r&&(i=Zl(r),(null===(n=i.payload)||void 0===n?void 0:n.key)!==e&&(r="")),r&&r.length||(r=await this.setLicenseKey(e)),i=Zl(r);let s=!1;return s=s||await $l(r,t.publicKey,{algorithm:"RS512",throwError:!1}),s=s||await this.verifyData(i),s}catch(e){return this.silent||console.error(e),!1}}async writeToken(e){const t=this.idHash+this.TOKEN_FILE;await this._getStorage().setItem(t,e)}async verifyData(e){var t,n,i;return(null===(t=e.payload)||void 0===t?void 0:t.sub)===this.id&&(null===(n=e.payload)||void 0===n?void 0:n.app)===this.appName+"_"+this.appVersion&&(null===(i=e.payload)||void 0===i?void 0:i.pid)===this.PRODUCT_ID}async _getPublicKeyFromServer(){return fetch(this.KEY_SERVER+this.KEY_SERVER_CERTS).then((e=>e.json())).catch((e=>({error:e})))}async _validateKeyFromServer(e){return await fetch(this.KEY_SERVER+this.KEY_SERVER_VERIFY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,id:this.id,app:{name:this.appName,version:this.appVersion},pid:this.PRODUCT_ID})}).then((e=>e.json())).catch((e=>({error:e})))}_throw(e){if(!this.silent)throw e;return null}async setLicenseKey(e){const t=await this._validateKeyFromServer(e);if(t.error)return this._throw(t.error);const n=t.token;return n?(await this.writeToken(n),n):this._throw(new Error("Invalid license key, no token"))}async getPublicKey(){const e=await this._getPublicKeyFromServer();return e.error?this._throw(e.error):e.jwk||this._throw(new Error("Invalid public key"))}}var tc=__webpackgi_require__(701),nc=__webpackgi_require__.n(tc),ic=__webpackgi_require__(236),rc=__webpackgi_require__.n(ic),sc=__webpackgi_require__(850),oc=__webpackgi_require__.n(sc),ac=__webpackgi_require__(182),lc=__webpackgi_require__.n(ac),cc=__webpackgi_require__(213),uc=__webpackgi_require__.n(cc),dc=__webpackgi_require__(27),hc={};dc.Z&&dc.Z.locals&&(hc.locals=dc.Z.locals);var pc,fc=0,mc={};mc.styleTagTransform=uc(),mc.setAttributes=oc(),mc.insert=function(e,t){(t.target||document.head).appendChild(e)},mc.domAPI=rc(),mc.insertStyleElement=lc(),hc.use=function(e){return mc.options=e||{},fc++||(pc=nc()(dc.Z,mc)),hc},hc.unuse=function(){fc>0&&! --fc&&(pc(),pc=null)};var gc=hc,_c=__webpackgi_require__(356),vc={};_c.Z&&_c.Z.locals&&(vc.locals=_c.Z.locals);var yc,bc=0,Ac={};Ac.styleTagTransform=uc(),Ac.setAttributes=oc(),Ac.insert=function(e,t){(t.target||document.head).appendChild(e)},Ac.domAPI=rc(),Ac.insertStyleElement=lc(),vc.use=function(e){return Ac.options=e||{},bc++||(yc=nc()(_c.Z,Ac)),vc},vc.unuse=function(){bc>0&&! --bc&&(yc(),yc=null)};var wc=vc;class xc extends _t{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e,n){super(),this.container=n,this.enabled=!0,this.dependencies=[Ls],this.processState=new Map,this._mainDiv=(0,t.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,t.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var t,n,i,r,s,o,a,l,c,u,d,h,p;await super.onAdded(e),(null!==(t=this.container)&&void 0!==t?t:e.container).appendChild(this._mainDiv),this._updateMainDiv(this.processState),null===(i=null===(n=e.getManager())||void 0===n?void 0:n.importer)||void 0===i||i.addEventListener("importFile",(e=>{"done"!==e.state?this.processState.set(e.path,{state:e.state,progress:e.progress?100*e.progress:void 0}):this.processState.delete(e.path),this._updateMainDiv(this.processState)})),null===(s=null===(r=e.getManager())||void 0===r?void 0:r.importer)||void 0===s||s.addEventListener("processFileStart",(e=>{this.processState.set(e.path,{state:"processing",progress:void 0}),this._updateMainDiv(this.processState)})),null===(a=null===(o=e.getManager())||void 0===o?void 0:o.importer)||void 0===a||a.addEventListener("processFileEnd",(e=>{this.processState.delete(e.path),this._updateMainDiv(this.processState)})),null===(c=null===(l=e.getManager())||void 0===l?void 0:l.exporter)||void 0===c||c.addEventListener("exportFile",(e=>{"done"!==e.state?this.processState.set(e.obj.name,{state:e.state,progress:e.progress?100*e.progress:void 0}):this.processState.delete(e.obj.name),this._updateMainDiv(this.processState)})),null===(u=e.getPluginByType("FileTransferPlugin"))||void 0===u||u.addEventListener("transferFile",(e=>{"done"!==e.state?this.processState.set(e.path,{state:e.state,progress:e.progress?100*e.progress:void 0}):this.processState.delete(e.path),this._updateMainDiv(this.processState)})),null===(d=e.getPluginByType("MaterialConfiguratorPlugin"))||void 0===d||d.addEventListener("progress",(e=>{"done"!==e.state?this.processState.set("MatpreviewGeneration",{state:e.state,progress:0}):this.processState.delete("MatpreviewGeneration"),this._updateMainDiv(this.processState)})),null===(h=e.getPluginByType("SwitchNodePlugin"))||void 0===h||h.addEventListener("progress",(e=>{"done"!==e.state?this.processState.set("SwitchNodeGeneration",{state:e.state,progress:0}):this.processState.delete("SwitchNodeGeneration"),this._updateMainDiv(this.processState)})),null===(p=e.getPluginByType("ThemePlugin"))||void 0===p||p.addEventListener("progress",(e=>{"done"!==e.state?this.processState.set("ThemeInit",{state:e.state,progress:0}):this.processState.delete("ThemeInit"),this._updateMainDiv(this.processState)}))}async onRemove(e){var t;return this._mainDiv.remove(),null===(t=this._contentDiv)||void 0===t||t.remove(),this.processState.clear(),super.onRemove(e)}}!function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe("Enabled"),(0,t.onChange)(xc.prototype._onEnabledChange),re()],xc.prototype,"enabled",void 0);var Ec,Cc=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Sc=Ec=class extends xc{refresh(){this._updateMainDiv(this._isPreviewing?this._previewState:this.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}constructor(e){super("LoadingScreen",e),this.styles=gc,this.spinners=[{styles:wc,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage="https://static.webgi.xyz/logo.svg",this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["environment.hdr",{state:"adding"}]]),this.loadingElement=(0,t.createDiv)({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=(0,t.createDiv)({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=(0,t.createDiv)({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._temp=document.createElement("template"),this._sceneUpdate=e=>{if(!this._viewer)return;if(!e.hierarchyChanged)return;const n=this._viewer.scene.modelRoot.children;0===n.length&&this.showOnSceneEmpty&&this.show(),n.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment&&(0,t.timeout)(this.hideDelay+300).then((()=>this.minimize())):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await(0,t.timeout)(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await(0,t.timeout)(this.hideDelay),this._isHidden)return this.hide()}show(){this._isHidden&&(this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex")}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen"),this.showFileNames||(this.loadingElement.style.display="block")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen"),this.loadingElement.style.display=""}_setHTML(e,t){this._temp.innerHTML=t,this._temp.innerHTML.trim()==e.innerHTML.trim()||(e.innerHTML=t)}_updateMainDiv(e,t=!0){if(!this._viewer)return;if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");if(this.showFileNames){let t="";e.forEach(((e,n)=>{t+=(this.showProcessStates?`<span class="loadingScreenProcessState">${e.state}</span>: `:"")+(n||"").split("/").pop()+(this.showProgress&&e.progress?" - "+e.progress.toFixed(0)+"%":"")+"<br>"})),this._setHTML(this.filesElement,t)}else this._setHTML(this.filesElement,"");const n=[...e.values()].filter((e=>"error"===e.state));n.length>0&&n.length===e.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImage" src="${this.logoImage}"/>`:""),t&&(this.hideOnFilesLoad&&(0===e.size||n.length===e.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():e.size>0&&this.showOnFilesLoading&&this.show())}async onAdded(e){var t;this.styles.use({target:null!==(t=this.container)&&void 0!==t?t:e.container}),this.spinners.forEach((t=>{var n;t.styles.use({target:null!==(n=this.container)&&void 0!==n?n:e.container})})),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),await super.onAdded(e)}async onRemove(e){e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),await super.onRemove(e)}};Sc.PluginType="LoadingScreenPlugin",Cc([Fe("Loader",["Spinner 1"].map(((e,t)=>({value:t,label:e})))),re()],Sc.prototype,"loader",void 0),Cc([ze("Loading text header"),(0,t.onChange)(Ec.prototype.refresh),re()],Sc.prototype,"loadingTextHeader",void 0),Cc([ze("Error text header"),re()],Sc.prototype,"errorTextHeader",void 0),Cc([Oe("Show file names"),re(),(0,t.onChange)(Ec.prototype.refresh)],Sc.prototype,"showFileNames",void 0),Cc([Oe("Show process states"),re(),(0,t.onChange)(Ec.prototype.refresh)],Sc.prototype,"showProcessStates",void 0),Cc([Oe("Show progress"),re(),(0,t.onChange)(Ec.prototype.refresh)],Sc.prototype,"showProgress",void 0),Cc([Oe("Hide on only errors"),re()],Sc.prototype,"hideOnOnlyErrors",void 0),Cc([Oe("Hide on files load"),re()],Sc.prototype,"hideOnFilesLoad",void 0),Cc([Oe("Hide on scene object load"),re()],Sc.prototype,"hideOnSceneObjectLoad",void 0),Cc([Oe("Minimize on scene object load"),re()],Sc.prototype,"minimizeOnSceneObjectLoad",void 0),Cc([Oe("Show when files start loading"),re()],Sc.prototype,"showOnFilesLoading",void 0),Cc([Oe("Show when scene empty"),re()],Sc.prototype,"showOnSceneEmpty",void 0),Cc([ze("Hide delay (ms)"),re()],Sc.prototype,"hideDelay",void 0),Cc([Ue("Background Opacity",[0,1]),(0,t.onChange)(Ec.prototype.refresh),re()],Sc.prototype,"backgroundOpacity",void 0),Cc([Ue("Background Blur",[0,100]),(0,t.onChange)(Ec.prototype.refresh),re()],Sc.prototype,"backgroundBlur",void 0),Cc([ze("Background Color"),(0,t.onChange)(Ec.prototype.refresh),re()],Sc.prototype,"background",void 0),Cc([ze("Text Color"),(0,t.onChange)(Ec.prototype.refresh),re()],Sc.prototype,"textColor",void 0),Cc([ze("Logo Image"),(0,t.onChange)(Ec.prototype.refresh),re()],Sc.prototype,"logoImage",void 0),Cc([je("Toggle preview")],Sc.prototype,"togglePreview",null),Cc([je("Minimize")],Sc.prototype,"minimize",null),Cc([je("Maximize")],Sc.prototype,"maximize",null),Sc=Ec=Cc([We("Loading Screen")],Sc);const Mc="iJewel3dSDK_WebGi",Tc=zs.VERSION,Ic="https://playground.ijewel3d.com/logo_black.svg",Pc=e=>setTimeout((()=>console.error(new Error(e))),612);class Rc extends _t{setKey(e){this._checking||this._checkPromise?console.warn("Already checking key, ignored"):(this._checking=Date.now(),this._checkPromise=this._check(e),this._checkPromise.then((()=>this._checkPromise=void 0)))}async _check(e){const t=new ec(Mc,Tc);await t.verify(e)||(Pc(this._errMessage),this._logoContainer=this._createContainerLogo())}_createContainerLogo(){const e=document.createElement("div");e.innerHTML=Dc,e.style.position="absolute",e.style.padding="1rem",e.style.left="0",e.style.bottom="0",e.style.width="100%",e.style.height="auto",e.style.display="flex",e.style.alignItems="center",e.style.backgroundColor="rgba(0, 0, 0, 0)",e.style.zIndex="9999",e.style.pointerEvents="none";const t=e.children[0];t.style.width="calc(min(20%, 150px))",t.style.height="auto",t.onclick=()=>{window.open("https://ijewel3d.com/","_top")},this._logoContainer=e;const n=document.getElementById("webgi-logo");return n&&n.remove(),e}constructor(){super(),this._errMessage=`iJewel3D ${Mc} ${Tc}. FOR EVALUATION PURPOSES ONLY. For more information visit: https://ijewel3d.com/`,this._checking=0,this._licenseInUse=!1,setInterval((()=>{var e;if(this._checkPromise){const e=15e3;Date.now()-this._checking>e&&(Pc(this._errMessage),this._logoContainer=this._createContainerLogo(),"function"==typeof this._checkPromise.cancel&&this._checkPromise.cancel(),this._checkPromise=void 0)}if(this._logoContainer&&!this._logoContainer.parentElement&&this._viewer&&this._licenseInUse){this._lContainer.appendChild(this._logoContainer);const t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Sc);t&&(t.logoImage=Ic)}}),5e3)}get _lContainer(){var e;const t=null===(e=this._viewer)||void 0===e?void 0:e.container;if(!t)return document.body;const n=window.getComputedStyle(t).position;return"absolute"!==n&&"relative"!==n&&"fixed"!==n?document.body:t}use(){var e;if(!this._licenseInUse&&(this._licenseInUse=!0,!this._checking)){Pc(this._errMessage),this._logoContainer=this._createContainerLogo(),this._lContainer.appendChild(this._logoContainer);const t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Sc);t&&(t.logoImage=Ic)}}unuse(){}async onAdded(e){await super.onAdded(e)}}const Dc='\n\x3c!--Notice - iJewel3D License Required to remove attribution. Check the details at https://developer.ijewel3d.com/ --\x3e\n<svg width="320" height="150" viewBox="0 0 320 150" fill="none" xmlns="http://www.w3.org/2000/svg">\n<g filter="url(#filter0_d_2013_189)">\n<path d="M63.0313 37.6615C63.0313 37.0497 62.8369 36.5115 62.4485 36.0465C62.0601 35.5815 61.5625 35.2879 60.9555 35.1411L71.2491 30.8711V79.1495C71.2491 82.3555 70.4357 85.2195 68.7971 87.7275C67.1705 90.2355 64.7063 91.5315 61.4047 91.6175C57.6903 91.3975 55.0441 89.5015 53.4295 85.9275C52.7983 84.4475 52.4707 82.9315 52.4707 81.3655H53.2961C53.2961 82.8455 53.5873 84.2395 54.1701 85.5495C54.8013 86.6875 55.7967 87.4335 57.1319 87.7635C58.4793 88.0935 59.6809 87.9715 60.7613 87.3835C61.5139 86.9075 62.0359 86.1115 62.3635 84.9995C62.6791 83.8855 62.8735 82.7715 62.9219 81.6455C62.9827 80.5335 63.0069 79.7375 63.0069 79.2595L63.0313 37.6615Z" fill="white"/>\n<path d="M49.4 38.5287C49.4 37.9169 49.2056 37.3785 48.8172 36.9137C48.4288 36.4487 47.9312 36.1551 47.3242 36.0083L57.6178 31.7383V65.5675L49.4 69.8375V38.5287Z" fill="white"/>\n<path d="M106.949 51.1695H82.6592C82.5742 54.4355 83.3026 57.6775 84.8442 60.8955C86.3736 64.1135 88.9228 66.1455 92.4672 66.9895C96.8372 67.5515 100.77 66.4635 104.254 63.7215C104.861 63.1595 105.419 62.5475 105.917 61.8755C105.977 61.7895 106.05 61.7395 106.172 61.7035C106.281 61.6795 106.39 61.7035 106.499 61.7895C106.584 61.8495 106.633 61.9235 106.669 62.0335C106.694 62.1435 106.669 62.2535 106.584 62.3635C106.062 63.0375 105.492 63.6735 104.885 64.2855C101.595 67.9675 97.4562 70.1695 92.4794 70.8915C86.8834 71.0875 82.5014 69.1175 79.2968 64.9695C76.1044 60.8355 74.3928 56.2455 74.1744 51.2295C74.0044 47.2171 74.8178 43.4487 76.6264 39.9495C78.4228 36.4503 81.239 33.9055 85.0506 32.3149C88.1824 31.1403 91.3748 30.7977 94.64 31.2627C99.2284 32.2415 102.567 34.8231 104.642 39.0075C106.257 42.5923 107.034 46.3117 106.949 50.2147V51.1695ZM82.6592 50.3369H98.3544C98.3788 50.2759 98.3908 50.2391 98.3908 50.2147C99.6896 46.7521 100.382 43.3875 100.467 40.0841C100.333 36.0711 98.318 33.4405 94.4458 32.2171C89.8818 31.3239 86.495 32.9267 84.2736 37.0253C82.9748 40.6225 82.4286 44.3663 82.6592 48.2449V50.3369Z" fill="white"/>\n<path d="M168.843 32.9737C169.013 32.4965 168.965 32.0561 168.721 31.6523C168.467 31.2485 168.091 31.0283 167.557 31.0039H172.581C171.223 31.1139 170.275 31.7991 169.717 33.0593L155.429 70.4619L155.637 71.0119H146.799L138.411 48.9647L130.193 70.4619L130.401 71.0119H121.564L107.155 33.1817C106.597 31.8969 105.638 31.1751 104.254 31.0039H117.206C116.708 31.0649 116.332 31.2853 116.065 31.6889C115.798 32.0927 115.749 32.5455 115.919 33.0471L129.781 69.2879L137.963 47.8269L132.403 33.1817C131.845 31.8969 130.885 31.1751 129.501 31.0039H142.417C142.029 31.0649 141.713 31.2363 141.459 31.5299C141.203 31.8235 141.083 32.1539 141.083 32.5087C141.083 32.8635 141.107 32.8513 141.167 33.0471L142.417 36.2281L142.829 37.4027L155.029 69.2879L168.843 32.9737Z" fill="white"/>\n<path d="M202.55 51.1695H178.262C178.176 54.4355 178.904 57.6775 180.434 60.8955C181.976 64.1135 184.512 66.1455 188.058 66.9895C192.428 67.5515 196.36 66.4635 199.844 63.7215C200.45 63.1595 201.01 62.5475 201.506 61.8755C201.556 61.7895 201.64 61.7395 201.762 61.7035C201.872 61.6795 201.98 61.7035 202.09 61.7895C202.174 61.8495 202.224 61.9235 202.26 62.0335C202.284 62.1435 202.26 62.2535 202.174 62.3635C201.652 63.0375 201.082 63.6735 200.476 64.2855C197.186 67.9675 193.046 70.1695 188.07 70.8915C182.474 71.0875 178.092 69.1175 174.888 64.9695C171.694 60.8355 169.984 56.2455 169.764 51.2295C169.594 47.2171 170.42 43.4487 172.216 39.9495C174.014 36.4503 176.83 33.9055 180.64 32.3149C183.772 31.1403 186.964 30.7977 190.23 31.2627C194.818 32.2415 198.156 34.8231 200.232 39.0075C201.858 42.5923 202.636 46.3117 202.55 50.2147V51.1695ZM178.262 50.3369H193.956C193.982 50.2759 193.994 50.2391 193.994 50.2147C195.292 46.7521 195.984 43.3875 196.068 40.0841C195.936 36.0711 193.92 33.4405 190.048 32.2171C185.484 31.3239 182.086 32.9267 179.876 37.0253C178.578 40.6225 178.03 44.3663 178.262 48.2449V50.3369Z" fill="white"/>\n<path d="M214.3 68.798C214.3 69.386 214.494 69.886 214.884 70.302C215.272 70.718 215.758 70.964 216.34 71.012H204.006C204.59 70.952 205.076 70.73 205.464 70.328C205.852 69.924 206.046 69.434 206.046 68.846V17.4478C206.046 16.8606 205.852 16.3588 205.464 15.9184C205.076 15.4902 204.59 15.2332 204.006 15.1476L214.3 11V68.798Z" fill="white"/>\n<path d="M60.2022 15.5255L57.1676 13.2007C57.1554 13.1885 57.1432 13.1885 57.1312 13.1763C57.119 13.1641 57.0946 13.1641 57.0826 13.1641H49.1196C49.0954 13.1641 49.0832 13.1641 49.071 13.1763C49.059 13.1885 49.0468 13.1885 49.0346 13.2007L46 15.5255H60.2022Z" fill="white"/>\n<path d="M46.0977 16.0044L52.9925 22.1586H53.0047C53.0167 22.1708 53.0289 22.1708 53.0411 22.183C53.0531 22.183 53.0775 22.1952 53.0897 22.1952C53.1017 22.1952 53.1261 22.1954 53.1381 22.183C53.1503 22.183 53.1625 22.1708 53.1745 22.1586H53.1867L60.0815 15.9922H46.0977V16.0044Z" fill="white"/>\n<path d="M237.681 55.6091C237.293 55.6091 237.183 55.4611 237.183 55.1691C237.183 54.7531 237.377 54.4211 237.681 54.4211C237.985 54.4211 238.785 54.6431 239.817 54.6431C241.613 54.6431 242.937 53.2111 242.937 50.8739C242.937 48.5369 242.719 48.3901 240.947 48.3901C239.173 48.3901 238.785 49.4791 238.215 50.9227C238.021 51.3631 237.827 51.4971 237.523 51.4971C237.219 51.4971 236.589 51.1551 236.589 50.5067C236.589 49.2465 238.457 47.7539 241.019 47.7539C243.581 47.7539 245.267 48.5003 245.267 51.1311C245.267 53.7611 242.937 54.7531 241.213 54.8991V54.9971C242.719 55.2671 244.479 56.3311 244.479 58.4711C244.479 62.0191 241.601 63.4511 238.627 63.4511C235.653 63.4511 234.027 61.7391 234.027 60.6251C234.027 59.5111 234.621 59.3651 235.157 59.3651C235.691 59.3651 235.679 59.6091 235.799 60.0631C236.297 61.8971 237.099 62.8151 238.725 62.8151C240.351 62.8151 242.027 61.5791 242.027 58.1771C242.027 54.7771 241.553 55.4011 239.611 55.4011C238.689 55.4011 237.997 55.6091 237.681 55.6091Z" fill="white"/>\n<path d="M259.105 45.918L259.203 45.9914L255.513 61.1146C255.317 61.8366 255.293 62.3746 255.707 62.3746C256.325 62.3746 257.333 60.7586 257.745 59.9386L258.219 60.2826C257.455 62.0186 256.229 63.5006 254.601 63.5006C252.975 63.5006 253.255 62.5086 253.667 60.8946C253.885 60.0986 254.105 59.2786 254.287 58.4706H254.237C252.915 60.9066 250.997 63.5006 248.387 63.5006C245.777 63.5006 246.201 61.9826 246.201 60.4786C246.201 57.7246 248.521 51.7786 253.825 51.7786C259.129 51.7786 255.305 52.0226 255.695 52.2686L256.727 47.9002C256.895 47.1782 256.871 47.0314 256.313 46.9826L254.991 46.8356L255.087 46.4198L259.105 45.918ZM249.491 62.3506C251.603 62.3506 254.261 57.7866 254.979 55.0086C255.123 54.3606 255.391 53.5166 255.525 52.9286C255.257 52.7566 254.663 52.5126 253.971 52.5126C250.377 52.5126 248.387 58.2146 248.387 60.6726C248.387 61.8106 248.775 62.3366 249.491 62.3506Z" fill="white"/>\n<path d="M257.663 71.0129H235.571C226.649 71.0129 219.389 63.6969 219.389 54.7029C219.389 45.7109 226.649 38.3945 235.571 38.3945H257.663C266.585 38.3945 273.843 45.7109 273.843 54.7029C273.843 63.6969 266.585 71.0129 257.663 71.0129ZM235.571 39.3855C227.183 39.3855 220.361 46.2615 220.361 54.7149C220.361 63.1709 227.183 70.0469 235.571 70.0469H257.663C266.051 70.0469 272.871 63.1709 272.871 54.7149C272.871 46.2615 266.051 39.3855 257.663 39.3855H235.571Z" fill="white"/>\n</g>\n<g filter="url(#filter1_d_2013_189)">\n<path d="M17.656 134.564H15.892C13.54 131.344 12 126.584 12 121.768C12 117.148 13.484 112.332 15.892 109H17.656C15.5 112.024 13.988 116.728 13.988 121.768C13.988 126.696 15.444 131.484 17.656 134.564Z" fill="white"/>\n<path d="M32.1018 130.169H20.0898V110.121H32.0738V111.969H22.1059V119.193H31.1498V121.013H22.1059V128.321H32.1018V130.169Z" fill="white"/>\n<path d="M41.7111 130.169L34.0391 110.121H36.1951L41.5431 124.065C41.9631 125.157 42.3551 126.249 42.8031 127.649C43.2231 126.193 43.7271 124.793 44.0351 124.037L49.3551 110.121H51.4271L43.8111 130.169H41.7111Z" fill="white"/>\n<path d="M51.5889 130.169H49.5449L56.9089 110.121H59.4009L66.8489 130.169H64.7489L62.7889 124.849H53.5489L51.5889 130.169ZM57.8889 112.949L54.1649 123.085H62.1449L58.3929 112.949C58.3089 112.669 58.1689 112.333 58.1409 112.137C58.1129 112.305 58.0009 112.669 57.8889 112.949Z" fill="white"/>\n<path d="M71.6527 110.121V128.321H80.8647V130.169H69.6367V110.121H71.6527Z" fill="white"/>\n<path d="M82.8945 123.197V110.121H84.9105V123.113C84.9105 126.641 86.8425 128.545 90.3425 128.545C93.7585 128.545 95.6905 126.585 95.6905 123.113V110.121H97.7065V123.197C97.7065 127.733 94.9065 130.505 90.3425 130.505C85.6945 130.505 82.8945 127.761 82.8945 123.197Z" fill="white"/>\n<path d="M101.601 130.169H99.5566L106.921 110.121H109.413L116.861 130.169H114.761L112.801 124.849H103.561L101.601 130.169ZM107.901 112.949L104.177 123.085H112.157L108.405 112.949C108.321 112.669 108.181 112.333 108.153 112.137C108.125 112.305 108.013 112.669 107.901 112.949Z" fill="white"/>\n<path d="M115.715 111.969V110.121H130.079V111.969H123.891V130.169H121.875V111.969H115.715Z" fill="white"/>\n<path d="M134.872 110.121V130.169H132.855V110.121H134.872Z" fill="white"/>\n<path d="M157.609 120.146C157.609 126.222 153.662 130.506 148.062 130.506C142.434 130.506 138.514 126.222 138.514 120.146C138.514 114.07 142.462 109.758 148.062 109.758C153.69 109.758 157.609 114.042 157.609 120.146ZM155.537 120.146C155.537 115.134 152.486 111.718 148.062 111.718C143.638 111.718 140.614 115.134 140.614 120.146C140.614 125.158 143.638 128.574 148.062 128.574C152.486 128.574 155.537 125.13 155.537 120.146Z" fill="white"/>\n<path d="M163.28 130.169H161.264V110.121H163.308L174.34 126.809V110.121H176.328V130.169H174.34L163.28 113.481V130.169Z" fill="white"/>\n<path d="M194.508 130.169L186.836 110.121H188.992L194.34 124.065C194.76 125.157 195.152 126.249 195.6 127.649C196.02 126.193 196.524 124.793 196.832 124.037L202.152 110.121H204.224L196.608 130.169H194.508Z" fill="white"/>\n<path d="M218.94 130.169H206.928V110.121H218.912V111.969H208.944V119.193H217.988V121.013H208.944V128.321H218.94V130.169Z" fill="white"/>\n<path d="M225.051 130.169H223.035V110.121H230.511C234.571 110.121 237.035 112.361 237.035 115.917C237.035 118.801 235.523 120.817 232.947 121.517L237.231 130.169H234.991L230.903 121.853H225.051V130.169ZM225.051 111.941V120.033H230.567C233.339 120.033 234.963 118.521 234.963 115.973C234.963 113.369 233.255 111.941 230.511 111.941H225.051Z" fill="white"/>\n<path d="M239.74 115.33C239.74 111.97 242.428 109.758 246.46 109.758C250.072 109.758 252.452 111.774 252.76 115.134H250.716C250.492 112.866 248.952 111.578 246.432 111.578C243.604 111.578 241.756 113.034 241.756 115.302C241.756 117.066 242.792 118.186 244.892 118.718L248.336 119.558C251.472 120.314 253.096 122.106 253.096 124.822C253.096 128.294 250.408 130.506 246.264 130.506C242.372 130.506 239.74 128.462 239.488 125.186H241.56C241.672 127.286 243.52 128.658 246.264 128.658C249.204 128.658 251.08 127.23 251.08 124.934C251.08 123.142 250.072 121.966 247.916 121.462L244.528 120.622C241.392 119.866 239.74 118.074 239.74 115.33Z" fill="white"/>\n<path d="M258.739 110.121V130.169H256.723V110.121H258.739Z" fill="white"/>\n<path d="M281.477 120.146C281.477 126.222 277.529 130.506 271.929 130.506C266.301 130.506 262.381 126.222 262.381 120.146C262.381 114.07 266.329 109.758 271.929 109.758C277.557 109.758 281.477 114.042 281.477 120.146ZM279.405 120.146C279.405 115.134 276.353 111.718 271.929 111.718C267.505 111.718 264.481 115.134 264.481 120.146C264.481 125.158 267.505 128.574 271.929 128.574C276.353 128.574 279.405 125.13 279.405 120.146Z" fill="white"/>\n<path d="M287.149 130.169H285.133V110.121H287.177L298.209 126.809V110.121H300.197V130.169H298.209L287.149 113.481V130.169Z" fill="white"/>\n<path d="M304.42 134.564H302.656C304.868 131.484 306.352 126.696 306.352 121.768C306.352 116.728 304.812 112.024 302.656 109H304.42C306.856 112.332 308.312 117.148 308.312 121.768C308.312 126.584 306.772 131.344 304.42 134.564Z" fill="white"/>\n</g>\n<defs>\n<filter id="filter0_d_2013_189" x="35" y="4" width="249.842" height="102.617" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dy="4"/>\n<feGaussianBlur stdDeviation="5.5"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0.45 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_2013_189"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_2013_189" result="shape"/>\n</filter>\n<filter id="filter1_d_2013_189" x="1" y="102" width="318.312" height="47.5625" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dy="4"/>\n<feGaussianBlur stdDeviation="5.5"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0.45 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_2013_189"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_2013_189" result="shape"/>\n</filter>\n</defs>\n</svg>\n';var kc=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Bc extends Rc{get envMapRotation(){var e,t;return null!==(t=null===(e=this.envMap)||void 0===e?void 0:e.rotation)&&void 0!==t?t:0}set envMapRotation(e){var t;const n=[this.envMap,this.envMap2,this.envMap3];for(const i of n)i&&(i.rotation=e,null===(t=this._viewer)||void 0===t||t.scene.setDirty())}refreshEnvMaps(){var e,t,n;if(!this._viewer)return;const i=this.getEnvMaps(),r=(null===(t=null===(e=this._viewer.getPlugin(Ls))||void 0===e?void 0:e.materials)||void 0===t?void 0:t.getMaterialsOfType(Kl.TypeSlug))||[];for(const s of r)s&&(s.envMaps=i);null===(n=this._viewer)||void 0===n||n.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var e;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const t=(null===(e=this._viewer)||void 0===e?void 0:e.scene.environment)||null;return[t,t,t]},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse((e=>{var t,i,r,s;const o=null===(i=null===(t=e.userData)||void 0===t?void 0:t.gltfExtensions)||void 0===i?void 0:i[Bc.DIAMOND_GLTF_EXTENSION];o&&e.geometry&&(this.prepareDiamondMesh(e,o),delete e.userData.gltfExtensions[Bc.DIAMOND_GLTF_EXTENSION]),e.material&&!n.includes(e.material)&&(null===(s=null===(r=e.material.userData)||void 0===r?void 0:r.gltfExtensions)||void 0===s?void 0:s[Bc.DIAMOND_GLTF_EXTENSION])&&(e.material.materialObject||console.warn("WebGi DiamondPlugin: material not processed",e.material),n.push(e.material))})),n.forEach((e=>{const t=e.userData.gltfExtensions[Bc.DIAMOND_GLTF_EXTENSION];t&&this._convertToDiamondMaterial(e,t)})),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var e,t,n;const i=null===(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject())||void 0===n?void 0:n.material;return!!Array.isArray(i)||(null==i?void 0:i.typeSlug)!==Pt.TypeSlug},value:async()=>{var e,t,n,i,r,s;const o=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();if(!(null==o?void 0:o.material))return;const a=await(null===(n=this._viewer)||void 0===n?void 0:n.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1)),l=(await(null===(i=this._viewer)||void 0===i?void 0:i.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512").toLowerCase(),c=l.endsWith("high")?"high":l.endsWith("low")?"low":"medium";let u=parseInt(l);isFinite(u)||(u=512),u<64&&(u=64),(null===(r=o.material.userData)||void 0===r?void 0:r.__appliedMeshes.size)>1&&await(null===(s=this._viewer)||void 0===s?void 0:s.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(o.material,{cacheKey:a||void 0,normalMapRes:u,normalMapPrecision:c},{}):this.makeDiamondMesh(o,{cacheKey:a||void 0,normalMapRes:u,normalMapPrecision:c},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,t,n;const i=null===(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject())||void 0===n?void 0:n.material;return!!Array.isArray(i)||(null==i?void 0:i.typeSlug)!==Kl.TypeSlug},value:async()=>{var e,t,n,i,r,s,o,a;const l=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject(),c=null==l?void 0:l.material;if(!c)return;const u=c.userData._baseMaterial;let d=null===(r=null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getManager())||void 0===i?void 0:i.materials)||void 0===r?void 0:r.findMaterial(u);if(d&&!d.isDiamondMaterial||(d=null===(s=this._viewer)||void 0===s?void 0:s.createPhysicalMaterial({color:c.color})),d){const e=c.userData.__appliedMeshes.size>1&&await(null===(o=this._viewer)||void 0===o?void 0:o.confirm("Convert all with this material?"))?Array.from(c.userData.__appliedMeshes):[l];for(const t of e)null===(a=null==t?void 0:t.setMaterial)||void 0===a||a.call(t,d)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var e,t,n,i;const r=null===(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject())||void 0===n?void 0:n.material;return!!Array.isArray(r)||(null==r?void 0:r.typeSlug)!==Kl.TypeSlug||(null===(i=r.userData.__appliedMeshes)||void 0===i?void 0:i.size)<2},value:async()=>{var e,t;const n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();if(!n)return;const i=n.material;i&&!Array.isArray(i)&&ge(i)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,t,n;null===(e=this._viewer)||void 0===e||e.setDirty(),null===(n=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===n||n.call(t,"postFrame",!0)}async onAdded(e){var t,i,r,s,o,a,l;this._normalCapture=new zl(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",(e=>{var t,n,i,r,s;if(null===(t=e.material)||void 0===t?void 0:t.isDiamondMaterial){const t=e.material,o=e.mesh||e.object;if(o.geometry&&!(null===(n=this._normalCapture)||void 0===n?void 0:n.hasCapturedNormalMap(o))){const e=null!==(s=null===(r=null===(i=null==t?void 0:t.userData)||void 0===i?void 0:i.gltfExtensions)||void 0===r?void 0:r[Bc.DIAMOND_GLTF_EXTENSION])&&void 0!==s?s:{};void 0===e.cacheKey&&!o.userData._diamondCacheKey&&(null==t?void 0:t.name)&&(e.cacheKey=t.name),this.prepareDiamondMesh(o,e)}const a=this.getEnvMaps();t.envMaps=a}})),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const c=e.getPlugin(Ls);null===(t=null==c?void 0:c.importer)||void 0===t||t.processors.add("model",this._modelProcessor),null===(i=e.getPlugin(za))||void 0===i||i.addEventListener("selectedObjectChanged",this.refreshUi);const u=this.getEnvMaps,d=new Nt(class extends Gt{async loadAsync(e,t){var n;const i=await super.loadAsync(e,t);return i.type===Kl.TYPE||i.isDiamondMaterialParameters?(i.envMap=u(),null===(n=null==c?void 0:c.materials)||void 0===n?void 0:n.generateFromTemplate("diamond",i)):(console.error("Invalid material type for Diamond Material.",i),null)}},[Kl.TypeSlug],!1);return null===(r=null==c?void 0:c.importer)||void 0===r||r.Importers.push(d),null===(a=null===(o=null===(s=null==c?void 0:c.exporter)||void 0===s?void 0:s.getExporter("gltf","glb"))||void 0===o?void 0:o.extensions)||void 0===a||a.push(Oc),null===(l=null==c?void 0:c.materials)||void 0===l||l.registerMaterialTemplate({name:"diamond",materialType:Kl.TYPE,isDiamondMaterialParameters:!0,generator:(e,t)=>{const i=!((null==t?void 0:t.metadata)||!t.isDiamondMaterialParameters)||(null==t?void 0:t.metadata)&&(null==t?void 0:t.metadata.version)<=4.5,r=null==t?void 0:t.color;i&&"number"==typeof t.color&&(t.color=(new n.Ilk).setHex(t.color,n.GUF).getHex());const s=new Kl(e);return s.envMaps=this.getEnvMaps(),t&&s.copyProps(t),t.color=r,s}}),super.onAdded(e)}async onRemove(e){var t,n,i,r;return null===(t=this._normalCapture)||void 0===t||t.dispose(),this._normalCapture=void 0,this.offsetCache={},null===(i=null===(n=e.getPlugin(Ls))||void 0===n?void 0:n.importer)||void 0===i||i.processors.remove("model",this._modelProcessor),null===(r=e.getPlugin(za))||void 0===r||r.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n,normalMapPrecision:i}){var r,s,o;this.use(),e.userData._diamondCacheKey=null!=t?t:e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=null!=n?n:e.userData._diamondNormalMapRes,e.userData._diamondNormalMapPrecision=null!=i?i:e.userData._diamondNormalMapPrecision,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const a=null!==(s=null===(r=this._normalCapture)||void 0===r?void 0:r.captureNormalMap(e.geometry,t,n,i,e))&&void 0!==s?s:[void 0,!1],l=null===(o=this._viewer)||void 0===o?void 0:o.getPluginByType("debug");l&&a&&(l.counters.normalsCapture||(l.counters.normalsCapture=0),l.counters.normalsCapture++,console.log("DEBUG: new normal map captured",l.counters.normalsCapture,t),l.addTexture("normal"+l.counters.normalsCapture,(()=>{var t,n;return null===(n=null===(t=e.geometry)||void 0===t?void 0:t.userData._normalsCaptureMap)||void 0===n?void 0:n.texture}),[40,110*l.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){var i,r;Array.from(null!==(i=null==e?void 0:e.userData.__appliedMeshes)&&void 0!==i?i:[]).forEach((e=>{(null==e?void 0:e.isMesh)&&e.geometry&&this.prepareDiamondMesh(e,t)})),this._convertToDiamondMaterial(e,n),null===(r=this._viewer)||void 0===r||r.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const i=Array.isArray(e.material)?e.material[0]:e.material,r=this._convertToDiamondMaterial(i,n,!1);e.setMaterial(r)}_convertToDiamondMaterial(e,t={isDiamond:!0},i=!0){var r,s,o,a,l,c,u,d;let h={...null!=t?t:{}};h.isDiamond||h.isDiamondMaterialParameters?Array.isArray(h.boostFactors)&&(h.boostFactors=(new n.Pa4).fromArray(h.boostFactors)):h={isDiamondMaterialParameters:!0},h.color=null!==(s=null!==(r=h.color)&&void 0!==r?r:null==e?void 0:e.color)&&void 0!==s?s:new n.Ilk(1,1,1),h.name=null!==(a=null!==(o=h.name)&&void 0!==o?o:null==e?void 0:e.name)&&void 0!==a?a:"diamond";const p=null===(u=null===(c=null===(l=this._viewer)||void 0===l?void 0:l.getManager())||void 0===c?void 0:c.materials)||void 0===u?void 0:u.generateFromTemplate("diamond",h);if(p&&e&&!e.isDiamondMaterial&&(p.userData._baseMaterial=e.uuid),i){const n=e=>{var t;return null!==(t=e.setMaterial)&&void 0!==t?t:t=>{e.material=t.materialObject}};Array.from(null!==(d=null==e?void 0:e.userData.__appliedMeshes)&&void 0!==d?d:[]).forEach((e=>{n(e)(p),this.prepareDiamondMesh(e,t)}))}return p}_computeOffsets(e,i,r=!1){var s;if(e.userData.normalsCaptureOffsets){if(null===(0,t.getUrlQueryParam)("recomputeOffsets"))return e.userData.normalsCaptureOffsets;console.warn("WebGi DiamondPlugin: recomputeOffsets",e.userData.normalsCaptureOffsets)}let o;(null===(s=e.morphAttributes)||void 0===s?void 0:s.position)&&(o=e.morphAttributes,e.morphAttributes={}),e.computeBoundingBox();const a=e.boundingBox.getCenter(new n.Pa4).toArray(),l=ql(e).toArray(),c=(new n.yGw).fromArray(l).invert(),u=(new n.Pa4).fromArray(a).applyMatrix4(c).toArray(),d={center:a,offsetMatrix:l,offsetMatrixInv:c.toArray(),radius:1,centerOffset:u};return e.userData.normalsCaptureOffsets=d,o&&(e.morphAttributes=o,e.computeBoundingBox()),null!==(0,t.getUrlQueryParam)("recomputeOffsets")&&console.warn("WebGi DiamondPlugin: recomputeOffsets",d),d}disposeCacheMap(e){var t;null===(t=this._normalCapture)||void 0===t||t.disposeTarget(e)}disposeAllCacheMaps(){var e;null===(e=this._normalCapture)||void 0===e||e.disposeAllTargets()}}Bc.PluginType="Diamond",Bc.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",kc([(0,t.onChange)(Bc.prototype.refreshEnvMaps),re()],Bc.prototype,"envMap",void 0),kc([(0,t.onChange)(Bc.prototype.refreshEnvMaps),re()],Bc.prototype,"envMap2",void 0),kc([(0,t.onChange)(Bc.prototype.refreshEnvMaps),re()],Bc.prototype,"envMap3",void 0),kc([(0,t.onChange)(Bc.prototype.refreshEnvMaps),re()],Bc.prototype,"forceSceneEnvMap",void 0);const Oc=e=>({writeMaterial:(t,n)=>{t.isDiamondMaterial&&(n.extensions=n.extensions||{},n.extensions[Bc.DIAMOND_GLTF_EXTENSION]=t.toJSON(),e.extensionsUsed[Bc.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(t,n)=>{var i,r;if(!(null==t?void 0:t.material.isDiamondMaterial))return;n.extensions=n.extensions||{};const s={};null===(r=null===(i=t.userData)||void 0===i?void 0:i.gltfExtensions)||void 0===r||delete r[Bc.DIAMOND_GLTF_EXTENSION],t.userData._diamondNormalMapRes&&(s.normalMapRes=t.userData._diamondNormalMapRes),t.userData._diamondNormalMapPrecision&&(s.normalMapPrecision=t.userData._diamondNormalMapPrecision),t.userData._diamondCacheKey&&(s.cacheKey=t.userData._diamondCacheKey),n.extensions[Bc.DIAMOND_GLTF_EXTENSION]=s,e.extensionsUsed[Bc.DIAMOND_GLTF_EXTENSION]=!0}});class Lc{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:n=1,scale:i=1}){var r,s,o;const a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");a.width=t.width*i*n,a.height=t.height*i*n,t.assumeClientRect&&(t.x*=e.width/(n*e.clientWidth),t.y*=e.height/(n*e.clientHeight),t.width*=e.width/(n*e.clientWidth),t.height*=e.height/(n*e.clientHeight));const l=a.getContext("2d");if(!l)return console.error("snapshot: cannot create context"),a;const c=e.style.background||(null===(r=e.parentElement)||void 0===r?void 0:r.style.background)||"";if(c.includes("url")){const i=null===(s=/url\("(.*)"\)/gi.exec(c))||void 0===s?void 0:s[1];if(i){const r=new Image;r.src=i,await new Promise(((e,t)=>{r.onload=()=>e(),r.onerror=()=>t(),r.complete&&e()})),l.drawImage(r,r.width*t.x*n/e.width,r.height*t.y*n/e.height,r.width*t.width*n/e.width,r.height*t.height*n/e.height,0,0,a.width,a.height)}}else l.fillStyle=e.style.background||(null===(o=e.parentElement)||void 0===o?void 0:o.style.backgroundColor)||"#00000000",l.fillRect(0,0,a.width,a.height);return null==l||l.drawImage(e,t.x*n,t.y*n,t.width*n,t.height*n,0,0,a.width,a.height),this.Debug&&(document.body.appendChild(a),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.borderWidth="2px",a.style.borderColor="#ff00ff",setTimeout((()=>a.remove()),5e3)),a}static async GetDataUrl(e,{mimeType:t="image/png",...n}){const i=!1===n.cloneCanvas?e:await this.GetClonedCanvas(e,n),r=i.toDataURL(t);return this.Debug||i===e||i.remove(),r}static async GetImage(e,{mimeType:t="image/png",...n}={}){const i=await this.GetDataUrl(e,n);return new Promise(((e,t)=>{const n=new Image;n.onload=()=>{e(n)},n.src=i}))}static async GetBlob(e,t={}){const n=!1===t.cloneCanvas?e:await this.GetClonedCanvas(e,t),i=await new Promise(((e,i)=>{var r;n.toBlob((t=>{t?e(t):i()}),null!==(r=t.mimeType)&&void 0!==r?r:"image/png")}));return this.Debug||n===e||n.remove(),i}static async GetFile(e,n="image.png",i={}){var r;return i.getDataUrl?await this.GetDataUrl(e,i):new File([await this.GetBlob(e,i)],n,{type:null!==(r=i.mimeType)&&void 0!==r?r:"image/png",lastModified:(0,t.now)()})}}Lc.Debug=!1;var Uc=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Nc=class extends _t{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(e,t={waitForProgressive:!0}){return t.getDataUrl=!1,await this._getFile(e||this.filename,t)}async getDataUrl(e={}){var t;return e.getDataUrl=!0,null!==(t=await this._getFile("",e))&&void 0!==t?t:""}async _getFile(e,n={}){var i,r,s;const o=null===(i=this._viewer)||void 0===i?void 0:i.canvas;if(o){const i=this._viewer.renderer.displayCanvasScaling;void 0!==n.displayPixelRatio&&n.displayPixelRatio!==i&&(this._viewer.renderer.displayCanvasScaling=n.displayPixelRatio);const a=null===(r=this._viewer)||void 0===r?void 0:r.getPlugin(To);if(n.waitForProgressive&&a&&void 0===n.timeout)for(;!a.isConverged(!0);)await(0,t.timeout)(64);else await(0,t.timeout)(null!==(s=n.timeout)&&void 0!==s?s:200);n.displayPixelRatio=1;const l=await Lc.GetFile(o,e,n);return n.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=i,l}}async downloadSnapshot(e,t={waitForProgressive:!0}){const n=await this.getFile(e,t);n&&await this._downloadBlob(n,n.name)}async _downloadBlob(e,t){var n,i;const r=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("FileTransferPlugin");r?await r.exportFile(e,t):null===(i=this._viewer)||void 0===i||i.console.error("FileTransferPlugin required to export/download file")}};Nc.PluginType="CanvasSnipper",Uc([ze("Filename"),re()],Nc.prototype,"filename",void 0),Uc([je("Download .png",{limitedUi:!0})],Nc.prototype,"downloadSnapshot",null),Nc=Uc([We("Image Export")],Nc);var Fc=function(e){return function(t){return 1-e(1-t)}},jc=function(e){return function(t){return t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2}},zc=function(e){return function(t){return Math.pow(t,e)}},Gc=function(e){return function(t){return t*t*((e+1)*t-e)}},Vc=function(e){var t=Gc(e);return function(e){return(e*=2)<1?.5*t(e):.5*(2-Math.pow(2,-10*(e-1)))}},Hc=function(e){return e},Qc=zc(2),Wc=Fc(Qc),qc=jc(Qc),Xc=function(e){return 1-Math.sin(Math.acos(e))},Yc=Fc(Xc),Kc=jc(Yc),Jc=Gc(1.525),Zc=Fc(Jc),$c=jc(Jc),eu=Vc(1.525),tu=function(e){if(1===e||0===e)return e;var t=e*e;return e<.36363636363636365?7.5625*t:e<.7272727272727273?9.075*t-9.9*e+3.4:e<.9?12.066481994459833*t-19.63545706371191*e+8.898060941828255:10.8*e*e-20.52*e+10.72},nu=Fc(tu),iu=function(e){return e<.5?.5*(1-tu(1-2*e)):.5*tu(2*e-1)+.5},ru=function(){return ru=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ru.apply(this,arguments)};function su(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Object.create,Object.create;var ou=function(){},au=function(){},lu=function(e,t,n){return Math.min(Math.max(n,e),t)},cu=.001,uu=.01,du=10,hu=.05,pu=1,fu=12;function mu(e,t){return e*Math.sqrt(1-t*t)}var gu=["duration","bounce"],_u=["stiffness","damping","mass"];function vu(e,t){return t.some((function(t){return void 0!==e[t]}))}function yu(e){var t=e.from,n=void 0===t?0:t,i=e.to,r=void 0===i?1:i,s=e.restSpeed,o=void 0===s?2:s,a=e.restDelta,l=su(e,["from","to","restSpeed","restDelta"]),c={done:!1,value:n},u=function(e){var t=ru({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},e);if(!vu(e,_u)&&vu(e,gu)){var n=function(e){var t,n,i=e.duration,r=void 0===i?800:i,s=e.bounce,o=void 0===s?.25:s,a=e.velocity,l=void 0===a?0:a,c=e.mass,u=void 0===c?1:c;ou(r<=1e3*du,"Spring duration must be 10 seconds or less");var d=1-o;d=lu(hu,pu,d),r=lu(uu,du,r/1e3),d<1?(t=function(e){var t=e*d,n=t*r,i=t-l,s=mu(e,d),o=Math.exp(-n);return cu-i/s*o},n=function(e){var n=e*d*r,i=n*l+l,s=Math.pow(d,2)*Math.pow(e,2)*r,o=Math.exp(-n),a=mu(Math.pow(e,2),d);return(-t(e)+cu>0?-1:1)*((i-s)*o)/a}):(t=function(e){return Math.exp(-e*r)*((e-l)*r+1)-cu},n=function(e){return Math.exp(-e*r)*(r*r*(l-e))});var h=function(e,t,n){for(var i=n,r=1;r<fu;r++)i-=e(i)/t(i);return i}(t,n,5/r);if(r*=1e3,isNaN(h))return{stiffness:100,damping:10,duration:r};var p=Math.pow(h,2)*u;return{stiffness:p,damping:2*d*Math.sqrt(u*p),duration:r}}(e);(t=ru(ru(ru({},t),n),{velocity:0,mass:1})).isResolvedFromDuration=!0}return t}(l),d=u.stiffness,h=u.damping,p=u.mass,f=u.velocity,m=u.duration,g=u.isResolvedFromDuration,_=bu,v=bu;function y(){var e=f?-f/1e3:0,t=r-n,i=h/(2*Math.sqrt(d*p)),s=Math.sqrt(d/p)/1e3;if(null!=a||(a=Math.abs(r-n)<=1?.01:.4),i<1){var o=mu(s,i);_=function(n){var a=Math.exp(-i*s*n);return r-a*((e+i*s*t)/o*Math.sin(o*n)+t*Math.cos(o*n))},v=function(n){var r=Math.exp(-i*s*n);return i*s*r*(Math.sin(o*n)*(e+i*s*t)/o+t*Math.cos(o*n))-r*(Math.cos(o*n)*(e+i*s*t)-o*t*Math.sin(o*n))}}else if(1===i)_=function(n){return r-Math.exp(-s*n)*(t+(e+s*t)*n)};else{var l=s*Math.sqrt(i*i-1);_=function(n){var o=Math.exp(-i*s*n),a=Math.min(l*n,300);return r-o*((e+i*s*t)*Math.sinh(a)+l*t*Math.cosh(a))/l}}}return y(),{next:function(e){var t=_(e);if(g)c.done=e>=m;else{var n=1e3*v(e),i=Math.abs(n)<=o,s=Math.abs(r-t)<=a;c.done=i&&s}return c.value=c.done?r:t,c},flipTarget:function(){var e;f=-f,n=(e=[r,n])[0],r=e[1],y()}}}yu.needsInterpolation=function(e,t){return"string"==typeof e||"string"==typeof t};var bu=function(e){return 0},Au=function(e,t,n){var i=t-e;return 0===i?1:(n-e)/i},wu=function(e,t,n){return-n*e+n*t+e},xu=function(e,t){return function(n){return Math.max(Math.min(n,t),e)}},Eu=function(e){return e%1?Number(e.toFixed(5)):e},Cu=/(-)?([\d]*\.?[\d])+/g,Su=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,Mu=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Tu(e){return"string"==typeof e}var Iu={test:function(e){return"number"==typeof e},parse:parseFloat,transform:function(e){return e}},Pu=ru(ru({},Iu),{transform:xu(0,1)}),Ru=(ru(ru({},Iu),{default:1}),function(e,t){return function(n){return Boolean(Tu(n)&&Mu.test(n)&&n.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(n,t))}}),Du=function(e,t,n){return function(i){var r;if(!Tu(i))return i;var s=i.match(Cu),o=s[0],a=s[1],l=s[2],c=s[3];return(r={})[e]=parseFloat(o),r[t]=parseFloat(a),r[n]=parseFloat(l),r.alpha=void 0!==c?parseFloat(c):1,r}},ku=xu(0,255),Bu=ru(ru({},Iu),{transform:function(e){return Math.round(ku(e))}}),Ou={test:Ru("rgb","red"),parse:Du("red","green","blue"),transform:function(e){var t=e.red,n=e.green,i=e.blue,r=e.alpha,s=void 0===r?1:r;return"rgba("+Bu.transform(t)+", "+Bu.transform(n)+", "+Bu.transform(i)+", "+Eu(Pu.transform(s))+")"}},Lu={test:Ru("#"),parse:function(e){var t="",n="",i="",r="";return e.length>5?(t=e.substr(1,2),n=e.substr(3,2),i=e.substr(5,2),r=e.substr(7,2)):(t=e.substr(1,1),n=e.substr(2,1),i=e.substr(3,1),r=e.substr(4,1),t+=t,n+=n,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:Ou.transform},Uu=function(e){return{test:function(t){return Tu(t)&&t.endsWith(e)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+e}}},Nu=(Uu("deg"),Uu("%")),Fu=(Uu("px"),Uu("vh"),Uu("vw"),ru(ru({},Nu),{parse:function(e){return Nu.parse(e)/100},transform:function(e){return Nu.transform(100*e)}}),{test:Ru("hsl","hue"),parse:Du("hue","saturation","lightness"),transform:function(e){var t=e.hue,n=e.saturation,i=e.lightness,r=e.alpha,s=void 0===r?1:r;return"hsla("+Math.round(t)+", "+Nu.transform(Eu(n))+", "+Nu.transform(Eu(i))+", "+Eu(Pu.transform(s))+")"}}),ju=function(e,t,n){var i=e*e,r=t*t;return Math.sqrt(Math.max(0,n*(r-i)+i))},zu=[Lu,Ou,Fu],Gu=function(e){return zu.find((function(t){return t.test(e)}))},Vu=function(e){return"'"+e+"' is not an animatable color. Use the equivalent color code instead."},Hu=function(e,t){var n=Gu(e),i=Gu(t);if(au(!!n,Vu(e)),au(!!i,Vu(t)),au(n.transform===i.transform,"Both colors must be hex/RGBA, OR both must be HSLA."),!n||!i||n.transform!==i.transform)return function(n){return""+(n>0?t:e)};var r=n.parse(e),s=i.parse(t),o=ru({},r),a=n===Fu?wu:ju;return function(e){for(var t in o)"alpha"!==t&&(o[t]=a(r[t],s[t],e));return o.alpha=wu(r.alpha,s.alpha,e),n.transform(o)}},Qu={test:function(e){return Ou.test(e)||Lu.test(e)||Fu.test(e)},parse:function(e){return Ou.test(e)?Ou.parse(e):Fu.test(e)?Fu.parse(e):Lu.parse(e)},transform:function(e){return Tu(e)?e:e.hasOwnProperty("red")?Ou.transform(e):Fu.transform(e)}},Wu="${c}",qu="${n}";function Xu(e){"number"==typeof e&&(e=""+e);var t=[],n=0,i=e.match(Su);i&&(n=i.length,e=e.replace(Su,Wu),t.push.apply(t,i.map(Qu.parse)));var r=e.match(Cu);return r&&(e=e.replace(Cu,qu),t.push.apply(t,r.map(Iu.parse))),{values:t,numColors:n,tokenised:e}}function Yu(e){return Xu(e).values}function Ku(e){var t=Xu(e),n=t.values,i=t.numColors,r=t.tokenised,s=n.length;return function(e){for(var t=r,n=0;n<s;n++)t=t.replace(n<i?Wu:qu,n<i?Qu.transform(e[n]):Eu(e[n]));return t}}var Ju=function(e){return"number"==typeof e?0:e},Zu={test:function(e){var t,n,i,r;return isNaN(e)&&Tu(e)&&(null!==(n=null===(t=e.match(Cu))||void 0===t?void 0:t.length)&&void 0!==n?n:0)+(null!==(r=null===(i=e.match(Su))||void 0===i?void 0:i.length)&&void 0!==r?r:0)>0},parse:Yu,createTransformer:Ku,getAnimatableNone:function(e){var t=Yu(e);return Ku(e)(t.map(Ju))}},$u={x:0,y:0,z:0},ed=function(e){return"number"==typeof e},td=function(e,t){return function(n){return t(e(n))}},nd=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce(td)};function id(e,t){return ed(e)?function(n){return wu(e,t,n)}:Qu.test(e)?Hu(e,t):ad(e,t)}var rd=function(e,t){var n=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,s=t.length;r<s;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}([],e),i=n.length,r=e.map((function(e,n){return id(e,t[n])}));return function(e){for(var t=0;t<i;t++)n[t]=r[t](e);return n}},sd=function(e,t){var n=ru(ru({},e),t),i={};for(var r in n)void 0!==e[r]&&void 0!==t[r]&&(i[r]=id(e[r],t[r]));return function(e){for(var t in i)n[t]=i[t](e);return n}};function od(e){for(var t=Zu.parse(e),n=t.length,i=0,r=0,s=0,o=0;o<n;o++)i||"number"==typeof t[o]?i++:void 0!==t[o].hue?s++:r++;return{parsed:t,numNumbers:i,numRGB:r,numHSL:s}}var ad=function(e,t){var n=Zu.createTransformer(t),i=od(e),r=od(t);return i.numHSL===r.numHSL&&i.numRGB===r.numRGB&&i.numNumbers>=r.numNumbers?nd(rd(i.parsed,r.parsed),n):(ou(!0,"Complex values '"+e+"' and '"+t+"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition."),function(n){return""+(n>0?t:e)})},ld=function(e,t){return function(n){return wu(e,t,n)}};function cd(e,t,n){var i=void 0===n?{}:n,r=i.clamp,s=void 0===r||r,o=i.ease,a=i.mixer,l=e.length;au(l===t.length,"Both input and output ranges must be the same length"),au(!o||!Array.isArray(o)||o.length===l-1,"Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values."),e[0]>e[l-1]&&(e=[].concat(e),t=[].concat(t),e.reverse(),t.reverse());var c=function(e,t,n){for(var i=[],r=n||("number"==typeof(c=e[0])?ld:"string"==typeof c?Qu.test(c)?Hu:ad:Array.isArray(c)?rd:"object"==typeof c?sd:void 0),s=e.length-1,o=0;o<s;o++){var a=r(e[o],e[o+1]);if(t){var l=Array.isArray(t)?t[o]:t;a=nd(l,a)}i.push(a)}var c;return i}(t,o,a),u=2===l?function(e,t){var n=e[0],i=e[1],r=t[0];return function(e){return r(Au(n,i,e))}}(e,c):function(e,t){var n=e.length,i=n-1;return function(r){var s=0,o=!1;if(r<=e[0]?o=!0:r>=e[i]&&(s=i-1,o=!0),!o){for(var a=1;a<n&&!(e[a]>r||a===i);a++);s=a-1}var l=Au(e[s],e[s+1],r);return t[s](l)}}(e,c);return s?function(t){return u(lu(e[0],e[l-1],t))}:u}function ud(e,t){return e.map((function(){return t||qc})).splice(0,e.length-1)}function dd(e){var t=e.from,n=void 0===t?0:t,i=e.to,r=void 0===i?1:i,s=e.ease,o=e.offset,a=e.duration,l=void 0===a?300:a,c={done:!1,value:n},u=Array.isArray(r)?r:[n,r],d=function(e,t){return e.map((function(e){return e*t}))}(o&&o.length===u.length?o:function(e){var t=e.length;return e.map((function(e,n){return 0!==n?n/(t-1):0}))}(u),l);function h(){return cd(d,u,{ease:Array.isArray(s)?s:ud(u,s)})}var p=h();return{next:function(e){return c.value=p(e),c.done=e>=l,c},flipTarget:function(){u.reverse(),p=h()}}}function hd(e){var t=e.velocity,n=void 0===t?0:t,i=e.from,r=void 0===i?0:i,s=e.power,o=void 0===s?.8:s,a=e.timeConstant,l=void 0===a?350:a,c=e.restDelta,u=void 0===c?.5:c,d=e.modifyTarget,h={done:!1,value:r},p=o*n,f=r+p,m=void 0===d?f:d(f);return m!==f&&(p=m-r),{next:function(e){var t=-p*Math.exp(-e/l);return h.done=!(t>u||t<-u),h.value=h.done?m:m+t,h},flipTarget:function(){}}}var pd={keyframes:dd,spring:yu,decay:hd},fd=1/60*1e3,md="undefined"!=typeof performance?function(){return performance.now()}:function(){return Date.now()},gd="undefined"!=typeof window?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout((function(){return e(md())}),fd)},_d=!0,vd=!1,yd=!1,bd={delta:0,timestamp:0},Ad=["read","update","preRender","render","postRender"],wd=Ad.reduce((function(e,t){return e[t]=function(e){var t=[],n=[],i=0,r=!1,s=new WeakSet,o={schedule:function(e,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);var l=a&&r,c=l?t:n;return o&&s.add(e),-1===c.indexOf(e)&&(c.push(e),l&&r&&(i=t.length)),e},cancel:function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1),s.delete(e)},process:function(a){var l;if(r=!0,t=(l=[n,t])[0],(n=l[1]).length=0,i=t.length)for(var c=0;c<i;c++){var u=t[c];u(a),s.has(u)&&(o.schedule(u),e())}r=!1}};return o}((function(){return vd=!0})),e}),{}),xd=Ad.reduce((function(e,t){var n=wd[t];return e[t]=function(e,t,i){return void 0===t&&(t=!1),void 0===i&&(i=!1),vd||Md(),n.schedule(e,t,i)},e}),{}),Ed=Ad.reduce((function(e,t){return e[t]=wd[t].cancel,e}),{}),Cd=function(e){return wd[e].process(bd)},Sd=function(e){vd=!1,bd.delta=_d?fd:Math.max(Math.min(e-bd.timestamp,40),1),bd.timestamp=e,yd=!0,Ad.forEach(Cd),yd=!1,vd&&(_d=!1,gd(Sd))},Md=function(){vd=!0,_d=!0,yd||gd(Sd)},Td=function(){return bd},Id=xd;function Pd(e,t,n){return void 0===n&&(n=0),e-t-n}var Rd=function(e){var t=function(t){var n=t.delta;return e(n)};return{start:function(){return Id.update(t,!0)},stop:function(){return Ed.update(t)}}};function Dd(e){var t,n,i,r,s,o=e.from,a=e.autoplay,l=void 0===a||a,c=e.driver,u=void 0===c?Rd:c,d=e.elapsed,h=void 0===d?0:d,p=e.repeat,f=void 0===p?0:p,m=e.repeatType,g=void 0===m?"loop":m,_=e.repeatDelay,v=void 0===_?0:_,y=e.onPlay,b=e.onStop,A=e.onComplete,w=e.onRepeat,x=e.onUpdate,E=su(e,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),C=E.to,S=0,M=E.duration,T=!1,I=!0,P=function(e){if(Array.isArray(e.to))return dd;if(pd[e.type])return pd[e.type];var t=new Set(Object.keys(e));return t.has("ease")||t.has("duration")&&!t.has("dampingRatio")?dd:t.has("dampingRatio")||t.has("stiffness")||t.has("mass")||t.has("damping")||t.has("restSpeed")||t.has("restDelta")?yu:dd}(E);(null===(n=(t=P).needsInterpolation)||void 0===n?void 0:n.call(t,o,C))&&(s=cd([0,100],[o,C],{clamp:!1}),o=0,C=100);var R=P(ru(ru({},E),{from:o,to:C}));return l&&(null==y||y(),(i=u((function(e){if(I||(e=-e),h+=e,!T){var t=R.next(Math.max(0,h));r=t.value,s&&(r=s(r)),T=I?t.done:h<=0}null==x||x(r),T&&(0===S&&(null!=M||(M=h)),S<f?function(e,t,n,i){return i?e>=t+n:e<=-n}(h,M,v,I)&&(S++,"reverse"===g?h=function(e,t,n,i){return void 0===n&&(n=0),void 0===i&&(i=!0),i?Pd(t+-e,t,n):t-(e-t)+n}(h,M,v,I=S%2==0):(h=Pd(h,M,v),"mirror"===g&&R.flipTarget()),T=!1,w&&w()):(i.stop(),A&&A()))}))).start()),{stop:function(){null==b||b(),i.stop()}}}const kd={linear:Hc,easeIn:Qc,easeOut:Wc,easeInOut:qc,circIn:Xc,circOut:Yc,circInOut:Kc,backIn:Jc,backOut:Zc,backInOut:$c,anticipate:eu,bounceOut:tu,bounceIn:nu,bounceInOut:iu,easeInOutSine:function(e){return-(Math.cos(Math.PI*e)-1)/2}};function Bd(e,t,n){const i=e[t],r=()=>{null==n||n()};return i.isColor?e=>{i.set(e),r()}:"function"==typeof i.copy?e=>{i.copy(e),r()}:n=>{e[t]=n,r()}}function Od(e){return"boolean"!=typeof e}async function Ld(e,n,i,r,s=!1){n in e||console.error("invalid key",n,e);const o=Bd(e,n),a=s||void 0===i.from?e[n]:i.from,l=e=>{var t;o(e),null===(t=i.onUpdate)||void 0===t||t.call(i,e)};if(Od(a))return"function"==typeof i.to&&(i={...i,to:i.to(a,e)}),Ud({...i,from:a,onUpdate:l},r);{const{duration:e}=i;return(0,t.timeout)(null!=e?e:0).then((()=>l(i.to)))}}async function Ud(e,t){const n=e.onComplete,i=e.onStop,r=e.onEnd;return e={...e},new Promise(((s,o)=>{e.onComplete=()=>{try{null==n||n()}catch(e){return null==r||r(),void o(e)}null==r||r(),s()},e.onStop=()=>{try{null==i||i()}catch(e){return null==r||r(),void o(e)}null==r||r(),s()};const a=Dd(e);t&&t.push(a)}))}var Nd=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Fd=1,jd=class{constructor(e,t,i,r,s){this.position=new n.Pa4,this.target=new n.Pa4,this.quaternion=new n._fP,this.up=new n.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=Qe(this.name,this),e&&(this.position=e),t&&(this.target=t),i&&(this.up=i),r&&(this.quaternion=r),s&&(this.snap=s),this.name="#view"+Fd++}_nameChanged(){var e,t;this.uiConfig&&(this.uiConfig.label=this.name,null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e))}};Nd([re(),Ne()],jd.prototype,"position",void 0),Nd([re(),Ne()],jd.prototype,"target",void 0),Nd([re(),Ne()],jd.prototype,"quaternion",void 0),Nd([re(),Ne()],jd.prototype,"up",void 0),Nd([re(),ze()],jd.prototype,"name",void 0),Nd([Ve()],jd.prototype,"snap",void 0),Nd([je()],jd.prototype,"focusView",void 0),Nd([je()],jd.prototype,"deleteView",void 0),Nd([je()],jd.prototype,"updateView",void 0),jd=Nd([de("CameraView")],jd);class zd extends _t{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex((t=>t.u===e)),1)}),this.focusNext=(e=!0)=>{if(this._animating)return;if(this._cameraViews.length<2)return;let t=this._cameraViews.findIndex((e=>e===this._currentView));t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating)return;if(this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex((e=>e===this._currentView));t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map((e=>e.uiConfig))],...He(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const i=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera;if(!i)return;const r=new n.$V,s=i.position,o=i.target,a=(new n._fP).setFromUnitVectors(i.cameraObject.up,new n.Pa4(0,1,0)),l=a.clone().invert(),c=s.clone().sub(o);c.applyQuaternion(a),r.setFromVector3(c),r.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,r.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,r.makeSafe(),c.setFromSpherical(r),c.applyQuaternion(l),s.copy(o).add(c),i.positionUpdated(!1),i.targetUpdated()}}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",(e=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.setInteractions(!1,zd.PluginType):this._viewer.scene.activeCamera.setInteractions(!0,zd.PluginType)})),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,n;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&(null===(e=this._viewer.getPluginByType("FrameFade"))||void 0===e||e.enable(zd.PluginType),this._fadeDisabled=!1));const i=(0,t.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=i-1/60);let r=i-this._lastFrameTime;this._lastFrameTime=i,r*=this.animateOnScroll?this._scrollAnimationState:1;const s=null===(n=this._viewer.getPluginByType("Progressive"))||void 0===n?void 0:n.postFrameConvergedRecordingDelta();if(s&&s>0&&(r=s),0!==s&&(r*=1e3,!(r<=0||(this._updaters.forEach((e=>{let t=r;e.time+t<0&&(t=-e.time),e.time+=t,Math.abs(t)>.001&&e.u(t)})),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(zd.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(0===this._viewQueue.length){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,t.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,t.timeout)(2))}async recordAllViews(e,t=!0){var n;if(!this.enabled)return;const i=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("CanvasRecorder");if(i&&i.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!i.isRecording())return new Promise(((n,r)=>{const s=()=>{i.removeEventListener("start",o),i.removeEventListener("stop",s),i.removeEventListener("error",a)},o=async()=>{var r;s(),null==e||e(),await this.animateAllViews();const o=await i.stopRecording();if(t){const e=await(null===(r=this._viewer)||void 0===r?void 0:r.prompt("Canvas Recorder: Save file as","recording.mp4"));null!==e&&o&&await this._downloadBlob(o,e||"recording.mp4")}n(o)},a=async()=>{s(),r()};i.addEventListener("start",o),i.addEventListener("stop",s),i.addEventListener("error",a),i.startRecording()||console.error("cannot start recording")}));console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var e,t;if(!this.enabled)return;const n=this.getCurrentCameraView();n.snap=await(null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Nc))||void 0===t?void 0:t.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(n)}addView(e){var t,n;this._cameraViews.push(e),null===(n=(t=this.uiConfig).uiRefresh)||void 0===n||n.call(t),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,t=!0,i){var r,s,o;if(e||(e=null===(r=this._viewer)||void 0===r?void 0:r.scene.activeCamera),!e)return new jd;const a=new n.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const l=e.cameraObject.matrixWorld;a.x=l.elements[4],a.y=l.elements[5],a.z=l.elements[6],a.normalize();const c=e.target.clone(),u=e.position.clone(),d=e.cameraObject.parent;d&&(t?u.applyMatrix4(d.matrixWorld):a.transformDirection(d.matrixWorld.clone().invert()));const h=t?e.cameraObject.getWorldQuaternion(new n._fP):e.cameraObject.quaternion.clone();return i?(i.position.copy(u),i.target.copy(c),i.up.copy(a),i.quaternion.copy(h)):((i=new jd(u,c,a,h,"")).focusView=async()=>i&&this.focusView(i),i.deleteView=()=>i&&this.deleteView(i),i.updateView=()=>this.getCurrentCameraView(e,t,i)),null===(o=(s=i.uiConfig).uiRefresh)||void 0===o||o.call(s,"postFrame",!0),i}setCurrentCameraView(e){var t;const n=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera;n&&(n.position.copy(e.position),n.target.copy(e.target),n.cameraObject.quaternion.copy(e.quaternion),n.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var t,n;const i=this._cameraViews.indexOf(e);i>=0&&this._cameraViews.splice(i,1),null===(n=(t=this.uiConfig).uiRefresh)||void 0===n||n.call(t),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach((e=>{var t;return null===(t=null==e?void 0:e.stop)||void 0===t?void 0:t.call(e)})),this._popAnimations=[];this._animating||this._animationLooping;)await(0,t.timeout)(100)}async animateToView(e,i,r,s=!1){var o,a;const l=null===(o=this._viewer)||void 0===o?void 0:o.scene.activeCamera;if(!l)return;if(this._animating){this._popAnimations.forEach((e=>(null==e?void 0:e.stop)&&e.stop())),this._popAnimations=[];let e=0;for(;this._animating&&(await(0,t.timeout)(100),!(e++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),void 0===i&&(i=this.animDuration),i=Math.max(10,i);const c="function"==typeof r?r:kd[r||this.animEase],u=this._driver,d=[];this._popAnimations=[];const h=this._popAnimations;if("spherical"===this.interpolateMode)d.push(async function(e,t,i,r,s,o){const a=e.target.clone(),l=new n.Pa4,c=new n.Pa4,u=e.cameraObject.parent,d=e.cameraObject.up.clone(),h=Gd({position:e.cameraObject.getWorldPosition(new n.Pa4),up:u?d.transformDirection(u.matrixWorld):d},a),p=Gd(t,t.target),f=new n.$V;function m(){e.position.copy(u?u.worldToLocal(c):c),e.target.copy(l),e.positionUpdated()}return Ud({from:0,to:1,duration:i,ease:r,driver:s,onUpdate:e=>{f.phi=Vd(h.phi,p.phi,e),f.theta=Vd(h.theta,p.theta,e),f.radius=n.M8C.lerp(h.radius,p.radius,e),l.copy(a).lerp(t.target,e),c.setFromSpherical(f),c.add(l),m()},onComplete:()=>{c.copy(t.position),l.copy(t.target),m()},onStop:()=>{throw new Error("Animation Stopped")}},o)}(l,e,i,c,u,h));else if("linear"===this.interpolateMode){d.push(Ud({from:l.position.clone(),to:e.position.clone(),duration:i,ease:c,driver:u,onUpdate:e=>l.position=e,onComplete:()=>l.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},h)),d.push(Ud({from:l.target.clone(),to:e.target.clone(),duration:i,ease:c,driver:u,onUpdate:e=>{l.target=e,l.targetUpdated()},onComplete:()=>{l.target=e.target,l.targetUpdated()}},h));const t=l.cameraObject.quaternion.clone(),r=new n._fP;d.push(Ud({from:0,to:1,duration:i,ease:c,driver:u,onUpdate:n=>{r.copy(t).slerp(e.quaternion,n),l.cameraObject.quaternion.copy(r),l.cameraObject.updateProjectionMatrix()},onComplete:()=>{l.cameraObject.quaternion.copy(e.quaternion),l.cameraObject.updateProjectionMatrix()}},h))}await Promise.allSettled(d).catch((e=>{if(s)throw e})),null===(a=this._viewer)||void 0===a||a.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,t.timeout)(10)}fromJSON(e,t){var n,i;return this._cameraViews.forEach((e=>this.deleteView(e))),super.fromJSON(e,t)?(this._cameraViews.forEach((e=>e.focusView=async()=>this.focusView(e))),this._cameraViews.forEach((e=>e.deleteView=()=>this.deleteView(e))),this._cameraViews.forEach((e=>e.updateView=()=>this.getCurrentCameraView(void 0,void 0,e))),null===(i=(n=this.uiConfig).uiRefresh)||void 0===i||i.call(n),this):null}async animateToObject(e,t=4,i,r,s={min:.5,max:5}){if(!this._viewer)return;const o=(new p).expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),a=o.getCenter(new n.Pa4),l=o.getSize(new n.Pa4).length()/2;await this.animateToTarget(Math.min(s.max,Math.max(s.min,l*t)),a,i,r)}async animateToFitObject(e,t=1.5,i=1e3,r,s={min:.5,max:50}){if(!this._viewer)return;const o=(new p).expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),a=o.getCenter(new n.Pa4),l=o.getSize(new n.Pa4);let c=this._viewer.scene.activeCamera.cameraObject,u=1;if(c.isPerspectiveCamera){const e=Math.max(1,c.fov)*(Math.PI/180),t=2*Math.atan(Math.tan(e/2)*c.aspect),n=l.z/2+Math.abs(l.x/2/Math.tan(t/2)),i=l.z/2+Math.abs(l.y/2/Math.tan(e/2));u=Math.max(n,i)}await this.animateToTarget(Math.min(s.max,Math.max(s.min,u*t)),a,i,r)}async animateToTarget(e,t,i,r){const s=this.getCurrentCameraView();s.target.copy(t);const o=(new n.Pa4).subVectors(s.target,s.position).normalize();s.position.copy(o.multiplyScalar(-e).add(s.target)),await this.animateToView(s,i,r)}async _downloadBlob(e,t){var n,i;const r=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("FileTransferPlugin");r?await r.exportFile(e,t):null===(i=this._viewer)||void 0===i||i.console.error("FileTransferPlugin required to export/download file")}}function Gd(e,t){const i=e.position.clone();i.sub(t);const r=(new n.$V).setFromVector3(i);return r.makeSafe(),r}function Vd(e,t,n){const i=t-e;return i>=Math.PI?e+(i-2*Math.PI)*n:i<=-Math.PI?e+(i+2*Math.PI)*n:e+i*n}function Hd(e,t,n){const i=(1-n)*Math.cos(e)+n*Math.cos(t),r=(1-n)*Math.sin(e)+n*Math.sin(t);return Math.atan2(r,i)}zd.PluginType="CameraViews",Nd([re("cameraViews")],zd.prototype,"_cameraViews",void 0),Nd([(0,t.onChange)(zd.prototype._animationLoop),re(),Oe("Loop All Views",{limitedUi:!0})],zd.prototype,"viewLooping",void 0),Nd([re(),ze("View Pause Time")],zd.prototype,"viewPauseTime",void 0),Nd([re(),Fe("Ease",Object.keys(kd).map((e=>({label:e}))))],zd.prototype,"animEase",void 0),Nd([re(),Ue("Duration",[10,1e4],10,{limitedUi:!0})],zd.prototype,"animDuration",void 0),Nd([re(),Ue("RotationOffset",[.2,.75],.01)],zd.prototype,"rotationOffset",void 0),Nd([re(),Fe("Interpolation",["spherical","linear"].map((e=>({label:e}))))],zd.prototype,"interpolateMode",void 0),Nd([Oe(),re()],zd.prototype,"seekOnScroll",void 0),Nd([je("Animate All Views",{limitedUi:!0})],zd.prototype,"animateAllViews",null),Nd([je("Record All Views")],zd.prototype,"recordAllViews",null),Nd([je("Add Current View")],zd.prototype,"addCurrentView",null),Nd([je("Focus Next")],zd.prototype,"focusNext",void 0),Nd([je("Focus Previous")],zd.prototype,"focusPrevious",void 0);const Qd=new n.Pa4;function Wd(e,t,n){let i=e.dot(t);i=Math.min(Math.max(i,-1),1);const r=Math.acos(i)*n;return Qd.copy(e).multiplyScalar(i).sub(t).negate().normalize(),e.multiplyScalar(Math.cos(r)).add(Qd.multiplyScalar(Math.sin(r)))}var qd,Xd=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Yd=qd=class{constructor(e){this.enabled=!1,this.power=.5,this.bgcolor=new n.Ilk(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new n.Ilk}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=e.getPlugin(Qs),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker"," \n            gl_FragColor = Vignette(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,n){this.enabled&&(this.extraUniforms.power.value=this.power,this.extraUniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};Yd.PluginType="Vignette",Xd([(0,t.onChange)(qd.prototype._setDirty),Oe("Enable"),re()],Yd.prototype,"enabled",void 0),Xd([(0,t.onChange)(qd.prototype._setDirty),Ue("Power",[.1,4],.01,{limitedUi:!0}),re()],Yd.prototype,"power",void 0),Xd([(0,t.onChange)(qd.prototype._setDirty),Ge("Color"),re()],Yd.prototype,"bgcolor",void 0),Yd=qd=Xd([We("Vignette")],Yd);class Kd extends qs{constructor(){super()}generateExtension(e){return new Yd(e)}get power(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.power)&&void 0!==t?t:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.bgcolor)&&void 0!==t?t:new n.Ilk}set color(e){this._extension&&(this._extension.bgcolor.set(e),this._extension.setDirty())}}Kd.PluginType="Vignette";var Jd=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Zd=class extends _t{constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const e=await(0,t.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(e)}async loadScenes(e){var t,n;const i=await Promise.all(e.map((async e=>await e.arrayBuffer())));for(let r=0;r<e.length;r++){const t=e[r];this.scenes.push({[t.name]:new Uint8Array(i[r])}),this.assets[t.name]={path:t.name,file:t}}null===(n=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===n||n.call(t)}async play(){var e,n;if(!this._viewer)return;if(this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const i=null!==(e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin"))&&void 0!==e?e:this._viewer.getPluginByType("LoadingScreenPlugin");null==i||i.enabled,i&&(i.enabled=!1);const r=this._viewer.getPluginByType("FrameFade"),s=this._viewer.getPluginByType("GLTFAnimation"),o=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const e of this.scenes){if(!this._isPlaying)break;const a=Object.keys(e);null==s||s.stopAnimation(!1),await(null==o?void 0:o.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const t of a){let i=this.assets[t];i||(i={path:t,file:new File([e[t]],t)},this.assets[t]=i),await(null===(n=this._viewer.getManager())||void 0===n?void 0:n.addAssetSingle(i,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,i&&(i.enabled=!1),r&&(r.enabled=!0,await r.startTransition(1e3));const l=[(0,t.timeout)(this.minSceneTime)];s&&l.push(s.playAnimation()),o&&l.push(o.animateAllViews()),await Promise.all(l)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const e={};for(const t of this.scenes)for(const n of Object.keys(t)){const i=e[n]?n+"_":n;e[i]=t[i]}const n=Es(e),i=new Blob([n],{type:"application/zip"});(0,t.downloadBlob)(i,"scenes.glbloop")}async onAdded(e){var n,i;await super.onAdded(e);const r=this;null===(i=null===(n=e.getManager())||void 0===n?void 0:n.importer)||void 0===i||i.Importers.push(new Nt(class extends Rs{load(e,n,i,s){super.load(e,(e=>{r.loadScenes([...e.values()]),null==n||n(null),(0,t.timeout)(100).then(r.play)}),i,s)}},["glbloop"],!0))}};Zd.PluginType="SceneLoopPlugin",Jd([Le("Loaded scenes")],Zd.prototype,"loadedScenes",null),Jd([je("Load Scenes")],Zd.prototype,"promptLoadScenes",null),Jd([Le("Playing")],Zd.prototype,"_isPlaying",void 0),Jd([ze("Min Scene Time")],Zd.prototype,"minSceneTime",void 0),Jd([je("Play")],Zd.prototype,"play",null),Jd([je("Stop")],Zd.prototype,"stop",null),Jd([je("Download Scenes")],Zd.prototype,"downloadScenes",null),Zd=Jd([We("Scene Loop")],Zd);var $d=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let eh=class extends pt{constructor(e,t,i){super(e,t,null!=i?i:new th,new n.Ilk(.5,.5,.5),1),this.enabled=!0,this._firstCall=!0}render(e,t,n,i,r){if(!this.enabled||!this.camera)return;const s=this.overrideMaterial;s.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(e,t,n,i,r),s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value)}};$d([Oe("Enabled")],eh.prototype,"enabled",void 0),eh=$d([We("Velocity Buffer (TAA)")],eh);class th extends n.jyz{constructor(){super({vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <uv_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){\n#include <uv_vertex>\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\nvec4 mvPosition=vec4(transformed,1.);\n#ifdef USE_INSTANCING\nmvPosition=instanceMatrix*mvPosition;\n#endif\nvWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n}",fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new n.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new n.Vkp},currentProjectionViewMatrix:{value:new n.yGw},lastProjectionViewMatrix:{value:new n.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:(new n.yGw).identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,i,r,s){var o,a;const l=this._previousWorldMatrices[s.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(null!=l?l:s.matrixWorld),l?l.copy(s.matrixWorld):this._previousWorldMatrices[s.uuid]=s.matrixWorld.clone();let c=s.material;Array.isArray(c)&&(c=c[0]),this.uniforms.alphaMap.value=null!==(o=null==c?void 0:c.alphaMap)&&void 0!==o?o:null,this.uniforms.alphaTest.value=!c||!c.alphaTest||c.alphaTest<1e-7?.001:c.alphaTest;let u=this.uniforms.alphaMap.value?1:void 0;u!==this.defines.USE_ALPHAMAP&&(void 0===u?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=u,this.needsUpdate=!0),u=c.userData.ALPHA_I_RGBA_PACKING?1:void 0,u!==this.defines.ALPHA_I_RGBA_PACKING&&(void 0===u?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=u,this.needsUpdate=!0),this.side=null!==(a=c.side)&&void 0!==a?a:n.ehD}}class nh extends yt{passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:n.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const i=new Set,r=new Set;return new class extends eh{render(n,s,o,a,l){var c;if(e.renderer.frameCount>0)return;const u=n.getRenderTarget(),d=n.getActiveCubeFace(),h=n.getActiveMipmapLevel();null===(c=this.scene)||void 0===c||c.traverse((({material:e})=>{var t,n;if(!e)return;const s=e.userData.renderToDepth&&!e.userData.pluginsDisabled&&!(null===(t=e.userData[nh.PluginType])||void 0===t?void 0:t.disabled),o=!1===e.userData.renderToDepth||e.userData.pluginsDisabled||(null===(n=e.userData[nh.PluginType])||void 0===n?void 0:n.disabled);(e.transparent&&s||!e.transparent&&!e.transmission&&o)&&(i.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&s&&(r.add([e,e.transmission]),e.transmission=0)})),H(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},(()=>super.render(n,s,t,a,l))),i.forEach((e=>e.transparent=!e.transparent)),i.clear(),r.forEach((([e,t])=>e.transmission=t)),r.clear(),n.setRenderTarget(u,d,h)}}}_update(e){if(!super._update(e))return!1;if(e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach((t=>{var n;return e.renderer.disposeTarget(null===(n=null==t?void 0:t.dispose)||void 0===n?void 0:n.call(t))})),super.onRemove(e)}updateShaderProperties(e){var t,n;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&null!==(n=null===(t=this.getVelocityBuffer())||void 0===t?void 0:t.texture)&&void 0!==n?n:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig}}nh.PluginType="VelocityBuffer";var ih,rh=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let sh=ih=class{constructor(e){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,t)=>this.enabled?"#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)\nuniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;\n#if USE_3DTEXTURE == 1\nprecision highp sampler3D;\n#if USE_LUT == 1\nuniform sampler3D lut3d;\n#endif\n#if USE_LUT1 == 1\nuniform sampler3D lut3d1;\n#endif\n#if USE_LUT2 == 1\nuniform sampler3D lut3d2;\n#endif\n#else\n#if USE_LUT == 1\nuniform sampler2D lut2d;\n#endif\n#if USE_LUT1 == 1\nuniform sampler2D lut2d1;\n#endif\n#if USE_LUT2 == 1\nuniform sampler2D lut2d2;\n#endif\nvec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}\n#endif\nint getLUTBit(in int number){\n#ifdef WebGL2Context\nreturn number%2;\n#else\nreturn int(mod(float(number),2.));\n#endif\n}int getLUTIndex(in int number){\n#ifdef WebGL2Context\nreturn number%8;\n#else\nreturn int(mod(float(number),8.));\n#endif\n}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));\n#if USE_3DTEXTURE == 1\nif(lutIndex==0.){\n#if USE_LUT == 1\noutColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);\n#endif\n}else if(lutIndex==1.){\n#if USE_LUT1 == 1\noutColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);\n#endif\n}else if(lutIndex==2.){\n#if USE_LUT2 == 1\noutColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);\n#endif\n}else{\n#if USE_LUT == 1\noutColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);\n#endif\n}\n#else\nif(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){\n#if USE_LUT1 == 1\noutColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);\n#endif\n}else if(lutIndex==2.){\n#if USE_LUT2 == 1\noutColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);\n#endif\n}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}\n#endif\noutColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}\n#endif\n":"",this._viewer=e,this._combinedPostPlugin=e.getPlugin(Qs),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const e=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let t=e?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,t,this.extraUniforms.lutSize,e),this.extraDefines.USE_LUT=this.lutMap?1:0,t=e?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,t,this.extraUniforms.lutSize1,e),this.extraDefines.USE_LUT1=this.lutMap1?1:0,t=e?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,t,this.extraUniforms.lutSize2,e),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=e,this._setDirty()}_updateLUTMap(e,t,n,i){if(e){let r=1;1==i?(t.value=e.texture3D,r=e.texture3D.image.width):e.texture&&(t.value=e.texture,r=e.texture.image.width),t.value.needsUpdate=!0,n.value=r}}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker"," \n            #if USE_LUT == 1\n                bool isBackground = getDepth(vUv)>0.9999;\n                #if LUT_BACKGROUND == 1\n                    gl_FragColor = colorLookUp(gl_FragColor);\n                #else\n                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);\n                #endif\n            #endif\n            #glMarker\n        "))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function oh(e){const t=null==e?void 0:e.userData;if(!t)return!1;t[ah.PluginType]||(t[ah.PluginType]={});const n=t[ah.PluginType];return n.enable=!0,void 0===n.index&&(n.index=0),e.isMaterial&&(e.needsUpdate=!0),!0}rh([re(),(0,t.onChange)(ih.prototype._updateParams),Oe("Enable")],sh.prototype,"enabled",void 0),rh([re(),(0,t.onChange)(ih.prototype._updateParams),Oe("LUT Background")],sh.prototype,"lutBackground",void 0),rh([re(),(0,t.onChange)(ih.prototype._updateParams),Ue("Intensity")],sh.prototype,"intensity",void 0),rh([(0,t.onChange)(ih.prototype._updateParams),Ve("LUT"),re()],sh.prototype,"lutMap",void 0),rh([(0,t.onChange)(ih.prototype._updateParams),Ve("LUT1"),re()],sh.prototype,"lutMap1",void 0),rh([(0,t.onChange)(ih.prototype._updateParams),Ve("LUT2"),re()],sh.prototype,"lutMap2",void 0),sh=ih=rh([We("LUT")],sh);class ah extends qs{_getUiConfig(e){var t,n;const i={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var t,n;return null===(n=null===(t=e.materialObject.userData[ah.PluginType])||void 0===t?void 0:t.enable)||void 0===n||n},set value(t){var n;const r=e.materialObject.userData[ah.PluginType];t!==(null==r?void 0:r.enable)&&(r||oh(e.materialObject),e.materialObject.userData[ah.PluginType].enable=t,null===(n=i.uiRefresh)||void 0===n||n.call(i,"postFrame",!0))},onChange:null===(t=this._extension)||void 0===t?void 0:t.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map((e=>({label:e[0],value:e[1]}))),label:"index",hidden:()=>{const t=e.materialObject.userData[ah.PluginType];return!!t&&!t.enable},get value(){var t,n;return null!==(n=null===(t=e.materialObject.userData[ah.PluginType])||void 0===t?void 0:t.index)&&void 0!==n?n:0},set value(t){var n;e.materialObject.userData[ah.PluginType]||oh(e.materialObject),e.materialObject.userData[ah.PluginType].index=t,null===(n=i.uiRefresh)||void 0===n||n.call(i,"postFrame",!0)},onChange:null===(n=this._extension)||void 0===n?void 0:n.setDirty}]};return i}constructor(){super(),this.materialExtension={uuid:De(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>{var t;return(this.enabled?"1":"0")+((null===(t=e.materialObject.userData[ah.PluginType])||void 0===t?void 0:t.enable)?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var t,n;await super.onAdded(e),null===(t=e.getPlugin(At))||void 0===t||t.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Ls);null===(n=null==i?void 0:i.materials)||void 0===n||n.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new sh(e)}updateGBuffer(e,t){var i,r;if(e instanceof n.Kj0&&(null===(i=e.material)||void 0===i?void 0:i.userData)){const n=null===(r=e.material)||void 0===r?void 0:r.userData[ah.PluginType];if(n){const e=!1===n.enable?0:1;t.w=Xs(t.w,0,e);for(let n=0;n<3;n++)t.y=Ys(t.y,n);let i=n.enable?n.index:0;i=Math.min(i,7),t.y=t.y|i}else t.w=Xs(t.w,0,1)}}}ah.PluginType="LUTPlugin1";class lh{constructor(e){this._zee=new n.Pa4(0,0,1),this._euler=new n.USm,this._q0=new n._fP,this._q1=new n._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new n._fP,this._initQuaternionDest=new n._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new n.FM8;this.getQuaternion(e,this._q2);const t=new n.Pa4(0,0,1);return t.applyQuaternion(this._q2),new n.FM8(t.x,t.y)}getQuaternion(e,t){if(t||(t=new n._fP),!this.deviceOrientation)return t.identity();const i=this.deviceOrientation,r=null!==i.alpha?n.M8C.degToRad(i.alpha):0,s=null!==i.beta?n.M8C.degToRad(i.beta):0,o=null!==i.gamma?n.M8C.degToRad(i.gamma):0,a=this.screenOrientation?n.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(t,r,s,o,a,e),t}_toQuaternion(e,t,n,i,r,s){this._euler.set(n,t,-i,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const o=document.getElementById("debug");return o&&(o.textContent=r+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-r)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),s&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return void 0!==window.DeviceOrientationEvent&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),null===(e=this._viewer)||void 0===e||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),"function"==typeof DeviceMotionEvent.requestPermission&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))})).catch((e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)})))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new n._fP)}}class ch{constructor(){this._mousePos=new n.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new n.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var uh,dh=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let hh=uh=class extends _t{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new n.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new n.Pa4,this._center=new n.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var e,t;if(!this.enabled)return void(null===(t=(e=this._object)._updateProjectionMatrixParallax)||void 0===t||t.call(e));const i=this._object,r=i.near;let s=r*Math.tan(.5*n.M8C.DEG2RAD*i.fov)/i.zoom,o=2*s,a=i.aspect*o,l=-.5*a;if(null!==i.view&&i.view.enabled){const e=i.view.fullWidth,t=i.view.fullHeight;l+=i.view.offsetX*a/e,s-=i.view.offsetY*o/t,a*=i.view.width/e,o*=i.view.height/t}l-=this._offX*r/this._focalDistance,s-=this._offY*r/this._focalDistance;const c=i.filmOffset;0!==c&&(l+=r*c/i.getFilmWidth()),i.projectionMatrix.makePerspective(l,l+a,s,s-o,r,i.far),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()},this._preFrame=e=>{this.update(e.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new t.Damper,this._yDamper=new t.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(e){var t,n,i;await super.onAdded(e),lh.IsCompatible()?this._input=new lh(e):this._input=new ch,e.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),e.addEventListener("preFrame",this._preFrame),null===(t=this._viewer)||void 0===t||t.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),null===(n=this._viewer)||void 0===n||n.container.addEventListener("pointerup",this.onPointerUp.bind(this)),null===(i=e.getPluginByType("Picking"))||void 0===i||i.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var e,t,n,i;this._object&&(null===(e=this._object)||void 0===e?void 0:e._updateProjectionMatrixParallax)&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera.cameraObject,(null===(n=this._object)||void 0===n?void 0:n.isOrthographicCamera)?null===(i=this._viewer)||void 0===i||i.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var e;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",null===(e=this._viewer)||void 0===e||e.container.appendChild(this._indicator))}onPointerDown(e){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=e.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=e.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(e){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.setInteractions(!1,uh.PluginType),this._updateFocalDistance();const t=this._object.matrixWorld.elements,i=new n.Pa4(t[0],t[1],t[2]),r=new n.Pa4(t[4],t[5],t[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let s=this.sensitivity;this.invert&&(s*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*s,e,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*s,e,1);const o=this._object;o.position.add(r.multiplyScalar(this._offY)).add(i.multiplyScalar(this._offX)),o.updateProjectionMatrix(),o.updateMatrixWorld(),this._dirty=!0}_onObjectHit(e){var t,n;e.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(e.intersects.intersect.point),e.intersects.selectedObject=null,null===(n=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===n||n.call(t,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout((()=>{var e,t;this._indicator.style.opacity="0",setTimeout((()=>this._indicator.style.display="none"),600),null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}),200)))}_updateFocalDistance(){if(!this._object)return;const e=this._object,t=new n.Pa4;e.getWorldDirection(t),t.normalize(),this._focalDistance=this.focalPointHit.clone().sub(e.position).dot(t)}_onEnabledChange(){var e,t,n;if(this._viewer){if(this.enabled){if(null===(e=this._input)||void 0===e||e.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.setInteractions(!1,uh.PluginType);const t=this._viewer.getPluginByType("CameraViews"),n=null==t?void 0:t.camViews.find((e=>e.name===this.cameraView));t&&n&&t.setCurrentCameraView(n),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.setInteractions(!0,uh.PluginType),this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const e=this._object;e.updateProjectionMatrix(),e.updateMatrixWorld()}null===(n=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===n||n.call(t,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var e;null===(e=this._input)||void 0===e||e.disconnect()}};hh.PluginType="ParallaxCameraControllerPlugin",dh([(0,t.onChange)(uh.prototype._onEnabledChange),re(),Oe("Enabled")],hh.prototype,"enabled",void 0),dh([re(),Oe("enableEdit")],hh.prototype,"enableEdit",void 0),dh([re(),Oe("Invert")],hh.prototype,"invert",void 0),dh([re(),Ue("Sensitivity",[.1,2],.01)],hh.prototype,"sensitivity",void 0),dh([re("focalPoint"),Ne("Focal Point Hit",void 0,.001)],hh.prototype,"focalPointHit",void 0),dh([(0,t.onChange)(uh.prototype._onDampingChange),re(),Ue("Damping",[0,1],.001)],hh.prototype,"damping",void 0),dh([re(),ze("Camera View")],hh.prototype,"cameraView",void 0),hh=uh=dh([We("Parallax Camera Controller")],hh);var ph=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let fh=class extends _t{addNoiseBumpMaterial(e){return mh(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new gh(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this._uniforms={noiseBumpParams:{value:new n.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new n.Ltg(0,1,3,0)},flakeFallOffParams:{value:new n.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(e,t)=>{var n;return this.enabled&&(null===(n=null==t?void 0:t.materialObject.userData._noiseBumpMat)||void 0===n?void 0:n.hasBump)?co+"\n#ifndef VORONOI_HELPER\n#define VORONOI_HELPER \nfloat voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}\n#endif\n\nuniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}\n":""},shaderExtender:(e,t,n)=>{var i;if(!this.enabled||!(null===(i=t.materialObject.userData._noiseBumpMat)||void 0===i?void 0:i.hasBump))return;const r="#glMarker beforeAccumulation";e.fragmentShader=e.fragmentShader.replace(r,"vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\nvec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}\n#endif\n\n"+r),e.defines.USE_UV="",e.extensionDerivatives=!0},onObjectRender:(e,t)=>{var n;const i=null===(n=t.materialObject.userData)||void 0===n?void 0:n._noiseBumpMat;if(!(null==i?void 0:i.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(i.bumpNoiseParams),this._uniforms.noiseBumpScale.value=i.bumpScale,this._uniforms.noiseBumpFlakeScale.value=i.flakeScale,this._uniforms.noiseFlakeClamp.value=i.flakeClamp,this._uniforms.noiseFlakeRadius.value=i.flakeRadius,i.flakeParams&&this._uniforms.flakeParams.value.copy(i.flakeParams),i.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(i.flakeFallOffParams),this._uniforms.useColorFlakes.value=i.useColorFlakes;const r=this.enabled?1:0;t.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==r&&(t.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=r,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n;return(this.enabled?"1":"0")+((null===(n=null===(t=e.materialObject.userData)||void 0===t?void 0:t._noiseBumpMat)||void 0===n?void 0:n.hasBump)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)||!1},set value(i){var r,s;i!==(null===(r=e.materialObject.userData._noiseBumpMat)||void 0===r?void 0:r.hasBump)&&(i?mh(e.materialObject)||t.alert("Cannot add noise bump."):e.materialObject.userData._noiseBumpMat&&(e.materialObject.userData._noiseBumpMat.hasBump=!1,e.materialObject.needsUpdate=!0),null===(s=n.uiRefresh)||void 0===s||s.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var t;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.flakeParams,"x"],onChange:this.setDirty}},()=>{var t;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.flakeParams,"y"],onChange:this.setDirty}},()=>{var t;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.flakeParams,"z"],onChange:this.setDirty}},()=>{var t;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.flakeParams,"w"],onChange:this.setDirty}},()=>{var t;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var t;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var t;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var e,t,n;null===(t=(e=this.materialExtension).setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s;await super.onAdded(e);const o=e.getPlugin(Ls);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==o?void 0:o.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(_h)}async onRemove(e){var t,n,i,r;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function mh(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._noiseBumpMat||(t._noiseBumpMat={});const i=t._noiseBumpMat;return i.hasBump=!0,void 0===i.bumpNoiseParams&&(i.bumpNoiseParams=[.5,.5]),void 0===i.bumpScale&&(i.bumpScale=.05),void 0===i.flakeScale&&(i.flakeScale=.05),void 0===i.flakeClamp&&(i.flakeClamp=1),void 0===i.flakeRadius&&(i.flakeRadius=.3),void 0===i.useColorFlakes&&(i.useColorFlakes=!1),void 0===i.flakeParams&&(i.flakeParams=new n.Ltg(0,1,3,0)),void 0===i.flakeFallOffParams&&(i.flakeFallOffParams=new n.Pa4(0,1,0)),e.isMaterial&&(e.needsUpdate=!0),!0}fh.PluginType="NoiseBumpMaterialPlugin",fh.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",ph([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],fh.prototype,"enabled",void 0),fh=ph([We("NoiseBump Materials")],fh);class gh{constructor(e){this.parser=e,this.name=fh.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),mh(t),t.userData._noiseBumpMat=ce(i,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const _h=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._noiseBumpMat)return;if(!t.userData._noiseBumpMat.hasBump)return;n.extensions=n.extensions||{};const i=le(t.userData._noiseBumpMat,!1);n.extensions[fh.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=i,e.extensionsUsed[fh.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class vh extends ht{constructor(e,t){super({vertexShader:i.vertexShader,fragmentShader:t+"\n"+Za+"\n#include <common>\nvarying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;\n#if HAS_VELOCITY_BUFFER == 1\nuniform sampler2D tVelocity;\n#endif\nvec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}\n#if HAS_VELOCITY_BUFFER == 0\nvec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}\n#endif\nvec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;\n#if HAS_VELOCITY_BUFFER == 0\n#if QUALITY == 1\nvec3 c_frag=find_closest_fragment_3x3(vUv);\n#else\nvec3 c_frag=find_closest_fragment_5tap(vUv);\n#endif\n#else\nvec3 c_frag=vec3(0.);\n#endif\nif(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{\n#if HAS_VELOCITY_BUFFER == 0\nfloat sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);\n#else\nvec2 screenSpaceVelocity=texture2D(tVelocity,vUv).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));\n#endif\ngl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}\n#include <encodings_fragment>\n}",uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new n.FM8},cameraNearFar:{value:new n.FM8},lastProjectionViewMatrix:{value:new n.yGw},currentProjectionViewMatrix:{value:new n.yGw},projection:{value:new n.yGw},inverseViewMatrix:{value:new n.yGw},jitterSample:{value:new n.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new n.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,i,r){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const s=this.uniforms.tVelocity.value?1:0;s!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=s,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,i,r),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}!function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([re(),j()],vh.prototype,"feedBack",void 0);class yh extends yt{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[At],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(To))throw"Add ProgressivePlugin before TAA";const t=new vh(e.getPlugin(To).lastFrame,e.getPlugin(At).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<=1&&e.scene.renderCamera===e.scene.activeCamera,!n.taaEnabled)return!1;const i=e.scene.renderCamera;return n.updateShaderProperties([e.getPlugin(At),i,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(To).lastFrame,n.updateCameraProperties(null==i?void 0:i.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e,t;return null!==(t=null===(e=this._viewer)||void 0===e?void 0:e.renderer.stableNoise)&&void 0!==t?t:this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var e;const t=null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig;if(t&&t.children)return t.children.includes(this._stableNoiseConfig)||t.children.push(this._stableNoiseConfig),t}}yh.PluginType="TAA";var bh=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Ah=class extends _t{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=e=>{var t;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const e=this._lastFsElement||(null===(t=this._viewer)||void 0===t?void 0:t.canvas);e&&(e.style.width=this._lastSize[0],e.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(e){var t;if(this.isFullScreen())return;const n=e||(null===(t=this._viewer)||void 0===t?void 0:t.canvas);return n?(this._lastFsElement=n,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[n.style.width,n.style.height],n.style.width="100%",n.style.height="100%",n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(e){return this.isFullScreen()?this.exit():this.enter(e)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||void 0!==document.msFullscreenElement}};Ah.PluginType="FullScreenPlugin",bh([je("Enter FullScreen")],Ah.prototype,"enter",null),bh([je("Exit FullScreen")],Ah.prototype,"exit",null),bh([je("Toggle FullScreen")],Ah.prototype,"toggle",null),Ah=bh([We("Full Screen")],Ah);const wh=(e,t)=>{const n={};for(const i of e.mappings)for(const e of i.variants)n[t[e]]={material:null,gltfMaterialIndex:i.material};return n},xh="KHR_materials_variants";class Eh{constructor(e){this.parser=e,this.name=xh}async afterRoot(e){const t=this.parser,n=t.json;if(!n.extensions||!n.extensions[this.name])return;const i=(e=>{const t=[],n=new Set;for(const i of e){let e=i,r=0;for(;n.has(e);)e=i+"."+ ++r;n.add(e),t.push(e)}return t})((n.extensions[this.name].variants||[]).map((e=>e.name)));for(const r of e.scenes)r.traverse((e=>{const r=t.associations.get(e);if(!r||void 0===r.meshes||void 0===r.primitives)return;const s=n.meshes[r.meshes].primitives[r.primitives].extensions;s&&s[this.name]&&(e.userData._variantMaterials=wh(s[this.name],i))}));await Promise.all(e.scenes.map((async e=>{const n=[];return e.traverse((e=>{return void 0!==(i=e).material&&i.userData&&i.userData._variantMaterials&&n.push((async e=>{const n=e.material,i=e.userData._variantMaterials,r=[];for(const s in i){const n=i[s];if(n.material)continue;const o=n.gltfMaterialIndex;r.push(t.getDependency("material",o).then((n=>{e.material=n,t.assignFinalMaterial(e),i[s].material=e.material})))}return Promise.all(r).then((()=>{e.material=n}))})(e));var i})),e.userData.__importData||(e.userData.__importData={}),e.userData.__importData[xh]={names:i},Promise.all(n)})))}}const Ch=e=>void 0!==e.material&&e.userData&&e.userData._variantMaterials&&!!Object.values(e.userData._variantMaterials).filter((e=>Sh(null==e?void 0:e.material))),Sh=e=>e&&e.isMaterial&&!Array.isArray(e);class Mh{constructor(e){this.writer=e,this.name=xh,this.variantNames=[]}beforeParse(e){const t=new Set;for(const n of e)n.traverse((e=>{if(!Ch(e))return;const n=e.userData._variantMaterials;for(const i in n){const e=n[i];Sh(e.material)&&t.add(i)}}));t.forEach((e=>this.variantNames.push(e)))}writeMesh(e,t){var n;if(!Ch(e))return;const i=e.userData,r=i._variantMaterials,s={};for(const l in r){const e=r[l].material;if(!Sh(e))continue;const t=this.variantNames.indexOf(l),n=this.writer.processMaterial(e);s[n]||(s[n]={material:n,variants:[]}),s[n].variants.push(t)}const o=Object.values(s).map((e=>e.variants.sort(((e,t)=>e-t))&&e)).sort(((e,t)=>e.material-t.material));if(0===o.length)return;const a=Sh(i._originalMaterial)&&null!==(n=this.writer.processMaterial(i._originalMaterial))&&void 0!==n?n:-1;for(const l of t.primitives)a>=0&&(l.material=a),l.extensions=l.extensions||{},l.extensions[this.name]={mappings:o}}afterParse(e){if(0===this.variantNames.length)return;const t=this.writer.json;t.extensions=t.extensions||{};const n=this.variantNames.map((e=>({name:e})));t.extensions[this.name]={variants:n},this.writer.extensionsUsed[this.name]=!0}}function Th(e){return new Mh(e)}class Ih extends _t{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Ls],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var t,n;const i=e.object;"model"===(null==i?void 0:i.assetType)&&i.modelObject&&this._viewer&&(i.modelObject.traverse((e=>{var t,n,i,r,s;if(e.userData._variantMaterials)for(const l of Object.values(e.userData._variantMaterials))(null==l?void 0:l.material)&&(l.material=(null===(i=null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getManager())||void 0===n?void 0:n.materials)||void 0===i?void 0:i.processMaterial(l.material,{}))||l.material);const o=null===(s=null===(r=e.userData)||void 0===r?void 0:r.__importData)||void 0===s?void 0:s[xh];if(!o)return;const a=o.names||[];for(const l of a)this.variants[l]||(this.variants[l]=[]),this.variants[l].push(e);delete e.userData.__importData[xh]})),null===(n=(t=this.uiConfig).uiRefresh)||void 0===n||n.call(t))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map((e=>e?{label:e}:{label:"none",value:""})),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const s=e.getPlugin(Ls);null===(t=null==s?void 0:s.importer)||void 0===t||t.addEventListener("loaderCreate",this._loaderCreate),null===(r=null===(i=null===(n=null==s?void 0:s.exporter)||void 0===n?void 0:n.getExporter("gltf","glb"))||void 0===i?void 0:i.extensions)||void 0===r||r.push(Th)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Eh(e)))}async onRemove(e){var t,n,i,r,s,o;e.scene.removeEventListener("addSceneObject",this._objectAdded);const a=e.getPlugin(Ls);null===(t=a.importer)||void 0===t||t.removeEventListener("loaderCreate",this._loaderCreate);const l=null===(r=null===(i=null===(n=a.exporter)||void 0===n?void 0:n.getExporter("gltf","glb"))||void 0===i?void 0:i.extensions)||void 0===r?void 0:r.indexOf(Th);return void 0!==l&&-1!==l&&(null===(o=null===(s=a.exporter.getExporter("gltf","glb"))||void 0===s?void 0:s.extensions)||void 0===o||o.splice(l,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,t=!1,n,i=!0){if(!t&&!n&&this.selectedVariant===e)return;if(!e)return;n||(this.selectedVariant=e);const r=n?Array.isArray(n)?n:[n]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const s of r){const t=new Set,n=n=>{var i,r;if(!n.userData._variantMaterials||t.has(n))return;const s=e?null===(i=n.userData._variantMaterials[e])||void 0===i?void 0:i.material:n.userData._originalMaterial;s&&(n.userData._originalMaterial||(n.userData._originalMaterial=n.material),null===(r=null==n?void 0:n.setMaterial)||void 0===r||r.call(n,s)),t.add(n)};i?s.traverse(n):n(s)}}}function Ph(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._ssBevel||(t._ssBevel={});const n=t._ssBevel;return n.hasSSBevel=!0,void 0===n.radius&&(n.radius=0),e.isMaterial&&(e.needsUpdate=!0),!0}Ih.PluginType="GLTFKHRMaterialVariantsPlugin",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([(0,t.onChange)(Ih.prototype._variantChanged)],Ih.prototype,"selectedVariant",void 0);let Rh=class extends ht{constructor(e,i,r,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new n.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},dpr:{value:1},cameraPositionWorld:{value:new n.Pa4(1,1,1)}},vertexShader:lo,fragmentShader:`\n\n            ${r}\n\n            ${co}\n\n            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;uniform float dpr;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;\n#include <common>\nfloat getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.*dpr;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}\n            \n            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(e,t,n)=>{var i,r;this.enabled&&(null===(r=null===(i=t.materialObject.userData)||void 0===i?void 0:i._ssBevel)||void 0===r?void 0:r.hasSSBevel)&&(e.fragmentShader=ot(e.fragmentShader,"#include <normal_fragment_maps>"," \n                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;\n                normal = normalize(normal);\n                //geometryNormal = normal;\n            "))},onObjectRender:(e,t,n)=>{var i,r;if(!this.enabled||!(null===(r=null===(i=t.materialObject.userData)||void 0===i?void 0:i._ssBevel)||void 0===r?void 0:r.hasSSBevel))return;const s=t.materialObject,o=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==o&&(this.materialExtension.extraUniforms.tSSBevelMap.value=o,s.needsUpdate=!0)},getUiConfig:e=>{const t={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._ssBevel)||void 0===t?void 0:t.hasSSBevel)||!1},set value(n){var i,r;n!==(null===(i=e.materialObject.userData._ssBevel)||void 0===i?void 0:i.hasSSBevel)&&(n?Ph(e.materialObject)||alert("Cannot add screen space bevel."):e.materialObject.userData._ssBevel&&(e.materialObject.userData._ssBevel.hasSSBevel=!1,e.materialObject.needsUpdate=!0),null===(r=t.uiRefresh)||void 0===r||r.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._ssBevel)||void 0===t?void 0:t.hasSSBevel)},property:[e.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return t},parsFragmentSnippet:(e,n)=>{var i,r;return this.enabled&&(null===(r=null===(i=null==n?void 0:n.materialObject.userData)||void 0===i?void 0:i._ssBevel)||void 0===r?void 0:r.hasSSBevel)?t.glsl`
            uniform sampler2D tSSBevelMap;
            ${uo}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:e=>{var t,n;return(this.enabled?"1":"0")+((null===(n=null===(t=e.materialObject.userData)||void 0===t?void 0:t._ssBevel)||void 0===n?void 0:n.hasSSBevel)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2},this._target=i,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new ct({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new n.FM8(1,1)},cameraPositionWorld:{value:new n.Pa4(1,1,1)}},vertexShader:lo,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new ct({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new n.FM8(.5,.5)},direction:{value:new n.FM8(.5,.5)}},vertexShader:lo,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(e,t,i,r,s){var o,a;if(!this.enabled)return;const l=e.baseRenderer,c={minFilter:n.wem,magFilter:n.wem,isAntialiased:!1,format:n.wk1,depthBuffer:!1,generateMipmaps:!1},u=l.getTempTarget(c);this._renderEdges(l,u),this._blurEdges(l,u),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),null===(o=this._viewerApp.getPlugin(At))||void 0===o||o.updateShaderProperties(this.material),null===(a=this._viewerApp.getPlugin(al))||void 0===a||a.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=u.texture,this.uniforms.dpr.value=this._viewerApp.renderer.displayCanvasScaling,super.render(e,this._target,u,r,s),l.releaseTempTarget(u)}_initsamples(){const e=[],t=1/8;return e.push(new n.FM8(-8,0).multiplyScalar(t)),e.push(new n.FM8(-6,-4).multiplyScalar(t)),e.push(new n.FM8(-3,-2).multiplyScalar(t)),e.push(new n.FM8(-2,-6).multiplyScalar(t)),e.push(new n.FM8(1,-1).multiplyScalar(t)),e.push(new n.FM8(2,-5).multiplyScalar(t)),e.push(new n.FM8(6,-7).multiplyScalar(t)),e.push(new n.FM8(5,-3).multiplyScalar(t)),e.push(new n.FM8(4,1).multiplyScalar(t)),e.push(new n.FM8(7,4).multiplyScalar(t)),e.push(new n.FM8(3,5).multiplyScalar(t)),e.push(new n.FM8(0,7).multiplyScalar(t)),e.push(new n.FM8(-1,3).multiplyScalar(t)),e.push(new n.FM8(-4,6).multiplyScalar(t)),e.push(new n.FM8(-7,8).multiplyScalar(t)),e.push(new n.FM8(-5,2).multiplyScalar(t)),e}_blurEdges(e,t){var i,r;const s={minFilter:n.wem,magFilter:n.wem,isAntialiased:!1,format:n.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},o=e.getTempTarget(s),a=(null===(i=t.texture.image)||void 0===i?void 0:i.width)||1,l=(null===(r=t.texture.image)||void 0===r?void 0:r.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new n.FM8(a,l),this._separableBlurMaterial.uniforms.colorTexture.value=t.texture,this._separableBlurMaterial.uniforms.direction.value=new n.FM8(1,0),e.blit(void 0,o,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new n.FM8(a/2,l/2),this._separableBlurMaterial.uniforms.colorTexture.value=o.texture,this._separableBlurMaterial.uniforms.direction.value=new n.FM8(0,1),e.blit(void 0,t,{material:this._separableBlurMaterial}),e.releaseTempTarget(o)}_renderEdges(e,t){var i,r,s,o;const a=(null===(i=t.texture.image)||void 0===i?void 0:i.width)||1,l=(null===(r=t.texture.image)||void 0===r?void 0:r.height)||1;this._edgeMaterial.uniforms.screenSize.value=new n.FM8(a,l),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),null===(s=this._viewerApp.getPlugin(At))||void 0===s||s.updateShaderProperties(this._edgeMaterial),null===(o=this._viewerApp.getPlugin(al))||void 0===o||o.updateShaderProperties(this._edgeMaterial),e.blit(void 0,t,{material:this._edgeMaterial})}};Rh=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([We("SSBevel")],Rh);class Dh extends yt{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Ls,At,al],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new kh(e)))}passCtor(e){var t,i;return this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:n.cLu,minFilter:n.TyD,magFilter:n.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,e.getPluginByType("debug"),new Rh(e.renderer,this._bevelTarget,null!==(i=null===(t=e.getPlugin(At))||void 0===t?void 0:t.getUnpackSnippet())&&void 0!==i?i:"",e)}async onAdded(e){var t,n,i,r,s,o,a,l;await super.onAdded(e);const c=e.getPlugin(Ls);return(null===(t=this.pass)||void 0===t?void 0:t.passObject.materialExtension)&&(null===(n=null==c?void 0:c.materials)||void 0===n||n.registerMaterialExtension(null===(i=this.pass)||void 0===i?void 0:i.passObject.materialExtension)),null===(r=null==c?void 0:c.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),null===(a=null===(o=null===(s=null==c?void 0:c.exporter)||void 0===s?void 0:s.getExporter("gltf","glb"))||void 0===o?void 0:o.extensions)||void 0===a||a.push(Bh),null===(l=e.getPlugin(At))||void 0===l||l.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,n,i;null===(e=this._viewer)||void 0===e||e.setDirty(),null===(i=null===(t=this.pass)||void 0===t?void 0:(n=t.passObject.materialExtension).setDirty)||void 0===i||i.call(n)}_update(e){var t,n;let i=this.enabled;if(i&&!this._lastEnabled){const e=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("NormalBufferPlugin");e&&!e.enabled&&(e.enabled=!0),e||null===(n=this._viewer)||void 0===n||n.console.error("SSBevelPlugin needs NormalBufferPlugin")}return this._lastEnabled=i,i}get uiConfig(){var e,n,i,r,s;const o=null!==(i=null===(n=null===(e=this.pass)||void 0===e?void 0:e.passObject)||void 0===n?void 0:n.uiConfig)&&void 0!==i?i:{};return null===(s=null===(r=o.children)||void 0===r?void 0:r.map((e=>(0,t.getOrCall)(e))))||void 0===s||s.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),o}updateGBuffer(e,t){var i,r,s;if(e instanceof n.Kj0&&(null===(i=e.material)||void 0===i?void 0:i.userData)){for(let e=3;e<8;e++)t.y=Ys(t.y,e);let n=(null===(r=e.material)||void 0===r?void 0:r.userData._ssBevel)?null===(s=e.material)||void 0===s?void 0:s.userData._ssBevel.radius:0;n=Math.min(n,31),n<<=3,t.y=t.y|n}}}Dh.PluginType="SSBevelPlugin",Dh.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class kh{constructor(e){this.parser=e,this.name=Dh.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Ph(t),t.userData._ssBevel=ce(i,t.userData._ssBevel,!1,{}),Promise.resolve()}}const Bh=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._ssBevel)return;if(!t.userData._ssBevel.hasSSBevel)return;n.extensions=n.extensions||{};const i=le(t.userData._ssBevel,!1);n.extensions[Dh.SSBEVEL_GLTF_EXTENSION]=i,e.extensionsUsed[Dh.SSBEVEL_GLTF_EXTENSION]=!0}});class Oh{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker"," \n            gl_FragColor = LinearTosRGB(gl_FragColor);\n            #glMarker\n        "))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class Lh extends qs{generateExtension(e){return new Oh}}Lh.PluginType="GammaCorrection";var Uh=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Nh=class extends _t{addTriplanarMapping(e){var t;const n=null===(t=e.materialObject)||void 0===t?void 0:t.userData;return!!n&&(n._triplanarMapping||(n._triplanarMapping={}),n._triplanarMapping.enable=!0,void 0===n._triplanarMapping.scaleFactor&&(n._triplanarMapping.scaleFactor=1),void 0===n._triplanarMapping.blendFactor&&(n._triplanarMapping.blendFactor=1),void 0===n._triplanarMapping.offsetFactor&&(n._triplanarMapping.offsetFactor=0),e.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Fh(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(e,i,r)=>{var s,o;if(!this.enabled||!(null===(o=null===(s=i.materialObject.userData)||void 0===s?void 0:s._triplanarMapping)||void 0===o?void 0:o.enable))return;const a=t.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;e.vertexShader=ot(e.vertexShader,"#include <common>",a,{prepend:!0});const l=t.glsl`
                // same as worldpos_vertex.glsl.js but added a !
                #if !(defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0)
                vec4 worldPosition = vec4( transformed, 1.0 );
                #ifdef USE_INSTANCING
                worldPosition = instanceMatrix * worldPosition;
                #endif
                worldPosition = modelMatrix * worldPosition;
                #endif
                
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz; 
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;e.vertexShader=ot(e.vertexShader,"#include <worldpos_vertex>",l,{append:!0});const c=t.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;e.fragmentShader=ot(e.fragmentShader,"#include <common>",c,{prepend:!0});const u=t.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;e.fragmentShader=ot(e.fragmentShader,"#include <bumpmap_pars_fragment>",u);let d=ot(n.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");e.fragmentShader=ot(e.fragmentShader,"#include <map_fragment>",d),d=ot(n.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),e.fragmentShader=ot(e.fragmentShader,"#include <roughnessmap_fragment>",d),d=ot(n.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),e.fragmentShader=ot(e.fragmentShader,"#include <metalnessmap_fragment>",d),d=ot(n.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),e.fragmentShader=ot(e.fragmentShader,"#include <normal_fragment_maps>",d),e.defines.USE_UV=""},onObjectRender:(e,t)=>{var n,i,r,s;const o=t.materialObject.userData;if(!(null===(n=null==o?void 0:o._triplanarMapping)||void 0===n?void 0:n.enable))return;const a=e;a.isMesh&&a.geometry&&(this._uniforms.triplanarScale.value=null===(i=o._triplanarMapping)||void 0===i?void 0:i.scaleFactor,this._uniforms.triplanarBlend.value=null===(r=o._triplanarMapping)||void 0===r?void 0:r.blendFactor,this._uniforms.triplanarOffset.value=null===(s=o._triplanarMapping)||void 0===s?void 0:s.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n;return(this.enabled?"1":"0")+((null===(n=null===(t=e.materialObject.userData)||void 0===t?void 0:t._triplanarMapping)||void 0===n?void 0:n.enable)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e;return[null===(e=this._viewer)||void 0===e?void 0:e.renderer]},getUiConfig:e=>{const t=this._viewer,n=this.addTriplanarMapping,i={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._triplanarMapping)||void 0===t?void 0:t.enable)||!1},set value(r){var s,o;r!==(null===(s=e.materialObject.userData._triplanarMapping)||void 0===s?void 0:s.enable)&&(r?n(e)||t.alert("Cannot add Triplanar mapping."):e.materialObject.userData._triplanarMapping&&(e.materialObject.userData._triplanarMapping.enable=!1,e.materialObject.needsUpdate=!0),null===(o=i.uiRefresh)||void 0===o||o.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._triplanarMapping)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._triplanarMapping)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._triplanarMapping)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var e,t,n;null===(t=(e=this.materialExtension).setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s;await super.onAdded(e);const o=e.getPlugin(Ls);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==o?void 0:o.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(jh)}async onRemove(e){var t,n,i,r;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};Nh.PluginType="TriplanarUVMappingPlugin",Nh.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",Uh([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],Nh.prototype,"enabled",void 0),Nh=Uh([We("Triplanar Mapping")],Nh);class Fh{constructor(e){this.parser=e,this.name=Nh.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];t.userData||(t.userData={});const r=t.userData;return r._triplanarMapping||(r._triplanarMapping={}),r._triplanarMapping.enable=!0,void 0===r._triplanarMapping.scaleFactor&&(r._triplanarMapping.scaleFactor=1),void 0===r._triplanarMapping.blendFactor&&(r._triplanarMapping.blendFactor=1),void 0===r._triplanarMapping.offsetFactor&&(r._triplanarMapping.offsetFactor=0),t.userData._triplanarMapping=ce(i,t.userData._triplanarMapping,!1,{}),Promise.resolve()}}const jh=e=>({writeMaterial:(t,n)=>{var i;if(!t.isMeshStandardMaterial||!(null===(i=t.userData._triplanarMapping)||void 0===i?void 0:i.enable))return;n.extensions=n.extensions||{};const r=le(t.userData._triplanarMapping,!1);n.extensions[Nh.TRIPLANAR_GLTF_EXTENSION]=r,e.extensionsUsed[Nh.TRIPLANAR_GLTF_EXTENSION]=!0}});var zh=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Gh=class extends _t{addLayeredMaterial(e){var t;const i=null===(t=e.materialObject)||void 0===t?void 0:t.userData;return!!i&&(i._layeredMaterial||(i._layeredMaterial={}),i._layeredMaterial.enable=!0,void 0===i._layeredMaterial.cutoff&&(i._layeredMaterial.cutoff=-.65),void 0===i._layeredMaterial.cavityColor&&(i._layeredMaterial.cavityColor=new n.Ilk(5789527)),void 0===i._layeredMaterial.cavityRoughness&&(i._layeredMaterial.cavityRoughness=.5),void 0===i._layeredMaterial.cavityMetalness&&(i._layeredMaterial.cavityMetalness=.5),void 0===i._layeredMaterial.cavityScale&&(i._layeredMaterial.cavityScale=1),void 0===i._layeredMaterial.stepSize&&(i._layeredMaterial.stepSize=5),e.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Vh(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this._uniforms={cutoff:{value:0},cavityColor:{value:new n.Ilk},cavityRoughness:{value:0},cavityMetalness:{value:0},cavityScale:{value:1},stepSize:{value:1}},this.materialExtension={shaderExtender:(e,i,r)=>{var s,o;if(!this.enabled||!(null===(o=null===(s=i.materialObject.userData)||void 0===s?void 0:s._layeredMaterial)||void 0===o?void 0:o.enable))return;const a=t.glsl`
                ${"uniform float cutoff;uniform vec3 cavityColor;uniform float cavityRoughness;uniform float cavityMetalness;uniform float cavityScale;uniform float stepSize;uniform sampler2D cavityMap;float getSSCurvature(in vec3 position,in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-stepSize*dx;vec3 xpos=n+stepSize*dx;vec3 yneg=n-stepSize*dy;vec3 ypos=n+stepSize*dy;float depth=length(position);float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x)*4./depth;return curvature;}"}
            `;e.fragmentShader=ot(e.fragmentShader,"#include <common>",a,{prepend:!0});const l=t.glsl`
                material.roughness = min( material.roughness, 1.0 );
                float curvature = getSSCurvature(vViewPosition, normal);
                float smoothCurvature = smoothstep(0., 1., curvature - cutoff);
                material.roughness = min( material.roughness, 1.0 );
                curvature = curvature * cavityScale;
                smoothCurvature = smoothCurvature * cavityScale;
                smoothCurvature = min(smoothCurvature, 1.);
                vec3 finalCavityColor = mix(cavityColor, cavityColor*0.5, vec3(smoothCurvature));
                material.roughness = mix(cavityRoughness, material.roughness, smoothCurvature);
                material.diffuseColor = mix(finalCavityColor, material.diffuseColor, smoothCurvature);
            `,c=t.glsl`
                material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
                material.specularColor = mix(material.specularColor, finalCavityColor, (1. - smoothCurvature) * cavityMetalness);
            `;let u=n.WdD.lights_physical_fragment.replace("material.roughness = min( material.roughness, 1.0 );",l);u=u.replace("material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );",c),e.fragmentShader=ot(e.fragmentShader,"#include <lights_physical_fragment>",u);const d=t.glsl`
                vec3 debugCurvatureColor = vec3(0., 0., 1.);
                float _epsilon = 1e-4;
                vec3 green = vec3(0., 0., 0.);
                vec3 red = vec3(1., 1., 1.);
                //if(curvature > cutoff)debugCurvatureColor = green;
                //if(curvature < cutoff)debugCurvatureColor = red;
                // curvature /= 2.;
                // curvature = curvature * 0.5 + 0.5;
                debugCurvatureColor = smoothstep(green, red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(green, vec3(curvature - cutoff));
                //gl_FragColor = vec4(vec3(curvature), 1./16.);
            `;e.fragmentShader=ot(e.fragmentShader,"#include <dithering_fragment>",d),e.vertexUvs=!0},onObjectRender:(e,t)=>{var n,i,r,s,o,a,l;const c=t.materialObject.userData;if(!(null===(n=null==c?void 0:c._layeredMaterial)||void 0===n?void 0:n.enable))return;const u=e;u.isMesh&&u.geometry&&(this._uniforms.cutoff.value=null===(i=c._layeredMaterial)||void 0===i?void 0:i.cutoff,this._uniforms.cavityRoughness.value=null===(r=c._layeredMaterial)||void 0===r?void 0:r.cavityRoughness,this._uniforms.cavityMetalness.value=null===(s=c._layeredMaterial)||void 0===s?void 0:s.cavityMetalness,this._uniforms.cavityScale.value=null===(o=c._layeredMaterial)||void 0===o?void 0:o.cavityScale,this._uniforms.stepSize.value=null===(a=c._layeredMaterial)||void 0===a?void 0:a.stepSize,this._uniforms.cavityColor.value.copy(null===(l=c._layeredMaterial)||void 0===l?void 0:l.cavityColor))},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n;return(this.enabled?"1":"0")+((null===(n=null===(t=e.materialObject.userData)||void 0===t?void 0:t._layeredMaterial)||void 0===n?void 0:n.enable)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e;return[null===(e=this._viewer)||void 0===e?void 0:e.renderer]},getUiConfig:e=>{const t=this._viewer,n=this.addLayeredMaterial,i={type:"folder",label:"LayeredMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._layeredMaterial)||void 0===t?void 0:t.enable)||!1},set value(r){var s,o;r!==(null===(s=e.materialObject.userData._layeredMaterial)||void 0===s?void 0:s.enable)&&(r?n(e)||t.alert("Cannot add Triplanar mapping."):(e.materialObject.userData._layeredMaterial.enable=!1,e.materialObject.needsUpdate=!0),null===(o=i.uiRefresh)||void 0===o||o.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[-1,1],stepSize:.001,label:"cutoff",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._layeredMaterial)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._layeredMaterial,"cutoff"],onChange:this.setDirty}),()=>({type:"color",label:"color",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._layeredMaterial)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._layeredMaterial,"cavityColor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"roughness",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._layeredMaterial)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._layeredMaterial,"cavityRoughness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,20],stepSize:.01,label:"Scale",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._layeredMaterial)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._layeredMaterial,"cavityScale"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,100],stepSize:.01,label:"StepSize",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._layeredMaterial)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._layeredMaterial,"stepSize"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"metalness",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._layeredMaterial)||void 0===t?void 0:t.enable)},property:[e.materialObject.userData._layeredMaterial,"cavityMetalness"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s;await super.onAdded(e);const o=e.getPlugin(Ls);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==o?void 0:o.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(Hh)}async onRemove(e){var t,n,i,r;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};Gh.PluginType="LayeredMaterialPlugin",Gh.LAYERED_MATERIAL_GLTF_EXTENSION="WEBGI_materials_layered",zh([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],Gh.prototype,"enabled",void 0),Gh=zh([We("Layered Metal")],Gh);class Vh{constructor(e){this.parser=e,this.name=Gh.LAYERED_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];t.userData||(t.userData={});const r=t.userData;return r._layeredMaterial||(r._layeredMaterial={}),r._layeredMaterial.enable=!0,t.userData._layeredMaterial=ce(i,t.userData._layeredMaterial,!1,{}),Promise.resolve()}}const Hh=e=>({writeMaterial:(t,n)=>{var i;if(!t.isMeshStandardMaterial||!(null===(i=t.userData._layeredMaterial)||void 0===i?void 0:i.enable))return;n.extensions=n.extensions||{};const r=le(t.userData._layeredMaterial,!1);n.extensions[Gh.LAYERED_MATERIAL_GLTF_EXTENSION]=r,e.extensionsUsed[Gh.LAYERED_MATERIAL_GLTF_EXTENSION]=!0}});var Qh=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Wh=class extends _t{addClearcoatTint(e){return qh(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Xh(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[Ls],this._defines={},this._uniforms={ccTintColor:{value:new n.Ilk},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(e,t)=>{var n;return this.enabled&&(null===(n=null==t?void 0:t.materialObject.userData._clearcoatTint)||void 0===n?void 0:n.enableTint)&&t.materialObject.clearcoat>0?"\nuniform vec3 ccTintColor;\nuniform float ccThickness;\nuniform float ccIor;\nvec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {\n    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.\n    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law\n    return mix(vec3(1.0), tint, clearcoat);\n}\n        ":""},shaderExtender:(e,t,n)=>{var i;if(!(this.enabled&&(null===(i=null==t?void 0:t.materialObject.userData._clearcoatTint)||void 0===i?void 0:i.enableTint)&&t.materialObject.clearcoat>0))return;const r="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",s="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";e.fragmentShader.includes(s)&&e.fragmentShader.includes(r)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),e.fragmentShader=e.fragmentShader.replace(s,"\n            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );\n            "),e.fragmentShader=e.fragmentShader.replace(r,"\n            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);\n            "+r),e.defines.USE_UV=""},onObjectRender:(e,t)=>{var n;const i=null===(n=t.materialObject.userData)||void 0===n?void 0:n._clearcoatTint;if(!(null==i?void 0:i.enableTint))return;this._uniforms.ccTintColor.value.set(i.tintColor),this._uniforms.ccThickness.value=i.thickness,this._uniforms.ccIor.value=i.ior;const r=this.enabled?1:0;t.materialObject.defines.CLEARCOAT_TINT_ENABLED!==r&&(t.materialObject.defines.CLEARCOAT_TINT_ENABLED=r,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,n;return(this.enabled?"1":"0")+((null===(n=null===(t=e.materialObject.userData)||void 0===t?void 0:t._clearcoatTint)||void 0===n?void 0:n.enableTint)?"1":"0")+(e.materialObject.clearcoat>0?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)||!1},set value(i){var r,s;i!==(null===(r=e.materialObject.userData._clearcoatTint)||void 0===r?void 0:r.enableTint)&&(i?qh(e.materialObject)||t.alert("Cannot add clearcoat tint."):e.materialObject.userData._clearcoatTint&&(e.materialObject.userData._clearcoatTint.enableTint=!1,e.materialObject.needsUpdate=!0),null===(s=n.uiRefresh)||void 0===s||s.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)},property:[e.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)},property:[e.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)},property:[e.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var e,t,n;null===(t=(e=this.materialExtension).setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,r,s;await super.onAdded(e);const o=e.getPlugin(Ls);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(n=null==o?void 0:o.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(r=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===r?void 0:r.extensions)||void 0===s||s.push(Yh)}async onRemove(e){var t,n,i,r;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this.materialExtension),null===(r=null===(i=e.getPlugin(Ls))||void 0===i?void 0:i.importer)||void 0===r||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function qh(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._clearcoatTint||(t._clearcoatTint={});const n=t._clearcoatTint;return n.enableTint=!0,void 0===n.tintColor&&(n.tintColor=16777215),void 0===n.thickness&&(n.thickness=.1),void 0===n.ior&&(n.ior=1.5),e.isMaterial&&(e.needsUpdate=!0),!0}Wh.PluginType="ClearcoatTintPlugin",Wh.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",Qh([Oe("Enabled",(e=>({onChange:e.setDirty}))),re()],Wh.prototype,"enabled",void 0),Wh=Qh([We("ClearcoatTint Materials")],Wh);class Xh{constructor(e){this.parser=e,this.name=Wh.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),qh(t),ce(i,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const Yh=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._clearcoatTint)return;if(!t.userData._clearcoatTint.enableTint)return;n.extensions=n.extensions||{};const i=le(t.userData._clearcoatTint,!1);n.extensions[Wh.CLEARCOAT_TINT_GLTF_EXTENSION]=i,e.extensionsUsed[Wh.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class Kh{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:t,msg:n,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(n,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((n=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Jh=0,Zh=2;class $h{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class ep{constructor(e,t,n,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}new Uint8Array([0]);const tp=[171,75,84,88,32,50,48,187,13,10,26,10];function np(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}let ip,rp,sp;const op={env:{emscripten_notify_memory_growth:function(e){sp=new Uint8Array(rp.exports.memory.buffer)}}};class ap{init(){return ip||(ip="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+lp).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,op))).then(this._init):WebAssembly.instantiate(Buffer.from(lp,"base64"),op).then(this._init),ip)}_init(e){rp=e.instance,op.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!rp)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=rp.exports.malloc(n);sp.set(e,i),t=t||Number(rp.exports.ZSTD_findDecompressedSize(i,n));const r=rp.exports.malloc(t),s=rp.exports.ZSTD_decompress(r,t,i,n),o=sp.slice(r,r+s);return rp.exports.free(i),rp.exports.free(r),o}}const lp="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",cp=new WeakMap;let up,dp=0;class hp extends n.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Kh,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new n.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new n.hH6(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const r=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then((([e,t])=>{const n=hp.BasisWorker,i=["/* constants */","let _EngineFormat = "+JSON.stringify(hp.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(hp.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(hp.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),dp>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),dp++}return this.transcoderPending}load(e,t,i,r){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new n.hH6(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,(e=>{if(cp.has(e))return cp.get(e).promise.then(t).catch(r);this.createTexture(e).then((e=>t?t(e):null)).catch(r)}),i,r)}_createTextureFrom(e,t){const{faces:i,width:r,height:s,format:o,type:a,error:l,dfdTransferFn:c,dfdFlags:u}=e;if("error"===a)return Promise.reject(l);let d;if(6===t.faceCount)d=new n.EB7,d.image=i,d.format=o,d.type=n.ywz;else{const e=i[0].mipmaps;d=t.layerCount>1?new n.Z_g(e,r,s,t.layerCount,o,n.ywz):new n.EB7(e,r,s,o,n.ywz)}return d.minFilter=1===i[0].mipmaps.length?n.wem:n.D1R,d.magFilter=n.wem,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=2===c?n.KI_:n.aCh,d.premultiplyAlpha=!!(1&u),d}async createTexture(e,t={}){const n=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,tp.length);if(t[0]!==tp[0]||t[1]!==tp[1]||t[2]!==tp[2]||t[3]!==tp[3]||t[4]!==tp[4]||t[5]!==tp[5]||t[6]!==tp[6]||t[7]!==tp[7]||t[8]!==tp[8]||t[9]!==tp[9]||t[10]!==tp[10]||t[11]!==tp[11])throw new Error("Missing KTX 2.0 identifier.");const n=new $h,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new ep(e,tp.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();const s=r._nextUint32();n.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),u=r._nextUint64(),d=r._nextUint64(),h=new ep(e,tp.length+i,3*s*8,!0);for(let k=0;k<s;k++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+h._nextUint64(),h._nextUint64()),uncompressedByteLength:h._nextUint64()});const p=new ep(e,o,a,!0),f={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let k=0;k<m;k++){const e={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=p._nextInt32(),e.sampleUpper=p._nextInt32()):(e.sampleLower=p._nextUint32(),e.sampleUpper=p._nextUint32()),f.samples[k]=e}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(f);const g=new ep(e,l,c,!0);for(;g._offset<c;){const e=g._nextUint32(),t=g._scan(e),i=np(t),r=g._scan(e-t.byteLength);n.keyValue[i]=i.match(/^ktx/i)?np(r):r,g._offset%4&&g._skip(4-g._offset%4)}if(d<=0)return n;const _=new ep(e,u,d,!0),v=_._nextUint16(),y=_._nextUint16(),b=_._nextUint32(),A=_._nextUint32(),w=_._nextUint32(),x=_._nextUint32(),E=[];for(let k=0;k<s;k++)E.push({imageFlags:_._nextUint32(),rgbSliceByteOffset:_._nextUint32(),rgbSliceByteLength:_._nextUint32(),alphaSliceByteOffset:_._nextUint32(),alphaSliceByteLength:_._nextUint32()});const C=u+_._offset,S=C+b,M=S+A,T=M+w,I=new Uint8Array(e.buffer,e.byteOffset+C,b),P=new Uint8Array(e.buffer,e.byteOffset+S,A),R=new Uint8Array(e.buffer,e.byteOffset+M,w),D=new Uint8Array(e.buffer,e.byteOffset+T,x);return n.globalData={endpointCount:v,selectorCount:y,imageDescs:E,endpointsData:I,selectorsData:P,tablesData:R,extendedData:D},n}(new Uint8Array(e));if(0!==n.vkFormat){const e=[],t=[];for(let r=0;r<n.levels.length;r++)t.push(gp(n,r).then((function(t){e[r]=t})));await Promise.all(t);const i=e[0];return i.mipmaps=e.map((e=>({data:e.source.data,width:e.source.data.width,height:e.source.data.height,depth:e.source.data.depth}))),i}const i=t,r=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e]))).then((e=>this._createTextureFrom(e.data,n)));return cp.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),dp--,this}}hp.BasisFormat={ETC1S:0,UASTC_4x4:1},hp.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},hp.EngineFormat={RGBAFormat:n.wk1,RGBA_ASTC_4x4_Format:n.ptH,RGBA_BPTC_Format:n.bsb,RGBA_ETC2_EAC_Format:n.ekQ,RGBA_PVRTC_4BPPV1_Format:n.eaV,RGBA_S3TC_DXT5_Format:n.ILR,RGB_ETC1_Format:n.fto,RGB_ETC2_Format:n.l0P,RGB_PVRTC_4BPPV1_Format:n._AM,RGB_S3TC_DXT1_Format:n.wuA},hp.BasisWorker="function () {\n\n\tlet config;\n\tlet transcoderPending;\n\tlet BasisModule;\n\n\tconst EngineFormat = _EngineFormat; // eslint-disable-line no-undef\n\tconst TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef\n\tconst BasisFormat = _BasisFormat; // eslint-disable-line no-undef\n\n\tself.addEventListener( 'message', function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tconfig = message.config;\n\t\t\t\tinit( message.transcoderBinary );\n\t\t\t\tbreak;\n\n\t\t\tcase 'transcode':\n\t\t\t\ttranscoderPending.then( () => {\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst { faces, buffers, width, height, hasAlpha, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );\n\n\t\t\t\t\t\tself.postMessage( { type: 'transcode', id: message.id, faces, width, height, hasAlpha, format, dfdTransferFn, dfdFlags }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t} );\n\n\tfunction init( wasmBinary ) {\n\n\t\ttranscoderPending = new Promise( ( resolve ) => {\n\n\t\t\tBasisModule = { wasmBinary, onRuntimeInitialized: resolve };\n\t\t\tBASIS( BasisModule ); // eslint-disable-line no-undef\n\n\t\t} ).then( () => {\n\n\t\t\tBasisModule.initializeBasis();\n\n\t\t\tif ( BasisModule.KTX2File === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\tfunction transcode( buffer ) {\n\n\t\tconst ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );\n\n\t\tfunction cleanup() {\n\n\t\t\tktx2File.close();\n\t\t\tktx2File.delete();\n\n\t\t}\n\n\t\tif ( ! ktx2File.isValid() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file' );\n\n\t\t}\n\n\t\tconst basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;\n\t\tconst width = ktx2File.getWidth();\n\t\tconst height = ktx2File.getHeight();\n\t\tconst layerCount = ktx2File.getLayers() || 1;\n\t\tconst levelCount = ktx2File.getLevels();\n\t\tconst faceCount = ktx2File.getFaces();\n\t\tconst hasAlpha = ktx2File.getHasAlpha();\n\t\tconst dfdTransferFn = ktx2File.getDFDTransferFunc();\n\t\tconst dfdFlags = ktx2File.getDFDFlags();\n\n\t\tconst { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );\n\n\t\tif ( ! width || ! height || ! levelCount ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid texture' );\n\n\t\t}\n\n\t\tif ( ! ktx2File.startTranscoding() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader: .startTranscoding failed' );\n\n\t\t}\n\n\t\tconst faces = [];\n\t\tconst buffers = [];\n\n\t\tfor ( let face = 0; face < faceCount; face ++ ) {\n\n\t\t\tconst mipmaps = [];\n\n\t\t\tfor ( let mip = 0; mip < levelCount; mip ++ ) {\n\n\t\t\t\tconst layerMips = [];\n\n\t\t\t\tlet mipWidth, mipHeight;\n\n\t\t\t\tfor ( let layer = 0; layer < layerCount; layer ++ ) {\n\n\t\t\t\t\tconst levelInfo = ktx2File.getImageLevelInfo( mip, layer, face );\n\n\t\t\t\t\tif ( face === 0 && mip === 0 && layer === 0 && ( levelInfo.origWidth % 4 !== 0 || levelInfo.origHeight % 4 !== 0 ) ) {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( levelCount > 1 ) {\n\n\t\t\t\t\t\tmipWidth = levelInfo.origWidth;\n\t\t\t\t\t\tmipHeight = levelInfo.origHeight;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// Handles non-multiple-of-four dimensions in textures without mipmaps. Textures with\n\t\t\t\t\t\t// mipmaps must use multiple-of-four dimensions, for some texture formats and APIs.\n\t\t\t\t\t\t// See mrdoob/three.js#25908.\n\t\t\t\t\t\tmipWidth = levelInfo.width;\n\t\t\t\t\t\tmipHeight = levelInfo.height;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );\n\t\t\t\t\tconst status = ktx2File.transcodeImage( dst, mip, layer, face, transcoderFormat, 0, - 1, - 1 );\n\n\t\t\t\t\tif ( ! status ) {\n\n\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\tthrow new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tlayerMips.push( dst );\n\n\t\t\t\t}\n\n\t\t\t\tconst mipData = concat( layerMips );\n\n\t\t\t\tmipmaps.push( { data: mipData, width: mipWidth, height: mipHeight } );\n\t\t\t\tbuffers.push( mipData.buffer );\n\n\t\t\t}\n\n\t\t\tfaces.push( { mipmaps, width, height, format: engineFormat } );\n\n\t\t}\n\n\t\tcleanup();\n\n\t\treturn { faces, buffers, width, height, hasAlpha, format: engineFormat, dfdTransferFn, dfdFlags };\n\n\t}\n\n\t//\n\n\t// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),\n\t// device capabilities, and texture dimensions. The list below ranks the formats separately\n\t// for ETC1S and UASTC.\n\t//\n\t// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at\n\t// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently\n\t// chooses RGBA32 only as a last resort and does not expose that option to the caller.\n\tconst FORMAT_OPTIONS = [\n\t\t{\n\t\t\tif: 'astcSupported',\n\t\t\tbasisFormat: [ BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],\n\t\t\tpriorityETC1S: Infinity,\n\t\t\tpriorityUASTC: 1,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'bptcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],\n\t\t\tpriorityETC1S: 3,\n\t\t\tpriorityUASTC: 2,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'dxtSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],\n\t\t\tpriorityETC1S: 4,\n\t\t\tpriorityUASTC: 5,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc2Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],\n\t\t\tpriorityETC1S: 1,\n\t\t\tpriorityUASTC: 3,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc1Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC1_Format ],\n\t\t\tpriorityETC1S: 2,\n\t\t\tpriorityUASTC: 4,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'pvrtcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],\n\t\t\tengineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],\n\t\t\tpriorityETC1S: 5,\n\t\t\tpriorityUASTC: 6,\n\t\t\tneedsPowerOfTwo: true,\n\t\t},\n\t];\n\n\tconst ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {\n\n\t\treturn a.priorityETC1S - b.priorityETC1S;\n\n\t} );\n\tconst UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {\n\n\t\treturn a.priorityUASTC - b.priorityUASTC;\n\n\t} );\n\n\tfunction getTranscoderFormat( basisFormat, width, height, hasAlpha ) {\n\n\t\tlet transcoderFormat;\n\t\tlet engineFormat;\n\n\t\tconst options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;\n\n\t\tfor ( let i = 0; i < options.length; i ++ ) {\n\n\t\t\tconst opt = options[ i ];\n\n\t\t\tif ( ! config[ opt.if ] ) continue;\n\t\t\tif ( ! opt.basisFormat.includes( basisFormat ) ) continue;\n\t\t\tif ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;\n\t\t\tif ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;\n\n\t\t\ttranscoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];\n\t\t\tengineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];\n\n\t\t\treturn { transcoderFormat, engineFormat };\n\n\t\t}\n\n\t\tconsole.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );\n\n\t\ttranscoderFormat = TranscoderFormat.RGBA32;\n\t\tengineFormat = EngineFormat.RGBAFormat;\n\n\t\treturn { transcoderFormat, engineFormat };\n\n\t}\n\n\tfunction isPowerOfTwo( value ) {\n\n\t\tif ( value <= 2 ) return true;\n\n\t\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\n\n\t}\n\n\t/** Concatenates N byte arrays. */\n\tfunction concat( arrays ) {\n\n\t\tif ( arrays.length === 1 ) return arrays[ 0 ];\n\n\t\tlet totalByteLength = 0;\n\n\t\tfor ( let i = 0; i < arrays.length; i ++ ) {\n\n\t\t\tconst array = arrays[ i ];\n\t\t\ttotalByteLength += array.byteLength;\n\n\t\t}\n\n\t\tconst result = new Uint8Array( totalByteLength );\n\n\t\tlet byteOffset = 0;\n\n\t\tfor ( let i = 0; i < arrays.length; i ++ ) {\n\n\t\t\tconst array = arrays[ i ];\n\t\t\tresult.set( array, byteOffset );\n\n\t\t\tbyteOffset += array.byteLength;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}";const pp={109:n.wk1,97:n.wk1,37:n.wk1,43:n.wk1,103:n.av9,83:n.av9,16:n.av9,22:n.av9,100:n.hEm,76:n.hEm,15:n.hEm,9:n.hEm},fp={109:n.VzW,97:n.cLu,37:n.ywz,43:n.ywz,103:n.VzW,83:n.cLu,16:n.ywz,22:n.ywz,100:n.VzW,76:n.cLu,15:n.ywz,9:n.ywz},mp={43:n.KI_,22:n.KI_,15:n.KI_};async function gp(e,t=0){const{vkFormat:i}=e,r=Math.max(1,e.pixelWidth>>t),s=Math.max(1,e.pixelHeight>>t),o=Math.max(1,e.pixelDepth>>t);if(void 0===pp[i])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const a=e.levels[t];let l,c;if(e.supercompressionScheme===Jh)l=a.levelData;else{if(e.supercompressionScheme!==Zh)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");up||(up=new Promise((async e=>{const t=new ap;await t.init(),e(t)}))),l=(await up).decode(a.levelData,a.uncompressedByteLength)}c=fp[i]===n.VzW?new Float32Array(l.buffer,l.byteOffset,l.byteLength/Float32Array.BYTES_PER_ELEMENT):fp[i]===n.cLu?new Uint16Array(l.buffer,l.byteOffset,l.byteLength/Uint16Array.BYTES_PER_ELEMENT):l;const u=0===o?new n.IEO(c,r,s):new n.JUT(c,r,s,o);return u.type=fp[i],u.format=pp[i],u.colorSpace=mp[i]||n.aCh,u.needsUpdate=!0,Promise.resolve(u)}const _p="KHR_texture_basisu";class vp extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls]}async onAdded(e){var t,n,i,r,s,o;this._importer||(this._importer=new Nt(class extends hp{constructor(t){super(t),this.setTranscoderPath(vp.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(e,t){const n=new Uint8Array(e.slice(0)),i=await super.createTexture(e,t);return i.source._sourceImgBuffer=n,i.userData.mimeType="image/ktx2",i.toJSON=e=>he(i,e,i.name,"image/ktx2"),i.clone=()=>{throw new Error("ktx2 texture cloning not supported")},i}},["ktx2"],!1)),null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n||n.Importers.push(this._importer),null===(o=null===(s=null===(r=null===(i=e.getManager())||void 0===i?void 0:i.exporter)||void 0===r?void 0:r.getExporter("gltf","glb"))||void 0===s?void 0:s.extensions)||void 0===o||o.push(yp)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&(null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n?void 0:n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}vp.PluginType="KTX2LoadPlugin",vp.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const yp=e=>({writeTexture:(t,n)=>{if("image/ktx2"!==t.userData.mimeType)return;if(void 0!==n.source&&null!==n.source)return void console.warn("ktx2 export: source already set");const i=t.source._sourceImgBuffer||t.userData.__sourceBuffer;if(!i)return void console.warn("ktx2 export: no source buffer for ktx2");n.extensions=n.extensions||{};const r={},s=new Blob([i],{type:"image/ktx2"});r.source=e.processImageBlob(s,t),n.extensions[_p]=r,e.extensionsUsed[_p]=!0}});class bp extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postRender)}addTexture(e,t,r,s,o,a="postRender",l=!1){var c;this._generators.has(a)||this._generators.set(a,[]),null===(c=this._generators.get(a))||void 0===c||c.push({key:e,fn:t,rect:r?[...r]:void 0,frag:o||s||l?new n.jyz({vertexShader:i.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:null!=o?o:`\n        #include <common>\n        #include <packing>\n        uniform float opacity;\n\t\tuniform ${l?"samplerCube":"sampler2D"} tDiffuse;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvec4 texel = ${l?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};\n\t\t\t${null!=s?s:""}\n\t\t\tgl_FragColor = opacity * texel;\n\t\t}\n            `}):void 0})}removeTexture(e,t="postRender"){var n,i;this._generators.set(t,null!==(i=null===(n=this._generators.get(t))||void 0===n?void 0:n.filter((t=>t.key!==e)))&&void 0!==i?i:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var t;const n=this._viewer,i=null==n?void 0:n.renderer;i&&n&&(null===(t=this._generators.get(e))||void 0===t||t.forEach((({key:e,fn:t,rect:r,frag:s})=>{const o=t(n);if(o){if(o.image&&r){const e=o.image.width/o.image.height;r[2]<1&&r[3]<1&&(r[2]=200),r[2]<1&&(r[2]=r[3]*e),r[3]<1&&(r[3]=r[2]/e)}i.blit(o,void 0,{viewport:r,clear:!1,material:s})}})))}}bp.PluginType="debug";class Ap extends n.aNw{constructor(e){super(e)}load(e,t,i,r){const s=this,o=""===this.path?n.Zp0.extractUrlBase(e):this.path,a=new n.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(s.parse(n,o))}catch(t){r?r(t):console.error(t),s.manager.itemError(e)}}),i,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split("\n");let i={};const r=/\s+/,s={};for(let a=0;a<n.length;a++){let e=n[a];if(e=e.trim(),0===e.length||"#"===e.charAt(0))continue;const t=e.indexOf(" ");let o=t>=0?e.substring(0,t):e;o=o.toLowerCase();let l=t>=0?e.substring(t+1):"";if(l=l.trim(),"newmtl"===o)i={name:l},s[l]=i;else if("ka"===o||"kd"===o||"ks"===o||"ke"===o){const e=l.split(r,3);i[o]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[o]=l}const o=new wp(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(s),o}}class wp{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:n.Wl3,this.wrap=void 0!==this.options.wrap?this.options.wrap:n.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const i=e[n],r={};t[n]=r;for(const e in i){let t=!0,n=i[e];const s=e.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(t=!1)}t&&(r[s]=n)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return void 0===this.materials[e]&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,i=this.materialsInfo[e],r={name:e,side:this.side};async function s(e,i){if(r[e])return;const s=t.getTextureParams(i,r);return new Promise(((i,o)=>{let a=!1,l=()=>!a&&(a=!0)&&i();const c=t.loadTexture((u=t.baseUrl,"string"!=typeof(d=s.url)||""===d?"":/^https?:\/\//i.test(d)?d:u+d),void 0,(t=>{r[e]=t,l()}),void 0,l);var u,d;setTimeout(l,50),c.repeat.copy(s.scale),c.offset.copy(s.offset),c.wrapS=t.wrap,c.wrapT=t.wrap,"map"!==e&&"emissiveMap"!==e||(c.colorSpace=n.KI_)}))}const o=Array.from(Object.keys(i||{}));let a=o.includes("d")||o.includes("D");for(const l of o){const e=i[l];let t;if(""!==e)switch(l.toLowerCase()){case"kd":r.color=(new n.Ilk).fromArray(e).convertSRGBToLinear();break;case"ks":r.specular=(new n.Ilk).fromArray(e).convertSRGBToLinear();break;case"ke":r.emissive=(new n.Ilk).fromArray(e).convertSRGBToLinear();break;case"map_kd":await s("map",e);break;case"map_ks":await s("specularMap",e);break;case"map_ke":await s("emissiveMap",e);break;case"norm":await s("normalMap",e);break;case"map_bump":case"bump":await s("bumpMap",e);break;case"map_d":await s("alphaMap",e),r.transparent=!0;break;case"ns":r.shininess=parseFloat(e);break;case"d":t=parseFloat(e),t<1&&(r.opacity=t,r.transparent=!0);break;case"tr":if(a)break;t=parseFloat(e),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(r.opacity=1-t,r.transparent=!0)}}return this.materials[e]=new n.xoR(r),this.materials[e]}getTextureParams(e,t){const i={scale:new n.FM8(1,1),offset:new n.FM8(0,0)},r=e.split(/\s+/);let s;return s=r.indexOf("-bm"),s>=0&&(t.bumpScale=parseFloat(r[s+1]),r.splice(s,2)),s=r.indexOf("-s"),s>=0&&(i.scale.set(parseFloat(r[s+1]),parseFloat(r[s+2])),r.splice(s,4)),s=r.indexOf("-o"),s>=0&&(i.offset.set(parseFloat(r[s+1]),parseFloat(r[s+2])),r.splice(s,4)),i.url=r.join(" ").trim(),i}loadTexture(e,t,i,r,s){const o=void 0!==this.manager?this.manager:n.tEQ;let a=o.getHandler(e);null===a&&(a=new n.dpR(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const l=a.load(e,i,r,s);return void 0!==t&&(l.mapping=t),l}}const xp=/^[og]\s*(.+)?/,Ep=/^mtllib /,Cp=/^usemtl /,Sp=/^usemap /,Mp=/\s+/,Tp=new n.Pa4,Ip=new n.Pa4,Pp=new n.Pa4,Rp=new n.Pa4,Dp=new n.Pa4,kp=new n.Ilk;function Bp(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){const e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,r=this.object.geometry.normals;Tp.fromArray(i,e),Ip.fromArray(i,t),Pp.fromArray(i,n),Dp.subVectors(Pp,Ip),Rp.subVectors(Tp,Ip),Dp.cross(Rp),Dp.normalize(),r.push(Dp.x,Dp.y,Dp.z),r.push(Dp.x,Dp.y,Dp.z),r.push(Dp.x,Dp.y,Dp.z)},addColor:function(e,t,n){const i=this.colors,r=this.object.geometry.colors;void 0!==i[e]&&r.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&r.push(i[t+0],i[t+1],i[t+2]),void 0!==i[n]&&r.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,r,s,o,a,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),d=this.parseVertexIndex(t,c),h=this.parseVertexIndex(n,c);if(this.addVertex(u,d,h),this.addColor(u,d,h),void 0!==o&&""!==o){const e=this.normals.length;u=this.parseNormalIndex(o,e),d=this.parseNormalIndex(a,e),h=this.parseNormalIndex(l,e),this.addNormal(u,d,h)}else this.addFaceNormal(u,d,h);if(void 0!==i&&""!==i){const e=this.uvs.length;u=this.parseUVIndex(i,e),d=this.parseUVIndex(r,e),h=this.parseUVIndex(s,e),this.addUV(u,d,h),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let r=0,s=e.length;r<s;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(let r=0,s=t.length;r<s;r++)this.addUVLine(this.parseUVIndex(t[r],i))}};return e.startObject("",!1),e}class Op extends n.aNw{constructor(e){super(e),this.materials=null}load(e,t,i,r){const s=this,o=new n.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(async function(n){try{t(await s.parse(n))}catch(t){r?r(t):console.error(t),s.manager.itemError(e)}}),i,r)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new Bp;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const i=e.split("\n");let r=[];for(let n=0,o=i.length;n<o;n++){const e=i[n].trimStart();if(0===e.length)continue;const s=e.charAt(0);if("#"!==s)if("v"===s){const n=e.split(Mp);switch(n[0]){case"v":t.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),n.length>=7?(kp.setRGB(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])).convertSRGBToLinear(),t.colors.push(kp.r,kp.g,kp.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case"vt":t.uvs.push(parseFloat(n[1]),parseFloat(n[2]))}}else if("f"===s){const n=e.slice(1).trim().split(Mp),i=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];if(t.length>0){const e=t.split("/");i.push(e)}}const r=i[0];for(let e=1,s=i.length-1;e<s;e++){const n=i[e],s=i[e+1];t.addFace(r[0],n[0],s[0],r[1],n[1],s[1],r[2],n[2],s[2])}}else if("l"===s){const n=e.substring(1).trim().split(" ");let i=[];const r=[];if(-1===e.indexOf("/"))i=n;else for(let e=0,t=n.length;e<t;e++){const t=n[e].split("/");""!==t[0]&&i.push(t[0]),""!==t[1]&&r.push(t[1])}t.addLineGeometry(i,r)}else if("p"===s){const n=e.slice(1).trim().split(" ");t.addPointGeometry(n)}else if(null!==(r=xp.exec(e))){const e=(" "+r[0].slice(1).trim()).slice(1);t.startObject(e)}else if(Cp.test(e))t.object.startMaterial(e.substring(7).trim(),t.materialLibraries);else if(Ep.test(e)){t.materialLibraries.push(e.substring(7).trim());const n=e.substring(7).trim(),i=this.manager.getHandler(n);if(i){const e=await i.loadAsync(n).catch((e=>{console.warn(e)}));e&&this.setMaterials(e)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(Sp.test(e))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===s){if(r=e.split(" "),r.length>1){const e=r[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const n=t.object.currentMaterial();n&&(n.smooth=t.object.smooth)}else{if("\0"===e)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+e+'"')}}t.finalize();const s=new n.ZAu;if(s.materialLibraries=[].concat(t.materialLibraries),1==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let o=0,a=t.objects.length;o<a;o++){const e=t.objects[o],i=e.geometry,r=e.materials,a="Line"===i.type,l="Points"===i.type;let c=!1;if(0===i.vertices.length)continue;const u=new n.u9r;u.setAttribute("position",new n.a$l(i.vertices,3)),i.normals.length>0&&u.setAttribute("normal",new n.a$l(i.normals,3)),i.colors.length>0&&(c=!0,u.setAttribute("color",new n.a$l(i.colors,3))),!0===i.hasUVIndices&&u.setAttribute("uv",new n.a$l(i.uvs,2));const d=[];for(let s=0,o=r.length;s<o;s++){const e=r[s],i=e.name+"_"+e.smooth+"_"+c;let o=t.materials[i];if(null!==this.materials)if(o=await this.materials.create(e.name),!a||!o||o instanceof n.nls){if(l&&o&&!(o instanceof n.UY4)){const e=new n.UY4({size:10,sizeAttenuation:!1});n.F5T.prototype.copy.call(e,o),e.color.copy(o.color),e.map=o.map,o=e}}else{const e=new n.nls;n.F5T.prototype.copy.call(e,o),e.color.copy(o.color),o=e}void 0===o&&(o=a?new n.nls:l?new n.UY4({size:1,sizeAttenuation:!1}):new n.xoR,o.name=e.name,o.flatShading=!e.smooth,o.vertexColors=c,t.materials[i]=o),d.push(o)}let h;if(d.length>1){for(let e=0,t=r.length;e<t;e++){const t=r[e];u.addGroup(t.groupStart,t.groupCount,e)}h=a?new n.ejS(u,d):l?new n.woe(u,d):new n.Kj0(u,d)}else h=a?new n.ejS(u,d[0]):l?new n.woe(u,d[0]):new n.Kj0(u,d[0]);h.name=e.name,s.add(h)}else if(t.vertices.length>0){const e=new n.UY4({size:1,sizeAttenuation:!1}),i=new n.u9r;i.setAttribute("position",new n.a$l(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(i.setAttribute("color",new n.a$l(t.colors,3)),e.vertexColors=!0);const r=new n.woe(i,e);s.add(r)}return s}}class Lp extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls],this._importer1=new Nt(Op,["obj"],!0),this._importer2=new Nt(Ap,["mtl"],!1)}async onAdded(e){var t,n,i,r;null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n||n.Importers.push(this._importer1),null===(r=null===(i=e.getManager())||void 0===i?void 0:i.importer)||void 0===r||r.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var t,n;(null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n?void 0:n.Importers)&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}Lp.PluginType="ObjMtlLoadPlugin";var Up=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(Up(""))}catch(fl){Up=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Np=Uint8Array,Fp=Uint16Array,jp=Uint32Array,zp=new Np([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Gp=new Np([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vp=new Np([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Hp=function(e,t){for(var n=new Fp(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new jp(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},Qp=Hp(zp,2),Wp=Qp[0],qp=Qp[1];Wp[28]=258,qp[258]=28;for(var Xp=Hp(Gp,0),Yp=Xp[0],Kp=Xp[1],Jp=new Fp(32768),Zp=0;Zp<32768;++Zp){var $p=(43690&Zp)>>>1|(21845&Zp)<<1;$p=(61680&($p=(52428&$p)>>>2|(13107&$p)<<2))>>>4|(3855&$p)<<4,Jp[Zp]=((65280&$p)>>>8|(255&$p)<<8)>>>1}var ef=function(e,t,n){for(var i=e.length,r=0,s=new Fp(t);r<i;++r)++s[e[r]-1];var o,a=new Fp(t);for(r=0;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){o=new Fp(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],u=t-e[r],d=a[e[r]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)o[Jp[d]>>>l]=c}else for(o=new Fp(i),r=0;r<i;++r)e[r]&&(o[r]=Jp[a[e[r]-1]++]>>>15-e[r]);return o},tf=new Np(288);for(Zp=0;Zp<144;++Zp)tf[Zp]=8;for(Zp=144;Zp<256;++Zp)tf[Zp]=9;for(Zp=256;Zp<280;++Zp)tf[Zp]=7;for(Zp=280;Zp<288;++Zp)tf[Zp]=8;var nf=new Np(32);for(Zp=0;Zp<32;++Zp)nf[Zp]=5;var rf=ef(tf,9,0),sf=ef(tf,9,1),of=ef(nf,5,0),af=ef(nf,5,1),lf=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},cf=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},uf=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},df=function(e){return(e/8|0)+(7&e&&1)},hf=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof Fp?Fp:e instanceof jp?jp:Np)(n-t);return i.set(e.subarray(t,n)),i},pf=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new Np(0);var r=!t||n,s=!n||n.i;n||(n={}),t||(t=new Np(3*i));var o=function(e){var n=t.length;if(e>n){var i=new Np(Math.max(2*n,e));i.set(t),t=i}},a=n.f||0,l=n.p||0,c=n.b||0,u=n.l,d=n.d,h=n.m,p=n.n,f=8*i;do{if(!u){n.f=a=cf(e,l,1);var m=cf(e,l+1,3);if(l+=3,!m){var g=e[(M=df(l)+4)-4]|e[M-3]<<8,_=M+g;if(_>i){if(s)throw"unexpected EOF";break}r&&o(c+g),t.set(e.subarray(M,_),c),n.b=c+=g,n.p=l=8*_;continue}if(1==m)u=sf,d=af,h=9,p=5;else{if(2!=m)throw"invalid block type";var v=cf(e,l,31)+257,y=cf(e,l+10,15)+4,b=v+cf(e,l+5,31)+1;l+=14;for(var A=new Np(b),w=new Np(19),x=0;x<y;++x)w[Vp[x]]=cf(e,l+3*x,7);l+=3*y;var E=lf(w),C=(1<<E)-1,S=ef(w,E,1);for(x=0;x<b;){var M,T=S[cf(e,l,C)];if(l+=15&T,(M=T>>>4)<16)A[x++]=M;else{var I=0,P=0;for(16==M?(P=3+cf(e,l,3),l+=2,I=A[x-1]):17==M?(P=3+cf(e,l,7),l+=3):18==M&&(P=11+cf(e,l,127),l+=7);P--;)A[x++]=I}}var R=A.subarray(0,v),D=A.subarray(v);h=lf(R),p=lf(D),u=ef(R,h,1),d=ef(D,p,1)}if(l>f){if(s)throw"unexpected EOF";break}}r&&o(c+131072);for(var k=(1<<h)-1,B=(1<<p)-1,O=l;;O=l){var L=(I=u[uf(e,l)&k])>>>4;if((l+=15&I)>f){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(L<256)t[c++]=L;else{if(256==L){O=l,u=null;break}var U=L-254;if(L>264){var N=zp[x=L-257];U=cf(e,l,(1<<N)-1)+Wp[x],l+=N}var F=d[uf(e,l)&B],j=F>>>4;if(!F)throw"invalid distance";if(l+=15&F,D=Yp[j],j>3&&(N=Gp[j],D+=uf(e,l)&(1<<N)-1,l+=N),l>f){if(s)throw"unexpected EOF";break}r&&o(c+131072);for(var z=c+U;c<z;c+=4)t[c]=t[c-D],t[c+1]=t[c+1-D],t[c+2]=t[c+2-D],t[c+3]=t[c+3-D];c=z}}n.l=u,n.p=O,n.b=c,u&&(a=1,n.m=h,n.d=d,n.n=p)}while(!a);return c==t.length?t:hf(t,0,c)},ff=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8},mf=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},gf=function(e,t){for(var n=[],i=0;i<e.length;++i)e[i]&&n.push({s:i,f:e[i]});var r=n.length,s=n.slice();if(!r)return[xf,0];if(1==r){var o=new Np(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,d=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=r-1;)a=n[n[c].f<n[d].f?c++:d++],l=n[c!=u&&n[c].f<n[d].f?c++:d++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var h=s[0].s;for(i=1;i<r;++i)s[i].s>h&&(h=s[i].s);var p=new Fp(h+1),f=_f(n[u-1],p,0);if(f>t){i=0;var m=0,g=f-t,_=1<<g;for(s.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));i<r;++i){var v=s[i].s;if(!(p[v]>t))break;m+=_-(1<<f-p[v]),p[v]=t}for(m>>>=g;m>0;){var y=s[i].s;p[y]<t?m-=1<<t-p[y]++-1:++i}for(;i>=0&&m;--i){var b=s[i].s;p[b]==t&&(--p[b],++m)}f=t}return[new Np(p),f]},_f=function(e,t,n){return-1==e.s?Math.max(_f(e.l,t,n+1),_f(e.r,t,n+1)):t[e.s]=n},vf=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Fp(++t),i=0,r=e[0],s=1,o=function(e){n[i++]=e},a=1;a<=t;++a)if(e[a]==r&&a!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(r);s=1,r=e[a]}return[n.subarray(0,i),t]},yf=function(e,t){for(var n=0,i=0;i<t.length;++i)n+=e[i]*t[i];return n},bf=function(e,t,n){var i=n.length,r=df(t+2);e[r]=255&i,e[r+1]=i>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var s=0;s<i;++s)e[r+s+4]=n[s];return 8*(r+4+i)},Af=function(e,t,n,i,r,s,o,a,l,c,u){ff(t,u++,n),++r[256];for(var d=gf(r,15),h=d[0],p=d[1],f=gf(s,15),m=f[0],g=f[1],_=vf(h),v=_[0],y=_[1],b=vf(m),A=b[0],w=b[1],x=new Fp(19),E=0;E<v.length;++E)x[31&v[E]]++;for(E=0;E<A.length;++E)x[31&A[E]]++;for(var C=gf(x,7),S=C[0],M=C[1],T=19;T>4&&!S[Vp[T-1]];--T);var I,P,R,D,k=c+5<<3,B=yf(r,tf)+yf(s,nf)+o,O=yf(r,h)+yf(s,m)+o+14+3*T+yf(x,S)+(2*x[16]+3*x[17]+7*x[18]);if(k<=B&&k<=O)return bf(t,u,e.subarray(l,l+c));if(ff(t,u,1+(O<B)),u+=2,O<B){I=ef(h,p,0),P=h,R=ef(m,g,0),D=m;var L=ef(S,M,0);for(ff(t,u,y-257),ff(t,u+5,w-1),ff(t,u+10,T-4),u+=14,E=0;E<T;++E)ff(t,u+3*E,S[Vp[E]]);u+=3*T;for(var U=[v,A],N=0;N<2;++N){var F=U[N];for(E=0;E<F.length;++E){var j=31&F[E];ff(t,u,L[j]),u+=S[j],j>15&&(ff(t,u,F[E]>>>5&127),u+=F[E]>>>12)}}}else I=rf,P=tf,R=of,D=nf;for(E=0;E<a;++E)if(i[E]>255){j=i[E]>>>18&31,mf(t,u,I[j+257]),u+=P[j+257],j>7&&(ff(t,u,i[E]>>>23&31),u+=zp[j]);var z=31&i[E];mf(t,u,R[z]),u+=D[z],z>3&&(mf(t,u,i[E]>>>5&8191),u+=Gp[z])}else mf(t,u,I[i[E]]),u+=P[i[E]];return mf(t,u,I[256]),u+P[256]},wf=new jp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),xf=new Np(0),Ef=function(){var e=1,t=0;return{p:function(n){for(var i=e,r=t,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)r+=i+=n[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}e=i,t=r},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},Cf=function(e,t,n,i,r){return function(e,t,n,i,r,s){var o=e.length,a=new Np(i+o+5*(1+Math.ceil(o/7e3))+r),l=a.subarray(i,a.length-r),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var d=u+65535;d<o?c=bf(l,c,e.subarray(u,d)):(l[u]=s,c=bf(l,c,e.subarray(u,o)))}else{for(var h=wf[t-1],p=h>>>13,f=8191&h,m=(1<<n)-1,g=new Fp(32768),_=new Fp(m+1),v=Math.ceil(n/3),y=2*v,b=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<y)&m},A=new jp(25e3),w=new Fp(288),x=new Fp(32),E=0,C=0,S=(u=0,0),M=0,T=0;u<o;++u){var I=b(u),P=32767&u,R=_[I];if(g[P]=R,_[I]=P,M<=u){var D=o-u;if((E>7e3||S>24576)&&D>423){c=Af(e,l,0,A,w,x,C,S,T,u-T,c),S=E=C=0,T=u;for(var k=0;k<286;++k)w[k]=0;for(k=0;k<30;++k)x[k]=0}var B=2,O=0,L=f,U=P-R&32767;if(D>2&&I==b(u-U))for(var N=Math.min(p,D)-1,F=Math.min(32767,u),j=Math.min(258,D);U<=F&&--L&&P!=R;){if(e[u+B]==e[u+B-U]){for(var z=0;z<j&&e[u+z]==e[u+z-U];++z);if(z>B){if(B=z,O=U,z>N)break;var G=Math.min(U,z-2),V=0;for(k=0;k<G;++k){var H=u-U+k+32768&32767,Q=H-g[H]+32768&32767;Q>V&&(V=Q,R=H)}}}U+=(P=R)-(R=g[P])+32768&32767}if(O){A[S++]=268435456|qp[B]<<18|Kp[O];var W=31&qp[B],q=31&Kp[O];C+=zp[W]+Gp[q],++w[257+W],++x[q],M=u+B,++E}else A[S++]=e[u],++w[e[u]]}}c=Af(e,l,s,A,w,x,C,S,T,u-T,c),!s&&7&c&&(c=bf(l,c+1,xf))}return hf(a,0,i+df(c)+r)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,i,!r)},Sf=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Mf=function(e,t){var n=t.level,i=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},Tf=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function If(e,t){return pf((Tf(e),e.subarray(2,-4)),t)}var Pf="undefined"!=typeof TextDecoder&&new TextDecoder;try{Pf.decode(xf,{stream:!0})}catch(fl){}function Rf(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,s=i,o=Math.floor((r+s)/2);for(;t<n[o]||t>=n[o+1];)t<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function Df(e,t){let n=1;for(let r=2;r<=e;++r)n*=r;let i=1;for(let r=2;r<=t;++r)i*=r;for(let r=2;r<=e-t;++r)i*=r;return n/i}class kf extends n.Hyl{constructor(e,t,i,r,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<i.length;++o){const e=i[o];this.controlPoints[o]=new n.Ltg(e.x,e.y,e.z,e.w)}}getPoint(e,t=new n.Pa4){const i=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(e,t,i,r){const s=Rf(e,r,t),o=function(e,t,n,i){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=t-i[e+1-a],o[a]=i[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=o[e+1],i=s[a-e],l=r[e]/(t+i);r[e]=n+t*l,n=i*l}r[a]=n}return r}(s,r,e,t),a=new n.Ltg(0,0,0,0);for(let n=0;n<=e;++n){const t=i[s-e+n],r=o[n],l=t.w*r;a.x+=t.x*l,a.y+=t.y*l,a.z+=t.z*l,a.w+=t.w*r}return a}(this.degree,this.knots,this.controlPoints,r);return 1!==s.w&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,t=new n.Pa4){const i=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=function(e,t,i,r,s){const o=function(e,t,i,r,s){const o=s<e?s:e,a=[],l=Rf(e,r,t),c=function(e,t,n,i,r){const s=[];for(let d=0;d<=n;++d)s[d]=0;const o=[];for(let d=0;d<=i;++d)o[d]=s.slice(0);const a=[];for(let d=0;d<=n;++d)a[d]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let d=1;d<=n;++d){l[d]=t-r[e+1-d],c[d]=r[e+d]-t;let n=0;for(let e=0;e<d;++e){const t=c[e+1],i=l[d-e];a[d][e]=t+i;const r=a[e][d-1]/a[d][e];a[e][d]=n+t*r,n=i*r}a[d][d]=n}for(let d=0;d<=n;++d)o[0][d]=a[d][n];for(let d=0;d<=n;++d){let e=0,t=1;const r=[];for(let i=0;i<=n;++i)r[i]=s.slice(0);r[0][0]=1;for(let s=1;s<=i;++s){let i=0;const l=d-s,c=n-s;d>=s&&(r[t][0]=r[e][0]/a[c+1][l],i=r[t][0]*a[l][c]);const u=d-1<=c?s-1:n-d;for(let n=l>=-1?1:-l;n<=u;++n)r[t][n]=(r[e][n]-r[e][n-1])/a[c+1][l+n],i+=r[t][n]*a[l+n][c];d<=c&&(r[t][s]=-r[e][s-1]/a[c+1][d],i+=r[t][s]*a[d][c]),o[s][d]=i;const h=e;e=t,t=h}}let u=n;for(let d=1;d<=i;++d){for(let e=0;e<=n;++e)o[d][e]*=u;u*=n-d}return o}(l,r,e,o,t),u=[];for(let n=0;n<i.length;++n){const e=i[n].clone(),t=e.w;e.x*=t,e.y*=t,e.z*=t,u[n]=e}for(let n=0;n<=o;++n){const t=u[l-e].clone().multiplyScalar(c[n][0]);for(let i=1;i<=e;++i)t.add(u[l-e+i].clone().multiplyScalar(c[n][i]));a[n]=t}for(let d=o+1;d<=s+1;++d)a[d]=new n.Ltg(0,0,0);return a}(e,t,i,r,s);return function(e){const t=e.length,i=[],r=[];for(let o=0;o<t;++o){const t=e[o];i[o]=new n.Pa4(t.x,t.y,t.z),r[o]=t.w}const s=[];for(let n=0;n<t;++n){const e=i[n].clone();for(let t=1;t<=n;++t)e.sub(s[n-t].clone().multiplyScalar(Df(n,t)*r[t]));s[n]=e.divideScalar(r[0])}return s}(o)}(this.degree,this.knots,this.controlPoints,r,1);return i.copy(s[1]).normalize(),i}}let Bf,Of,Lf;class Uf extends n.aNw{constructor(e){super(e)}load(e,t,i,r){const s=this,o=""===s.path?n.Zp0.extractUrlBase(e):s.path,a=new n.hH6(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,(function(n){try{t(s.parse(n,o))}catch(t){r?r(t):console.error(t),s.manager.itemError(e)}}),i,r)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===em(e,0,t.length)}(e))Bf=(new Gf).parse(e);else{const t=em(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let r=0;r<t.length;++r)if(i(1)===t[r])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Qf(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Qf(t));Bf=(new zf).parse(t)}const i=new n.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),r=new Nf(i,this.manager).parse(Bf);return Bf=null,Of=null,Lf=null,r}}class Nf{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Of=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new Ff).parse(i);return this.parseScene(i,r,n),Lf}parseConnections(){const e=new Map;return"Connections"in Bf&&Bf.Connections.connections.forEach((function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:i,relationship:r};e.get(n).parents.push(s),e.has(i)||e.set(i,{parents:[],children:[]});const o={ID:n,relationship:r};e.get(i).children.push(o)})),e}parseImages(){const e={},t={};if("Video"in Bf.Objects){const n=Bf.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"==typeof r.Content&&""!==r.Content;if(e||s){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Bf.Objects){const n=Bf.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=void 0!==r?r.value:0,a=void 0!==s?s.value:0;if(i.wrapS=0===o?n.rpg:n.uWy,i.wrapT=0===a?n.rpg:n.uWy,"Scaling"in e){const t=e.Scaling.value;i.repeat.x=t[0],i.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;i.offset.x=t[0],i.offset.y=t[1]}return i}loadTexture(e,t){let i;const r=this.textureLoader.path,s=Of.get(e.id).children;let o;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(i=t[s[0].ID],0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new n.xEZ):(t.setPath(this.textureLoader.path),o=t.load(i))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new n.xEZ):o=this.textureLoader.load(i);return this.textureLoader.setPath(r),o}parseMaterials(e){const t=new Map;if("Material"in Bf.Objects){const n=Bf.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const i=e.id,r=e.attrName;let s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!Of.has(i))return null;const o=this.parseParameters(e,t,i);let a;switch(s.toLowerCase()){case"phong":a=new n.xoR;break;case"lambert":a=new n.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new n.xoR}return a.setValues(o),a.name=r,a}parseParameters(e,t,i){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new n.Ilk).fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(r.color=(new n.Ilk).fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new n.Ilk).fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(r.emissive=(new n.Ilk).fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new n.Ilk).fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new n.Ilk).fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return Of.get(i).children.forEach((function(e){const i=e.relationship;switch(i){case"Bump":r.bumpMap=s.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,e.ID),void 0!==r.map&&(r.map.colorSpace=n.KI_);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,e.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,e.ID),void 0!==r.emissiveMap&&(r.emissiveMap.colorSpace=n.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,e.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,e.ID),void 0!==r.envMap&&(r.envMap.mapping=n.dSO,r.envMap.colorSpace=n.KI_);break;case"SpecularColor":r.specularMap=s.getTexture(t,e.ID),void 0!==r.specularMap&&(r.specularMap.colorSpace=n.KI_);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",i)}})),r}getTexture(e,t){return"LayeredTexture"in Bf.Objects&&t in Bf.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Of.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Bf.Objects){const n=Bf.Objects.Deformer;for(const i in n){const r=n[i],s=Of.get(parseInt(i));if("Skin"===r.attrType){const t=this.parseSkeleton(s,n);t.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(s,n),e.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach((function(e){const r=t[e.ID];if("Cluster"!==r.attrType)return;const s={ID:e.ID,indices:[],weights:[],transformLink:(new n.yGw).fromArray(r.TransformLink.a)};"Indexes"in r&&(s.indices=r.Indexes.a,s.weights=r.Weights.a),i.push(s)})),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],s=t[r.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=Of.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(o)}return n}parseScene(e,t,i){Lf=new n.ZAu;const r=this.parseModels(e.skeletons,t,i),s=Bf.Objects.Model,o=this;r.forEach((function(e){const t=s[e.ID];o.setLookAtProperties(e,t),Of.get(e.ID).parents.forEach((function(t){const n=r.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Lf.add(e)})),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),Lf.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Jf(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new jf).parse();1===Lf.children.length&&Lf.children[0].isGroup&&(Lf.children[0].animations=a,Lf=Lf.children[0]),Lf.animations=a}parseModels(e,t,i){const r=new Map,s=Bf.Objects.Model;for(const o in s){const a=parseInt(o),l=s[o],c=Of.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,i);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new n.N$j;break;default:u=new n.ZAu}u.name=l.attrName?n.iUV.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),r.set(a,u)}return r}buildSkeleton(e,t,i,r){let s=null;return e.parents.forEach((function(e){for(const o in t){const a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){const e=s;s=new n.N$j,s.matrixWorld.copy(t.transformLink),s.name=r?n.iUV.sanitizeNodeName(r):"",s.ID=i,a.bones[o]=s,null!==e&&s.add(e)}}))}})),s}createCamera(e){let t,i;if(e.children.forEach((function(e){const t=Bf.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)})),void 0===i)t=new n.Tme;else{let e=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(e=1);let r=1;void 0!==i.NearPlane&&(r=i.NearPlane.value/1e3);let s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);let o=window.innerWidth,a=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(o=i.AspectWidth.value,a=i.AspectHeight.value);const l=o/a;let c=45;void 0!==i.FieldOfView&&(c=i.FieldOfView.value);const u=i.FocalLength?i.FocalLength.value:null;switch(e){case 0:t=new n.cPb(c,l,r,s),null!==u&&t.setFocalLength(u);break;case 1:t=new n.iKG(-o/2,o/2,a/2,-a/2,r,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new n.Tme}}return t}createLight(e){let t,i;if(e.children.forEach((function(e){const t=Bf.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)})),void 0===i)t=new n.Tme;else{let e;e=void 0===i.LightType?0:i.LightType.value;let r=16777215;void 0!==i.Color&&(r=(new n.Ilk).fromArray(i.Color.value).convertSRGBToLinear());let s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);let o=0;void 0!==i.FarAttenuationEnd&&(o=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new n.cek(r,s,o,a);break;case 1:t=new n.Ox3(r,s);break;case 2:let e=Math.PI/3;void 0!==i.InnerAngle&&(e=n.M8C.degToRad(i.InnerAngle.value));let l=0;void 0!==i.OuterAngle&&(l=n.M8C.degToRad(i.OuterAngle.value),l=Math.max(l,1)),t=new n.PMe(r,s,o,e,l,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new n.cek(r,s)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,i){let r,s=null,o=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(s=t.get(e.ID)),i.has(e.ID)&&a.push(i.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new n.xoR({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach((function(e){e.vertexColors=!0})),s.FBX_Deformer?(r=new n.TUv(s,o),r.normalizeSkinWeights()):r=new n.Kj0(s,o),r}createCurve(e,t){const i=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new n.nls({color:3342591,linewidth:1});return new n.x12(i,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Zf(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Of.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const i=Bf.Objects.Model[t.ID];if("Lcl_Translation"in i){const t=i.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Lf.add(e.target)):e.lookAt((new n.Pa4).fromArray(t))}}}))}bindSkeleton(e,t,i){const r=this.parsePoseNodes();for(const s in e){const o=e[s];Of.get(parseInt(o.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;Of.get(t).parents.forEach((function(e){i.has(e.ID)&&i.get(e.ID).bind(new n.OdW(o.bones),r[e.ID])}))}}))}}parsePoseNodes(){const e={};if("Pose"in Bf.Objects){const t=Bf.Objects.Pose;for(const i in t)if("BindPose"===t[i].attrType&&t[i].NbPoseNodes>0){const r=t[i].PoseNode;Array.isArray(r)?r.forEach((function(t){e[t.Node]=(new n.yGw).fromArray(t.Matrix.a)})):e[r.Node]=(new n.yGw).fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Bf&&"AmbientColor"in Bf.GlobalSettings){const e=Bf.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],r=e[2];if(0!==t||0!==i||0!==r){const e=new n.Ilk(t,i,r).convertSRGBToLinear();Lf.add(new n.Mig(e,1))}}}}class Ff{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Bf.Objects){const n=Bf.Objects.Geometry;for(const i in n){const r=Of.get(parseInt(i)),s=this.parseGeometry(r,n[i],e);t.set(parseInt(i),s)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],s=e.parents.map((function(e){return Bf.Objects.Model[e.ID]}));if(0===s.length)return;const o=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const a=s[0],l={};"RotationOrder"in a&&(l.eulerOrder=Zf(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const c=Jf(l);return this.genGeometry(t,o,r,c)}genGeometry(e,t,i,r){const s=new n.u9r;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new n.a$l(a.vertex,3);if(l.applyMatrix4(r),s.setAttribute("position",l),a.colors.length>0&&s.setAttribute("color",new n.a$l(a.colors,3)),t&&(s.setAttribute("skinIndex",new n.qlB(a.weightsIndices,4)),s.setAttribute("skinWeight",new n.a$l(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const e=(new n.Vkp).getNormalMatrix(r),t=new n.a$l(a.normal,3);t.applyNormalMatrix(e),s.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){const i=0===t?"uv":`uv${t}`;s.setAttribute(i,new n.a$l(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,i){n!==e&&(s.addGroup(t,i-t,e),e=n,t=i)})),s.groups.length>0){const t=s.groups[s.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&s.addGroup(n,a.materialIndex.length-n,e)}0===s.groups.length&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,i,r),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,s=[],o=[],a=[],l=[],c=[],u=[];const d=this;return e.vertexIndices.forEach((function(h,p){let f,m=!1;h<0&&(h^=-1,m=!0);let g=[],_=[];if(s.push(3*h,3*h+1,3*h+2),e.color){const t=Xf(p,n,h,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){_.push(e.weight),g.push(e.id)})),_.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];_.forEach((function(n,i){let r=n,s=g[i];t.forEach((function(t,n,i){if(r>t){i[n]=r,r=t;const o=e[n];e[n]=s,s=o}}))})),g=e,_=t}for(;_.length<4;)_.push(0),g.push(0);for(let e=0;e<4;++e)c.push(_[e]),u.push(g[e])}if(e.normal){const t=Xf(p,n,h,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=Xf(p,n,h,e.material)[0],f<0&&(d.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach((function(e,t){const i=Xf(p,n,h,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])})),i++,m&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),d.genFace(t,e,s,f,o,a,l,c,u,i),n++,i=0,s=[],o=[],a=[],l=[],c=[],u=[])})),t}genFace(e,t,n,i,r,s,o,a,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(u-1)]),e.normal.push(r[3*(u-1)+1]),e.normal.push(r[3*(u-1)+2]),e.normal.push(r[3*u]),e.normal.push(r[3*u+1]),e.normal.push(r[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(u-1)]),e.uvs[n].push(o[n][2*(u-1)+1]),e.uvs[n].push(o[n][2*u]),e.uvs[n].push(o[n][2*u+1])}))}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=Bf.Objects.Geometry[n.geoID];void 0!==s&&r.genMorphGeometry(e,t,s,i,n.name)}))}))}genMorphGeometry(e,t,i,r,s){const o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==i.Vertices?i.Vertices.a:[],l=void 0!==i.Indexes?i.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let n=0;n<l.length;n++){const e=3*l[n];u[e]=a[3*n],u[e+1]=a[3*n+1],u[e+2]=a[3*n+2]}const d={vertexIndices:o,vertexPositions:u},h=this.genBuffers(d),p=new n.a$l(h.vertex,3);p.name=s||i.attrName,p.applyMatrix4(r),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Colors.a;let s=[];"IndexToDirect"===i&&(s=e.ColorIndex.a);for(let o=0,a=new n.Ilk;o<r.length;o+=4)a.fromArray(r,o).convertSRGBToLinear().toArray(r,o);return{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let s=0;s<i.length;++s)r.push(s);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new n.u9r;const i=t-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let u=0,d=o.length;u<d;u+=4)s.push((new n.Ltg).fromArray(o,u));let a,l;if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){a=i,l=r.length-1-a;for(let e=0;e<i;++e)s.push(s[e])}const c=new kf(i,r,s,a,l).getPoints(12*s.length);return(new n.u9r).setFromPoints(c)}}class jf{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===Bf.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Bf.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Bf.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(Wf),values:t[n].KeyValueFloat.a},r=Of.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=Bf.Objects.AnimationLayer,i=new Map;for(const r in t){const t=[],s=Of.get(parseInt(r));void 0!==s&&(s.children.forEach((function(i,r){if(e.has(i.ID)){const s=e.get(i.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===t[r]){const e=Of.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const s=Bf.Objects.Model[e.toString()];if(void 0===s)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",i);const o={modelName:s.attrName?n.iUV.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Lf.traverse((function(e){e.ID===s.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))})),o.transform||(o.transform=new n.yGw),"PreRotation"in s&&(o.preRotation=s.PreRotation.value),"PostRotation"in s&&(o.postRotation=s.PostRotation.value),t[r]=o}}t[r]&&(t[r][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===t[r]){const e=Of.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,s=Of.get(e).parents[0].ID,o=Of.get(s).parents[0].ID,a=Of.get(o).parents[0].ID,l=Bf.Objects.Model[a],c={modelName:l.attrName?n.iUV.sanitizeNodeName(l.attrName):"",morphName:Bf.Objects.Deformer[e].attrName};t[r]=c}t[r][s.attr]=s}}})),i.set(parseInt(r),t))}return i}parseAnimStacks(e){const t=Bf.Objects.AnimationStack,n={};for(const i in t){const r=Of.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[];const i=this;return e.layer.forEach((function(e){t=t.concat(i.generateTracks(e))})),new n.m7l(e.name,-1,t)}generateTracks(e){const t=[];let i=new n.Pa4,r=new n._fP,s=new n.Pa4;if(e.transform&&e.transform.decompose(i,r,s),i=i.toArray(),r=(new n.USm).setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,i,r){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,i);return new n.yC1(e+"."+r,s,o)}generateRotationTrack(e,t,i,r,s,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(n.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(n.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(n.M8C.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,i);void 0!==r&&((r=r.map(n.M8C.degToRad)).push(o),r=(new n.USm).fromArray(r),r=(new n._fP).setFromEuler(r)),void 0!==s&&((s=s.map(n.M8C.degToRad)).push(o),s=(new n.USm).fromArray(s),s=(new n._fP).setFromEuler(s).invert());const c=new n._fP,u=new n.USm,d=[];for(let n=0;n<l.length;n+=3)u.set(l[n],l[n+1],l[n+2],o),c.setFromEuler(u),void 0!==r&&c.premultiply(r),void 0!==s&&c.multiply(s),c.toArray(d,n/3*4);return new n.iLg(e+".quaternion",a,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map((function(e){return e/100})),r=Lf.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new n.dUE(e.modelName+".morphTargetInfluences["+r+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let s=-1,o=-1,a=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==o){const e=t.y.values[o];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==a){const e=t.z.values[a];r.push(e),i[2]=e}else r.push(i[2])})),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){const s=r/180,o=i/s;let a=n+o;const l=e.times[t-1],c=(e.times[t]-l)/s;let u=l+c;const d=[],h=[];for(;u<e.times[t];)d.push(u),u+=c,h.push(a),a+=o;e.times=tm(e.times,t,d),e.values=tm(e.values,t,h)}}}}class zf{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Hf,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){const r=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(r||s)return;const o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):a?t.parseNodeProperty(e,a,n[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},s=this.parseNodeAttr(i),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in o?("PoseNode"===n?o.PoseNode.push(r):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==s.id&&(o[n][s.id]=r)):"number"==typeof s.id?(o[n]={},o[n][s.id]=r):"Properties70"!==n&&(o[n]="PoseNode"===n?[r]:r),"number"==typeof s.id&&(r.id=s.id),""!==s.name&&(r.attrName=s.name),""!==s.type&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let o=r.split(",").slice(3);o=o.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,o),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):"a"!==i?s[i]=r:s.a=r,this.setCurrentProp(s,i),"a"===i&&","!==r.slice(-1)&&(s.a=$f(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=$f(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],s=i[1],o=i[2],a=i[3];let l=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=$f(l)}this.getPrevNode()[r]={type:s,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class Gf{parse(e){const t=new Vf(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Hf;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(0===i)return null;const a=[];for(let d=0;d<r;d++)a.push(this.parseProperty(e));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(o,n,i)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==o&&(n.name=o),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],s=n.propertyList[3];let o;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),o="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:s,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),s=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const o=If(new Uint8Array(e.getArrayBuffer(s))),a=new Vf(o.buffer);switch(t){case"b":case"c":return a.getBooleanArray(i);case"d":return a.getFloat64Array(i);case"f":return a.getFloat32Array(i);case"i":return a.getInt32Array(i);case"l":return a.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Vf{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class Hf{add(e,t){this[e]=t}}function Qf(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Wf(e){return e/46186158e3}const qf=[];function Xf(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return function(e,t,n,i){for(let r=n,s=0;r<i;r++,s++)e[s]=t[r];return e}(qf,i.buffer,s,o)}const Yf=new n.USm,Kf=new n.Pa4;function Jf(e){const t=new n.yGw,i=new n.yGw,r=new n.yGw,s=new n.yGw,o=new n.yGw,a=new n.yGw,l=new n.yGw,c=new n.yGw,u=new n.yGw,d=new n.yGw,h=new n.yGw,p=new n.yGw,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Kf.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(n.M8C.degToRad);t.push(e.eulerOrder||n.USm.DEFAULT_ORDER),i.makeRotationFromEuler(Yf.fromArray(t))}if(e.rotation){const t=e.rotation.map(n.M8C.degToRad);t.push(e.eulerOrder||n.USm.DEFAULT_ORDER),r.makeRotationFromEuler(Yf.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(n.M8C.degToRad);t.push(e.eulerOrder||n.USm.DEFAULT_ORDER),s.makeRotationFromEuler(Yf.fromArray(t)),s.invert()}e.scale&&o.scale(Kf.fromArray(e.scale)),e.scalingOffset&&l.setPosition(Kf.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(Kf.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(Kf.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(Kf.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),d.copy(e.parentMatrixWorld));const m=i.clone().multiply(r).multiply(s),g=new n.yGw;g.extractRotation(d);const _=new n.yGw;_.copyPosition(d);const v=_.clone().invert().multiply(d),y=g.clone().invert().multiply(v),b=o,A=new n.yGw;if(0===f)A.copy(g).multiply(m).multiply(y).multiply(b);else if(1===f)A.copy(g).multiply(y).multiply(m).multiply(b);else{const e=(new n.yGw).scale((new n.Pa4).setFromMatrixScale(h)).clone().invert(),t=y.clone().multiply(e);A.copy(g).multiply(m).multiply(t).multiply(b)}const w=u.clone().invert(),x=a.clone().invert();let E=t.clone().multiply(c).multiply(u).multiply(i).multiply(r).multiply(s).multiply(w).multiply(l).multiply(a).multiply(o).multiply(x);const C=(new n.yGw).copyPosition(E),S=d.clone().multiply(C);return p.copyPosition(S),E=p.clone().multiply(A),E.premultiply(d.invert()),E}function Zf(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function $f(e){return e.split(",").map((function(e){return parseFloat(e)}))}function em(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,n))}function tm(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}class nm extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls],this._importer=new Nt(Uf,["fbx"],!0)}async onAdded(e){var t,n;null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n||n.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,n,i,r;(null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n?void 0:n.Importers)&&(null===(r=null===(i=e.getManager())||void 0===i?void 0:i.importer)||void 0===r||r.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}nm.PluginType="FBXLoadPlugin";const im=new n.cPb(45,1,.1,1e3);function rm(e,t,i,r=7,s=new n.Pa4(0,0,1.5)){i=null!=i?i:e.scene.modelObject;const o=(new p).expandByObject(null!=i?i:t,!0,!0),a=o.getCenter(new n.Pa4),l=o.getSize(new n.Pa4);im.position.copy(a).add(s.clone().multiplyScalar(Math.max(l.x,l.y,l.z))),im.lookAt(a),t&&t.traverseVisible((e=>{e.layers.enable(r)})),r>0?im.layers.set(r):im.layers.enableAll();const c=null==t?void 0:t.visible;t&&(t.visible=!0),e.renderer.rendererObject.setRenderTarget(null),e.renderer.rendererObject.render(i,im);const u=e.renderer.rendererObject.domElement.toDataURL("image/png");return t&&(t.visible=c,t.traverseVisible((e=>{e.layers.disable(r)})),im.layers.enableAll()),e.setDirty(),u}class sm{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new n.Kj0(new n.xo$(1)),cube:new n.Kj0(new n.DvJ(1,1,1)),cylinder:new n.Kj0(new n.fHI(.5,.5,1))};const t=new n.xsS;this._channel=7;const i=new n.vmT(16777215,4473924,1);i.position.set(0,10,0),i.layers.set(this._channel),t.add(i),this._lights.push(i),this._scene=t}dispose(){[...this._lights].forEach((e=>e.dispose())),Object.values(this.shapes).forEach((e=>{e.geometry&&e.geometry.dispose()}))}generate(e,t="sphere"){const i=this.shapes[t]||new n.Kj0(new n.xo$(1));i.material=e.materialObject,i.geometry.attributes.tangent||i.geometry.computeTangents(),this._scene.add(i),this._scene.environment=this.viewer.scene.environment;const r=i.material.envMapIntensity;"number"==typeof r&&(i.material.envMapIntensity=Math.max(r,2));const s=rm(this.viewer,i,this._scene,this._channel,new n.Pa4(0,0,1.5));return"number"==typeof r&&(i.material.envMapIntensity=r),this._scene.remove(i),i.material=void 0,s}}class om extends _t{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this.applyOnLoad=!0,this._refreshUiConfig=()=>{var e,t;this.enabled&&(null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e))},this.dependencies=[Ls],this.variations=[],this._selectedMaterial=()=>{var e,t;return(null===(t=null===(e=this._picking)||void 0===e?void 0:e.getSelectedObject())||void 0===t?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"mapping",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"uuid"],onChange:async()=>this.refreshUi()},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Tt).filter((e=>e.endsWith("Map")))].map((e=>({label:e,value:e})))},...(null===(e=this.getSelectedVariation())||void 0===e?void 0:e.materials.map((e=>e.uiConfig?Object.assign(e.uiConfig,{expanded:!1}):{})))||[],{type:"button",label:"Remove variations",hidden:()=>!this._selectedMaterial(),value:async()=>{const e=this.getSelectedVariation();e&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(e.materials=[]),this.refreshUi()}},{type:"button",label:"Remove completely",hidden:()=>!this._selectedMaterial(),value:async()=>{const e=this.getSelectedVariation();e&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(e)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach((e=>this.applyVariation(e,e.materials[0].uuid)))}}]}]},this.addEventListener("deserialize",this.refreshUi),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){var t,n;await super.onAdded(e),this._picking=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Picking"),this._previewGenerator=new sm(this._viewer),null===(n=this._picking)||void 0===n||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi)}reapplyAll(){this.variations.forEach((e=>{var t;return this.applyVariation(e,e.materials[null!==(t=e.selectedIndex)&&void 0!==t?t:0].uuid)}))}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)?(void 0===e.applyOnLoad&&(this.applyOnLoad=!1),this.applyOnLoad&&this.reapplyAll(),this):null}async onRemove(e){var t,n;return null===(t=this._previewGenerator)||void 0===t||t.dispose(),this._previewGenerator=void 0,null===(n=this._picking)||void 0===n||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find((t=>t.uuid===e)):void 0}getSelectedVariation(){var e,t;return this.findVariation(null===(e=this._selectedMaterial())||void 0===e?void 0:e.uuid)||this.findVariation(null===(t=this._selectedMaterial())||void 0===t?void 0:t.name)}applyVariation(e,t){var n,i;const r=e.materials.find((e=>e.uuid===t)),s=null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getManager())||void 0===i?void 0:i.materials;return!!s&&!!r&&(e.selectedIndex=e.materials.indexOf(r),s.applyMaterial(r,e.uuid))}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var t;const n=null===(t=null==e?void 0:e.clone)||void 0===t?void 0:t.call(e);if(e&&n){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t||this.variations.push(t={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),t.materials.push(n),this.refreshUi()}}}om.PluginType="MaterialConfiguratorPlugin",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([re()],om.prototype,"variations",void 0);class am{static _initializeStyles(){(0,t.createStyles)(t.css`
  .customContextGrid {
    background: #eeeeee55;
    border: 0.5px solid rgba(220, 220, 220, 0.2);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 6px rgba(12, 12, 12, 0.2);

    color: #111111;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
    backdrop-filter: blur(20px);
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }

  .customContextGridItems:hover {
    color: white;
    //background-color: #017AFF;
    box-shadow: 0 0 7px 0px rgba(64, 64, 64, 0.3);
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 5px;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `,this._container),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,n,i,r,s,o,a){var l;const c=(0,t.mobileAndTabletCheck)(),u=c?.15:.25,d=c?1.5:2.5,h=(0,t.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`\n            <div class="customContextGridHeading"> ${n} </div>\n            `});h.style.top=s+"px",h.style.left=r+"px",h.style.gap=u+"rem",h.style.width=(d+u)*i-u+"rem",h.dataset.tag=e;for(const p of o){const e=(0,t.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`\n            <img src="${p.image}" class="customContextGridItemImage">\n            `});e.style.width=d+"rem",e.style.height=d+"rem",h.appendChild(e),e.onclick=()=>{var e;return null===(e=p.onClick)||void 0===e?void 0:e.call(p,p.id)},a(e,p,h)}return null===(l=this.Elements)||void 0===l||l.push(h),h}static RemoveAll(e){if(e){const t=this.Elements.filter((t=>t.dataset.tag===e));for(const e of t)e.remove();this.Elements=this.Elements.filter((t=>t.dataset.tag!==e))}else{for(const e of this.Elements)e.remove();this.Elements=[]}}static RebuildUi(e){if(0===this.Elements.length)return;e||(e=(0,t.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const t of this.Elements)t.remove();this._container.innerHTML="",this._initializeStyles();let n=20;e.appendChild(this._container);for(const t of this.Elements)t.style.top=n+"px",this._container.appendChild(t),n+=t.clientHeight+20}}function lm(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function cm(e){return e instanceof lm(e).Element||e instanceof Element}function um(e){return e instanceof lm(e).HTMLElement||e instanceof HTMLElement}function dm(e){return"undefined"!=typeof ShadowRoot&&(e instanceof lm(e).ShadowRoot||e instanceof ShadowRoot)}am.Elements=[],am._container=document.createElement("div");var hm=Math.max,pm=Math.min,fm=Math.round;function mm(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function gm(){return!/^((?!chrome|android).)*safari/i.test(mm())}function _m(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=e.getBoundingClientRect(),r=1,s=1;t&&um(e)&&(r=e.offsetWidth>0&&fm(i.width)/e.offsetWidth||1,s=e.offsetHeight>0&&fm(i.height)/e.offsetHeight||1);var o=(cm(e)?lm(e):window).visualViewport,a=!gm()&&n,l=(i.left+(a&&o?o.offsetLeft:0))/r,c=(i.top+(a&&o?o.offsetTop:0))/s,u=i.width/r,d=i.height/s;return{width:u,height:d,top:c,right:l+u,bottom:c+d,left:l,x:l,y:c}}function vm(e){var t=lm(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function ym(e){return e?(e.nodeName||"").toLowerCase():null}function bm(e){return((cm(e)?e.ownerDocument:e.document)||window.document).documentElement}function Am(e){return _m(bm(e)).left+vm(e).scrollLeft}function wm(e){return lm(e).getComputedStyle(e)}function xm(e){var t=wm(e),n=t.overflow,i=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function Em(e,t,n){void 0===n&&(n=!1);var i,r,s=um(t),o=um(t)&&function(e){var t=e.getBoundingClientRect(),n=fm(t.width)/e.offsetWidth||1,i=fm(t.height)/e.offsetHeight||1;return 1!==n||1!==i}(t),a=bm(t),l=_m(e,o,n),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(s||!s&&!n)&&(("body"!==ym(t)||xm(a))&&(c=(i=t)!==lm(i)&&um(i)?{scrollLeft:(r=i).scrollLeft,scrollTop:r.scrollTop}:vm(i)),um(t)?((u=_m(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):a&&(u.x=Am(a))),{x:l.left+c.scrollLeft-u.x,y:l.top+c.scrollTop-u.y,width:l.width,height:l.height}}function Cm(e){var t=_m(e),n=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:i}}function Sm(e){return"html"===ym(e)?e:e.assignedSlot||e.parentNode||(dm(e)?e.host:null)||bm(e)}function Mm(e){return["html","body","#document"].indexOf(ym(e))>=0?e.ownerDocument.body:um(e)&&xm(e)?e:Mm(Sm(e))}function Tm(e,t){var n;void 0===t&&(t=[]);var i=Mm(e),r=i===(null==(n=e.ownerDocument)?void 0:n.body),s=lm(i),o=r?[s].concat(s.visualViewport||[],xm(i)?i:[]):i,a=t.concat(o);return r?a:a.concat(Tm(Sm(o)))}function Im(e){return["table","td","th"].indexOf(ym(e))>=0}function Pm(e){return um(e)&&"fixed"!==wm(e).position?e.offsetParent:null}function Rm(e){for(var t=lm(e),n=Pm(e);n&&Im(n)&&"static"===wm(n).position;)n=Pm(n);return n&&("html"===ym(n)||"body"===ym(n)&&"static"===wm(n).position)?t:n||function(e){var t=/firefox/i.test(mm());if(/Trident/i.test(mm())&&um(e)&&"fixed"===wm(e).position)return null;var n=Sm(e);for(dm(n)&&(n=n.host);um(n)&&["html","body"].indexOf(ym(n))<0;){var i=wm(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}return null}(e)||t}var Dm="top",km="bottom",Bm="right",Om="left",Lm="auto",Um=[Dm,km,Bm,Om],Nm="start",Fm="end",jm="clippingParents",zm="viewport",Gm="popper",Vm="reference",Hm=Um.reduce((function(e,t){return e.concat([t+"-"+Nm,t+"-"+Fm])}),[]),Qm=[].concat(Um,[Lm]).reduce((function(e,t){return e.concat([t,t+"-"+Nm,t+"-"+Fm])}),[]),Wm="beforeRead",qm="read",Xm="afterRead",Ym="beforeMain",Km="main",Jm="afterMain",Zm="beforeWrite",$m="write",eg="afterWrite",tg=[Wm,qm,Xm,Ym,Km,Jm,Zm,$m,eg];function ng(e){var t=new Map,n=new Set,i=[];function r(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var i=t.get(e);i&&r(i)}})),i.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||r(e)})),i}var ig={placement:"bottom",modifiers:[],strategy:"absolute"};function rg(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function sg(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,i=void 0===n?[]:n,r=t.defaultOptions,s=void 0===r?ig:r;return function(e,t,n){void 0===n&&(n=s);var r,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},ig,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,u={state:a,setOptions:function(n){var r="function"==typeof n?n(a.options):n;d(),a.options=Object.assign({},s,a.options,r),a.scrollParents={reference:cm(e)?Tm(e):e.contextElement?Tm(e.contextElement):[],popper:Tm(t)};var o,c,h=function(e){var t=ng(e);return tg.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((o=[].concat(i,a.options.modifiers),c=o.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(c).map((function(e){return c[e]}))));return a.orderedModifiers=h.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,i=void 0===n?{}:n,r=e.effect;if("function"==typeof r){var s=r({state:a,name:t,instance:u,options:i});l.push(s||function(){})}})),u.update()},forceUpdate:function(){if(!c){var e=a.elements,t=e.reference,n=e.popper;if(rg(t,n)){a.rects={reference:Em(t,Rm(n),"fixed"===a.options.strategy),popper:Cm(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var i=0;i<a.orderedModifiers.length;i++)if(!0!==a.reset){var r=a.orderedModifiers[i],s=r.fn,o=r.options,l=void 0===o?{}:o,d=r.name;"function"==typeof s&&(a=s({state:a,options:l,name:d,instance:u})||a)}else a.reset=!1,i=-1}}},update:(r=function(){return new Promise((function(e){u.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(r())}))}))),o}),destroy:function(){d(),c=!0}};if(!rg(e,t))return u;function d(){l.forEach((function(e){return e()})),l=[]}return u.setOptions(n).then((function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)})),u}}var og=sg(),ag={passive:!0},lg={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,i=e.options,r=i.scroll,s=void 0===r||r,o=i.resize,a=void 0===o||o,l=lm(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach((function(e){e.addEventListener("scroll",n.update,ag)})),a&&l.addEventListener("resize",n.update,ag),function(){s&&c.forEach((function(e){e.removeEventListener("scroll",n.update,ag)})),a&&l.removeEventListener("resize",n.update,ag)}},data:{}};function cg(e){return e.split("-")[0]}function ug(e){return e.split("-")[1]}function dg(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function hg(e){var t,n=e.reference,i=e.element,r=e.placement,s=r?cg(r):null,o=r?ug(r):null,a=n.x+n.width/2-i.width/2,l=n.y+n.height/2-i.height/2;switch(s){case Dm:t={x:a,y:n.y-i.height};break;case km:t={x:a,y:n.y+n.height};break;case Bm:t={x:n.x+n.width,y:l};break;case Om:t={x:n.x-i.width,y:l};break;default:t={x:n.x,y:n.y}}var c=s?dg(s):null;if(null!=c){var u="y"===c?"height":"width";switch(o){case Nm:t[c]=t[c]-(n[u]/2-i[u]/2);break;case Fm:t[c]=t[c]+(n[u]/2-i[u]/2)}}return t}var pg={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=hg({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},fg={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mg(e){var t,n=e.popper,i=e.popperRect,r=e.placement,s=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,u=e.roundOffsets,d=e.isFixed,h=o.x,p=void 0===h?0:h,f=o.y,m=void 0===f?0:f,g="function"==typeof u?u({x:p,y:m}):{x:p,y:m};p=g.x,m=g.y;var _=o.hasOwnProperty("x"),v=o.hasOwnProperty("y"),y=Om,b=Dm,A=window;if(c){var w=Rm(n),x="clientHeight",E="clientWidth";w===lm(n)&&"static"!==wm(w=bm(n)).position&&"absolute"===a&&(x="scrollHeight",E="scrollWidth"),(r===Dm||(r===Om||r===Bm)&&s===Fm)&&(b=km,m-=(d&&w===A&&A.visualViewport?A.visualViewport.height:w[x])-i.height,m*=l?1:-1),r!==Om&&(r!==Dm&&r!==km||s!==Fm)||(y=Bm,p-=(d&&w===A&&A.visualViewport?A.visualViewport.width:w[E])-i.width,p*=l?1:-1)}var C,S=Object.assign({position:a},c&&fg),M=!0===u?function(e){var t=e.x,n=e.y,i=window.devicePixelRatio||1;return{x:fm(t*i)/i||0,y:fm(n*i)/i||0}}({x:p,y:m}):{x:p,y:m};return p=M.x,m=M.y,l?Object.assign({},S,((C={})[b]=v?"0":"",C[y]=_?"0":"",C.transform=(A.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",C)):Object.assign({},S,((t={})[b]=v?m+"px":"",t[y]=_?p+"px":"",t.transform="",t))}var gg={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,i=n.gpuAcceleration,r=void 0===i||i,s=n.adaptive,o=void 0===s||s,a=n.roundOffsets,l=void 0===a||a,c={placement:cg(t.placement),variation:ug(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,mg(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,mg(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},_g={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},i=t.attributes[e]||{},r=t.elements[e];um(r)&&ym(r)&&(Object.assign(r.style,n),Object.keys(i).forEach((function(e){var t=i[e];!1===t?r.removeAttribute(e):r.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var i=t.elements[e],r=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});um(i)&&ym(i)&&(Object.assign(i.style,s),Object.keys(r).forEach((function(e){i.removeAttribute(e)})))}))}},requires:["computeStyles"]},vg={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.offset,s=void 0===r?[0,0]:r,o=Qm.reduce((function(e,n){return e[n]=function(e,t,n){var i=cg(e),r=[Om,Dm].indexOf(i)>=0?-1:1,s="function"==typeof n?n(Object.assign({},t,{placement:e})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*r,[Om,Bm].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}(n,t.rects,s),e}),{}),a=o[t.placement],l=a.x,c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=o}},yg={left:"right",right:"left",bottom:"top",top:"bottom"};function bg(e){return e.replace(/left|right|bottom|top/g,(function(e){return yg[e]}))}var Ag={start:"end",end:"start"};function wg(e){return e.replace(/start|end/g,(function(e){return Ag[e]}))}function xg(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&dm(n)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Eg(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Cg(e,t,n){return t===zm?Eg(function(e,t){var n=lm(e),i=bm(e),r=n.visualViewport,s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;var c=gm();(c||!c&&"fixed"===t)&&(a=r.offsetLeft,l=r.offsetTop)}return{width:s,height:o,x:a+Am(e),y:l}}(e,n)):cm(t)?function(e,t){var n=_m(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):Eg(function(e){var t,n=bm(e),i=vm(e),r=null==(t=e.ownerDocument)?void 0:t.body,s=hm(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=hm(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-i.scrollLeft+Am(e),l=-i.scrollTop;return"rtl"===wm(r||n).direction&&(a+=hm(n.clientWidth,r?r.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}(bm(e)))}function Sg(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Mg(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function Tg(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=void 0===i?e.placement:i,s=n.strategy,o=void 0===s?e.strategy:s,a=n.boundary,l=void 0===a?jm:a,c=n.rootBoundary,u=void 0===c?zm:c,d=n.elementContext,h=void 0===d?Gm:d,p=n.altBoundary,f=void 0!==p&&p,m=n.padding,g=void 0===m?0:m,_=Sg("number"!=typeof g?g:Mg(g,Um)),v=h===Gm?Vm:Gm,y=e.rects.popper,b=e.elements[f?v:h],A=function(e,t,n,i){var r="clippingParents"===t?function(e){var t=Tm(Sm(e)),n=["absolute","fixed"].indexOf(wm(e).position)>=0&&um(e)?Rm(e):e;return cm(n)?t.filter((function(e){return cm(e)&&xg(e,n)&&"body"!==ym(e)})):[]}(e):[].concat(t),s=[].concat(r,[n]),o=s[0],a=s.reduce((function(t,n){var r=Cg(e,n,i);return t.top=hm(r.top,t.top),t.right=pm(r.right,t.right),t.bottom=pm(r.bottom,t.bottom),t.left=hm(r.left,t.left),t}),Cg(e,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}(cm(b)?b:b.contextElement||bm(e.elements.popper),l,u,o),w=_m(e.elements.reference),x=hg({reference:w,element:y,strategy:"absolute",placement:r}),E=Eg(Object.assign({},y,x)),C=h===Gm?E:w,S={top:A.top-C.top+_.top,bottom:C.bottom-A.bottom+_.bottom,left:A.left-C.left+_.left,right:C.right-A.right+_.right},M=e.modifiersData.offset;if(h===Gm&&M){var T=M[r];Object.keys(S).forEach((function(e){var t=[Bm,km].indexOf(e)>=0?1:-1,n=[Dm,km].indexOf(e)>=0?"y":"x";S[e]+=T[n]*t}))}return S}var Ig={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var r=n.mainAxis,s=void 0===r||r,o=n.altAxis,a=void 0===o||o,l=n.fallbackPlacements,c=n.padding,u=n.boundary,d=n.rootBoundary,h=n.altBoundary,p=n.flipVariations,f=void 0===p||p,m=n.allowedAutoPlacements,g=t.options.placement,_=cg(g),v=l||(_!==g&&f?function(e){if(cg(e)===Lm)return[];var t=bg(e);return[wg(e),t,wg(t)]}(g):[bg(g)]),y=[g].concat(v).reduce((function(e,n){return e.concat(cg(n)===Lm?function(e,t){void 0===t&&(t={});var n=t,i=n.placement,r=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?Qm:l,u=ug(i),d=u?a?Hm:Hm.filter((function(e){return ug(e)===u})):Um,h=d.filter((function(e){return c.indexOf(e)>=0}));0===h.length&&(h=d);var p=h.reduce((function(t,n){return t[n]=Tg(e,{placement:n,boundary:r,rootBoundary:s,padding:o})[cg(n)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}(t,{placement:n,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:m}):n)}),[]),b=t.rects.reference,A=t.rects.popper,w=new Map,x=!0,E=y[0],C=0;C<y.length;C++){var S=y[C],M=cg(S),T=ug(S)===Nm,I=[Dm,km].indexOf(M)>=0,P=I?"width":"height",R=Tg(t,{placement:S,boundary:u,rootBoundary:d,altBoundary:h,padding:c}),D=I?T?Bm:Om:T?km:Dm;b[P]>A[P]&&(D=bg(D));var k=bg(D),B=[];if(s&&B.push(R[M]<=0),a&&B.push(R[D]<=0,R[k]<=0),B.every((function(e){return e}))){E=S,x=!1;break}w.set(S,B)}if(x)for(var O=function(e){var t=y.find((function(t){var n=w.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return E=t,"break"},L=f?3:1;L>0&&"break"!==O(L);L--);t.placement!==E&&(t.modifiersData[i]._skip=!0,t.placement=E,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Pg(e,t,n){return hm(e,pm(t,n))}var Rg={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,i=e.name,r=n.mainAxis,s=void 0===r||r,o=n.altAxis,a=void 0!==o&&o,l=n.boundary,c=n.rootBoundary,u=n.altBoundary,d=n.padding,h=n.tether,p=void 0===h||h,f=n.tetherOffset,m=void 0===f?0:f,g=Tg(t,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),_=cg(t.placement),v=ug(t.placement),y=!v,b=dg(_),A="x"===b?"y":"x",w=t.modifiersData.popperOffsets,x=t.rects.reference,E=t.rects.popper,C="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,S="number"==typeof C?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),M=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,T={x:0,y:0};if(w){if(s){var I,P="y"===b?Dm:Om,R="y"===b?km:Bm,D="y"===b?"height":"width",k=w[b],B=k+g[P],O=k-g[R],L=p?-E[D]/2:0,U=v===Nm?x[D]:E[D],N=v===Nm?-E[D]:-x[D],F=t.elements.arrow,j=p&&F?Cm(F):{width:0,height:0},z=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},G=z[P],V=z[R],H=Pg(0,x[D],j[D]),Q=y?x[D]/2-L-H-G-S.mainAxis:U-H-G-S.mainAxis,W=y?-x[D]/2+L+H+V+S.mainAxis:N+H+V+S.mainAxis,q=t.elements.arrow&&Rm(t.elements.arrow),X=q?"y"===b?q.clientTop||0:q.clientLeft||0:0,Y=null!=(I=null==M?void 0:M[b])?I:0,K=k+W-Y,J=Pg(p?pm(B,k+Q-Y-X):B,k,p?hm(O,K):O);w[b]=J,T[b]=J-k}if(a){var Z,$="x"===b?Dm:Om,ee="x"===b?km:Bm,te=w[A],ne="y"===A?"height":"width",ie=te+g[$],re=te-g[ee],se=-1!==[Dm,Om].indexOf(_),oe=null!=(Z=null==M?void 0:M[A])?Z:0,ae=se?ie:te-x[ne]-E[ne]-oe+S.altAxis,le=se?te+x[ne]+E[ne]-oe-S.altAxis:re,ce=p&&se?function(e,t,n){var i=Pg(e,t,n);return i>n?n:i}(ae,te,le):Pg(p?ae:ie,te,p?le:re);w[A]=ce,T[A]=ce-te}t.modifiersData[i]=T}},requiresIfExists:["offset"]},Dg={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,i=e.name,r=e.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=cg(n.placement),l=dg(a),c=[Om,Bm].indexOf(a)>=0?"height":"width";if(s&&o){var u=function(e,t){return Sg("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Mg(e,Um))}(r.padding,n),d=Cm(s),h="y"===l?Dm:Om,p="y"===l?km:Bm,f=n.rects.reference[c]+n.rects.reference[l]-o[l]-n.rects.popper[c],m=o[l]-n.rects.reference[l],g=Rm(s),_=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,v=f/2-m/2,y=u[h],b=_-d[c]-u[p],A=_/2-d[c]/2+v,w=Pg(y,A,b),x=l;n.modifiersData[i]=((t={})[x]=w,t.centerOffset=w-A,t)}},effect:function(e){var t=e.state,n=e.options.element,i=void 0===n?"[data-popper-arrow]":n;null!=i&&("string"!=typeof i||(i=t.elements.popper.querySelector(i)))&&xg(t.elements.popper,i)&&(t.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function kg(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Bg(e){return[Dm,Bm,km,Om].some((function(t){return e[t]>=0}))}var Og={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,i=t.rects.reference,r=t.rects.popper,s=t.modifiersData.preventOverflow,o=Tg(t,{elementContext:"reference"}),a=Tg(t,{altBoundary:!0}),l=kg(o,i),c=kg(a,r,s),u=Bg(l),d=Bg(c);t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}},Lg=sg({defaultModifiers:[lg,pg,gg,_g,vg,Ig,Rg,Dg,Og]}),Ug="tippy-box",Ng="tippy-content",Fg="tippy-backdrop",jg="tippy-arrow",zg="tippy-svg-arrow",Gg={passive:!0,capture:!0},Vg=function(){return document.body};function Hg(e,t,n){if(Array.isArray(e)){var i=e[t];return null==i?Array.isArray(n)?n[t]:n:i}return e}function Qg(e,t){var n={}.toString.call(e);return 0===n.indexOf("[object")&&n.indexOf(t+"]")>-1}function Wg(e,t){return"function"==typeof e?e.apply(void 0,t):e}function qg(e,t){return 0===t?e:function(i){clearTimeout(n),n=setTimeout((function(){e(i)}),t)};var n}function Xg(e){return[].concat(e)}function Yg(e,t){-1===e.indexOf(t)&&e.push(t)}function Kg(e){return[].slice.call(e)}function Jg(e){return Object.keys(e).reduce((function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t}),{})}function Zg(){return document.createElement("div")}function $g(e){return["Element","Fragment"].some((function(t){return Qg(e,t)}))}function e_(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function t_(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function n_(e,t,n){var i=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[i](t,n)}))}function i_(e,t){for(var n=t;n;){var i;if(e.contains(n))return!0;n=null==n.getRootNode||null==(i=n.getRootNode())?void 0:i.host}return!1}var r_={isTouch:!1},s_=0;function o_(){r_.isTouch||(r_.isTouch=!0,window.performance&&document.addEventListener("mousemove",a_))}function a_(){var e=performance.now();e-s_<20&&(r_.isTouch=!1,document.removeEventListener("mousemove",a_)),s_=e}function l_(){var e,t=document.activeElement;if((e=t)&&e._tippy&&e._tippy.reference===e){var n=t._tippy;t.blur&&!n.state.isVisible&&t.blur()}}var c_=!("undefined"==typeof window||"undefined"==typeof document||!window.msCrypto),u_=Object.assign({appendTo:Vg,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),d_=Object.keys(u_);function h_(e){var t=(e.plugins||[]).reduce((function(t,n){var i,r=n.name,s=n.defaultValue;return r&&(t[r]=void 0!==e[r]?e[r]:null!=(i=u_[r])?i:s),t}),{});return Object.assign({},e,t)}function p_(e,t){var n=Object.assign({},t,{content:Wg(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(h_(Object.assign({},u_,{plugins:t}))):d_).reduce((function(t,n){var i=(e.getAttribute("data-tippy-"+n)||"").trim();if(!i)return t;if("content"===n)t[n]=i;else try{t[n]=JSON.parse(i)}catch(e){t[n]=i}return t}),{})}(e,t.plugins));return n.aria=Object.assign({},u_.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?t.interactive:n.aria.expanded,content:"auto"===n.aria.content?t.interactive?null:"describedby":n.aria.content},n}var f_=function(){return"innerHTML"};function m_(e,t){e[f_()]=t}function g_(e){var t=Zg();return!0===e?t.className=jg:(t.className=zg,$g(e)?t.appendChild(e):m_(t,e)),t}function __(e,t){$g(t.content)?(m_(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?m_(e,t.content):e.textContent=t.content)}function v_(e){var t=e.firstElementChild,n=Kg(t.children);return{box:t,content:n.find((function(e){return e.classList.contains(Ng)})),arrow:n.find((function(e){return e.classList.contains(jg)||e.classList.contains(zg)})),backdrop:n.find((function(e){return e.classList.contains(Fg)}))}}function y_(e){var t=Zg(),n=Zg();n.className=Ug,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var i=Zg();function r(n,i){var r=v_(t),s=r.box,o=r.content,a=r.arrow;i.theme?s.setAttribute("data-theme",i.theme):s.removeAttribute("data-theme"),"string"==typeof i.animation?s.setAttribute("data-animation",i.animation):s.removeAttribute("data-animation"),i.inertia?s.setAttribute("data-inertia",""):s.removeAttribute("data-inertia"),s.style.maxWidth="number"==typeof i.maxWidth?i.maxWidth+"px":i.maxWidth,i.role?s.setAttribute("role",i.role):s.removeAttribute("role"),n.content===i.content&&n.allowHTML===i.allowHTML||__(o,e.props),i.arrow?a?n.arrow!==i.arrow&&(s.removeChild(a),s.appendChild(g_(i.arrow))):s.appendChild(g_(i.arrow)):a&&s.removeChild(a)}return i.className=Ng,i.setAttribute("data-state","hidden"),__(i,e.props),t.appendChild(n),n.appendChild(i),r(e.props,e.props),{popper:t,onUpdate:r}}y_.$$tippy=!0;var b_=1,A_=[],w_=[];function x_(e,t){var n,i,r,s,o,a,l,c,u=p_(e,Object.assign({},u_,h_(Jg(t)))),d=!1,h=!1,p=!1,f=!1,m=[],g=qg(q,u.interactiveDebounce),_=b_++,v=(c=u.plugins).filter((function(e,t){return c.indexOf(e)===t})),y={id:_,reference:e,popper:Zg(),popperInstance:null,props:u,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:v,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(r)},setProps:function(t){if(!y.state.isDestroyed){k("onBeforeUpdate",[y,t]),Q();var n=y.props,i=p_(e,Object.assign({},n,Jg(t),{ignoreAttributes:!0}));y.props=i,H(),n.interactiveDebounce!==i.interactiveDebounce&&(L(),g=qg(q,i.interactiveDebounce)),n.triggerTarget&&!i.triggerTarget?Xg(n.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):i.triggerTarget&&e.removeAttribute("aria-expanded"),O(),D(),w&&w(n,i),y.popperInstance&&(J(),$().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),k("onAfterUpdate",[y,t])}},setContent:function(e){y.setProps({content:e})},show:function(){var e=y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,i=r_.isTouch&&!y.props.touch,r=Hg(y.props.duration,0,u_.duration);if(!(e||t||n||i||T().hasAttribute("disabled")||(k("onShow",[y],!1),!1===y.props.onShow(y)))){if(y.state.isVisible=!0,M()&&(A.style.visibility="visible"),D(),j(),y.state.isMounted||(A.style.transition="none"),M()){var s=P();e_([s.box,s.content],0)}var o,l,c;a=function(){var e;if(y.state.isVisible&&!f){if(f=!0,A.offsetHeight,A.style.transition=y.props.moveTransition,M()&&y.props.animation){var t=P(),n=t.box,i=t.content;e_([n,i],r),t_([n,i],"visible")}B(),O(),Yg(w_,y),null==(e=y.popperInstance)||e.forceUpdate(),k("onMount",[y]),y.props.animation&&M()&&function(e){G(e,(function(){y.state.isShown=!0,k("onShown",[y])}))}(r)}},l=y.props.appendTo,c=T(),(o=y.props.interactive&&l===Vg||"parent"===l?c.parentNode:Wg(l,[c])).contains(A)||o.appendChild(A),y.state.isMounted=!0,J()}},hide:function(){var e=!y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,i=Hg(y.props.duration,1,u_.duration);if(!(e||t||n)&&(k("onHide",[y],!1),!1!==y.props.onHide(y))){if(y.state.isVisible=!1,y.state.isShown=!1,f=!1,d=!1,M()&&(A.style.visibility="hidden"),L(),z(),D(!0),M()){var r=P(),s=r.box,o=r.content;y.props.animation&&(e_([s,o],i),t_([s,o],"hidden"))}B(),O(),y.props.animation?M()&&function(e,t){G(e,(function(){!y.state.isVisible&&A.parentNode&&A.parentNode.contains(A)&&t()}))}(i,y.unmount):y.unmount()}},hideWithInteractivity:function(e){I().addEventListener("mousemove",g),Yg(A_,g),g(e)},enable:function(){y.state.isEnabled=!0},disable:function(){y.hide(),y.state.isEnabled=!1},unmount:function(){y.state.isVisible&&y.hide(),y.state.isMounted&&(Z(),$().forEach((function(e){e._tippy.unmount()})),A.parentNode&&A.parentNode.removeChild(A),w_=w_.filter((function(e){return e!==y})),y.state.isMounted=!1,k("onHidden",[y]))},destroy:function(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),Q(),delete e._tippy,y.state.isDestroyed=!0,k("onDestroy",[y]))}};if(!u.render)return y;var b=u.render(y),A=b.popper,w=b.onUpdate;A.setAttribute("data-tippy-root",""),A.id="tippy-"+y.id,y.popper=A,e._tippy=y,A._tippy=y;var x=v.map((function(e){return e.fn(y)})),E=e.hasAttribute("aria-expanded");return H(),O(),D(),k("onCreate",[y]),u.showOnCreate&&ee(),A.addEventListener("mouseenter",(function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()})),A.addEventListener("mouseleave",(function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&I().addEventListener("mousemove",g)})),y;function C(){var e=y.props.touch;return Array.isArray(e)?e:[e,0]}function S(){return"hold"===C()[0]}function M(){var e;return!(null==(e=y.props.render)||!e.$$tippy)}function T(){return l||e}function I(){var e,t,n=T().parentNode;return n&&null!=(t=Xg(n)[0])&&null!=(e=t.ownerDocument)&&e.body?t.ownerDocument:document}function P(){return v_(A)}function R(e){return y.state.isMounted&&!y.state.isVisible||r_.isTouch||s&&"focus"===s.type?0:Hg(y.props.delay,e?0:1,u_.delay)}function D(e){void 0===e&&(e=!1),A.style.pointerEvents=y.props.interactive&&!e?"":"none",A.style.zIndex=""+y.props.zIndex}function k(e,t,n){var i;void 0===n&&(n=!0),x.forEach((function(n){n[e]&&n[e].apply(n,t)})),n&&(i=y.props)[e].apply(i,t)}function B(){var t=y.props.aria;if(t.content){var n="aria-"+t.content,i=A.id;Xg(y.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(n);if(y.state.isVisible)e.setAttribute(n,t?t+" "+i:i);else{var r=t&&t.replace(i,"").trim();r?e.setAttribute(n,r):e.removeAttribute(n)}}))}}function O(){!E&&y.props.aria.expanded&&Xg(y.props.triggerTarget||e).forEach((function(e){y.props.interactive?e.setAttribute("aria-expanded",y.state.isVisible&&e===T()?"true":"false"):e.removeAttribute("aria-expanded")}))}function L(){I().removeEventListener("mousemove",g),A_=A_.filter((function(e){return e!==g}))}function U(t){if(!r_.isTouch||!p&&"mousedown"!==t.type){var n=t.composedPath&&t.composedPath()[0]||t.target;if(!y.props.interactive||!i_(A,n)){if(Xg(y.props.triggerTarget||e).some((function(e){return i_(e,n)}))){if(r_.isTouch)return;if(y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[y,t]);!0===y.props.hideOnClick&&(y.clearDelayTimeouts(),y.hide(),h=!0,setTimeout((function(){h=!1})),y.state.isMounted||z())}}}function N(){p=!0}function F(){p=!1}function j(){var e=I();e.addEventListener("mousedown",U,!0),e.addEventListener("touchend",U,Gg),e.addEventListener("touchstart",F,Gg),e.addEventListener("touchmove",N,Gg)}function z(){var e=I();e.removeEventListener("mousedown",U,!0),e.removeEventListener("touchend",U,Gg),e.removeEventListener("touchstart",F,Gg),e.removeEventListener("touchmove",N,Gg)}function G(e,t){var n=P().box;function i(e){e.target===n&&(n_(n,"remove",i),t())}if(0===e)return t();n_(n,"remove",o),n_(n,"add",i),o=i}function V(t,n,i){void 0===i&&(i=!1),Xg(y.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,n,i),m.push({node:e,eventType:t,handler:n,options:i})}))}function H(){var e;S()&&(V("touchstart",W,{passive:!0}),V("touchend",X,{passive:!0})),(e=y.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(V(e,W),e){case"mouseenter":V("mouseleave",X);break;case"focus":V(c_?"focusout":"blur",Y);break;case"focusin":V("focusout",Y)}}))}function Q(){m.forEach((function(e){var t=e.node,n=e.eventType,i=e.handler,r=e.options;t.removeEventListener(n,i,r)})),m=[]}function W(e){var t,n=!1;if(y.state.isEnabled&&!K(e)&&!h){var i="focus"===(null==(t=s)?void 0:t.type);s=e,l=e.currentTarget,O(),!y.state.isVisible&&Qg(e,"MouseEvent")&&A_.forEach((function(t){return t(e)})),"click"===e.type&&(y.props.trigger.indexOf("mouseenter")<0||d)&&!1!==y.props.hideOnClick&&y.state.isVisible?n=!0:ee(e),"click"===e.type&&(d=!n),n&&!i&&te(e)}}function q(e){var t=e.target,n=T().contains(t)||A.contains(t);if("mousemove"!==e.type||!n){var i=$().concat(A).map((function(e){var t,n=null==(t=e._tippy.popperInstance)?void 0:t.state;return n?{popperRect:e.getBoundingClientRect(),popperState:n,props:u}:null})).filter(Boolean);(function(e,t){var n=t.clientX,i=t.clientY;return e.every((function(e){var t=e.popperRect,r=e.popperState,s=e.props.interactiveBorder,o=r.placement.split("-")[0],a=r.modifiersData.offset;if(!a)return!0;var l="bottom"===o?a.top.y:0,c="top"===o?a.bottom.y:0,u="right"===o?a.left.x:0,d="left"===o?a.right.x:0,h=t.top-i+l>s,p=i-t.bottom-c>s,f=t.left-n+u>s,m=n-t.right-d>s;return h||p||f||m}))})(i,e)&&(L(),te(e))}}function X(e){K(e)||y.props.trigger.indexOf("click")>=0&&d||(y.props.interactive?y.hideWithInteractivity(e):te(e))}function Y(e){y.props.trigger.indexOf("focusin")<0&&e.target!==T()||y.props.interactive&&e.relatedTarget&&A.contains(e.relatedTarget)||te(e)}function K(e){return!!r_.isTouch&&S()!==e.type.indexOf("touch")>=0}function J(){Z();var t=y.props,n=t.popperOptions,i=t.placement,r=t.offset,s=t.getReferenceClientRect,o=t.moveTransition,l=M()?v_(A).arrow:null,c=s?{getBoundingClientRect:s,contextElement:s.contextElement||T()}:e,u=[{name:"offset",options:{offset:r}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(M()){var n=P().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?n.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?n.setAttribute("data-"+e,""):n.removeAttribute("data-"+e)})),t.attributes.popper={}}}}];M()&&l&&u.push({name:"arrow",options:{element:l,padding:3}}),u.push.apply(u,(null==n?void 0:n.modifiers)||[]),y.popperInstance=Lg(c,A,Object.assign({},n,{placement:i,onFirstUpdate:a,modifiers:u}))}function Z(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function $(){return Kg(A.querySelectorAll("[data-tippy-root]"))}function ee(e){y.clearDelayTimeouts(),e&&k("onTrigger",[y,e]),j();var t=R(!0),i=C(),r=i[0],s=i[1];r_.isTouch&&"hold"===r&&s&&(t=s),t?n=setTimeout((function(){y.show()}),t):y.show()}function te(e){if(y.clearDelayTimeouts(),k("onUntrigger",[y,e]),y.state.isVisible){if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&d)){var t=R(!1);t?i=setTimeout((function(){y.state.isVisible&&y.hide()}),t):r=requestAnimationFrame((function(){y.hide()}))}}else z()}}function E_(e,t){void 0===t&&(t={});var n=u_.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",o_,Gg),window.addEventListener("blur",l_);var i,r=Object.assign({},t,{plugins:n}),s=(i=e,$g(i)?[i]:function(e){return Qg(e,"NodeList")}(i)?Kg(i):Array.isArray(i)?i:Kg(document.querySelectorAll(i))).reduce((function(e,t){var n=t&&x_(t,r);return n&&e.push(n),e}),[]);return $g(e)?s[0]:s}E_.defaultProps=u_,E_.setDefaultProps=function(e){Object.keys(e).forEach((function(t){u_[t]=e[t]}))},E_.currentInput=r_;var C_=Object.assign({},_g,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}}),S_=function(e,t){var n;void 0===t&&(t={});var i,r=e,s=[],o=[],a=t.overrides,l=[],c=!1;function u(){o=r.map((function(e){return Xg(e.props.triggerTarget||e.reference)})).reduce((function(e,t){return e.concat(t)}),[])}function d(){s=r.map((function(e){return e.reference}))}function h(e){r.forEach((function(t){e?t.enable():t.disable()}))}function p(e){return r.map((function(t){var n=t.setProps;return t.setProps=function(r){n(r),t.reference===i&&e.setProps(r)},function(){t.setProps=n}}))}function f(e,t){var n=o.indexOf(t);if(t!==i){i=t;var l=(a||[]).concat("content").reduce((function(e,t){return e[t]=r[n].props[t],e}),{});e.setProps(Object.assign({},l,{getReferenceClientRect:"function"==typeof l.getReferenceClientRect?l.getReferenceClientRect:function(){var e;return null==(e=s[n])?void 0:e.getBoundingClientRect()}}))}}h(!1),d(),u();var m,g,_,v={fn:function(){return{onDestroy:function(){h(!0)},onHidden:function(){i=null},onClickOutside:function(e){e.props.showOnCreate&&!c&&(c=!0,i=null)},onShow:function(e){e.props.showOnCreate&&!c&&(c=!0,f(e,s[0]))},onTrigger:function(e,t){f(e,t.currentTarget)}}}},y=E_(Zg(),Object.assign({},(m=t,g=["overrides"],_=Object.assign({},m),g.forEach((function(e){delete _[e]})),_),{plugins:[v].concat(t.plugins||[]),triggerTarget:o,popperOptions:Object.assign({},t.popperOptions,{modifiers:[].concat((null==(n=t.popperOptions)?void 0:n.modifiers)||[],[C_])})})),b=y.show;y.show=function(e){if(b(),!i&&null==e)return f(y,s[0]);if(!i||null!=e){if("number"==typeof e)return s[e]&&f(y,s[e]);if(r.indexOf(e)>=0){var t=e.reference;return f(y,t)}return s.indexOf(e)>=0?f(y,e):void 0}},y.showNext=function(){var e=s[0];if(!i)return y.show(0);var t=s.indexOf(i);y.show(s[t+1]||e)},y.showPrevious=function(){var e=s[s.length-1];if(!i)return y.show(e);var t=s.indexOf(i),n=s[t-1]||e;y.show(n)};var A=y.setProps;return y.setProps=function(e){a=e.overrides||a,A(e)},y.setInstances=function(e){h(!0),l.forEach((function(e){return e()})),r=e,h(!1),d(),u(),l=p(y),y.setProps({triggerTarget:o})},l=p(y),y};E_.setDefaultProps({render:y_});var M_=E_;class T_{static _initialize(){this._inited=!0,(0,t.createStyles)(t.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",(e=>{this.Element&&!this.Element.contains(e.target)&&0===e.button&&this.Remove()}))}static Create(e,n,i){this._inited||this._initialize(),this.Element&&this.Remove();const r=(0,t.createDiv)({id:"customContextMenu",addToBody:!1});r.style.top=i+"px",r.style.left=n+"px";for(const[s,o]of Object.entries(e)){const e=(0,t.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:s});r.appendChild(e),e.onclick=o}return this.Element=r,r}static Remove(){var e;null===(e=this.Element)||void 0===e||e.remove(),this.Element=void 0}}T_.Element=void 0,T_._inited=!1;class I_ extends om{constructor(){super(...arguments),this.enableEditContextMenus=!1}async _refreshUi(){var e;if(!await super._refreshUi())return!1;am.RemoveAll(I_.PluginType);for(const n of this.variations)am.Create(I_.PluginType,n.title+(this.enableEditContextMenus?" ("+n.uuid+")":""),5,20,0,n.materials.map((e=>{let i;if(n.preview.startsWith("generate:"))i=this._previewGenerator.generate(e,n.preview.split(":")[1]);else{const r=e[n.preview]||"#ff00ff";i=r.image?(0,t.imageBitmapToBase64)(r.image,100):void 0,i||(i=(0,t.makeColorSvgCircle)((null==r?void 0:r.isColor)?r.getHexString():r))}return{id:e.uuid,image:i,onClick:e=>this.applyVariation(n,e),tooltip:e.name||e.uuid}})),((e,t,i)=>{M_(e,{placement:"bottom",content:t.tooltip}),e.oncontextmenu=e=>{if(!this.enableEditContextMenus)return;e.preventDefault(),e.stopPropagation();const i=T_.Create({Remove:async()=>{var e;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Remove material: Remove material from this variation list?"))&&(n.materials=n.materials.filter((e=>e.uuid!==t.id)),this.refreshUi(),T_.Remove())},"Remove All":async()=>{var e;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Remove all: Remove all materials from this variation list?"))&&(n.materials=[],this.refreshUi(),T_.Remove())}},e.clientX,e.clientY);document.body.appendChild(i)},i.oncontextmenu=e=>{if(!this.enableEditContextMenus)return;e.preventDefault(),e.stopPropagation();const t=T_.Create({"Rename mapping":async()=>{var e;const t=await(null===(e=this._viewer)||void 0===e?void 0:e.prompt("Change name: New material name to map to",n.uuid,!0));t&&(n.uuid=t,this.refreshUi())},"Rename title":async()=>{var e;const t=await(null===(e=this._viewer)||void 0===e?void 0:e.prompt("Change name: New material name to map to",n.title,!0));t&&(n.title=t,this.refreshUi())},"Remove Section":async()=>{var e;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Remove variations: Remove this category of variations?"))&&(this.removeVariation(n),T_.Remove())}},e.clientX,e.clientY);document.body.appendChild(t)}}));return am.RebuildUi(null===(e=this._viewer)||void 0===e?void 0:e.container),!0}}I_.PluginType="MaterialConfiguratorPlugin";class P_ extends _t{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[Ls],this.variations=[],this._selectedSwitchNode=()=>{var e;const t=null===(e=this._picking)||void 0===e?void 0:e.getSelectedObject();if(!t)return;const n=this.variations.map((e=>e.name));let i;return t.traverseAncestors((e=>{i||e.name&&n.includes(e.name)&&(i=e)})),i},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map((e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()})))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find((t=>t.name===e.name)),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find((t=>t.name===e.name)),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find((t=>t.name===e.name)),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map((e=>({label:e,value:e})))}]]}}async onAdded(e){var t,n;await super.onAdded(e),this._picking=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Picking"),null===(n=this._picking)||void 0===n||n.addEventListener("selectedObjectChanged",(()=>{var e,t;null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e)})),e.addEventListener("postFrame",(()=>{this._uiNeedRefresh&&this._refreshUi()})),e.addEventListener("preRender",(()=>{if(this._viewer&&this.enabled){for(const e of this.variations){if(!e.name)continue;const t=this._viewer.scene.getObjectByName(e.name);if(!t||t.children.length<1)return;e.selected||(e.selected=t.children[0].name||t.children[0].uuid);for(const n of t.children)n.userData.__oldVisible=n.visible,n.visible=(n.name||n.uuid)===e.selected}this._isVisibleChanged=!0}})),e.addEventListener("postRender",(()=>{if(this._viewer&&this._isVisibleChanged){for(const e of this.variations){if(!e.name)continue;const t=this._viewer.scene.getObjectByName(e.name);if(!t||t.children.length<1)return;for(const e of t.children){if(void 0===e.userData.__oldVisible)return;e.visible=e.userData.__oldVisible,delete e.userData.__oldVisible}}this._isVisibleChanged=!1}})),this.addEventListener("deserialize",(async()=>{this.refreshUi()}))}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e),!0)}}!function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([re()],P_.prototype,"variations",void 0);class R_ extends P_{_refreshUi(){var e;if(!super._refreshUi())return!1;am.RemoveAll(R_.PluginType);for(const t of this.variations){const e=this._viewer.scene.getObjectByName(t.name);e?(e.children.length<1&&console.warn("SwitchNode does not have enough children",t),am.Create(R_.PluginType,t.title,Math.min(5,e.children.length),20,0,e.children.map((e=>{const i=t.camView,r=new n.Pa4((i.includes("right")?1:0)-(i.includes("left")?1:0),(i.includes("top")?1:0)-(i.includes("bottom")?1:0),(i.includes("front")?1:0)-(i.includes("back")?1:0));t.camDistance||(t.camDistance=1);const s=rm(this._viewer,e,void 0,7,r.multiplyScalar(.5*t.camDistance));return{id:e.uuid,image:s,onClick:()=>{var n;t.selected=e.name||e.uuid,null===(n=this._viewer)||void 0===n||n.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:e.name||e.uuid}})),((e,t)=>M_(e,{placement:"bottom",content:t.tooltip})))):console.warn("no object found for variation, skipping",t)}return am.RebuildUi(null===(e=this._viewer)||void 0===e?void 0:e.container),!0}}R_.PluginType="SwitchNodePlugin";class D_ extends _t{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&(null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0))},this.dependencies=[Ls],this._selectedObject=()=>{var e;return(null===(e=this._picking)||void 0===e?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return(null===(e=this._selectedObject())||void 0===e?void 0:e.material)||void 0}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Picking"),this._previewGenerator=new sm(this._viewer),null===(n=this._picking)||void 0===n||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,n;return null===(t=this._previewGenerator)||void 0===t||t.dispose(),this._previewGenerator=void 0,null===(n=this._picking)||void 0===n||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}D_.PluginType="MaterialLibraryBasePlugin",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe("Enabled")],D_.prototype,"enabled",void 0);class k_ extends D_{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:De(),children:[...He(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Ls).materials.getAllMaterials().map((e=>({label:e.name||e.uuid,value:e.uuid})))||[]]],getValue:()=>{var e;return null===(e=this._selectedMaterial())||void 0===e?void 0:e.uuid},setValue:e=>{var t,n,i,r,s;const o=null===(i=null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(Ls))||void 0===n?void 0:n.materials)||void 0===i?void 0:i.findMaterial(e);if(o)if(this.replaceMaterial)null===(s=null===(r=this._selectedObject())||void 0===r?void 0:r.setMaterial)||void 0===s||s.call(r,o);else{const e=this._selectedMaterial();if(e){const t=e.name,n=e.uuid;e.copyProps(o),e.name=t,e.uuid=n,e.userData.uuid&&(e.userData.uuid=n)}}this._refreshUi()}})]}}async _refreshUi(){var e,n,i;if(!await super._refreshUi())return!1;const r=[Pt.TypeSlug,Kl.TypeSlug],s=null===(n=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Ls))||void 0===n?void 0:n.materials,o=r.map((e=>[e,null==s?void 0:s.getMaterialsOfType(e)]));am.RemoveAll(k_.PluginType);for(const[a,l]of o)am.Create(k_.PluginType,a,5,20,0,null==l?void 0:l.filter((e=>!e.userData.runtimeMaterial)).map((e=>{let n;const i="generate:sphere";if(i.startsWith("generate:"))n=this._previewGenerator.generate(e,i.split(":")[1]);else{const r=e[i]||"#ff00ff";n=r.image?(0,t.imageBitmapToBase64)(r.image,100):void 0,n||(n=(0,t.makeColorSvg)(r))}return{id:e.uuid,image:n,onClick:e=>{const t=null==s?void 0:s.findMaterial(e);if(t){const e=t.userData.__appliedMeshes;if(null==e?void 0:e.size){const t=e.keys().next().value;t.dispatchEvent({type:"select",value:t})}}},tooltip:e.name||e.uuid}})),((e,t)=>M_(e,{placement:"bottom",content:t.tooltip})));return am.RebuildUi(null===(i=this._viewer)||void 0===i?void 0:i.container),!0}}k_.PluginType="MaterialLibraryPlugin",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe("Replace Material")],k_.prototype,"replaceMaterial",void 0);class B_ extends n.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,n){e.vertexShader=e.vertexShader.replace("#include <project_vertex>","\n#include <project_vertex>\ngl_Position = vec4(uv*2.-1., 0, 1.); \n        "),e.vertexShader=e.vertexShader.replace("void main() {","\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n        "),e.fragmentShader=e.fragmentShader.replace("void main() {","\nvarying vec2 vUv;\nuniform sampler2D tLastThis;\nvoid main() {\n        "),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",t.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,n)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}!function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([j({propKey:"tLastThis"})],B_.prototype,"lastFrameTexture",void 0);var O_=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class L_ extends t.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.shadowMapType=n._MY,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(e,n)=>t.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(e,i,r)=>{"aoMap"===this.groundMapMode?e.fragmentShader=ot(e.fragmentShader,"#include <aomap_fragment>",ot(n.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):"map"===this.groundMapMode?e.fragmentShader=ot(e.fragmentShader,"#include <map_fragment>",ot(n.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):"alphaMap"===this.groundMapMode&&(e.fragmentShader=ot(e.fragmentShader,"#include <alphamap_fragment>",ot(n.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),e.fragmentShader=ot(e.fragmentShader,"#include <output_fragment>",t.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&r.capabilities.isWebGL2&&(e.defines.USE_UV="",e.fragmentShader=ot(e.fragmentShader,"#include <output_fragment>",t.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV // why are we checking for this? this is always supposed to be true
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(e,t)=>{t.materialObject.userData.gMapMode!==this.groundMapMode&&(t.materialObject.userData.gMapMode=this.groundMapMode,t.materialObject.needsUpdate=!0)},isCompatible:e=>e.isMeshStandardMaterial2},this._viewer=e;const i=new _l(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new n.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new n.Pa4(10,10,10),normalDirection:new n.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new B_({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:n.jFi}),this._shadowBlurMat=new ct({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new n.FM8(.5,.5)},direction:{value:new n.FM8(.5,.5)}},vertexShader:lo,fragmentShader:"#include <packing>\nuniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}"})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),"alphaMap"===this.groundMapMode?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,n;null===(t=null===(e=this.materialExtension)||void 0===e?void 0:e.setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()}fromJSON(e,t){return ce(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e)return!1;if(++this._frameNumber>this.maxFrameNumber)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:n.ywz,depthBuffer:!1,size:new n.FM8(t,t),sizeMultiplier:void 0,colorSpace:n.aCh,format:n.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const i=this._viewer.renderer.rendererObject,r=i.shadowMap,s=r.type,o=r.needsUpdate,a=r.autoUpdate;r.type=this.shadowMapType,r.needsUpdate=!0,r.autoUpdate=!1;const l=this._viewer.scene,c=new n.S9g;c.disableAll(),l.modelObject.traverse((e=>{e.isLight&&e!==this._light.lightObject&&(e.userData.__gp_layers=e.layers,e.layers=c)}));const u=l.activeCamera.cameraObject;if(0!=(u.layers.mask&1<<this._lightLayer))throw"Camera can render pseudo directional light, check layers";u.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),H(i,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},(()=>this._viewer.renderer.renderScene(l))),u.layers.disable(this._lightLayer);const d=u.layers.mask;u.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const h=this._viewer.renderer.getTempTarget({type:n.ywz,depthBuffer:!1,size:new n.FM8(t,t),colorSpace:n.aCh,format:n.wk1}),p=h.texture.colorSpace;h.texture.colorSpace=n.aCh,this._viewer.renderer.blit(this._target.texture,h,{clear:!0});{const t=e.material,n=e.frustumCulled,r=i.getRenderTarget(),s=i.getActiveCubeFace(),o=i.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,i.setRenderTarget(this._target);const a=!1;this._shadowMat.opacity=a?1/this.maxFrameNumber:Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=h.texture,this._shadowMat.needsUpdate=!0,H(i,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},(()=>this._viewer.renderer.renderScene(l))),i.setRenderTarget(r,s,o),e.frustumCulled=n,e.material=t,this.smoothShadow&&this._applySmoothFilter(this._target,h)}return h.texture.colorSpace=p,this._viewer.renderer.releaseTempTarget(h),e.layers.disable(this._lightLayer),u.layers.mask=d,l.modelObject.traverse((e=>{e.isLight&&e!==this._light.lightObject&&(e.layers=e.userData.__gp_layers,delete e.userData.__gp_layers)})),r.type=s,r.needsUpdate=o,r.autoUpdate=a,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,n,i;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===(null===(t=this._target)||void 0===t?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===(null===(n=this._target)||void 0===n?void 0:n.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===(null===(i=this._target)||void 0===i?void 0:i.texture)&&(this._attachedMesh.material.map=null)):this._target&&("alphaMap"===this.groundMapMode&&(this._attachedMesh.material.alphaMap=this._target.texture),"aoMap"===this.groundMapMode&&(this._attachedMesh.material.aoMap=this._target.texture),"map"===this.groundMapMode&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&"alphaMap"===this.groundMapMode,this._attachedMesh.material.alphaTest=e||"alphaMap"!==this.groundMapMode?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}O_([re("randomizedLight")],L_.prototype,"_light",void 0),O_([(0,t.onChange)(L_.prototype.reset),re()],L_.prototype,"maxFrameNumber",void 0),O_([(0,t.onChange)(L_.prototype.reset),re()],L_.prototype,"smoothShadow",void 0),O_([re(),(0,t.onChange)(L_.prototype.reset)],L_.prototype,"shadowMapType",void 0),O_([(0,t.onChange)(L_.prototype._groundMapModeChanged),re()],L_.prototype,"groundMapMode",void 0),O_([re(),(0,t.onChange)(L_.prototype._alphaVignetteChanged)],L_.prototype,"alphaVignette",void 0),O_([re(),(0,t.onChange)(L_.prototype._alphaVignetteChanged)],L_.prototype,"alphaVignetteAxis",void 0),O_([re()],L_.prototype,"maxBakeCount",void 0);var U_=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class N_ extends n.Kj0{_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,null===(t=null===(e=this.materialExtension)||void 0===e?void 0:e.setDirty)||void 0===t||t.call(e)}constructor(e,t,i=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new n.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(e,t,n)=>{if(this.enabled){e.vertexShader=ot(e.vertexShader,"void main() {","void main() {\nvRefUv = refTextureMatrix * vec4( position, 1.0 );");const t="#glMarker beforeModulation";e.fragmentShader=ot(e.fragmentShader,t,"\n                    if(roughnessFactor < 0.95) {\n                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;\n                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));\n                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);\n                        // refBaseColor.rgb = vec3(refBaseColor.a);\n                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);\n                        "+(this.reflectorModePhysical?"\n                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 \n                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);\n                        #endif\n                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);\n                        ":"\n                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);\n                        diffuseColor.a *= refBaseColor.a;\n                        ")+"}\n"+t)}},parsVertexSnippet:()=>this.enabled?"\n\t\tuniform mat4 refTextureMatrix;\n\t\tvarying vec4 vRefUv;\n":"",parsFragmentSnippet:()=>this.enabled?bo+"\n"+co+"\n#ifndef D_sceneBoundingRadius\n#define D_sceneBoundingRadius \nuniform float sceneBoundingRadius;\n#endif\nvarying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();\n#pragma unroll_loop_start\nfor(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}\n#pragma unroll_loop_end\nreturn vec4(colorSum/weightSum,1.);}":"",computeCacheKey:e=>this.enabled+" "+e.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(e,{materialObject:t})=>{t.userData.__lastTransparent!==t.transparent&&(t.needsUpdate=!0,t.userData.__lastTransparent=t.transparent)},isCompatible:e=>e.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const r=new n.JOQ,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4,l=new n.yGw,c=new n.Pa4(0,0,-1),u=new n.Ltg,d=new n.Pa4,h=new n.Pa4,p=new n.Ltg,f=new n.yGw,m=new n.cPb;n.M8C.isPowerOfTwo(t.texture.image.width)&&n.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(e,t,n)=>{if(!this.enabled||!e.userData.mainRenderPass)return;if(!this.reflectionTargetNeedsUpdate)return;const g=n.view?Object.assign({},n.view):null;if(g&&n.clearViewOffset&&n.clearViewOffset(),o.setFromMatrixPosition(this.matrixWorld),a.setFromMatrixPosition(n.matrixWorld),l.extractRotation(this.matrixWorld),s.set(0,0,1),s.applyMatrix4(l),d.subVectors(o,a),d.dot(s)>0)return;d.reflect(s).negate(),d.add(o),l.extractRotation(n.matrixWorld),c.set(0,0,-1),c.applyMatrix4(l),c.add(a),h.subVectors(o,c),h.reflect(s).negate(),h.add(o),m.position.copy(d),m.up.set(0,1,0),m.up.applyMatrix4(l),m.up.reflect(s),m.lookAt(h),m.far=2,m.near=0,m.updateMatrixWorld(),m.projectionMatrix.copy(n.projectionMatrix),f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(m.projectionMatrix),f.multiply(m.matrixWorldInverse),f.multiply(this.matrixWorld),r.setFromNormalAndCoplanarPoint(s,o),r.applyMatrix4(m.matrixWorldInverse),u.set(r.normal.x,r.normal.y,r.normal.z,r.constant);const _=m.projectionMatrix;p.x=(Math.sign(u.x)+_.elements[8])/_.elements[0],p.y=(Math.sign(u.y)+_.elements[9])/_.elements[5],p.z=-1,p.w=(1+_.elements[10])/_.elements[14],u.multiplyScalar(2/u.dot(p)),_.elements[2]=u.x,_.elements[6]=u.y,_.elements[10]=u.z+1-i,_.elements[14]=u.w,this.visible=!1;const v=e.getRenderTarget(),y=e.xr.enabled,b=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(this._renderTarget),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear();const A=t.background;this.transparentReflectionBackground&&(t.background=null);const w=!this.transparentReflectionBackground;(null==A?void 0:A.isTexture)&&w&&(A.userData||(A.userData={}),A.userData.flipX=!A.userData.flipX),H(e,{shadowMapRender:!1,backgroundRender:w,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},(()=>e.render(t,m))),(null==A?void 0:A.isTexture)&&w&&(A.userData.flipX=!A.userData.flipX||void 0),this.transparentReflectionBackground&&(t.background=A),e.xr.enabled=y,e.shadowMap.autoUpdate=b,e.setRenderTarget(v),(null==g?void 0:g.enabled)&&n.setViewOffset&&n.setViewOffset(g.fullWidth,g.fullHeight,g.offsetX,g.offsetY,g.width,g.height);const x=n.viewport;void 0!==x&&e.state.viewport(x),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=f,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new n.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=f}getRenderTarget(){return this._renderTarget}}U_([(0,t.onChange)(N_.prototype._updateExtension)],N_.prototype,"enabled",void 0),U_([(0,t.onChange)(N_.prototype._updateExtension)],N_.prototype,"reflectorModePhysical",void 0),N_.prototype.isReflector=!0;var F_=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class j_ extends _t{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Ls],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new n._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new n.Kj0(this._geometry)}async onAdded(e){var t,n;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Ls);const i=this._createMesh();i.userData.physicsMass=0,this._iMesh=await(null===(t=this._manager)||void 0===t?void 0:t.addImportedSingle(i,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=null===(n=this._iMesh)||void 0===n?void 0:n.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,n,i;return this._removeMaterial(),this._geometry.dispose(),null===(t=this._material)||void 0===t||t.dispose(),null===(i=null===(n=this._iMesh)||void 0===n?void 0:n.dispose)||void 0===i||i.call(n),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){!1!==(null==e?void 0:e.geometryChanged)&&!1!==(null==e?void 0:e.updateGround)&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const t=null===(e=this._viewer)||void 0===e?void 0:e.scene.activeCamera.controls;t&&(void 0!==t.maxPolarAngle?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=t.maxPolarAngle),t.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(t.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,t,i;if(!this._mesh)return;if(!this._viewer)return;let r=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,r=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const e=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const t=e.getCenter(new n.Pa4).sub(new n.Pa4(0,e.getSize(new n.Pa4).y/2+this.yOffset,0));r=r||t.clone().sub(this._mesh.position).length()>1e-4,r&&this._mesh.position.copy(t)}r=r||Math.abs(this._mesh.scale.x-this.size)>1e-4,r&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new n.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,null===(i=(t=this._mesh).setDirty)||void 0===i||i.call(t)),this._transformNeedRefresh=!1}else r&&(null===(e=this._viewer)||void 0===e||e.scene.setDirty())}_refreshMaterial(){var e,t,n,i,r,s;if(!this._viewer)return!1;if(!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const o=null!==(e=this._material)&&void 0!==e?e:null===(n=null===(t=this._manager)||void 0===t?void 0:t.materials)||void 0===n?void 0:n.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});o&&o.userData.runtimeMaterial;let a=!1;return o!==this._material&&(this._removeMaterial(),o&&(this._material=o),(null===(i=this._material)||void 0===i?void 0:i.uuid)||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(null!==(s=null===(r=this._mesh)||void 0===r?void 0:r.setMaterial)&&void 0!==s?s:e=>{this._mesh&&(this._mesh.material=e.materialObject)})(this._material)),a=!0),this._material&&(void 0===this._material.userData.__renderToDepth&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),void 0===this._material.userData.__postTonemap&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),a}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return null===(e=this._material)||void 0===e?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}F_([re("material")],j_.prototype,"_material",void 0),F_([(0,t.onChange)(j_.prototype.refreshTransform),re()],j_.prototype,"visible",void 0),F_([(0,t.onChange2)(j_.prototype._onSceneUpdate),re()],j_.prototype,"size",void 0),F_([(0,t.onChange2)(j_.prototype._onSceneUpdate),re()],j_.prototype,"yOffset",void 0),F_([(0,t.onChange)(j_.prototype._refreshOptions2),re()],j_.prototype,"renderToDepth",void 0),F_([(0,t.onChange)(j_.prototype._refreshOptions2),re()],j_.prototype,"tonemapGround",void 0),F_([(0,t.onChange)(j_.prototype._refreshCameraLimits),re()],j_.prototype,"limitCameraAboveGround",void 0);var z_=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class G_ extends j_{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;null===(e=this._shadowBaker)||void 0===e||e.reset()}constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=t,t&&this.dependencies.push(bp),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new N_(this._geometry,this._viewer.renderer.createTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:n.D1R,magFilter:n.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...e)=>{var n,i,r,s,o;let a=null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("SSReflection"))||void 0===i?void 0:i.passes.ssr.passObject;a&&!a.enabled&&(a=void 0),a&&(a.enabled=!1);let l=null===(o=null===(s=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("SSBevelPlugin"))||void 0===s?void 0:s.pass)||void 0===o?void 0:o.passObject;l&&!l.enabled&&(l=void 0),l&&(l.enabled=!1),t(...e),a&&(a.enabled=!0),l&&(l.enabled=!0)},e}async onAdded(e){var t,n;await super.onAdded(e),this._showDebug&&(null===(t=e.getPlugin(bp))||void 0===t||t.addTexture("bake_ground_1",(()=>{var e,t;return null===(t=null===(e=this._shadowBaker)||void 0===e?void 0:e.light.shadow.map)||void 0===t?void 0:t.texture}),[100,100,200,200]),null===(n=e.getPlugin(bp))||void 0===n||n.addTexture("bake_ground_2",(()=>{var e,t;return null===(t=null===(e=this._shadowBaker)||void 0===e?void 0:e.target)||void 0===t?void 0:t.texture}),[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,n,i;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&(null===(t=(e=this._material).unregisterMaterialExtensions)||void 0===t||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const e=this._mesh.materialExtension;e||console.warn("WebGi GroundPlugin: unable to find the extension to unregister"),null===(i=(n=this._material).unregisterMaterialExtensions)||void 0===i||i.call(n,[e]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),!1!==e.geometryChanged&&this.autoBakeShadows&&(null===(t=this._shadowBaker)||void 0===t||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new L_(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,t,n,i;if(!this._viewer)return!1;const r=super._refreshMaterial();if(!this._material)return r;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const n=this._mesh.materialExtension;n.updaters=[this._viewer.scene,this._viewer.renderer],null===(t=(e=this._material).registerMaterialExtensions)||void 0===t||t.call(e,[n]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&(null===(i=(n=this._material).registerMaterialExtensions)||void 0===i||i.call(n,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),r}_extraUiConfig(){var e,t,i,r,s,o,a,l,c,u,d,h,p,f,m,g,_,v,y,b,A,w,x,E,C,S,M,T,I,P;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var e,t;return null===(t=null===(e=this._uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var e;return!(null===(e=this._shadowBaker)||void 0===e?void 0:e.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map((e=>({label:e,value:e}))),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"]},{label:"Baked shadow type",type:"dropdown",children:[["Basic",n._MY],["PCF",n._iA],["PCFSoft",n.ntZ],["VSM",n.dwk]].map((e=>({label:e[0].toString(),value:e[1]}))),property:[this._shadowBaker,"shadowMapType"]},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[null===(e=this._shadowBaker)||void 0===e?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[null===(t=this._shadowBaker)||void 0===t?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[null===(r=null===(i=this._shadowBaker)||void 0===i?void 0:i.light)||void 0===r?void 0:r.shadowParams,"enabled"],onChange:[null===(o=null===(s=this._shadowBaker)||void 0===s?void 0:s.light)||void 0===o?void 0:o.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[null===(l=null===(a=this._shadowBaker)||void 0===a?void 0:a.light)||void 0===l?void 0:l.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[null===(u=null===(c=this._shadowBaker)||void 0===c?void 0:c.light)||void 0===u?void 0:u.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[null===(h=null===(d=this._shadowBaker)||void 0===d?void 0:d.light)||void 0===h?void 0:h.randomParams,"distanceScale"],onChange:[null===(f=null===(p=this._shadowBaker)||void 0===p?void 0:p.light)||void 0===f?void 0:f.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[null===(g=null===(m=this._shadowBaker)||void 0===m?void 0:m.light)||void 0===g?void 0:g.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[null===(v=null===(_=this._shadowBaker)||void 0===_?void 0:_.light)||void 0===v?void 0:v.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[null===(b=null===(y=this._shadowBaker)||void 0===y?void 0:y.light)||void 0===b?void 0:b.shadowParams,"radius"],onChange:[null===(w=null===(A=this._shadowBaker)||void 0===A?void 0:A.light)||void 0===w?void 0:w.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[null===(E=null===(x=this._shadowBaker)||void 0===x?void 0:x.light)||void 0===E?void 0:E.shadowParams,"frustumSize"],onChange:[null===(S=null===(C=this._shadowBaker)||void 0===C?void 0:C.light)||void 0===S?void 0:S.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[null===(T=null===(M=this._shadowBaker)||void 0===M?void 0:M.light)||void 0===T?void 0:T.shadowParams,"bias"],onChange:[null===(P=null===(I=this._shadowBaker)||void 0===I?void 0:I.light)||void 0===P?void 0:P.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}G_.PluginType="Ground",z_([(0,t.onChange)(G_.prototype.refreshOptions),re()],G_.prototype,"bakedShadows",void 0),z_([(0,t.onChange)(G_.prototype.refreshOptions),re()],G_.prototype,"groundReflection",void 0),z_([(0,t.onChange)(G_.prototype.refreshOptions),re()],G_.prototype,"physicalReflections",void 0),z_([re("shadowBaker")],G_.prototype,"_shadowBaker",void 0);class V_ extends n.yxD{constructor(e){super(e),this.type=n.cLu}parse(e){const t=65536,i=t>>3,r=14,s=65537,o=1<<r,a=o-1,l=32768,c=65535,u=59,d=63,h=2+d-u,p=4,f=4,m=2,g=1,_=0,v=1,y=0,b=2,A=Math.pow(2.7182818,2.2),w={l:0,c:0,lc:0};function x(e,t,n,i,r){for(;n<e;)t=t<<8|ee(i,r),n+=8;n-=e,w.l=t>>n&(1<<e)-1,w.c=t,w.lc=n}const E=new Array(59);function C(e){return 63&e}function S(e){return e>>6}const M={c:0,lc:0};function T(e,t,n,i){e=e<<8|ee(n,i),t+=8,M.c=e,M.lc=t}const I={c:0,lc:0};function P(e,t,n,i,r,s,o,a,l){if(e==t){i<8&&(T(n,i,r,s),n=M.c,i=M.lc);let e=n>>(i-=8);if(e=new Uint8Array([e])[0],a.value+e>l)return!1;const t=o[a.value-1];for(;e-- >0;)o[a.value++]=t}else{if(!(a.value<l))return!1;o[a.value++]=e}I.c=n,I.lc=i}function R(e){return 65535&e}function D(e){const t=R(e);return t>32767?t-65536:t}const k={a:0,b:0};function B(e,t){const n=D(e),i=D(t),r=n+(1&i)+(i>>1),s=r,o=r-i;k.a=s,k.b=o}function O(e,t){const n=R(e),i=R(t),r=n-(i>>1)&c,s=i+r-l&c;k.a=s,k.b=r}function L(e,t,n,i,r,s,o){const a=o<16384,l=n>r?r:n;let c,u,d=1;for(;d<=l;)d<<=1;for(d>>=1,c=d,d>>=1;d>=1;){u=0;const o=u+s*(r-c),l=s*d,h=s*c,p=i*d,f=i*c;let m,g,_,v;for(;u<=o;u+=h){let r=u;const s=u+i*(n-c);for(;r<=s;r+=f){const n=r+p,i=r+l,s=i+p;a?(B(e[r+t],e[i+t]),m=k.a,_=k.b,B(e[n+t],e[s+t]),g=k.a,v=k.b,B(m,g),e[r+t]=k.a,e[n+t]=k.b,B(_,v),e[i+t]=k.a,e[s+t]=k.b):(O(e[r+t],e[i+t]),m=k.a,_=k.b,O(e[n+t],e[s+t]),g=k.a,v=k.b,O(m,g),e[r+t]=k.a,e[n+t]=k.b,O(_,v),e[i+t]=k.a,e[s+t]=k.b)}if(n&d){const n=r+l;a?B(e[r+t],e[n+t]):O(e[r+t],e[n+t]),m=k.a,e[n+t]=k.b,e[r+t]=m}}if(r&d){let r=u;const s=u+i*(n-c);for(;r<=s;r+=f){const n=r+p;a?B(e[r+t],e[n+t]):O(e[r+t],e[n+t]),m=k.a,e[n+t]=k.b,e[r+t]=m}}c=d,d>>=1}return u}function U(e,t,n,i,l,c){const p=n.value,f=$(t,n),m=$(t,n);n.value+=4;const g=$(t,n);if(n.value+=4,f<0||f>=s||m<0||m>=s)throw new Error("Something wrong with HUF_ENCSIZE");const _=new Array(s),v=new Array(o);if(function(e){for(let t=0;t<o;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(v),function(e,t,n,i,r,o){const a=t;let l=0,c=0;for(;i<=r;i++){if(a.value-t.value>n)return!1;x(6,l,c,e,a);const s=w.l;if(l=w.c,c=w.lc,o[i]=s,s==d){if(a.value-t.value>n)throw new Error("Something wrong with hufUnpackEncTable");x(8,l,c,e,a);let s=w.l+h;if(l=w.c,c=w.lc,i+s>r+1)throw new Error("Something wrong with hufUnpackEncTable");for(;s--;)o[i++]=0;i--}else if(s>=u){let e=s-u+2;if(i+e>r+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)o[i++]=0;i--}}!function(e){for(let n=0;n<=58;++n)E[n]=0;for(let n=0;n<s;++n)E[e[n]]+=1;let t=0;for(let n=58;n>0;--n){const e=t+E[n]>>1;E[n]=t,t=e}for(let n=0;n<s;++n){const t=e[n];t>0&&(e[n]=t|E[t]++<<6)}}(o)}(e,n,i-(n.value-p),f,m,_),g>8*(i-(n.value-p)))throw new Error("Something wrong with hufUncompress");!function(e,t,n,i){for(;t<=n;t++){const n=S(e[t]),s=C(e[t]);if(n>>s)throw new Error("Invalid table entry");if(s>r){const e=i[n>>s-r];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){const t=e.p;e.p=new Array(e.lit);for(let n=0;n<e.lit-1;++n)e.p[n]=t[n]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(s){let e=0;for(let o=1<<r-s;o>0;o--){const o=i[(n<<r-s)+e];if(o.len||o.p)throw new Error("Invalid table entry");o.len=s,o.lit=t,e++}}}}(_,f,m,v),function(e,t,n,i,s,o,l,c,u){let d=0,h=0;const p=l,f=Math.trunc(i.value+(s+7)/8);for(;i.value<f;)for(T(d,h,n,i),d=M.c,h=M.lc;h>=r;){const s=t[d>>h-r&a];if(s.len)h-=s.len,P(s.lit,o,d,h,n,i,c,u,p),d=I.c,h=I.lc;else{if(!s.p)throw new Error("hufDecode issues");let t;for(t=0;t<s.lit;t++){const r=C(e[s.p[t]]);for(;h<r&&i.value<f;)T(d,h,n,i),d=M.c,h=M.lc;if(h>=r&&S(e[s.p[t]])==(d>>h-r&(1<<r)-1)){h-=r,P(s.p[t],o,d,h,n,i,c,u,p),d=I.c,h=I.lc;break}}if(t==s.lit)throw new Error("hufDecode issues")}}const m=8-s&7;for(d>>=m,h-=m;h>0;){const e=t[d<<r-h&a];if(!e.len)throw new Error("hufDecode issues");h-=e.len,P(e.lit,o,d,h,n,i,c,u,p),d=I.c,h=I.lc}}(_,v,e,n,g,m,c,l,{value:0})}function N(e){for(let t=1;t<e.length;t++){const n=e[t-1]+e[t]-128;e[t]=n}}function F(e,t){let n=0,i=Math.floor((e.length+1)/2),r=0;const s=e.length-1;for(;!(r>s||(t[r++]=e[n++],r>s));)t[r++]=e[i++]}function j(e){let t=e.byteLength;const n=new Array;let i=0;const r=new DataView(e);for(;t>0;){const e=r.getInt8(i++);if(e<0){const s=-e;t-=s+1;for(let e=0;e<s;e++)n.push(r.getUint8(i++))}else{const s=e;t-=2;const o=r.getUint8(i++);for(let e=0;e<s+1;e++)n.push(o)}}return n}function z(e,t,n){let i,r=1;for(;r<64;)i=t[e.value],65280==i?r=64:i>>8==255?r+=255&i:(n[r]=i,r++),e.value++}function G(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),i=.5*Math.cos(3.14159/8),r=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625),l=new Array(4),c=new Array(4),u=new Array(4),d=new Array(4);for(let h=0;h<8;++h){const p=8*h;l[0]=i*e[p+2],l[1]=o*e[p+2],l[2]=i*e[p+6],l[3]=o*e[p+6],c[0]=n*e[p+1]+r*e[p+3]+s*e[p+5]+a*e[p+7],c[1]=r*e[p+1]-a*e[p+3]-n*e[p+5]-s*e[p+7],c[2]=s*e[p+1]-n*e[p+3]+a*e[p+5]+r*e[p+7],c[3]=a*e[p+1]-s*e[p+3]+r*e[p+5]-n*e[p+7],u[0]=t*(e[p+0]+e[p+4]),u[3]=t*(e[p+0]-e[p+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],d[0]=u[0]+u[1],d[1]=u[3]+u[2],d[2]=u[3]-u[2],d[3]=u[0]-u[1],e[p+0]=d[0]+c[0],e[p+1]=d[1]+c[1],e[p+2]=d[2]+c[2],e[p+3]=d[3]+c[3],e[p+4]=d[3]-c[3],e[p+5]=d[2]-c[2],e[p+6]=d[1]-c[1],e[p+7]=d[0]-c[0]}for(let h=0;h<8;++h)l[0]=i*e[16+h],l[1]=o*e[16+h],l[2]=i*e[48+h],l[3]=o*e[48+h],c[0]=n*e[8+h]+r*e[24+h]+s*e[40+h]+a*e[56+h],c[1]=r*e[8+h]-a*e[24+h]-n*e[40+h]-s*e[56+h],c[2]=s*e[8+h]-n*e[24+h]+a*e[40+h]+r*e[56+h],c[3]=a*e[8+h]-s*e[24+h]+r*e[40+h]-n*e[56+h],u[0]=t*(e[h]+e[32+h]),u[3]=t*(e[h]-e[32+h]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],d[0]=u[0]+u[1],d[1]=u[3]+u[2],d[2]=u[3]-u[2],d[3]=u[0]-u[1],e[0+h]=d[0]+c[0],e[8+h]=d[1]+c[1],e[16+h]=d[2]+c[2],e[24+h]=d[3]+c[3],e[32+h]=d[3]-c[3],e[40+h]=d[2]-c[2],e[48+h]=d[1]-c[1],e[56+h]=d[0]-c[0]}function V(e){for(let t=0;t<64;++t){const n=e[0][t],i=e[1][t],r=e[2][t];e[0][t]=n+1.5747*r,e[1][t]=n-.1873*i-.4682*r,e[2][t]=n+1.8556*i}}function H(e,t,i){for(let s=0;s<64;++s)t[i+s]=n.A5E.toHalfFloat((r=e[s])<=1?Math.sign(r)*Math.pow(Math.abs(r),2.2):Math.sign(r)*Math.pow(A,Math.abs(r)-1));var r}function Q(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function W(e){const t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(j(t)),i=new Uint8Array(n.length);return N(n),F(n,i),new DataView(i.buffer)}function q(e){const t=If(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return N(t),F(t,n),new DataView(n.buffer)}function X(e){const n=e.viewer,r={value:e.offset.value},s=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(i);let a=0;const l=new Array(e.channels);for(let t=0;t<e.channels;t++)l[t]={},l[t].start=a,l[t].end=l[t].start,l[t].nx=e.width,l[t].ny=e.lines,l[t].size=e.type,a+=l[t].nx*l[t].ny*l[t].size;const c=oe(n,r),u=oe(n,r);if(u>=i)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(c<=u)for(let t=0;t<u-c+1;t++)o[t+c]=te(n,r);const d=new Uint16Array(t),h=function(e,n){let i=0;for(let s=0;s<t;++s)(0==s||e[s>>3]&1<<(7&s))&&(n[i++]=s);const r=i-1;for(;i<t;)n[i++]=0;return r}(o,d),p=$(n,r);U(e.array,n,r,p,s,a);for(let t=0;t<e.channels;++t){const e=l[t];for(let n=0;n<l[t].size;++n)L(s,e.start+n,e.nx,e.size,e.ny,e.nx*e.size,h)}!function(e,t,n){for(let i=0;i<n;++i)t[i]=e[t[i]]}(d,s,a);let f=0;const g=new Uint8Array(s.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let n=0;n<e.channels;n++){const e=l[n],t=e.nx*e.size,i=new Uint8Array(s.buffer,e.end*m,t*m);g.set(i,f),f+=t*m,e.end+=t}return new DataView(g.buffer)}function Y(e){const t=If(e.array.slice(e.offset.value,e.offset.value+e.size)),n=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(n):new Uint32Array(n);let r=0,s=0;const o=new Array(4);for(let a=0;a<e.lines;a++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:o[0]=r,o[1]=o[0]+e.width,r=o[1]+e.width;for(let r=0;r<e.width;++r)n+=t[o[0]++]<<8|t[o[1]++],i[s]=n,s++;break;case 2:o[0]=r,o[1]=o[0]+e.width,o[2]=o[1]+e.width,r=o[2]+e.width;for(let r=0;r<e.width;++r)n+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,i[s]=n,s++}}return new DataView(i.buffer)}function K(e){const t=e.viewer,n={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*m)),r={version:ne(t,n),unknownUncompressedSize:ne(t,n),unknownCompressedSize:ne(t,n),acCompressedSize:ne(t,n),dcCompressedSize:ne(t,n),rleCompressedSize:ne(t,n),rleUncompressedSize:ne(t,n),rleRawSize:ne(t,n),totalAcUncompressedCount:ne(t,n),totalDcUncompressedCount:ne(t,n),acCompression:ne(t,n)};if(r.version<2)throw new Error("EXRLoader.parse: "+he.compression+" version "+r.version+" is unsupported");const s=new Array;let o=oe(t,n)-m;for(;o>0;){const e=J(t.buffer,n),i=te(t,n),r=i>>2&3,a=new Int8Array([(i>>4)-1])[0],l=te(t,n);s.push({name:e,index:a,type:l,compression:r}),o-=e.length+3}const a=he.channels,l=new Array(e.channels);for(let m=0;m<e.channels;++m){const t=l[m]={},n=a[m];t.name=n.name,t.compression=y,t.decoded=!1,t.type=n.pixelType,t.pLinear=n.pLinear,t.width=e.width,t.height=e.lines}const c={idx:new Array(3)};for(let m=0;m<e.channels;++m){const e=l[m];for(let t=0;t<s.length;++t){const n=s[t];e.name==n.name&&(e.compression=n.compression,n.index>=0&&(c.idx[n.index]=m),e.offset=m)}}let u,d,h;if(r.acCompressedSize>0)switch(r.acCompression){case _:u=new Uint16Array(r.totalAcUncompressedCount),U(e.array,t,n,r.acCompressedSize,u,r.totalAcUncompressedCount);break;case v:const i=If(e.array.slice(n.value,n.value+r.totalAcUncompressedCount));u=new Uint16Array(i.buffer),n.value+=r.totalAcUncompressedCount}if(r.dcCompressedSize>0){const t={array:e.array,offset:n,size:r.dcCompressedSize};d=new Uint16Array(q(t).buffer),n.value+=r.dcCompressedSize}r.rleRawSize>0&&(h=j(If(e.array.slice(n.value,n.value+r.rleCompressedSize)).buffer),n.value+=r.rleCompressedSize);let p=0;const f=new Array(l.length);for(let m=0;m<f.length;++m)f[m]=new Array;for(let g=0;g<e.lines;++g)for(let t=0;t<l.length;++t)f[t].push(p),p+=l[t].width*e.type*m;!function(e,t,n,i,r,s){let o=new DataView(s.buffer);const a=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(a/8),u=Math.ceil(a/8),d=Math.ceil(l/8),h=a-8*(u-1),p=l-8*(d-1),f={value:0},g=new Array(3),_=new Array(3),v=new Array(3),y=new Array(3),b=new Array(3);for(let m=0;m<3;++m)b[m]=t[e.idx[m]],g[m]=m<1?0:g[m-1]+u*d,_[m]=new Float32Array(64),v[m]=new Uint16Array(64),y[m]=new Uint16Array(64*u);for(let E=0;E<d;++E){let t=8;E==d-1&&(t=p);let s=8;for(let e=0;e<u;++e){e==u-1&&(s=h);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=r[g[e]++],z(f,i,v[e]),A=v[e],(w=_[e])[0]=se(A[0]),w[1]=se(A[1]),w[2]=se(A[5]),w[3]=se(A[6]),w[4]=se(A[14]),w[5]=se(A[15]),w[6]=se(A[27]),w[7]=se(A[28]),w[8]=se(A[2]),w[9]=se(A[4]),w[10]=se(A[7]),w[11]=se(A[13]),w[12]=se(A[16]),w[13]=se(A[26]),w[14]=se(A[29]),w[15]=se(A[42]),w[16]=se(A[3]),w[17]=se(A[8]),w[18]=se(A[12]),w[19]=se(A[17]),w[20]=se(A[25]),w[21]=se(A[30]),w[22]=se(A[41]),w[23]=se(A[43]),w[24]=se(A[9]),w[25]=se(A[11]),w[26]=se(A[18]),w[27]=se(A[24]),w[28]=se(A[31]),w[29]=se(A[40]),w[30]=se(A[44]),w[31]=se(A[53]),w[32]=se(A[10]),w[33]=se(A[19]),w[34]=se(A[23]),w[35]=se(A[32]),w[36]=se(A[39]),w[37]=se(A[45]),w[38]=se(A[52]),w[39]=se(A[54]),w[40]=se(A[20]),w[41]=se(A[22]),w[42]=se(A[33]),w[43]=se(A[38]),w[44]=se(A[46]),w[45]=se(A[51]),w[46]=se(A[55]),w[47]=se(A[60]),w[48]=se(A[21]),w[49]=se(A[34]),w[50]=se(A[37]),w[51]=se(A[47]),w[52]=se(A[50]),w[53]=se(A[56]),w[54]=se(A[59]),w[55]=se(A[61]),w[56]=se(A[35]),w[57]=se(A[36]),w[58]=se(A[48]),w[59]=se(A[49]),w[60]=se(A[57]),w[61]=se(A[58]),w[62]=se(A[62]),w[63]=se(A[63]),G(_[e]);V(_);for(let t=0;t<3;++t)H(_[t],y[t],64*e)}let a=0;for(let i=0;i<3;++i){const r=n[e.idx[i]].type;for(let e=8*E;e<8*E+t;++e){a=b[i][e];for(let t=0;t<c;++t){const n=64*t+8*(7&e);o.setUint16(a+0*m*r,y[i][n+0],!0),o.setUint16(a+1*m*r,y[i][n+1],!0),o.setUint16(a+2*m*r,y[i][n+2],!0),o.setUint16(a+3*m*r,y[i][n+3],!0),o.setUint16(a+4*m*r,y[i][n+4],!0),o.setUint16(a+5*m*r,y[i][n+5],!0),o.setUint16(a+6*m*r,y[i][n+6],!0),o.setUint16(a+7*m*r,y[i][n+7],!0),a+=8*m*r}}if(c!=u)for(let e=8*E;e<8*E+t;++e){const t=b[i][e]+8*c*m*r,n=64*c+8*(7&e);for(let e=0;e<s;++e)o.setUint16(t+e*m*r,y[i][n+e],!0)}}}var A,w;const x=new Uint16Array(a);o=new DataView(s.buffer);for(let E=0;E<3;++E){n[e.idx[E]].decoded=!0;const t=n[e.idx[E]].type;if(2==n[E].type)for(let e=0;e<l;++e){const n=b[E][e];for(let e=0;e<a;++e)x[e]=o.getUint16(n+e*m*t,!0);for(let e=0;e<a;++e)o.setFloat32(n+e*m*t,se(x[e]),!0)}}}(c,f,l,u,d,i);for(let g=0;g<l.length;++g){const t=l[g];if(!t.decoded){if(t.compression!==b)throw new Error("EXRLoader.parse: unsupported channel compression");{let n=0,r=0;for(let s=0;s<e.lines;++s){let e=f[g][n];for(let n=0;n<t.width;++n){for(let n=0;n<m*t.type;++n)i[e++]=h[r+n*t.width*t.height];r++}n++}}}}return new DataView(i.buffer)}function J(e,t){const n=new Uint8Array(e);let i=0;for(;0!=n[t.value+i];)i+=1;const r=(new TextDecoder).decode(n.slice(t.value,t.value+i));return t.value=t.value+i+1,r}function Z(e,t){const n=e.getInt32(t.value,!0);return t.value=t.value+f,n}function $(e,t){const n=e.getUint32(t.value,!0);return t.value=t.value+f,n}function ee(e,t){const n=e[t.value];return t.value=t.value+g,n}function te(e,t){const n=e.getUint8(t.value);return t.value=t.value+g,n}const ne=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function ie(e,t){const n=e.getFloat32(t.value,!0);return t.value+=p,n}function re(e,t){return n.A5E.toHalfFloat(ie(e,t))}function se(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function oe(e,t){const n=e.getUint16(t.value,!0);return t.value+=m,n}function ae(e,t){return se(oe(e,t))}function le(e,t,n,i,r){return"string"===i||"stringvector"===i||"iccProfile"===i?function(e,t,n){const i=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,i}(t,n,r):"chlist"===i?function(e,t,n,i){const r=n.value,s=[];for(;n.value<r+i-1;){const i=J(t,n),r=Z(e,n),o=te(e,n);n.value+=3;const a=Z(e,n),l=Z(e,n);s.push({name:i,pixelType:r,pLinear:o,xSampling:a,ySampling:l})}return n.value+=1,s}(e,t,n,r):"chromaticities"===i?function(e,t){return{redX:ie(e,t),redY:ie(e,t),greenX:ie(e,t),greenY:ie(e,t),blueX:ie(e,t),blueY:ie(e,t),whiteX:ie(e,t),whiteY:ie(e,t)}}(e,n):"compression"===i?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][te(e,t)]}(e,n):"box2i"===i?function(e,t){return{xMin:$(e,t),yMin:$(e,t),xMax:$(e,t),yMax:$(e,t)}}(e,n):"lineOrder"===i?function(e,t){return["INCREASING_Y"][te(e,t)]}(e,n):"float"===i?ie(e,n):"v2f"===i?function(e,t){return[ie(e,t),ie(e,t)]}(e,n):"v3f"===i?function(e,t){return[ie(e,t),ie(e,t),ie(e,t)]}(e,n):"int"===i?Z(e,n):"rational"===i?function(e,t){return[Z(e,t),$(e,t)]}(e,n):"timecode"===i?function(e,t){return[$(e,t),$(e,t)]}(e,n):"preview"===i?(n.value+=r,"skipped"):void(n.value+=r)}const ce=new DataView(e),ue=new Uint8Array(e),de={value:0},he=function(e,t,n){const i={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");i.version=e.getUint8(4);const r=e.getUint8(5);i.spec={singleTile:!!(2&r),longName:!!(4&r),deepFormat:!!(8&r),multiPart:!!(16&r)},n.value=8;let s=!0;for(;s;){const r=J(t,n);if(0==r)s=!1;else{const s=J(t,n),o=le(e,t,n,s,$(e,n));void 0===o?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):i[r]=o}}if(0!=(-5&r))throw console.error("EXRHeader:",i),new Error("THREE.EXRLoader: provided file is currently unsupported.");return i}(ce,e,de),pe=function(e,t,i,r,s){const o={size:0,viewer:t,array:i,offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:n.GUF};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=Q;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=W;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=q;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=q;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=X;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=Y;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=K;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=K;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(o.scanlineBlockSize=o.lines,1==o.type)switch(s){case n.VzW:o.getter=ae,o.inputSize=m;break;case n.cLu:o.getter=oe,o.inputSize=m}else{if(2!=o.type)throw new Error("EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".");switch(s){case n.VzW:o.getter=ie,o.inputSize=p;break;case n.cLu:o.getter=re,o.inputSize=p}}o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(let n=0;n<o.blockCount;n++)ne(t,r);o.outputChannels=3==o.channels?4:o.channels;const a=o.width*o.height*o.outputChannels;switch(s){case n.VzW:o.byteArray=new Float32Array(a),o.channels<o.outputChannels&&o.byteArray.fill(1,0,a);break;case n.cLu:o.byteArray=new Uint16Array(a),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,a);break;default:console.error("THREE.EXRLoader: unsupported type: ",s)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?(o.format=n.wk1,o.colorSpace=n.GUF):(o.format=n.hEm,o.colorSpace=n.aCh),o}(he,ce,ue,de,this.type),fe={value:0},me={R:0,G:1,B:2,A:3,Y:0};for(let n=0;n<pe.height/pe.scanlineBlockSize;n++){const e=$(ce,de);pe.size=$(ce,de),pe.lines=e+pe.scanlineBlockSize>pe.height?pe.height-e:pe.scanlineBlockSize;const t=pe.size<pe.lines*pe.bytesPerLine?pe.uncompress(pe):Q(pe);de.value+=pe.size;for(let i=0;i<pe.scanlineBlockSize;i++){const e=i+n*pe.scanlineBlockSize;if(e>=pe.height)break;for(let n=0;n<pe.channels;n++){const r=me[he.channels[n].name];for(let s=0;s<pe.width;s++){fe.value=(i*(pe.channels*pe.width)+n*pe.width+s)*pe.inputSize;const o=(pe.height-1-e)*(pe.width*pe.outputChannels)+s*pe.outputChannels+r;pe.byteArray[o]=pe.getter(t,fe)}}}}return{header:he,width:pe.width,height:pe.height,data:pe.byteArray,format:pe.format,colorSpace:pe.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,r){return super.load(e,(function(e,i){e.colorSpace=i.colorSpace,e.minFilter=n.wem,e.magFilter=n.wem,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,i)}),i,r)}}class H_ extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls]}async onAdded(e){var t,n;this._importer||(this._importer=new Nt(class extends V_{constructor(t){super(t),this.setDataType(ks(e.renderer.rendererObject))}},["exr"],!1)),null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&(null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n?void 0:n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}H_.PluginType="EXRLoadPlugin";const Q_=new WeakMap;class W_ extends n.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){const s=new n.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),this.url=e,s.load(e,(n=>{if(Q_.has(n))return Q_.get(n).promise.then(t).catch(r);this.decodeObjects(n,e).then((e=>{e.userData.warnings=this.warnings,this.warnings=[],t(e)})).catch((e=>r(e)))}),i,r)}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}decodeObjects(e,t){let n,i;const r=e.byteLength,s=this._getWorker(r).then((t=>(n=t,i=this.workerNextTaskID++,new Promise(((t,r)=>{n._callbacks[i]={resolve:t,reject:r},n.postMessage({type:"decode",id:i,buffer:e},[e])}))))).then((e=>this._createGeometry(e.data))).catch((e=>{throw e}));return s.catch((()=>!0)).then((()=>{n&&i&&this._releaseTask(n,i)})),Q_.set(e,{url:t,promise:s}),s}parse(e,t,n){this.decodeObjects(e,"").then((e=>{e.userData.warnings=this.warnings,t(e)})).catch((e=>n(e)))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const n=JSON.stringify(t);for(let i=0;i<this.materials.length;i++){const e=this.materials[i],t={};if(t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type,JSON.stringify(t)===n)return e}return this.materials.push(e),e}_createMaterial(e){if(void 0===e)return new n.Wid({color:new n.Ilk(1,1,1),metalness:.8,name:"default",side:n.ehD});const t=e.diffuseColor,i=new n.Ilk(t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(i.r=1,i.g=1,i.b=1);const r=new n.Wid({color:i,name:e.name,side:n.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),s=new n.dpR;for(let o=0;o<e.textures.length;o++){const t=e.textures[o];if(null!==t.image){const e=s.load(t.image);switch(t.type){case"Diffuse":r.map=e;break;case"Bump":r.bumpMap=e;break;case"Transparency":r.alphaMap=e,r.transparent=!0;break;case"Emap":r.envMap=e}e.wrapS=0===t.wrapU?n.rpg:n.uWy,e.wrapT=0===t.wrapV?n.rpg:n.uWy,e.repeat.set(t.repeat[0],t.repeat[1])}}return r}_createGeometry(e){const t=new n.Tme,i=[],r=[],s=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let o=e.objects;const a=e.materials;for(let n=0;n<o.length;n++){const l=o[n],c=l.attributes;switch(l.objectType){case"InstanceDefinition":r.push(l);break;case"InstanceReference":s.push(l);break;default:let n;if(c.materialIndex>=0){const e=a[c.materialIndex];let t=this._createMaterial(e);t=this._compareMaterials(t),n=this._createObject(l,t)}else{const e=this._createMaterial();n=this._createObject(l,e)}if(void 0===n)continue;const o=e.layers[c.layerIndex];n.visible=!o||o.visible,c.isInstanceDefinitionObject?i.push(n):t.add(n)}}for(let l=0;l<r.length;l++){const c=r[l];o=[];for(let e=0;e<c.attributes.objectIds.length;e++){const t=c.attributes.objectIds[e];for(let e=0;e<i.length;e++)t===i[e].userData.attributes.id&&o.push(i[e])}for(let i=0;i<s.length;i++){const r=s[i];if(r.geometry.parentIdefId===c.attributes.id){const i=r.geometry.xform.array,s=new n.yGw;if(s.set(...i),1===o.length){const n=o[0].clone(!0);if(n.name=r.attributes.name||n.name,n.applyMatrix4(s),r.attributes.materialIndex>=0&&r.attributes.materialIndex!==o[0].userData.attributes.materialIndex){const e=a[r.attributes.materialIndex],t=this._createMaterial(e);n.material=this._compareMaterials(t)}if(n.userData.defAttributes=n.userData.attributes,n.userData.defObjectType=n.userData.objectType,n.userData.attributes={...n.userData.attributes,...r.attributes},n.userData.objectType=r.objectType,void 0!==r.attributes.layerIndex){const t=e.layers[r.attributes.layerIndex];n.visible=t?t.visible:n.visible}t.add(n)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const e=new n.Tme;e.applyMatrix4(s);for(let t=0;t<o.length;t++)e.add(o[t].clone(!0));t.add(e)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const i=new n.s4_,r=e.attributes;let s,o,a,l;switch(e.objectType){case"Point":case"PointSet":s=i.parse(e.geometry),s.attributes.hasOwnProperty("color")?o=new n.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(a=r.drawColor,l=new n.Ilk(a.r/255,a.g/255,a.b/255),o=new n.UY4({color:l,sizeAttenuation:!1,size:2})),o=this._compareMaterials(o);const c=new n.woe(s,o);return c.userData.attributes=r,c.userData.objectType=e.objectType,r.name&&(c.name=r.name),c;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(null===e.geometry)return;s=i.parse(e.geometry),s.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),null===t&&(t=this._createMaterial(),t=this._compareMaterials(t));const u=new n.Kj0(s,t);return u.castShadow=r.castsShadows,u.receiveShadow=r.receivesShadows,u.userData.attributes=r,u.userData.objectType=e.objectType,r.name&&(u.name=r.name,s.name=r.name),u;case"Curve":s=i.parse(e.geometry),a=r.drawColor,l=new n.Ilk(a.r/255,a.g/255,a.b/255),o=new n.nls({color:l}),o=this._compareMaterials(o);const d=new n.x12(s,o);return d.userData.attributes=r,d.userData.objectType=e.objectType,r.name&&(d.name=r.name),d;case"TextDot":s=e.geometry;const h=document.createElement("canvas").getContext("2d"),p=`${s.fontHeight}px ${s.fontFace}`;h.font=p;const f=h.measureText(s.text).width+10,m=s.fontHeight+10,g=window.devicePixelRatio;h.canvas.width=f*g,h.canvas.height=m*g,h.canvas.style.width=f+"px",h.canvas.style.height=m+"px",h.setTransform(g,0,0,g,0,0),h.font=p,h.textBaseline="middle",h.textAlign="center",l=r.drawColor,h.fillStyle=`rgba(${l.r},${l.g},${l.b},${l.a})`,h.fillRect(0,0,f,m),h.fillStyle="white",h.fillText(s.text,f/2,m/2);const _=new n.ROQ(h.canvas);_.minFilter=n.wem,_.wrapS=n.uWy,_.wrapT=n.uWy,o=new n.xeV({map:_,depthTest:!1});const v=new n.jyi(o);return v.position.set(s.point[0],s.point[1],s.point[2]),v.scale.set(f/10,m/10,1),v.userData.attributes=r,v.userData.objectType=e.objectType,r.name&&(v.name=r.name),v;case"Light":let y;switch(s=e.geometry,s.lightStyle.name){case"LightStyle_WorldPoint":y=new n.cek,y.castShadow=r.castsShadows,y.position.set(s.location[0],s.location[1],s.location[2]),y.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":y=new n.PMe,y.castShadow=r.castsShadows,y.position.set(s.location[0],s.location[1],s.location[2]),y.target.position.set(s.direction[0],s.direction[1],s.direction[2]),y.angle=s.spotAngleRadians,y.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":y=new n.T_f;const e=Math.abs(s.width[2]),t=Math.abs(s.length[0]);y.position.set(s.location[0]-t/2,s.location[1],s.location[2]-e/2),y.height=t,y.width=e,y.lookAt(s.direction[0],s.direction[1],s.direction[2]);break;case"LightStyle_WorldDirectional":y=new n.Ox3,y.castShadow=r.castsShadows,y.position.set(s.location[0],s.location[1],s.location[2]),y.target.position.set(s.direction[0],s.direction[1],s.direction[2]),y.shadow.normalBias=.1}return y&&(y.intensity=s.intensity,a=s.diffuse,l=new n.Ilk(a.r/255,a.g/255,a.b/255),y.color=l,y.userData.attributes=r,y.userData.objectType=e.objectType),y}}_initLibrary(){if(!this.libraryPending){const e=new n.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise(((t,n)=>{e.load("rhino3dm.js",t,void 0,n)})),i=new n.hH6(this.manager);i.setPath(this.libraryPath),i.setResponseType("arraybuffer");const r=new Promise(((e,t)=>{i.load("rhino3dm.wasm",e,void 0,t)}));this.libraryPending=Promise.all([t,r]).then((([e,t])=>{this.libraryConfig.wasmBinary=t;const n=q_,i=["/* rhino3dm.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}))}return this.libraryPending}_getWorker(e){return this._initLibrary().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",libraryConfig:this.libraryConfig}),e.onmessage=t=>{const n=t.data;switch(n.type){case"warning":this.warnings.push(n.data),console.warn(n.data);break;case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const q_="\nfunction Rhino3dmWorker() {\n\n\tlet libraryPending;\n\tlet libraryConfig;\n\tlet rhino;\n\tlet taskID;\n\n\tonmessage = function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\n\t\t\t\t// console.log(message)\n\t\t\t\tlibraryConfig = message.libraryConfig;\n\t\t\t\tconst wasmBinary = libraryConfig.wasmBinary;\n\t\t\t\tlet RhinoModule;\n\t\t\t\tlibraryPending = new Promise( function ( resolve ) {\n\n\t\t\t\t\t/* Like Basis Loader */\n\t\t\t\t\tRhinoModule = { wasmBinary, onRuntimeInitialized: resolve };\n\n\t\t\t\t\trhino3dm( RhinoModule ); // eslint-disable-line no-undef\n\n\t\t\t\t } ).then( () => {\n\n\t\t\t\t\trhino = RhinoModule;\n\n\t\t\t\t } );\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'decode':\n\n\t\t\t\ttaskID = message.id;\n\t\t\t\tconst buffer = message.buffer;\n\t\t\t\tlibraryPending.then( () => {\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst data = decodeObjects( rhino, buffer );\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, data } );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error } );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction decodeObjects( rhino, buffer ) {\n\n\t\tconst arr = new Uint8Array( buffer );\n\t\tconst doc = rhino.File3dm.fromByteArray( arr );\n\n\t\tconst objects = [];\n\t\tconst materials = [];\n\t\tconst layers = [];\n\t\tconst views = [];\n\t\tconst namedViews = [];\n\t\tconst groups = [];\n\t\tconst strings = [];\n\n\t\t//Handle objects\n\n\t\tconst objs = doc.objects();\n\t\tconst cnt = objs.count;\n\n\t\tfor ( let i = 0; i < cnt; i ++ ) {\n\n\t\t\tconst _object = objs.get( i );\n\n\t\t\tconst object = extractObjectData( _object, doc );\n\n\t\t\t_object.delete();\n\n\t\t\tif ( object ) {\n\n\t\t\t\tobjects.push( object );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Handle instance definitions\n\t\t// console.log( `Instance Definitions Count: ${doc.instanceDefinitions().count()}` );\n\n\t\tfor ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {\n\n\t\t\tconst idef = doc.instanceDefinitions().get( i );\n\t\t\tconst idefAttributes = extractProperties( idef );\n\t\t\tidefAttributes.objectIds = idef.getObjectIds();\n\n\t\t\tobjects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );\n\n\t\t}\n\n\t\t// Handle materials\n\n\t\tconst textureTypes = [\n\t\t\t// rhino.TextureType.Bitmap,\n\t\t\trhino.TextureType.Diffuse,\n\t\t\trhino.TextureType.Bump,\n\t\t\trhino.TextureType.Transparency,\n\t\t\trhino.TextureType.Opacity,\n\t\t\trhino.TextureType.Emap\n\t\t];\n\n\t\tconst pbrTextureTypes = [\n\t\t\trhino.TextureType.PBR_BaseColor,\n\t\t\trhino.TextureType.PBR_Subsurface,\n\t\t\trhino.TextureType.PBR_SubsurfaceScattering,\n\t\t\trhino.TextureType.PBR_SubsurfaceScatteringRadius,\n\t\t\trhino.TextureType.PBR_Metallic,\n\t\t\trhino.TextureType.PBR_Specular,\n\t\t\trhino.TextureType.PBR_SpecularTint,\n\t\t\trhino.TextureType.PBR_Roughness,\n\t\t\trhino.TextureType.PBR_Anisotropic,\n\t\t\trhino.TextureType.PBR_Anisotropic_Rotation,\n\t\t\trhino.TextureType.PBR_Sheen,\n\t\t\trhino.TextureType.PBR_SheenTint,\n\t\t\trhino.TextureType.PBR_Clearcoat,\n\t\t\trhino.TextureType.PBR_ClearcoatBump,\n\t\t\trhino.TextureType.PBR_ClearcoatRoughness,\n\t\t\trhino.TextureType.PBR_OpacityIor,\n\t\t\trhino.TextureType.PBR_OpacityRoughness,\n\t\t\trhino.TextureType.PBR_Emission,\n\t\t\trhino.TextureType.PBR_AmbientOcclusion,\n\t\t\trhino.TextureType.PBR_Displacement\n\t\t];\n\n\t\tfor ( let i = 0; i < doc.materials().count(); i ++ ) {\n\n\t\t\tconst _material = doc.materials().get( i );\n\t\t\tconst _pbrMaterial = _material.physicallyBased();\n\n\t\t\tlet material = extractProperties( _material );\n\n\t\t\tconst textures = [];\n\n\t\t\tfor ( let j = 0; j < textureTypes.length; j ++ ) {\n\n\t\t\t\tconst _texture = _material.getTexture( textureTypes[ j ] );\n\t\t\t\tif ( _texture ) {\n\n\t\t\t\t\tlet textureType = textureTypes[ j ].constructor.name;\n\t\t\t\t\ttextureType = textureType.substring( 12, textureType.length );\n\t\t\t\t\tconst texture = { type: textureType };\n\n\t\t\t\t\tconst image = doc.getEmbeddedFileAsBase64( _texture.fileName );\n\n\t\t\t\t\ttexture.wrapU = _texture.wrapU;\n\t\t\t\t\ttexture.wrapV = _texture.wrapV;\n\t\t\t\t\ttexture.wrapW = _texture.wrapW;\n\t\t\t\t\tconst uvw = _texture.uvwTransform.toFloatArray( true );\n\t\t\t\t\ttexture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];\n\n\t\t\t\t\tif ( image ) {\n\n\t\t\t\t\t\ttexture.image = 'data:image/png;base64,' + image;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\t\t\t\tmessage: `THREE.3DMLoader: Image for ${textureType} texture not embedded in file.`,\n\t\t\t\t\t\t\ttype: 'missing resource'\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\ttexture.image = null;\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttextures.push( texture );\n\n\t\t\t\t\t_texture.delete();\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmaterial.textures = textures;\n\n\t\t\tif ( _pbrMaterial.supported ) {\n\n\t\t\t\tfor ( let j = 0; j < pbrTextureTypes.length; j ++ ) {\n\n\t\t\t\t\tconst _texture = _material.getTexture( pbrTextureTypes[ j ] );\n\t\t\t\t\tif ( _texture ) {\n\n\t\t\t\t\t\tconst image = doc.getEmbeddedFileAsBase64( _texture.fileName );\n\t\t\t\t\t\tlet textureType = pbrTextureTypes[ j ].constructor.name;\n\t\t\t\t\t\ttextureType = textureType.substring( 12, textureType.length );\n\t\t\t\t\t\tconst texture = { type: textureType, image: 'data:image/png;base64,' + image };\n\t\t\t\t\t\ttextures.push( texture );\n\n\t\t\t\t\t\t_texture.delete();\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tconst pbMaterialProperties = extractProperties( _material.physicallyBased() );\n\n\t\t\t\tmaterial = Object.assign( pbMaterialProperties, material );\n\n\t\t\t}\n\n\t\t\tmaterials.push( material );\n\n\t\t\t_material.delete();\n\t\t\t_pbrMaterial.delete();\n\n\t\t}\n\n\t\t// Handle layers\n\n\t\tfor ( let i = 0; i < doc.layers().count(); i ++ ) {\n\n\t\t\tconst _layer = doc.layers().get( i );\n\t\t\tconst layer = extractProperties( _layer );\n\n\t\t\tlayers.push( layer );\n\n\t\t\t_layer.delete();\n\n\t\t}\n\n\t\t// Handle views\n\n\t\tfor ( let i = 0; i < doc.views().count(); i ++ ) {\n\n\t\t\tconst _view = doc.views().get( i );\n\t\t\tconst view = extractProperties( _view );\n\n\t\t\tviews.push( view );\n\n\t\t\t_view.delete();\n\n\t\t}\n\n\t\t// Handle named views\n\n\t\tfor ( let i = 0; i < doc.namedViews().count(); i ++ ) {\n\n\t\t\tconst _namedView = doc.namedViews().get( i );\n\t\t\tconst namedView = extractProperties( _namedView );\n\n\t\t\tnamedViews.push( namedView );\n\n\t\t\t_namedView.delete();\n\n\t\t}\n\n\t\t// Handle groups\n\n\t\tfor ( let i = 0; i < doc.groups().count(); i ++ ) {\n\n\t\t\tconst _group = doc.groups().get( i );\n\t\t\tconst group = extractProperties( _group );\n\n\t\t\tgroups.push( group );\n\n\t\t\t_group.delete();\n\n\t\t}\n\n\t\t// Handle settings\n\n\t\tconst settings = extractProperties( doc.settings() );\n\n\t\t//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.\n\n\t\t// Handle dimstyles\n\t\t// console.log( `Dimstyle Count: ${doc.dimstyles().count()}` );\n\n\t\t// Handle bitmaps\n\t\t// console.log( `Bitmap Count: ${doc.bitmaps().count()}` );\n\n\t\t// Handle strings\n\t\t// console.log( `Document Strings Count: ${doc.strings().count()}` );\n\t\t// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section\n\t\t//console.log( `Document User Text Count: ${doc.strings().documentUserTextCount()}` );\n\n\t\tconst strings_count = doc.strings().count();\n\n\t\tfor ( let i = 0; i < strings_count; i ++ ) {\n\n\t\t\tstrings.push( doc.strings().get( i ) );\n\n\t\t}\n\n\t\tdoc.delete();\n\n\t\treturn { objects, materials, layers, views, namedViews, groups, strings, settings };\n\n\t}\n\n\tfunction extractObjectData( object, doc ) {\n\n\t\tconst _geometry = object.geometry();\n\t\tconst _attributes = object.attributes();\n\t\tlet objectType = _geometry.objectType;\n\t\tlet geometry, attributes, position, data, mesh;\n\n\t\t// skip instance definition objects\n\t\t//if( _attributes.isInstanceDefinitionObject ) { continue; }\n\n\t\t// TODO: handle other geometry types\n\t\tswitch ( objectType ) {\n\n\t\t\tcase rhino.ObjectType.Curve:\n\n\t\t\t\tconst pts = curveToPoints( _geometry, 100 );\n\n\t\t\t\tposition = {};\n\t\t\t\tattributes = {};\n\t\t\t\tdata = {};\n\n\t\t\t\tposition.itemSize = 3;\n\t\t\t\tposition.type = 'Float32Array';\n\t\t\t\tposition.array = [];\n\n\t\t\t\tfor ( let j = 0; j < pts.length; j ++ ) {\n\n\t\t\t\t\tposition.array.push( pts[ j ][ 0 ] );\n\t\t\t\t\tposition.array.push( pts[ j ][ 1 ] );\n\t\t\t\t\tposition.array.push( pts[ j ][ 2 ] );\n\n\t\t\t\t}\n\n\t\t\t\tattributes.position = position;\n\t\t\t\tdata.attributes = attributes;\n\n\t\t\t\tgeometry = { data };\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Point:\n\n\t\t\t\tconst pt = _geometry.location;\n\n\t\t\t\tposition = {};\n\t\t\t\tconst color = {};\n\t\t\t\tattributes = {};\n\t\t\t\tdata = {};\n\n\t\t\t\tposition.itemSize = 3;\n\t\t\t\tposition.type = 'Float32Array';\n\t\t\t\tposition.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];\n\n\t\t\t\tconst _color = _attributes.drawColor( doc );\n\n\t\t\t\tcolor.itemSize = 3;\n\t\t\t\tcolor.type = 'Float32Array';\n\t\t\t\tcolor.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];\n\n\t\t\t\tattributes.position = position;\n\t\t\t\tattributes.color = color;\n\t\t\t\tdata.attributes = attributes;\n\n\t\t\t\tgeometry = { data };\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.PointSet:\n\t\t\tcase rhino.ObjectType.Mesh:\n\n\t\t\t\tgeometry = _geometry.toThreejsJSON();\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Brep:\n\n\t\t\t\tconst faces = _geometry.faces();\n\t\t\t\tmesh = new rhino.Mesh();\n\n\t\t\t\tfor ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {\n\n\t\t\t\t\tconst face = faces.get( faceIndex );\n\t\t\t\t\tconst _mesh = face.getMesh( rhino.MeshType.Any );\n\n\t\t\t\t\tif ( _mesh ) {\n\n\t\t\t\t\t\tmesh.append( _mesh );\n\t\t\t\t\t\t_mesh.delete();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tface.delete();\n\n\t\t\t\t}\n\n\t\t\t\tif ( mesh.faces().count > 0 ) {\n\n\t\t\t\t\tmesh.compact();\n\t\t\t\t\tgeometry = mesh.toThreejsJSON();\n\t\t\t\t\tfaces.delete();\n\n\t\t\t\t}\n\n\t\t\t\tmesh.delete();\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Extrusion:\n\n\t\t\t\tmesh = _geometry.getMesh( rhino.MeshType.Any );\n\n\t\t\t\tif ( mesh ) {\n\n\t\t\t\t\tgeometry = mesh.toThreejsJSON();\n\t\t\t\t\tmesh.delete();\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.TextDot:\n\n\t\t\t\tgeometry = extractProperties( _geometry );\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Light:\n\n\t\t\t\tgeometry = extractProperties( _geometry );\n\n\t\t\t\tif ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {\n\n\t\t\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\t\t\tmessage: `THREE.3DMLoader: No conversion exists for ${objectType.constructor.name} ${geometry.lightStyle.name}`,\n\t\t\t\t\t\ttype: 'no conversion',\n\t\t\t\t\t\tguid: _attributes.id\n\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.InstanceReference:\n\n\t\t\t\tgeometry = extractProperties( _geometry );\n\t\t\t\tgeometry.xform = extractProperties( _geometry.xform );\n\t\t\t\tgeometry.xform.array = _geometry.xform.toFloatArray( true );\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.SubD:\n\n\t\t\t\t// TODO: precalculate resulting vertices and faces and warn on excessive results\n\t\t\t\t_geometry.subdivide( 3 );\n\t\t\t\tmesh = rhino.Mesh.createFromSubDControlNet( _geometry );\n\t\t\t\tif ( mesh ) {\n\n\t\t\t\t\tgeometry = mesh.toThreejsJSON();\n\t\t\t\t\tmesh.delete();\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\t\t/*\n\t\t\t\tcase rhino.ObjectType.Annotation:\n\t\t\t\tcase rhino.ObjectType.Hatch:\n\t\t\t\tcase rhino.ObjectType.ClipPlane:\n\t\t\t\t*/\n\n\t\t\tdefault:\n\n\t\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\t\tmessage: `THREE.3DMLoader: Conversion not implemented for ${objectType.constructor.name}`,\n\t\t\t\t\ttype: 'not implemented',\n\t\t\t\t\tguid: _attributes.id\n\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( geometry ) {\n\n\t\t\tattributes = extractProperties( _attributes );\n\t\t\tattributes.geometry = extractProperties( _geometry );\n\n\t\t\tif ( _attributes.groupCount > 0 ) {\n\n\t\t\t\tattributes.groupIds = _attributes.getGroupList();\n\n\t\t\t}\n\n\t\t\tif ( _attributes.userStringCount > 0 ) {\n\n\t\t\t\tattributes.userStrings = _attributes.getUserStrings();\n\n\t\t\t}\n\n\t\t\tif ( _geometry.userStringCount > 0 ) {\n\n\t\t\t\tattributes.geometry.userStrings = _geometry.getUserStrings();\n\n\t\t\t}\n\n\t\t\tattributes.drawColor = _attributes.drawColor( doc );\n\n\t\t\tobjectType = objectType.constructor.name;\n\t\t\tobjectType = objectType.substring( 11, objectType.length );\n\n\t\t\treturn { geometry, attributes, objectType };\n\n\t\t} else {\n\n\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\tmessage: `THREE.3DMLoader: ${objectType.constructor.name} has no associated mesh geometry.`,\n\t\t\t\ttype: 'missing mesh',\n\t\t\t\tguid: _attributes.id\n\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\tfunction extractProperties( object ) {\n\n\t\tconst result = {};\n\n\t\tfor ( const property in object ) {\n\n\t\t\tconst value = object[ property ];\n\n\t\t\tif ( typeof value !== 'function' ) {\n\n\t\t\t\tif ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {\n\n\t\t\t\t\tresult[ property ] = { name: value.constructor.name, value: value.value };\n\n\t\t\t\t} else {\n\n\t\t\t\t\tresult[ property ] = value;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// these are functions that could be called to extract more data.\n\t\t\t\t//console.log( `${property}: ${object[ property ].constructor.name}` );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tfunction curveToPoints( curve, pointLimit ) {\n\n\t\tlet pointCount = pointLimit;\n\t\tlet rc = [];\n\t\tconst ts = [];\n\n\t\tif ( curve instanceof rhino.LineCurve ) {\n\n\t\t\treturn [ curve.pointAtStart, curve.pointAtEnd ];\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.PolylineCurve ) {\n\n\t\t\tpointCount = curve.pointCount;\n\t\t\tfor ( let i = 0; i < pointCount; i ++ ) {\n\n\t\t\t\trc.push( curve.point( i ) );\n\n\t\t\t}\n\n\t\t\treturn rc;\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.PolyCurve ) {\n\n\t\t\tconst segmentCount = curve.segmentCount;\n\n\t\t\tfor ( let i = 0; i < segmentCount; i ++ ) {\n\n\t\t\t\tconst segment = curve.segmentCurve( i );\n\t\t\t\tconst segmentArray = curveToPoints( segment, pointCount );\n\t\t\t\trc = rc.concat( segmentArray );\n\t\t\t\tsegment.delete();\n\n\t\t\t}\n\n\t\t\treturn rc;\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.ArcCurve ) {\n\n\t\t\tpointCount = Math.floor( curve.angleDegrees / 5 );\n\t\t\tpointCount = pointCount < 2 ? 2 : pointCount;\n\t\t\t// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {\n\n\t\t\tconst pLine = curve.tryGetPolyline();\n\n\t\t\tfor ( let i = 0; i < pLine.count; i ++ ) {\n\n\t\t\t\trc.push( pLine.get( i ) );\n\n\t\t\t}\n\n\t\t\tpLine.delete();\n\n\t\t\treturn rc;\n\n\t\t}\n\n\t\tconst domain = curve.domain;\n\t\tconst divisions = pointCount - 1.0;\n\n\t\tfor ( let j = 0; j < pointCount; j ++ ) {\n\n\t\t\tconst t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );\n\n\t\t\tif ( t === domain[ 0 ] || t === domain[ 1 ] ) {\n\n\t\t\t\tts.push( t );\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\tconst tan = curve.tangentAt( t );\n\t\t\tconst prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );\n\n\t\t\t// Duplicated from THREE.Vector3\n\t\t\t// How to pass imports to worker?\n\n\t\t\tconst tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];\n\t\t\tconst ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];\n\n\t\t\tconst denominator = Math.sqrt( tS * ptS );\n\n\t\t\tlet angle;\n\n\t\t\tif ( denominator === 0 ) {\n\n\t\t\t\tangle = Math.PI / 2;\n\n\t\t\t} else {\n\n\t\t\t\tconst theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;\n\t\t\t\tangle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );\n\n\t\t\t}\n\n\t\t\tif ( angle < 0.1 ) continue;\n\n\t\t\tts.push( t );\n\n\t\t}\n\n\t\trc = ts.map( t => curve.pointAt( t ) );\n\t\treturn rc;\n\n\t}\n\n}\n";var X_,Y_=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class K_ extends W_{constructor(e){super(e),this.materials=[],this.setLibraryPath(K_.LIBRARY_PATH)}_createMaterial(e){return K_.ImportMaterials?super._createMaterial(e):this.materials[0]||new n.Wid({color:new n.Ilk(1,1,1),metalness:.8,name:"default",side:n.ehD})}async loadAsync(e,t){const n=await super.loadAsync(e,t);n.rotateX(-Math.PI/2),n.userData.materials&&delete n.userData.materials;const i=n.userData.layers;return n.traverse((e=>{var t,r,s,o,a;const l=null===(t=e.userData.attributes)||void 0===t?void 0:t.castsShadows,c=null===(r=e.userData.attributes)||void 0===r?void 0:r.receivesShadows;e.castShadow=l,e.receiveShadow=c;const u=null!==(o=null===(s=e.userData.attributes)||void 0===s?void 0:s.layerIndex)&&void 0!==o?o:null===(a=e.userData.defAttributes)||void 0===a?void 0:a.layerIndex,d=i[u];d&&(e.userData.rhinoLayer=d),e.userData.rhino3dmRoot=n.uuid,this._hideLineMesh(e),this._useInstancedMesh(e),this._useMaterialSource(e,d)})),this.materials=[],n}_useMaterialSource(e,t){var n,i,r,s,o;if(!K_.ImportMaterials)return;const a=e;if("default"===(null===(n=a.material)||void 0===n?void 0:n.name)||K_.ForceLayerMaterials){const e=(null===(i=a.userData.attributes)||void 0===i?void 0:i.materialSource)||(null===(r=a.userData.defAttributes)||void 0===r?void 0:r.materialSource),n=(null===(s=a.userData.attributes)||void 0===s?void 0:s.colorSource)||(null===(o=a.userData.defAttributes)||void 0===o?void 0:o.colorSource);if(!K_.ForceLayerMaterials&&!e&&!n)return;K_.ForceLayerMaterials||0===(null==e?void 0:e.value)||1===(null==e?void 0:e.value)&&0===(null==n?void 0:n.value)?t&&(a.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):3===(null==e?void 0:e.value)||1===(null==e?void 0:e.value)&&3===(null==n?void 0:n.value)?a.traverseAncestors((e=>{(null==e?void 0:e.material)&&(a.material=e.material)})):e&&1!==e.value&&console.warn("Unknown material source",e,a,a.userData.attributes)}}_useInstancedMesh(e){if(!K_.ReplaceWithInstancedMesh)return;if(e.children.length<=0)return;const t=e.children,i=t.map((e=>e.geometry)),r=i.filter(((e,t)=>i.indexOf(e)===t));r.forEach((i=>{var r;const s=t.filter((e=>e.geometry===i)),o=s.length>0?s.filter((e=>e.material===s[0].material)):[];if(o.length>1){const t=new n.SPe(i,o[0].material,o.length);t.userData={...o[0].userData},t.userData.instanceUserData=[],t.userData.attributes=t.userData.defAttributes||t.userData.attributes,t.userData.defAttributes&&delete t.userData.defAttributes,t.name=(null===(r=t.userData.attributes)||void 0===r?void 0:r.name)||o[0].name,o.forEach(((n,i)=>{t.setMatrixAt(i,n.matrix),e.remove(n),t.userData.instanceUserData.push(n.userData)})),e.add(t)}}))}_hideLineMesh(e){if(!K_.HideLineMesh)return;if(e.children.length<=0)return;const t=[];e.traverse((e=>{e&&(e.isLine||e.isLineSegments||e.isPoints)&&t.push(e)})),t.forEach((e=>{e.userData.visible_3dm=e.visible,e.visible=!1}))}}K_.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",K_.ImportMaterials=!0,K_.ForceLayerMaterials=!1,K_.ReplaceWithInstancedMesh=!1,K_.HideLineMesh=!1;let J_=X_=class extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls],this._importer=new Nt(K_,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1}_refresh(){K_.ImportMaterials=this.importMaterials,K_.ForceLayerMaterials=this.forceLayerMaterials,K_.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,K_.HideLineMesh=this.hideLineMesh}async onAdded(e){var t,n;null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n||n.Importers.push(this._importer),this._refresh()}async onDispose(e){}async onRemove(e){var t,n;(null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n?void 0:n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1)}};J_.PluginType="Rhino3dmLoadPlugin",Y_([(0,t.onChange)(X_.prototype._refresh),Oe()],J_.prototype,"importMaterials",void 0),Y_([(0,t.onChange)(X_.prototype._refresh),Oe()],J_.prototype,"forceLayerMaterials",void 0),Y_([(0,t.onChange)(X_.prototype._refresh),Oe()],J_.prototype,"replaceWithInstancedMesh",void 0),Y_([(0,t.onChange)(X_.prototype._refresh),Oe()],J_.prototype,"hideLineMesh",void 0),J_=X_=Y_([We("Rhino 3dm loader")],J_);class Z_ extends n.aNw{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new n.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(s.parse(n))}catch(t){r?r(t):console.error(t),s.manager.itemError(e)}}),i,r)}parse(e){function t(e,t,n){for(let i=0,r=e.length;i<r;i++)if(e[i]!==t.getUint8(n+i))return!1;return!0}const i=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer||t}return e}(e);return function(e){const n=new DataView(e);if(84+50*n.getUint32(80,!0)===n.byteLength)return!0;const i=[115,111,108,105,100];for(let r=0;r<5;r++)if(t(i,n,r))return!1;return!0}(i)?function(e){const t=new DataView(e),i=t.getUint32(80,!0);let r,s,o,a,l,c,u,d,h=!1;for(let n=0;n<70;n++)1129270351==t.getUint32(n,!1)&&82==t.getUint8(n+4)&&61==t.getUint8(n+5)&&(h=!0,a=new Float32Array(3*i*3),l=t.getUint8(n+6)/255,c=t.getUint8(n+7)/255,u=t.getUint8(n+8)/255,d=t.getUint8(n+9)/255);const p=new n.u9r,f=new Float32Array(3*i*3),m=new Float32Array(3*i*3),g=new n.Ilk;for(let n=0;n<i;n++){const e=84+50*n,i=t.getFloat32(e,!0),d=t.getFloat32(e+4,!0),p=t.getFloat32(e+8,!0);if(h){const n=t.getUint16(e+48,!0);0==(32768&n)?(r=(31&n)/31,s=(n>>5&31)/31,o=(n>>10&31)/31):(r=l,s=c,o=u)}for(let l=1;l<=3;l++){const c=e+12*l,u=3*n*3+3*(l-1);f[u]=t.getFloat32(c,!0),f[u+1]=t.getFloat32(c+4,!0),f[u+2]=t.getFloat32(c+8,!0),m[u]=i,m[u+1]=d,m[u+2]=p,h&&(g.set(r,s,o).convertSRGBToLinear(),a[u]=g.r,a[u+1]=g.g,a[u+2]=g.b)}}return p.setAttribute("position",new n.TlE(f,3)),p.setAttribute("normal",new n.TlE(m,3)),h&&(p.setAttribute("color",new n.TlE(a,3)),p.hasColors=!0,p.alpha=d),p}(i):function(e){const t=new n.u9r,i=/solid([\s\S]*?)endsolid/g,r=/facet([\s\S]*?)endfacet/g;let s=0;const o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),c=[],u=[],d=new n.Pa4;let h,p=0,f=0,m=0;for(;null!==(h=i.exec(e));){f=m;const e=h[0];for(;null!==(h=r.exec(e));){let e=0,t=0;const n=h[0];for(;null!==(h=l.exec(n));)d.x=parseFloat(h[1]),d.y=parseFloat(h[2]),d.z=parseFloat(h[3]),t++;for(;null!==(h=a.exec(n));)c.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),u.push(d.x,d.y,d.z),e++,m++;1!==t&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+s),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+s),s++}const n=f,i=m-f;t.addGroup(n,i,p),p++}return t.setAttribute("position",new n.a$l(c,3)),t.setAttribute("normal",new n.a$l(u,3)),t}("string"!=typeof(r=e)?(new TextDecoder).decode(r):r);var r}}class $_ extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls]}async onAdded(e){var t,n;this._importer||(this._importer=new Nt(Z_,["stl"],!0)),null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&(null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n?void 0:n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}$_.PluginType="STLLoadPlugin";class ev extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`\nimport { MeshoptDecoder } from '${ev.DECODER_URL}';\nwindow.MeshoptDecoder = MeshoptDecoder\n`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}ev.PluginType="GLTFMeshOptPlugin",ev.DECODER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_decoder.module.js";var tv,nv=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let iv=tv=class extends _t{constructor(e=!0){super(),this.animationRunning=!1,this.interactionsDisabled=!1,this.animationDuration=2e3,this.animationDistance=80,this.animationPauseDuration=6e3,this.rotationDistance=.3,this.yOffset=0,this.autoStart=!0,this.autoStartDelay=3e4,this.autoStop=!0,this.autoStartOnObjectLoad=!0,this.autoStartOnObjectLoadDelay=3e3,this.currentTime=0,this.lastActionTime=1/0,this._xDamper=new t.Damper(50),this.pointerIcon='<svg xmlns="http://www.w3.org/2000/svg" style="transform: translate(-50%, -25%);" width="25" height="36">\n    <defs>\n        <path id="A" d="M.001.232h24.997V36H.001z"></path>\n    </defs>\n    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">\n        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z"></path>\n        <g transform="translate(11 3)">\n            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4"></path>\n            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000"></path>\n            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff"></path>\n            <g transform="translate(0 .769)">\n                <mask id="B" fill="#fff">\n                    <use xlink:href="#A"></use>\n                </mask>\n                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)"></path>\n            </g>\n        </g>\n    </g>\n</svg>',this._activeCameraUpdate=e=>{this.isDisabled()||("deserialize"===e.change?(this.stopAnimation(),this.startAnimation()):this.lastActionTime=(0,t.now)())},this._addSceneObject=()=>{this.autoStartOnObjectLoad&&(this.lastActionTime=(0,t.now)()-this.autoStartDelay+this.autoStartOnObjectLoadDelay)},this.onlyOnOrbitControls=!0,this._orbitWarning=!1,this.startAnimation=()=>{var e;if(this._viewer&&this.cursorEl&&!this.isDisabled())return"OrbitControls"!==(null===(e=this._viewer.scene.activeCamera.controls)||void 0===e?void 0:e.type)&&this.onlyOnOrbitControls?(this._orbitWarning||console.warn("WebGi InteractionPromptPlugin requires OrbitControls, to run anyway, set onlyOnOrbitControls to false"),void(this._orbitWarning=!0)):void(0!==this._viewer.scene.modelRoot.children.length&&(this.currentSphericalPosition=(new n.$V).setFromVector3((new n.Pa4).subVectors(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target)),this.cursorEl.style.opacity="1",this.currentTime=0,this.animationRunning=!0,this.interactionsDisabled=!0,this._viewer.scene.activeCamera.setInteractions(!1,tv.PluginType)))},this.stopAnimation=()=>{this._viewer&&this.cursorEl&&(this.animationRunning=!1,this.cursorEl.style.opacity="0",this._viewer.scene.activeCamera.setInteractions(!0,tv.PluginType),this.interactionsDisabled&&(this.interactionsDisabled=!1))},this._pointerDown=()=>{this.isDisabled()||(this.autoStop&&this.stopAnimation(),this.lastActionTime=(0,t.now)())},this._x=0,this._preFrame=async e=>{if(!this._viewer||!this.cursorEl)return;if(this.isDisabled()&&this.animationRunning&&this.stopAnimation(),this.isDisabled())return;if(!this.animationRunning&&this.autoStart&&this.lastActionTime+this.autoStartDelay<(0,t.now)()&&this.startAnimation(),!this.animationRunning)return;if(this.currentTime<=this.animationDuration){this.cursorEl.style.opacity="1";const e=this.currentTime/this.animationDuration;this._x=Math.sin(2*Math.PI*e),(e<.25||e>.75)&&(this._x*=this._x*Math.sign(this._x))}else this.cursorEl.style.opacity="0",this._x=0;if(this.currentTime<=this.animationDuration+50){const e=this.currentSphericalPosition.clone();e.theta+=this._x*this.rotationDistance,this._viewer.scene.activeCamera.position.setFromSpherical(e).add(this._viewer.scene.activeCamera.target),this._viewer.scene.activeCamera.positionUpdated()}const n=this._viewer.container.getBoundingClientRect(),i=n.width/2+-this._x*Math.min(this.animationDistance,n.width/4),r=n.height/2+this.yOffset*n.height/2;this.cursorEl.style.transform=`translate(${Math.floor(i)}px, ${Math.floor(r)}px)`,this.currentTime+=e.deltaTime,this.currentTime>this.animationDuration+this.animationPauseDuration&&(this.currentTime=0)},this._disabledBy=new Set,this.disable=e=>{this._disabledBy.size,this._disabledBy.add(e)},this.enable=e=>{this._disabledBy.size,this._disabledBy.delete(e)},this.isDisabled=()=>this._disabledBy.size>0||!this.enabled,this.enabled=e}async onAdded(e){await super.onAdded(e);{e.plugins.hasOwnProperty("InteractionPointerPlugin")&&delete e.plugins.InteractionPointerPlugin;const t=this;Object.defineProperty(e.plugins,"InteractionPointerPlugin",{get(){return console.warn("WebGi InteractionPromptPlugin: PluginType renamed from InteractionPointerPlugin to InteractionPromptPlugin. Please update your code/vjson."),t},configurable:!0})}this.lastActionTime=1/0,e.addEventListener("preFrame",this._preFrame),e.container.addEventListener("pointerdown",this._pointerDown,!0),e.container.addEventListener("wheel",this._pointerDown,!0),e.scene.addEventListener("addSceneObject",this._addSceneObject),e.scene.addEventListener("activeCameraUpdate",this._activeCameraUpdate),this._initializeCursor()}async onRemove(e){return this.stopAnimation(),e.removeEventListener("preFrame",this._preFrame),e.container.removeEventListener("pointerdown",this._pointerDown,!0),e.container.removeEventListener("wheel",this._pointerDown,!0),e.scene.removeEventListener("addSceneObject",this._addSceneObject),e.scene.removeEventListener("activeCameraUpdate",this._activeCameraUpdate),this.cursorEl&&this.cursorEl.remove(),super.onRemove(e)}_initializeCursor(){this.cursorEl=document.createElement("div"),this.cursorEl.style.position="absolute",this.cursorEl.style.top="0",this.cursorEl.style.left="0",this.cursorEl.style.width="10px",this.cursorEl.style.height="10px",this.cursorEl.style.opacity="0",this.cursorEl.innerHTML=this.pointerIcon,this._viewer.container.appendChild(this.cursorEl)}};iv.PluginType="InteractionPromptPlugin",nv([re(),Oe()],iv.prototype,"enabled",void 0),nv([re(),ze()],iv.prototype,"animationDuration",void 0),nv([re(),ze()],iv.prototype,"animationDistance",void 0),nv([re(),ze()],iv.prototype,"animationPauseDuration",void 0),nv([re(),ze()],iv.prototype,"rotationDistance",void 0),nv([re(),ze()],iv.prototype,"yOffset",void 0),nv([re(),Oe()],iv.prototype,"autoStart",void 0),nv([re(),ze()],iv.prototype,"autoStartDelay",void 0),nv([re(),Oe()],iv.prototype,"autoStop",void 0),nv([re(),Oe()],iv.prototype,"autoStartOnObjectLoad",void 0),nv([re(),Oe()],iv.prototype,"autoStartOnObjectLoadDelay",void 0),nv([Le()],iv.prototype,"currentTime",void 0),nv([Le()],iv.prototype,"lastActionTime",void 0),nv([re()],iv.prototype,"onlyOnOrbitControls",void 0),nv([je()],iv.prototype,"startAnimation",void 0),nv([je()],iv.prototype,"stopAnimation",void 0),iv=tv=nv([We("Interaction Prompt")],iv);class rv extends zs{constructor(e){super(e),this.licenseKey=e.licenseKey}async initialize({caching:e=!0,ground:t=!0,bloom:n=!0,depthTonemap:i=!0,enableDrop:r=!1,importPopup:s=!0,debug:o=!1,interactionPrompt:a=!0}={}){o&&await this.addPlugin(bp),this.getPlugin(Ls)||this.addPluginSync(Ls,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await sv(this,{ground:t,bloom:n,depthTonemap:i,enableDrop:r,importPopup:s,interactionPrompt:a}),await this.getOrAddPlugin(Ho);const l=await this.getOrAddPlugin(Bc);return this.licenseKey&&l.setKey(this.licenseKey),await this.addPlugin(I_),await this.addPlugin(R_),await this.addPlugin(k_),this}}async function sv(e,{ground:t=!0,bloom:n=!0,depthTonemap:i=!0,enableDrop:r=!1,importPopup:s=!1,interactionPrompt:o=!0}={}){await e.getOrAddPlugin(Ls),s&&await e.getOrAddPlugin(Sc),await e.getOrAddPlugin(At),await e.getOrAddPlugin(Ah),r&&await e.getOrAddPlugin(Ns),await e.addPlugin(new To(32)),await e.getOrAddPlugin(Qs),await e.getOrAddPlugin(ro),await e.addPlugin(new eo(i||!e.useRgbm)),await e.getOrAddPlugin(ah),await e.getOrAddPlugin(Kd),await e.getOrAddPlugin(Yo),await e.getOrAddPlugin(Lh),await e.getOrAddPlugin(El),await e.getOrAddPlugin(fo),await e.getOrAddPlugin(Io),await e.getOrAddPlugin(Ya),await e.getOrAddPlugin(Sl),await e.getOrAddPlugin(Nh),await e.getOrAddPlugin(ko),await e.getOrAddPlugin(Rl),await e.getOrAddPlugin(fh),await e.getOrAddPlugin(Ha),await e.getOrAddPlugin(Wh),await e.getOrAddPlugin(Ih),await e.getOrAddPlugin(nh,!1),await e.getOrAddPlugin(yh),await e.getOrAddPlugin(zd),await e.getOrAddPlugin(bl,!1),await e.getOrAddPlugin(Ul,!1),await e.getOrAddPlugin(Ro,!1),await e.getOrAddPlugin(jl,!1),await e.getOrAddPlugin(rl,!1),await e.getOrAddPlugin(al,!1),await e.getOrAddPlugin(Dh,!1),await e.getOrAddPlugin(vp),await e.getOrAddPlugin(Lp),await e.getOrAddPlugin(nm),await e.getOrAddPlugin(J_),await e.getOrAddPlugin($_),await e.getOrAddPlugin(H_),await e.getOrAddPlugin(ev),await e.getOrAddPlugin(Zd),await e.getOrAddPlugin(hh),n&&await e.getOrAddPlugin(yo),t&&await e.getOrAddPlugin(G_),o&&await e.getOrAddPlugin(iv),await e.getOrAddPlugin(Gh),e.renderer.refreshPipeline()}var ov=__webpackgi_require__(109),av={};ov.Z&&ov.Z.locals&&(av.locals=ov.Z.locals);var lv,cv=0,uv={};uv.styleTagTransform=uc(),uv.setAttributes=oc(),uv.insert=function(e,t){(t.target||document.head).appendChild(e)},uv.domAPI=rc(),uv.insertStyleElement=lc(),av.use=function(e){return uv.options=e||{},cv++||(lv=nc()(ov.Z,uv)),av},av.unuse=function(){cv>0&&! --cv&&(lv(),lv=null)};var dv=av;let hv=0;class pv extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=hv++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),n=document.createElement("style");n.textContent=t.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
            //.tippy-box[data-theme~='editor']{
            //    margin: 0.25rem !important;
            //    background-color: hsla(230, 10%, 30%, 1.00) !important;
            //    font-size: 0.9rem !important;
            //    color: hsla(230, 5%, 90%, 1.00) !important;
            //}
        `,dv.use({target:this.wrapper}),M_.setDefaultProps({duration:300,arrow:!0,appendTo:()=>this.wrapper}),this.shadowRoot.append(n,this.wrapper),this._initialized=!0,this._initialize(e).then((async()=>this.refreshAll()))}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){(null==e?void 0:e._lastState)&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),(null==e?void 0:e.__models)&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(null==e?void 0:e.canvas)||(0,t.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=null!=e?e:new rv({canvas:this.canvas,useRgbm:"true"===this._getAttr("rgbm","true"),useGBufferDepth:"true"===this._getAttr("depth-prepass","true"),assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:"true"===this._getAttr("debug","false"),ground:"baked"===this._getAttr("ground","baked"),bloom:"true"===this._getAttr("bloom","true"),depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,t;this.viewer&&("true"===this.getAttribute("disposeOnRemove")||"true"===this.getAttribute("disposeonremove")?(null===(e=this.canvas)||void 0===e||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):"true"===this.getAttribute("autoManageViewers")||"true"===this.getAttribute("automanageviewers")?(null===(t=this.canvas)||void 0===t||t.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,t,n){this.refreshAll()}clearViewer(){var e,t;null===(e=this.viewer)||void 0===e||e.scene.disposeSceneModels(),null===(t=this.viewer)||void 0===t||t.scene.setEnvironment(null),Object.values(this._models).forEach((async e=>e.then((e=>e.forEach((e=>e.dispose&&e.dispose())))))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src)return;if(this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],i=[],r=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const o of t)!this._models[o]&&o&&(this._models[o]=this.viewer.getManager().importer.importPath(o,{autoScale:"true"===this._getAttr("auto-scale","true"),autoCenter:"true"===this._getAttr("auto-center","true"),processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const s=this.viewer.scene.environment;s?this._environmentFromSource=s:this.viewer.scene.environment=r;for(const[o,a]of Object.entries(this._models))t.includes(o)?n.push(a.then((e=>[o,e]))):i.push(a);await Promise.all([Promise.all(n).then((async e=>Promise.all(e.map((async e=>(this._models[e[0]]=this.viewer.getManager().importer.processImported(e[1]),this._models[e[0]])))))).then((e=>{for(const t of e)for(const e of t)e&&"model"===e.assetType&&this.viewer.scene.addSceneObject(e)})),Promise.all(i).then((e=>{for(const t of e)for(const e of t)e&&"model"===e.assetType&&e.modelObject.removeFromParent()}))]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src)return;if(this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(n&&"texture"!==n.assetType||await this.viewer.scene.setEnvironment(n),null==t||t.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}addEventListener(e,t,n){super.addEventListener(e,t,n),"initialized"===e&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",pv);var fv=__webpackgi_require__(798),mv={};fv.Z&&fv.Z.locals&&(mv.locals=fv.Z.locals);var gv,_v=0,vv={};vv.styleTagTransform=uc(),vv.setAttributes=oc(),vv.insert=function(e,t){(t.target||document.head).appendChild(e)},vv.domAPI=rc(),vv.insertStyleElement=lc(),mv.use=function(e){return vv.options=e||{},_v++||(gv=nc()(fv.Z,vv)),mv},mv.unuse=function(){_v>0&&! --_v&&(gv(),gv=null)};var yv=mv;let bv=class extends xc{constructor(){super("Popup");const e=(0,t.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});e.addEventListener("click",(()=>{this._mainDiv.style.display="none"})),this._mainDiv.appendChild(e)}_updateMainDiv(e){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let t="";e.forEach(((e,n)=>{t+=`<span class="processState">${e.state}</span>: ${(n||"").split("/").pop()} ${e.progress?" - "+e.progress.toFixed(0)+"%":""}<br>`})),this._contentDiv.innerHTML=t,0===e.size?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(e){yv.use({target:e.container}),await super.onAdded(e)}};bv.PluginType="AssetManagerBasicPopupPlugin",bv=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([We("Asset manager popup")],bv);var Av=__webpackgi_require__(44),wv={};Av.Z&&Av.Z.locals&&(wv.locals=Av.Z.locals);var xv,Ev=0,Cv={};Cv.styleTagTransform=uc(),Cv.setAttributes=oc(),Cv.insert=function(e,t){(t.target||document.head).appendChild(e)},Cv.domAPI=rc(),Cv.insertStyleElement=lc(),wv.use=function(e){return Cv.options=e||{},Ev++||(xv=nc()(Av.Z,Cv)),wv},wv.unuse=function(){Ev>0&&! --Ev&&(xv(),xv=null)};var Sv=wv,Mv=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Tv=class extends xc{constructor(e=!0){super("LoadingBar"),this.showText=e,this.hideOnOnlyErrors=!0}_updateMainDiv(e){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let t=1,n=1;e.forEach(((e,i)=>{var r;t+=null!==(r=e.progress)&&void 0!==r?r:99,n+=100})),this._contentDiv.innerHTML=this.showText?(100*t/n).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*t/n).toFixed(0)+"%";const i=[...e.values()].filter((e=>"error"===e.state));i.length>0&&i.length===e.size&&this.hideOnOnlyErrors||0===e.size?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(e){Sv.use({target:e.container}),await super.onAdded(e)}};Tv.PluginType="AssetManagerLoadingBarPlugin",Mv([Oe("Hide on only errors"),re()],Tv.prototype,"hideOnOnlyErrors",void 0),Tv=Mv([We("Asset manager loading bar")],Tv);class Iv{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var t,n,i;this._basePath=null!==(t=null==e?void 0:e.basePath)&&void 0!==t?t:"",this._assets=null!==(i=null===(n=null==e?void 0:e.assets)||void 0===n?void 0:n.map((e=>this._resolveAsset(e))))&&void 0!==i?i:[]}find(e){const t=this._assets.find(e);return null!=t?t:void 0}_resolveAsset(e){return{...e,path:(0,t.pathJoin)([this._basePath,e.path])}}}class Pv extends t.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find((t=>{var n,i;return t&&(e.test(t.path)||e.test(null!==(i=null===(n=t.file)||void 0===n?void 0:n.name)&&void 0!==i?i:""))}));if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}const Rv=new n.Pa4,Dv=new n.Pa4,kv=new n.Ltg,Bv=new n.Ltg,Ov=new n.Ltg,Lv=new n.Pa4,Uv=new n.yGw,Nv=new n.Zzh,Fv=new n.Pa4,jv=new n.ZzF,zv=new n.aLr,Gv=new n.Ltg;let Vv,Hv,Qv,Wv,qv,Xv;function Yv(e,t,n){return Gv.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),Gv.multiplyScalar(1/Gv.w),Gv.x=Hv/n.width,Gv.y=Hv/n.height,Gv.applyMatrix4(e.projectionMatrixInverse),Gv.multiplyScalar(1/Gv.w),Math.abs(Math.max(Gv.x,Gv.y))}class Kv extends n.Kj0{constructor(e=new $o,t=new ta({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let n=0,o=0,a=t.count;n<a;n++,o+=2)Rv.fromBufferAttribute(t,n),Dv.fromBufferAttribute(i,n),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+Rv.distanceTo(Dv);const s=new n.$TI(r,2,1);return e.setAttribute("instanceDistanceStart",new n.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new n.kB5(s,1,1)),this}raycast(e,t){const i=this.material.worldUnits,r=e.camera;null!==r||i||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=void 0!==e.params.Line2&&e.params.Line2.threshold||0;Vv=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;let c,u;Hv=l.linewidth+s,null===a.boundingSphere&&a.computeBoundingSphere(),zv.copy(a.boundingSphere).applyMatrix4(o),c=i?.5*Hv:Yv(r,Math.max(r.near,zv.distanceToPoint(Vv.origin)),l.resolution),zv.radius+=c,!1!==Vv.intersectsSphere(zv)&&(null===a.boundingBox&&a.computeBoundingBox(),jv.copy(a.boundingBox).applyMatrix4(o),u=i?.5*Hv:Yv(r,Math.max(r.near,jv.distanceToPoint(Vv.origin)),l.resolution),jv.expandByScalar(u),!1!==Vv.intersectsBox(jv)&&(i?function(e,t){const i=e.matrixWorld,r=e.geometry,s=r.attributes.instanceStart,o=r.attributes.instanceEnd;for(let a=0,l=Math.min(r.instanceCount,s.count);a<l;a++){Nv.start.fromBufferAttribute(s,a),Nv.end.fromBufferAttribute(o,a),Nv.applyMatrix4(i);const r=new n.Pa4,l=new n.Pa4;Vv.distanceSqToSegment(Nv.start,Nv.end,l,r),l.distanceTo(r)<.5*Hv&&t.push({point:l,pointOnLine:r,distance:Vv.origin.distanceTo(l),object:e,face:null,faceIndex:a,uv:null,uv1:null})}}(this,t):function(e,t,i){const r=t.projectionMatrix,s=e.material.resolution,o=e.matrixWorld,a=e.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,u=Math.min(a.instanceCount,l.count),d=-t.near;Vv.at(1,Ov),Ov.w=1,Ov.applyMatrix4(t.matrixWorldInverse),Ov.applyMatrix4(r),Ov.multiplyScalar(1/Ov.w),Ov.x*=s.x/2,Ov.y*=s.y/2,Ov.z=0,Lv.copy(Ov),Uv.multiplyMatrices(t.matrixWorldInverse,o);for(let h=0,p=u;h<p;h++){if(kv.fromBufferAttribute(l,h),Bv.fromBufferAttribute(c,h),kv.w=1,Bv.w=1,kv.applyMatrix4(Uv),Bv.applyMatrix4(Uv),kv.z>d&&Bv.z>d)continue;if(kv.z>d){const e=kv.z-Bv.z,t=(kv.z-d)/e;kv.lerp(Bv,t)}else if(Bv.z>d){const e=Bv.z-kv.z,t=(Bv.z-d)/e;Bv.lerp(kv,t)}kv.applyMatrix4(r),Bv.applyMatrix4(r),kv.multiplyScalar(1/kv.w),Bv.multiplyScalar(1/Bv.w),kv.x*=s.x/2,kv.y*=s.y/2,Bv.x*=s.x/2,Bv.y*=s.y/2,Nv.start.copy(kv),Nv.start.z=0,Nv.end.copy(Bv),Nv.end.z=0;const t=Nv.closestPointToPointParameter(Lv,!0);Nv.at(t,Fv);const a=n.M8C.lerp(kv.z,Bv.z,t),u=a>=-1&&a<=1,p=Lv.distanceTo(Fv)<.5*Hv;if(u&&p){Nv.start.fromBufferAttribute(l,h),Nv.end.fromBufferAttribute(c,h),Nv.start.applyMatrix4(o),Nv.end.applyMatrix4(o);const t=new n.Pa4,r=new n.Pa4;Vv.distanceSqToSegment(Nv.start,Nv.end,r,t),i.push({point:r,pointOnLine:t,distance:Vv.origin.distanceTo(r),object:e,face:null,faceIndex:h,uv:null,uv1:null})}}}(this,r,t)))}}class Jv extends $o{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Zv extends Kv{constructor(e=new Jv,t=new ta({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class $v extends n.DqL{constructor(e){super(e)}parse(e,t){const n=new ey(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:6===n.numberOfFaces,mipmapCount:n.numberOfMipmapLevels}}}class ey{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(171!==n[0]||75!==n[1]||84!==n[2]||88!==n[3]||32!==n[4]||49!==n[5]||49!==n[6]||187!==n[7]||13!==n[8]||10!==n[9]||26!==n[10]||10!==n[11])return void console.error("texture missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,r=new DataView(this.arrayBuffer,12,13*i),s=67305985===r.getUint32(0,!0);this.glType=r.getUint32(1*i,s),this.glTypeSize=r.getUint32(2*i,s),this.glFormat=r.getUint32(3*i,s),this.glInternalFormat=r.getUint32(4*i,s),this.glBaseInternalFormat=r.getUint32(5*i,s),this.pixelWidth=r.getUint32(6*i,s),this.pixelHeight=r.getUint32(7*i,s),this.pixelDepth=r.getUint32(8*i,s),this.numberOfArrayElements=r.getUint32(9*i,s),this.numberOfFaces=r.getUint32(10*i,s),this.numberOfMipmapLevels=r.getUint32(11*i,s),this.bytesOfKeyValueData=r.getUint32(12*i,s),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,i=this.pixelWidth,r=this.pixelHeight;const s=e?this.numberOfMipmapLevels:1;for(let o=0;o<s;o++){const e=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let s=0;s<this.numberOfFaces;s++){const s=new Uint8Array(this.arrayBuffer,n,e);t.push({data:s,width:i,height:r}),n+=e,n+=3-(e+3)%4}i=Math.max(1,.5*i),r=Math.max(1,.5*r)}return t}}class ty extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ls]}async onAdded(e){var t,n;this._importer||(this._importer=new Nt($v,["ktx"],!1)),null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&(null===(n=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===n?void 0:n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}ty.PluginType="KTXLoadPlugin";class ny extends n.hH6{constructor(e){super(e),this.responseType="blob"}}class iy extends n.hH6{constructor(e){super(e),this.responseType="blob"}load(e,n,i,r){return super.load(e,(e=>{try{null==n||n((0,t.blobToDataURL)(e))}catch(e){null==r||r(e)}}),i,r)}}class ry{async parseAsync(e,t){var n;return new Blob([JSON.stringify(e,null,null!==(n=t.jsonSpaces)&&void 0!==n?n:2)],{type:"application/json"})}}class sy{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}function oy(e,t=1/0,i=null){Wv||(Wv=new n._12(2,2,1,1)),qv||(qv=new n.jyz({uniforms:{blitTexture:new n.xWb(e)},vertexShader:"\n            varying vec2 vUv;\n            void main(){\n                vUv = uv;\n                gl_Position = vec4(position.xy * 1.0,0.,.999999);\n            }",fragmentShader:"\n            uniform sampler2D blitTexture; \n            varying vec2 vUv;\n\n            void main(){ \n                gl_FragColor = vec4(vUv.xy, 0, 1);\n                \n                #ifdef IS_SRGB\n                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n                #else\n                gl_FragColor = texture2D( blitTexture, vUv);\n                #endif\n            }"})),qv.uniforms.blitTexture.value=e,qv.defines.IS_SRGB=e.colorSpace==n.KI_,qv.needsUpdate=!0,Xv||(Xv=new n.Kj0(Wv,qv),Xv.frustrumCulled=!1);const r=new n.cPb,s=new n.xsS;s.add(Xv),i||(i=Qv=new n.CP7({antialias:!1})),i.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),i.clear(),i.render(s,r);const o=new n.xEZ(i.domElement);return o.minFilter=e.minFilter,o.magFilter=e.magFilter,o.wrapS=e.wrapS,o.wrapT=e.wrapT,o.name=e.name,Qv&&(Qv.dispose(),Qv=null),o}const ay={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class ly{constructor(){this.pluginCallbacks=[],this.register((function(e){return new xy(e)})),this.register((function(e){return new Ey(e)})),this.register((function(e){return new My(e)})),this.register((function(e){return new Ty(e)})),this.register((function(e){return new Iy(e)})),this.register((function(e){return new Py(e)})),this.register((function(e){return new Cy(e)})),this.register((function(e){return new Sy(e)})),this.register((function(e){return new Ry(e)})),this.register((function(e){return new Dy(e)})),this.register((function(e){return new ky(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,r){const s=r||new wy,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](s));s.setPlugins(o),s.write(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,i,r,t)}))}}const cy=5120,uy=5121,dy=5122,hy=5123,py="KHR_mesh_quantization",fy={};fy[n.TyD]=9728,fy[n.YLQ]=9984,fy[n.aH4]=9986,fy[n.wem]=9729,fy[n.qyh]=9985,fy[n.D1R]=9987,fy[n.uWy]=33071,fy[n.rpg]=10497,fy[n.OoA]=33648;const my={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},gy=new n.Ilk;function _y(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function vy(e){return 4*Math.ceil(e/4)}function yy(e,t=0){const n=vy(e.byteLength);if(n!==e.byteLength){const i=new Uint8Array(n);if(i.set(new Uint8Array(e)),0!==t)for(let r=e.byteLength;r<n;r++)i[r]=t;return i.buffer}return e}function by(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Ay(e,t){if(void 0!==e.toBlob)return new Promise((n=>e.toBlob(n,t)));let n;return"image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n})}class wy{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,r=i.buffers,s=i.json;n=i.options;const o=i.extensionsUsed,a=i.extensionsRequired,l=new Blob(r,{type:"application/octet-stream"}),c=Object.keys(o),u=Object.keys(a);if(c.length>0&&(s.extensionsUsed=c),u.length>0&&(s.extensionsRequired=u),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=l.size),!0===n.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const n=yy(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,n.byteLength,!0),i.setUint32(4,5130562,!0);const r=yy((o=JSON.stringify(s),(new TextEncoder).encode(o).buffer),32);var o;const a=new DataView(new ArrayBuffer(8));a.setUint32(0,r.byteLength,!0),a.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const u=12+a.byteLength+r.byteLength+i.byteLength+n.byteLength;c.setUint32(8,u,!0);const d=new Blob([l,a,r,i,n],{type:"application/octet-stream"}),h=new FileReader;h.readAsArrayBuffer(d),h.onloadend=function(){t(h.result)}}}else if(s.buffers&&s.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const n=e.result;s.buffers[0].uri=n,t(s)}}else t(s)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const n=this.options,i=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in r.gltfExtensions)t.extensions[e]=r.gltfExtensions[e],i[e]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message),console.warn({...e.userData})}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new n.Pa4;for(let n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),r=new n.Pa4;for(let n=0,s=i.count;n<s;n++)r.fromBufferAttribute(i,n),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),i.setXYZ(n,r.x,r.y,r.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let n=!1;const i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(i.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(e){return e.colorSpace===n.KI_?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof n.EB7&&(e=oy(e)),t instanceof n.EB7&&(t=oy(t));const r=e?e.image:null,s=t?t.image:null,o=Math.max(r?r.width:0,s?s.width:0),a=Math.max(r?r.height:0,s?s.height:0),l=by();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const u=c.getImageData(0,0,o,a);if(r){c.drawImage(r,0,0,o,a);const t=i(e),n=c.getImageData(0,0,o,a).data;for(let e=2;e<n.length;e+=4)u.data[e]=256*t(n[e]/256)}if(s){c.drawImage(s,0,0,o,a);const e=i(t),n=c.getImageData(0,0,o,a).data;for(let t=1;t<n.length;t+=4)u.data[t]=256*e(n[t]/256)}c.putImageData(u,0,0);const d=(e||t).clone();return d.source=new n.Hw6(l),d.colorSpace=n.aCh,d.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),d}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,i,r,s){const o=this.json;let a;switch(o.bufferViews||(o.bufferViews=[]),t){case cy:case uy:a=1;break;case dy:case hy:a=2;break;default:a=4}const l=vy(r*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let u=0;for(let h=i;h<i+r;h++)for(let i=0;i<e.itemSize;i++){let r;e.itemSize>4?r=e.array[h*e.itemSize+i]:(0===i?r=e.getX(h):1===i?r=e.getY(h):2===i?r=e.getZ(h):3===i&&(r=e.getW(h)),!0===e.normalized&&(r=n.M8C.normalize(r,e.array))),5126===t?c.setFloat32(u,r,!0):5124===t?c.setInt32(u,r,!0):5125===t?c.setUint32(u,r,!0):t===dy?c.setInt16(u,r,!0):t===hy?c.setUint16(u,r,!0):t===cy?c.setInt8(u,r):t===uy&&c.setUint8(u,r),u+=a}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return void 0!==s&&(d.target=s),34962===s&&(d.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise((function(i){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const e=yy(r.result),s={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(n.bufferViews.push(s)-1)}}))}processBufferViewImageBuffer(e){const t=this,n=t.json;n.bufferViews||(n.bufferViews=[]),e=yy(e);const i={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,n.bufferViews.push(i)-1}processAccessor(e,t,i,r){const s=this.json;let o;if(e.array.constructor===Float32Array)o=5126;else if(e.array.constructor===Int32Array)o=5124;else if(e.array.constructor===Uint32Array)o=5125;else if(e.array.constructor===Int16Array)o=dy;else if(e.array.constructor===Uint16Array)o=hy;else if(e.array.constructor===Int8Array)o=cy;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);o=uy}if(void 0===i&&(i=0),void 0===r&&(r=e.count),0===r)return null;const a=function(e,t,i){const r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=t;s<t+i;s++)for(let t=0;t<e.itemSize;t++){let i;e.itemSize>4?i=e.array[s*e.itemSize+t]:(0===t?i=e.getX(s):1===t?i=e.getY(s):2===t?i=e.getZ(s):3===t&&(i=e.getW(s)),!0===e.normalized&&(i=n.M8C.normalize(i,e.array))),r.min[t]=Math.min(r.min[t],i),r.max[t]=Math.max(r.max[t],i)}return r}(e,i,r);let l;void 0!==t&&(l=e===t.index?34963:34962);const c=this.processBufferView(e,o,i,r,l),u={bufferView:c.id,byteOffset:c.byteOffset,componentType:o,count:r,max:a.max,min:a.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(u.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(u)-1}processImage(e,t,i,r="image/png",s=void 0,o=void 0){if(null!==e){const a=this,l=a.cache,c=a.json,u=a.options,d=a.pending;l.images.has(e)||l.images.set(e,{});const h=l.images.get(e),p=r+":flipY/"+i.toString()+(s||o?";"+s+";"+o:"");if(void 0!==h[p])return h[p];c.images||(c.images=[]);const f={mimeType:r},m=by();m.width=Math.min(s||e.width,u.maxTextureSize),m.height=Math.min(o||e.height,u.maxTextureSize);const g=m.getContext("2d");if(!0===i&&(g.translate(0,m.height),g.scale(1,-1)),void 0!==e.data){t!==n.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>u.maxTextureSize||e.height>u.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const i=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<i.length;t+=4)i[t+0]=e.data[t+0],i[t+1]=e.data[t+1],i[t+2]=e.data[t+2],i[t+3]=e.data[t+3];g.putImageData(new ImageData(i,e.width,e.height),0,0)}else g.drawImage(e,0,0,m.width,m.height);!0===u.binary?d.push(Ay(m,r).then((e=>a.processBufferViewImage(e))).then((e=>{f.bufferView=e}))):void 0!==m.toDataURL?f.uri=m.toDataURL(r):d.push(Ay(m,r).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{f.uri=e})));const _=c.images.push(f)-1;return h[p]=_,_}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:fy[e.magFilter],minFilter:fy[e.minFilter],wrapS:fy[e.wrapS],wrapT:fy[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.options,i=this.cache,r=this.json;if(i.textures.has(e))return i.textures.get(e);r.textures||(r.textures=[]),e instanceof n.EB7&&(e=oy(e,t.maxTextureSize));let s=e.userData.mimeType;"image/webp"===s&&(s="image/png"),"image/jpg"===s&&(s="image/jpeg");const o={sampler:this.processSampler(e),source:!s||["image/jpeg","image/png"].includes(s)?this.processImage(e.image,e.format,e.flipY,s):null};e.name&&(o.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,o)})),null===o.source&&console.error("GLTFExporter: Unsupported mime type: "+s+". Cannot export texture.",e);const a=r.textures.push(o)-1;return i.textures.set(e,a),a}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const r={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(_y(s,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),n={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(n,t),r.pbrMetallicRoughness.metallicRoughnessTexture=n}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),r.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),r.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),r.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),r.occlusionTexture=t}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===n.ehD&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,r)}));const o=i.materials.push(r)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,i=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let n=0,y=e.material.length;n<y;n++)r.push(e.material[n].uuid);else r.push(e.material.uuid);const s=r.join(":");if(t.meshes.has(s))return t.meshes.get(s);const o=e.geometry;let a;a=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const l={},c={},u=[],d=[],h={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");void 0===p||this.isNormalizedNormalAttribute(p)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let f=null;for(let y in o.attributes){if("morph"===y.slice(0,5))continue;const e=o.attributes[y];if(y=h[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(e))){c[y]=t.attributes.get(this.getUID(e));continue}f=null;const i=e.array;"JOINTS_0"!==y||i instanceof Uint16Array||i instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new n.TlE(new Uint16Array(i),e.itemSize,e.normalized));const r=this.processAccessor(f||e,o);null!==r&&(y.startsWith("_")||this.detectMeshQuantization(y,e),c[y]=r,t.attributes.set(this.getUID(e),r))}if(void 0!==p&&o.setAttribute("normal",p),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const n=[],i=[],r={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)r[e.morphTargetDictionary[t]]=t;for(let s=0;s<e.morphTargetInfluences.length;++s){const a={};let l=!1;for(const e in o.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const n=o.morphAttributes[e][s],i=e.toUpperCase(),r=o.attributes[e];if(t.attributes.has(this.getUID(n,!0))){a[i]=t.attributes.get(this.getUID(n,!0));continue}const c=n.clone();if(!o.morphTargetsRelative)for(let e=0,t=n.count;e<t;e++)for(let i=0;i<n.itemSize;i++)0===i&&c.setX(e,n.getX(e)-r.getX(e)),1===i&&c.setY(e,n.getY(e)-r.getY(e)),2===i&&c.setZ(e,n.getZ(e)-r.getZ(e)),3===i&&c.setW(e,n.getW(e)-r.getW(e));a[i]=this.processAccessor(c,o),t.attributes.set(this.getUID(r,!0),a[i])}d.push(a),n.push(e.morphTargetInfluences[s]),void 0!==e.morphTargetDictionary&&i.push(r[s])}l.weights=n,i.length>0&&(l.extras={},l.extras.targetNames=i)}const m=Array.isArray(e.material);if(m&&0===o.groups.length)return null;const g=m?e.material:[e.material],_=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let n=0,y=_.length;n<y;n++){const e={mode:a,attributes:c};if(this.serializeUserData(o,e),d.length>0&&(e.targets=d),null!==o.index){let i=this.getUID(o.index);void 0===_[n].start&&void 0===_[n].count||(i+=":"+_[n].start+":"+_[n].count),t.attributes.has(i)?e.indices=t.attributes.get(i):(e.indices=this.processAccessor(o.index,o,_[n].start,_[n].count),t.attributes.set(i,e.indices)),null===e.indices&&delete e.indices}const i=this.processMaterial(g[_[n].materialIndex]);null!==i&&(e.material=i),u.push(e)}l.primitives=u,i.meshes||(i.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,l)}));const v=i.meshes.push(l)-1;return t.meshes.set(s,v),v}detectMeshQuantization(e,t){if(this.extensionsUsed[py])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const i=e.split("_",1)[0];ay[i]&&ay[i].includes(n)&&(this.extensionsUsed[py]=!0,this.extensionsRequired[py]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,r={type:i?"orthographic":"perspective"};return i?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:n.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const i=this.json,r=this.nodeMap;i.animations||(i.animations=[]);const s=(e=ly.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,o=[],a=[];for(let l=0;l<s.length;++l){const e=s[l],i=n.iUV.parseTrackName(e.name);let c=n.iUV.findNode(t,i.nodeName);const u=my[i.propertyName];if("bones"===i.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(i.objectIndex):void 0),!c||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',e.name),null;const d=1;let h,p=e.values.length/e.times.length;u===my.morphTargetInfluences&&(p/=c.morphTargetInfluences.length),!0===e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",p/=3):h=e.getInterpolation()===n.Syv?"STEP":"LINEAR",a.push({input:this.processAccessor(new n.TlE(e.times,d)),output:this.processAccessor(new n.TlE(e.values,p)),interpolation:h}),o.push({sampler:a.length-1,target:{node:r.get(c),path:u}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,r=t.nodes[i.get(e)],s=e.skeleton;if(void 0===s)return null;const o=e.skeleton.bones[0];if(void 0===o)return null;const a=[],l=new Float32Array(16*s.bones.length),c=new n.yGw;for(let n=0;n<s.bones.length;++n)a.push(i.get(s.bones[n])),c.copy(s.boneInverses[n]),c.multiply(e.bindMatrix).toArray(l,16*n);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new n.TlE(l,16)),joints:a,skeleton:i.get(o)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(n.trs){const t=e.quaternion.toArray(),n=e.position.toArray(),i=e.scale.toArray();_y(t,[0,0,0,1])||(r.rotation=t),_y(n,[0,0,0])||(r.translation=n),_y(i,[1,1,1])||(r.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===_y(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(r.matrix=e.matrix.elements);if(""!==e.name&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(r.mesh=t)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let i=0,r=e.children.length;i<r;i++){const r=e.children[i];if(r.visible||!1===n.onlyVisible){const e=this.processNode(r);null!==e&&t.push(e)}}t.length>0&&(r.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,r)}));const s=t.nodes.push(r)-1;return i.set(e,s),s}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);const r=[];for(let s=0,o=e.children.length;s<o;s++){const t=e.children[s];if(t.visible||!1===n.onlyVisible){const e=this.processNode(t);null!==e&&r.push(e)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}processObjects(e){const t=new n.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const i=[];for(let r=0;r<e.length;r++)e[r]instanceof n.xsS?this.processScene(e[r]):i.push(e[r]);i.length>0&&this.processObjects(i);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class xy{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,i=n.json,r=n.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,s.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);const o=i.extensions[this.name].lights;o.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class Ey{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Cy{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(t,e.clearcoatMap),r.clearcoatTexture=t}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(t,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(t,e.clearcoatNormalMap),r.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class Sy{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(t,e.iridescenceMap),r.iridescenceTexture=t}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(t,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class My{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const t={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(t,e.transmissionMap),r.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class Ty{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const t={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(t,e.thicknessMap),r.thicknessTexture=t}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class Iy{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Py{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(gy)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,i=n.extensionsUsed,r={};if(e.specularIntensityMap){const t={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(t,e.specularIntensityMap),r.specularTexture=t}if(e.specularColorMap){const t={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(t,e.specularColorMap),r.specularColorTexture=t}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class Ry{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const n=this.writer,i=n.extensionsUsed,r={};if(e.sheenRoughnessMap){const t={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(t,e.sheenRoughnessMap),r.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(t,e.sheenColorMap),r.sheenColorTexture=t}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,i[this.name]=!0}}class Dy{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const n=this.writer,i=n.extensionsUsed,r={};if(e.anisotropyMap){const t={index:n.processTexture(e.anisotropyMap)};n.applyTextureTransform(t,e.anisotropyMap),r.anisotropyTexture=t}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class ky{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}ly.Utils={GLTFWriter:wy,insertKeyframe:function(e,t){const n=.001,i=e.getValueSize(),r=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+i),o=e.createInterpolant(new e.ValueBufferType(i));let a;if(0===e.times.length){r[0]=t;for(let e=0;e<i;e++)s[e]=0;a=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<n)return 0;r[0]=t,r.set(e.times,1),s.set(o.evaluate(t),0),s.set(e.values,i),a=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<n)return e.times.length-1;r[r.length-1]=t,r.set(e.times,0),s.set(e.values,0),s.set(o.evaluate(t),e.values.length),a=r.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<n)return l;if(e.times[l]<t&&e.times[l+1]>t){r.set(e.times.slice(0,l+1),0),r[l+1]=t,r.set(e.times.slice(l+1),l+2),s.set(e.values.slice(0,(l+1)*i),0),s.set(o.evaluate(t),(l+1)*i),s.set(e.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return e.times=r,e.values=s,a},mergeMorphTargetTracks:function(e,t){const i=[],r={},s=e.tracks;for(let o=0;o<s.length;++o){let e=s[o];const a=n.iUV.parseTrackName(e.name),l=n.iUV.findNode(t,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){i.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),e=e.clone(),e.setInterpolation(n.NMF)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(void 0===u)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(void 0===r[l.uuid]){d=e.clone();const t=new d.ValueBufferType(c*d.times.length);for(let e=0;e<d.times.length;e++)t[e*c+u]=d.values[e];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=t,r[l.uuid]=d,i.push(d);continue}const h=e.createInterpolant(new e.ValueBufferType(1));d=r[l.uuid];for(let t=0;t<d.times.length;t++)d.values[t*c+u]=h.evaluate(d.times[t]);for(let t=0;t<e.times.length;t++){const n=this.insertKeyframe(d,e.times[t]);d.values[n*c+u]=e.values[t]}}return e.tracks=i,e}};class By extends ly.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new n.Wid}serializeUserData(e,t){const n=e.userData,i={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach((([e,t])=>{(!t||"function"==typeof t||t.isObject3D||t.isTexture||t.isMaterial||null!=t.assetType||e.startsWith("_")||"uuid"!==e&&(we.includes(e)||xe.includes(e)||Y.includes(e)))&&(i[e]=t,delete n[e])}));const r=le(n,!1);Object.entries(i).forEach((([e,t])=>{n[e]=t,delete i[e]})),e.userData=r,super.serializeUserData(e,t),e.userData=n}processObjects(e){var t;1===e.length&&(null===(t=e[0])||void 0===t?void 0:t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(null===n)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return n;const i=JSON.stringify(this.json.materials[n]),r=JSON.parse(i);this.serializeUserData(e,r),this._invokeAll((t=>{t.writeMaterial&&t.writeMaterial(e,r)}));const s=this.json.materials.push(r)-1;return this.cache.materials.set(e,s),s}processImageBlob(e,n){if(!e)return-1;const i=this.cache,r=this.options,s=this.pending,o=this.json,a=n.image;i.images.has(a)||i.images.set(a,{});const l=i.images.get(a),c=e.type+":flipY/"+n.flipY.toString();if(void 0!==l[c])return l[c];o.images||(o.images=[]);const u={mimeType:e.type};!0===r.binary?s.push(new Promise((t=>{this.processBufferViewImage(e).then((e=>{u.bufferView=e,t()}))}))):s.push((0,t.blobToDataURL)(e).then((e=>{u.uri=e})));const d=o.images.push(u)-1;return l[c]=d,d}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const i=e.source.data,r=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const s=super.processTexture(e),o=n.textures[s];if(!o)return console.error("No texture def",s,e),s;const a=n.images?n.images[o.source]:null;if(a&&(a.extras||(a.extras={}),e.source&&(a.extras.uuid=e.source.uuid),a.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=i,e.userData.mimeType=r,!o)return console.error("textureDef is null",s,e),s;if(o.source>=0){const t=this.json.images[o.source];t.uri?console.warn("GLTFWriter2: uri already set",t.uri):(t.uri=e.userData.rootPath,t.mimeType=r,t.extras||(t.extras={}),t.extras.flipY=e.flipY,t.extras.uri=e.userData.rootPath)}else o.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,r)}return o.source<0&&console.error("textureDef.source cannot be saved",o,e),s}processImage(e,t,n,i="image/png"){return e?super.processImage(e,t,n,i,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,n,i="image/png"){const r=this.cache,s=this.json;r.images.has(e)||r.images.set(e,{});const o=r.images.get(e),a=i+":flipY/"+n.toString();if(void 0!==o[a])return o[a];s.images||(s.images=[]);const l={mimeType:i,uri:t,extras:{flipY:n}},c=s.images.push(l)-1;return o[a]=c,c}}function Oy(e,t){(t=null!=t?t:document.createElement("script")).type=e.type||"text/javascript",t.text=e.text;for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];t.setAttribute(i.name,i.value)}return t}function Ly(e,t=0){const n=(i=e.byteLength,4*Math.ceil(i/4));var i;if(n!==e.byteLength){const i=new Uint8Array(n);if(i.set(new Uint8Array(e)),0!==t)for(let r=e.byteLength;r<n;r++)i[r]=t;return i.buffer}return e}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){const n=new Uint8Array(this);null==t&&(t=n.length);const i=new ArrayBuffer(t-e),r=new Uint8Array(i);for(let s=0;s<r.length;s++)r[s]=n[s+e];return i});class Uy extends ly{register(e){return super.register(e)}async parseAsync(e,n){var i;if(!e)throw new Error("No object to export");const r=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise(((t,i)=>this.parse(e,t,i,n)));if(r&&"object"==typeof r&&!r.byteLength)return new Blob([JSON.stringify(r,((e,t)=>e.startsWith("__")?void 0:t),null!==(i=n.jsonSpaces)&&void 0!==i?i:2)],{type:"model/gltf+json"});if(r){let e=null;return n.encrypt&&(!n.encryptKey&&window.prompt&&(n.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),n.encryptKey?e=function(e){const t=Ly(e),n=new DataView(new ArrayBuffer(8));n.setUint32(0,t.byteLength,!0),n.setUint32(4,5130562,!0);const i=Ly((new TextEncoder).encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}}||{})).buffer,32),r=new DataView(new ArrayBuffer(8));r.setUint32(0,i.byteLength,!0),r.setUint32(4,1313821514,!0);const s=new ArrayBuffer(12),o=new DataView(s);o.setUint32(0,1179937895,!0),o.setUint32(4,2,!0);const a=12+r.byteLength+i.byteLength+n.byteLength+t.byteLength;o.setUint32(8,a,!0);const l=new Blob([s,r,i,n,t],{type:"application/octet-stream"});return l.ext="glb",l}(await(0,t.aesGcmEncrypt)(new Uint8Array(r),n.encryptKey)):console.warn("WebGi GLTF Export: encryption key not provided, skipping encryption")),e||(e=new Blob([r],{type:"model/gltf+binary"})),e}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,i={}){var r;const s={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!i.embedUrlImages&&i.externalImagesInExtras||!1,embedUrlImages:null!==(r=i.embedUrlImages)&&void 0!==r&&r,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:i};return"glb"===i.exportExt&&(s.binary=!0),!1!==i.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{e.uuid&&(e.userData.gltfUUID=e.uuid)})))),(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{if(e.animations)for(const t of e.animations)!1===t.__gltfExport||s.animations.includes(t)||s.animations.push(...e.animations)})))),super.parse(e,(n=>{!1!==i.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{delete e.userData.gltfUUID})))),t(Object.assign(n,{__isGLTFOutput:!0}))}),n,s,new By)}}function Ny(e,t){const i=e.getPlugin(Ls).exportViewerConfig();t.json.textures&&t.json.samplers&&t.json.images&&i.resources.textures&&[...Object.entries(i.resources.textures)].forEach((([e,n])=>{const r=t.json.textures.find((n=>{var i,r,s,o,a;return(null===(i=n.extras)||void 0===i?void 0:i.uuid)===e||(null===(s=null===(r=t.json.samplers[n.sampler])||void 0===r?void 0:r.extras)||void 0===s?void 0:s.uuid)===e||(null===(a=null===(o=t.json.images[n.source])||void 0===o?void 0:o.extras)||void 0===a?void 0:a.t_uuid)===e}));r&&(n.image&&i.resources.images&&i.resources.images[n.image]&&delete i.resources.images[n.image],i.resources.textures[e]={})})),t.json.materials&&i.resources.materials&&[...Object.entries(i.resources.materials)].forEach((([e,n])=>{const r=t.json.materials.find((t=>{var n;return(null===(n=t.extras)||void 0===n?void 0:n.uuid)===e}));r&&(i.resources.materials[e]={})}));const r=[];Object.values(i.resources).forEach((e=>{e&&Object.values(e).forEach((e=>{e.url&&("Uint16Array"===e.url.type&&e.url.data?(e.url.data instanceof Uint16Array||(e.url.data=new Uint16Array(e.url.data)),r.push(e.url)):"Uint8Array"===e.url.type&&e.url.data&&(e.url.data instanceof Uint8Array||(e.url.data=new Uint8Array(e.url.data)),r.push(e.url)))}))}));for(const s of r){let e="application/octet-stream";if(s.mimeType&&(e=s.mimeType),t.options.exporterOptions.encodeUint16Rgbe&&"Uint16Array"===s.type&&s.width>0&&s.height>0){const t=Fy(s.data,4),i=new ImageData(t,s.width,s.height),r=n.PpQ.getDataURL(i,!0).split(",")[1],o=2;if(e="image/png",1===o)s.data=atob(r);else{if(2!==o)throw new Error("Invalid encoding version");s.data=Uint8Array.from(atob(r),(e=>e.charCodeAt(0)))}s.encoding="rgbe",s.encodingVersion=o}t.json.images||(t.json.images=[]);const i={mimeType:e},r=t.json.images.push(i)-1,o=s.data;i.bufferView=t.processBufferViewImageBuffer(o),s.data={image:r}}return i}function Fy(e,t=3,n){let i,r,s,o,a;const l=e.byteLength/(2*t)|0;n=n||new Uint8ClampedArray(4*l);for(let c=0;c<l;c++){i=e[c*t],r=e[c*t+1],s=e[c*t+2],o=Math.max(Math.max(i,r),s);const l=Math.ceil(Math.log2(o));a=Math.pow(2,l-8),n[4*c]=i/a|0,n[4*c+1]=r/a|0,n[4*c+2]=s/a|0,n[4*c+3]=l+128}return n}function jy(e,t,n=Uy,i){var r;if(!t)return;const s=e.Exporters.findIndex((e=>e.ext.includes("gltf")||e.ext.includes("glb"))),o=[];s>=0?(o.push(...null!==(r=e.Exporters[s].extensions)&&void 0!==r?r:[]),e.Exporters.splice(s,1)):(o.push(Vy),o.push(Gy),o.push(zy),o.push((e=>new _e(e))),o.push((e=>new Hy(e))),o.push((e=>new Qy(e))),o.push((e=>new Wy(e))),o.push((e=>new qy(e)))),e.Exporters.push({ctor:()=>{const e=new n;return o.forEach((t=>e.register(t))),e.register((e=>({afterParse:n=>{var i,r;if(!(null===(i=null==(n=Array.isArray(n)?n[0]:n)?void 0:n.userData)||void 0===i?void 0:i.rootSceneModelRoot)||!1===(null===(r=null==n?void 0:n.userData)||void 0===r?void 0:r.__exportViewerConfig))return;const s=e.json.scenes[e.json.scene||0];s.extensions||(s.extensions={}),s.extensions[jn]=Ny(t,e),e.extensionsUsed[jn]=!0}}))),null==i||i(e),e},ext:["gltf","glb"],extensions:o})}const zy=e=>({writeNode:(t,n)=>{if(!(null==t?void 0:t.isLight))return;n.extensions||(n.extensions={});const i={};t.shadow&&(i.shadow=t.shadow.toJSON()),Object.keys(i).length>0&&(n.extensions[Gn]=i,e.extensionsUsed[Gn]=!0)}}),Gy=e=>({writeNode:(t,n)=>{if(!(null==t?void 0:t.isObject3D))return;n.extensions||(n.extensions={});const i={};void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),!1===t.visible&&(i.visible=!1),!1===t.frustumCulled&&(i.frustumCulled=!1),0!==t.renderOrder&&(i.renderOrder=t.renderOrder),1!==t.layers.mask&&(i.layers=t.layers.mask),!1===t.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),Object.keys(i).length>0&&(n.extensions[Vn]=i,e.extensionsUsed[Vn]=!0)}}),Vy=e=>({writeMaterial(t,i){if(!(null==t?void 0:t.isMaterial))return;i.extensions||(i.extensions={});const r={};void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.side&&t.side!==n.ehD&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.depthFunc&&(r.depthFunc=t.depthFunc),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.vertexColors&&(r.vertexColors=t.vertexColors),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.normalScale&&(r.normalScale=[t.normalScale.x,t.normalScale.y]);const s=this.materialExternalResources[t.uuid];s&&Object.entries(s).forEach((([t,n])=>{var i;t.startsWith("_")||((null==n?void 0:n.userData)&&(n.userData.__embedUrlImagePreviews=null===(i=e.options.exporterOptions)||void 0===i?void 0:i.embedUrlImagePreviews),r[t]=le(n,!1,this.serializedMeta),(null==n?void 0:n.userData)&&delete n.userData.__embedUrlImagePreviews)})),Object.keys(r).length>0&&(i.extensions[Hn]=r,e.extensionsUsed[Hn]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(t){if(this.materialExternalResources={},!e.options.externalImagesInExtras)return;const n=[];(Array.isArray(t)?t:[t]).forEach((e=>{null==e||e.traverse((e=>{var t;e&&(null===(t=e.material)||void 0===t?void 0:t.isMaterial)&&n.push(e.material)}))})),n.forEach((e=>{e&&(this.materialExternalResources[e.uuid]||(this.materialExternalResources[e.uuid]={}),this.materialExternalResources[e.uuid].__materialRef=e,Object.entries(e).forEach((([t,n])=>{t.startsWith("_")||n&&n.isTexture&&n.userData.rootPath&&(n.userData.rootPath.startsWith("http")||n.userData.rootPath.startsWith("data:"))&&(e[t]=null,this.materialExternalResources[e.uuid][t]=n)})))}))},afterParse(t){const n=Object.values(this.materialExternalResources);if(n.length<1)return;n.forEach((e=>{const t=e.__materialRef;t&&(Object.entries(e).forEach((([e,n])=>{e.startsWith("_")||n&&(t[e]=n)})),delete this.materialExternalResources[t.uuid])}));const i=e.json.scenes[e.json.scene||0];i.extensions||(i.extensions={}),i.extensions[Hn]={resources:this.serializedMeta},e.extensionsUsed[Hn]=!0}});class Hy{constructor(e){this.writer=e,this.name=Yn}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.bumpScale)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.bumpScale=e.bumpScale,e.bumpMap){const t={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(t,e.bumpMap),r.bumpTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class Qy{constructor(e){this.writer=e,this.name=Kn}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.displacementScale)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.displacementScale=e.displacementScale,r.displacementBias=e.displacementBias,e.displacementMap){const t={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(t,e.displacementMap),r.displacementTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class Wy{constructor(e){this.writer=e,this.name=Zn}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.lightMapIntensity)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.lightMapIntensity=e.lightMapIntensity,e.lightMap){const t={index:n.processTexture(e.lightMap)};n.applyTextureTransform(t,e.lightMap),r.lightMapTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class qy{constructor(e){this.writer=e,this.name=Jn}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,i=n.extensionsUsed,r={};if(e.alphaMap){const t={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(t,e.alphaMap),r.alphaTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}const Xy=new TextEncoder;class Yy{parse(e,t,i){if(!function(e,t){if(t.isWebGLRenderTarget&&(!e||!e.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!t||!t.isWebGLRenderTarget&&!t.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const i=t.isWebGLRenderTarget?t.texture:t;return i.type!==n.VzW&&i.type!==n.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):i.format===n.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,t))return;const r=function(e,t={}){const i=e.isTexture?e:e.texture,r=e.isWebGLRenderTarget?e.width:e.image.width,s=e.isWebGLRenderTarget?e.height:e.image.height,o=i.type,a=i.format,l=i.colorSpace,c=void 0!==t.compression?t.compression:3,u=(void 0!==t.type?t.type:n.cLu)===n.VzW?2:1,d={0:1,2:1,3:16}[c];return{width:r,height:s,type:o,format:a,colorSpace:l,compression:c,blockLines:d,dataType:u,dataSize:2*u,numBlocks:Math.ceil(s/d),numInputChannels:4,numOutputChannels:4,flipY:e.isDataTexture&&e.flipY,textureIndex:t.textureIndex||0}}(t,i),s=function(e,t,i){if(t.isDataTexture)return t.image.data;let r;return r=i.type===n.VzW?new Float32Array(i.width*i.height*i.numInputChannels):new Uint16Array(i.width*i.height*i.numInputChannels),e.readRenderTargetPixels(t,0,0,i.width,i.height,r,void 0,i.textureIndex),r}(e,t,r),o=function(e,t){const i=t.width,r=t.height,s={r:0,g:0,b:0,a:0},o={value:0},a=4==t.numOutputChannels?1:0,l=t.type==n.VzW?ob:sb,c=1==t.dataType?tb:nb,u=new Uint8Array(t.width*t.height*t.numOutputChannels*t.dataSize),d=new DataView(u.buffer);for(let n=0;n<r;++n)for(let u=0;u<i;++u){const h=n*i*4+4*u,p=l(e,h),f=l(e,h+1),m=l(e,h+2),g=l(e,h+3),_=(t.flipY?n:r-n-1)*i*(3+a)*t.dataSize;Zy(s,p,f,m,g),o.value=_+u*t.dataSize,c(d,s.a,o),o.value=_+a*i*t.dataSize+u*t.dataSize,c(d,s.b,o),o.value=_+(1+a)*i*t.dataSize+u*t.dataSize,c(d,s.g,o),o.value=_+(2+a)*i*t.dataSize+u*t.dataSize,c(d,s.r,o)}return u}(s,r),a=function(e,t){let n,i,r=0;const s={data:new Array,totalSize:0},o=t.width*t.numOutputChannels*t.blockLines*t.dataSize;switch(t.compression){case 0:n=Ky;break;case 2:case 3:n=Jy}0!==t.compression&&(i=new Uint8Array(o));for(let a=0;a<t.numBlocks;++a){const t=n(e.subarray(o*a,o*(a+1)),i);r+=t.length,s.data.push({dataChunk:t,size:t.length})}return s.totalSize=r,s}(o,r);return function(e,t){const n=8*t.numBlocks,i=259+18*t.numOutputChannels,r={value:i+n},s=new Uint8Array(i+n+e.totalSize+8*t.numBlocks),o=new DataView(s.buffer);!function(e,t,n){const i={value:0},r=new DataView(e.buffer);eb(r,20000630,i),eb(r,2,i),rb(r,"compression",i),rb(r,"compression",i),eb(r,1,i),$y(r,n.compression,i),rb(r,"screenWindowCenter",i),rb(r,"v2f",i),eb(r,8,i),eb(r,0,i),eb(r,0,i),rb(r,"screenWindowWidth",i),rb(r,"float",i),eb(r,4,i),nb(r,1,i),rb(r,"pixelAspectRatio",i),rb(r,"float",i),eb(r,4,i),nb(r,1,i),rb(r,"lineOrder",i),rb(r,"lineOrder",i),eb(r,1,i),$y(r,0,i),rb(r,"dataWindow",i),rb(r,"box2i",i),eb(r,16,i),eb(r,0,i),eb(r,0,i),eb(r,n.width-1,i),eb(r,n.height-1,i),rb(r,"displayWindow",i),rb(r,"box2i",i),eb(r,16,i),eb(r,0,i),eb(r,0,i),eb(r,n.width-1,i),eb(r,n.height-1,i),rb(r,"channels",i),rb(r,"chlist",i),eb(r,18*n.numOutputChannels+1,i),rb(r,"A",i),eb(r,n.dataType,i),i.value+=4,eb(r,1,i),eb(r,1,i),rb(r,"B",i),eb(r,n.dataType,i),i.value+=4,eb(r,1,i),eb(r,1,i),rb(r,"G",i),eb(r,n.dataType,i),i.value+=4,eb(r,1,i),eb(r,1,i),rb(r,"R",i),eb(r,n.dataType,i),i.value+=4,eb(r,1,i),eb(r,1,i),$y(r,0,i),$y(r,0,i);let s=i.value+8*n.numBlocks;for(let o=0;o<t.data.length;++o)ib(r,s,i),s+=t.data[o].size+8}(s,e,t);for(let a=0;a<e.data.length;++a){const n=e.data[a].dataChunk,i=e.data[a].size;eb(o,a*t.blockLines,r),eb(o,i,r),s.set(n,r.value),r.value+=i}return s}(a,r)}}function Ky(e){return e}function Jy(e,t){let n=0,i=Math.floor((e.length+1)/2),r=0;const s=e.length-1;for(;!(r>s||(t[n++]=e[r++],r>s));)t[i++]=e[r++];let o=t[0];for(let a=1;a<t.length;a++){const e=t[a]-o+384;o=t[a],t[a]=e}return function(e,t){t||(t={});var n=Ef();n.p(e);var i=Cf(e,t,2,4);return Mf(i,t),Sf(i,i.length-4,n.d()),i}(t)}function Zy(e,t,n,i,r){e.r=t,e.g=n,e.b=i,e.a=r}function $y(e,t,n){e.setUint8(n.value,t),n.value+=1}function eb(e,t,n){e.setUint32(n.value,t,!0),n.value+=4}function tb(e,t,i){e.setUint16(i.value,n.A5E.toHalfFloat(t),!0),i.value+=2}function nb(e,t,n){e.setFloat32(n.value,t,!0),n.value+=4}function ib(e,t,n){e.setBigUint64(n.value,BigInt(t),!0),n.value+=8}function rb(e,t,n){const i=Xy.encode(t+"\0");for(let r=0;r<i.length;++r)$y(e,i[r],n)}function sb(e,t){return function(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}(e[t])}function ob(e,t){return e[t]}class ab extends Yy{async parseAsync(e,t){const n=this.parse(e.renderer.rendererObject,e,t);return new Blob([n],{type:"image/x-exr"})}}class lb extends t.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find((t=>t.ext.some((t=>e.includes(t)))))}constructor(e,t={}){super(),this._processors=new zt,this.Exporters=[{ctor:()=>new ry,ext:["json"]},{ctor:()=>new sy,ext:["txt","text"]},{ctor:()=>new ab,ext:["exr"]}],this._cachedParsers=[],jy(this,e)}async exportObject(e,t={}){var n,i;if(!(null==e?void 0:e.assetType))return void console.error("Object has no asset type");(null===(n=null==e?void 0:e.userData)||void 0===n?void 0:n.rootSceneModelRoot)&&!1===t.viewerConfig&&(e.userData.__exportViewerConfig=!1);const r=[];"model"===e.assetType&&e.modelObject.traverse((e=>{e.userData.excludeFromExport&&e.visible&&(e.visible=!1,r.push(e))}));const s=await this._exportFile(e,t);return"model"===e.assetType&&r.forEach((e=>e.visible=!0)),(null===(i=null==e?void 0:e.userData)||void 0===i?void 0:i.rootSceneModelRoot)&&!1===t.viewerConfig&&delete e.userData.__exportViewerConfig,s}async _exportFile(e,t={}){var n,i,r;let s;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const o=await this.processBeforeExport(e,t),a=null!==(i=null!==(n=t.exportExt)&&void 0!==n?n:null==o?void 0:o.typeExt)&&void 0!==i?i:null==o?void 0:o.ext;if(!o||!a)throw new Error(`Unable to preprocess before export ${a}`);const l=this._getParser(a);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const c=await l.parseAsync(o.obj,{exportExt:null!==(r=o.ext)&&void 0!==r?r:a,...t});c.ext=o.ext,s=c}catch(t){return console.error("AssetExporter: Unable to Export file",e),console.error(t),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:t})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),s}_createParser(e){const t=this.Exporters.find((t=>t.ext.includes(e)));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=null==t?void 0:t.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){var t,n;return null!==(n=null===(t=this._cachedParsers.find((t=>t.ext.includes(e))))||void 0===t?void 0:t.parser)&&void 0!==n?n:this._createParser(e)}async processBeforeExport(e,t={}){if(null!=e.assetType&&"renderTarget"!==e.assetType&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;null===(e=this._processors)||void 0===e||e.dispose()}}var cb;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(cb||(cb={}));class ub extends _t{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:cb.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new lb(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(e,t)=>{var n;return t.convertMeshToIndexed&&(null===(n=e.modelObject)||void 0===n||n.traverse((e=>{var t;e.geometry&&(e.geometry.attributes.index||null===(t=e.setGeometry)||void 0===t||t.call(e,q(e.geometry)))}))),e}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,n;return null===(t=this.exporter)||void 0===t?void 0:t.exportObject(null===(n=this._viewer)||void 0===n?void 0:n.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){var n,i;const r=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("FileTransferPlugin");r?await r.exportFile(e,t):null===(i=this._viewer)||void 0===i||i.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",(e=>{var t;"function"==typeof(null===(t=e.plugin)||void 0===t?void 0:t.toJSON)&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")}));const n=Object.entries(e.plugins).filter((([e,t])=>"function"==typeof(null==t?void 0:t.toJSON)&&!1!==(null==t?void 0:t.serializeWithViewer))).map((([e,t])=>({label:e,type:"checkbox",value:!0})));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var e,t;return null===(t=null===(e=this._uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(cb).map((([e,t])=>({label:e,value:t})))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map((e=>({label:e})))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map((e=>({type:"slider",label:e,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,e]})))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var e,t;return null===(t=null===(e=this._uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var e,t;return null===(t=null===(e=this._uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Convert to indexed",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:n},{type:"button",label:"Select none",value:()=>{n.forEach((e=>{var t;e.value=!1,null===(t=e.uiRefresh)||void 0===t||t.call(e)}))}},{type:"button",label:"Select all",value:()=>{n.forEach((e=>{var t;e.value=!0,null===(t=e.uiRefresh)||void 0===t||t.call(e)}))}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const i=new Blob([JSON.stringify(e.getPlugin(Ls).exportPluginPresets(n.filter((e=>!!e.value)).map((e=>(0,t.getOrCall)(e.label)||""))),null,2)],{type:"application/json"});i&&await this._downloadBlob(i,this.exportOptions.name+"."+Ls.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const t=new Blob([JSON.stringify(e.getPlugin(Ls).exportViewerConfig(!1),null,2)],{type:"application/json"});t&&await this._downloadBlob(t,this.exportOptions.name+"."+Ls.ViewerTypeSlug)}}]}]}}}ub.PluginType="AssetExporterPlugin",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([re()],ub.prototype,"exportOptions",void 0);class db{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class hb extends db{constructor(e,t,n,i={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=i,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class pb extends db{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map((e=>e.getParent()))}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map((e=>e.getChild()))}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter((e=>t(e.getParent())))),n.forEach((e=>e.dispose())),this}createEdge(e,t,n,i){return this._registerEdge(new hb(e,t,n,i))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",(()=>this._removeEdge(e))),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function fb(){return fb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},fb.apply(this,arguments)}function mb(e){return e instanceof hb}function gb(e){return Array.isArray(e)&&e[0]instanceof hb}function _b(e){return!!(function(e){return Boolean(e)&&Object.getPrototypeOf(e)===Object.prototype}(e)&&function(e){for(const t in e)return e[t]}(e)instanceof hb)}const vb=Symbol("attributes"),yb=Symbol("immutableKeys");class bb extends db{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[vb]=void 0,this[yb]=void 0,this.graph=e,this[yb]=new Set,this[vb]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const i=e[n];if(i instanceof bb){const e=this.graph.createEdge(n,this,i);e.addEventListener("dispose",(()=>i.dispose())),this[yb].add(n),t[n]=e}else t[n]=i}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[vb]){const i=this[vb][n];if(mb(i)){const r=i;r.getChild()===e&&this.setRef(n,t,r.getAttributes())}else if(gb(i)){const r=i.find((t=>t.getChild()===e));if(r){const i=r.getAttributes();this.removeRef(n,e).addRef(n,t,i)}}else if(_b(i)){const r=i;for(const i in r){const s=r[i];s.getChild()===e&&this.setRefMap(n,i,t,s.getAttributes())}}}return this}get(e){return this[vb][e]}set(e,t){return this[vb][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[vb][e];return t?t.getChild():null}setRef(e,t,n){if(this[yb].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const i=this[vb][e];if(i&&i.dispose(),!t)return this;const r=this.graph.createEdge(e,this,t,n);return r.addEventListener("dispose",(()=>{delete this[vb][e],this.dispatchEvent({type:"change",attribute:e})})),this[vb][e]=r,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[vb][e].map((e=>e.getChild()))}addRef(e,t,n){const i=this.graph.createEdge(e,this,t,n),r=this[vb][e];return r.push(i),i.addEventListener("dispose",(()=>{const t=r.filter((e=>e!==i));r.length=0;for(const e of t)r.push(e);this.dispatchEvent({type:"change",attribute:e})})),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[vb][e].filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}listRefMapKeys(e){return Object.keys(this[vb][e])}listRefMapValues(e){return Object.values(this[vb][e]).map((e=>e.getChild()))}getRefMap(e,t){const n=this[vb][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,i){const r=this[vb][e],s=r[t];if(s&&s.dispose(),!n)return this;i=Object.assign(i||{},{key:t});const o=this.graph.createEdge(e,this,n,fb({},i,{key:t}));return o.addEventListener("dispose",(()=>{delete r[t],this.dispatchEvent({type:"change",attribute:e,key:t})})),r[t]=o,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(fb({},e,{target:this})),this.graph.dispatchEvent(fb({},e,{target:this,type:`node:${e.type}`})),this}}const Ab="@glb.bin";var wb,xb,Eb,Cb,Sb;!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(wb||(wb={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(xb||(xb={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER",e.SPARSE="SPARSE"}(Eb||(Eb={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(Cb||(Cb={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(Sb||(Sb={}));const Mb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var Tb,Ib,Pb="undefined"!=typeof Float32Array?Float32Array:Array;function Rb(e){return Math.hypot(e[0],e[1],e[2])}function Db(e,t,n){var i=t[0],r=t[1],s=t[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/(o=o||1),e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,e}function kb(e,t){const n={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const i of e.listPrimitives()){const e=i.getAttribute("POSITION");if(!e)continue;let r=[0,0,0],s=[0,0,0];for(let i=0;i<e.getCount();i++)r=e.getElement(i,r),s=Db(s,r,t),Bb(s,n)}return n}function Bb(e,t){for(let n=0;n<3;n++)t.min[n]=Math.min(e[n],t.min[n]),t.max[n]=Math.max(e[n],t.max[n])}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),Tb=new Pb(3),Pb!=Float32Array&&(Tb[0]=0,Tb[1]=0,Tb[2]=0);class Ob{static createBufferFromDataURI(e){if("undefined"==typeof Buffer){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const n=new Uint8Array(t);let i=0;for(const r of e)n.set(r,i),i+=r.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const i=new Uint8Array(n);if(i.set(e),0!==t)for(let r=e.byteLength;r<n;r++)i[r]=t;return i}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Lb{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,i,r]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*i<<8^255*r}static convertSRGBToLinear(e,t){const n=e,i=t;for(let r=0;r<3;r++)i[r]=n[r]<.04045?.0773993808*n[r]:Math.pow(.9478672986*n[r]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,i=t;for(let r=0;r<3;r++)i[r]=n[r]<.0031308?12.92*n[r]:1.055*Math.pow(n[r],.41666)-.055;return t}}class Ub{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Ob.decodeText(e.slice(12,16))===Ub.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}Ub.PNG_FRIED_CHUNK_NAME="CgBI";class Nb{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)n+=i[0]*i[1]*4,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":e?`image/${e}`:""}}function Fb(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}Nb.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,n,i=new DataView(e.buffer,e.byteOffset+4);for(;i.byteLength;){if(t=i.getUint16(0,!1),Fb(i,t),n=i.getUint8(t+1),192===n||193===n||194===n)return[i.getUint16(t+7,!1),i.getUint16(t+5,!1)];i=new DataView(e.buffer,i.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new Ub};class jb{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return Nb.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function zb(e){return"[object Object]"===Object.prototype.toString.call(e)}function Gb(e){if(!1===zb(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!1!==zb(n)&&!1!==Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")}!function(e){e[e.SILENT=4]="SILENT",e[e.ERROR=3]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=1]="INFO",e[e.DEBUG=0]="DEBUG"}(Ib||(Ib={}));class Vb{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Vb.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Vb.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Vb.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Vb.Verbosity.ERROR&&console.error(e)}}function Hb(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],A=n[2],w=n[3];return e[0]=y*i+b*a+A*d+w*m,e[1]=y*r+b*l+A*h+w*g,e[2]=y*s+b*c+A*p+w*_,e[3]=y*o+b*u+A*f+w*v,e[4]=(y=n[4])*i+(b=n[5])*a+(A=n[6])*d+(w=n[7])*m,e[5]=y*r+b*l+A*h+w*g,e[6]=y*s+b*c+A*p+w*_,e[7]=y*o+b*u+A*f+w*v,e[8]=(y=n[8])*i+(b=n[9])*a+(A=n[10])*d+(w=n[11])*m,e[9]=y*r+b*l+A*h+w*g,e[10]=y*s+b*c+A*p+w*_,e[11]=y*o+b*u+A*f+w*v,e[12]=(y=n[12])*i+(b=n[13])*a+(A=n[14])*d+(w=n[15])*m,e[13]=y*r+b*l+A*h+w*g,e[14]=y*s+b*c+A*p+w*_,e[15]=y*o+b*u+A*f+w*v,e}Vb.Verbosity=Ib,Vb.DEFAULT_INSTANCE=new Vb(Vb.Verbosity.INFO);class Qb{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(Math.abs(e[i]-t[i])>n)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return Qb.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return Qb.encodeNormalizedInt(e,t)}static decompose(e,t,n,i){let r=Rb([e[0],e[1],e[2]]);const s=Rb([e[4],e[5],e[6]]),o=Rb([e[8],e[9],e[10]]);var a,l,c,u,d,h,p,f,m,g,_,v,y,b,A,w,x;((l=(a=e)[0])*(p=a[5])-(c=a[1])*(h=a[4]))*((v=a[10])*(x=a[15])-(y=a[11])*(w=a[14]))-(l*(f=a[6])-(u=a[2])*h)*((_=a[9])*x-y*(A=a[13]))+(l*(m=a[7])-(d=a[3])*h)*(_*w-v*A)+(c*f-u*p)*((g=a[8])*x-y*(b=a[12]))-(c*m-d*p)*(g*w-v*b)+(u*m-d*f)*(g*A-_*b)<0&&(r=-r),t[0]=e[12],t[1]=e[13],t[2]=e[14];const E=e.slice(),C=1/r,S=1/s,M=1/o;E[0]*=C,E[1]*=C,E[2]*=C,E[4]*=S,E[5]*=S,E[6]*=S,E[8]*=M,E[9]*=M,E[10]*=M,function(e,t){var n=new Pb(3);!function(e,t){var n=t[4],i=t[5],r=t[6],s=t[8],o=t[9],a=t[10];e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,i,r),e[2]=Math.hypot(s,o,a)}(n,t);var i=1/n[0],r=1/n[1],s=1/n[2],o=t[0]*i,a=t[1]*r,l=t[2]*s,c=t[4]*i,u=t[5]*r,d=t[6]*s,h=t[8]*i,p=t[9]*r,f=t[10]*s,m=o+u+f,g=0;m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(d-p)/g,e[1]=(h-l)/g,e[2]=(a-c)/g):o>u&&o>f?(g=2*Math.sqrt(1+o-u-f),e[3]=(d-p)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(h+l)/g):u>f?(g=2*Math.sqrt(1+u-o-f),e[3]=(h-l)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(d+p)/g):(g=2*Math.sqrt(1+f-o-u),e[3]=(a-c)/g,e[0]=(h+l)/g,e[1]=(d+p)/g,e[2]=.25*g)}(n,E),i[0]=r,i[1]=s,i[2]=o}static compose(e,t,n,i){const r=i,s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,u=o+o,d=a+a,h=s*c,p=s*u,f=s*d,m=o*u,g=o*d,_=a*d,v=l*c,y=l*u,b=l*d,A=n[0],w=n[1],x=n[2];return r[0]=(1-(m+_))*A,r[1]=(p+b)*A,r[2]=(f-y)*A,r[3]=0,r[4]=(p-b)*w,r[5]=(1-(h+_))*w,r[6]=(g+v)*w,r[7]=0,r[8]=(f+y)*x,r[9]=(g-v)*x,r[10]=(1-(h+m))*x,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}}function Wb(e,t){if(!!e!=!!t)return!1;const n=e.getChild(),i=t.getChild();return n===i||n.equals(i)}function qb(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(i.getChild()!==r.getChild()&&!i.getChild().equals(r.getChild()))return!1}return!0}function Xb(e,t){if(!!e!=!!t)return!1;const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const r in e){const n=e[r],i=t[r];if(!!n!=!!i)return!1;const s=n.getChild(),o=i.getChild();if(s!==o&&!s.equals(o))return!1}return!0}function Yb(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Kb(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!Gb(e)||!Gb(t))return e===t;const n=e,i=t;let r,s=0,o=0;for(r in n)s++;for(r in i)o++;if(s!==o)return!1;for(r in n){const e=n[r],t=i[r];if(Jb(e)&&Jb(t)){if(!Yb(e,t))return!1}else if(Gb(e)&&Gb(t)){if(!Kb(e,t))return!1}else if(e!==t)return!1}return!0}function Jb(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const Zb="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",$b=new Set,eA=function(){let e="";for(let t=0;t<6;t++)e+=Zb.charAt(Math.floor(Math.random()*Zb.length));return e};class tA{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return jb.basename(new URL(e,"https://null.example").pathname)}static extension(e){return jb.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),i=t.split("/");n.pop();for(let r=0;r<i.length;r++)"."!==i[r]&&(".."===i[r]?n.pop():n.push(i[r]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}tA.DEFAULT_INIT={},tA.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const nA=e=>e,iA=new Set;class rA extends bb{constructor(e,t=""){super(e),this[vb].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,nA)}copy(e,t=nA){for(const n in this[vb]){const e=this[vb][n];if(e instanceof hb)this[yb].has(n)||e.dispose();else if(gb(e))for(const t of e)t.dispose();else if(_b(e))for(const t in e)e[t].dispose()}for(const n in e[vb]){const i=this[vb][n],r=e[vb][n];if(r instanceof hb)this[yb].has(n)?i.getChild().copy(t(r.getChild()),t):this.setRef(n,t(r.getChild()),r.getAttributes());else if(gb(r))for(const e of r)this.addRef(n,t(e.getChild()),e.getAttributes());else if(_b(r))for(const e in r){const i=r[e];this.setRefMap(n,e,t(i.getChild()),i.getAttributes())}else this[vb][n]=Gb(r)?JSON.parse(JSON.stringify(r)):Array.isArray(r)||r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.slice():r}return this}equals(e,t=iA){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[vb]){if(t.has(n))continue;const i=this[vb][n],r=e[vb][n];if(mb(i)||mb(r)){if(!Wb(i,r))return!1}else if(gb(i)||gb(r)){if(!qb(i,r))return!1}else if(_b(i)||_b(r)){if(!Xb(i,r))return!1}else if(Gb(i)||Gb(r)){if(!Kb(i,r))return!1}else if(Jb(i)||Jb(r)){if(!Yb(i,r))return!1}else if(i!==r)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class sA extends rA{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class oA extends sA{constructor(...e){super(...e),this.i=Qb.identity,this.o=Qb.identity}init(){this.propertyType=wb.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:oA.Type.SCALAR,componentType:oA.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=nA){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case oA.Type.SCALAR:return 1;case oA.Type.VEC2:return 2;case oA.Type.VEC3:return 3;case oA.Type.VEC4:case oA.Type.MAT2:return 4;case oA.Type.MAT3:return 9;case oA.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case oA.ComponentType.BYTE:case oA.ComponentType.UNSIGNED_BYTE:return 1;case oA.ComponentType.SHORT:case oA.ComponentType.UNSIGNED_SHORT:return 2;case oA.ComponentType.UNSIGNED_INT:case oA.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let r=0;r<i;r++)e[r]=1/0;for(let r=0;r<n*i;r+=i)for(let n=0;n<i;n++){const i=t[r+n];Number.isFinite(i)&&(e[n]=Math.min(e[n],i))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let r=0;r<i;r++)e[r]=-1/0;for(let r=0;r<n*i;r+=i)for(let n=0;n<i;n++){const i=t[r+n];Number.isFinite(i)&&(e[n]=Math.max(e[n],i))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return oA.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=e=>Qb.decodeNormalizedInt(e,this.get("componentType")),this.i=e=>Qb.encodeNormalizedInt(e,this.get("componentType"))):(this.o=Qb.identity,this.i=Qb.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let r=0;r<n;r++)t[r]=this.o(i[e*n+r]);return t}setElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let r=0;r<n;r++)i[e*n+r]=this.i(t[r]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return oA.ComponentType.FLOAT;case Uint32Array:return oA.ComponentType.UNSIGNED_INT;case Uint16Array:return oA.ComponentType.UNSIGNED_SHORT;case Uint8Array:return oA.ComponentType.UNSIGNED_BYTE;case Int16Array:return oA.ComponentType.SHORT;case Int8Array:return oA.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):oA.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}oA.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},oA.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class aA extends sA{init(){this.propertyType=wb.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class lA extends sA{init(){this.propertyType=wb.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}lA.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class cA extends sA{init(){this.propertyType=wb.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:cA.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Eb.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Eb.OTHER})}}cA.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class uA extends sA{init(){this.propertyType=wb.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class dA extends sA{init(){this.propertyType=wb.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:dA.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}dA.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class hA extends rA{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}hA.EXTENSION_NAME=void 0;class pA extends sA{init(){this.propertyType=wb.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:pA.WrapMode.REPEAT,wrapT:pA.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}pA.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},pA.MagFilter={NEAREST:9728,LINEAR:9729},pA.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:fA,G:mA,B:gA,A:_A}=Cb;class vA extends sA{init(){this.propertyType=wb.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:vA.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new pA(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new pA(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new pA(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new pA(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new pA(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Lb.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Lb.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:fA|mA|gA|_A})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Lb.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Lb.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:fA|mA|gA})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:fA|mA|gA})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:fA})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:mA|gA})}}vA.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class yA extends sA{init(){this.propertyType=wb.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class bA extends sA{constructor(...e){super(...e),this.u=null}init(){this.propertyType=wb.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=nA){if(t===nA)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Qb.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),i=this.get("scale").slice();return Qb.decompose(e,t,n,i),this.set("translation",t).set("rotation",n).set("scale",i)}getWorldTranslation(){const e=[0,0,0];return Qb.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Qb.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Qb.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let i=this;null!=i;i=i.u)e.push(i);let t;const n=e.pop().getMatrix();for(;t=e.pop();)Hb(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[vb].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find((e=>e.propertyType===wb.SCENE))||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class AA extends sA{init(){this.propertyType=wb.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:AA.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Eb.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Eb.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}AA.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class wA extends rA{init(){this.propertyType=wb.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Eb.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function xA(){return(xA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}class EA extends sA{init(){this.propertyType=wb.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=nA){if(t===nA)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class CA extends sA{init(){this.propertyType=wb.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Eb.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class SA extends sA{init(){this.propertyType=wb.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Nb.extensionToMimeType(jb.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=Nb.extensionToMimeType(jb.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Ob.assertView(e))}getSize(){const e=this.get("image");return e?Nb.getSize(e,this.getMimeType()):null}}class MA extends sA{init(){this.propertyType=wb.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",(e=>{this.l(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=nA){if(t===nA)throw new Error("Root cannot be copied.");this.set("asset",xA({},e.get("asset"))),this.setName(e.getName()),this.setExtras(xA({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const i=e.getExtension(n);this.setExtension(n,t(i))}return this}l(e){return e instanceof EA?this.addRef("scenes",e):e instanceof bA?this.addRef("nodes",e):e instanceof dA?this.addRef("cameras",e):e instanceof CA?this.addRef("skins",e):e instanceof yA?this.addRef("meshes",e):e instanceof vA?this.addRef("materials",e):e instanceof SA?this.addRef("textures",e):e instanceof aA?this.addRef("animations",e):e instanceof oA?this.addRef("accessors",e):e instanceof uA&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class TA{static fromGraph(e){return TA.m.get(e)||null}constructor(){this.v=new pb,this.T=new MA(this.v),this.M=Vb.DEFAULT_INSTANCE,TA.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return(new TA).setLogger(this.M).merge(this)}merge(e){for(const r of e.getRoot().listExtensionsUsed()){const e=this.createExtension(r.constructor);r.isRequired()&&e.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const r of e.v.listEdges())for(const e of[r.getParent(),r.getChild()]){if(t.has(e))continue;let i;i=e.propertyType===wb.TEXTURE_INFO?e:new(0,e.constructor)(this.v),n.set(e,i),t.add(e)}const i=e=>{const t=n.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const r of t){const e=n.get(r);if(!e)throw new Error("Could resolve property.");e.propertyType!==wb.TEXTURE_INFO&&e.copy(r,i)}return this}async transform(...e){const t=e.map((e=>e.name));for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new EA(this.v,e)}createNode(e=""){return new bA(this.v,e)}createCamera(e=""){return new dA(this.v,e)}createSkin(e=""){return new CA(this.v,e)}createMesh(e=""){return new yA(this.v,e)}createPrimitive(){return new AA(this.v)}createPrimitiveTarget(e=""){return new wA(this.v,e)}createMaterial(e=""){return new vA(this.v,e)}createTexture(e=""){return new SA(this.v,e)}createAnimation(e=""){return new aA(this.v,e)}createAnimationChannel(e=""){return new lA(this.v,e)}createAnimationSampler(e=""){return new cA(this.v,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new oA(this.v,e).setBuffer(t)}createBuffer(e=""){return new uA(this.v,e)}}TA.m=new WeakMap;class IA{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=e=>{const t=e,n=t.target;n instanceof hA&&n.extensionName===this.extensionName&&("node:create"===t.type&&this.I(n),"node:dispose"===t.type&&this.N(n))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}IA.EXTENSION_NAME=void 0;class PA{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord),void 0!==t.extras&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(void 0===n.sampler)return;const i=this.jsonDoc.json.samplers[n.sampler];void 0!==i.magFilter&&e.setMagFilter(i.magFilter),void 0!==i.minFilter&&e.setMinFilter(i.minFilter),void 0!==i.wrapS&&e.setWrapS(i.wrapS),void 0!==i.wrapT&&e.setWrapT(i.wrapT)}}const RA={logger:Vb.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function DA(e,t){const n=t.bufferViews[e.bufferView],i=t.jsonDoc.json.bufferViews[e.bufferView],r=Mb[e.componentType],s=oA.getElementSize(e.type),o=r.BYTES_PER_ELEMENT;if(void 0!==i.byteStride&&i.byteStride!==s*o)return function(e,t){const n=t.bufferViews[e.bufferView],i=t.jsonDoc.json.bufferViews[e.bufferView],r=Mb[e.componentType],s=oA.getElementSize(e.type),o=r.BYTES_PER_ELEMENT,a=e.byteOffset||0,l=new r(e.count*s),c=new DataView(n.buffer,n.byteOffset,n.byteLength),u=i.byteStride;for(let d=0;d<e.count;d++)for(let t=0;t<s;t++){const n=a+d*u+t*o;let i;switch(e.componentType){case oA.ComponentType.FLOAT:i=c.getFloat32(n,!0);break;case oA.ComponentType.UNSIGNED_INT:i=c.getUint32(n,!0);break;case oA.ComponentType.UNSIGNED_SHORT:i=c.getUint16(n,!0);break;case oA.ComponentType.UNSIGNED_BYTE:i=c.getUint8(n);break;case oA.ComponentType.SHORT:i=c.getInt16(n,!0);break;case oA.ComponentType.BYTE:i=c.getInt8(n);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}l[d*s+t]=i}return l}(e,t);const a=n.byteOffset+(e.byteOffset||0);return new r(n.buffer.slice(a,a+e.count*s*o))}var kA;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(kA||(kA={}));class BA{constructor(e,t,n){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=t,this.options=n;const i=e.getRoot(),r=i.listBuffers().length,s=i.listTextures().length;this.bufferURIGenerator=new OA(r>1,(()=>n.basename||"buffer")),this.imageURIGenerator=new OA(s>1,(t=>function(e,t){const n=e.getGraph().listParentEdges(t).find((t=>t.getParent()!==e.getRoot()));return n?n.getName().replace(/texture$/i,""):""}(e,t)||n.basename||"texture")),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},i=JSON.stringify(n);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const r={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(i)},s=JSON.stringify(r);this.textureDefIndexMap.has(s)||(this.textureDefIndexMap.set(s,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(r));const o={index:this.textureDefIndexMap.get(s)};return 0!==t.getTexCoord()&&(o.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(o.extras=t.getExtras()),this.textureInfoDefMap.set(t,o),o}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===Sb.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const i=Nb.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,i),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.C.get(e);if(t)return t;if(e.getSparse())return Eb.SPARSE;for(const n of this.O.getGraph().listParentEdges(e)){const{usage:e}=n.getAttributes();if(e)return e;n.getParent().propertyType!==wb.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Eb.OTHER}addAccessorToUsageGroup(e,t){const n=this.C.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.C.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.C.entries()))e[n]=e[n]||[],e[n].push(t);return e}}BA.BufferViewTarget=kA,BA.BufferViewUsage=Eb,BA.USAGE_TO_TARGET={[Eb.ARRAY_BUFFER]:kA.ARRAY_BUFFER,[Eb.ELEMENT_ARRAY_BUFFER]:kA.ELEMENT_ARRAY_BUFFER};class OA{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:LA}=BA,{UNSIGNED_INT:UA,UNSIGNED_SHORT:NA,UNSIGNED_BYTE:FA}=oA.ComponentType;var jA;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(jA||(jA={}));class zA{constructor(){this.M=Vb.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=xb.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=GA(t)?this.P(t):{json:JSON.parse(Ob.decodeText(t)),resources:{}};return await this.L(n,this.dirname(e)),this.j(n),n}async readJSON(e){return e=this.D(e),this.j(e),class{static read(e,t=RA){const n=xA({},RA,t),{json:i}=e,r=(new TA).setLogger(n.logger);this.validate(e,n);const s=new PA(e),o=i.asset,a=r.getRoot().getAsset();o.copyright&&(a.copyright=o.copyright),o.extras&&(a.extras=o.extras),void 0!==i.extras&&r.getRoot().setExtras(xA({},i.extras));const l=i.extensionsUsed||[],c=i.extensionsRequired||[];for(const _ of n.extensions)if(l.includes(_.EXTENSION_NAME)){const e=r.createExtension(_).setRequired(c.includes(_.EXTENSION_NAME));for(const t of e.readDependencies)e.install(t,n.dependencies[t])}const u=i.buffers||[];r.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(wb.BUFFER))).forEach((e=>e.preread(s,wb.BUFFER))),s.buffers=u.map((e=>{const t=r.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t})),s.bufferViewBuffers=(i.bufferViews||[]).map(((t,n)=>{if(!s.bufferViews[n]){const i=e.json.buffers[t.buffer];s.bufferViews[n]=Ob.toView(i.uri?e.resources[i.uri]:e.resources["@glb.bin"],t.byteOffset||0,t.byteLength)}return s.buffers[t.buffer]}));const d=i.accessors||[];s.accessors=d.map((e=>{const t=r.createAccessor(e.name,s.bufferViewBuffers[e.bufferView]).setType(e.type);return e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView||t.setArray(DA(e,s)),t}));const h=i.images||[],p=i.textures||[];r.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(wb.TEXTURE))).forEach((e=>e.preread(s,wb.TEXTURE))),s.textures=h.map((t=>{const n=r.createTexture(t.name);if(t.extras&&n.setExtras(t.extras),void 0!==t.bufferView){const r=i.bufferViews[t.bufferView],s=e.json.buffers[r.buffer],o=r.byteOffset||0,a=(s.uri?e.resources[s.uri]:e.resources["@glb.bin"]).slice(o,o+r.byteLength);n.setImage(a)}else void 0!==t.uri&&(n.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&n.setURI(t.uri));if(void 0!==t.mimeType)n.setMimeType(t.mimeType);else if(t.uri){const e=jb.extension(t.uri);n.setMimeType(Nb.extensionToMimeType(e))}return n})),s.materials=(i.materials||[]).map((e=>{const t=r.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const n=e.pbrMetallicRoughness||{};if(void 0!==n.baseColorFactor&&t.setBaseColorFactor(n.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==n.metallicFactor&&t.setMetallicFactor(n.metallicFactor),void 0!==n.roughnessFactor&&t.setRoughnessFactor(n.roughnessFactor),void 0!==n.baseColorTexture){const e=n.baseColorTexture;t.setBaseColorTexture(s.textures[p[e.index].source]),s.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const n=e.emissiveTexture;t.setEmissiveTexture(s.textures[p[n.index].source]),s.setTextureInfo(t.getEmissiveTextureInfo(),n)}if(void 0!==e.normalTexture){const n=e.normalTexture;t.setNormalTexture(s.textures[p[n.index].source]),s.setTextureInfo(t.getNormalTextureInfo(),n),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const n=e.occlusionTexture;t.setOcclusionTexture(s.textures[p[n.index].source]),s.setTextureInfo(t.getOcclusionTextureInfo(),n),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==n.metallicRoughnessTexture){const e=n.metallicRoughnessTexture;t.setMetallicRoughnessTexture(s.textures[p[e.index].source]),s.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t}));const f=i.meshes||[];r.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(wb.PRIMITIVE))).forEach((e=>e.preread(s,wb.PRIMITIVE))),s.meshes=f.map((e=>{const t=r.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach((n=>{const i=r.createPrimitive();n.extras&&i.setExtras(n.extras),void 0!==n.material&&i.setMaterial(s.materials[n.material]),void 0!==n.mode&&i.setMode(n.mode);for(const[e,t]of Object.entries(n.attributes||{}))i.setAttribute(e,s.accessors[t]);void 0!==n.indices&&i.setIndices(s.accessors[n.indices]);const o=e.extras&&e.extras.targetNames||[];(n.targets||[]).forEach(((e,t)=>{const n=o[t]||t.toString(),a=r.createPrimitiveTarget(n);for(const[i,r]of Object.entries(e))a.setAttribute(i,s.accessors[r]);i.addTarget(a)})),t.addPrimitive(i)})),t})),s.cameras=(i.cameras||[]).map((e=>{const t=r.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===dA.Type.PERSPECTIVE){const n=e.perspective;t.setYFov(n.yfov),t.setZNear(n.znear),void 0!==n.zfar&&t.setZFar(n.zfar),void 0!==n.aspectRatio&&t.setAspectRatio(n.aspectRatio)}else{const n=e.orthographic;t.setZNear(n.znear).setZFar(n.zfar).setXMag(n.xmag).setYMag(n.ymag)}return t}));const m=i.nodes||[];r.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(wb.NODE))).forEach((e=>e.preread(s,wb.NODE))),s.nodes=m.map((e=>{const t=r.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const n=[0,0,0],i=[0,0,0,1],r=[1,1,1];Qb.decompose(e.matrix,n,i,r),t.setTranslation(n),t.setRotation(i),t.setScale(r)}return void 0!==e.weights&&t.setWeights(e.weights),t})),s.skins=(i.skins||[]).map((e=>{const t=r.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(s.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(s.nodes[e.skeleton]);for(const n of e.joints)t.addJoint(s.nodes[n]);return t})),m.map(((e,t)=>{const n=s.nodes[t];(e.children||[]).forEach((e=>n.addChild(s.nodes[e]))),void 0!==e.mesh&&n.setMesh(s.meshes[e.mesh]),void 0!==e.camera&&n.setCamera(s.cameras[e.camera]),void 0!==e.skin&&n.setSkin(s.skins[e.skin])})),s.animations=(i.animations||[]).map((e=>{const t=r.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const n=(e.samplers||[]).map((e=>{const n=r.createAnimationSampler().setInput(s.accessors[e.input]).setOutput(s.accessors[e.output]).setInterpolation(e.interpolation||cA.Interpolation.LINEAR);return e.extras&&n.setExtras(e.extras),t.addSampler(n),n}));return(e.channels||[]).forEach((e=>{const i=r.createAnimationChannel().setSampler(n[e.sampler]).setTargetPath(e.target.path);void 0!==e.target.node&&i.setTargetNode(s.nodes[e.target.node]),e.extras&&i.setExtras(e.extras),t.addChannel(i)})),t}));const g=i.scenes||[];return r.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(wb.SCENE))).forEach((e=>e.preread(s,wb.SCENE))),s.scenes=g.map((e=>{const t=r.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map((e=>s.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==i.scene&&r.getRoot().setDefaultScene(s.scenes[i.scene]),r.getRoot().listExtensionsUsed().forEach((e=>e.read(s))),d.forEach(((e,t)=>{const n=s.accessors[t],i=!!e.sparse,r=!e.bufferView&&!n.getArray();(i||r)&&n.setSparse(!0).setArray(function(e,t){const n=Mb[e.componentType],i=oA.getElementSize(e.type);let r;r=void 0!==e.bufferView?DA(e,t):new n(e.count*i);const s=e.sparse;if(!s)return r;const o=s.count,a=xA({},e,s.indices,{count:o,type:"SCALAR"}),l=xA({},e,s.values,{count:o}),c=DA(a,t),u=DA(l,t);for(let d=0;d<a.count;d++)for(let e=0;e<i;e++)r[c[d]*i+e]=u[d*i+e];return r}(e,s))})),r}static validate(e,t){const n=e.json;if("2.0"!==n.asset.version)throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired)for(const i of n.extensionsRequired)if(!t.extensions.find((e=>e.EXTENSION_NAME===i)))throw new Error(`Missing required extension, "${i}".`);if(n.extensionsUsed)for(const i of n.extensionsUsed)t.extensions.find((e=>e.EXTENSION_NAME===i))||t.logger.warn(`Missing optional extension, "${i}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const t=this.P(Ob.assertView(e));this.j(t);const n=t.json;if(n.buffers&&n.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Ob.assertView(e)))}async writeJSON(e,t={}){if(t.format===Sb.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return class{static write(e,t){const n=e.getRoot(),i={asset:xA({generator:"glTF-Transform v3.2.1"},n.getAsset()),extras:xA({},n.getExtras())},r={json:i,resources:{}},s=new BA(e,r,t),o=t.logger||Vb.DEFAULT_INSTANCE,a=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),l=e.getRoot().listExtensionsUsed().filter((e=>a.has(e.extensionName))),c=e.getRoot().listExtensionsRequired().filter((e=>a.has(e.extensionName)));l.length<e.getRoot().listExtensionsUsed().length&&o.warn("Some extensions were not registered for I/O, and will not be written.");for(const m of l)for(const e of m.writeDependencies)m.install(e,t.dependencies[e]);function u(e,t,n,r){const o=[];let a=0;for(const c of e){const e=s.createAccessorDef(c);e.bufferView=i.bufferViews.length;const t=c.getArray(),n=Ob.pad(Ob.toView(t));e.byteOffset=a,a+=n.byteLength,o.push(n),s.accessorIndexMap.set(c,i.accessors.length),i.accessors.push(e)}const l={buffer:t,byteOffset:n,byteLength:Ob.concat(o).byteLength};return r&&(l.target=r),i.bufferViews.push(l),{buffers:o,byteLength:a}}function d(e,t,n){const r=e[0].getCount();let o=0;for(const u of e){const e=s.createAccessorDef(u);e.bufferView=i.bufferViews.length,e.byteOffset=o;const t=u.getElementSize(),n=u.getComponentSize();o+=Ob.padNumber(t*n),s.accessorIndexMap.set(u,i.accessors.length),i.accessors.push(e)}const a=r*o,l=new ArrayBuffer(a),c=new DataView(l);for(let i=0;i<r;i++){let t=0;for(const n of e){const e=n.getElementSize(),r=n.getComponentSize(),s=n.getComponentType(),a=n.getArray();for(let n=0;n<e;n++){const l=i*o+t+n*r,u=a[i*e+n];switch(s){case oA.ComponentType.FLOAT:c.setFloat32(l,u,!0);break;case oA.ComponentType.BYTE:c.setInt8(l,u);break;case oA.ComponentType.SHORT:c.setInt16(l,u,!0);break;case oA.ComponentType.UNSIGNED_BYTE:c.setUint8(l,u);break;case oA.ComponentType.UNSIGNED_SHORT:c.setUint16(l,u,!0);break;case oA.ComponentType.UNSIGNED_INT:c.setUint32(l,u,!0);break;default:throw new Error("Unexpected component type: "+s)}}t+=Ob.padNumber(e*r)}}return i.bufferViews.push({buffer:t,byteOffset:n,byteLength:a,byteStride:o,target:BA.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(l)]}}function h(e,t,n){const r=[];let a=0;const l=new Map;let c=-1/0;for(const g of e){const e=s.createAccessorDef(g);i.accessors.push(e),s.accessorIndexMap.set(g,i.accessors.length-1);const t=[],n=[],r=[],a=new Array(g.getElementSize()).fill(0);for(let i=0,s=g.getCount();i<s;i++)if(g.getElement(i,r),!Qb.eq(r,a,0)){c=Math.max(i,c),t.push(i);for(let e=0;e<r.length;e++)n.push(r[e])}const u=t.length,d={accessorDef:e,count:u};if(l.set(g,d),0===u)continue;if(u>g.getCount()/3){const e=(100*t.length/g.getCount()).toFixed(1);o.warn(`Sparse accessor with many non-zero elements (${e}%) may increase file size.`)}const h=Mb[g.getComponentType()];d.indices=t,d.values=new h(n)}if(!Number.isFinite(c))return{buffers:r,byteLength:a};const u=c<255?Uint8Array:c<65535?Uint16Array:Uint32Array,d=c<255?FA:c<65535?NA:UA,h={buffer:t,byteOffset:n+a,byteLength:0};for(const i of e){const e=l.get(i);if(0===e.count)continue;e.indicesByteOffset=h.byteLength;const t=Ob.pad(Ob.toView(new u(e.indices)));r.push(t),a+=t.byteLength,h.byteLength+=t.byteLength}i.bufferViews.push(h);const p=i.bufferViews.length-1,f={buffer:t,byteOffset:n+a,byteLength:0};for(const i of e){const e=l.get(i);if(0===e.count)continue;e.valuesByteOffset=f.byteLength;const t=Ob.pad(Ob.toView(e.values));r.push(t),a+=t.byteLength,f.byteLength+=t.byteLength}i.bufferViews.push(f);const m=i.bufferViews.length-1;for(const i of e){const e=l.get(i);0!==e.count&&(e.accessorDef.sparse={count:e.count,indices:{bufferView:p,byteOffset:e.indicesByteOffset,componentType:d},values:{bufferView:m,byteOffset:e.valuesByteOffset}})}return{buffers:r,byteLength:a}}const p=new Map;for(const m of e.getGraph().listEdges()){if(m.getParent()===n)continue;const e=m.getChild();if(e instanceof oA){const t=p.get(e)||[];t.push(m),p.set(e,t)}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=n.listTextures().map(((e,t)=>{const n=s.createPropertyDef(e);e.getMimeType()&&(n.mimeType=e.getMimeType());const i=e.getImage();return i&&s.createImageData(n,i,e),s.imageIndexMap.set(e,t),n})),l.filter((e=>e.prewriteTypes.includes(wb.ACCESSOR))).forEach((e=>e.prewrite(s,wb.ACCESSOR))),n.listAccessors().forEach((e=>{const t=s.accessorUsageGroupedByParent,n=s.accessorParents;if(s.accessorIndexMap.has(e))return;const i=p.get(e)||[],r=s.getAccessorUsage(e);if(s.addAccessorToUsageGroup(e,r),t.has(r)){const t=i[0].getParent(),r=n.get(t)||new Set;r.add(e),n.set(t,r)}})),l.filter((e=>e.prewriteTypes.includes(wb.BUFFER))).forEach((e=>e.prewrite(s,wb.BUFFER))),(n.listAccessors().length>0||n.listTextures().length>0||s.otherBufferViews.size>0)&&0===n.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],n.listBuffers().forEach(((e,n)=>{const o=s.createPropertyDef(e),a=s.accessorUsageGroupedByParent,l=s.accessorParents,c=e.listParents().filter((e=>e instanceof oA)),p=new Set(c),f=[],m=i.buffers.length;let g=0;const _=s.listAccessorUsageGroups();for(const i in _)if(a.has(i))for(const e of Array.from(l.values())){const n=Array.from(e).filter((e=>p.has(e))).filter((e=>s.getAccessorUsage(e)===i));if(n.length)if(i!==LA.ARRAY_BUFFER||t.vertexLayout===xb.INTERLEAVED){const e=i===LA.ARRAY_BUFFER?d(n,m,g):u(n,m,g);g+=e.byteLength,f.push(...e.buffers)}else for(const e of n){const t=d([e],m,g);g+=t.byteLength,f.push(...t.buffers)}}else{const e=_[i].filter((e=>p.has(e)));if(!e.length)continue;const t=i===LA.ELEMENT_ARRAY_BUFFER?BA.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,n=i===LA.SPARSE?h(e,m,g):u(e,m,g,t);g+=n.byteLength,f.push(...n.buffers)}if(s.imageBufferViews.length&&0===n)for(let t=0;t<s.imageBufferViews.length;t++)if(i.bufferViews[i.images[t].bufferView].byteOffset=g,g+=s.imageBufferViews[t].byteLength,f.push(s.imageBufferViews[t]),g%8){const e=8-g%8;g+=e,f.push(new Uint8Array(e))}if(s.otherBufferViews.has(e))for(const t of s.otherBufferViews.get(e))i.bufferViews.push({buffer:m,byteOffset:g,byteLength:t.byteLength}),s.otherBufferViewsIndexMap.set(t,i.bufferViews.length-1),g+=t.byteLength,f.push(t);if(g){let n;t.format===Sb.GLB?n="@glb.bin":(n=s.bufferURIGenerator.createURI(e,"bin"),o.uri=n),o.byteLength=g,r.resources[n]=Ob.concat(f)}i.buffers.push(o),s.bufferIndexMap.set(e,n)})),n.listAccessors().find((e=>!e.getBuffer()))&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),i.materials=n.listMaterials().map(((e,t)=>{const n=s.createPropertyDef(e);if(e.getAlphaMode()!==vA.AlphaMode.OPAQUE&&(n.alphaMode=e.getAlphaMode()),e.getAlphaMode()===vA.AlphaMode.MASK&&(n.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(n.doubleSided=!0),n.pbrMetallicRoughness={},Qb.eq(e.getBaseColorFactor(),[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),Qb.eq(e.getEmissiveFactor(),[0,0,0])||(n.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(n.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(n.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),i=e.getBaseColorTextureInfo();n.pbrMetallicRoughness.baseColorTexture=s.createTextureInfoDef(t,i)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),i=e.getEmissiveTextureInfo();n.emissiveTexture=s.createTextureInfoDef(t,i)}if(e.getNormalTexture()){const t=e.getNormalTexture(),i=e.getNormalTextureInfo(),r=s.createTextureInfoDef(t,i);1!==e.getNormalScale()&&(r.scale=e.getNormalScale()),n.normalTexture=r}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),i=e.getOcclusionTextureInfo(),r=s.createTextureInfoDef(t,i);1!==e.getOcclusionStrength()&&(r.strength=e.getOcclusionStrength()),n.occlusionTexture=r}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),i=e.getMetallicRoughnessTextureInfo();n.pbrMetallicRoughness.metallicRoughnessTexture=s.createTextureInfoDef(t,i)}return s.materialIndexMap.set(e,t),n})),i.meshes=n.listMeshes().map(((e,t)=>{const n=s.createPropertyDef(e);let i=null;return n.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const n=e.getMaterial();n&&(t.material=s.materialIndexMap.get(n)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const r=e.getIndices();r&&(t.indices=s.accessorIndexMap.get(r));for(const i of e.listSemantics())t.attributes[i]=s.accessorIndexMap.get(e.getAttribute(i));for(const i of e.listTargets()){const e={};for(const t of i.listSemantics())e[t]=s.accessorIndexMap.get(i.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!i&&(i=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(n.weights=e.getWeights()),i&&(n.extras=n.extras||{},n.extras.targetNames=i),s.meshIndexMap.set(e,t),n})),i.cameras=n.listCameras().map(((e,t)=>{const n=s.createPropertyDef(e);if(n.type=e.getType(),n.type===dA.Type.PERSPECTIVE){n.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(n.perspective.aspectRatio=t)}else n.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return s.cameraIndexMap.set(e,t),n})),i.nodes=n.listNodes().map(((e,t)=>{const n=s.createPropertyDef(e);return Qb.eq(e.getTranslation(),[0,0,0])||(n.translation=e.getTranslation()),Qb.eq(e.getRotation(),[0,0,0,1])||(n.rotation=e.getRotation()),Qb.eq(e.getScale(),[1,1,1])||(n.scale=e.getScale()),e.getWeights().length&&(n.weights=e.getWeights()),s.nodeIndexMap.set(e,t),n})),i.skins=n.listSkins().map(((e,t)=>{const n=s.createPropertyDef(e),i=e.getInverseBindMatrices();i&&(n.inverseBindMatrices=s.accessorIndexMap.get(i));const r=e.getSkeleton();return r&&(n.skeleton=s.nodeIndexMap.get(r)),n.joints=e.listJoints().map((e=>s.nodeIndexMap.get(e))),s.skinIndexMap.set(e,t),n})),n.listNodes().forEach(((e,t)=>{const n=i.nodes[t],r=e.getMesh();r&&(n.mesh=s.meshIndexMap.get(r));const o=e.getCamera();o&&(n.camera=s.cameraIndexMap.get(o));const a=e.getSkin();a&&(n.skin=s.skinIndexMap.get(a)),e.listChildren().length>0&&(n.children=e.listChildren().map((e=>s.nodeIndexMap.get(e))))})),i.animations=n.listAnimations().map(((e,t)=>{const n=s.createPropertyDef(e),i=new Map;return n.samplers=e.listSamplers().map(((e,t)=>{const n=s.createPropertyDef(e);return n.input=s.accessorIndexMap.get(e.getInput()),n.output=s.accessorIndexMap.get(e.getOutput()),n.interpolation=e.getInterpolation(),i.set(e,t),n})),n.channels=e.listChannels().map((e=>{const t=s.createPropertyDef(e);return t.sampler=i.get(e.getSampler()),t.target={node:s.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),s.animationIndexMap.set(e,t),n})),i.scenes=n.listScenes().map(((e,t)=>{const n=s.createPropertyDef(e);return n.nodes=e.listChildren().map((e=>s.nodeIndexMap.get(e))),s.sceneIndexMap.set(e,t),n}));const f=n.getDefaultScene();return f&&(i.scene=n.listScenes().indexOf(f)),i.extensionsUsed=l.map((e=>e.extensionName)),i.extensionsRequired=c.map((e=>e.extensionName)),l.forEach((e=>e.write(s))),function(e){const t=[];for(const n in e){const i=e[n];(Array.isArray(i)&&0===i.length||null===i||""===i||i&&"object"==typeof i&&0===Object.keys(i).length)&&t.push(n)}for(const n of t)delete e[n]}(i),r}}.write(e,{format:t.format||Sb.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.U,dependencies:xA({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:Sb.GLB}),i=new Uint32Array([1179937895,2,12]),r=JSON.stringify(t),s=Ob.pad(Ob.encodeText(r),32),o=Ob.toView(new Uint32Array([s.byteLength,1313821514])),a=Ob.concat([o,s]);i[i.length-1]+=a.byteLength;const l=Object.values(n)[0];if(!l||!l.byteLength)return Ob.concat([Ob.toView(i),a]);const c=Ob.pad(l,0),u=Ob.toView(new Uint32Array([c.byteLength,5130562])),d=Ob.concat([u,c]);return i[i.length-1]+=d.byteLength,Ob.concat([Ob.toView(i),a,d])}async L(e,t){var n=this;const i=[...e.json.images||[],...e.json.buffers||[]].map((async function(i){const r=i.uri;if(!r||r.match(/data:/))return Promise.resolve();e.resources[r]=await n.readURI(n.resolve(t,r),"view"),n.lastReadBytes+=e.resources[r].byteLength}));await Promise.all(i)}j(e){function t(t){if(t.uri)if(t.uri in e.resources)Ob.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const n=`__${function(){for(let e=0;e<999;e++){const e=eA();if(!$b.has(e))return $b.add(e),e}return""}()}.${jb.extension(t.uri)}`;e.resources[n]=Ob.createBufferFromDataURI(t.uri),t.uri=n}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)})),(e.json.buffers||[]).forEach(t)}D(e){const{images:t,buffers:n}=e.json;return e={json:xA({},e.json),resources:xA({},e.resources)},t&&(e.json.images=t.map((e=>xA({},e)))),n&&(e.json.buffers=n.map((e=>xA({},e)))),e}P(e){if(!GA(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==jA.JSON)throw new Error("Missing required GLB JSON chunk.");const n=t[0],i=Ob.decodeText(Ob.toView(e,20,n)),r=JSON.parse(i),s=20+n;if(e.byteLength<=s)return{json:r,resources:{}};const o=new Uint32Array(e.buffer,e.byteOffset+s,2);if(o[1]!==jA.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:r,resources:{"@glb.bin":Ob.toView(e,s+8,o[0])}}}}function GA(e){if(e.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const t=new Uint32Array(e.buffer,e.byteOffset,3);return 1179937895===t[0]&&2===t[1]}class VA extends zA{constructor(e=tA.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,t){const n=await fetch(e,this.k);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return tA.resolve(e,t)}dirname(e){return tA.dirname(e)}}const HA=64;class QA{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class WA{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}new Uint8Array([0]);const qA=[171,75,84,88,32,50,48,187,13,10,26,10];function XA(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}function YA(e){const t=new Uint8Array(e.buffer,e.byteOffset,qA.length);if(t[0]!==qA[0]||t[1]!==qA[1]||t[2]!==qA[2]||t[3]!==qA[3]||t[4]!==qA[4]||t[5]!==qA[5]||t[6]!==qA[6]||t[7]!==qA[7]||t[8]!==qA[8]||t[9]!==qA[9]||t[10]!==qA[10]||t[11]!==qA[11])throw new Error("Missing KTX 2.0 identifier.");const n=new QA,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new WA(e,qA.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();const s=r._nextUint32();n.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),u=r._nextUint64(),d=r._nextUint64(),h=3*s*8,p=new WA(e,qA.length+i,h,!0);for(let B=0;B<s;B++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const f=new WA(e,o,a,!0),m={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},g=(m.descriptorBlockSize/4-6)/4;for(let B=0;B<g;B++){const e={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};e.channelType&HA?(e.sampleLower=f._nextInt32(),e.sampleUpper=f._nextInt32()):(e.sampleLower=f._nextUint32(),e.sampleUpper=f._nextUint32()),m.samples[B]=e}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(m);const _=new WA(e,l,c,!0);for(;_._offset<c;){const e=_._nextUint32(),t=_._scan(e),i=XA(t),r=_._scan(e-t.byteLength);n.keyValue[i]=i.match(/^ktx/i)?XA(r):r,_._offset%4&&_._skip(4-_._offset%4)}if(d<=0)return n;const v=new WA(e,u,d,!0),y=v._nextUint16(),b=v._nextUint16(),A=v._nextUint32(),w=v._nextUint32(),x=v._nextUint32(),E=v._nextUint32(),C=[];for(let B=0;B<s;B++)C.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});const S=u+v._offset,M=S+A,T=M+w,I=T+x,P=new Uint8Array(e.buffer,e.byteOffset+S,A),R=new Uint8Array(e.buffer,e.byteOffset+M,w),D=new Uint8Array(e.buffer,e.byteOffset+T,x),k=new Uint8Array(e.buffer,e.byteOffset+I,E);return n.globalData={endpointCount:y,selectorCount:b,imageDescs:C,endpointsData:P,selectorsData:R,tablesData:D,extendedData:k},n}class KA extends hA{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[wb.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}KA.EXTENSION_NAME="EXT_mesh_gpu_instancing";const JA="EXT_mesh_gpu_instancing";class ZA extends IA{constructor(...e){super(...e),this.extensionName=JA,this.provideTypes=[wb.NODE],this.prewriteTypes=[wb.ACCESSOR]}createInstancedMesh(){return new KA(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,n)=>{if(!t.extensions||!t.extensions[JA])return;const i=t.extensions[JA],r=this.createInstancedMesh();for(const s in i.attributes)r.setAttribute(s,e.accessors[i.attributes[s]]);e.nodes[n].setExtension(JA,r)})),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((n=>{const i=n.getExtension(JA);if(i){const r=e.nodeIndexMap.get(n),s=t.json.nodes[r],o={attributes:{}};i.listSemantics().forEach((t=>{const n=i.getAttribute(t);o.attributes[t]=e.accessorIndexMap.get(n)})),s.extensions=s.extensions||{},s.extensions[JA]=o}})),this}}function $A(){return($A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var ew,tw,nw;ZA.EXTENSION_NAME=JA,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(ew||(ew={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(tw||(tw={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(nw||(nw={}));const{BYTE:iw,SHORT:rw,FLOAT:sw}=oA.ComponentType,{encodeNormalizedInt:ow,decodeNormalizedInt:aw}=Qb;function lw(e,t,n,i){const{filter:r,bits:s}=i,o={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(n!==tw.ATTRIBUTES)return o;if(r!==nw.NONE){let n=e.getNormalized()?function(e){const t=e.getComponentType(),n=e.getArray(),i=new Float32Array(n.length);for(let r=0;r<n.length;r++)i[r]=aw(n[r],t);return i}(e):new Float32Array(o.array);switch(r){case nw.EXPONENTIAL:o.byteStride=4*e.getElementSize(),o.componentType=sw,o.normalized=!1,o.array=t.encodeFilterExp(n,e.getCount(),o.byteStride,s);break;case nw.OCTAHEDRAL:o.byteStride=s>8?8:4,o.componentType=s>8?rw:iw,o.normalized=!0,n=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let n=0,i=e.length/3;n<i;n++)t[4*n]=e[3*n],t[4*n+1]=e[3*n+1],t[4*n+2]=e[3*n+2];return t}(n):n,o.array=t.encodeFilterOct(n,e.getCount(),o.byteStride,s);break;case nw.QUATERNION:o.byteStride=8,o.componentType=rw,o.normalized=!0,o.array=t.encodeFilterQuat(n,e.getCount(),o.byteStride,s);break;default:throw new Error("Invalid filter.")}o.min=e.getMin([]),o.max=e.getMax([]),e.getNormalized()&&(o.min=o.min.map((t=>aw(t,e.getComponentType()))),o.max=o.max.map((t=>aw(t,e.getComponentType())))),o.normalized&&(o.min=o.min.map((e=>ow(e,o.componentType))),o.max=o.max.map((e=>ow(e,o.componentType))))}else o.byteStride%4&&(o.array=function(e,t){const n=Ob.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,i=new e.constructor(e.length/t*n);for(let r=0;r*t<e.length;r++)for(let s=0;s<t;s++)i[r*n+s]=e[r*t+s];return i}(o.array,e.getElementSize()),o.byteStride=o.array.byteLength/e.getCount());return o}function cw(e,t){return t===BA.BufferViewUsage.ELEMENT_ARRAY_BUFFER?e.listParents().some((e=>e instanceof AA&&e.getMode()===AA.Mode.TRIANGLES))?tw.TRIANGLES:tw.INDICES:tw.ATTRIBUTES}function uw(e,t){const n=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof MA)));for(const i of n){const t=i.getName(),n=i.getAttributes().key||"";if("indices"===t)return{filter:nw.NONE};if("attributes"===t){if("POSITION"===n)return{filter:nw.NONE};if("TEXCOORD_0"===n)return{filter:nw.NONE};if("NORMAL"===n)return{filter:nw.OCTAHEDRAL,bits:8};if("TANGENT"===n)return{filter:nw.OCTAHEDRAL,bits:8};if(n.startsWith("JOINTS_"))return{filter:nw.NONE};if(n.startsWith("WEIGHTS_"))return{filter:nw.NONE}}if("output"===t){const t=dw(e);return"rotation"===t?{filter:nw.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:nw.EXPONENTIAL,bits:12}:{filter:nw.NONE}}if("input"===t)return{filter:nw.NONE};if("inverseBindMatrices"===t)return{filter:nw.NONE}}return{filter:nw.NONE}}function dw(e){for(const t of e.listParents())if(t instanceof cA)for(const e of t.listParents())if(e instanceof lA)return e.getTargetPath();return null}const hw="EXT_meshopt_compression",pw={method:ew.QUANTIZE};class fw extends IA{constructor(...e){super(...e),this.extensionName=hw,this.prereadTypes=[wb.BUFFER,wb.PRIMITIVE],this.prewriteTypes=[wb.BUFFER,wb.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=pw,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=$A({},pw,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${hw}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${hw}]: Missing WASM support.`)}return t===wb.BUFFER?this._prereadBuffers(e):t===wb.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((n,i)=>{if(!n.extensions||!n.extensions[hw])return;const r=n.extensions[hw],s=r.byteOffset||0,o=r.byteLength||0,a=r.count,l=r.byteStride,c=new Uint8Array(a*l),u=t.json.buffers[r.buffer],d=Ob.toView(u.uri?t.resources[u.uri]:t.resources[Ab],s,o);this._decoder.decodeGltfBuffer(c,a,l,d,r.mode,r.filter),e.bufferViews[i]=c}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n=>{var i;n.extensions&&n.extensions[hw]&&(i=t.json.buffers[n.buffer]).extensions&&i.extensions.EXT_meshopt_compression&&i.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[hw].buffer])}))}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const e of t.listParents())e instanceof oA&&e.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===wb.ACCESSOR?this._prewriteAccessors(e):t===wb.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,i=this._encoderOptions,r=this.document.createBuffer(),s=this.document.getRoot().listBuffers().indexOf(r);this._encoderFallbackBuffer=r,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const o of this.document.getRoot().listAccessors()){if("weights"===dw(o))continue;if(o.getSparse())continue;const r=e.getAccessorUsage(o),a=cw(o,r),l=i.method===ew.FILTER?uw(o,this.document):{filter:nw.NONE},c=lw(o,n,a,l),{array:u,byteStride:d}=c,h=o.getBuffer();if(!h)throw new Error(`${hw}: Missing buffer for accessor.`);const p=this.document.getRoot().listBuffers().indexOf(h),f=[r,a,l.filter,d,p].join(":");let m=this._encoderBufferViews[f],g=this._encoderBufferViewData[f],_=this._encoderBufferViewAccessors[f];m&&g||(_=this._encoderBufferViewAccessors[f]=[],g=this._encoderBufferViewData[f]=[],m=this._encoderBufferViews[f]={buffer:s,target:BA.USAGE_TO_TARGET[r],byteOffset:0,byteLength:0,byteStride:r===BA.BufferViewUsage.ARRAY_BUFFER?d:void 0,extensions:{[hw]:{buffer:p,byteOffset:0,byteLength:0,mode:a,filter:l.filter!==nw.NONE?l.filter:void 0,byteStride:d,count:0}}});const v=e.createAccessorDef(o);v.componentType=c.componentType,v.normalized=c.normalized,v.byteOffset=m.byteLength,v.min&&c.min&&(v.min=c.min),v.max&&c.max&&(v.max=c.max),e.accessorIndexMap.set(o,t.accessors.length),t.accessors.push(v),_.push(v),g.push(new Uint8Array(u.buffer,u.byteOffset,u.byteLength)),m.byteLength+=u.byteLength,m.extensions.EXT_meshopt_compression.count+=o.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const i=this._encoderBufferViews[n],r=this._encoderBufferViewData[n],s=this.document.getRoot().listBuffers()[i.extensions[hw].buffer],o=e.otherBufferViews.get(s)||[],{count:a,byteStride:l,mode:c}=i.extensions[hw],u=Ob.concat(r),d=t.encodeGltfBuffer(u,a,l,c),h=Ob.pad(d);i.extensions[hw].byteLength=d.byteLength,r.length=0,r.push(h),o.push(h),e.otherBufferViews.set(s,o)}}write(e){let t=0;for(const s in this._encoderBufferViews){const n=this._encoderBufferViews[s],i=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[s][0]),r=this._encoderBufferViewAccessors[s];for(const e of r)e.bufferView=i;const o=e.jsonDoc.json.bufferViews[i],a=o.byteOffset||0;Object.assign(o,n),o.byteOffset=t,o.extensions[hw].byteOffset=a,t+=Ob.padNumber(n.byteLength)}const n=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(n),r=e.jsonDoc.json.buffers[i];return r.byteLength=t,r.extensions={[hw]:{fallback:!0}},n.dispose(),this}}fw.EXTENSION_NAME=hw,fw.EncoderMethod=ew;const mw="EXT_texture_avif";class gw{match(e){return e.length>=12&&"ftypavif"===Ob.decodeText(e.slice(4,12))}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=vw(t,0);if(!n)return null;let i=n.end;for(;n=vw(t,i);)if("meta"===n.type)i=n.start+4;else if("iprp"===n.type||"ipco"===n.type)i=n.start;else{if("ispe"===n.type)return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if("mdat"===n.type)break;i=n.end}return null}getChannels(e){return 4}}class _w extends IA{constructor(...e){super(...e),this.extensionName=mw,this.prereadTypes=[wb.TEXTURE]}static register(){Nb.registerFormat("image/avif",new gw)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[mw]&&(e.source=e.extensions[mw].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((n=>{if("image/avif"===n.getMimeType()){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach((e=>{e.source===i&&(e.extensions=e.extensions||{},e.extensions[mw]={source:e.source},delete e.source)}))}})),this}}function vw(e,t){if(e.byteLength<4+t)return null;const n=e.getUint32(t);return e.byteLength<n+t||n<8?null:{type:Ob.decodeText(new Uint8Array(e.buffer,e.byteOffset+t+4,4)),start:t+8,end:t+n}}_w.EXTENSION_NAME=mw;const yw="EXT_texture_webp";class bw{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=Ob.decodeText(e.slice(0,4)),n=Ob.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==n)return null;const i=new DataView(e.buffer,e.byteOffset);let r=12;for(;r<i.byteLength;){const e=Ob.decodeText(new Uint8Array([i.getUint8(r),i.getUint8(r+1),i.getUint8(r+2),i.getUint8(r+3)])),t=i.getUint32(r+4,!0);if("VP8 "===e)return[16383&i.getInt16(r+14,!0),16383&i.getInt16(r+16,!0)];if("VP8L"===e){const e=i.getUint8(r+9),t=i.getUint8(r+10),n=i.getUint8(r+11);return[1+((63&t)<<8|e),1+((15&i.getUint8(r+12))<<10|n<<2|(192&t)>>6)]}r+=8+t+t%2}return null}getChannels(e){return 4}}class Aw extends IA{constructor(...e){super(...e),this.extensionName=yw,this.prereadTypes=[wb.TEXTURE]}static register(){Nb.registerFormat("image/webp",new bw)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[yw]&&(e.source=e.extensions[yw].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((n=>{if("image/webp"===n.getMimeType()){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach((e=>{e.source===i&&(e.extensions=e.extensions||{},e.extensions[yw]={source:e.source},delete e.source)}))}})),this}}Aw.EXTENSION_NAME=yw;const ww="KHR_draco_mesh_compression";let xw,Ew,Cw,Sw;function Mw(e,t){const n=new xw.DecoderBuffer;try{if(n.Init(t,t.length),e.GetEncodedGeometryType(n)!==xw.TRIANGULAR_MESH)throw new Error(`[${ww}] Unknown geometry type.`);const i=new xw.Mesh;if(!e.DecodeBufferToMesh(n,i).ok()||0===i.ptr)throw new Error(`[${ww}] Decoding failure.`);return i}finally{xw.destroy(n)}}function Tw(e,t){const n=3*t.num_faces();let i,r;if(t.num_points()<=65534){const s=n*Uint16Array.BYTES_PER_ELEMENT;i=xw._malloc(s),e.GetTrianglesUInt16Array(t,s,i),r=new Uint16Array(xw.HEAPU16.buffer,i,n).slice()}else{const s=n*Uint32Array.BYTES_PER_ELEMENT;i=xw._malloc(s),e.GetTrianglesUInt32Array(t,s,i),r=new Uint32Array(xw.HEAPU32.buffer,i,n).slice()}return xw._free(i),r}function Iw(e,t,n,i){const r=Cw[i.componentType],s=Ew[i.componentType],o=n.num_components(),a=t.num_points()*o,l=a*s.BYTES_PER_ELEMENT,c=xw._malloc(l);e.GetAttributeDataArrayForAllPoints(t,n,r,l,c);const u=new s(xw.HEAPF32.buffer,c,a).slice();return xw._free(c),u}var Pw,Rw;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(Pw||(Pw={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(Rw||(Rw={}));const Dw={[Rw.POSITION]:14,[Rw.NORMAL]:10,[Rw.COLOR]:8,[Rw.TEX_COORD]:12,[Rw.GENERIC]:12},kw={decodeSpeed:5,encodeSpeed:5,method:Pw.EDGEBREAKER,quantizationBits:Dw,quantizationVolume:"mesh"};function Bw(e,t=kw){const n=$A({},kw,t);n.quantizationBits=$A({},Dw,t.quantizationBits);const i=new Sw.Encoder,r=new Sw.MeshBuilder,s=new Sw.Mesh,o={},a=new Sw.DracoInt8Array,l=e.listTargets().length>0;let c=!1;for(const g of e.listSemantics()){const t=e.getAttribute(g);if(t.getSparse()){c=!0;continue}const a=Ow(g),l=Lw(r,t.getComponentType(),s,Sw[a],t.getCount(),t.getElementSize(),t.getArray());if(-1===l)throw new Error(`Error compressing "${g}" attribute.`);if(o[g]=l,"mesh"===n.quantizationVolume||"POSITION"!==g)i.SetAttributeQuantization(Sw[a],n.quantizationBits[a]);else{if("object"!=typeof n.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=n,r=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);i.SetAttributeExplicitQuantization(Sw[a],n.quantizationBits[a],t.getElementSize(),e.min,r)}}}const u=e.getIndices();if(!u)throw new Uw("Primitive must have indices.");r.AddFacesToMesh(s,u.getCount()/3,u.getArray()),i.SetSpeedOptions(n.encodeSpeed,n.decodeSpeed),i.SetTrackEncodedProperties(!0),i.SetEncodingMethod(n.method===Pw.SEQUENTIAL||l||c?Sw.MESH_SEQUENTIAL_ENCODING:Sw.MESH_EDGEBREAKER_ENCODING);const d=i.EncodeMeshToDracoBuffer(s,a);if(d<=0)throw new Uw("Error applying Draco compression.");const h=new Uint8Array(d);for(let g=0;g<d;++g)h[g]=a.GetValue(g);const p=e.getAttribute("POSITION").getCount(),f=i.GetNumberOfEncodedPoints(),m=3*i.GetNumberOfEncodedFaces();if((l||c)&&f!==p)throw new Uw('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return Sw.destroy(a),Sw.destroy(s),Sw.destroy(r),Sw.destroy(i),{numVertices:f,numIndices:m,data:h,attributeIDs:o}}function Ow(e){return"POSITION"===e?Rw.POSITION:"NORMAL"===e?Rw.NORMAL:e.startsWith("COLOR_")?Rw.COLOR:e.startsWith("TEXCOORD_")?Rw.TEX_COORD:Rw.GENERIC}function Lw(e,t,n,i,r,s,o){switch(t){case oA.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(n,i,r,s,o);case oA.ComponentType.BYTE:return e.AddInt8Attribute(n,i,r,s,o);case oA.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(n,i,r,s,o);case oA.ComponentType.SHORT:return e.AddInt16Attribute(n,i,r,s,o);case oA.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(n,i,r,s,o);case oA.ComponentType.FLOAT:return e.AddFloatAttribute(n,i,r,s,o);default:throw new Error(`Unexpected component type, "${t}".`)}}class Uw extends Error{}const Nw="KHR_draco_mesh_compression";class Fw extends IA{constructor(...e){super(...e),this.extensionName=Nw,this.prereadTypes=[wb.PRIMITIVE],this.prewriteTypes=[wb.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,xw=this._decoderModule,Ew={[oA.ComponentType.FLOAT]:Float32Array,[oA.ComponentType.UNSIGNED_INT]:Uint32Array,[oA.ComponentType.UNSIGNED_SHORT]:Uint16Array,[oA.ComponentType.UNSIGNED_BYTE]:Uint8Array,[oA.ComponentType.SHORT]:Int16Array,[oA.ComponentType.BYTE]:Int8Array},Cw={[oA.ComponentType.FLOAT]:xw.DT_FLOAT32,[oA.ComponentType.UNSIGNED_INT]:xw.DT_UINT32,[oA.ComponentType.UNSIGNED_SHORT]:xw.DT_UINT16,[oA.ComponentType.UNSIGNED_BYTE]:xw.DT_UINT8,[oA.ComponentType.SHORT]:xw.DT_INT16,[oA.ComponentType.BYTE]:xw.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,Sw=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Nw}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,i=new Map;try{const r=n.json.meshes||[];for(const s of r)for(const r of s.primitives){if(!r.extensions||!r.extensions[Nw])continue;const s=r.extensions[Nw];let[o,a]=i.get(s.bufferView)||[];if(!a||!o){const e=n.json.bufferViews[s.bufferView],r=n.json.buffers[e.buffer],l=Ob.toView(r.uri?n.resources[r.uri]:n.resources[Ab],e.byteOffset||0,e.byteLength);o=new this._decoderModule.Decoder,a=Mw(o,l),i.set(s.bufferView,[o,a]),t.debug(`[${Nw}] Decompressed ${l.byteLength} bytes.`)}for(const t in r.attributes){const n=e.jsonDoc.json.accessors[r.attributes[t]],i=o.GetAttributeByUniqueId(a,s.attributes[t]),l=Iw(o,a,i,n);e.accessors[r.attributes[t]].setArray(l)}void 0!==r.indices&&e.accessors[r.indices].setArray(Tw(o,a))}}finally{for(const[e,t]of Array.from(i.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Nw}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Nw}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=function(e){const t=e.getLogger(),n=new Set,i=new Set;for(const c of e.getRoot().listMeshes())for(const e of c.listPrimitives())e.getIndices()?e.getMode()!==AA.Mode.TRIANGLES?(i.add(e),t.warn(`[${Nw}] Skipping Draco compression on non-TRIANGLES primitive.`)):n.add(e):(i.add(e),t.warn(`[${Nw}] Skipping Draco compression on non-indexed primitive.`));const r=e.getRoot().listAccessors(),s=new Map;for(let c=0;c<r.length;c++)s.set(r[c],c);const o=new Map,a=new Set,l=new Map;for(const c of Array.from(n)){let t=jw(c,s);if(a.has(t))l.set(c,t);else{if(o.has(c.getIndices())){const t=c.getIndices(),n=t.clone();s.set(n,e.getRoot().listAccessors().length-1),c.swap(t,n)}for(const t of c.listAttributes())if(o.has(t)){const n=t.clone();s.set(n,e.getRoot().listAccessors().length-1),c.swap(t,n)}t=jw(c,s),a.add(t),l.set(c,t),o.set(c.getIndices(),t);for(const e of c.listAttributes())o.set(e,t)}}for(const c of Array.from(o.keys())){const e=new Set(c.listParents().map((e=>e.propertyType)));if(2!==e.size||!e.has(wb.PRIMITIVE)||!e.has(wb.ROOT))throw new Error(`[${Nw}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const c of Array.from(n)){const e=l.get(c),t=c.getIndices();if(o.get(t)!==e||c.listAttributes().some((t=>o.get(t)!==e)))throw new Error(`[${Nw}] Draco primitives must share all, or no, accessors.`)}for(const c of Array.from(i)){const e=c.getIndices();if(o.has(e)||c.listAttributes().some((e=>o.has(e))))throw new Error(`[${Nw}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return l}(this.document),r=new Map;let s="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?n.warn(`[${Nw}]: quantizationVolume=scene requires exactly 1 scene.`):s=function(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},n=e.propertyType===wb.NODE?[e]:e.listChildren();for(const i of n)i.traverse((e=>{const n=e.getMesh();if(!n)return;const i=kb(n,e.getWorldMatrix());Bb(i.min,t),Bb(i.max,t)}));return t}(this.document.getRoot().listScenes().pop()));for(const o of Array.from(i.keys())){const t=i.get(o);if(!t)throw new Error("Unexpected primitive.");if(r.has(t)){r.set(t,r.get(t));continue}const a=o.getIndices(),l=e.jsonDoc.json.accessors;let c;try{c=Bw(o,$A({},this._encoderOptions,{quantizationVolume:s}))}catch(e){if(e instanceof Uw){n.warn(`[${Nw}]: ${e.message} Skipping primitive compression.`);continue}throw e}r.set(t,c);const u=e.createAccessorDef(a);u.count=c.numIndices,e.accessorIndexMap.set(a,l.length),l.push(u);for(const n of o.listSemantics()){const t=o.getAttribute(n);if(void 0===c.attributeIDs[n])continue;const i=e.createAccessorDef(t);i.count=c.numVertices,e.accessorIndexMap.set(t,l.length),l.push(i)}const d=o.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(d)||e.otherBufferViews.set(d,[]),e.otherBufferViews.get(d).push(c.data)}return n.debug(`[${Nw}] Compressed ${i.size} primitives.`),e.extensionData[Nw]={primitiveHashMap:i,primitiveEncodingMap:r},this}write(e){const t=e.extensionData[Nw];for(const n of this.document.getRoot().listMeshes()){const i=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let r=0;r<n.listPrimitives().length;r++){const s=n.listPrimitives()[r],o=i.primitives[r],a=t.primitiveHashMap.get(s);if(!a)continue;const l=t.primitiveEncodingMap.get(a);l&&(o.extensions=o.extensions||{},o.extensions[Nw]={bufferView:e.otherBufferViewsIndexMap.get(l.data),attributes:l.attributeIDs})}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==Nw)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==Nw))}return this}}function jw(e,t){const n=[],i=e.getIndices();n.push(t.get(i));for(const r of e.listAttributes())n.push(t.get(r));return n.sort().join("|")}Fw.EXTENSION_NAME=Nw,Fw.EncoderMethod=Pw;class zw extends hA{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[wb.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:zw.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Lb.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return Lb.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}zw.EXTENSION_NAME="KHR_lights_punctual",zw.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const Gw="KHR_lights_punctual";class Vw extends IA{constructor(...e){super(...e),this.extensionName=Gw}createLight(e=""){return new zw(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Gw])return this;const n=(t.json.extensions[Gw].lights||[]).map((e=>{var t,n;const i=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&i.setColor(e.color),void 0!==e.intensity&&i.setIntensity(e.intensity),void 0!==e.range&&i.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&i.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(n=e.spot)?void 0:n.outerConeAngle)&&i.setOuterConeAngle(e.spot.outerConeAngle),i}));return t.json.nodes.forEach(((t,i)=>{t.extensions&&t.extensions[Gw]&&e.nodes[i].setExtension(Gw,n[t.extensions[Gw].light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const n=[],i=new Map;for(const r of this.properties){const e=r,t={type:e.getType()};Qb.eq(e.getColor(),[1,1,1])||(t.color=e.getColor()),1!==e.getIntensity()&&(t.intensity=e.getIntensity()),null!=e.getRange()&&(t.range=e.getRange()),e.getName()&&(t.name=e.getName()),e.getType()===zw.Type.SPOT&&(t.spot={innerConeAngle:e.getInnerConeAngle(),outerConeAngle:e.getOuterConeAngle()}),n.push(t),i.set(e,n.length-1)}return this.document.getRoot().listNodes().forEach((n=>{const r=n.getExtension(Gw);if(r){const s=e.nodeIndexMap.get(n),o=t.json.nodes[s];o.extensions=o.extensions||{},o.extensions[Gw]={light:i.get(r)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[Gw]={lights:n},this}}Vw.EXTENSION_NAME=Gw;const{R:Hw,G:Qw}=Cb;class Ww extends hA{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new pA(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Hw|Qw})}}Ww.EXTENSION_NAME="KHR_materials_anisotropy";const qw="KHR_materials_anisotropy";class Xw extends IA{constructor(...e){super(...e),this.extensionName=qw}createAnisotropy(){return new Ww(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[qw]){const r=this.createAnisotropy();e.materials[i].setExtension(qw,r);const s=t.extensions[qw];if(void 0!==s.anisotropyStrength&&r.setAnisotropyStrength(s.anisotropyStrength),void 0!==s.anisotropyRotation&&r.setAnisotropyRotation(s.anisotropyRotation),void 0!==s.anisotropyTexture){const t=s.anisotropyTexture;r.setAnisotropyTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getAnisotropyTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(qw);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[qw]={};if(i.getAnisotropyStrength()>0&&(o.anisotropyStrength=i.getAnisotropyStrength()),0!==i.getAnisotropyRotation()&&(o.anisotropyRotation=i.getAnisotropyRotation()),i.getAnisotropyTexture()){const t=i.getAnisotropyTexture(),n=i.getAnisotropyTextureInfo();o.anisotropyTexture=e.createTextureInfoDef(t,n)}}})),this}}Xw.EXTENSION_NAME=qw;const{R:Yw,G:Kw,B:Jw}=Cb;class Zw extends hA{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new pA(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new pA(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new pA(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Yw})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Kw})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Yw|Kw|Jw})}}Zw.EXTENSION_NAME="KHR_materials_clearcoat";const $w="KHR_materials_clearcoat";class ex extends IA{constructor(...e){super(...e),this.extensionName=$w}createClearcoat(){return new Zw(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[$w]){const r=this.createClearcoat();e.materials[i].setExtension($w,r);const s=t.extensions[$w];if(void 0!==s.clearcoatFactor&&r.setClearcoatFactor(s.clearcoatFactor),void 0!==s.clearcoatRoughnessFactor&&r.setClearcoatRoughnessFactor(s.clearcoatRoughnessFactor),void 0!==s.clearcoatTexture){const t=s.clearcoatTexture;r.setClearcoatTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getClearcoatTextureInfo(),t)}if(void 0!==s.clearcoatRoughnessTexture){const t=s.clearcoatRoughnessTexture;r.setClearcoatRoughnessTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==s.clearcoatNormalTexture){const t=s.clearcoatNormalTexture;r.setClearcoatNormalTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&r.setClearcoatNormalScale(t.scale)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension($w);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[$w]={clearcoatFactor:i.getClearcoatFactor(),clearcoatRoughnessFactor:i.getClearcoatRoughnessFactor()};if(i.getClearcoatTexture()){const t=i.getClearcoatTexture(),n=i.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(t,n)}if(i.getClearcoatRoughnessTexture()){const t=i.getClearcoatRoughnessTexture(),n=i.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(t,n)}if(i.getClearcoatNormalTexture()){const t=i.getClearcoatNormalTexture(),n=i.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(t,n),1!==i.getClearcoatNormalScale()&&(o.clearcoatNormalTexture.scale=i.getClearcoatNormalScale())}}})),this}}ex.EXTENSION_NAME=$w;class tx extends hA{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}tx.EXTENSION_NAME="KHR_materials_emissive_strength";const nx="KHR_materials_emissive_strength";class ix extends IA{constructor(...e){super(...e),this.extensionName=nx}createEmissiveStrength(){return new tx(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[nx]){const i=this.createEmissiveStrength();e.materials[n].setExtension(nx,i);const r=t.extensions[nx];void 0!==r.emissiveStrength&&i.setEmissiveStrength(r.emissiveStrength)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(nx);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{},s.extensions[nx]={emissiveStrength:i.getEmissiveStrength()}}})),this}}ix.EXTENSION_NAME=nx;class rx extends hA{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}rx.EXTENSION_NAME="KHR_materials_ior";const sx="KHR_materials_ior";class ox extends IA{constructor(...e){super(...e),this.extensionName=sx}createIOR(){return new rx(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[sx]){const i=this.createIOR();e.materials[n].setExtension(sx,i);const r=t.extensions[sx];void 0!==r.ior&&i.setIOR(r.ior)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(sx);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{},s.extensions[sx]={ior:i.getIOR()}}})),this}}ox.EXTENSION_NAME=sx;const{R:ax,G:lx}=Cb;class cx extends hA{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new pA(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new pA(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:ax})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:lx})}}cx.EXTENSION_NAME="KHR_materials_iridescence";const ux="KHR_materials_iridescence";class dx extends IA{constructor(...e){super(...e),this.extensionName=ux}createIridescence(){return new cx(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[ux]){const r=this.createIridescence();e.materials[i].setExtension(ux,r);const s=t.extensions[ux];if(void 0!==s.iridescenceFactor&&r.setIridescenceFactor(s.iridescenceFactor),void 0!==s.iridescenceIor&&r.setIridescenceIOR(s.iridescenceIor),void 0!==s.iridescenceThicknessMinimum&&r.setIridescenceThicknessMinimum(s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&r.setIridescenceThicknessMaximum(s.iridescenceThicknessMaximum),void 0!==s.iridescenceTexture){const t=s.iridescenceTexture;r.setIridescenceTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getIridescenceTextureInfo(),t)}if(void 0!==s.iridescenceThicknessTexture){const t=s.iridescenceThicknessTexture;r.setIridescenceThicknessTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getIridescenceThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(ux);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[ux]={};if(i.getIridescenceFactor()>0&&(o.iridescenceFactor=i.getIridescenceFactor()),1.3!==i.getIridescenceIOR()&&(o.iridescenceIor=i.getIridescenceIOR()),100!==i.getIridescenceThicknessMinimum()&&(o.iridescenceThicknessMinimum=i.getIridescenceThicknessMinimum()),400!==i.getIridescenceThicknessMaximum()&&(o.iridescenceThicknessMaximum=i.getIridescenceThicknessMaximum()),i.getIridescenceTexture()){const t=i.getIridescenceTexture(),n=i.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(t,n)}if(i.getIridescenceThicknessTexture()){const t=i.getIridescenceThicknessTexture(),n=i.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(t,n)}}})),this}}dx.EXTENSION_NAME=ux;const{R:hx,G:px,B:fx,A:mx}=Cb;class gx extends hA{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new pA(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new pA(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Lb.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Lb.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:hx|px|fx|mx})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:hx|px|fx|mx})}}gx.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const _x="KHR_materials_pbrSpecularGlossiness";class vx extends IA{constructor(...e){super(...e),this.extensionName=_x}createPBRSpecularGlossiness(){return new gx(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[_x]){const r=this.createPBRSpecularGlossiness();e.materials[i].setExtension(_x,r);const s=t.extensions[_x];if(void 0!==s.diffuseFactor&&r.setDiffuseFactor(s.diffuseFactor),void 0!==s.specularFactor&&r.setSpecularFactor(s.specularFactor),void 0!==s.glossinessFactor&&r.setGlossinessFactor(s.glossinessFactor),void 0!==s.diffuseTexture){const t=s.diffuseTexture;r.setDiffuseTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getDiffuseTextureInfo(),t)}if(void 0!==s.specularGlossinessTexture){const t=s.specularGlossinessTexture;r.setSpecularGlossinessTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getSpecularGlossinessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(_x);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[_x]={diffuseFactor:i.getDiffuseFactor(),specularFactor:i.getSpecularFactor(),glossinessFactor:i.getGlossinessFactor()};if(i.getDiffuseTexture()){const t=i.getDiffuseTexture(),n=i.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(t,n)}if(i.getSpecularGlossinessTexture()){const t=i.getSpecularGlossinessTexture(),n=i.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(t,n)}}})),this}}vx.EXTENSION_NAME=_x;const{R:yx,G:bx,B:Ax,A:wx}=Cb;class xx extends hA{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new pA(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new pA(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Lb.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Lb.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:yx|bx|Ax})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:wx})}}xx.EXTENSION_NAME="KHR_materials_sheen";const Ex="KHR_materials_sheen";class Cx extends IA{constructor(...e){super(...e),this.extensionName=Ex}createSheen(){return new xx(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[Ex]){const r=this.createSheen();e.materials[i].setExtension(Ex,r);const s=t.extensions[Ex];if(void 0!==s.sheenColorFactor&&r.setSheenColorFactor(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&r.setSheenRoughnessFactor(s.sheenRoughnessFactor),void 0!==s.sheenColorTexture){const t=s.sheenColorTexture;r.setSheenColorTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getSheenColorTextureInfo(),t)}if(void 0!==s.sheenRoughnessTexture){const t=s.sheenRoughnessTexture;r.setSheenRoughnessTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getSheenRoughnessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(Ex);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[Ex]={sheenColorFactor:i.getSheenColorFactor(),sheenRoughnessFactor:i.getSheenRoughnessFactor()};if(i.getSheenColorTexture()){const t=i.getSheenColorTexture(),n=i.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(t,n)}if(i.getSheenRoughnessTexture()){const t=i.getSheenRoughnessTexture(),n=i.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(t,n)}}})),this}}Cx.EXTENSION_NAME=Ex;const{R:Sx,G:Mx,B:Tx,A:Ix}=Cb;class Px extends hA{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new pA(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new pA(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Lb.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Lb.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Ix})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Sx|Mx|Tx})}}Px.EXTENSION_NAME="KHR_materials_specular";const Rx="KHR_materials_specular";class Dx extends IA{constructor(...e){super(...e),this.extensionName=Rx}createSpecular(){return new Px(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[Rx]){const r=this.createSpecular();e.materials[i].setExtension(Rx,r);const s=t.extensions[Rx];if(void 0!==s.specularFactor&&r.setSpecularFactor(s.specularFactor),void 0!==s.specularColorFactor&&r.setSpecularColorFactor(s.specularColorFactor),void 0!==s.specularTexture){const t=s.specularTexture;r.setSpecularTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getSpecularTextureInfo(),t)}if(void 0!==s.specularColorTexture){const t=s.specularColorTexture;r.setSpecularColorTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getSpecularColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(Rx);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[Rx]={};if(1!==i.getSpecularFactor()&&(o.specularFactor=i.getSpecularFactor()),Qb.eq(i.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const t=i.getSpecularTexture(),n=i.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(t,n)}if(i.getSpecularColorTexture()){const t=i.getSpecularColorTexture(),n=i.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(t,n)}}})),this}}Dx.EXTENSION_NAME=Rx;const{R:kx}=Cb;class Bx extends hA{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new pA(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:kx})}}Bx.EXTENSION_NAME="KHR_materials_transmission";const Ox="KHR_materials_transmission";class Lx extends IA{constructor(...e){super(...e),this.extensionName=Ox}createTransmission(){return new Bx(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[Ox]){const r=this.createTransmission();e.materials[i].setExtension(Ox,r);const s=t.extensions[Ox];if(void 0!==s.transmissionFactor&&r.setTransmissionFactor(s.transmissionFactor),void 0!==s.transmissionTexture){const t=s.transmissionTexture;r.setTransmissionTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getTransmissionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(Ox);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[Ox]={transmissionFactor:i.getTransmissionFactor()};if(i.getTransmissionTexture()){const t=i.getTransmissionTexture(),n=i.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(t,n)}}})),this}}Lx.EXTENSION_NAME=Ox;class Ux extends hA{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[wb.MATERIAL]}}Ux.EXTENSION_NAME="KHR_materials_unlit";const Nx="KHR_materials_unlit";class Fx extends IA{constructor(...e){super(...e),this.extensionName=Nx}createUnlit(){return new Ux(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,n)=>{t.extensions&&t.extensions[Nx]&&e.materials[n].setExtension(Nx,this.createUnlit())})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{if(n.getExtension(Nx)){const i=e.materialIndexMap.get(n),r=t.json.materials[i];r.extensions=r.extensions||{},r.extensions[Nx]={}}})),this}}Fx.EXTENSION_NAME=Nx;class jx extends hA{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}jx.EXTENSION_NAME="KHR_materials_variants";class zx extends hA{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[wb.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}zx.EXTENSION_NAME="KHR_materials_variants";class Gx extends hA{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}Gx.EXTENSION_NAME="KHR_materials_variants";const Vx="KHR_materials_variants";class Hx extends IA{constructor(...e){super(...e),this.extensionName=Vx}createMappingList(){return new zx(this.document.getGraph())}createVariant(e=""){return new Gx(this.document.getGraph(),e)}createMapping(){return new jx(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof Gx))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Vx])return this;const n=(t.json.extensions[Vx].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,i)=>{const r=e.meshes[i];(t.primitives||[]).forEach(((t,i)=>{if(!t.extensions||!t.extensions[Vx])return;const s=this.createMappingList(),o=t.extensions[Vx];for(const r of o.mappings){const t=this.createMapping();void 0!==r.material&&t.setMaterial(e.materials[r.material]);for(const e of r.variants||[])t.addVariant(n[e]);s.addMapping(t)}r.listPrimitives()[i].setExtension(Vx,s)}))})),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const i=[],r=new Map;for(const s of n)r.set(s,i.length),i.push(e.createPropertyDef(s));for(const s of this.document.getRoot().listMeshes()){const t=e.meshIndexMap.get(s);s.listPrimitives().forEach(((n,i)=>{const s=n.getExtension(Vx);if(!s)return;const o=e.jsonDoc.json.meshes[t].primitives[i],a=s.listMappings().map((t=>{const n=e.createPropertyDef(t),i=t.getMaterial();return i&&(n.material=e.materialIndexMap.get(i)),n.variants=t.listVariants().map((e=>r.get(e))),n}));o.extensions=o.extensions||{},o.extensions[Vx]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[Vx]={variants:i},this}}Hx.EXTENSION_NAME=Vx;const{G:Qx}=Cb;class Wx extends hA{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[wb.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new pA(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Qx})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Lb.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",Lb.hexToFactor(e,t))}}Wx.EXTENSION_NAME="KHR_materials_volume";const qx="KHR_materials_volume";class Xx extends IA{constructor(...e){super(...e),this.extensionName=qx}createVolume(){return new Wx(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,i)=>{if(t.extensions&&t.extensions[qx]){const r=this.createVolume();e.materials[i].setExtension(qx,r);const s=t.extensions[qx];if(void 0!==s.thicknessFactor&&r.setThicknessFactor(s.thicknessFactor),void 0!==s.attenuationDistance&&r.setAttenuationDistance(s.attenuationDistance),void 0!==s.attenuationColor&&r.setAttenuationColor(s.attenuationColor),void 0!==s.thicknessTexture){const t=s.thicknessTexture;r.setThicknessTexture(e.textures[n[t.index].source]),e.setTextureInfo(r.getThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(qx);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o=s.extensions[qx]={};if(i.getThicknessFactor()>0&&(o.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(o.attenuationDistance=i.getAttenuationDistance()),Qb.eq(i.getAttenuationColor(),[1,1,1])||(o.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const t=i.getThicknessTexture(),n=i.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(t,n)}}})),this}}Xx.EXTENSION_NAME=qx;const Yx="KHR_mesh_quantization";class Kx extends IA{constructor(...e){super(...e),this.extensionName=Yx}read(e){return this}write(e){return this}}Kx.EXTENSION_NAME=Yx;const Jx="KHR_texture_basisu";class Zx{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=YA(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=YA(e).dataFormatDescriptor[0];if(163===t.colorModel)return 2===t.samples.length&&15==(15&t.samples[1].channelType)?4:3;if(166===t.colorModel)return 3==(15&t.samples[0].channelType)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=YA(e),n=this.getChannels(e)>3;let i=0;for(let r=0;r<t.levels.length;r++){const e=t.levels[r];i+=e.uncompressedByteLength?e.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,r)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,r)))/4)*(n?16:8)}return i}}class $x extends IA{constructor(...e){super(...e),this.extensionName=Jx,this.prereadTypes=[wb.TEXTURE]}static register(){Nb.registerFormat("image/ktx2",new Zx)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{e.extensions&&e.extensions[Jx]&&(e.source=e.extensions[Jx].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((n=>{if("image/ktx2"===n.getMimeType()){const i=e.imageIndexMap.get(n);t.json.textures.forEach((e=>{e.source===i&&(e.extensions=e.extensions||{},e.extensions[Jx]={source:e.source},delete e.source)}))}})),this}}$x.EXTENSION_NAME=Jx;class eE extends hA{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[wb.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}eE.EXTENSION_NAME="KHR_texture_transform";const tE="KHR_texture_transform";class nE extends IA{constructor(...e){super(...e),this.extensionName=tE}createTransform(){return new eE(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[tE])continue;const e=this.createTransform(),i=n.extensions[tE];void 0!==i.offset&&e.setOffset(i.offset),void 0!==i.rotation&&e.setRotation(i.rotation),void 0!==i.scale&&e.setScale(i.scale),void 0!==i.texCoord&&e.setTexCoord(i.texCoord),t.setExtension(tE,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,i]of t){const e=n.getExtension(tE);if(!e)continue;i.extensions=i.extensions||{};const t={},r=Qb.eq;r(e.getOffset(),[0,0])||(t.offset=e.getOffset()),0!==e.getRotation()&&(t.rotation=e.getRotation()),r(e.getScale(),[1,1])||(t.scale=e.getScale()),null!=e.getTexCoord()&&(t.texCoord=e.getTexCoord()),i.extensions[tE]=t}return this}}nE.EXTENSION_NAME=tE;const iE=[wb.ROOT,wb.SCENE,wb.NODE,wb.MESH,wb.MATERIAL,wb.TEXTURE,wb.ANIMATION];class rE extends hA{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=iE}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",$A({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=$A({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return $A({"@context":sE(this.get("context"))},sE(this.get("properties")))}fromJSONLD(e){const t=(e=sE(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function sE(e){return JSON.parse(JSON.stringify(e))}rE.EXTENSION_NAME="KHR_xmp_json_ld";const oE="KHR_xmp_json_ld";class aE extends IA{constructor(...e){super(...e),this.extensionName=oE}createPacket(){return new rE(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=null==(t=e.jsonDoc.json.extensions)?void 0:t[oE];if(!n||!n.packets)return this;const i=e.jsonDoc.json,r=this.document.getRoot(),s=n.packets.map((e=>this.createPacket().fromJSONLD(e))),o=[[i.asset],i.scenes,i.nodes,i.meshes,i.materials,i.images,i.animations],a=[[r],r.listScenes(),r.listNodes(),r.listMeshes(),r.listMaterials(),r.listTextures(),r.listAnimations()];for(let l=0;l<o.length;l++){const e=o[l]||[];for(let t=0;t<e.length;t++){const n=e[t];n.extensions&&n.extensions[oE]&&a[l][t].setExtension(oE,s[n.extensions[oE].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const i of this.properties){n.push(i.toJSONLD());for(const r of i.listParents()){let i;switch(r.propertyType){case wb.ROOT:i=t.asset;break;case wb.SCENE:i=t.scenes[e.sceneIndexMap.get(r)];break;case wb.NODE:i=t.nodes[e.nodeIndexMap.get(r)];break;case wb.MESH:i=t.meshes[e.meshIndexMap.get(r)];break;case wb.MATERIAL:i=t.materials[e.materialIndexMap.get(r)];break;case wb.TEXTURE:i=t.images[e.imageIndexMap.get(r)];break;case wb.ANIMATION:i=t.animations[e.animationIndexMap.get(r)];break;default:i=null,this.document.getLogger().warn(`[${oE}]: Unsupported parent property, "${r.propertyType}"`)}i&&(i.extensions=i.extensions||{},i.extensions[oE]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[oE]={packets:n}),this}}aE.EXTENSION_NAME=oE;const lE=[ZA,fw,_w,Aw,Fw,Vw,Xw,ex,ix,ox,dx,vx,Dx,Cx,Lx,Fx,Hx,Xx,Kx,$x,nE,aE];class cE extends Uy{constructor(e){super(),this._loadedLibs=!1,e=e||{method:Fw.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=(new VA).registerExtensions(lE).registerExtensions([hE,AE,_E,vE,yE,wE,xE,EE,CE,SE,ME,TE,IE,DE,PE,kE,bE,RE]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:n,...i}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,i);await this._loadLibs();const r={...i};t&&(r.externalImagesInExtras=!0);const s=await new Promise(((t,n)=>this.parse(e,t,n,r))),o=await super.parseAsync(s,r);if(!t)return o;if(!s)throw new Error("GLTFDracoExporter: gltf is null");let a=s;const l=a.byteLength||1/0,c=await("object"!=typeof a||a.byteLength?this._io.readBinary(new Uint8Array(a)):this._io.readJSON({json:a,resources:{}}));if(c.createExtension(Fw).setRequired(!0).setEncoderOptions({...this._encoderOptions,...null!=n?n:{}}),"glb"===r.exportExt)a=await this._io.writeBinary(c),isFinite(l)&&console.log("DRACO Compression ratio: "+(a.byteLength/l).toFixed(5));else{const e=await this._io.writeJSON(c);a=e.json,Object.values(e.resources).filter((e=>e)).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),a.resources=e.resources)}a.__isGLTFOutput=!0;const u=await super.parseAsync(a,r);if(!u)throw new Error("GLTFDracoExporter: blob is null");return u.ext="glb",u.__uncompressed=o,u}addExtension(e){return this._io.registerExtensions([e]),this}createAndAddExtension(e,t){return this.addExtension(gE(e,t))}}class uE extends _t{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Ls,ub]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,n=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");!function(e,t,n){jy(e,t,cE,(e=>{const t=De()+".drc",i=e;i.loader=n.registerFile(t),i.loader.setDecoderConfig({type:"js"}),i.loader.preload(!0,!0)}))}(n,e,t)}}uE.PluginType="GLTFDracoExportPlugin";class dE extends hA{constructor(){super(...arguments),this.extensionName=jn,this.parentTypes=[wb.SCENE],this.propertyType="ViewerJSON"}init(){}}class hE extends IA{constructor(){super(...arguments),this.extensionName=jn,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},null===(t=e.jsonDoc.json.scenes)||void 0===t||t.forEach(((t,n)=>{if(t.extensions&&t.extensions[jn]){const i=new dE(this.document.getGraph());e.scenes[n].setExtension(jn,i),this._viewerConfig=t.extensions[jn]}})),this}write(e){return this.document.getRoot().listScenes().forEach((t=>{var n;if(t.getExtension(jn)){const t=null===(n=e.jsonDoc.json.scenes)||void 0===n?void 0:n[e.jsonDoc.json.scene||0];t&&Object.keys(this._viewerConfig).length>0&&(t.extensions=t.extensions||{},t.extensions[jn]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}})),this}}hE.EXTENSION_NAME=jn;class pE extends hA{addTexture(e,t,n,i=4369){this.setRef(e,n,{channels:i}),this.textures[e]=[t,n]}constructor(e,t,n){super(e,t),this.parentTypes=[wb.MATERIAL,wb.MESH,wb.NODE,wb.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}init(){}}class fE extends IA{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach(((t,n)=>{var r,s;if(t.extensions&&t.extensions[this.extensionName]){const o=new pE(this.document.getGraph(),"",this.extensionName);e.materials[n].setExtension(this.extensionName,o);const a={...t.extensions[this.extensionName]};for(const[t,n]of Object.entries(a))if("number"==typeof(null==n?void 0:n.index)){const l=n,c=null===(r=i[l.index])||void 0===r?void 0:r.source;if("number"!=typeof c){console.warn("GLTF Pipeline: source texture not found for texture info",l);continue}const u=e.textures[c],d=new pA(this.document.getGraph()),h=null!==(s=this.textureChannels[t])&&void 0!==s?s:4369;o.addTexture(t,d,u,h),e.setTextureInfo(d,l),delete a[t]}o.setExtras(a)}})),(t.json.meshes||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new pE(this.document.getGraph(),"",this.extensionName);e.meshes[n].setExtension(this.extensionName,i);const r=t.extensions[this.extensionName];i.setExtras(r)}})),(t.json.nodes||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new pE(this.document.getGraph(),"",this.extensionName);e.nodes[n].setExtension(this.extensionName,i);const r=t.extensions[this.extensionName];i.setExtras(r)}})),(t.json.scenes||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new pE(this.document.getGraph(),"",this.extensionName);e.scenes[n].setExtension(this.extensionName,i);const r=t.extensions[this.extensionName];i.setExtras(r)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const i=n.getExtension(this.extensionName);if(i){const r=e.materialIndexMap.get(n),s=t.json.materials[r];s.extensions=s.extensions||{};const o={...i.getExtras()};for(const[t,n]of Object.entries(i.textures)){const i=n[0],r=n[1];r&&(o[t]=e.createTextureInfoDef(r,i))}s.extensions[this.extensionName]=o}})),this.document.getRoot().listMeshes().forEach((n=>{const i=n.getExtension(this.extensionName);if(i){const r=e.meshIndexMap.get(n),s=t.json.meshes[r];s.extensions=s.extensions||{},s.extensions[this.extensionName]=i.getExtras()}})),this.document.getRoot().listNodes().forEach((n=>{const i=n.getExtension(this.extensionName);if(i){const r=e.nodeIndexMap.get(n),s=t.json.nodes[r];s.extensions=s.extensions||{},s.extensions[this.extensionName]=i.getExtras()}})),this.document.getRoot().listScenes().forEach((n=>{const i=n.getExtension(this.extensionName);if(i){const n=e.jsonDoc.json.scene||0,r=t.json.scenes[n];if(!r)return;r.extensions=r.extensions||{},r.extensions[this.extensionName]=i.getExtras()}})),this}}function mE(e){let t=0;return e.includes("R")&&(t|=Cb.R),e.includes("G")&&(t|=Cb.G),e.includes("B")&&(t|=Cb.B),e.includes("A")&&(t|=Cb.A),t}function gE(e,t){var n;return n=class extends fE{constructor(){super(...arguments),this.extensionName=e,this.textureChannels=t?Object.fromEntries(Object.entries(t).map((([e,t])=>[e,"number"==typeof t?t:mE(t)]))):{}}},n.EXTENSION_NAME=e,n}class _E extends fE{constructor(){super(...arguments),this.extensionName=_E.EXTENSION_NAME,this.textureChannels={bumpTexture:Cb.R}}}_E.EXTENSION_NAME=Yn;class vE extends fE{constructor(){super(...arguments),this.extensionName=vE.EXTENSION_NAME,this.textureChannels={lightMapTexture:Cb.R|Cb.G|Cb.B}}}vE.EXTENSION_NAME=Zn;class yE extends fE{constructor(){super(...arguments),this.extensionName=yE.EXTENSION_NAME,this.textureChannels={alphaTexture:Cb.G}}}yE.EXTENSION_NAME=Jn;class bE extends fE{constructor(){super(...arguments),this.extensionName=bE.EXTENSION_NAME,this.textureChannels={displacementTexture:Cb.R}}}bE.EXTENSION_NAME=Kn;class AE extends fE{constructor(){super(...arguments),this.extensionName=AE.EXTENSION_NAME}}AE.EXTENSION_NAME=Bc.DIAMOND_GLTF_EXTENSION;class wE extends fE{constructor(){super(...arguments),this.extensionName=wE.EXTENSION_NAME}}wE.EXTENSION_NAME=Ya.AnimationMarkersExtension;class xE extends fE{constructor(){super(...arguments),this.extensionName=xE.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Cb.R|Cb.G|Cb.B}}}xE.EXTENSION_NAME=Sl.ANISOTROPY_GLTF_EXTENSION;class EE extends fE{constructor(){super(...arguments),this.extensionName=EE.EXTENSION_NAME,this.textureChannels={customBumpMap:Cb.R|Cb.G|Cb.B}}}EE.EXTENSION_NAME=Ha.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class CE extends fE{constructor(){super(...arguments),this.extensionName=CE.EXTENSION_NAME}}CE.EXTENSION_NAME=Gn;class SE extends fE{constructor(){super(...arguments),this.extensionName=SE.EXTENSION_NAME}}SE.EXTENSION_NAME=Vn;class ME extends fE{constructor(){super(...arguments),this.extensionName=ME.EXTENSION_NAME}}ME.EXTENSION_NAME=Hn;class TE extends fE{constructor(){super(...arguments),this.extensionName=TE.EXTENSION_NAME}}TE.EXTENSION_NAME=Wh.CLEARCOAT_TINT_GLTF_EXTENSION;class IE extends fE{constructor(){super(...arguments),this.extensionName=IE.EXTENSION_NAME}}IE.EXTENSION_NAME=ko.THIN_FILM_LAYER_GLTF_EXTENSION;class PE extends fE{constructor(){super(...arguments),this.extensionName=PE.EXTENSION_NAME}}PE.EXTENSION_NAME=Nh.TRIPLANAR_GLTF_EXTENSION;class RE extends fE{constructor(){super(...arguments),this.extensionName=RE.EXTENSION_NAME}}RE.EXTENSION_NAME=Gh.LAYERED_MATERIAL_GLTF_EXTENSION;class DE extends fE{constructor(){super(...arguments),this.extensionName=DE.EXTENSION_NAME}}DE.EXTENSION_NAME=Dh.SSBEVEL_GLTF_EXTENSION;class kE extends fE{constructor(){super(...arguments),this.extensionName=kE.EXTENSION_NAME}}kE.EXTENSION_NAME=fh.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class BE extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}BE.PluginType="PMREMGenerator";const OE=new n.Pa4,LE=new n._fP,UE=new n.Pa4;class NE extends n.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const FE=new n.yGw,jE=new n.yGw;class zE{constructor(e={}){const t=this;let n,i,r,s;const o={camera:{fov:0,style:""},objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",a.appendChild(l);const c=document.createElement("div");function u(e){return Math.abs(e)<1e-10?0:e}function d(e){const t=e.elements;return"matrix3d("+u(t[0])+","+u(-t[1])+","+u(t[2])+","+u(t[3])+","+u(t[4])+","+u(-t[5])+","+u(t[6])+","+u(t[7])+","+u(t[8])+","+u(-t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(-t[13])+","+u(t[14])+","+u(t[15])+")"}function h(e){const t=e.elements;return"translate(-50%,-50%)matrix3d("+u(t[0])+","+u(t[1])+","+u(t[2])+","+u(t[3])+","+u(-t[4])+","+u(-t[5])+","+u(-t[6])+","+u(-t[7])+","+u(t[8])+","+u(t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(t[13])+","+u(t[14])+","+u(t[15])+")"}function p(e,n,i,r){if(e.isCSS3DObject){const r=!0===e.visible&&!0===e.layers.test(i.layers);if(e.element.style.display=!0===r?"":"none",!0===r){let r;e.onBeforeRender(t,n,i),e.isCSS3DSprite?(FE.copy(i.matrixWorldInverse),FE.transpose(),0!==e.rotation2D&&FE.multiply(jE.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(OE,LE,UE),FE.setPosition(OE),FE.scale(UE),FE.elements[3]=0,FE.elements[7]=0,FE.elements[11]=0,FE.elements[15]=1,r=h(FE)):r=h(e.matrixWorld);const s=e.element,a=o.objects.get(e);if(void 0===a||a.style!==r){s.style.transform=r;const t={style:r};o.objects.set(e,t)}s.parentNode!==c&&c.appendChild(s),e.onAfterRender(t,n,i)}}for(let t=0,s=e.children.length;t<s;t++)p(e.children[t],n,i,r)}c.style.transformStyle="preserve-3d",l.appendChild(c),this.getSize=function(){return{width:n,height:i}},this.render=function(e,t){const a=t.projectionMatrix.elements[5]*s;let h,f;o.camera.fov!==a&&(l.style.perspective=t.isPerspectiveCamera?a+"px":"",o.camera.fov=a),t.view&&t.view.enabled?(l.style.transform=`translate( ${-t.view.offsetX*(n/t.view.width)}px, ${-t.view.offsetY*(i/t.view.height)}px )`,l.style.transform+=`scale( ${t.view.fullWidth/t.view.width}, ${t.view.fullHeight/t.view.height} )`):l.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),t.isOrthographicCamera&&(h=-(t.right+t.left)/2,f=(t.top+t.bottom)/2);const m=t.view&&t.view.enabled?t.view.height/t.view.fullHeight:1,g=t.isOrthographicCamera?`scale( ${m} )scale(`+a+")translate("+u(h)+"px,"+u(f)+"px)"+d(t.matrixWorldInverse):`scale( ${m} )translateZ(`+a+"px)"+d(t.matrixWorldInverse),_=g+"translate("+r+"px,"+s+"px)";o.camera.style!==_&&(c.style.transform=_,o.camera.style=_),p(e,e,t,g)},this.setSize=function(e,t){n=e,i=t,r=n/2,s=i/2,a.style.width=e+"px",a.style.height=t+"px",l.style.width=e+"px",l.style.height=t+"px",c.style.width=e+"px",c.style.height=t+"px"}}}var GE,VE=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let HE=GE=class extends _t{constructor(e=!0){super(),this._scene=new n.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,t,n,i,r;const s=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();if(!(null==s?void 0:s.geometry))return void await(null===(n=this._viewer)||void 0===n?void 0:n.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const o=await(null===(i=this._viewer)||void 0===i?void 0:i.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!o)return;const a=await(null===(r=this._viewer)||void 0===r?void 0:r.prompt("Width: Enter the width for the object.","512",!1))||"512";a&&this.attachIFrame(s,o,parseInt(a))},this._resizeObserver=new ResizeObserver((()=>{var e;this.enabled&&(null===(e=this._viewer)||void 0===e||e.scene.setDirty({sceneUpdate:!0}))})),this.enabled=e,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const e=this._viewer;e&&this._renderer&&(e.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",e.canvas):this._renderer.domElement.appendChild(e.canvas))}_initialize(){if(this._renderer)return;if(!this._viewer)return;this._renderer=new zE;const e=this._viewer.renderer.rendererObject.getSize(new n.FM8);this._renderer.setSize(e.width,e.height);const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.zIndex="0",t.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(t),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",(()=>{if(!this._viewer||!this._renderer)return;const e=this._viewer.renderer.rendererObject.getSize(new n.FM8);this._renderer.setSize(e.width,e.height)}))}async onAdded(e){await super.onAdded(e);let t=!0,i=!0;e.addEventListener("postFrame",(r=>{var s,o;t&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach((e=>{var t,i;let r=!0;const s=e.modelObj.material.side;if(s!==n.ehD){const o=new n.Pa4(0,0,1).applyQuaternion(e.cssObj.quaternion),a=null===(i=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera)||void 0===i?void 0:i.cameraObject,l=o.dot(a.getWorldDirection(new n.Pa4));r=s===n._Li?l>0:l<0}e.cssObj.element.style.visibility=r?"visible":"hidden"})),this._trackers.filter((e=>e.dirty)).forEach((e=>this._syncProperties(e))),null===(s=this._renderer)||void 0===s||s.render(this._scene,null===(o=e.scene.activeCamera)||void 0===o?void 0:o.cameraObject),t=!1))})),e.addEventListener("update",(e=>{this.enabled&&(t=this._trackers.length>0)})),e.scene.addEventListener("sceneUpdate",(e=>{this.enabled&&(this._trackers.forEach((e=>e.dirty=!0)),t=this._trackers.length>0)})),e.scene.addEventListener("activeCameraUpdate",(e=>{this.enabled&&(t=this._trackers.length>0,i=!0)}));let r=!1;const s=new n.iMs;e.container.addEventListener("mousemove",(e=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const t=this._viewer.canvas.getBoundingClientRect(),n=(e.clientX-t.x)/t.width*2-1,i=-(e.clientY-t.y)/t.height*2+1;s.setFromCamera({x:n,y:i},this._viewer.scene.activeCamera.cameraObject);const o=this._trackers.map((e=>e.modelObj)),a=s.intersectObjects(o,!1);if(console.log(a),a.length)return this._viewer.canvas.style.pointerEvents="none",r=!0,void console.log(this._viewer.canvas.style.pointerEvents);r&&(this._viewer.canvas.style.pointerEvents="auto",r=!1)}))}attachIFrame(e,t,n){const i=XE(e.modelObject),r=QE(t,n,n*i.y/i.x,(()=>{var t;return null===(t=e.setDirty)||void 0===t?void 0:t.call(e)}));return this.attachCSS3DObject(r,e),r}attachCSS3DObject(e,t){var i,r,s,o,a;if(this._trackers.push({cssObj:e,modelObj:t.modelObject,dirty:!0}),e.element&&(this._resizeObserver.observe(e.element),e.element.__isCSS3DObjectElement=!0,console.log(e.element,e.element.__isCSS3DObjectElement)),t.userData.__oldMaterial=t.material,!t.setMaterial)throw"model not processed?";const l=null===(i=this._viewer)||void 0===i?void 0:i.createMaterial("basic",{opacity:0,color:new n.Ilk("black"),blending:n.jFi,side:n.Wl3});if(!l)throw"cannot create mat";l.userData.forcedLinearDepth=0,null===(r=t.setMaterial)||void 0===r||r.call(t,l),WE(t.modelObject),qE(t.modelObject),XE(t.modelObject),this._scene.add(e),null===(o=null===(s=this.uiConfig)||void 0===s?void 0:s.uiRefresh)||void 0===o||o.call(s),null===(a=t.setDirty)||void 0===a||a.call(t)}_syncProperties(e){const t=e.modelObj,i=e.cssObj;t.updateMatrixWorld();const r=e.cssObj.element.clientWidth<1.5?0:(e.cssObj.element.clientWidth-1.5)/XE(t).x,s=WE(t);i.quaternion.setFromUnitVectors(new n.Pa4(0,0,1),s),i.position.copy(qE(t)),i.scale.set(1,1,1).multiplyScalar(1/r),i.updateMatrixWorld(),i.applyMatrix4(t.matrixWorld),e.dirty=!1}async onDispose(e){return this._resizeObserver.disconnect(),super.onDispose(e)}};function QE(e,t,n,i){const r=document.createElement("div");r.style.width=t.toString()+"px",r.style.height=n.toString()+"px",r.style.backgroundColor="transparent";const s=document.createElement("iframe",{is:"x-frame-bypass"});s.style.width="100%",s.style.height="100%",s.style.border="0px";const o=()=>{var e,t;try{s.contentWindow.name}catch(n){("string"==typeof n?n:null!==(t=null===(e=null==n?void 0:n.toString)||void 0===e?void 0:e.call(n))&&void 0!==t?t:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(n)}i(),s.removeEventListener("load",o)};return s.addEventListener("load",o),s.src=e,r.appendChild(s),new NE(r)}function WE(e){if(e.geometry.userData.geometryNormal)return e.geometry.userData.geometryNormal;const t=e.geometry.attributes.normal,i=new n.Pa4,r=new n.Pa4;for(let n=0,s=t.count;n<s;n++)i.fromBufferAttribute(t,n),r.add(i);return r.normalize(),e.geometry.userData.geometryNormal=r,r}function qE(e){if(e.geometry.userData.geometryCenter)return e.geometry.userData.geometryCenter;const t=e.geometry;if(!t)return new n.Pa4(0,0,0);t.boundingBox||t.computeBoundingBox();const i=t.boundingBox.getCenter(new n.Pa4);return e.geometry.userData.geometryCenter=i,i}function XE(e,t=new n.Pa4(0,0,1)){if(e.geometry.userData.geometrySize)return e.geometry.userData.geometrySize;const i=e.geometry;if(!i)return new n.Pa4(0,0,0);const r=i.clone();r.applyMatrix4((new n.yGw).makeRotationFromQuaternion((new n._fP).setFromUnitVectors(t,WE(e)).invert())),r.computeBoundingBox();const s=r.boundingBox.getSize(new n.Pa4);return e.geometry.userData.geometrySize=s,r.dispose(),s}HE.PluginType="CSS3DRenderer",VE([Oe("Enabled"),(0,t.onChange)(GE.prototype._refreshEnabled),re()],HE.prototype,"enabled",void 0),VE([Oe("Over canvas"),(0,t.onChange)(GE.prototype._refreshCanvasInDOM),re()],HE.prototype,"overCanvas",void 0),VE([je("Attach iframe")],HE.prototype,"attachIFrameToSelected",void 0),HE=GE=VE([We("CSS3D Renderer")],HE);class YE extends pt{constructor(e,t,i,r=new n.Ilk(1,1,1),s=1){super(void 0,void 0,i,r,s),this._getSelectedObjectOrMaterial=e,this.target=t}render(e,t,i,r,s){const o=e.getRenderTarget(),a=e.getActiveCubeFace(),l=e.getActiveMipmapLevel(),c=this._getSelectedObjectOrMaterial();if(c)this._renderSelectedObject(e,c,t,r,s);else{e.setRenderTarget(this.target);const t=new n.Ilk;e.getClearColor(t),e.setClearColor(new n.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(t)}e.setRenderTarget(o,a,l)}_renderSelectedObject(e,t,n,i,r){if(!this.camera)return;const s=(Array.isArray(t)?t:[t]).map((e=>e.isMaterial?[...e.userData.__appliedMeshes.values()]:e)).flat();s.forEach((e=>e.traverse((e=>{e.layers.enable(6)}))));const o=this.camera.layers.mask;this.camera.layers.set(6);const a=e.userData;a||console.error("threejs is not patched?"),a.transmissionRenderTarget=n,H(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},(()=>super.render(e,n,this.target,i,r))),a.transmissionRenderTarget=void 0,s.forEach((e=>e.traverse((e=>{e.layers.disable(6)})))),this.camera.layers.mask=o}}var KE,JE=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let ZE=KE=class{constructor(e,i){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new n.Ilk(15305317),this.debugOutline=!1,this.highlightSelectedMaterials=!1,this.highlightMaterialSameNames=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new n.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new n.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null},dpr:{value:1}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            ${gt}
            ${"uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;uniform float dpr;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;\n#if DEBUG_OUTLINE > 0\ncolor=vec4(0.,0.,0.,1.);\n#endif\nvec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*dpr*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}"}
        `:"",this._combinedPostPlugin=e.getPlugin(Qs),this._pickingPlugin=e.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),i&&(this.extraUniforms.outlineBuffer.value=i.texture),this._enable()}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ot(e.fragmentShader,"#glMarker"," \n            gl_FragColor = outline(gl_FragColor);\n            #glMarker\n        "))}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}_enable(){var e;null===(e=this._pickingPlugin)||void 0===e||e.enableWidget(!this.enabled),this._setDirty()}};ZE.PluginType="Outline",JE([(0,t.onChange)(KE.prototype._enable),Oe("Enable"),re()],ZE.prototype,"enabled",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Oe("Highlight"),re()],ZE.prototype,"enableHighlight",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Oe("DynamicSelection"),re()],ZE.prototype,"enableDynamicSelection",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Ue("Intensity",[0,2],.001,{limitedUi:!0}),re()],ZE.prototype,"outlineIntensity",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Ue("Transparency",[0,1],.01,{limitedUi:!0}),re()],ZE.prototype,"highlightTransparency",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Ge("Color"),re()],ZE.prototype,"outlineColor",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Oe("Debug")],ZE.prototype,"debugOutline",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Oe("Highlight Selected Materials")],ZE.prototype,"highlightSelectedMaterials",void 0),JE([(0,t.onChange)(KE.prototype._setDirty),Oe("Highlight Materials (same name)")],ZE.prototype,"highlightMaterialSameNames",void 0),ZE=KE=JE([We("Outline")],ZE);class $E extends qs{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new ZE(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=null==e?void 0:e.getPluginByType("Picking");t||console.error("OutlinePlugin requires PickingPlugin to be added to the viewer"),e.addEventListener("preRender",(()=>{this._extension.extraUniforms.dpr.value=e.renderer.displayCanvasScaling}));const i=new n.jyz({uniforms:{cameraNearFar:{value:new n.FM8(.1,100)}},vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec3 vViewPosition;void main(){\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;}",fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:n.ehD}),r=vt(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new YE((()=>{var n,i;if(null===(n=this._extension)||void 0===n?void 0:n.highlightSelectedMaterials){const n=null===(i=null==t?void 0:t.getSelectedObject())||void 0===i?void 0:i.material;if(this._extension.highlightMaterialSameNames&&n){const t=Array.isArray(n)?n.map((e=>e.name)):[n.name],i=new Set;return t.forEach((t=>{var n,r;const s=null===(r=null===(n=e.assetManager)||void 0===n?void 0:n.materials)||void 0===r?void 0:r.findMaterialsByName(t);null==s||s.forEach((e=>i.add(e)))})),[...i]}return n}return null==t?void 0:t.getSelectedObject()}),this._outlineTarget,i),update(){e.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),r.passObject.scene=e.scene.modelObject,r.passObject.camera=e.scene.renderCamera.cameraObject}});e.renderer.registerPass(r),null==t||t.addEventListener("selectedObjectChanged",(()=>{!this._animationCallBack&&this._extension&&((null==t?void 0:t.getSelectedObject())?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)})),document.addEventListener("mousemove",(n=>{if(!this._extension)return;if(!this.mouseInOutAnimationEnabled)return;const i=null==t?void 0:t.getSelectedObject();i&&this._extension.enableDynamicSelection?n.target!==e.canvas?this._animationCallBack||"in"!==this._state||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||"out"!==this._state||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=i?this._extension.highlightTransparency:1}))}async _startTransparencyAnimation(e,t,n){return Ld(this._extension,"transparency",{from:e,to:t,duration:n,onComplete:()=>{this._animationCallBack=null}})}}$E.PluginType="Outline";const eC=.2,tC=Math.PI/24,nC=new n.FM8,iC=(e,t,n)=>{let i=t>0?n>0?0:-Math.PI/2:n>0?Math.PI/2:Math.PI;for(let r=0;r<=12;++r)e.push(t+.17*Math.cos(i),n+.17*Math.sin(i),0,t+eC*Math.cos(i),n+eC*Math.sin(i),0),i+=tC};class rC extends n.Kj0{constructor(e,t,i=!1){super(((e,t)=>{const i=new n.u9r,r=[],s=[],o=e.getSize(new n.Pa4),a=o.x/2,l=(t?o.y:o.z)/2;iC(s,a,l),iC(s,-a,l),iC(s,-a,-l),iC(s,a,-l);const c=s.length/3;for(let n=0;n<c-2;n+=2)r.push(n,n+1,n+3,n,n+3,n+2);const u=c-2;return r.push(u,u+1,1,u,1,0),i.setAttribute("position",new n.a$l(s,3)),i.setIndex(r),i})(e,i)),this.boundingSize=new n.Pa4,this._raycaster=new n.iMs,this._camera=t,this._placeOnWall=i;const r=this.material;r.side=n.Wl3,r.color=new n.Ilk(16711935),r.opacity=0,this.userData.bboxVisible=!1;const s=e.getSize(this.boundingSize),o=s.x/2,a=(i?s.y:s.z)/2;this.hitPlane=new n.Kj0(new n._12(2*(o+eC),2*(a+eC))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),i?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){nC.set(t,-n),this.hitPlane.visible=!0;const i=this._positionAndNormalFromPoint(nC,this.hitPlane);return this.hitPlane.visible=!1,null==i?null:i.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const i=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),i}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:n}=this.hitPlane;t.dispose(),n.dispose(),this.geometry.dispose(),this.material.dispose(),null===(e=this.parent)||void 0===e||e.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const i=this._raycaster.intersectObject(t,!0);if(0===i.length)return null;const r=i[0];return null==r.face?null:null==r.uv?{position:r.point,normal:r.face.normal,uv:null}:(r.face.normal.applyNormalMatrix((new n.Vkp).getNormalMatrix(r.object.matrixWorld)),{position:r.point,normal:r.face.normal,uv:r.uv})}}const sC=new n.Pa4;class oC{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new n.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new n.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new n.Pa4,this._hitMatrix=new n.yGw,this.xDamper=new t.Damper,this.yDamper=new t.Damper,this.zDamper=new t.Damper,this.yawDamper=new t.Damper,this.scaleDamper=new t.Damper,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(null==t)return;const n=this.frame.getHitTestResultsForTransientInput(t),i=this.presentedScene,r=this.placementBox;if(1===n.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad||{axes:[0,0]},n=r.getHit(i,t[0],t[1]);r.show=!0,null!=n?(this.isTranslating=!0,this.lastDragPosition.copy(n),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===n.length){r.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(n);this.firstRatio=e/i.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n){var i;this.transientHitTestSource=await(null===(i=e.requestHitTestSourceForTransientInput)||void 0===i?void 0:i.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var t;const n=null===(t=this.xr)||void 0===t?void 0:t.getReferenceSpace(),i=n?e.getPose(n):null;return i?(this._hitMatrix.fromArray(i.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,i=t.rotation.y,r=this.placementBox,s=Math.max(r.boundingSize.x,r.boundingSize.y,r.boundingSize.z)/2,o=this.goalPosition,a=t.scale.x;if(!o.equals(n)||this.goalScale!==a){let{x:i,y:l,z:c}=n;i=this.xDamper.update(i,o.x,e,s),l=this.yDamper.update(l,o.y,e,s),c=this.zDamper.update(c,o.z,e,s),n.set(i,l,c);const u=this.scaleDamper.update(a,this.goalScale,e,1);if(t.scale.set(u,u,u),!this.isTranslating){const e=o.y-l;this.placementComplete&&!this.placeOnWall?r.offsetHeight=e/u:0===e&&(this.placementComplete=!0,r.show=!1)}}r.updateOpacity(e),t.rotation.y=this.yawDamper.update(i,this.goalYaw,e,Math.PI)}processInput(e){var t;this.frame=e;const n=this.transientHitTestSource;if(!n)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(n),r=this.presentedScene,s=r.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(i);if(this.placeOnWall||(this.goalYaw+=t),!r.userData.__scaleDisabled){const t=e/this.firstRatio;this.goalScale=t<1.3&&t>.7692307692307692?1:t}}else if(2!==i.length)if(this.isRotating&&(null===(t=this.inputSource)||void 0===t?void 0:t.gamepad)){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&(console.log("translating"),i.forEach((e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/s;const n=sC.copy(this.xr.getCamera().position),i=-e/(n.y-t.y);n.multiplyScalar(i),t.multiplyScalar(1-i).add(n)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}})));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/s}}getTouchLocation(){var e,t;const{axes:n}=null!==(e=this.inputSource.gamepad)&&void 0!==e?e:{axes:[0,0]},i=this.placementBox.getExpandedHit(this.presentedScene,n[0],n[1]);return null!=i&&(sC.copy(i).sub(null===(t=this.xr)||void 0===t?void 0:t.getCamera().position),sC.length()>10)?null:i}fingerPolar(e){var t,n,i,r,s,o;const a=null!==(i=null===(n=null===(t=e[0].inputSource)||void 0===t?void 0:t.gamepad)||void 0===n?void 0:n.axes)&&void 0!==i?i:[0,0],l=null!==(o=null===(s=null===(r=e[1].inputSource)||void 0===r?void 0:r.gamepad)||void 0===s?void 0:s.axes)&&void 0!==o?o:[0,0],c=l[0]-a[0],u=l[1]-a[1],d=Math.atan2(u,c);let h=this.lastAngle-d;return h>Math.PI?h-=2*Math.PI:h<-Math.PI&&(h+=2*Math.PI),this.lastAngle=d,{separation:Math.sqrt(c*c+u*u),deltaYaw:h}}}class aC{constructor(e,t,i,r,s){this.xrLight=e,this.renderer=t,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=s,this.frameCallback=this.onXRFrame.bind(this);const o=t.xr.getSession();if(r&&"XRWebGLBinding"in window){const i=new n.oAp(16);e.environment=i.texture;const r=t.getContext();switch(o.preferredReflectionFormat){case"srgba8":r.getExtension("EXT_sRGB");break;case"rgba16f":r.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(o,r),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}o.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/e,n.primaryLightIntensity.y/e,n.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class lC extends n.ZAu{constructor(e,t=!0){super(),this.lightProbe=new n.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new n.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let i=null,r=!1;e.xr.addEventListener("sessionstart",(()=>{const n=e.xr.getSession();"requestLightProbe"in n&&n.requestLightProbe({reflectionFormat:n.preferredReflectionFormat}).then((n=>{i=new aC(this,e,n,t,(()=>{r=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{i&&(i.dispose(),i=null),r&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{i&&(i.dispose(),i=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var cC,uC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let dC=cC=class extends _t{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new oC,this.dependencies=[At],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var e;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):this._xrManager?(this._xrManager.enabled=!0,null===(e=this._xrManager)||void 0===e||e.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{var e;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const t=this._xrManager.getCamera(),n=(null===(e=t.cameras)||void 0===e?void 0:e[0])||t,i=this._viewer.scene.activeCamera;i.cameraObject.projectionMatrix.copy(n.projectionMatrix),i.cameraObject.projectionMatrixInverse.copy(i.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,t;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const n=this._viewer.renderer,i=null===(t=null===(e=this._xrManager)||void 0===e?void 0:e.getCamera())||void 0===t?void 0:t.cameras[0].viewport;i?n.rendererObject.setViewport(i):console.warn("no viewport for ar camera"),this._viewer.getPlugin(At).updateShaderProperties(hC.material),hC.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,H(n.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},(()=>{hC.render(n.rendererObject,null,n.composer.readBuffer,0,!1)})),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:e,deltaTime:t})=>{var n,i;if(this.dirty=!!e&&(null===(n=this._xrManager)||void 0===n?void 0:n.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,cC.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!e)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const r=this._xrManager.getReferenceSpace(),s=e.getViewerPose(r);if(null==s&&this._frameCount,null==s||0===(null===(i=this._viewer)||void 0===i?void 0:i.scene.modelRoot.children.length))return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(t),this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new n.Pa4(1,1,1),modelPosition:new n.Pa4,modelRotation:new n._fP,cameraPosition:new n.Pa4(0,0,5),cameraTarget:new n.Pa4,cameraUp:new n.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectionMatrix:new n.yGw,cameraAutoNearFar:void 0,groundOffset:new n.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new n.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var e;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=null===(e=this._viewer.scene.backgroundColor)||void 0===e?void 0:e.getHex();const t=this._viewer.scene.modelRoot,n=this._viewer.scene.activeCamera;t.updateMatrix(),t.updateMatrixWorld(!0),this._preXRState.modelScale.copy(t.scale),this._preXRState.modelPosition.copy(t.position),this._preXRState.modelRotation.copy(t.quaternion),this._preXRState.cameraPosition.copy(n.position),this._preXRState.cameraTarget.copy(n.target),this._preXRState.cameraUp.copy(n.cameraObject.up),n.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=n.cameraObject.fov,this._preXRState.cameraAspect=n.cameraObject.aspect),this._preXRState.cameraZoom=n.cameraObject.zoom,this._preXRState.cameraNear=n.cameraObject.near,this._preXRState.cameraFar=n.cameraObject.far,this._preXRState.cameraAutoNearFar=n.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectionMatrix.copy(n.cameraObject.projectionMatrix);const i=this._viewer.getPluginByType("Ground");(null==i?void 0:i.mesh)&&(this._preXRState.groundOffset.subVectors(t.position,i.mesh.modelObject.position),this._preXRState.groundScale=i.mesh.modelObject.scale.x,this._preXRState.groundRotation=i.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=i.renderToDepth,this._preXRState.groundShadowBaker=i.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,t=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var e,n;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const i=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await(null===(n=(e=this._xrSession).requestHitTestSource)||void 0===n?void 0:n.call(e,{space:i,offsetRay:t}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async e=>{e.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new lC(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",(()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))}))),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(e),this._xrSession=e},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(e){await super.onAdded(e);const t=e.renderer.rendererObject.xr;if(t.cameraAutoUpdate=!1,this._xrManager=t,this._touchInputHelper.xr=t,!this.domOverlay){const e=document.getElementById("tweakpaneUiContainer");this.domOverlay=e?{root:e}:void 0}if(e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return e.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then((e=>{if(!e)throw new Error("AR not supported")})).catch((n=>{e.console.error("AR not supported:",n),t.enabled=!1,this.enabled=!1})):(t.enabled=!1,this.enabled=!1)}_updateShadow(){var e,t;if(!this._viewer)return;const n=this._viewer.scene.modelRoot,i=null===(t=null===(e=this._viewer.getPluginByType("Ground"))||void 0===e?void 0:e.mesh)||void 0===t?void 0:t.modelObject;i&&(i.rotation.z=this._viewer.scene.modelRoot.rotation.y,i.position.copy(this._preXRState.groundOffset).multiplyScalar(n.modelObject.scale.x).sub(n.modelObject.position).negate(),i.scale.setScalar(n.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const t=e.getHitTestResults(this._hitTestSource);if(!t.length)return;const n=t[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const i=this._touchInputHelper.getHitPoint(n);if(!i)return;this._placementBox.show=!0;const r=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(i),r.position.copy(i),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var e,t;const i=this._viewer.scene.modelRoot,r=this._viewer.scene.activeCamera,s=null===(e=this._xrManager)||void 0===e?void 0:e.getCamera(),o=s.cameras[0]||s;this._removePlacementBox();const a=this._viewer.scene.getBounds(!0,!0);a.getSize(new n.Pa4).length()>.01&&(this._placementBox=new rC(a,s,this.placeOnWall),i.add(this._placementBox),this._placementBox.show=!1);const l=s.getWorldDirection(new n.Pa4);i.rotation.y=Math.atan2(-l.x,-l.z)-0,r.cameraObject.zoom=o.zoom,r.cameraObject.near=o.near,r.cameraObject.far=o.far,r.cameraObject.userData.autoNearFar=!1,r.cameraObject.isPerspectiveCamera?(r.cameraObject.fov=o.fov,r.cameraObject.aspect=o.viewport.width/o.viewport.height):console.warn("Perspective camera required."),r.cameraObject.updateProjectionMatrix();const c=i.userData.arScale||1;i.scale.set(c,c,c),i.position.copy(s.position).add(l.multiplyScalar(5)),i.visible=!0;const u=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Ground");(null==u?void 0:u.mesh)&&(u.shadowBaker.enabled=!1,u.renderToDepth=!1)}_restorePreXRState(){var e;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,cC.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,void 0!==this._preXRState.viewerBgColor&&(null===(e=this._viewer.scene.backgroundColor)||void 0===e||e.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const t=this._viewer.scene.modelRoot;t.scale.copy(this._preXRState.modelScale),t.position.copy(this._preXRState.modelPosition),t.quaternion.copy(this._preXRState.modelRotation),t.updateMatrix(),t.updateMatrixWorld(!0),t.visible=!0;const n=this._viewer.scene.activeCamera;n.position.copy(this._preXRState.cameraPosition),n.target.copy(this._preXRState.cameraTarget),n.cameraObject.up.copy(this._preXRState.cameraUp),n.cameraObject.near=this._preXRState.cameraNear,n.cameraObject.far=this._preXRState.cameraFar,n.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,n.cameraObject.isPerspectiveCamera&&(void 0!==this._preXRState.cameraFov&&(n.cameraObject.fov=this._preXRState.cameraFov),void 0!==this._preXRState.cameraAspect&&(n.cameraObject.aspect=this._preXRState.cameraAspect)),n.positionUpdated(!1),n.targetUpdated(!0),n.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectionMatrix),n.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectionMatrix).invert(),n.cameraObject.updateMatrixWorld(!0),n.cameraObject.updateProjectionMatrix();const i=this._viewer.getPluginByType("Ground");(null==i?void 0:i.mesh)&&(i.mesh.modelObject.position.subVectors(t.position,this._preXRState.groundOffset),i.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),i.mesh.modelObject.rotation.z=this._preXRState.groundRotation,i.renderToDepth=this._preXRState.groundRenderToDepth,i.shadowBaker.enabled=this._preXRState.groundShadowBaker,i.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};dC.PluginType="WEBXR_ARPlugin",uC([Oe("Light Estimate")],dC.prototype,"estimateLighting",void 0),uC([Oe("Place on Wall")],dC.prototype,"placeOnWall",void 0),uC([Ue("Resilution scale",[.1,1],.1)],dC.prototype,"xrResolutionScale",void 0),uC([je("Enter AR")],dC.prototype,"enterAR",void 0),uC([je("Exit AR")],dC.prototype,"exitAR",void 0),dC=cC=uC([We("WebXR AR")],dC);const hC=new ht({vertexShader:i.vertexShader,fragmentShader:`\n        ${gt}\n        \n        uniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tTransparentMap;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\n            float depth = getDepth(vUv);\n            vec4 texel;\n            if(depth>0.9999) {\n\t\t\t    texel = texture2D( tTransparentMap, vUv );\n                if(texel.a < 0.01) discard; // background\n                // transparent objects with render to depth = false\n            }else {\n                texel = texture2D( tDiffuse, vUv );\n\t\t\t}\n            gl_FragColor = texel;\n            \n\t\t}\n\t\t`,uniforms:{...i.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});hC.renderToScreen=!1,hC.useExistingRenderTarget=!0,hC.clear=!1;var pC,fC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let mC=pC=class extends _t{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[At],this.xrResolutionScale=1,this.toJSON=void 0,this.enterVR=()=>{var e;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already inVR"):this._xrManager?(this._xrManager.enabled=!0,null===(e=this._xrManager)||void 0===e||e.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitVR=()=>{this._xrSession&&this._xrSession.end()},this._currentCameraIndex=0,this._preRender=()=>{var e;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const t=this._xrManager.getCamera(),n=(null===(e=t.cameras)||void 0===e?void 0:e[this._currentCameraIndex])||t,i=this._viewer.scene.activeCamera;i.cameraObject.zoom=n.zoom,i.cameraObject.near=n.near,i.cameraObject.far=n.far,i.cameraObject.userData.autoNearFar=!1,i.cameraObject.isPerspectiveCamera?(i.cameraObject.fov=n.fov,i.cameraObject.aspect=n.viewport.width/n.viewport.height):console.warn("Perspective camera required."),i.cameraObject.position.copy(n.position),i.cameraObject.rotation.copy(n.rotation),i.cameraObject.updateMatrix(),i.cameraObject.updateProjectionMatrix(),i.cameraObject.projectionMatrix.copy(n.projectionMatrix),i.cameraObject.projectionMatrixInverse.copy(i.cameraObject.projectionMatrix).invert()},this._currentRt=null,this._postRender=()=>{var e,t,i,r;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,o=(s.rendererObject.getViewport(new n.Ltg),null!==(i=null===(t=null===(e=this._xrManager)||void 0===e?void 0:e.getCamera())||void 0===t?void 0:t.cameras)&&void 0!==i?i:[]),a=s.rendererObject.getRenderTarget(),l=null===(r=o[this._currentCameraIndex])||void 0===r?void 0:r.viewport;l?a&&s.rendererObject.setViewport(l):console.warn("no viewport for vr camera index",this._currentCameraIndex),this._viewer.getPlugin(At).updateShaderProperties(gC.material),gC.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,H(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},(()=>{gC.render(s.rendererObject,null,s.composer.readBuffer,0,!1)})),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0,a&&s.rendererObject.setViewport(a.viewport),this._currentCameraIndex++,this._currentCameraIndex>=o.length&&(this._currentCameraIndex=0)},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:e,deltaTime:t})=>{var n,i;if(this.dirty=!!e&&(null===(n=this._xrManager)||void 0===n?void 0:n.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,pC.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!e)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: VR session init"),this._frameCount++;const r=this._xrManager.getReferenceSpace(),s=e.getViewerPose(r);if(null==s&&this._frameCount,null==s||0===(null===(i=this._viewer)||void 0===i?void 0:i.scene.modelRoot.children.length))return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this._viewer.rendersPerFrame=s?s.views.length:1,this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new n.Pa4(1,1,1),modelPosition:new n.Pa4,modelRotation:new n._fP,cameraPosition:new n.Pa4(0,0,5),cameraTarget:new n.Pa4,cameraUp:new n.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new n.yGw,cameraAutoNearFar:void 0,groundOffset:new n.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new n.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var e;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=null===(e=this._viewer.scene.backgroundColor)||void 0===e?void 0:e.getHex();const t=this._viewer.scene.modelRoot,n=this._viewer.scene.activeCamera;t.updateMatrix(),t.updateMatrixWorld(!0),this._preXRState.modelScale.copy(t.scale),this._preXRState.modelPosition.copy(t.position),this._preXRState.modelRotation.copy(t.quaternion),this._preXRState.cameraPosition.copy(n.position),this._preXRState.cameraTarget.copy(n.target),this._preXRState.cameraUp.copy(n.cameraObject.up),n.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=n.cameraObject.fov,this._preXRState.cameraAspect=n.cameraObject.aspect),this._preXRState.cameraZoom=n.cameraObject.zoom,this._preXRState.cameraNear=n.cameraObject.near,this._preXRState.cameraFar=n.cameraObject.far,this._preXRState.cameraAutoNearFar=n.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(n.cameraObject.projectionMatrix);const i=this._viewer.getPluginByType("Ground");(null==i?void 0:i.mesh)&&(this._preXRState.groundOffset.subVectors(t.position,i.mesh.modelObject.position),this._preXRState.groundScale=i.mesh.modelObject.scale.x,this._preXRState.groundRotation=i.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=i.renderToDepth,this._preXRState.groundShadowBaker=i.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.environment),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{this._xrSession&&this._viewer&&(console.log("webxr: VR session start"),Math.PI,this._viewer.renderer.stableNoise=!0,this._viewer.resize())},this._xrRenderingEnd=()=>{console.log("webxr: VR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async e=>{e.addEventListener("end",this._onSessionEnded),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(e),this._xrSession=e},this._onSessionEnded=()=>{this._xrSession&&this._xrSession.removeEventListener("end",this._onSessionEnded)}}async onAdded(e){await super.onAdded(e);const t=e.renderer.rendererObject.xr;if(t.cameraAutoUpdate=!1,this._xrManager=t,!this.domOverlay){const e=document.getElementById("tweakpaneUiContainer");this.domOverlay=e?{root:e}:void 0}if(e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return e.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-vr").then((e=>{if(!e)throw new Error("VR not supported")})).catch((n=>{e.console.error("VR not supported:",n),t.enabled=!1,this.enabled=!1})):(t.enabled=!1,this.enabled=!1)}_updateShadow(){var e,t;if(!this._viewer)return;const n=this._viewer.scene.modelRoot,i=null===(t=null===(e=this._viewer.getPluginByType("Ground"))||void 0===e?void 0:e.mesh)||void 0===t?void 0:t.modelObject;i&&(i.rotation.z=this._viewer.scene.modelRoot.rotation.y,i.position.copy(this._preXRState.groundOffset).multiplyScalar(n.modelObject.scale.x).sub(n.modelObject.position).negate(),i.scale.setScalar(n.modelObject.scale.x*this._preXRState.groundScale))}_preSetupModel(){var e;const t=this._viewer.scene.modelRoot,n=t.userData.arScale||1;t.scale.set(n,n,n),t.visible=!0;const i=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("Ground");(null==i?void 0:i.mesh)&&(i.shadowBaker.enabled=!1,i.renderToDepth=!1)}_restorePreXRState(){var e;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,pC.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,void 0!==this._preXRState.viewerBgColor&&(null===(e=this._viewer.scene.backgroundColor)||void 0===e||e.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const t=this._viewer.scene.modelRoot;t.scale.copy(this._preXRState.modelScale),t.position.copy(this._preXRState.modelPosition),t.quaternion.copy(this._preXRState.modelRotation),t.updateMatrix(),t.updateMatrixWorld(!0),t.visible=!0;const n=this._viewer.scene.activeCamera;n.position.copy(this._preXRState.cameraPosition),n.target.copy(this._preXRState.cameraTarget),n.cameraObject.up.copy(this._preXRState.cameraUp),n.cameraObject.near=this._preXRState.cameraNear,n.cameraObject.far=this._preXRState.cameraFar,n.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,n.cameraObject.isPerspectiveCamera&&(void 0!==this._preXRState.cameraFov&&(n.cameraObject.fov=this._preXRState.cameraFov),void 0!==this._preXRState.cameraAspect&&(n.cameraObject.aspect=this._preXRState.cameraAspect)),n.positionUpdated(!1),n.targetUpdated(!0),n.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),n.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),n.cameraObject.updateMatrixWorld(!0),n.cameraObject.updateProjectionMatrix();const i=this._viewer.getPluginByType("Ground");(null==i?void 0:i.mesh)&&(i.mesh.modelObject.position.subVectors(t.position,this._preXRState.groundOffset),i.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),i.mesh.modelObject.rotation.z=this._preXRState.groundRotation,i.renderToDepth=this._preXRState.groundRenderToDepth,i.shadowBaker.enabled=this._preXRState.groundShadowBaker,i.refreshTransform()),this._viewer.scene.environment=this._preXRState.environment,this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){}};mC.PluginType="WEBXR_VRPluginBasic",fC([Ue("Resolution scale",[.1,1],.1)],mC.prototype,"xrResolutionScale",void 0),fC([je("Enter VR")],mC.prototype,"enterVR",void 0),fC([je("Exit VR")],mC.prototype,"exitVR",void 0),mC=pC=fC([We("WebXR VR")],mC);const gC=new ht({vertexShader:i.vertexShader,fragmentShader:`\n        ${gt}\n        \n        uniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tTransparentMap;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\n            float depth = getDepth(vUv);\n            vec4 texel;\n            if(depth>0.9999) {\n\t\t\t    texel = texture2D( tTransparentMap, vUv );\n                if(texel.a < 0.01) discard; // background\n                // transparent objects with render to depth = false\n            }else {\n                texel = texture2D( tDiffuse, vUv );\n\t\t\t}\n            gl_FragColor = texel;\n            \n\t\t}\n\t\t`,uniforms:{...i.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});gC.renderToScreen=!1,gC.useExistingRenderTarget=!0,gC.clear=!1;class _C extends t.SimpleEventDispatcher{get state(){return this._state}setState(e,t){this._state=e,this.dispatchEvent({type:e,...t})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=e=>{e.data&&e.data.size>0&&this._currentRecording.push(e.data)},this._canvas=e,null==t||t.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(t||this.options)}isRecording(){return"recording"===this._state}requestFrame(){return"recording"===this._state&&(this._frameCount++,!0)}dispose(){(this.isRecording()||"paused"===this._state)&&this.stop((e=>{this._console.warn("disposed with blob",e),this.dispose()}))}}class vC extends _C{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if("recording"!==this.state){if("error"===this.state&&this._console.warn("Resetting from error state."),"paused"===this.state)return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then((async e=>{const t=await(null==e?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._frameCount=0,this.setState("recording")})).catch((e=>{this._onerror({detail:e})}))}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob((t=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t])}),e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){"paused"!==this.state&&"stopped"!==this.state&&this.setState("paused")}stop(e){"stopped"!==this.state&&("error"!==this.state?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const n=[];for(const i of e){const e=await this._imgDirectory.getFileHandle(i[0],{create:!0});n.push((0,t.writeFile)(e,i[1]))}await Promise.all(n)}}class yC extends _C{_setOptions(e){var t,n;super._setOptions(e),this.options.mimeType&&"auto"!==this.options.mimeType||(this.options.mimeType=null!==(t=yC.GetSupportedMimeTypes([],["h264"],!0))&&void 0!==t?t:yC.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!(null===(n=this.options.mimeType)||void 0===n?void 0:n.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,n){super(e,n),this._resumeSyncTime=0,this._onstop=e=>{var t;if(this._recorder&&this._currentRecording.length>0){const e=new Blob(this._currentRecording,{type:this.options.mimeType});null===(t=this._recordingCallback)||void 0===t||t.call(this,e)}this._recorder=void 0,this.setState("stopped")},this._onstart=e=>{var t;this._frameCount=0,this.options.stepMode&&(null===(t=this._recorder)||void 0===t||t.pause()),this.setState("recording")},this._onresume=e=>{if("paused"!==this.state&&"starting"!==this.state&&"stopped"!==this.state||this.setState("recording"),!this.options.stepMode)return;const n=()=>{var e;"recording"===this.state&&(null===(e=this._recorder)||void 0===e||e.pause())},i=Math.min(this._resumeSyncTime-(0,t.now)(),0)+1e3/this.options.frameRate;i>0?(0,t.timeout)(i).then(n):n()},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e),this._recorder=void 0}}start(){var e,t,n;if("recording"===this.state)return void this._console.log("Already recording canvas");if("error"===this.state&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return"paused"===this.state?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const i={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,null===(e=i.mimeType)||void 0===e?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const e=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),n=null===(t=e.getVideoTracks())||void 0===t?void 0:t[0];this._track=n,this._recorder=new window.MediaRecorder(e,i),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&(null===(n=this._recorder)||void 0===n||n.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,t.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){"paused"!==this.state&&"stopped"!==this.state&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){"stopped"!==this.state&&("error"!==this.state?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter((t=>!e||e.length<1||e.includes(t))),r=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter((e=>!t||t.length<1||t.includes(e))),s=[];return i.forEach((e=>{const t=`video/${e}`;r.forEach((e=>{[`${t};codecs=${e}`,`${t};codecs:${e}`,`${t};codecs=${e.toUpperCase()}`,`${t};codecs:${e.toUpperCase()}`,`${t}`].forEach((e=>{MediaRecorder.isTypeSupported(e)&&s.push(e)}))}))})),n?s.length>0?s[0]:void 0:s}}class bC extends _C{constructor(e,n){super(e,n),this._workerRunning=!1,this.worker=new Worker((0,t.remoteWorkerURL)(bC.LIBRARY_PATH+"ffmpeg-worker-mp4.js",bC.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm"));let i=0;this.worker.onmessage=e=>{var t;const n=e.data;switch(n.type){case"stdout":case"stderr":if(0===n.data.indexOf("frame=")){const e=parseInt(n.data.split("frame=")[1].split("fps")[0].trim()),t=this._frameCount,i=Math.round(e/t*100);this.dispatchEvent({type:"encode-progress",progress:i,frame:e,totalFrames:t})}console.log(n.data+"\n");break;case"exit":console.log("Process exited with code "+n.data),i=parseInt(n.data);break;case"done":if(void 0===n.data.MEMFS[0].data)return void console.log("video processing failed");this._workerRunning=!1,null===(t=this._recordingCallback)||void 0===t||t.call(this,new Blob([n.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){"recording"!==this.state?("error"===this.state&&console.warn("Resetting from error state."),"paused"!==this.state&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){"stopped"!==this.state&&("error"!==this.state?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const t=this.options.frameRate.toString(),n=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",t,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",n,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob((t=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:t}})}),"image/jpeg",90)}pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}pause(){"paused"!==this.state&&"stopped"!==this.state&&this.setState("paused")}}bC.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var AC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class wC extends _t{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!0,this.mimeType="video/mp4",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,n;if(this.convergeMode&&(null===(e=this._recorder)||void 0===e?void 0:e.isRecording())){const e=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=(null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Progressive"))||void 0===n?void 0:n.isConverged())||!1,e&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,n,i;if((null===(e=this._recorder)||void 0===e?void 0:e.isRecording())&&(!this.convergeMode||(null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("Progressive"))||void 0===i?void 0:i.isConverged(!0)))){const e=()=>{var e;return null===(e=this._recorder)||void 0===e?void 0:e.requestFrame()};if(this.convergeMode){const n=1;(0,t.timeout)(n).then(e)}else e()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;null===(e=this.uiConfig.children)||void 0===e||e.map((e=>(0,t.getOrCall)(e))).flat(2).forEach((e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e)}))},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map((e=>({label:e[0],value:e[1]})))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e,t;return null!==(t=null===(e=this.recorder)||void 0===e?void 0:e.state)&&void 0!==t?t:"not initialized"}},{type:"button",label:()=>{var e;return(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())?"Stop Recording":"Start Recording"},value:()=>{var e;(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())?this.stopRecording().then((async e=>{if(e){const t=e.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(e,t)}})):this.startRecording()}},{type:"button",label:"Record Camera Views",hidden:()=>{var e,t;return!!(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())||!(null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("CameraViews"))},value:()=>{var e,t;null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("CameraViews"))||void 0===t||t.recordAllViews()}},{type:"button",label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,t,n,i;return!!(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())||!(null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("CameraViews"))||!(null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("GLTFAnimation"))||void 0===i?void 0:i.animations.length)},value:()=>{var e,t,n,i;const r="playing"===(null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("GLTFAnimation"))||void 0===t?void 0:t.animationState);null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("CameraViews"))||void 0===i||i.recordAllViews((()=>{var e,t;null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("GLTFAnimation"))||void 0===t||t.playAnimation()})).then((()=>{var e,t;r||null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("GLTFAnimation"))||void 0===t||t.stopAnimation()}))}},{type:"button",label:"Record GLTF Anim",hidden:()=>{var e,t,n;return!!(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())||!(null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("GLTFAnimation"))||void 0===n?void 0:n.animations.length)},value:async()=>{var e,t;if(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())return;const n=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("GLTFAnimation");if(!n)return;let i=!1;n.loopAnimations&&(i=!0),i&&(n.loopAnimations=!1);const r=await this.record((async()=>n.playAnimation()));if(i&&(n.loopAnimations=!0),r){const e=r.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(r,e)}}},{type:"button",label:"Record 360 animation",hidden:()=>{var e;return!!(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())},value:async()=>this.download360Recording(null,!1)},{type:"button",label:"Record 360 animation (CCW)",hidden:()=>{var e;return!!(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())},value:async()=>this.download360Recording(null,!0)}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e,t;return null!==(t=null===(e=this._recorder)||void 0===e?void 0:e.isRecording())&&void 0!==t&&t}refreshRecorderOptions(){if(!this._viewer)return;let e="image";"video/mp4"===this.mimeType?e="ffmpeg.js":"auto"===this.mimeType?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var t;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",null===(t=e.canvas.parentElement)||void 0===t||t.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var n,i;this.dirty=e,null===(n=this._viewer)||void 0===n||n.setDirty(),null===(i=this.uiConfig.children)||void 0===i||i.map((e=>(0,t.getOrCall)(e))).flat(2).forEach((e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e)}))}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),null===(t=this._recorder)||void 0===t||t.dispose(),Object.values(this._recorders).forEach((e=>{null==e||e.dispose()})),super.onRemove(e)}async record(e,t){var n,i;if(!this.enabled)return;if(null===(n=this._recorder)||void 0===n?void 0:n.isRecording())return;const r=null===(i=this._viewer)||void 0===i?void 0:i.getPluginByType("Progressive"),s=null==r?void 0:r.maxFrameCount;r&&this.convergeMode&&(r.maxFrameCount=Math.min(16,null!=s?s:16)),await new Promise(((n,i)=>{const r=()=>{this.removeEventListener("start",s),this.removeEventListener("stop",r),this.removeEventListener("error",o)},s=async()=>{r(),null==t||t(),await e(),n()},o=async()=>{r(),i()};this.addEventListener("start",s),this.addEventListener("stop",r),this.addEventListener("error",o),this.startRecording()}));const o=await this.stopRecording();return r&&this.convergeMode&&(r.maxFrameCount=null!=s?s:16),o}startRecording(){var e;return!!this.enabled&&!1===(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())return new Promise(((e,t)=>{var n;return null===(n=this.recorder)||void 0===n?void 0:n.stop(e)}))}async _downloadBlob(e,t){var n,i,r;const s=await(null===(n=this._viewer)||void 0===n?void 0:n.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),o=null===(i=this._viewer)||void 0===i?void 0:i.getPluginByType("FileTransferPlugin");o?await o.exportFile(e,s||"recording.mp4"):null===(r=this._viewer)||void 0===r||r.console.error("FileTransferPlugin required to export/download file")}async download360Recording(e=null,t=!1){var n;if(null===(n=this.recorder)||void 0===n?void 0:n.isRecording())return;if(!this._viewer)return;const i=e||await this._viewer.prompt("Enter duration in seconds","5",!0);if(null===i)return;const r=parseFloat(i||"5");if(!isFinite(r)||r<=0)return;const s=await this.recordCamera360(r,t);if(s){const e=s.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(s,e)}}async recordCamera360(e,t=!1){var i;if(null===(i=this.recorder)||void 0===i?void 0:i.isRecording())return;if(!this._viewer)return;const r=this._viewer.scene.activeCamera;let s=r.interactionsEnabled,o=0;for(;!(s||(this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),o%30==0&&this._viewer.console.warn("CanvasRecorderPlugin: interactions are already disabled by something, waiting..."),s=r.interactionsEnabled,o>5e3/30));)o++;r.setInteractions(!1,wC.PluginType);const a=r.target.clone(),l=r.position.clone().sub(a),c=await this._viewer.getPluginByType("PopmotionPlugin");if(!c)return void console.error("Popmotion plugin not found");const u=(new n.$V).setFromVector3(l);r.position.setFromSpherical(u).add(a),r.positionUpdated(!0);const d=r.autoLookAtTarget;r.autoLookAtTarget=!0;const h=await this.record((async()=>c.animate({from:u.theta,to:u.theta+2*Math.PI*(t?-1:1),duration:1e3*e,ease:kd.linear,onUpdate:e=>{u.theta=e,r.position.setFromSpherical(u).add(a),r.positionUpdated(!0)}}).promise));return r.autoLookAtTarget=d,r.position.copy(l).add(a),r.positionUpdated(!0),r.setInteractions(!0,wC.PluginType),h}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let t;return t="canvas-media"===e?new yC(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):"ffmpeg.js"===e?new bC(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new vC(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),t.addEventListener("starting",(()=>this._stateChange(!1))),t.addEventListener("recording",(()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)})),t.addEventListener("error",(()=>{this.dispatchEvent({type:"error"})})),t.addEventListener("paused",(()=>this._stateChange(!1))),t.addEventListener("stopped",(()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)})),t.addEventListener("encode-progress",(e=>{this.dispatchEvent({...e})})),this._recorders[e]=t,t}}wC.PluginType="CanvasRecorder",AC([(0,t.onChange)(wC.prototype.refreshRecorderOptions),re()],wC.prototype,"convergeMode",void 0),AC([(0,t.onChange)(wC.prototype.refreshRecorderOptions),re()],wC.prototype,"mimeType",void 0),AC([(0,t.onChange)(wC.prototype.refreshRecorderOptions),re()],wC.prototype,"videoFrameRate",void 0);var xC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const EC=new n.jyz({name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"});EC.depthTest=!1;const CC=new n.jyz({name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"});CC.depthTest=!1;class SC extends j_{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new n.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(bp)}async onAdded(e){const t=e.renderer.createTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:n.wem,magFilter:n.wem});t.texture.name="groundContactDepthTexture";const i=new n.lRF({depthPacking:n.z81});i.onBeforeCompile=function(e){e.uniforms.opacity.value=1,e.fragmentShader=`\n\t\t\t\t\t\t${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}\n\t\t\t\t\t`};const r=new bt(t,i,new n.Ilk(0,0,0),0);this._depthPass=r,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer)return;if(!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:n.wem,magFilter:n.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(EC.uniforms.h.value=t*this.blurAmount/256,CC.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:EC,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:CC,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){var t,n,i;const r=null===(t=this._depthPass)||void 0===t?void 0:t.target;return r&&(null===(n=this._viewer)||void 0===n||n.renderer.disposeTarget(r)),null===(i=this._depthPass)||void 0===i||i.dispose(),this._depthPass=void 0,super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new n.Pa4)),this.shadowCamera.setRotationFromEuler(new n.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const t=super._refreshMaterial();return this._material?(this._material.alphaMap=(null===(e=this._depthPass)||void 0===e?void 0:e.target.texture)||null,t&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1),t):t}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function MC(e,t,i,r){e.traverse((e=>{e&&(e.userData.cloneRotI=t,e.userData.rotationCount=i,e.userData.rotationAxis=r,e.addEventListener("beforeRender",(t=>function(e,t){var i;t&&(null===(i=t.map)||void 0===i?void 0:i.isTexture)&&(t.extraUniformsToUpload||(t.extraUniformsToUpload={}),t.extraUniformsToUpload.uvTransform||(t.extraUniformsToUpload.uvTransform={value:new n.Vkp}),t.extraUniformsToUpload.uvTransform.value.setUvTransform(t.map.offset.x*t.map.repeat.x*e.userData.cloneRotI/(e.userData.rotationCount||1),t.map.offset.y*t.map.repeat.y*e.userData.cloneRotI/(e.userData.rotationCount||1),t.map.repeat.x,t.map.repeat.y,t.map.rotation,t.map.center.x,t.map.center.y))}(e,t.material))))}))}function TC(e,t,n,i="x"){var r;if(e.userData.rotationCount>1&&!e.userData.rotationRoot)return e;const s=e.parent;if(!s)throw new Error("No parent");if(e.userData.cloneParent){const t=e.userData.cloneParent;if(!(e=s.children.find((e=>t===e.uuid))))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",t,s),e}let o=s.children.filter((t=>{var n;return(null===(n=t.userData)||void 0===n?void 0:n.cloneParent)===e.uuid})).sort(((e,t)=>e.userData.cloneRotI-t.userData.cloneRotI));if(e.userData.rotationCount===t&&t===o.length&&void 0===n&&e.userData.rotationAxis===i)return e;if(null==n&&(n=null!==(r=e.userData.rotationSkips)&&void 0!==r?r:[]),n!==e.userData.rotationSkips&&(e.userData.rotationSkips=[...n]),MC(e,0,t,i),e.userData.rotationRoot=!0,e.visible=!0,t<=o.length){for(let e=t-1;e<o.length;e++)s.remove(o[e]),o[e].traverse((e=>e.userData={__disposed:!0}));o=o.slice(0,t)}for(let a=1;a<t;a++){const r=a<=o.length?o[a-1]:e.clone();r.rotation.copy(e.rotation),r.rotation[i]+=a/t*Math.PI*2,MC(r,a,t,i),a>o.length&&s.add(r),r.visible=!n.includes(a)}return e.visible=!n.includes(0),e}SC.PluginType="ContactShadowGroundPlugin",xC([(0,t.onChange)(SC.prototype.refreshOptions),re()],SC.prototype,"contactShadows",void 0),xC([re(),(0,t.onChange)(SC.prototype._setDirty)],SC.prototype,"blurAmount",void 0),xC([re(),(0,t.onChange)(SC.prototype._refreshShadowCameraFrustum)],SC.prototype,"shadowScale",void 0),xC([re(),(0,t.onChange)(SC.prototype._refreshShadowCameraFrustum)],SC.prototype,"shadowHeight",void 0);var IC,PC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let RC=IC=class extends _t{async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPluginByType("Picking"))||void 0===t||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(e=!0){super(),this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.enabled=e}_selectedObjectChanged(){var e,t,n,i,r,s,o,a,l;if(!this.enabled)return;const c=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("Picking"))||void 0===t?void 0:t.getSelectedObject();if(!c)return void(null===(i=(n=this.uiConfig).uiRefresh)||void 0===i||i.call(n,"postFrame",!0));const u=c.userData.rotationRoot&&null!==(r=c.userData.rotationCount)&&void 0!==r?r:1;this.rotations=u,this.skips=null!==(o=null===(s=c.userData.rotationSkips)||void 0===s?void 0:s.join(","))&&void 0!==o?o:"",this.axis=c.userData.rotationAxis||"x",null===(l=(a=this.uiConfig).uiRefresh)||void 0===l||l.call(a,"postFrame",!0)}_paramsChanged(){var e,t,i,r,s,o;if(!this.enabled)return;const a=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("Picking"))||void 0===t?void 0:t.getSelectedObject();if(a){if(this.rotations>1||a.userData.rotationCount){const e=a.userData.rotationCount,t=TC(a,this.rotations,this.skips.split(",").map((e=>parseInt(e))).filter((e=>isFinite(e))),this.axis),o=null==t?void 0:t.userData.rotationCount;if(o&&o!==e){const e=[];null==t||t.traverseAncestors((t=>{e.push(t)}));for(const t of e)if(t.userData.autoScaled){W(t),null===(i=this._viewer)||void 0===i||i.resetCamera({rootObject:t,centerOffset:new n.Pa4(4,4,4)});break}}a.parent&&!a.userData.__disposed||null===(s=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("Picking"))||void 0===s||s.setSelectedObject(t,!0)}null===(o=this._viewer)||void 0===o||o.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};RC.PluginType="ObjectRotationPlugin",PC([re(),Oe("Enabled"),(0,t.onChange)(IC.prototype._paramsChanged)],RC.prototype,"enabled",void 0),PC([Ue("Rotation Count",[1,100],1,(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("Picking"))||void 0===n?void 0:n.getSelectedObject())||!e.rotations}}))),(0,t.onChange)(IC.prototype._paramsChanged)],RC.prototype,"rotations",void 0),PC([Fe("Axis",["x","y","z"].map((e=>({label:e}))),(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("Picking"))||void 0===n?void 0:n.getSelectedObject())||!e.rotations}}))),(0,t.onChange)(IC.prototype._paramsChanged)],RC.prototype,"axis",void 0),PC([ze("Rotation Skips",(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("Picking"))||void 0===n?void 0:n.getSelectedObject())||!e.rotations}}))),(0,t.onChange)(IC.prototype._paramsChanged)],RC.prototype,"skips",void 0),RC=IC=PC([We("Object Rotations")],RC);var DC,kC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let BC=DC=class extends _t{constructor(e=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,i)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <map_fragment>");for(const t of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=ot(e.fragmentShader,`#include <${t}>`,n.WdD[t].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=ot(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=ot(e.fragmentShader,"#include <normal_fragment_maps>",ot(ot(n.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?"#ifdef USE_BUMPMAP\nmat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){\n#if defined( TANGENTSPACE_NORMALMAP ) && 0 \nvec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);\n#else\nvec2 texOffs=1./bumpMapSize;\n#if PARALLAX_NORMAL_MAP_QUALITY > 0\nfloat hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);\n#else\nfloat h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);\n#endif\nreturn normalize(vec3(deltaH/texOffs,1.));\n#endif\n}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}\n#pragma unroll_loop_end\nbestBumpHeight+=bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}\n#pragma unroll_loop_end\nbestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);\n#ifdef FLIP_SIDED\nnormal=-normal;\n#endif\nreturn parallaxUv;}\n#endif \n\n".replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+(null===(t=e.materialObject.bumpMap)||void 0===t?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},n)=>{if(this.enabled)for(const[i,r]of Object.entries(this._defines)){const e="number"==typeof r?r:r?1:0;t.defines[i]!==e&&(t.defines[i]=e,t.needsUpdate=!0)}}},this.dependencies=[Ls],this.enabled=e,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var e,t,n;null===(t=null===(e=this._bumpMapExtension)||void 0===e?void 0:e.setDirty)||void 0===t||t.call(e),null===(n=this._viewer)||void 0===n||n.setDirty()}async onAdded(e){var t,n;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.registerMaterialExtension(this._bumpMapExtension),super.onAdded(e)}async onRemove(e){var t,n;return null===(n=null===(t=e.getPlugin(Ls))||void 0===t?void 0:t.materials)||void 0===n||n.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(e)}};BC.PluginType="ReliefParallaxMapping",kC([(0,t.onChange)(DC.prototype._updateExtension),re(),Oe("Enabled")],BC.prototype,"enabled",void 0),kC([(0,t.onChange)(DC.prototype._updateExtension),Oe("Debug Normals")],BC.prototype,"debugNormals",void 0),kC([(0,t.onChange)(DC.prototype._updateExtension),Oe("Debug Hit Height")],BC.prototype,"debugHitHeight",void 0),kC([z("PARALLAX_MAP_STEPS",void 0,!0,DC.prototype._updateExtension),Ue("Step count",[1,32],1),re()],BC.prototype,"stepCount",void 0),kC([z("PARALLAX_MAP_B_STEPS",void 0,!0,DC.prototype._updateExtension),Ue("Binary search steps",[1,8],1),re()],BC.prototype,"binaryStepCount",void 0),BC=DC=kC([We("Parallax Mapping")],BC);class OC extends n.u9r{constructor(e,t,i=32,r=64,s=!1,o=new n.FM8(1,1),a="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:i,tubularSegments:r,closed:s,primary:a,shapeScale:o.clone()};const l=t.computeFrenetFrames(r,s);this.frames=l;const c=new n.Pa4,u=new n.Pa4,d=new n.Pa4,h=new n.FM8;let p=new n.Pa4;const f=[],m=[],g=[],_=e.getSpacedPoints(i);for(const n of _)n.multiply(o);!function(){for(let e=0;e<r;e++)y(e);y(!1===s?r:0),function(){for(let e=0;e<=r;e++)for(let t=0;t<=i;t++)h.x=e/r,h.y=t/i,m.push(h.x,h.y)}(),function(){const e="shape"===a,t=e?i:r,n=e?r:i;for(let r=1;r<=t;r++)for(let t=1;t<=n;t++){const[n,s]=e?[t,r]:[r,t],o=(i+1)*(n-1)+(s-1),a=(i+1)*n+(s-1),l=(i+1)*n+s,c=(i+1)*(n-1)+s;g.push(o,a,c),g.push(a,l,c)}}()}(),this.setIndex(g),this.setAttribute("position",new n.a$l(f,3)),this.setAttribute("uv",new n.a$l(m,2)),this.computeVertexNormals();const v=this.attributes.normal;function y(e){p=t.getPointAt(e/r,p);const n=l.normals[e],s=l.binormals[e];for(let t=0;t<=i;t++){const e=_[t%i];u.set(0,0,0).addScaledVector(n,e.x).addScaledVector(s,e.y),c.copy(p).add(u),f.push(c.x,c.y,c.z)}}!function(){for(let t=1;t<i;t++){const e=t+r*(i+1);u.fromBufferAttribute(v,t),d.fromBufferAttribute(v,e),u.add(d).normalize(),v.setXYZ(t,u.x,u.y,u.z),v.setXYZ(e,u.x,u.y,u.z)}for(let t=1;t<r;t++){const e=t*(i+1),n=e+i;u.fromBufferAttribute(v,e),d.fromBufferAttribute(v,n),u.add(d).normalize(),v.setXYZ(e,u.x,u.y,u.z),v.setXYZ(n,u.x,u.y,u.z)}u.fromBufferAttribute(v,0),d.fromBufferAttribute(v,i),u.add(d);const e=r*(i+1);d.fromBufferAttribute(v,e),u.add(d),d.fromBufferAttribute(v,e+i),u.add(d),u.normalize(),v.setXYZ(0,u.x,u.y,u.z),v.setXYZ(i,u.x,u.y,u.z),v.setXYZ(e,u.x,u.y,u.z),v.setXYZ(e+i,u.x,u.y,u.z),v.needsUpdate=!0}()}createSplits(e){this.clearGroups();const t="shape"===this.parameters.primary?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,i=[...e,1].sort(((e,t)=>e-t));let r=0,s=0;for(const o of i){const e=Math.round(t*o)*n/t;this.addGroup(r,e-r,s++),r=e}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var LC,UC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let NC=LC=class extends _t{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new n.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var e,t;const n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();if(!n)return;let i=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!i)return;i=parseFloat(i);const r=new FC(0,0,i,i,0,2*Math.PI,!0,0);await this.extrudeObject(n,r)}}async onAdded(e){await super.onAdded(e)}static CreateCurve(e,t){var n,i;if("circle"===e)return new FC(0,0,null!==(n=t.radius)&&void 0!==n?n:1,null!==(i=t.radius)&&void 0!==i?i:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(e,t,i=this.shapeSegments,r=this.tubularSegments,s=this.shapeScale,o=this.materialSplits.split(",").map((e=>parseFloat(e.trim()))),a=this.horizontalSplits){var l,c,u,d,h,p,f,m;if(e.userData.isExtrudedTube,e.userData._extrudeSource){const t=e.userData._extrudeSource;if(e=null===(l=e.parent)||void 0===l?void 0:l.children.find((e=>t===e.uuid)),!e)return void console.warn("Could not find extrude source with uuid",t)}if(e.userData.extrudedObject){const t=e.userData.extrudedObject,n=null===(c=e.parent)||void 0===c?void 0:c.children.find((e=>t===e.uuid));n&&(n.removeFromParent(),n.geometry.dispose(),n.geometry=null,n.material=null),delete e.userData.extrudedObject}const g=e.geometry;if(!g)return void(null===(u=this._viewer)||void 0===u||u.alert("Extrude: No geometry to extrude"));const _=[e.material];let v;try{const e=LC.ConvertGeometryToFlatShape(g);v=new OC(e,t,i,r,!0,s,a?"shape":"path"),v.computeBoundingBox(),v.createSplits(o)}catch(e){return void(null===(d=this._viewer)||void 0===d||d.alert("string"==typeof e?e:null==e?void 0:e.message))}_[0].color.set(16777215);for(let n=_.length;n<v.groups.length;n++){const e=_[0].clone();_.push(e),e.color.set(16777215*Math.random())}const y=new n.Kj0(v,_);y.userData._extrudeSource=e.uuid,y.userData.isExtrudedTube=!0,e.visible=!1,e.userData.bboxVisible=!1,y.name=e.name+"_extruded";const b=await(null===(f=null===(p=null===(h=this._viewer)||void 0===h?void 0:h.getManager())||void 0===p?void 0:p.importer)||void 0===f?void 0:f.processImportedSingle(y,{autoCenter:!1,autoScale:!1}));b&&(null===(m=e.parent)||void 0===m||m.add(b.modelObject),e.userData.extrudedObject=b.modelObject.uuid,b.dispatchEvent({type:"select",ui:!0,value:b}))}static ExtrudeShape(e,t,i,r,s,o,a,l){const c=new OC(e,r,t,i,!0,new n.FM8(s,o),l?"shape":"path");c.computeBoundingBox(),c.createSplits(a);const u=new n.Kj0(c,[]);return u.userData.isExtrudedTube=!0,u}static ConvertGeometryToFlatShape(e,t=!0){if(e.userData.__planarShape)return e.userData.__planarShape;let i=e.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const r=e;i=r.attributes.position,r.boundingBox||r.computeBoundingBox();const s=r.boundingBox.getSize(new n.Pa4),o=s.x<.001?"x":s.y<.001?"y":s.z<.001?"z":null;if(!o)throw"geometry is not axis aligned not planar";let a=[];for(let c=0;c<i.count;c++){const e=new n.FM8;"x"===o?e.set(i.getY(c),i.getZ(c)):"y"===o?e.set(i.getX(c),i.getZ(c)):e.set(i.getX(c),i.getY(c)),a.push(e)}if(t){let e=0;for(let t=0;t<a.length;t++)(a[t].x<a[e].x||a[t].x===a[e].x&&a[t].y<a[e].y)&&(e=t);0!==e&&(a=a.slice(e).concat(a.slice(0,e)))}const l=new n.bnF(a);return e.userData.__planarShape=l,l}};NC.PluginType="ShapeTubeExtrudePlugin",UC([Oe("Enabled")],NC.prototype,"enabled",void 0),UC([Ue("Shape Segments (X)",[1,100],1,(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject())}})))],NC.prototype,"shapeSegments",void 0),UC([Ue("Tube Segments (Y)",[1,100],1,(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject())}})))],NC.prototype,"tubularSegments",void 0),UC([Ne("Shape scale",[.01,10],.01,(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject())}})))],NC.prototype,"shapeScale",void 0),UC([ze("Material Splits",(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject())}})))],NC.prototype,"materialSplits",void 0),UC([Oe("Horizontal Splits",(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject())}})))],NC.prototype,"horizontalSplits",void 0),UC([je("Extrude Circle Tube",(e=>({hidden:()=>{var t,n;return!(null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject())}})))],NC.prototype,"extrudeCirceTube",void 0),NC=LC=UC([We("Extrude Tube Shapes")],NC);class FC extends n.Ny0{getPoint(e,t){return super.getPoint(e,t||new n.Pa4)}}class jC extends _t{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var e,n;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&(null===(e=this._viewer.getPluginByType("FrameFade"))||void 0===e||e.enable(jC.PluginType),this._fadeDisabled=!1));const i=(0,t.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=i-1/60);let r=i-this._lastFrameTime;this._lastFrameTime=i;const s=null===(n=this._viewer.getPluginByType("Progressive"))||void 0===n?void 0:n.postFrameConvergedRecordingDelta();if(s&&s>0&&(r=s),0!==s&&(r*=1e3,!(r<=.001)&&(this._updaters.forEach((e=>{let t=r;e.time+t<0&&(t=-e.time),e.time+=t,Math.abs(t)>.001&&e.u(t)})),!this._fadeDisabled&&this.disableFrameFade))){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(jC.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex((t=>t.u===e)),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=De(),n={id:t,options:e,stop:()=>{var e,n,i;(null===(e=this.animations[t])||void 0===e?void 0:e._stop)?null===(i=null===(n=this.animations[t])||void 0===n?void 0:n._stop)||void 0===i||i.call(n):console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise(((n,i)=>{const r={driver:this.defaultDriver,...e,onComplete:()=>{var t;try{null===(t=e.onComplete)||void 0===t||t.call(e)}catch(e){return void i(e)}n()},onStop:()=>{var t;try{null===(t=e.onStop)||void 0===t||t.call(e)}catch(e){return void i(e)}n()}},s=Dd(r);this.animations[t]._stop=s.stop,this.animations[t].options=r})).then((()=>(delete this.animations[t],t))),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}jC.PluginType="PopmotionPlugin";var zC,GC,VC=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const HC=e=>({onChange:t=>{t.last&&e.onChange()}});let QC=zC=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(e){Object.assign(this,e)}reset(){const e=this.onChange;Object.assign(this,new zC),this.onChange=e}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};VC([ze("Text",HC)],QC.prototype,"text",void 0),VC([Ue("Font Size",[2,400],1,HC)],QC.prototype,"fontSize",void 0),VC([Ue("Width",[2,4096],1,HC)],QC.prototype,"width",void 0),VC([Ue("Height",[2,4096],1,HC)],QC.prototype,"height",void 0),VC([Ue("X Offset",[-1024,1024],1,HC)],QC.prototype,"xOffset",void 0),VC([Ue("Y Offset",[-1024,1024],1,HC)],QC.prototype,"yOffset",void 0),VC([Ue("V-Width",[2,4096],1,HC)],QC.prototype,"boxWidth",void 0),VC([Ue("V-Height",[2,4096],1,HC)],QC.prototype,"boxHeight",void 0),VC([Fe("Text Anchor",["start","middle","end"].map((e=>({label:e}))),HC)],QC.prototype,"textAnchor",void 0),VC([ze("Font",HC)],QC.prototype,"fontFamily",void 0),VC([ze("Font Url",HC)],QC.prototype,"fontPath",void 0),VC([Oe("Mask Text",HC)],QC.prototype,"maskText",void 0),VC([Oe("Inner Shadow",HC)],QC.prototype,"innerShadow",void 0),VC([Ge("Text Color",HC)],QC.prototype,"textColor",void 0),VC([Ge("BG Fill",HC)],QC.prototype,"bgFillColor",void 0),VC([Ge("SVG BG",HC)],QC.prototype,"svgBackground",void 0),QC=zC=VC([We("Text SVG Options")],QC);const WC={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},qC=e=>({hidden:()=>{const t=e.getSelected();return!t||!t.userData[XC.PluginType]}});let XC=GC=class extends _t{async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPluginByType("Picking"))||void 0===t||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var e,t;return null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("Picking"))||void 0===t?void 0:t.getSelectedObject()},this.options=new QC,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var e,t,n,i,r,s;if(!this.enabled)return;const o=this.getSelected();if(!o)return void(null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0));const a=o.userData[GC.PluginType];if(!a)return this.options.reset(),this._lastMeta=void 0,void(null===(i=(n=this.uiConfig).uiRefresh)||void 0===i||i.call(n,"postFrame",!0));this._lastMeta!==a&&(this.options.set(a),this._lastMeta=a),null===(s=(r=this.uiConfig).uiRefresh)||void 0===s||s.call(r,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const e=this.getSelected();e&&e.isMesh&&e.userData[GC.PluginType]&&this.updateText(e,this.options.toJSON())}async addTextToSelected(){var e;const t=this.getSelected();t&&t.isMesh?t.material?(t.userData[GC.PluginType]||!t.material.map||await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(t):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(e,t){return this.updateText(e,Object.assign(this.options.toJSON(),t))}async updateText(e,t){var n,i;if(!e.isMesh)return;if(!e.material)return void console.error("updateText: no material on mesh");let r=e.userData[GC.PluginType];r||(e.userData[GC.PluginType]=r={}),Object.assign(r,t);const s=e.material;s.map&&(s.map._isSimpleTextTexture&&s.map.dispose(),s.map=void 0),s.alphaMap&&(s.alphaMap._isSimpleTextTexture&&s.alphaMap.dispose(),s.alphaMap=void 0),s.bumpMap&&(s.bumpMap._isSimpleTextTexture&&s.bumpMap.dispose(),s.bumpMap=void 0);const o=await this.makeTextSvg(r);this.applyToMap&&(s.map=o),this.applyToAlphaMap&&(s.alphaMap=o,s.transparent=!0),this.applyToBumpMap&&(s.bumpMap=o),s.userData.inverseAlphaMap=this.inverseAlphaMap,s.setDirty(),s.needsUpdate=!0,null===(i=(n=this.uiConfig).uiRefresh)||void 0===i||i.call(n,"postFrame",!0)}async makeTextSvg(e){const i=e.fontFamily||"Arial",r=e.fontPath||this.fonts[i]||"";let s=e.style;if(r.length>0){const e=r.split("?")[0].split(".").pop()||"woff";s+="\n"+(r.length>0?`\n            @font-face {\n                font-family: ${i};\n                src: url(${r}) format(${WC[e]||e});\n            }`:"")}let o=function({text:e="Custom Text",svgBackground:t="#ffffff",xOffset:n=0,yOffset:i=0,width:r=1024,height:s=1024,boxWidth:o=1024,boxHeight:a=1024,fontFamily:l="",fontSize:c=32,maskText:u=!0,innerShadow:d=!0,bgFillColor:h="#000000",textColor:p="#ffffff",textAnchor:f="middle",style:m=""}){return`\n<svg style="background-color:${t}" width="${r}" height="${s}" viewBox="0 0 ${o} ${a}"\n xmlns="http://www.w3.org/2000/svg"\n xmlns:xlink="http://www.w3.org/1999/xlink">\n     <defs>\n        <style>\n        ${m}\n        </style>\n    </defs>\n\n    <g style="overflow:hidden; text-anchor: ${f}; font-size: ${c}px; font-family: ${l||"Arial"}">\n        <defs>\n\n`+(u?`\n<mask id="textMask">\n<text style="fill:white; font-size: ${c}px;" x="${n+o/2}" y="${a/2+i+c/4}" > ${e} </text>\n</mask>\n`:"")+"\n\n"+(d?'\n<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">\n<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>\n<feOffset in="blur" dx="1.5" dy="1.5"/>\n</filter>\n':"")+"\n\n        </defs>\n\n"+(u?'\n        <g mask="url(#textMask)">\n':"")+`\n\n        <rect x="0" y="0" width="${o}" height="${a}" style="fill:${h}"/>\n        <text style="${d?"filter: url(#innerShadow);":""} fill:${p};" x="${n+o/2}" y="${a/2+i+c/4}"> ${e} </text>\n\n`+(u?"\n        </g>\n":"")+"\n\n    </g>\n</svg>\n"}({...e,fontFamily:i,style:s});o=await(0,t.embedUrlRefs)(o,(async e=>this._getAssetData(e))),o=(0,t.svgUrl)(o);const a=await this._viewer.getManager().importer.importSinglePath(o,{generateMipmaps:!1,minFilter:n.wem});return a._isSimpleTextTexture=!0,a.flipY=!1,a.needsUpdate=!0,a}async _getAssetData(e){var t,n;if(e.startsWith("http://www.w3.org"))return e;const i=null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getManager())||void 0===n?void 0:n.importer;if(!i)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new iy(i.loadingManager),processImported:!1};try{return await i.importPath(e,this._assetLoadOptions)}catch(e){return console.error(e),""}}};XC.PluginType="SimpleTextPlugin",VC([Be(void 0,{params:qC})],XC.prototype,"options",void 0),VC([Oe("Apply Map",qC),(0,t.onChange)(GC.prototype._paramsChanged),re()],XC.prototype,"applyToMap",void 0),VC([Oe("Apply Bump Map",qC),(0,t.onChange)(GC.prototype._paramsChanged),re()],XC.prototype,"applyToBumpMap",void 0),VC([Oe("Apply Alpha Map",qC),(0,t.onChange)(GC.prototype._paramsChanged),re()],XC.prototype,"applyToAlphaMap",void 0),VC([Oe("Invert Alpha Map",qC),(0,t.onChange)(GC.prototype._paramsChanged),re()],XC.prototype,"inverseAlphaMap",void 0),VC([je("Add Text",(e=>({hidden:()=>!e.getSelected()})))],XC.prototype,"addTextToSelected",null),XC=GC=VC([We("Simple Text")],XC);class YC{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class KC{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class JC{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new JC;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map((e=>e.clone())),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new JC),this.front.build(t)),n.length&&(this.back||(this.back=new JC),this.back.build(n))}}class ZC{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new ZC(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add((new ZC).copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,i=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new n.Pa4(this.x,this.y,this.z)}}class $C{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new $C(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,i,r){let s=0;const o=[];for(let a=0;a<e.vertices.length;a++){const t=this.normal.dot(e.vertices[a].pos)-this.w,n=t<-$C.EPSILON?2:t>$C.EPSILON?1:0;s|=n,o.push(n)}switch(s){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:i.push(e);break;case 2:r.push(e);break;case 3:{const t=[],n=[];for(let i=0;i<e.vertices.length;i++){const r=(i+1)%e.vertices.length,s=o[i],a=o[r],l=e.vertices[i],c=e.vertices[r];if(2!=s&&t.push(l),1!=s&&n.push(2!=s?l.clone():l),3==(s|a)){const e=(this.w-this.normal.dot(l.pos))/this.normal.dot((new ZC).copy(c.pos).sub(l.pos)),i=l.interpolate(c,e);t.push(i),n.push(i.clone())}}t.length>=3&&i.push(new eS(t,e.shared)),n.length>=3&&r.push(new eS(n,e.shared));break}}}static fromPoints(e,t,n){const i=(new ZC).copy(t).sub(e).cross((new ZC).copy(n).sub(e)).normalize();return new $C(i.clone(),i.dot(e))}}$C.EPSILON=1e-5;class eS{constructor(e,t){this.vertices=e,this.shared=t,this.plane=$C.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new eS(this.vertices.map((e=>e.clone())),this.shared)}flip(){this.vertices.reverse().map((e=>e.flip())),this.plane.flip()}}class tS{constructor(e,t,n,i){this.pos=(new ZC).copy(e),this.normal=(new ZC).copy(t),this.uv=(new ZC).copy(n),this.uv.z=0,i&&(this.color=(new ZC).copy(i))}clone(){return new tS(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new tS(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class nS{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new nS;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const i=e.attributes.position,r=e.attributes.normal,s=e.attributes.uv,o=e.attributes.color,a=e.groups;let l;if(e.index)l=e.index.array;else{l=new Array(i.array.length/i.itemSize|0);for(let e=0;e<l.length;e++)l[e]=e}const c=l.length/3|0;n=new Array(c);for(let u=0,d=0,h=l.length;u<h;u+=3,d++){const e=new Array(3);for(let t=0;t<3;t++){const n=l[u+t],a=3*n,c=2*n,d=i.array[a],h=i.array[a+1],p=i.array[a+2],f=r.array[a],m=r.array[a+1],g=r.array[a+2],_=null==s?void 0:s.array[c],v=null==s?void 0:s.array[c+1];e[t]=new tS(new ZC(d,h,p),new ZC(f,m,g),new ZC(_,v,0),o&&new ZC(o.array[c],o.array[c+1],o.array[c+2]))}if(void 0===t&&a&&a.length>0)for(const t of a)u>=t.start&&u<t.start+t.count&&(n[d]=new eS(e,t.materialIndex));else n[d]=new eS(e,t)}return nS.fromPolygons(n.filter((e=>!isNaN(e.plane.normal.x))))}static toGeometry(e,t){let i=0;const r=e.polygons;for(const n of r)i+=n.vertices.length-2;const s=new n.u9r,o=new YC(3*i*3),a=new YC(3*i*3),l=new KC(2*i*3);let c;const u=[],d=[];for(const n of r){const e=n.vertices,t=e.length;void 0!==n.shared&&(u[n.shared]||(u[n.shared]=[])),t&&void 0!==e[0].color&&(c||(c=new YC(3*i*3)));for(let i=3;i<=t;i++)(void 0===n.shared?d:u[n.shared]).push(o.top/3,o.top/3+1,o.top/3+2),o.write(e[0].pos),o.write(e[i-2].pos),o.write(e[i-1].pos),a.write(e[0].normal),a.write(e[i-2].normal),a.write(e[i-1].normal),l&&(l.write(e[0].uv),l.write(e[i-2].uv),l.write(e[i-1].uv)),c&&(c.write(e[0].color),c.write(e[i-2].color),c.write(e[i-1].color))}s.setAttribute("position",new n.TlE(o.array,3)),s.setAttribute("normal",new n.TlE(a.array,3)),l&&s.setAttribute("uv",new n.TlE(l.array,2)),c&&s.setAttribute("color",new n.TlE(c.array,3));for(let n=0;n<u.length;n++)void 0===u[n]&&(u[n]=[]);if(u.length){let e=[],t=0;for(let n=0;n<u.length;n++)s.addGroup(t,u[n].length,n),t+=u[n].length,e=e.concat(u[n]);s.addGroup(t,d.length,u.length),e=e.concat(d),s.setIndex(e)}const h=(new n.yGw).copy(t).invert();return s.applyMatrix4(h),s.computeBoundingSphere(),s.computeBoundingBox(),s}static fromMesh(e,t){const i=nS.fromGeometry(e.geometry,t),r=new n.Pa4,s=new n.Vkp;s.getNormalMatrix(e.matrix);for(let n=0;n<i.polygons.length;n++){const t=i.polygons[n];for(let n=0;n<t.vertices.length;n++){const i=t.vertices[n];i.pos.copy(r.copy(i.pos.toVector3()).applyMatrix4(e.matrix)),i.normal.copy(r.copy(i.normal.toVector3()).applyMatrix3(s))}}return i}static toMesh(e,t,i){const r=nS.toGeometry(e,t),s=new n.Kj0(r,i);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}static union(e,t){const n=nS.fromMesh(e),i=nS.fromMesh(t);return nS.toMesh(n.union(i),e.matrix,e.material)}static subtract(e,t){const n=nS.fromMesh(e),i=nS.fromMesh(t);return nS.toMesh(n.subtract(i),e.matrix,e.material)}static intersect(e,t){const n=nS.fromMesh(e),i=nS.fromMesh(t);return nS.toMesh(n.intersect(i),e.matrix,e.material)}clone(){const e=new nS;return e.polygons=this.polygons.map((e=>e.clone())).filter((e=>Number.isFinite(e.plane.w))),e}toPolygons(){return this.polygons}union(e){const t=new JC(this.clone().polygons),n=new JC(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),nS.fromPolygons(t.allPolygons())}subtract(e){const t=new JC(this.clone().polygons),n=new JC(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),nS.fromPolygons(t.allPolygons())}intersect(e){const t=new JC(this.clone().polygons),n=new JC(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),nS.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return nS.toMesh(this,e,t)}toGeometry(e){return nS.toGeometry(this,e)}}var iS=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const rS=["union","subtract","intersect"];class sS extends _t{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[za],this.rootMesh=new n.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),null===(t=e.getPlugin(za))||void 0===t||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,t;const n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();n&&n.geometry&&(n.userData._isCSGMesh||(n.userData.csgBrush||(n.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,t.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var e,t;const n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("AssetExporterPlugin"))||void 0===t?void 0:t.exporter;if(!n||!this.rootObject)return;const i=this.rootMesh.visible;this.rootMesh.visible=!0;const r=await n.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=i,r}_updateSelectedProperties(){var e,t;const n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();n&&n.userData.csgBrush&&(n.userData.csgBrush.enabled=this.csgSelectedEnabled,n.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,t,n,i,r,s,o,a;const l=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();l&&(this.csgSelectedEnabled=null!==(i=null===(n=l.userData.csgBrush)||void 0===n?void 0:n.enabled)&&void 0!==i&&i,this.csgSelectedOperation=null!==(s=null===(r=l.userData.csgBrush)||void 0===r?void 0:r.operation)&&void 0!==s?s:"union"),null===(a=null===(o=this.uiConfig)||void 0===o?void 0:o.uiRefresh)||void 0===a||a.call(o,"postFrame",!0)}_preFrame(){var e,t,n;if(!this.rootObject)return;if(!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const i=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,null===(e=this.rootObject)||void 0===e||e.modelObject.updateMatrixWorld(!0),(null!==(t=this.rootMesh.userData.dispose)&&void 0!==t?t:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(i)),this.rootMesh&&!this.rootMesh.parent&&(null===(n=this.rootObject)||void 0===n||n.modelObject.add(this.rootMesh)),this.showResult?(i.forEach((e=>{e[0].visible=!1})),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(i.forEach((e=>{e[0].visible=!0})),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const t=[];return null===(e=this._viewer)||void 0===e||e.scene.traverse((e=>{var n;e.isMesh&&e.geometry&&(null===(n=e.userData.csgBrush)||void 0===n?void 0:n.enabled)&&t.push([e,e.userData.csgBrush.operation])})),t}_sceneUpdate(e){var t,n;(null===(n=null===(t=null==e?void 0:e.object)||void 0===t?void 0:t.userData)||void 0===n?void 0:n._isCSGMesh)||(this._csgNeedsUpdate=!0)}}function oS(e,t){let i=new nS;const r=e.map((e=>e[0].material)).flatMap((e=>e));e.forEach((([e,t])=>{if(!rS.includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const n=e.matrix;e.matrix=e.matrixWorld;let s=0;s=Array.isArray(e.material)?void 0:r.indexOf(e.material),i=i[t](nS.fromMesh(e,s)),e.matrix=n}));const s=i.toMesh(null!=t?t:(new n.yGw).identity(),r);return s.userData._isCSGMesh=!0,s.geometry.groups=s.geometry.groups.filter((e=>e.count>0)),s}iS([Oe("Show Result",(e=>({onChange:()=>{var t;return null===(t=e._viewer)||void 0===t?void 0:t.setDirty()}})))],sS.prototype,"showResult",void 0),iS([je("Make CSG Brush",(e=>({hidden:()=>{var t,n;const i=null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject();return!(null==i?void 0:i.userData)||!!i.userData.csgBrush||i.userData._isCSGMesh}})))],sS.prototype,"makeSelectedCSGBrush",null),iS([Oe("Enabled",(e=>({hidden:()=>{var t,n;const i=null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject();return!i||!i.userData.csgBrush},onChange:e._updateSelectedProperties})))],sS.prototype,"csgSelectedEnabled",void 0),iS([Fe("Operation",rS.map((e=>({label:e}))),(e=>({hidden:()=>{var t,n;const i=null===(n=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(za))||void 0===n?void 0:n.getSelectedObject();return!i||!i.userData.csgBrush},onChange:e._updateSelectedProperties})))],sS.prototype,"csgSelectedOperation",void 0),iS([je("Refresh CSG")],sS.prototype,"refreshCSG",null),iS([je("Export Result",(e=>({hidden:()=>{var t;return!(null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("AssetExporterPlugin"))}})))],sS.prototype,"downloadObject",null);let aS=class extends sS{_buildCSGMesh(e){return oS(e)}};aS.PluginType="CSGPluginBSP",aS=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([We("CSG Plugin (BSP)")],aS);const lS=0,cS=1,uS=3,dS=4;class hS{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,i=-1/0;for(let r=0,s=e.length;r<s;r++){const s=e[r][t];n=s<n?s:n,i=s>i?s:i}this.min=n,this.max=i}setFromPoints(e,t){let n=1/0,i=-1/0;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=e.dot(s);n=o<n?o:n,i=o>i?o:i}this.min=n,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}hS.prototype.setFromBox=function(){const e=new n.Pa4;return function(t,n){const i=n.min,r=n.max;let s=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let n=0;n<=1;n++)for(let l=0;l<=1;l++){e.x=i.x*a+r.x*(1-a),e.y=i.y*n+r.y*(1-n),e.z=i.z*l+r.z*(1-l);const c=t.dot(e);s=Math.min(c,s),o=Math.max(c,o)}this.min=s,this.max=o}}(),new hS;const pS=function(){const e=new n.Pa4,t=new n.Pa4,i=new n.Pa4;return function(n,r,s){const o=n.start,a=e,l=r.start,c=t;i.subVectors(o,l),e.subVectors(n.end,n.start),t.subVectors(r.end,r.start);const u=i.dot(c),d=c.dot(a),h=c.dot(c),p=i.dot(a),f=a.dot(a)*h-d*d;let m,g;m=0!==f?(u*d-p*h)/f:0,g=(u+m*d)/h,s.x=m,s.y=g}}(),fS=function(){const e=new n.FM8,t=new n.Pa4,i=new n.Pa4;return function(n,r,s,o){pS(n,r,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1)return n.at(a,s),void r.at(l,o);if(a>=0&&a<=1)return l<0?r.at(0,o):r.at(1,o),void n.closestPointToPoint(o,!0,s);if(l>=0&&l<=1)return a<0?n.at(0,s):n.at(1,s),void r.closestPointToPoint(s,!0,o);{let e,c;e=a<0?n.start:n.end,c=l<0?r.start:r.end;const u=t,d=i;return n.closestPointToPoint(c,!0,t),r.closestPointToPoint(e,!0,i),u.distanceToSquared(c)<=d.distanceToSquared(e)?(s.copy(u),void o.copy(c)):(s.copy(e),void o.copy(d))}}}(),mS=function(){const e=new n.Pa4,t=new n.Pa4,i=new n.JOQ,r=new n.Zzh;return function(n,s){const{radius:o,center:a}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(r.start=l,r.end=u,r.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(r.start=c,r.end=u,r.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;const d=s.getPlane(i);if(Math.abs(d.distanceToPoint(a))<=o){const e=d.projectPoint(a,t);if(s.containsPoint(e))return!0}return!1}}(),gS=1e-15;function _S(e){return Math.abs(e)<gS}class vS extends n.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new n.Pa4)),this.satBounds=new Array(4).fill().map((()=>new hS)),this.points=[this.a,this.b,this.c],this.sphere=new n.aLr,this.plane=new n.JOQ,this.needsUpdate=!0}intersectsSphere(e){return mS(e,this)}update(){const e=this.a,t=this.b,n=this.c,i=this.points,r=this.satAxes,s=this.satBounds,o=r[0],a=s[0];this.getNormal(o),a.setFromPoints(o,i);const l=r[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,i);const u=r[2],d=s[2];u.subVectors(t,n),d.setFromPoints(u,i);const h=r[3],p=s[3];h.subVectors(n,e),p.setFromPoints(h,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}vS.prototype.closestPointToSegment=function(){const e=new n.Pa4,t=new n.Pa4,i=new n.Zzh;return function(n,r=null,s=null){const{start:o,end:a}=n,l=this.points;let c,u=1/0;for(let d=0;d<3;d++){const o=(d+1)%3;i.start.copy(l[d]),i.end.copy(l[o]),fS(i,n,e,t),c=e.distanceToSquared(t),c<u&&(u=c,r&&r.copy(e),s&&s.copy(t))}return this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,r&&r.copy(e),s&&s.copy(o)),this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,r&&r.copy(e),s&&s.copy(a)),Math.sqrt(u)}}(),vS.prototype.intersectsTriangle=function(){const e=new vS,t=new Array(3),i=new Array(3),r=new hS,s=new hS,o=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=new n.Pa4,u=new n.Zzh,d=new n.Zzh,h=new n.Zzh;return function(n,p=null,f=!1){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(e.copy(n),e.update(),n=e);const m=this.plane,g=n.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){const e=this.satBounds,a=this.satAxes;i[0]=n.a,i[1]=n.b,i[2]=n.c;for(let t=0;t<4;t++){const n=e[t],s=a[t];if(r.setFromPoints(s,i),n.isSeparated(r))return!1}const l=n.satBounds,c=n.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let n=0;n<4;n++){const e=l[n],i=c[n];if(r.setFromPoints(i,t),e.isSeparated(r))return!1}for(let n=0;n<4;n++){const e=a[n];for(let n=0;n<4;n++){const a=c[n];if(o.crossVectors(e,a),r.setFromPoints(o,t),s.setFromPoints(o,i),r.isSeparated(s))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{const e=this.points;let t=!1,i=0;for(let n=0;n<3;n++){const r=e[n],s=e[(n+1)%3];u.start.copy(r),u.end.copy(s),u.delta(a);const o=t?d.start:d.end,l=_S(g.distanceToPoint(r));if(_S(g.normal.dot(a))&&l){d.copy(u),i=2;break}if((g.intersectLine(u,o)||l)&&!_S(o.distanceTo(s))){if(i++,t)break;t=!0}}if(1===i&&n.containsPoint(d.end))return p&&(p.start.copy(d.end),p.end.copy(d.end)),!0;if(2!==i)return!1;const r=n.points;let s=!1,o=0;for(let n=0;n<3;n++){const e=r[n],t=r[(n+1)%3];u.start.copy(e),u.end.copy(t),u.delta(l);const i=s?h.start:h.end,a=_S(m.distanceToPoint(e));if(_S(m.normal.dot(l))&&a){h.copy(u),o=2;break}if((m.intersectLine(u,i)||a)&&!_S(i.distanceTo(t))){if(o++,s)break;s=!0}}if(1===o&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(2!==o)return!1;if(d.delta(a),h.delta(l),a.dot(l)<0){let e=h.start;h.start=h.end,h.end=e}const f=d.start.dot(a),_=d.end.dot(a),v=h.start.dot(a),y=h.end.dot(a);return(f===y||v===_||_<v!=f<y)&&(p&&(c.subVectors(d.start,h.start),c.dot(a)>0?p.start.copy(d.start):p.start.copy(h.start),c.subVectors(d.end,h.end),c.dot(a)<0?p.end.copy(d.end):p.end.copy(h.end)),!0)}}}(),vS.prototype.distanceToPoint=function(){const e=new n.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),vS.prototype.distanceToTriangle=function(){const e=new n.Pa4,t=new n.Pa4,i=["a","b","c"],r=new n.Zzh,s=new n.Zzh;return function(n,o=null,a=null){const l=o||a?r:null;if(this.intersectsTriangle(n,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let t=0;t<3;t++){let r;const s=i[t],l=n[s];this.closestPointToPoint(l,e),r=l.distanceToSquared(e),r<c&&(c=r,o&&o.copy(e),a&&a.copy(l));const u=this[s];n.closestPointToPoint(u,e),r=u.distanceToSquared(e),r<c&&(c=r,o&&o.copy(u),a&&a.copy(e))}for(let u=0;u<3;u++){const l=i[u],d=i[(u+1)%3];r.set(this[l],this[d]);for(let u=0;u<3;u++){const l=i[u],d=i[(u+1)%3];s.set(n[l],n[d]),fS(r,s,e,t);const h=e.distanceToSquared(t);h<c&&(c=h,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(c)}}();const yS=1e-14,bS=1e-10,AS=new n.Zzh,wS=new n.Zzh,xS=new n.Pa4,ES=new n.Pa4,CS=new n.JOQ,SS=new vS;function MS(e){return e.a.distanceToSquared(e.b)<yS||e.a.distanceToSquared(e.c)<yS||e.b.distanceToSquared(e.c)<yS}class TS{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new n.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class IS{constructor(){this.trianglePool=new TS,this.triangles=[],this.normal=new n.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:i}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let r=0,s=e.length;r<s;r++){const s=e[r];if(0===r)s.getNormal(i);else if(Math.abs(1-s.getNormal(xS).dot(i))>yS)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const o=n.getTriangle();o.copy(s),t.push(o)}else{e.getNormal(i);const r=n.getTriangle();r.copy(e),t.push(r)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(CS),Math.abs(1-Math.abs(CS.normal.dot(t)))<bS){const i=[e.a,e.b,e.c];for(let n=0;n<3;n++){const r=(n+1)%3,s=i[n],o=i[r];xS.subVectors(o,s).normalize(),ES.crossVectors(t,xS),CS.setFromNormalAndCoplanarPoint(ES,s),this.splitByPlane(CS,e,n)}for(let e=0,t=n.length;e<t;e++)n[e].coplanarCount=0}else this.splitByPlane(CS,e)}splitByPlane(e,t=null,n=-1){const{triangles:i,trianglePool:r}=this;let s=null;null!==t&&(s=SS,s.copy(t),s.needsUpdate=!0);for(let o=0,a=i.length;o<a;o++){const t=i[o],{a:n,b:l,c:c}=t;if(s&&!s.intersectsTriangle(t,AS,!0))continue;let u=0,d=-1,h=0,p=!1;const f=[n,l,c];for(let i=0;i<3;i++){const t=(i+1)%3;AS.start.copy(f[i]),AS.end.copy(f[t]);const n=e.distanceToPoint(AS.start),r=e.distanceToPoint(AS.end);if(Math.abs(n)<bS&&Math.abs(r)<bS){p=!0;break}if(Math.abs(n)<bS)continue;n>0&&h++;let s=!!e.intersectLine(AS,xS);!s&&Math.abs(r)<bS&&(xS.copy(AS.end),s=!0),!s||xS.distanceTo(AS.start)<yS||(xS.distanceTo(AS.end)<yS&&(d=i),0===u?wS.start.copy(xS):wS.end.copy(xS),u++)}if(!p)if(2===u&&wS.distance()>bS)if(-1!==d){d=(d+1)%3;let e=0;e===d&&(e=(e+1)%3);let n=e+1;n===d&&(n=(n+1)%3);const s=r.getTriangle();s.a.copy(f[n]),s.b.copy(wS.end),s.c.copy(wS.start),MS(s)||i.push(s),t.a.copy(f[e]),t.b.copy(wS.start),t.c.copy(wS.end),MS(t)&&(i.splice(o,1),o--,a--)}else{const n=f.findIndex((t=>h>=2?e.distanceToPoint(t)<0:e.distanceToPoint(t)>0));if(0===n){let e=wS.start;wS.start=wS.end,wS.end=e}else if(-1===n)continue;const s=(n+1)%3,l=(n+2)%3,c=r.getTriangle(),u=r.getTriangle();f[s].distanceToSquared(wS.start)<f[l].distanceToSquared(wS.end)?(c.a.copy(f[s]),c.b.copy(wS.start),c.c.copy(wS.end),u.a.copy(f[s]),u.b.copy(f[l]),u.c.copy(wS.start)):(c.a.copy(f[l]),c.b.copy(wS.start),c.c.copy(wS.end),u.a.copy(f[s]),u.b.copy(f[l]),u.c.copy(wS.end)),t.a.copy(f[n]),t.b.copy(wS.end),t.c.copy(wS.start),MS(c)||i.push(c),MS(u)||i.push(u),MS(t)&&(i.splice(o,1),o--,a--)}else 3===u&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function PS(){return"undefined"!=typeof SharedArrayBuffer}function RS(e){if(e.buffer instanceof SharedArrayBuffer)return e;const t=e.constructor,n=e.buffer,i=new SharedArrayBuffer(n.byteLength),r=new Uint8Array(n);return new Uint8Array(i).set(r,0),new t(i)}class DS{constructor(e,t=500){const n=PS()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:i}=this;null===e&&(e=~~(n.length*i));const r=new t(e);r.set(n,0),this.array=r}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let i=0,r=e.length;i<r;i++)t[n+i]=e[i];this.length+=e.length}clear(){this.length=0}}class kS{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let i=0;for(let r=0;r<t;r++)i+=n[r][e].length;return i}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const e={};t.push(e);for(const t in n)e[t]=new DS(n[t].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,i=n[0][e];if(i){if(i.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let r=0,s=n.length;r<s;r++)n[r][e]=new DS(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach((e=>{for(const t in e)e[t].clear()}))}delete(e){this.groupAttributes.forEach((t=>{delete t[e]}))}reset(){this.groupAttributes=[]}}class BS{constructor(e){this.triangle=(new n.CJI).copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=(new n.CJI).copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class OS{constructor(){this.data={}}addTriangleIntersection(e,t,n,i){const{data:r}=this;r[e]||(r[e]=new BS(t)),r[e].addTriangle(n,i)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(null!==e)e in t&&n.push(t[e].triangle);else for(const i in t)n.push(t[i].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map((e=>parseInt(e)))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map((e=>parseInt(e))):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,i=new Set,r=[],s=e=>{if(n[e])if(null!==t)n[e].intersects[t]&&r.push(n[e].intersects[t]);else{const t=n[e].intersects;for(const e in t)i.has(e)||(i.add(e),r.push(t[e]))}};if(null!==e)s(e);else for(const o in n)s(o);return r}reset(){this.data={}}}class LS{constructor(){this.enabled=!1,this.triangleIntersectsA=new OS,this.triangleIntersectsB=new OS,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,i){const{triangleIntersectsA:r,triangleIntersectsB:s}=this;r.addTriangleIntersection(e,t,n,i),s.addTriangleIntersection(n,i,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class US{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:i}=this;n[e]||(n[e]=[],i.push(e)),n[e].push(t)}}const NS=new n.zHn,FS=new n.yGw,jS=new n.CJI,zS=new n.Pa4,GS=new n.Ltg,VS=new n.Ltg,HS=new n.Ltg,QS=new n.Ltg,WS=new n.Ltg,qS=new n.Ltg,XS=new n.Zzh,YS=new n.Pa4,KS=1e-8,JS=1e-15,ZS=-1,$S=1,eM=-2,tM=2,nM=0,iM=1,rM=2;let sM=null;function oM(e){sM=e}function aM(e,t){function i(){return Math.random()-.5}e.getNormal(YS),NS.direction.copy(YS),e.getMidpoint(NS.origin);let r=0,s=1/0;for(let o=0;o<3;o++){NS.direction.x+=i()*KS,NS.direction.y+=i()*KS,NS.direction.z+=i()*KS,NS.direction.multiplyScalar(-1);const e=t.raycastFirst(NS,n.ehD);if(Boolean(e&&NS.direction.dot(e.face.normal)>0)&&r++,null!==e&&(s=Math.min(s,e.distance)),s<=JS)return e.face.normal.dot(YS)>0?tM:eM;if(r/3>.5||(o-r+1)/3>.5)break}return r/3>.5?ZS:$S}function lM(e,t,n,i,r,s,o=!1){const a=n.attributes,l=n.index,c=3*e,u=l.getX(c+0),d=l.getX(c+1),h=l.getX(c+2);for(const p in s){const e=a[p],n=s[p];if(!(p in a))throw new Error(`CSG Operations: Attribute ${p} not available on geometry.`);const l=e.itemSize;"position"===p?(jS.a.fromBufferAttribute(e,u).applyMatrix4(i),jS.b.fromBufferAttribute(e,d).applyMatrix4(i),jS.c.fromBufferAttribute(e,h).applyMatrix4(i),dM(jS.a,jS.b,jS.c,t,3,n,o)):"normal"===p?(jS.a.fromBufferAttribute(e,u).applyNormalMatrix(r),jS.b.fromBufferAttribute(e,d).applyNormalMatrix(r),jS.c.fromBufferAttribute(e,h).applyNormalMatrix(r),o&&(jS.a.multiplyScalar(-1),jS.b.multiplyScalar(-1),jS.c.multiplyScalar(-1)),dM(jS.a,jS.b,jS.c,t,3,n,o,!0)):(GS.fromBufferAttribute(e,u),VS.fromBufferAttribute(e,d),HS.fromBufferAttribute(e,h),dM(GS,VS,HS,t,l,n,o))}}function cM(e,t,n,i,r,s,o,a=!1){hM(e,i,r,s,o,a),hM(a?n:t,i,r,s,o,a),hM(a?t:n,i,r,s,o,a)}function uM(e,t,n=!1){switch(e){case lS:if(t===$S||t===tM&&!n)return iM;break;case cS:if(n){if(t===ZS)return nM}else if(t===$S||t===eM)return iM;break;case uS:if(t===ZS)return nM;if(t===$S)return iM;break;case dS:if(t===ZS||t===tM&&!n)return iM;break;default:throw new Error(`Unrecognized CSG operation enum "${e}".`)}return rM}function dM(e,t,n,i,r,s,o=!1,a=!1){const l=e=>{s.push(e.x),r>1&&s.push(e.y),r>2&&s.push(e.z),r>3&&s.push(e.w)};QS.set(0,0,0,0).addScaledVector(e,i.a.x).addScaledVector(t,i.a.y).addScaledVector(n,i.a.z),WS.set(0,0,0,0).addScaledVector(e,i.b.x).addScaledVector(t,i.b.y).addScaledVector(n,i.b.z),qS.set(0,0,0,0).addScaledVector(e,i.c.x).addScaledVector(t,i.c.y).addScaledVector(n,i.c.z),a&&(QS.normalize(),WS.normalize(),qS.normalize()),l(QS),o?(l(qS),l(WS)):(l(WS),l(qS))}function hM(e,t,n,i,r,s=!1){for(const o in r){const a=t[o],l=r[o];if(!(o in t))throw new Error(`CSG Operations: Attribute ${o} no available on geometry.`);const c=a.itemSize;"position"===o?(zS.fromBufferAttribute(a,e).applyMatrix4(n),l.push(zS.x,zS.y,zS.z)):"normal"===o?(zS.fromBufferAttribute(a,e).applyNormalMatrix(i),s&&zS.multiplyScalar(-1),l.push(zS.x,zS.y,zS.z)):(l.push(a.getX(e)),c>1&&l.push(a.getY(e)),c>2&&l.push(a.getZ(e)),c>3&&l.push(a.getW(e)))}}const pM=new n.yGw,fM=new n.Vkp,mM=new n.CJI,gM=new n.CJI,_M=new n.CJI,vM=new n.CJI;function yM(e){for(const t of e)return t}function bM(e,t,n,i,r,s,o,a=0){const l=e.matrixWorld.determinant()<0;pM.copy(t.matrixWorld).invert().multiply(e.matrixWorld),fM.getNormalMatrix(e.matrixWorld).multiplyScalar(l?-1:1);const c=e.geometry.groupIndices,u=e.geometry.index,d=e.geometry.attributes.position,h=t.geometry.boundsTree,p=t.geometry.index,f=t.geometry.attributes.position,m=n.ids,g=n.intersectionSet;for(let _=0,v=m.length;_<v;_++){const t=m[_],n=-1===a?0:c[t]+a,v=o.getGroupSet(n),y=3*t,b=u.getX(y+0),A=u.getX(y+1),w=u.getX(y+2);mM.a.fromBufferAttribute(d,b).applyMatrix4(pM),mM.b.fromBufferAttribute(d,A).applyMatrix4(pM),mM.c.fromBufferAttribute(d,w).applyMatrix4(pM),s.initialize(mM);const x=g[t];for(let e=0,i=x.length;e<i;e++){const t=3*x[e],n=p.getX(t+0),i=p.getX(t+1),r=p.getX(t+2);gM.a.fromBufferAttribute(f,n),gM.b.fromBufferAttribute(f,i),gM.c.fromBufferAttribute(f,r),s.splitByTriangle(gM)}const E=s.triangles;for(let s=0,o=E.length;s<o;s++){const n=E[s],o=uM(i,aM(n,h),r);if(o!==rM){mM.getBarycoord(n.a,vM.a),mM.getBarycoord(n.b,vM.b),mM.getBarycoord(n.c,vM.c);const i=o===nM;lM(t,vM,e.geometry,e.matrixWorld,fM,v,l!==i)}}}return m.length}function AM(e,t,n,i,r,s,o=0){const a=e.matrixWorld.determinant()<0;pM.copy(t.matrixWorld).invert().multiply(e.matrixWorld),fM.getNormalMatrix(e.matrixWorld).multiplyScalar(a?-1:1);const l=t.geometry.boundsTree,c=e.geometry.groupIndices,u=e.geometry.index,d=e.geometry.attributes,h=d.position,p=[],f=e.geometry.halfEdges,m=new Set;for(let g=0,_=u.count/3;g<_;g++)g in n.intersectionSet||m.add(g);for(;m.size>0;){const t=yM(m);m.delete(t),p.push(t);const n=3*t,g=u.getX(n+0),_=u.getX(n+1),v=u.getX(n+2);_M.a.fromBufferAttribute(h,g).applyMatrix4(pM),_M.b.fromBufferAttribute(h,_).applyMatrix4(pM),_M.c.fromBufferAttribute(h,v).applyMatrix4(pM);const y=uM(i,aM(_M,l),r);for(;p.length>0;){const t=p.pop(),n=-1===o?0:c[t]+o,i=s.getGroupSet(n);for(let e=0;e<3;e++){const n=f.getSiblingTriangleIndex(t,e);-1!==n&&m.has(n)&&(p.push(n),m.delete(n))}if(y===rM)continue;const r=3*t,l=u.getX(r+0),h=u.getX(r+1),g=u.getX(r+2),_=y===nM;cM(l,h,g,d,e.matrixWorld,fM,i,_!==a)}}}const wM=0,xM=1,EM=2,CM=1.25,SM=1,MM=65535,TM=Math.pow(2,-24);class IM{constructor(){}}function PM(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function RM(e){let t=-1,n=-1/0;for(let i=0;i<3;i++){const r=e[i+3]-e[i];r>n&&(n=r,t=i)}return t}function DM(e,t){t.set(e)}function kM(e,t,n){let i,r;for(let s=0;s<3;s++){const o=s+3;i=e[s],r=t[s],n[s]=i<r?i:r,i=e[o],r=t[o],n[o]=i>r?i:r}}function BM(e,t,n){for(let i=0;i<3;i++){const r=t[e+2*i],s=t[e+2*i+1],o=r-s,a=r+s;o<n[i]&&(n[i]=o),a>n[i+3]&&(n[i+3]=a)}}function OM(e){const t=e[3]-e[0],n=e[4]-e[1],i=e[5]-e[2];return 2*(t*n+n*i+i*t)}function LM(e,t,n,i,r=null){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0,d=1/0,h=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0;const _=null!==r;for(let v=6*t,y=6*(t+n);v<y;v+=6){const t=e[v+0],n=e[v+1],i=t-n,r=t+n;i<s&&(s=i),r>l&&(l=r),_&&t<d&&(d=t),_&&t>f&&(f=t);const y=e[v+2],b=e[v+3],A=y-b,w=y+b;A<o&&(o=A),w>c&&(c=w),_&&y<h&&(h=y),_&&y>m&&(m=y);const x=e[v+4],E=e[v+5],C=x-E,S=x+E;C<a&&(a=C),S>u&&(u=S),_&&x<p&&(p=x),_&&x>g&&(g=x)}i[0]=s,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=u,_&&(r[0]=d,r[1]=h,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}const UM=32,NM=(e,t)=>e.candidate-t.candidate,FM=new Array(UM).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),jM=new Float32Array(6);class zM{constructor(e,t,i){this.isOrientedBox=!0,this.min=new n.Pa4,this.max=new n.Pa4,this.matrix=new n.yGw,this.invMatrix=new n.yGw,this.points=new Array(8).fill().map((()=>new n.Pa4)),this.satAxes=new Array(3).fill().map((()=>new n.Pa4)),this.satBounds=new Array(3).fill().map((()=>new hS)),this.alignedSatBounds=new Array(3).fill().map((()=>new hS)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}zM.prototype.update=function(){const e=this.matrix,t=this.min,n=this.max,i=this.points;for(let l=0;l<=1;l++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){const o=i[1*l|2*r|4*s];o.x=l?n.x:t.x,o.y=r?n.y:t.y,o.z=s?n.z:t.z,o.applyMatrix4(e)}const r=this.satBounds,s=this.satAxes,o=i[0];for(let l=0;l<3;l++){const e=s[l],t=r[l],n=i[1<<l];e.subVectors(o,n),t.setFromPoints(e,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},zM.prototype.intersectsBox=function(){const e=new hS;return function(t){this.needsUpdate&&this.update();const n=t.min,i=t.max,r=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(e.min=n.x,e.max=i.x,o[0].isSeparated(e))return!1;if(e.min=n.y,e.max=i.y,o[1].isSeparated(e))return!1;if(e.min=n.z,e.max=i.z,o[2].isSeparated(e))return!1;for(let a=0;a<3;a++){const n=s[a],i=r[a];if(e.setFromBox(n,t),i.isSeparated(e))return!1}return!0}}(),zM.prototype.intersectsTriangle=function(){const e=new vS,t=new Array(3),i=new hS,r=new hS,s=new n.Pa4;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(e.copy(n),e.update(),n=e);const o=this.satBounds,a=this.satAxes;t[0]=n.a,t[1]=n.b,t[2]=n.c;for(let e=0;e<3;e++){const n=o[e],r=a[e];if(i.setFromPoints(r,t),n.isSeparated(i))return!1}const l=n.satBounds,c=n.satAxes,u=this.points;for(let e=0;e<3;e++){const t=l[e],n=c[e];if(i.setFromPoints(n,u),t.isSeparated(i))return!1}for(let e=0;e<3;e++){const n=a[e];for(let e=0;e<4;e++){const o=c[e];if(s.crossVectors(n,o),i.setFromPoints(s,t),r.setFromPoints(s,u),i.isSeparated(r))return!1}}return!0}}(),zM.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},zM.prototype.distanceToPoint=function(){const e=new n.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),zM.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map((()=>new n.Zzh)),i=new Array(12).fill().map((()=>new n.Zzh)),r=new n.Pa4,s=new n.Pa4;return function(n,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(a||l)&&(n.getCenter(s),this.closestPointToPoint(s,r),n.closestPointToPoint(r,s),a&&a.copy(r),l&&l.copy(s)),0;const c=o*o,u=n.min,d=n.max,h=this.points;let p=1/0;for(let e=0;e<8;e++){const t=h[e];s.copy(t).clamp(u,d);const n=t.distanceToSquared(s);if(n<p&&(p=n,a&&a.copy(t),l&&l.copy(s),n<c))return Math.sqrt(n)}let f=0;for(let r=0;r<3;r++)for(let n=0;n<=1;n++)for(let s=0;s<=1;s++){const o=(r+1)%3,a=(r+2)%3,l=1<<r|n<<o|s<<a,c=h[n<<o|s<<a],p=h[l];t[f].set(c,p);const m=e[r],g=e[o],_=e[a],v=i[f],y=v.start,b=v.end;y[m]=u[m],y[g]=n?u[g]:d[g],y[_]=s?u[_]:d[g],b[m]=d[m],b[g]=n?u[g]:d[g],b[_]=s?u[_]:d[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){s.x=e?d.x:u.x,s.y=t?d.y:u.y,s.z=n?d.z:u.z,this.closestPointToPoint(s,r);const i=s.distanceToSquared(r);if(i<p&&(p=i,a&&a.copy(r),l&&l.copy(s),i<c))return Math.sqrt(i)}for(let e=0;e<12;e++){const n=t[e];for(let e=0;e<12;e++){const t=i[e];fS(n,t,r,s);const o=r.distanceToSquared(s);if(o<p&&(p=o,a&&a.copy(r),l&&l.copy(s),o<c))return Math.sqrt(o)}}return Math.sqrt(p)}}();const GM=new n.Pa4,VM=new n.Pa4,HM=new n.Pa4,QM=new n.FM8,WM=new n.FM8,qM=new n.FM8,XM=new n.Pa4;function YM(e,t,i,r,s){const o=3*r,a=e.index.getX(o),l=e.index.getX(o+1),c=e.index.getX(o+2),u=function(e,t,i,r,s,o,a){GM.fromBufferAttribute(t,r),VM.fromBufferAttribute(t,s),HM.fromBufferAttribute(t,o);const l=function(e,t,i,r,s,o){let a;return a=o===n._Li?e.intersectTriangle(r,i,t,!0,s):e.intersectTriangle(t,i,r,o!==n.ehD,s),null===a?null:{distance:e.origin.distanceTo(s),point:s.clone()}}(e,GM,VM,HM,XM,a);if(l){i&&(QM.fromBufferAttribute(i,r),WM.fromBufferAttribute(i,s),qM.fromBufferAttribute(i,o),l.uv=n.CJI.getUV(XM,GM,VM,HM,QM,WM,qM,new n.FM8));const e={a:r,b:s,c:o,normal:new n.Pa4,materialIndex:0};n.CJI.getNormal(GM,VM,HM,e.normal),l.face=e,l.faceIndex=r}return l}(i,e.attributes.position,e.attributes.uv,a,l,c,t);return u?(u.faceIndex=r,s&&s.push(u),u):null}function KM(e,t,n,i){const r=e.a,s=e.b,o=e.c;let a=t,l=t+1,c=t+2;n&&(a=n.getX(t),l=n.getX(t+1),c=n.getX(t+2)),r.x=i.getX(a),r.y=i.getY(a),r.z=i.getZ(a),s.x=i.getX(l),s.y=i.getY(l),s.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function JM(e,t,n,i,r,s,o){const a=n.index,l=n.attributes.position;for(let c=e,u=t+e;c<u;c++)if(KM(o,3*c,a,l),o.needsUpdate=!0,i(o,c,r,s))return!0;return!1}class ZM{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function $M(e,t){return 65535===t[e+15]}function eT(e,t){return t[e+6]}function tT(e,t){return t[e+14]}function nT(e){return e+8}function iT(e,t){return t[e+6]}const rT=new n.ZzF,sT=new n.Pa4,oT=["x","y","z"];function aT(e,t,n,i,r){let s=2*e,o=fT,a=mT,l=gT;if($M(s,a))!function(e,t,n,i,r,s){for(let o=i,a=i+r;o<a;o++)YM(e,t,n,o,s)}(t,n,i,eT(e,l),tT(s,a),r);else{const s=nT(e);dT(s,o,i,sT)&&aT(s,t,n,i,r);const a=iT(e,l);dT(a,o,i,sT)&&aT(a,t,n,i,r)}}function lT(e,t,n,i){let r=2*e,s=fT,o=mT,a=gT;if($M(r,o))return function(e,t,n,i,r){let s=1/0,o=null;for(let a=i,l=i+r;a<l;a++){const i=YM(e,t,n,a);i&&i.distance<s&&(o=i,s=i.distance)}return o}(t,n,i,eT(e,a),tT(r,o));{const r=function(e,t){return t[e+7]}(e,a),o=oT[r],l=i.direction[o]>=0;let c,u;l?(c=nT(e),u=iT(e,a)):(c=iT(e,a),u=nT(e));const d=dT(c,s,i,sT)?lT(c,t,n,i):null;if(d){const e=d.point[o];if(l?e<=s[u+r]:e>=s[u+r+3])return d}const h=dT(u,s,i,sT)?lT(u,t,n,i):null;return d&&h?d.distance<=h.distance?d:h:d||h||null}}const cT=function(){let e,t;const i=[],r=new ZM((()=>new n.ZzF));return function(...n){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);const o=s(...n);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();const a=i.length;return a>0&&(t=i[a-1],e=i[a-2]),o};function s(n,i,r,o,a=null,l=0,c=0){function u(e){let t=2*e,n=mT,i=gT;for(;!$M(t,n);)t=2*(e=nT(e));return eT(e,i)}function d(e){let t=2*e,n=mT,i=gT;for(;!$M(t,n);)t=2*(e=iT(e,i));return eT(e,i)+tT(t,n)}let h=2*n,p=fT,f=mT,m=gT;if($M(h,f)){const t=eT(n,m),i=tT(h,f);return PM(n,p,e),o(t,i,!1,c,l+n,e)}{const h=nT(n),g=iT(n,m);let _,v,y,b,A=h,w=g;if(a&&(y=e,b=t,PM(A,p,y),PM(w,p,b),_=a(y),v=a(b),v<_)){A=g,w=h;const e=_;_=v,v=e,y=b}y||(y=e,PM(A,p,y));const x=r(y,$M(2*A,f),_,c+1,l+A);let E;if(2===x){const e=u(A);E=o(e,d(A)-e,!0,c+1,l+A,y)}else E=x&&s(A,i,r,o,a,l,c+1);if(E)return!0;b=t,PM(w,p,b);const C=r(b,$M(2*w,f),v,c+1,l+w);let S;if(2===C){const e=u(w);S=o(e,d(w)-e,!0,c+1,l+w,b)}else S=C&&s(w,i,r,o,a,l,c+1);return!!S}}}(),uT=function(){const e=new vS,t=new vS,i=new n.yGw,r=new zM,s=new zM;return function n(o,a,l,c,u=null){let d=2*o,h=fT,p=mT,f=gT;if(null===u&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),!$M(d,p)){const e=o+8,t=f[o+6];return PM(e,h,rT),!(!u.intersectsBox(rT)||!n(e,a,l,c,u))||(PM(t,h,rT),!(!u.intersectsBox(rT)||!n(t,a,l,c,u)))}{const n=a,r=n.index,u=n.attributes.position,m=l.index,g=l.attributes.position,_=eT(o,f),v=tT(d,p);if(i.copy(c).invert(),l.boundsTree){PM(o,h,s),s.matrix.copy(i),s.needsUpdate=!0;const e=l.boundsTree.shapecast({intersectsBounds:e=>s.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(let n=3*_,i=3*(v+_);n<i;n+=3)if(KM(t,n,r,u),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});return e}for(let s=3*_,o=v+3*_;s<o;s+=3){KM(e,s,r,u),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let n=0,i=m.count;n<i;n+=3)if(KM(t,n,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function dT(e,t,n,i){return PM(e,t,rT),n.intersectBox(rT,i)}const hT=[];let pT,fT,mT,gT;function _T(e){pT&&hT.push(pT),pT=e,fT=new Float32Array(e),mT=new Uint16Array(e),gT=new Uint32Array(e)}function vT(){pT=null,fT=null,mT=null,gT=null,hT.length&&_T(hT.pop())}const yT=Symbol("skip tree generation"),bT=new n.ZzF,AT=new n.ZzF,wT=new n.yGw,xT=new zM,ET=new zM,CT=new n.Pa4,ST=new n.Pa4,MT=new n.Pa4,TT=new n.Pa4,IT=new n.Pa4,PT=new n.ZzF,RT=new ZM((()=>new vS));class DT{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),DT.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,i=e._roots,r=n.getIndex();let s;return s=t.cloneBuffers?{roots:i.map((e=>e.slice())),index:r.array.slice()}:{roots:i,index:r.array},s}static deserialize(e,t,i={}){if("boolean"==typeof i)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),DT.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});i={setIndex:!0,...i};const{index:r,roots:s}=e,o=new DT(t,{...i,[yT]:!0});if(o._roots=s,i.setIndex){const i=t.getIndex();if(null===i){const i=new n.TlE(e.index,1,!1);t.setIndex(i)}else i.array!==r&&(i.array.set(r),i.needsUpdate=!0)}return o}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:wM,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[yT]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[yT]||(this._roots=function(e,t){const i=function(e,t){function i(e){p&&p(e/f)}function r(t,n,s,p=null,f=0){if(!m&&f>=c&&(m=!0,u&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),s<=d||f>=c)return i(n+s),t.offset=n,t.count=s,t;const g=function(e,t,n,i,r,s){let o=-1,a=0;if(s===wM)o=RM(t),-1!==o&&(a=(t[o]+t[o+3])/2);else if(s===xM)o=RM(e),-1!==o&&(a=function(e,t,n,i){let r=0;for(let s=t,o=t+n;s<o;s++)r+=e[6*s+2*i];return r/n}(n,i,r,o));else if(s===EM){const s=OM(e);let l=CM*r;const c=6*i,u=6*(i+r);for(let e=0;e<3;e++){const i=t[e],d=(t[e+3]-i)/UM;if(r<UM/4){const t=[...FM];t.length=r;let i=0;for(let r=c;r<u;r+=6,i++){const s=t[i];s.candidate=n[r+2*e],s.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:l}=s;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;BM(r,n,o)}t.sort(NM);let d=r;for(let e=0;e<d;e++){const n=t[e];for(;e+1<d&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),d--}for(let r=c;r<u;r+=6){const i=n[r+2*e];for(let e=0;e<d;e++){const s=t[e];i>=s.candidate?BM(r,n,s.rightCacheBounds):(BM(r,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<d;n++){const i=t[n],c=i.count,u=r-i.count,d=i.leftCacheBounds,h=i.rightCacheBounds;let p=0;0!==c&&(p=OM(d)/s);let f=0;0!==u&&(f=OM(h)/s);const m=SM+CM*(p*c+f*u);m<l&&(o=e,l=m,a=i.candidate)}}else{for(let e=0;e<UM;e++){const t=FM[e];t.count=0,t.candidate=i+d+e*d;const n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let r=c;r<u;r+=6){let t=~~((n[r+2*e]-i)/d);t>=UM&&(t=UM-1);const s=FM[t];s.count++,BM(r,n,s.bounds)}const t=FM[UM-1];DM(t.bounds,t.rightCacheBounds);for(let e=UM-2;e>=0;e--){const t=FM[e],n=FM[e+1];kM(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let h=0;for(let n=0;n<UM-1;n++){const t=FM[n],i=t.count,c=t.bounds,u=FM[n+1].rightCacheBounds;0!==i&&(0===h?DM(c,jM):kM(c,jM,jM)),h+=i;let d=0,p=0;0!==h&&(d=OM(jM)/s);const f=r-h;0!==f&&(p=OM(u)/s);const m=SM+CM*(d*h+p*f);m<l&&(o=e,l=m,a=t.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}(t.boundingData,p,a,n,s,h);if(-1===g.axis)return i(n+s),t.offset=n,t.count=s,t;const _=function(e,t,n,i,r){let s=n,o=n+i-1;const a=r.pos,l=2*r.axis;for(;;){for(;s<=o&&t[6*s+l]<a;)s++;for(;s<=o&&t[6*o+l]>=a;)o--;if(!(s<o))return s;for(let n=0;n<3;n++){let i=e[3*s+n];e[3*s+n]=e[3*o+n],e[3*o+n]=i;let r=t[6*s+2*n+0];t[6*s+2*n+0]=t[6*o+2*n+0],t[6*o+2*n+0]=r;let a=t[6*s+2*n+1];t[6*s+2*n+1]=t[6*o+2*n+1],t[6*o+2*n+1]=a}s++,o--}}(l,a,n,s,g);if(_===n||_===n+s)i(n+s),t.offset=n,t.count=s;else{t.splitAxis=g.axis;const e=new IM,i=n,l=_-n;t.left=e,e.boundingData=new Float32Array(6),LM(a,i,l,e.boundingData,o),r(e,i,l,o,f+1);const c=new IM,u=_,d=s-l;t.right=c,c.boundingData=new Float32Array(6),LM(a,u,d,c.boundingData,o),r(c,u,d,o,f+1)}return t}!function(e,t){if(!e.index){const i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let s;s=i>65535?new Uint32Array(new r(4*i)):new Uint16Array(new r(2*i)),e.setIndex(new n.TlE(s,1));for(let e=0;e<i;e++)s[e]=e}}(e,t);const s=new Float32Array(6),o=new Float32Array(6),a=function(e,t){const n=e.attributes.position,i=e.index.array,r=i.length/3,s=new Float32Array(6*r),o=n.normalized,a=n.array,l=n.offset||0;let c=3;n.isInterleavedBufferAttribute&&(c=n.data.stride);const u=["getX","getY","getZ"];for(let d=0;d<r;d++){const e=3*d,r=6*d;let h,p,f;o?(h=i[e+0],p=i[e+1],f=i[e+2]):(h=i[e+0]*c+l,p=i[e+1]*c+l,f=i[e+2]*c+l);for(let i=0;i<3;i++){let e,l,c;o?(e=n[u[i]](h),l=n[u[i]](p),c=n[u[i]](f)):(e=a[h+i],l=a[p+i],c=a[f+i]);let d=e;l<d&&(d=l),c<d&&(d=c);let m=e;l>m&&(m=l),c>m&&(m=c);const g=(m-d)/2,_=2*i;s[r+_+0]=d+g,s[r+_+1]=g+(Math.abs(d)+g)*TM,d<t[i]&&(t[i]=d),m>t[i+3]&&(t[i+3]=m)}}return s}(e,s),l=e.index.array,c=t.maxDepth,u=t.verbose,d=t.maxLeafTris,h=t.strategy,p=t.onProgress,f=e.index.count/3;let m=!1;const g=[],_=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];const t=[],n=new Set;for(const r of e.groups)n.add(r.start),n.add(r.start+r.count);const i=Array.from(n.values()).sort(((e,t)=>e-t));for(let r=0;r<i.length-1;r++){const e=i[r],n=i[r+1];t.push({offset:e/3,count:(n-e)/3})}return t}(e);if(1===_.length){const e=_[0],t=new IM;t.boundingData=s,function(e,t,n,i){let r=1/0,s=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let u=6*t,d=6*(t+n);u<d;u+=6){const t=e[u+0];t<r&&(r=t),t>a&&(a=t);const n=e[u+2];n<s&&(s=n),n>l&&(l=n);const i=e[u+4];i<o&&(o=i),i>c&&(c=i)}i[0]=r,i[1]=s,i[2]=o,i[3]=a,i[4]=l,i[5]=c}(a,e.offset,e.count,o),r(t,e.offset,e.count,o),g.push(t)}else for(let n of _){const e=new IM;e.boundingData=new Float32Array(6),LM(a,n.offset,n.count,e.boundingData,o),r(e,n.offset,n.count,o),g.push(e)}return g}(e,t);let r,s,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let n=0;n<i.length;n++){const e=i[n],t=new l(32*c(e));r=new Float32Array(t),s=new Uint32Array(t),o=new Uint16Array(t),u(0,e),a.push(t)}return a;function c(e){return e.count?1:1+c(e.left)+c(e.right)}function u(e,t){const n=e/4,i=e/2,a=!!t.count,l=t.boundingData;for(let s=0;s<6;s++)r[n+s]=l[s];if(a){const r=t.offset,a=t.count;return s[n+6]=r,o[i+14]=a,o[i+15]=MM,e+32}{const i=t.left,r=t.right,o=t.splitAxis;let a;if(a=u(e+32,i),a/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[n+6]=a/4,a=u(a,r),s[n+7]=o,a}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new n.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,i=t.attributes.position;let r,s,o,a,l=0;const c=this._roots;for(let d=0,h=c.length;d<h;d++)r=c[d],s=new Uint32Array(r),o=new Uint16Array(r),a=new Float32Array(r),u(0,l),l+=r.byteLength;function u(t,r,l=!1){const c=2*t;if(o[c+15]===MM){const e=s[t+6];let r=1/0,l=1/0,u=1/0,d=-1/0,h=-1/0,p=-1/0;for(let t=3*e,s=3*(e+o[c+14]);t<s;t++){const e=n[t],s=i.getX(e),o=i.getY(e),a=i.getZ(e);s<r&&(r=s),s>d&&(d=s),o<l&&(l=o),o>h&&(h=o),a<u&&(u=a),a>p&&(p=a)}return(a[t+0]!==r||a[t+1]!==l||a[t+2]!==u||a[t+3]!==d||a[t+4]!==h||a[t+5]!==p)&&(a[t+0]=r,a[t+1]=l,a[t+2]=u,a[t+3]=d,a[t+4]=h,a[t+5]=p,!0)}{const n=t+8,i=s[t+6],o=n+r,c=i+r;let d=l,h=!1,p=!1;e?d||(h=e.has(o),p=e.has(c),d=!h&&!p):(h=!0,p=!0);const f=d||p;let m=!1;(d||h)&&(m=u(n,r,d));let g=!1;f&&(g=u(i,r,d));const _=m||g;if(_)for(let e=0;e<3;e++){const r=n+e,s=i+e,o=a[r],l=a[r+3],c=a[s],u=a[s+3];a[t+e]=o<c?o:c,a[t+e+3]=l>u?l:u}return _}}}traverse(e,t=0){const n=this._roots[t],i=new Uint32Array(n),r=new Uint16Array(n);!function t(s,o=0){const a=2*s,l=r[a+15]===MM;if(l){const t=i[s+6],c=r[a+14];e(o,l,new Float32Array(n,4*s,6),t,c)}else{const r=s+8,a=i[s+6],c=i[s+7];e(o,l,new Float32Array(n,4*s,6),c)||(t(r,o+1),t(a,o+1))}}(0)}raycast(e,t=n.Wl3){const i=this._roots,r=this.geometry,s=[],o=t.isMaterial,a=Array.isArray(t),l=r.groups,c=o?t.side:t;for(let n=0,u=i.length;n<u;n++){const o=a?t[l[n].materialIndex].side:c,u=s.length;if(_T(i[n]),aT(0,r,o,e,s),vT(),a){const e=l[n].materialIndex;for(let t=u,n=s.length;t<n;t++)s[t].face.materialIndex=e}}return s}raycastFirst(e,t=n.Wl3){const i=this._roots,r=this.geometry,s=t.isMaterial,o=Array.isArray(t);let a=null;const l=r.groups,c=s?t.side:t;for(let n=0,u=i.length;n<u;n++){const s=o?t[l[n].materialIndex].side:c;_T(i[n]);const u=lT(0,r,s,e);vT(),null!=u&&(null==a||u.distance<a.distance)&&(a=u,o&&(u.face.materialIndex=l[n].materialIndex))}return a}intersectsGeometry(e,t){const n=this.geometry;let i=!1;for(const r of this._roots)if(_T(r),i=uT(0,n,e,t),vT(),i)break;return i}shapecast(e,t,n){const i=this.geometry;if(e instanceof Function){if(t){const e=t;t=(t,n,i,r)=>{const s=3*n;return e(t,s,s+1,s+2,i,r)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const r=RT.getPrimitive();let{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){const e=a;a=(t,n,s,o,a)=>!!e(t,n,s,o,a)||JM(t,n,i,l,s,o,r)}else a||(a=l?(e,t,n,s)=>JM(e,t,i,l,n,s,r):(e,t,n)=>n);let c=!1,u=0;for(const d of this._roots){if(_T(d),c=cT(0,i,o,a,s,u),vT(),c)break;u+=d.byteLength}return RT.releasePrimitive(r),c}bvhcast(e,t,n){let{intersectsRanges:i,intersectsTriangles:r}=n;const s=this.geometry.index,o=this.geometry.attributes.position,a=e.geometry.index,l=e.geometry.attributes.position;wT.copy(t).invert();const c=RT.getPrimitive(),u=RT.getPrimitive();if(r){function h(e,n,i,d,h,p,f,m){for(let g=i,_=i+d;g<_;g++){KM(u,3*g,a,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,i=e+n;t<i;t++)if(KM(c,3*t,s,o),c.needsUpdate=!0,r(c,u,t,g,h,p,f,m))return!0}return!1}if(i){const p=i;i=function(e,t,n,i,r,s,o,a){return!!p(e,t,n,i,r,s,o,a)||h(e,t,n,i,r,s,o,a)}}else i=h}e.getBoundingBox(AT),AT.applyMatrix4(t);const d=this.shapecast({intersectsBounds:e=>AT.intersectsBox(e),intersectsRange:(t,n,r,s,o,a)=>(bT.copy(a),bT.applyMatrix4(wT),e.shapecast({intersectsBounds:e=>bT.intersectsBox(e),intersectsRange:(e,r,a,l,c)=>i(t,n,e,r,s,o,l,c)}))});return RT.releasePrimitive(c),RT.releasePrimitive(u),d}intersectsBox(e,t){return xT.set(e.min,e.max,t),xT.needsUpdate=!0,this.shapecast({intersectsBounds:e=>xT.intersectsBox(e),intersectsTriangle:e=>xT.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},i={},r=0,s=1/0){e.boundingBox||e.computeBoundingBox(),xT.set(e.boundingBox.min,e.boundingBox.max,t),xT.needsUpdate=!0;const o=this.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,u=e.index,d=RT.getPrimitive(),h=RT.getPrimitive();let p=ST,f=MT,m=null,g=null;i&&(m=TT,g=IT);let _=1/0,v=null,y=null;return wT.copy(t).invert(),ET.matrix.copy(wT),this.shapecast({boundsTraverseOrder:e=>xT.distanceToBox(e),intersectsBounds:(e,t,n)=>n<_&&n<s&&(t&&(ET.min.copy(e.min),ET.max.copy(e.max),ET.needsUpdate=!0),!0),intersectsRange:(n,i)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>ET.distanceToBox(e),intersectsBounds:(e,t,n)=>n<_&&n<s,intersectsRange:(e,s)=>{for(let o=3*e,b=3*(e+s);o<b;o+=3){KM(h,o,u,c),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let e=3*n,t=3*(n+i);e<t;e+=3){KM(d,e,l,a),d.needsUpdate=!0;const t=d.distanceToTriangle(h,p,m);if(t<_&&(f.copy(p),g&&g.copy(m),_=t,v=e/3,y=o/3),t<r)return!0}}}});for(let e=0,s=u?u.count:c.count;e<s;e+=3){KM(h,e,u,c),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let t=3*n,s=3*(n+i);t<s;t+=3){KM(d,t,l,a),d.needsUpdate=!0;const n=d.distanceToTriangle(h,p,m);if(n<_&&(f.copy(p),g&&g.copy(m),_=n,v=t/3,y=e/3),n<r)return!0}}}}),RT.releasePrimitive(d),RT.releasePrimitive(h),_===1/0?null:(n.point?n.point.copy(f):n.point=f.clone(),n.distance=_,n.faceIndex=v,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(wT),f.applyMatrix4(wT),i.distance=f.sub(i.point).length(),i.faceIndex=y),n)}closestPointToPoint(e,t={},n=0,i=1/0){const r=n*n,s=i*i;let o=1/0,a=null;if(this.shapecast({boundsTraverseOrder:t=>(CT.copy(e).clamp(t.min,t.max),CT.distanceToSquared(e)),intersectsBounds:(e,t,n)=>n<o&&n<s,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,CT);const i=e.distanceToSquared(CT);return i<o&&(ST.copy(CT),o=i,a=n),i<r}}),o===1/0)return null;const l=Math.sqrt(o);return t.point?t.point.copy(ST):t.point=ST.clone(),t.distance=l,t.faceIndex=a,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{PM(0,new Float32Array(t),PT),e.union(PT)})),e}}const kT=1e6*(1+1e-7);function BT(e){return~~(e*kT)}function OT(e){return`${BT(e.x)},${BT(e.y)},${BT(e.z)}`}const LT=[new n.Pa4,new n.Pa4,new n.Pa4];class UT{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return-1===n?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return-1===n?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,i=e.index,r=n.position;let s=i?i.count/3:r.count/3;const o=s;let a=0;this.useDrawRange&&(a=e.drawRange.start,e.drawRange.count!==1/0&&(s=~~(e.drawRange.count/3)));let l=this.data;(!l||l.length<3*o)&&(l=new Int32Array(3*o)),l.fill(-1);let c=0,u=0;for(let d=0;d<s;d++){const e=3*d+a;for(let t=0;t<3;t++){let n=e+t;i&&(n=i.getX(n)),LT[t].fromBufferAttribute(r,n)}for(let n=0;n<3;n++){const i=(n+1)%3,r=LT[n],s=LT[i],o=OT(r),a=OT(s),d=`${a}_${o}`;if(t.has(d)){const i=t.get(d);l[e+n]=i,l[i]=e+n,t.delete(d),c--,u++}else{const i=`${o}_${a}`;t.set(i,e+n),c++}}}this.matchedEdges=u,this.unmatchedEdges=c,this.data=l}}class NT extends n.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new n.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,i=t.elements;for(let r=0;r<16;r++)if(n[r]!==i[r])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(PS())for(const n in t){const e=t[n];if(e.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");e.array=RS(e.array)}if(e.boundsTree||(e.boundsTree=new DT(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new UT(e)),!e.groupIndices){const t=e.index.count/3,n=new Uint16Array(t),i=e.groups;for(let e=0,r=i.length;e<r;e++){const{start:t,count:r}=i[e];for(let i=t/3,s=(t+r)/3;i<s;i++)n[i]=e}e.groupIndices=n}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function FT(e,t){let n=t;return Array.isArray(t)||(n=[],e.forEach((e=>{n[e.materialIndex]=t}))),n}class jT{constructor(){this.triangleSplitter=new IS,this.attributeData=new kS,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new LS}evaluate(e,t,i,r=new NT){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:s,attributeData:o,attributes:a,useGroups:l,debug:c}=this,u=r.geometry,d=e.geometry.attributes;for(let n=0,_=a.length;n<_;n++){const e=a[n],t=d[e];o.initializeArray(e,t.array.constructor)}for(const n in o.attributes)a.includes(n)||o.delete(n);for(const n in u.attributes)a.includes(n)||(u.deleteAttribute(n),u.dispose());o.clear(),c.enabled&&(c.reset(),oM(c)),function(e,t,n,i,r,s){const{useGroups:o=!0}=s,{aIntersections:a,bIntersections:l}=function(e,t){const n=new US,i=new US;return FS.copy(e.matrixWorld).invert().multiply(t.matrixWorld),e.geometry.boundsTree.bvhcast(t.geometry.boundsTree,FS,{intersectsTriangles(e,t,r,s){if(e.intersectsTriangle(t,XS,!0)){if(0===XS.distanceSq()&&e.plane.normal.dot(t.plane.normal)<1-1e-10)return!1;n.add(r,s),i.add(s,r),sM&&(sM.addEdge(XS),sM.addIntersectingTriangles(r,e,s,t))}return!1}}),{aIntersections:n,bIntersections:i}}(e,t);let c;c=o?0:-1,AM(e,t,a,n,!1,r,c),bM(e,t,a,n,!1,i,r,c),c=o?e.geometry.groups.length||1:-1,AM(t,e,l,n,!0,r,c),bM(t,e,l,n,!0,i,r,c)}(e,t,i,s,o,{useGroups:l}),c.enabled&&oM(null);const h=l&&0!==e.geometry.groups.length?e.geometry.groups.map((e=>({...e}))):[{start:0,count:1/0,materialIndex:0}],p=l&&0!==t.geometry.groups.length?t.geometry.groups.map((e=>({...e}))):[{start:0,count:1/0,materialIndex:0}],f=FT(h,e.material),m=FT(p,t.material);p.forEach((e=>{e.materialIndex+=f.length})),function(e,t,i,r){let s=!1,o=-1;const a=r.groupCount,l=e.attributes,c=r.groupAttributes[0];for(const d in c){const i=r.getTotalLength(d,a),u=c[d].type;let h=l[d];if(!h||h.array.length<i){const r=t.attributes[d];h=new n.TlE(new u(i),r.itemSize,r.normalized),e.setAttribute(d,h),s=!0}let p=0;for(let e=0;e<a;e++){const{array:t,type:n,length:i}=r.groupAttributes[e][d],s=new n(t.buffer,0,i);h.array.set(s,p),p+=s.length}h.needsUpdate=!0,o=i/h.itemSize}e.setDrawRange(0,o),e.clearGroups();let u=0;for(let n=0;n<a;n++){const t=r.getGroupArray("position",n).length/3;if(0!==t){const r=i[n];e.addGroup(u,t,r.materialIndex),u+=t}}if(e.index){const t=e.index.array;if(t.length<o)e.index=null,s=!0;else for(let e=0,n=t.length;e<n;e++)t[e]=e}e.boundsTree=null,s&&e.dispose()}(u,e.geometry,[...h,...p],o);const g=u.groups;if(l){const e=new Map,t=[...f,...m];let n=0;for(let i=0,r=t.length;i<r;i++)Boolean(g.find((e=>e.materialIndex===i)))?(e.set(i,n),n++):t[i]=null;for(let i=0,r=g.length;i<r;i++){const t=g[i];t.materialIndex=e.get(t.materialIndex)}r.material=t.filter((e=>e))}return r}evaluateHierarchy(e,t=new NT){e.updateMatrixWorld(!0);const n=(e,t)=>{const i=e.children;for(let r=0,s=i.length;r<s;r++){const e=i[r];e.isOperationGroup?n(e,t):t(e)}},i=e=>{const t=e.children;let r=!1;for(let n=0,o=t.length;n<o;n++){const e=t[n];r=i(e)||r}const s=e.isDirty();if(s&&e.markUpdated(),r&&!e.isOperationGroup){let t;return n(e,(n=>{t=t?this.evaluate(t,n,n.operation):this.evaluate(e,n,n.operation)})),e._cachedGeometry=t.geometry,e._cachedMaterials=t.material,!0}return r||s};return i(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const zT={union:lS,subtract:cS,intersect:dS,difference:uS};function GT(e,t){const i=new jT;i.useGroups=!0,i.attributes=["position","normal","uv"],e.forEach((e=>{for(const t of[...i.attributes])e[0].geometry.getAttribute(t)||i.attributes.splice(i.attributes.indexOf(t),1)}));let r=new NT(new n._12(.01,.01,2,2));e.forEach((([e,t])=>{if(!Object.keys(zT).includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const n=new NT;n.geometry=e.geometry,n.material=e.material,e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.updateMatrix(),n.updateMatrixWorld(),r=i.evaluate(r,n,zT[t])}));const s=r;return s.userData._isCSGMesh=!0,s}let VT=class extends sS{_buildCSGMesh(e){return GT(e)}};VT.PluginType="CSGPluginBVH",VT=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([We("CSG Plugin (BVH)")],VT);class HT extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,n,i,r;null===(n=null===(t=e.lastCamera)||void 0===t?void 0:t.removeControlsCtor)||void 0===n||n.call(t,this.controlsKey),null===(r=null===(i=e.camera)||void 0===i?void 0:i.setControlsCtor)||void 0===r||r.call(i,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var QT=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const WT=new n.Pa4(0,0,1),qT=new n.USm,XT=new n._fP,YT=new n._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),KT=new n._fP,JT={type:"change"};let ZT=class extends t.SimpleEventDispatcher{constructor(e){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new n._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new n._fP,this._initQuaternionInvert=new n._fP,this._initQuaternionDest=new n._fP,this._lastTime=-1,!1===window.isSecureContext&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=e,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))})).catch((e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new n._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const e=this.deviceOrientation;if(e){const t=null!==e.alpha?n.M8C.degToRad(e.alpha):0,i=null!==e.beta?n.M8C.degToRad(e.beta):0,r=null!==e.gamma?n.M8C.degToRad(e.gamma):0,s=this.screenOrientation?n.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(t,i,r,s),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(JT))}}dispose(){this.disconnect()}setObjectQuaternion(e,n,i,r){const s=(0,t.now)()/1e3;qT.set(n,e,-i,"YXZ"),KT.setFromEuler(qT),KT.multiply(YT),KT.multiply(XT.setFromAxisAngle(WT,-r)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(KT).invert(),this._initQuaternionDest.__init=!0),KT.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(KT,this.dampingFactor/(Math.min(1,s-this._lastTime)/(1/60))),this._lastTime=s}};QT([re(),Ue("Damping",[0,1],.01)],ZT.prototype,"dampingFactor",void 0),ZT=QT([qe("Device Orientation Controls")],ZT);class $T extends HT{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new ZT(e)}}$T.PluginType="DeviceOrientationControlsPlugin";var eI=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const tI=new n.Pa4,nI=new n.$V,iI=new n.Pa4,rI={type:"change"};let sI=class extends t.SimpleEventDispatcher{constructor(e,t){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new n.Pa4,this._lastTime=-1,this.object=e,this.domElement=t,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const e=this.object.quaternion;tI.set(0,0,-1).applyQuaternion(e),nI.setFromVector3(tI),this.lat=90-n.M8C.radToDeg(nI.phi),this.lon=n.M8C.radToDeg(nI.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(e){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(e){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(e){this.domElement===document?(this.pointerX=e.pageX-this.viewHalfX,this.pointerY=e.pageY-this.viewHalfY):(this.pointerX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(e,t,n){return e.isVector3?iI.copy(e):void 0===t||void 0===n?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):iI.set(e,t,n),this.object.lookAt(iI),this.setOrientation(),this}update(){const e=(0,t.now)(),i=(this._lastTime<0?16:Math.min(e-this._lastTime,1e3))/1e3;if(this._lastTime=e,!this.enabled)return;if(this.heightSpeed){const e=n.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=i*(e*this.heightCoef)}else this.autoSpeedFactor=0;const r=i*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);let s=i*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*s,this.lookVertical&&(this.lat-=this.pointerY*s*o),this.lat=Math.max(-85,Math.min(85,this.lat));let a=n.M8C.degToRad(90-this.lat);const l=n.M8C.degToRad(this.lon);this.constrainVertical&&(a=n.M8C.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;this.targetPosition.setFromSphericalCoords(1,a,l).add(c),this.object.lookAt(this.targetPosition),this.dispatchEvent(rI)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(e){this.enableKeys&&e.preventDefault()}};eI([re(),Oe()],sI.prototype,"enabled",void 0),eI([re(),Oe()],sI.prototype,"enableKeys",void 0),eI([re(),ze()],sI.prototype,"movementSpeed",void 0),eI([re(),ze()],sI.prototype,"lookSpeed",void 0),eI([re(),Oe()],sI.prototype,"lookVertical",void 0),eI([re(),Oe()],sI.prototype,"autoForward",void 0),eI([re(),Oe()],sI.prototype,"activeLook",void 0),eI([re(),Oe()],sI.prototype,"heightSpeed",void 0),eI([re(),ze()],sI.prototype,"heightCoef",void 0),eI([re(),ze()],sI.prototype,"heightMin",void 0),eI([re(),ze()],sI.prototype,"heightMax",void 0),eI([re(),Oe()],sI.prototype,"constrainVertical",void 0),eI([re(),ze()],sI.prototype,"verticalMin",void 0),eI([re(),ze()],sI.prototype,"verticalMax",void 0),eI([re(),Oe()],sI.prototype,"mouseDragOn",void 0),sI=eI([We("First Person Controls")],sI);class oI extends HT{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new sI(e,t)}}oI.PluginType="FirstPersonControlsPlugin";var aI=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const lI=new n.USm(0,0,0,"YXZ"),cI=new n.Pa4,uI={type:"change"},dI={type:"lock"},hI={type:"unlock"},pI=Math.PI/2;let fI=class extends t.SimpleEventDispatcher{constructor(e,t){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new n.Pa4(0,0,-1),this.domElement=t,this.object=e,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(e){this.isLocked||this.autoLockOnClick&&(e.preventDefault(),this.lock())}onMouseMove(e){this.isLocked&&(this._movementX+=e.movementX||e.mozMovementX||e.webkitMovementX||0,this._movementY+=e.movementY||e.mozMovementY||e.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(dI),this.isLocked=!0):(this.dispatchEvent(hI),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(e){return e.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(e){cI.setFromMatrixColumn(this.object.matrix,0),cI.crossVectors(this.object.up,cI),this.object.position.addScaledVector(cI,e)}moveRight(e){cI.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(cI,e)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(lI.setFromQuaternion(this.object.quaternion),lI.y-=.002*this._movementX*this.pointerSpeed,lI.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,lI.x=Math.max(pI-this.maxPolarAngle,Math.min(pI-this.minPolarAngle,lI.x)),this.object.quaternion.setFromEuler(lI),this.dispatchEvent(uI))}};aI([Oe(),re()],fI.prototype,"enabled",void 0),aI([ze(),re()],fI.prototype,"minPolarAngle",void 0),aI([ze(),re()],fI.prototype,"maxPolarAngle",void 0),aI([ze(),re()],fI.prototype,"pointerSpeed",void 0),aI([Oe(),re()],fI.prototype,"autoLockOnClick",void 0),fI=aI([qe("Pointer Lock Controls")],fI);class mI extends HT{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new fI(e,t.ownerDocument?t:t.documentElement)}}mI.PluginType="PointerLockControlsPlugin";const gI={type:"change"},_I={type:"start"},vI={type:"end"};class yI extends n.pBf{constructor(e,t){super();const i=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:n.RsA.ROTATE,MIDDLE:n.RsA.DOLLY,RIGHT:n.RsA.PAN},this.target=new n.Pa4;const s=1e-6,o=new n.Pa4;let a=1,l=r.NONE,c=r.NONE,u=0,d=0,h=0;const p=new n.Pa4,f=new n.FM8,m=new n.FM8,g=new n.Pa4,_=new n.FM8,v=new n.FM8,y=new n.FM8,b=new n.FM8,A=[],w={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const e=i.domElement.getBoundingClientRect(),t=i.domElement.ownerDocument.documentElement;i.screen.left=e.left+window.pageXOffset-t.clientLeft,i.screen.top=e.top+window.pageYOffset-t.clientTop,i.screen.width=e.width,i.screen.height=e.height};const x=function(){const e=new n.FM8;return function(t,n){return e.set((t-i.screen.left)/i.screen.width,(n-i.screen.top)/i.screen.height),e}}(),E=function(){const e=new n.FM8;return function(t,n){return e.set((t-.5*i.screen.width-i.screen.left)/(.5*i.screen.width),(i.screen.height+2*(i.screen.top-n))/i.screen.width),e}}();function C(e){!1!==i.enabled&&(0===A.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",S),i.domElement.addEventListener("pointerup",M)),function(e){A.push(e)}(e),"touch"===e.pointerType?function(e){if(1===(B(e),A.length))l=r.TOUCH_ROTATE,m.copy(E(A[0].pageX,A[0].pageY)),f.copy(m);else{l=r.TOUCH_ZOOM_PAN;const e=A[0].pageX-A[1].pageX,t=A[0].pageY-A[1].pageY;d=u=Math.sqrt(e*e+t*t);const n=(A[0].pageX+A[1].pageX)/2,i=(A[0].pageY+A[1].pageY)/2;y.copy(x(n,i)),b.copy(y)}i.dispatchEvent(_I)}(e):function(e){if(l===r.NONE)switch(e.button){case i.mouseButtons.LEFT:l=r.ROTATE;break;case i.mouseButtons.MIDDLE:l=r.ZOOM;break;case i.mouseButtons.RIGHT:l=r.PAN}const t=c!==r.NONE?c:l;t!==r.ROTATE||i.noRotate?t!==r.ZOOM||i.noZoom?t!==r.PAN||i.noPan||(y.copy(x(e.pageX,e.pageY)),b.copy(y)):(_.copy(x(e.pageX,e.pageY)),v.copy(_)):(m.copy(E(e.pageX,e.pageY)),f.copy(m)),i.dispatchEvent(_I)}(e))}function S(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){if(1===(B(e),A.length))f.copy(m),m.copy(E(e.pageX,e.pageY));else{const t=function(e){const t=e.pointerId===A[0].pointerId?A[1]:A[0];return w[t.pointerId]}(e),n=e.pageX-t.x,i=e.pageY-t.y;d=Math.sqrt(n*n+i*i);const r=(e.pageX+t.x)/2,s=(e.pageY+t.y)/2;b.copy(x(r,s))}}(e):function(e){const t=c!==r.NONE?c:l;t!==r.ROTATE||i.noRotate?t!==r.ZOOM||i.noZoom?t!==r.PAN||i.noPan||b.copy(x(e.pageX,e.pageY)):v.copy(x(e.pageX,e.pageY)):(f.copy(m),m.copy(E(e.pageX,e.pageY)))}(e))}function M(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(A.length){case 0:l=r.NONE;break;case 1:l=r.TOUCH_ROTATE,m.copy(E(e.pageX,e.pageY)),f.copy(m);break;case 2:l=r.TOUCH_ZOOM_PAN;for(let t=0;t<A.length;t++)if(A[t].pointerId!==e.pointerId){const e=w[A[t].pointerId];m.copy(E(e.x,e.y)),f.copy(m);break}}i.dispatchEvent(vI)}(e):(l=r.NONE,i.dispatchEvent(vI)),k(e),0===A.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",S),i.domElement.removeEventListener("pointerup",M)))}function T(e){k(e)}function I(e){!1!==i.enabled&&(window.removeEventListener("keydown",I),c===r.NONE&&(e.code!==i.keys[r.ROTATE]||i.noRotate?e.code!==i.keys[r.ZOOM]||i.noZoom?e.code!==i.keys[r.PAN]||i.noPan||(c=r.PAN):c=r.ZOOM:c=r.ROTATE))}function P(){!1!==i.enabled&&(c=r.NONE,window.addEventListener("keydown",I))}function R(e){if(!1!==i.enabled&&!0!==i.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:_.y-=.025*e.deltaY;break;case 1:_.y-=.01*e.deltaY;break;default:_.y-=25e-5*e.deltaY}i.dispatchEvent(_I),i.dispatchEvent(vI)}}function D(e){!1!==i.enabled&&e.preventDefault()}function k(e){delete w[e.pointerId];for(let t=0;t<A.length;t++)if(A[t].pointerId==e.pointerId)return void A.splice(t,1)}function B(e){let t=w[e.pointerId];void 0===t&&(t=new n.FM8,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}this.rotateCamera=function(){const e=new n.Pa4,t=new n._fP,r=new n.Pa4,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4;return function(){a.set(m.x-f.x,m.y-f.y,0);let n=a.length();n?(p.copy(i.object.position).sub(i.target),r.copy(p).normalize(),s.copy(i.object.up).normalize(),o.crossVectors(s,r).normalize(),s.setLength(m.y-f.y),o.setLength(m.x-f.x),a.copy(s.add(o)),e.crossVectors(a,p).normalize(),n*=i.rotateSpeed,t.setFromAxisAngle(e,n),p.applyQuaternion(t),i.object.up.applyQuaternion(t),g.copy(e),h=n):!i.staticMoving&&h&&(h*=Math.sqrt(1-i.dynamicDampingFactor),p.copy(i.object.position).sub(i.target),t.setFromAxisAngle(g,h),p.applyQuaternion(t),i.object.up.applyQuaternion(t)),f.copy(m)}}(),this.zoomCamera=function(){let e;l===r.TOUCH_ZOOM_PAN?(e=u/d,u=d,i.object.isPerspectiveCamera?p.multiplyScalar(e):i.object.isOrthographicCamera?(i.object.zoom=n.M8C.clamp(i.object.zoom/e,i.minZoom,i.maxZoom),a!==i.object.zoom&&i.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(v.y-_.y)*i.zoomSpeed,1!==e&&e>0&&(i.object.isPerspectiveCamera?p.multiplyScalar(e):i.object.isOrthographicCamera?(i.object.zoom=n.M8C.clamp(i.object.zoom/e,i.minZoom,i.maxZoom),a!==i.object.zoom&&i.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),i.staticMoving?_.copy(v):_.y+=(v.y-_.y)*this.dynamicDampingFactor)},this.panCamera=function(){const e=new n.FM8,t=new n.Pa4,r=new n.Pa4;return function(){if(e.copy(b).sub(y),e.lengthSq()){if(i.object.isOrthographicCamera){const t=(i.object.right-i.object.left)/i.object.zoom/i.domElement.clientWidth,n=(i.object.top-i.object.bottom)/i.object.zoom/i.domElement.clientWidth;e.x*=t,e.y*=n}e.multiplyScalar(p.length()*i.panSpeed),r.copy(p).cross(i.object.up).setLength(e.x),r.add(t.copy(i.object.up).setLength(e.y)),i.object.position.add(r),i.target.add(r),i.staticMoving?y.copy(b):y.add(e.subVectors(b,y).multiplyScalar(i.dynamicDampingFactor))}}}(),this.checkDistances=function(){i.noZoom&&i.noPan||(p.lengthSq()>i.maxDistance*i.maxDistance&&(i.object.position.addVectors(i.target,p.setLength(i.maxDistance)),_.copy(v)),p.lengthSq()<i.minDistance*i.minDistance&&(i.object.position.addVectors(i.target,p.setLength(i.minDistance)),_.copy(v)))},this.update=function(){p.subVectors(i.object.position,i.target),i.noRotate||i.rotateCamera(),i.noZoom||i.zoomCamera(),i.noPan||i.panCamera(),i.object.position.addVectors(i.target,p),i.object.isPerspectiveCamera?(i.checkDistances(),i.object.lookAt(i.target),o.distanceToSquared(i.object.position)>s&&(i.dispatchEvent(gI),o.copy(i.object.position))):i.object.isOrthographicCamera?(i.object.lookAt(i.target),(o.distanceToSquared(i.object.position)>s||a!==i.object.zoom)&&(i.dispatchEvent(gI),o.copy(i.object.position),a=i.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){l=r.NONE,c=r.NONE,i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.up.copy(i.up0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),p.subVectors(i.object.position,i.target),i.object.lookAt(i.target),i.dispatchEvent(gI),o.copy(i.object.position),a=i.object.zoom},this.dispose=function(){i.domElement.removeEventListener("contextmenu",D),i.domElement.removeEventListener("pointerdown",C),i.domElement.removeEventListener("pointercancel",T),i.domElement.removeEventListener("wheel",R),i.domElement.removeEventListener("pointermove",S),i.domElement.removeEventListener("pointerup",M),window.removeEventListener("keydown",I),window.removeEventListener("keyup",P)},this.domElement.addEventListener("contextmenu",D),this.domElement.addEventListener("pointerdown",C),this.domElement.addEventListener("pointercancel",T),this.domElement.addEventListener("wheel",R,{passive:!1}),window.addEventListener("keydown",I),window.addEventListener("keyup",P),this.handleResize(),this.update()}}var bI=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let AI=class extends yI{constructor(e,t){super(e,t),this.type="TrackballControls",this.enabled=!0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=999999,this.minZoom=0,this.maxZoom=999999,this.object=e}};bI([re()],AI.prototype,"type",void 0),bI([Oe()],AI.prototype,"enabled",void 0),bI([ze(),re()],AI.prototype,"rotateSpeed",void 0),bI([ze(),re()],AI.prototype,"zoomSpeed",void 0),bI([ze(),re()],AI.prototype,"panSpeed",void 0),bI([Oe(),re()],AI.prototype,"noRotate",void 0),bI([Oe(),re()],AI.prototype,"noZoom",void 0),bI([Oe(),re()],AI.prototype,"noPan",void 0),bI([Oe(),re()],AI.prototype,"noRoll",void 0),bI([Oe(),re()],AI.prototype,"staticMoving",void 0),bI([ze(),re()],AI.prototype,"dynamicDampingFactor",void 0),bI([ze(),re()],AI.prototype,"minDistance",void 0),bI([ze(),re()],AI.prototype,"maxDistance",void 0),bI([ze(),re()],AI.prototype,"minZoom",void 0),bI([ze(),re()],AI.prototype,"maxZoom",void 0),AI=bI([qe("Track Ball")],AI);class wI extends HT{constructor(){super(...arguments),this.controlsKey="trackball",this._controlsCtor=(e,t)=>new AI(e,t.ownerDocument?t:t.documentElement)}}wI.PluginType="TrackballControlsPlugin";var xI=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class EI extends _t{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.simplifyFactor=.5}get initialized(){return!0}async initialize(){}async onAdded(e){await super.onAdded(e),this._pickingPlugin=e.getPlugin(za)}simplifyGeometries(e,t){var n;if(!e){const t=null===(n=this._pickingPlugin)||void 0===n?void 0:n.getSelectedObject(),i=[];if(null==t||t.traverse((e=>{e.geometry&&!i.includes(e.geometry)&&i.push(e.geometry)})),!(e=i)||!e.length)return}Array.isArray(e)||(e=[e]);const i=[];for(const r of e)i.push(this.simplifyGeometry(r,t));return i}simplifyGeometry(e,{factor:t,count:i,replace:r=!0,disposeOnReplace:s=!1}={}){var o,a,l;if(!e){const t=null===(o=this._pickingPlugin)||void 0===o?void 0:o.getSelectedObject();if(!(e=null==t?void 0:t.geometry))return}if(!e.attributes.position)return null===(a=this._viewer)||void 0===a||a.console.error("SimplifyModifierPlugin: Geometry does not have position attribute",e),e;t=t||this.simplifyFactor,i=i||e.attributes.position.count*t,e.boundingBox||e.computeBoundingBox();const c=this._simplify(e,i);c.computeBoundingBox(),c.computeBoundingSphere(),c.computeVertexNormals();const u=c.boundingBox,d=u.getSize(new n.Pa4);if(!isFinite(d.x)||!isFinite(d.y)||!isFinite(d.z))return null===(l=this._viewer)||void 0===l||l.console.error("SimplifyModifierPlugin: Unable to simplify",e,c,d),e;const h=e.boundingBox,p=h.getSize(new n.Pa4),f=d.clone().sub(p),m=f.clone().divide(p);if(m.lengthSq()>.001&&console.warn("Simplify",e,c,u,h,d,p,f,m),!r)return c;const g=e.userData.__appliedMeshes;if(!g)return console.error("No meshes found for geometry, cannot replace",e),c;for(const n of g)n.setGeometry?n.setGeometry(c):n.geometry=c;return s&&e.dispose(!0),c}async simplifyAll(e,t){var n;if(!e&&this._viewer&&(e=this._viewer.scene.modelRoot),!e)return void console.error("SimplifyModifierPlugin: No root found");if(!this.initialized&&(await this.initialize(),!this.initialized))return void(null===(n=this._viewer)||void 0===n||n.console.error("SimplifyModifierPlugin cannot be initialized"));const i=[];if(e.modelObject.traverse((e=>{e.geometry&&!i.includes(e.geometry)&&i.push(e.geometry)})),i.length)return this.simplifyGeometries(i,t);console.error("SimplifyModifierPlugin: No geometries found")}async simplifySelected(){var e;if(!this._viewer)return;if(!this.initialized&&(await this.initialize(),!this.initialized))return void await this._viewer.alert("Simplify: SimplifyModifierPlugin cannot be initialized");const t=null===(e=this._pickingPlugin)||void 0===e?void 0:e.getSelectedObject();if(!t)return void await this._viewer.alert("Simplify: Nothing Selected");let n=!1;t.geometry?0===t.children.length&&(n=!0):n=!0,n||await this._viewer.confirm("Simplify: Simplify all in hierarchy?")&&(n=!0),n?this.simplifyGeometries():this.simplifyGeometry(t.geometry)}}EI.PluginType="SimplifyModifierPlugin",xI([Ue("Simplify Factor",[0,1])],EI.prototype,"simplifyFactor",void 0),xI([je("Simplify All",{sendArgs:!1})],EI.prototype,"simplifyAll",null),xI([je("Simplify Selected")],EI.prototype,"simplifySelected",null);var CI,SI=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let MI=CI=class extends EI{constructor(e=!0,t=document.head){super(),this.rootNode=t,this._initializing=void 0,this.errorThreshold=.5,this.lockBorder=!1,e&&this.initialize()}get initialized(){return!!window.MeshoptSimplifier}async initialize(){if(this.initialized)return;if(this._initializing)return await this._initializing;const e=document.createElement("script");e.type="module";const t=Math.random().toString(36).substring(7);return e.innerHTML=`\nimport { MeshoptSimplifier } from '${CI.SIMPLIFIER_URL}';\nMeshoptSimplifier.ready.then(() => {\nwindow.MeshoptSimplifier = MeshoptSimplifier;\nwindow.dispatchEvent(new CustomEvent('${t}'))\n});\n`,this._initializing=new Promise((n=>{window.addEventListener(t,(()=>n()),{once:!0}),this.rootNode.appendChild(e),this._script=e})),await this._initializing}dispose(){this._script&&(this._script.remove(),delete window.MeshoptSimplifier),this._script=void 0}_simplify(e,t){if(!this.initialized)throw new Error("MeshOptSimplifyModifierPlugin not initialized");const i=(e=e.index?e.clone():q(e)).index.array,r=e.attributes.position.array,s=t/e.attributes.position.count,o=3*Math.floor(s*i.length/3),[a,l]=window.MeshoptSimplifier.simplify(i,r,3,o,this.errorThreshold,this.lockBorder?["LockBorder"]:[]);return console.log("srcCount",i.length/3,"destCount",a.length/3),l&&console.log("Simplify error",l),e.setIndex(new n.TlE(new Uint32Array(a),1)),e}};MI.PluginType="MeshOptSimplifyModifierPlugin",MI.SIMPLIFIER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_simplifier.module.js",SI([ze()],MI.prototype,"errorThreshold",void 0),SI([Oe()],MI.prototype,"lockBorder",void 0),MI=CI=SI([We("Simplify Modifier (meshopt)")],MI);class TI{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new n.SUY}loadModel(e){this._model=e,this.mixer=new n.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var t;const n=[];null===(t=this._animations)||void 0===t||t.forEach((t=>{n.push(this.playClip(t,e))})),await Promise.all(n)}async reverseAllAnimation(e){var t;const n=[];null===(t=this._animations)||void 0===t||t.forEach((t=>{n.push(this.playClip(t,e,1,!0))})),await Promise.all(n)}async playClip(e,t,i=1,r=!1,s=!1){if(!this.mixer)return;const o=this.mixer.clipAction(e);return this._playingAnimations.has(o)&&this.mixer.dispatchEvent({type:"canceled",action:o}),s&&(this.mixer.setTime(0),this.mixer.stopAllAction()),r?(o.paused=!1,o.timeScale=-i):(o.reset(),o.timeScale=i),o.loop=t?n.YKA:n.jAl,o.clampWhenFinished=!0,new Promise((e=>{const t=async n=>{n.action===o&&(this.mixer.removeEventListener("finished",t),this.mixer.removeEventListener("canceled",t),this._playingAnimations.delete(o),e())};this.mixer.addEventListener("finished",t),this.mixer.addEventListener("canceled",t),this._playingAnimations.add(o),o.play()}))}playClipByName(e,t,n=1,i=!1){let r;this._animations.forEach((t=>{t.name===e&&(r=t)})),r&&this.playClip(r,t,n,i)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class II extends _t{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var t;await super.onAdded(e),null===(t=this._viewer)||void 0===t||t.addEventListener("postFrame",(()=>{this.helperIdentities.forEach((e=>{var t;e.update()&&(null===(t=this._viewer)||void 0===t||t.setDirty())}))}))}createHelper(e,t){var n;if(this.helperIdentities.has(e))null===(n=this._viewer)||void 0===n||n.console.warn("Helper with this id already exists");else{const n=new TI;n.loadModel(t),this.helperIdentities.set(e,n)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,t,n,i=1,r=!1,s=!1){if(this.helperIdentities.has(e)){const o=this.helperIdentities.get(e);await o.playClip(t,n,i,r,s)}}async playAllAnimations(e,t){if(this.helperIdentities.has(e)){const n=this.helperIdentities.get(e);await n.playAllAnimations(t)}}async playAllAnimationsInReverse(e,t){if(this.helperIdentities.has(e)){const n=this.helperIdentities.get(e);await n.reverseAllAnimation(t)}}async playAnimationByName(e,t,n,i=1,r=!1){if(this.helperIdentities.has(e)){const s=this.helperIdentities.get(e);await s.playClipByName(t,n,i,r)}}}II.PluginType="AnimationHelperPlugin";class PI extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,n,i)=>{(0,t.downloadBlob)(e,n)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,(({state:e,progress:n})=>{this.dispatchEvent({type:"transferFile",path:t,state:null!=e?e:"exporting",progress:n})})),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}PI.PluginType="FileTransferPlugin";var RI=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class DI extends _t{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:n.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[zd],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=e=>{this._preFrame(e)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,t,n;return null!==(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(zd))||void 0===t?void 0:t.camViews)&&void 0!==n?n:[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var t;if(!this.enabled)return;const i=this._cameraViews;if(i.length<=1)return;if(!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=n.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=n.M8C.clamp(this._oldState,0,i.length-1.001);const r=Math.floor(this._oldState),s=this._overrideStartView||i[r],o=this._overrideEndView||i[r+1];let a,l=this._overrideStartView?this._overrideTime:this._oldState-r;l=kd[this.animEase](l),a="spherical"===this.interpolateMode?this._lerpViewsSpherical(s,o,l):this._lerpViewsLinear(s,o,l);const c=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera;c&&(c.position.copy(a[0]),c.target.copy(a[1]),c.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,i){const r=new n.Pa4,s=new n.Pa4;return s.lerpVectors(e.position,t.position,i),r.lerpVectors(e.target,t.target,i),[s,r]}_lerpViewsSpherical(e,t,i){const r=e.target.clone(),s=new n.Pa4,o=new n.Pa4,a=Gd(e,e.target),l=Gd(t,t.target),c=new n.$V;return c.phi=Vd(a.phi,l.phi,i),c.theta=Vd(a.theta,l.theta,i),c.radius=n.M8C.lerp(a.radius,l.radius,i),s.copy(r).lerp(t.target,i),o.setFromSpherical(c),o.add(s),[o,s]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new jd(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),n=this._oldState-t;let i;i="spherical"===this.interpolateMode?this._lerpViewsSpherical(e[t],e[t+1],n):this._lerpViewsLinear(e[t],e[t+1],n),this._overrideEndView=new jd(i[0],i[1]),this._overrideTime=0}}DI.PluginType="CameraViewControlPlugin",RI([Oe("Enabled"),(0,t.onChange)(DI.prototype._onEnabledChanged1),re()],DI.prototype,"enabled",void 0),RI([re(),Fe("Ease",Object.keys(kd).map((e=>({label:e}))))],DI.prototype,"animEase",void 0),RI([re(),Fe("Interpolation",["spherical","linear"].map((e=>({label:e}))))],DI.prototype,"interpolateMode",void 0),RI([Oe("Enable Damping"),re()],DI.prototype,"enableDamping",void 0),RI([Ue("Damping",[.01,1],.001),re()],DI.prototype,"damping",void 0),RI([Ue("Init Anim Time",[.01,5],.001),re()],DI.prototype,"initAnimationTime",void 0);class kI extends DI{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...He(this)]},"string"==typeof e?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){var t;if(this.enabled&&!(this._cameraViews.length<=1))try{const t=this._findActiveView(),n=this._getScroll(t);this.setState(n+t),super._preFrame(e)}catch(e){return void((null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Debug"))&&console.error(e))}}_getScroll(e){var t,i;if(e>=this._cameraViews.length-1)return 0;const r=null!==(t=this.parent.querySelector(this._cameraViews[e].name))&&void 0!==t?t:this.parent.getElementsByTagName("section")[e],s=null!==(i=this.parent.querySelector(this._cameraViews[e+1].name))&&void 0!==i?i:this.parent.getElementsByTagName("section")[e+1],o=this.parent.getBoundingClientRect();if(!r||!s)return 0;const a=r.getBoundingClientRect(),l=s.getBoundingClientRect(),c=this.parent===document.body?0:o.top;return n.M8C.clamp((c-a.top)/Math.max(l.top-a.top,1e-4),0,1)}_findActiveView(){var e,t;for(let n=this._cameraViews.length-1;n>=0;n--){const i=null!==(e=this.parent.querySelector(this._cameraViews[n].name))&&void 0!==e?e:this.parent.getElementsByTagName("section")[n],r=this.parent.getBoundingClientRect();if(i){if(i.getBoundingClientRect().top<(this.parent===document.body?0:r.top))return n}else(null===(t=this._cameraViews[n].name)||void 0===t?void 0:t.startsWith("#"))&&console.error("section with id "+this._cameraViews[n].name+" doesn't exist!")}return 0}}kI.PluginType="ScrollableCameraViewPlugin";var BI,OI=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let LI=BI=class extends kI{generateCode(){var e;const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="200";const n=document.createElement("textarea");n.rows=20,n.style.border="3px solid #27223a",n.style.borderRadius="5px",n.style.width="30%",n.style.padding="5px",n.style.zIndex="1000";const i=document.createElement("div");i.textContent="X",i.style.color="red",i.style.width="20px",i.style.height="20px",i.style.padding="2",i.style.textAlign="center",i.style.backgroundColor="white",i.style.borderRadius="100%",i.style.border="2px solid #27223a",i.style.cursor="pointer",i.addEventListener("click",(()=>{var e;null===(e=this._viewer)||void 0===e||e.container.removeChild(t)}));const r=document.createElement("div");r.textContent="Update",r.style.marginTop="10px",r.style.color="white",r.style.padding="4px 10px 4px 10px",r.style.justifyContent="center",r.style.alignItems="center",r.style.backgroundColor="green",r.style.borderRadius="10px",r.style.border="2px solid #fff",r.style.cursor="pointer",r.addEventListener("click",(()=>{var e,t;const i=this.parent.innerHTML;this.parent.innerHTML=n.value;let r=0;for(;r<this._cameraViews.length;r++){let i;try{i=null!==(e=this.parent.querySelector(this._cameraViews[r].name))&&void 0!==e?e:this.parent.getElementsByTagName("section")[r]}catch(e){i=null}if(!i&&r<2){alert("you need to add 2 sections at least");break}if(!i){const e=(null===(t=this._cameraViews[r].name)||void 0===t||t.startsWith("#"),this._cameraViews[r].name.replace(/^#/,""));n.value+=e,n.value=this._format(n.value)}}r<2?this.parent.innerHTML=i:async function(e,t){var n;e.innerHTML=t;const i=e.getElementsByTagName("script");for(let r=0;r<i.length;r++){const e=i[r],t=Oy(e);let s=!1;await new Promise((e=>{t.onload=e,t.onerror=()=>{s=!0,e(void 0)}})),s||null===(n=e.parentNode)||void 0===n||n.replaceChild(t,e)}}(this.parent,n.value)})),t.appendChild(i),t.appendChild(n),t.appendChild(r),n.value=this._format(this.parent.innerHTML),null===(e=this._viewer)||void 0===e||e.container.appendChild(t)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(e=document.body,t=!1){super(e,t),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(e){var t,n,i,r,s,o;this.parent=this.wrapper,await super.onAdded(e),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(zd))||void 0===n||n.addEventListener("viewDelete",this.deleteView),null===(r=null===(i=this._viewer)||void 0===i?void 0:i.getPlugin(zd))||void 0===r||r.addEventListener("deserialize",this.deserialize),null===(o=null===(s=this._viewer)||void 0===s?void 0:s.getPlugin(zd))||void 0===o||o.addEventListener("viewAdd",this.addView)}deserialize(e){this._cameraViews.forEach((e=>{this._createSection(e.name)}))}_addWrapper(){var e;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",null===(e=this._viewer)||void 0===e||e.container.appendChild(this.wrapper)}_createSection(e){const t=document.createElement("section");t.style.width="100%",t.style.height="100%",t.style.opacity="50%",t.style.backgroundColor="black",t.style.zIndex="100",t.style.top="0",t.textContent=e,t.style.color="white",t.style.fontSize="100px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.id=e,this.parent.appendChild(t)}addView(e){this._cameraViews.forEach(((e,t)=>{var n,i;let r;try{r=null!==(n=this.parent.querySelector(e.name))&&void 0!==n?n:this.parent.getElementsByTagName("section")[t]}catch(e){r=null}if(!r){const t=`<section id="${(null===(i=e.name)||void 0===i?void 0:i.startsWith("#"))?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">\n                    ${e.name}\n                    </section>`;this.parent.innerHTML+=t}}))}deleteView(e){var t;try{const n=null!==(t=this.parent.querySelector(e.view.name))&&void 0!==t?t:this.parent.getElementsByTagName("section").namedItem(e.view.name);null==n||n.remove()}catch(e){return}}_format(e){let t="",n="";return e.split(/>\s*</).forEach((function(e){e.match(/^\/\w/)&&(n=n.substring(1)),t+=n+"<"+e+">\r\n",e.match(/^<?\w[^>]*[^/]$/)&&!e.startsWith("input")&&(n+="\t")})),t.substring(1,t.length-3)}};OI([je("Show/Edit Code")],LI.prototype,"generateCode",null),OI([Oe("Canvas on top"),(0,t.onChange)(BI.prototype._togglePreview)],LI.prototype,"canvasUp",void 0),LI=BI=OI([We("Scrollable Camera View Preview (Dev)")],LI);var UI={d:(e,t)=>{for(var n in t)UI.o(t,n)&&!UI.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},NI={};UI.d(NI,{Q:()=>rP});var FI=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};const jI=Symbol("Comlink.proxy"),zI=Symbol("Comlink.endpoint"),GI=Symbol("Comlink.releaseProxy"),VI=Symbol("Comlink.thrown"),HI=e=>"object"==typeof e&&null!==e||"function"==typeof e,QI=new Map([["proxy",{canHandle:e=>HI(e)&&e[jI],serialize(e){const{port1:t,port2:n}=new MessageChannel;return WI(e,t),[n,[n]]},deserialize:e=>(e.start(),XI(e))}],["throw",{canHandle:e=>HI(e)&&VI in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function WI(e,t=self){t.addEventListener("message",(function n(i){if(!i||!i.data)return;const{id:r,type:s,path:o}=Object.assign({path:[]},i.data),a=(i.data.argumentList||[]).map(tP);let l;try{const t=o.slice(0,-1).reduce(((e,t)=>e[t]),e),n=o.reduce(((e,t)=>e[t]),e);switch(s){case"GET":l=n;break;case"SET":t[o.slice(-1)[0]]=tP(i.data.value),l=!0;break;case"APPLY":l=n.apply(t,a);break;case"CONSTRUCT":l=$I(new n(...a));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;WI(e,n),l=function(e,t){return ZI.set(e,t),e}(t,[t])}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[VI]:0}}Promise.resolve(l).catch((e=>({value:e,[VI]:0}))).then((e=>{const[i,o]=eP(e);t.postMessage(Object.assign(Object.assign({},i),{id:r}),o),"RELEASE"===s&&(t.removeEventListener("message",n),qI(t))}))})),t.start&&t.start()}function qI(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function XI(e,t){return KI(e,[],t)}function YI(e){if(e)throw new Error("Proxy has been released and is not useable")}function KI(e,t=[],n=function(){}){let i=!1;const r=new Proxy(n,{get(n,s){if(YI(i),s===GI)return()=>nP(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{qI(e),i=!0}));if("then"===s){if(0===t.length)return{then:()=>r};const n=nP(e,{type:"GET",path:t.map((e=>e.toString()))}).then(tP);return n.then.bind(n)}return KI(e,[...t,s])},set(n,r,s){YI(i);const[o,a]=eP(s);return nP(e,{type:"SET",path:[...t,r].map((e=>e.toString())),value:o},a).then(tP)},apply(n,r,s){YI(i);const o=t[t.length-1];if(o===zI)return nP(e,{type:"ENDPOINT"}).then(tP);if("bind"===o)return KI(e,t.slice(0,-1));const[a,l]=JI(s);return nP(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:a},l).then(tP)},construct(n,r){YI(i);const[s,o]=JI(r);return nP(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},o).then(tP)}});return r}function JI(e){const t=e.map(eP);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const ZI=new WeakMap;function $I(e){return Object.assign(e,{[jI]:!0})}function eP(e){for(const[t,n]of QI)if(n.canHandle(e)){const[i,r]=n.serialize(e);return[{type:"HANDLER",name:t,value:i},r]}return[{type:"RAW",value:e},ZI.get(e)||[]]}function tP(e){switch(e.type){case"HANDLER":return QI.get(e.name).deserialize(e.value);case"RAW":return e.value}}function nP(e,t,n){return new Promise((i=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===r&&(e.removeEventListener("message",t),i(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:r},t),n)}))}class iP extends class{}{init(e,t,n,i){if(!this.api){if(!i)throw new Error("workerFilePath is required");(()=>{var r,s,o;r=this,o=function*(){const r=yield fetch(i).then((e=>e.blob())),s=URL.createObjectURL(r),o=new Worker(s,{type:"module"});this.api=yield new(XI(o))($I((()=>{e(),URL.revokeObjectURL(s)})),$I(((e,t)=>"xatlas_web.wasm"===e?n:e+t)),$I(t))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{a(o.next(e))}catch(e){t(e)}}function i(e){try{a(o.throw(e))}catch(e){t(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,i)}a((o=o.apply(r,[])).next())}))})()}}}class rP extends class{constructor(e,t={resolution:2048},n={},i=!1,r=!1,s=!1){this.THREE=e,this.packOptions=t,this.chartOptions=n,this.useNormals=i,this.timeUnwrap=r,this.logProgress=s,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,t,n){return FI(this,void 0,void 0,(function*(){if(!this._libraryLoaded){for(yield new Promise(((i,r)=>{try{this.xAtlas.init((()=>{i()}),e,t,n)}catch(e){r(e)}}));!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise((e=>setTimeout(e,100)));this._libraryLoaded=!0}}))}packAtlas(e,t="uv2",n="uv"){return FI(this,void 0,void 0,(function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const i=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise((e=>setTimeout(e,100)));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let r=[],s="";for(let t of e){let{uuid:e,index:n,attributes:o}=t;const a=t.userData.worldScale||1;r.push(e),n&&o.position&&3===o.position.itemSize?(s="Mesh"+r.length+" added to atlas: "+e,this.timeUnwrap&&console.time(s),yield this.xAtlas.api.addMesh(n.array,o.position.array,o.normal?o.normal.array:void 0,o.uv?o.uv.array:void 0,e,this.useNormals,i,a),this.timeUnwrap&&console.timeEnd(s)):console.warn("xatlas-three: Geometry not supported: ",t)}s="Generated atlas with "+r.length+" meshes",this.timeUnwrap&&console.time(s);let o=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(s);let a=[];for(let l of o){let i=e.find((e=>e.uuid===l.mesh));i?(l.vertex.vertices&&i.setAttribute("position",new this.THREE.BufferAttribute(l.vertex.vertices,3,!1)),l.vertex.normals&&i.setAttribute("normal",new this.THREE.BufferAttribute(l.vertex.normals,3,!0)),l.vertex.coords1&&i.setAttribute(t,new this.THREE.BufferAttribute(l.vertex.coords1,2,!1)),l.vertex.coords&&t!==n&&i.setAttribute(n,new this.THREE.BufferAttribute(l.vertex.coords,2,!1)),l.index&&i.setIndex(new this.THREE.BufferAttribute(l.index,1,!1)),a.push(i)):console.error("xatlas-three: Mesh not found: ",l.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,a}))}unwrapGeometry(e,t="uv",n="uv2"){return FI(this,void 0,void 0,(function*(){return this.packAtlas([e],t,n)}))}}{_createXAtlas(){return new iP}}var sP,oP=NI.Q,aP=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let lP=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};aP([re()],lP.prototype,"fixWinding",void 0),aP([re()],lP.prototype,"maxBoundaryLength",void 0),aP([re()],lP.prototype,"maxChartArea",void 0),aP([re()],lP.prototype,"maxCost",void 0),aP([re()],lP.prototype,"maxIterations",void 0),aP([re()],lP.prototype,"normalDeviationWeight",void 0),aP([re()],lP.prototype,"normalSeamWeight",void 0),aP([re()],lP.prototype,"roundnessWeight",void 0),aP([re()],lP.prototype,"straightnessWeight",void 0),aP([re()],lP.prototype,"textureSeamWeight",void 0),aP([re()],lP.prototype,"useInputMeshUvs",void 0),lP=aP([We("Chart Options"),de("UChartOptions")],lP);let cP=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};aP([re()],cP.prototype,"bilinear",void 0),aP([re()],cP.prototype,"blockAlign",void 0),aP([re()],cP.prototype,"bruteForce",void 0),aP([re()],cP.prototype,"createImage",void 0),aP([re()],cP.prototype,"maxChartSize",void 0),aP([re()],cP.prototype,"padding",void 0),aP([re()],cP.prototype,"resolution",void 0),aP([re()],cP.prototype,"rotateCharts",void 0),aP([re()],cP.prototype,"rotateChartsToAxis",void 0),aP([re()],cP.prototype,"texelsPerUnit",void 0),cP=aP([We("Pack Options"),de("UPackOptions")],cP);let uP=sP=class extends _t{constructor(e=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new lP,this.packOptions=new cP,this._loaded=!1,this._unwrapProgress=(e,t)=>{console.log("Unwrapping",e,t)},this.unwrapSelected=async()=>{var e,t,n,i,r;const s=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject();if(s)if(s.geometry){if(s.geometry.attributes.uv&&!await(null===(r=this._viewer)||void 0===r?void 0:r.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(s.geometry)}else null===(i=this._viewer)||void 0===i||i.alert("Unwrap: Selected object has no geometry");else null===(n=this._viewer)||void 0===n||n.alert("Unwrap: No object selected")},e&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,t.timeout)(100);else this._unwrapper=new oP({BufferAttribute:n.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,sP.LIBRARY_PATH+"xatlas.wasm",sP.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(e,t="uv",n="uv"){var i;await this.loadLibrary(),await(null===(i=this._unwrapper)||void 0===i?void 0:i.unwrapGeometry(e,t,n))}async packAtlas(e,t=!0,n="uv2",i="uv"){var r;await this.loadLibrary(),Array.isArray(e)||(e=[e]);const s=[];t?e.forEach((e=>e.traverse((e=>{e.geometry&&s.push(e.geometry)})))):e.forEach((e=>{e.geometry&&s.push(e.geometry)})),await(null===(r=this._unwrapper)||void 0===r?void 0:r.packAtlas(s,n,i))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};uP.PluginType="XAtlasPlugin",uP.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",aP([(0,t.onChange)(sP.prototype._useNormalsChanged),re()],uP.prototype,"useNormals",void 0),aP([re()],uP.prototype,"chartOptions",void 0),aP([re()],uP.prototype,"packOptions",void 0),aP([je("Unwrap Selected Geometry")],uP.prototype,"unwrapSelected",void 0),uP=sP=aP([We("UV Unwrapping (xAtlas)")],uP);class dP extends _t{constructor(){super(...arguments),this.dependencies=[Ls],this.enabled=!0,this.serializeWithViewer=!1,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,n)=>{let i=e.icon;return(i&&/^(\w+)\(([^)]*)\)/.exec(i)||/^#([A-Fa-f\d]+)$/.exec(i))&&(i=(0,t.makeColorSvg)(i)),i&&i.startsWith("http")&&i.startsWith("data:")||(i=this.utils.pathToIcon(this.baseUrl+n+"/"+e.prefix+(i||""))),i},getItemIcon:(e,n,i)=>{const r=e.iconFiles[n];if(r)return URL.createObjectURL(r);let s=e.icons[n];return(s&&/^(\w+)\(([^)]*)\)/.exec(s)||/^#([A-Fa-f\d]+)$/.exec(s))&&(s=(0,t.makeColorSvg)(s)),s||(s=this.utils.pathToIcon(e.items[n])),!s||s.startsWith("http")||s.startsWith("data:")||(s=this.baseUrl+i+"/"+e.prefix+s),s},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,n)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${n}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,n,i=!1){var r,s;if(!this._viewer)return;const o=this._getVariationId(e);"number"==typeof t&&(t=e.items[t]);const a=e.items.indexOf(t);if(-1===a)return void this._viewer.console.warn(`Item ${t} not found`);const l=e.itemFiles[a],c=e.selected;if(!i&&c===a)return;e.selected=a;const u=this._viewer.getManager(),d=this.utils.getItemPath(e,a,n);if("objects"===n){let e=this._viewer.scene.findObjectsByName(o).map((e=>e.modelObject));0===e.length&&(e=[(await this._viewer.createObject3D()).modelObject],e[0].name=o),this._viewer.renderEnabled=!1;for(const s of e)[...s.children].forEach((e=>e.dispose&&this.autoDispose?e.dispose():e.removeFromParent()));const t=await this._loadObject(d,l);if(!t.length)return void(d.endsWith("json")||this._viewer.console.warn(`Object ${d} not found`));let n=!1;for(const s of e){[...s.children].forEach((e=>e.dispose&&this.autoDispose?e.dispose():e.removeFromParent()));for(const e of t)n?s.add(e.modelObject.clone()):s.add(e.modelObject);n=!0}const i=[],r=this.variations.materials.filter((e=>e&&"number"==typeof e.selected));for(const s of r)i.push(this.applyVariation(s,s.selected,"materials",!0));await Promise.all(i),this._viewer.renderEnabled=!0}if("materials"===n){const t=await this._loadMaterial(d,l);if(!t)return void this._viewer.console.warn(`Material ${d} not found`);t.userData.__isVariation=!0;const n=this._viewer.scene.findObjectsByName(o),i=n=>{var i,r,s;n.material&&(Array.isArray(n.material)?0!==n.material.length&&(null===(i=e.data)||void 0===i?void 0:i.matType)!==n.material[0].typeSlug:(null===(r=e.data)||void 0===r?void 0:r.matType)!==n.material.typeSlug)||null===(s=null==n?void 0:n.setMaterial)||void 0===s||s.call(n,t)};for(const s of n)(null===(r=e.data)||void 0===r?void 0:r.traverse)?s.traverse(i):i(s);null===(s=u.materials)||void 0===s||s.applyMaterial(t,o)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const e=this._getVariationId(t),n=this._viewer.scene.findObjectsByName(e);for(const t of n)[...t.children].forEach((e=>{var t;return(null!==(t=e.dispose)&&void 0!==t?t:e.removeFromParent)()}))}}async _loadMaterial(e,t){var n,i,r;return null===(r=null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getManager())||void 0===i?void 0:i.importer)||void 0===r?void 0:r.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){var n,i,r;return null===(r=null===(i=null===(n=this._viewer)||void 0===n?void 0:n.getManager())||void 0===i?void 0:i.importer)||void 0===r?void 0:r.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){var n,i;"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.baseUrl&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t="object"==typeof e.folder?e.folder:"string"==typeof e.folder?Ps(us(e.folder)):Ps(e.folder));for(const r of this._ty)if(e[r])for(const s of e[r]){const e={items:s.items,prefix:s.prefix,name:s.name,title:s.title||"",icon:s.icon||"",icons:null!==(n=s.icons)&&void 0!==n?n:s.items.map((()=>"")),titles:null!==(i=s.titles)&&void 0!==i?i:s.items.map((()=>"")),itemFiles:[],iconFiles:[],data:{...s.data}};if(t)for(let n=0;n<s.items.length;n++){const i=s.items[n],o=t[r+"/"+s.prefix+i];e.itemFiles[n]=o?new File([o],i):void 0;const a=s.icons[n];if(!a)continue;const l=t[r+"/"+s.prefix+a];e.iconFiles[n]=l?new File([l],a):void 0}this.variations[r].push(e)}}async importPath(e){var t,n;if(e.endsWith(".json")){const i=await(null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getManager().importer)||void 0===n?void 0:n.importSinglePath(e,{processImported:!1})),r=e.split("?")[0];return this.baseUrl||(this.baseUrl=r.substring(0,r.lastIndexOf("/")+1)),this.importConfig(i)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var t;return(null===(t=this.variations.materials.find((t=>this.utils.getName(t)===e)))||void 0===t?void 0:t.items)||[]}getObjects(e){var t;return(null===(t=this.variations.objects.find((t=>this.utils.getName(t)===e)))||void 0===t?void 0:t.items)||[]}getMaterialVariations(){return this.variations.materials.map((e=>this.utils.getName(e)))}getObjectVariations(){return this.variations.objects.map((e=>this.utils.getName(e)))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var e;let t={objects:{},materials:{}};const n={objects:[],materials:[],type:dP.PluginType};this.baseUrl&&(n.baseUrl=this.baseUrl);let i=!1;for(const r of this._ty)for(const s of this.variations[r]){const o={...s};o.data={...o.data},delete o.itemFiles,delete o.iconFiles,n[r].push(o);const a=s.prefix.replace(/^\//,""),l=a.trimEnd().endsWith("/")?"":a.split("/").pop()||"",c=a.replace(l,"").trimEnd().replace(/\/$/,""),u={};let d=!1;for(let t=0;t<s.items.length;t++){const n=s.items[t],i=s.itemFiles[t],r=s.iconFiles[t],o=s.icons[t];i?(u[l+n]=new Uint8Array(await i.arrayBuffer()),r&&!o&&(null===(e=this._viewer)||void 0===e||e.console.error("Icon file without icon name")),r&&o&&(u[l+o]=new Uint8Array(await r.arrayBuffer())),d=!0):r&&alert("Icon file without model/material file not supported")}if(!d)continue;i=!0;const h=c.split("/");let p=t[r];for(const e of h){p[e]||(p[e]={});const t=p[e];if("object"!=typeof t)throw new Error("Invalid prefix: "+s.prefix);p=t}Object.assign(p,u)}return i||(t=void 0),{folder:t,config:n}}}dP.PluginType="VariationConfiguratorPlugin";class hP extends dP{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled)return!1;if(!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,am.RemoveAll(hP.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])am.Create(hP.PluginType,this.utils.getTitle(t),5,20,0,t.items.map(((n,i)=>({id:n,image:this.utils.getItemIcon(t,i,e),onClick:async n=>this.applyVariation(t,n,e,!1),tooltip:this.utils.getItemTitle(t,i)}))),((e,t)=>M_(e,{placement:"bottom",content:t.tooltip})));return am.RebuildUi(this._viewer.container),!0}}hP.PluginType="VariationConfiguratorPlugin";class pP extends hP{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map((e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map((n=>({type:"folder",expanded:this._uiExpandedState[n.name],onExpand:()=>this._uiExpandedState[n.name]=!0,onCollapse:()=>this._uiExpandedState[n.name]=!1,label:()=>this.utils.getName(n),children:[{type:"input",placeholder:()=>this.utils.getName(n),property:[n,"name"]},{type:"input",property:[n,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(n)),property:[n,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+n.prefix),property:[n,"icon"]},{type:"folder",label:"items",children:n.items.map(((i,r)=>({type:"folder",label:()=>n.items[r],children:[{type:"input",label:"File/URL",isMonitor:!n.itemFiles[r],getValue:()=>n.items[r],setValue:e=>{n.items[r]=e}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(n.items[r]),getValue:()=>n.icons[r],setValue:e=>{n.icons[r]=e}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(n.items[r]),getValue:()=>n.titles[r],setValue:e=>{n.titles[r]=e}},{type:"button",label:"Apply",value:async()=>this.applyVariation(n,r,e)},n.itemFiles[r]?[{type:"button",label:"Remove",value:()=>{n.items.splice(r,1),n.itemFiles.splice(r,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const e=await(0,t.uploadFile)(!1,!1);0!==e.length&&(n.itemFiles[r]=e[0],n.items[r]=e[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const e=n.itemFiles[r];(0,t.downloadBlob)(e,e.name)}}]:{}]})))},{type:"button",label:"Add item (local)",value:async()=>{var i,r,s;const o=await(0,t.uploadFile)(!0,!1);if(0!==o.length){for(const t of o){if(!this._extForType[e].includes(null!==(i=t.name.split(".").pop())&&void 0!==i?i:"")){await(null===(r=this._viewer)||void 0===r?void 0:r.alert(`Invalid file: ${t.name} is not a valid ${e} file`));continue}if(n.items.includes(t.name)){await(null===(s=this._viewer)||void 0===s?void 0:s.alert(`Already exists: Item with name ${t.name} already exists`));continue}const o=n.items.push(t.name)-1;n.icons[o]="",n.titles[o]="",n.itemFiles[o]=t}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var t,i,r,s,o;const a=await(null===(t=this._viewer)||void 0===t?void 0:t.prompt("URL: Enter the url of the object/material"));if(!a)return;if(!a.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await(null===(i=this._viewer)||void 0===i?void 0:i.alert(`Invalid url: ${a} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(null!==(r=a.split(".").pop())&&void 0!==r?r:""))return void await(null===(s=this._viewer)||void 0===s?void 0:s.alert(`Invalid url: ${a} should be of a material ending with mat`));n.items.includes(a)&&await(null===(o=this._viewer)||void 0===o?void 0:o.alert(`Already exists: Item with url ${a} already exists`)),n.items.push(a);const l=n.items.length-1;n.icons[l]="",n.titles[l]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(n),value:async()=>{var t;await(null===(t=this._viewer)||void 0===t?void 0:t.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(n)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(n),1),this.refreshUi())}}]}))),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var t;const n=await(null===(t=this._viewer)||void 0===t?void 0:t.prompt("Name: Enter the name of the object/material"));n&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:n+"/",name:n,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var n,i,r,s;const o=await(0,t.uploadFile)(!1,!0);if(0===o.length)return;const a=[],l=[],c=[],u=[];for(const t of o){if(t.name.startsWith("."))continue;const s=null!==(n=t.name.split(".").pop())&&void 0!==n?n:"";s?this._extForType[e].includes(s)?(a.push(t.webkitRelativePath.replace(/^\//,"")),l.push(t)):this._extForType.images.includes(s)?(c.push(t.webkitRelativePath.replace(/^\//,"")),u.push(t)):await(null===(r=this._viewer)||void 0===r?void 0:r.alert(`Invalid file: ${t.name} is not a valid ${e} file`)):await(null===(i=this._viewer)||void 0===i?void 0:i.alert(`Invalid file: ${t.name} has no extension`))}const d=(0,t.longestCommonPrefix)(a),h=this.utils.getName({prefix:d});let p=await(null===(s=this._viewer)||void 0===s?void 0:s.prompt("Name: Enter the name of the object/material",h,!0));if(null===p)return;p=p||h;const f=a.map((e=>{var t;const n=e.replace(d,""),i=null!==(t=n.split(".").pop())&&void 0!==t?t:"",r=n.replace("."+i,"")+".",s=c.findIndex((e=>e.replace(d,"").startsWith(r)));return s<0?["",void 0]:[c[s].replace(d,""),u[s]||void 0]}));this.variations[e].push({items:a.map((e=>e.replace(d,""))),icons:f.map((e=>e[0])),iconFiles:f.map((e=>e[1])),titles:a.map((()=>"")),itemFiles:l,prefix:d,name:p,icon:"",title:""}),this.refreshUi()}}]}))),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,n;try{const{folder:e,config:n}=await this._exportConfiguratorState(),i=JSON.stringify(n,null,4);if(e){e["config.json"]=us(i);const n=await Es(e),r=new Blob([n],{type:"application/zip"});(0,t.downloadBlob)(r,"configurator.zip")}else{const e=new Blob([i],{type:"application/json"});(0,t.downloadBlob)(e,"config.json")}}catch(t){return null===(e=this._viewer)||void 0===e||e.console.error(t),void await(null===(n=this._viewer)||void 0===n?void 0:n.alert("Error: "+((null==t?void 0:t.message)||t)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var e,n,i;const r=await(0,t.uploadFile)(!1,!1,"application/zip,application/json");if(0===r.length)return;const s=r[0];if(s.name.endsWith(".zip")){const t=Ps(new Uint8Array(await s.arrayBuffer()));if(!t["config.json"])return void await(null===(e=this._viewer)||void 0===e?void 0:e.alert("Invalid zip: config.json not found"));const n=JSON.parse(ds(t["config.json"]));this.importConfig(n,t)}else{if(!s.name.endsWith(".json"))return void await(null===(n=this._viewer)||void 0===n?void 0:n.alert("Invalid file: "+s.name));{const e=JSON.parse(await s.text());this.importConfig(e)}}await(null===(i=this._viewer)||void 0===i?void 0:i.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var e,t;const n=await(null===(e=this._viewer)||void 0===e?void 0:e.prompt("URL: Enter the url of the json file."));n&&(await this.importPath(n),await(null===(t=this._viewer)||void 0===t?void 0:t.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,t;null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const n=await super._loadObject(e,t);for(const i of n)(i.modelObject||i).userData.excludeFromExport=!0;return n}}pP.PluginType="VariationConfiguratorPlugin";class fP extends _t{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=e=>{const t=e.object;(null==t?void 0:t.traverse)&&t.traverse((e=>{var t,n;void 0===e.userData[fP.PluginType]&&(e.userData[fP.PluginType]={transforms:[]});const i={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var t;this.addTransform(e),null===(t=null==i?void 0:i.uiRefresh)||void 0===t||t.call(i)}},()=>{var t;return null===(t=e.userData[fP.PluginType])||void 0===t?void 0:t.transforms.map(((t,n)=>({type:"folder",label:`Transform ${n}`,children:[{type:"vec3",label:"Position",property:[t,"position"]},{type:"vec3",label:"Quaternion",property:[t,"quaternion"]},{type:"vec3",label:"Scale",property:[t,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(e,t)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(e,t)}}]})))}]};null===(n=null===(t=e.uiConfig)||void 0===t?void 0:t.children)||void 0===n||n.push(i)}))}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e){e.userData[fP.PluginType].transforms.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}setTransform(e,t){var n,i,r,s;e.position.copy(t.position),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale),null===(i=(n=e.userData).setDirty)||void 0===i||i.call(n),null===(s=null===(r=e.uiConfig)||void 0===r?void 0:r.uiRefresh)||void 0===s||s.call(r)}animateTransform(e,t,i=2e3){var r,s;const o=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("PopmotionPlugin");o||null===(s=this._viewer)||void 0===s||s.console.error("PopmotionPlugin required for animation");const a="number"==typeof t?e.userData[fP.PluginType].transforms[t]:t,l=new n.Pa4,c=new n._fP,u=new n.Pa4,d=e.position.clone(),h=e.quaternion.clone(),p=e.scale.clone(),f=a.position,m=a.quaternion,g=a.scale;return null==o?void 0:o.animate({from:0,to:1,duration:i,onUpdate:t=>{var n,i;l.lerpVectors(d,f,t),c.slerpQuaternions(h,m,t),u.lerpVectors(p,g,t),e.position.copy(l),e.quaternion.copy(c),e.scale.copy(u),null===(n=this._viewer)||void 0===n||n.setDirty(),null===(i=this._viewer)||void 0===i||i.renderer.resetShadows()},onStop:()=>{var t,n,i,r;e.position.copy(a.position),e.quaternion.copy(a.quaternion),e.scale.copy(a.scale),null===(n=(t=e.userData).setDirty)||void 0===n||n.call(t),null===(r=null===(i=e.uiConfig)||void 0===i?void 0:i.uiRefresh)||void 0===r||r.call(i)}})}}fP.PluginType="TransformAnimationPlugin";var mP=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let gP=class extends _t{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const e of this.cameras){if(!e.enabled)continue;const n=this._viewer,i=e.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:e}),n.scene.renderCamera=i,n.renderer.render(!1);const t=n.renderer.composer.readBuffer;this.dispatchEvent({type:"preBlitCamera",camera:e,readBuffer:t}),n.renderer.blit(t.texture,e.target),this.dispatchEvent({type:"postRenderCamera",camera:e})}catch(t){console.error(t),e.enabled=!1}}},this.enabled=e}async onAdded(e){await super.onAdded(e),e.addEventListener("preRender",this._preRender)}addCamera(e){if(!this._viewer)throw"Plugin not added to viewer";const t={camera:e,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(t),t}};function _P(e,t,i,r,s){const o=e.getAttribute(t),a=r.length/i;return o&&o.count===a?(o.set(r),o.needsUpdate=!0):e.setAttribute(t,new(null!=s?s:n.a$l)(r,i)),o}function vP(e,t){var n,i,r;if(!e.uiConfig)return;let s=null===(n=e.uiConfig.children)||void 0===n?void 0:n.find((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.includes("generatedGeometry")}));s||(s={type:"folder",label:"Generation Params",tags:["generatedGeometry"],children:[]},null===(i=e.uiConfig.children)||void 0===i||i.push(s)),e.userData.__generationParamsUiType!==e.userData.generationParams.type&&(s.children=t(),e.userData.__generationParamsUiType=e.userData.generationParams.type,null===(r=s.uiRefresh)||void 0===r||r.call(s,"postFrame",!0))}gP.PluginType="VirtualCamerasPlugin",mP([Oe()],gP.prototype,"enabled",void 0),gP=mP([We("Virtual Cameras")],gP);class yP{constructor(e){this.type=e}createUiConfig(e){const n=He(e.userData.generationParams).filter((e=>{var n;return"type"!==(null===(n=(0,t.getOrCall)(e.property))||void 0===n?void 0:n[1])}));return n.forEach((t=>{t.onChange=()=>this.generate(e)})),n}generate(e,t={}){const i=null!=e?e:new n.u9r;if(i.userData.generationParams||(i.userData.generationParams={type:this.type}),i.userData.generationParams.type=this.type,t.type)return console.error("Cannot set type parameter here, use the plugin instead"),i;const r={...this.defaultParams,...i.userData.generationParams,...t},{indices:s,vertices:o,normals:a,uvs:l,groups:c}=this._generateData(r);if(function(e,t){const n=e.index;n&&n.count===t.length?(n.set(t),n.needsUpdate=!0):e.setIndex(t)}(i,s),_P(i,"position",3,o),_P(i,"normal",3,a),_P(i,"uv",2,l),c){i.clearGroups();for(const e of c)i.addGroup(e.start,e.count,e.materialIndex)}return i.computeBoundingBox(),i.computeBoundingSphere(),Object.assign(i.userData.generationParams,r),vP(i,(()=>this.createUiConfig(i))),i.dispatchEvent({type:"geometryUpdate"}),i}}class bP extends yP{constructor(){super(...arguments),this.defaultParams={radius:1,widthSegments:32,heightSegments:16,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}}_generateData(e){const{radius:t,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o}=e;let{widthSegments:a,heightSegments:l}=e;a=Math.max(3,Math.floor(a)),l=Math.max(2,Math.floor(l));const c=Math.min(s+o,Math.PI);let u=0;const d=[],h=new n.Pa4,p=new n.Pa4,f=[],m=[],g=[],_=[];for(let n=0;n<=l;n++){const e=[],f=n/l;let v=0;0===n&&0===s?v=.5/a:n===l&&c===Math.PI&&(v=-.5/a);for(let n=0;n<=a;n++){const l=n/a;h.x=-t*Math.cos(i+l*r)*Math.sin(s+f*o),h.y=t*Math.cos(s+f*o),h.z=t*Math.sin(i+l*r)*Math.sin(s+f*o),m.push(h.x,h.y,h.z),p.copy(h).normalize(),g.push(p.x,p.y,p.z),_.push(l+v,1-f),e.push(u++)}d.push(e)}for(let n=0;n<l;n++)for(let e=0;e<a;e++){const t=d[n][e+1],i=d[n][e],r=d[n+1][e],o=d[n+1][e+1];(0!==n||s>0)&&f.push(t,i,o),(n!==l-1||c<Math.PI)&&f.push(i,r,o)}return{indices:f,vertices:m,normals:g,uvs:_}}}class AP extends yP{constructor(){super(...arguments),this.defaultParams={width:1,height:1,widthSegments:2,heightSegments:2}}_generateData(e){const t=e.width/2,n=e.height/2,i=Math.floor(e.widthSegments),r=Math.floor(e.heightSegments),s=i+1,o=r+1,a=e.width/i,l=e.height/r,c=[],u=[],d=[],h=[];for(let p=0;p<o;p++){const e=p*l-n;for(let n=0;n<s;n++){const s=n*a-t;u.push(s,-e,0),d.push(0,0,1),h.push(n/i),h.push(1-p/r)}}for(let p=0;p<r;p++)for(let e=0;e<i;e++){const t=e+s*p,n=e+s*(p+1),i=e+1+s*(p+1),r=e+1+s*p;c.push(t,n,r),c.push(n,i,r)}return{indices:c,vertices:u,normals:d,uvs:h}}}class wP extends yP{constructor(){super(...arguments),this.defaultParams={radius:1,segments:32,thetaStart:0,thetaLength:2*Math.PI}}_generateData(e){const{radius:t,thetaStart:i,thetaLength:r}=e,s=Math.max(3,e.segments),o=[],a=[],l=[],c=[],u=new n.Pa4,d=new n.FM8;a.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let n=0,h=3;n<=s;n++,h+=3){const e=i+n/s*r;u.x=t*Math.cos(e),u.y=t*Math.sin(e),a.push(u.x,u.y,u.z),l.push(0,0,1),d.x=(a[h]/t+1)/2,d.y=(a[h+1]/t+1)/2,c.push(d.x,d.y)}for(let n=1;n<=s;n++)o.push(n,n+1,0);return{indices:o,vertices:a,normals:l,uvs:c}}}class xP extends yP{constructor(){super(...arguments),this.defaultParams={radius:1,tube:.4,radialSegments:12,tubularSegments:48,arc:2*Math.PI}}_generateData(e){const{radius:t,tube:i,arc:r}=e;let{radialSegments:s,tubularSegments:o}=e;s=Math.floor(s),o=Math.floor(o);const a=[],l=[],c=[],u=[],d=new n.Pa4,h=new n.Pa4,p=new n.Pa4;for(let n=0;n<=s;n++)for(let e=0;e<=o;e++){const a=e/o*r,f=n/s*Math.PI*2;h.x=(t+i*Math.cos(f))*Math.cos(a),h.y=(t+i*Math.cos(f))*Math.sin(a),h.z=i*Math.sin(f),l.push(h.x,h.y,h.z),d.x=t*Math.cos(a),d.y=t*Math.sin(a),p.subVectors(h,d).normalize(),c.push(p.x,p.y,p.z),u.push(e/o),u.push(n/s)}for(let n=1;n<=s;n++)for(let e=1;e<=o;e++){const t=(o+1)*n+e-1,i=(o+1)*(n-1)+e-1,r=(o+1)*(n-1)+e,s=(o+1)*n+e;a.push(t,i,s),a.push(i,r,s)}return{indices:a,vertices:l,normals:c,uvs:u}}}class EP extends yP{constructor(){super(...arguments),this.defaultParams={radiusTop:1,radiusBottom:1,height:1,radialSegments:32,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI}}_generateTorso(e){const{radiusTop:t,radiusBottom:i,height:r,radialSegments:s,heightSegments:o,thetaStart:a,thetaLength:l,indexArray:c,indices:u,groups:d,vertices:h,normals:p,uvs:f,groupStart:m,halfHeight:g}=e,_=new n.Pa4,v=new n.Pa4;let y=0;const b=(i-t)/r;for(let n=0;n<=o;n++){const u=[],d=n/o,m=d*(i-t)+t;for(let t=0;t<=s;t++){const n=t/s,i=n*l+a,o=Math.sin(i),c=Math.cos(i);v.x=m*o,v.y=-d*r+g,v.z=m*c,h.push(v.x,v.y,v.z),_.set(o,b,c).normalize(),p.push(_.x,_.y,_.z),f.push(n,1-d),u.push(e.index++)}c.push(u)}for(let n=0;n<s;n++)for(let e=0;e<o;e++){const t=c[e][n],i=c[e+1][n],r=c[e+1][n+1],s=c[e][n+1];u.push(t,i,s),u.push(i,r,s),y+=6}d.push({start:m,count:y,materialIndex:0}),e.groupStart+=y}_generateCap(e,t){const{radiusTop:i,radiusBottom:r,radialSegments:s,thetaStart:o,thetaLength:a,indices:l,groups:c,vertices:u,normals:d,uvs:h,groupStart:p,halfHeight:f}=e,m=e.index,g=new n.FM8,_=new n.Pa4;let v=0;const y=!0===t?i:r,b=!0===t?1:-1;for(let n=1;n<=s;n++)u.push(0,f*b,0),d.push(0,b,0),h.push(.5,.5),e.index++;const A=e.index;for(let n=0;n<=s;n++){const t=n/s*a+o,i=Math.cos(t),r=Math.sin(t);_.x=y*r,_.y=f*b,_.z=y*i,u.push(_.x,_.y,_.z),d.push(0,b,0),g.x=.5*i+.5,g.y=.5*r*b+.5,h.push(g.x,g.y),e.index++}for(let n=0;n<s;n++){const e=m+n,i=A+n;!0===t?l.push(i,i+1,e):l.push(i+1,i,e),v+=3}c.push({start:p,count:v,materialIndex:!0===t?1:2}),e.groupStart+=v}_generateData(e){let{radialSegments:t,heightSegments:n}=e;t=Math.floor(t),n=Math.floor(n);const i={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[],index:0,indexArray:[],halfHeight:e.height/2,...e,radialSegments:t,heightSegments:n};return this._generateTorso(i),!1===e.openEnded&&(e.radiusTop>0&&this._generateCap(i,!0),e.radiusBottom>0&&this._generateCap(i,!1)),i}}class CP extends yP{constructor(){super(...arguments),this.defaultParams={width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1}}_buildPlane(e,t,i,r,s,o,a,l,c,u,d,h){const{indices:p,vertices:f,normals:m,uvs:g,numberOfVertices:_,groupStart:v,groups:y}=e,b=a/u,A=l/d,w=a/2,x=l/2,E=c/2,C=u+1,S=d+1;let M=0,T=0;const I=new n.Pa4;for(let n=0;n<S;n++){const e=n*A-x;for(let a=0;a<C;a++){const l=a*b-w;I[t]=l*s,I[i]=e*o,I[r]=E,f.push(I.x,I.y,I.z),I[t]=0,I[i]=0,I[r]=c>0?1:-1,m.push(I.x,I.y,I.z),g.push(a/u),g.push(1-n/d),M+=1}}for(let n=0;n<d;n++)for(let e=0;e<u;e++){const t=_+e+C*n,i=_+e+C*(n+1),r=_+(e+1)+C*(n+1),s=_+(e+1)+C*n;p.push(t,i,s),p.push(i,r,s),T+=6}y.push({start:v,count:T,materialIndex:h}),e.groupStart+=T,e.numberOfVertices+=M}_generateData(e){const{width:t,height:n,depth:i}=e;let{widthSegments:r,heightSegments:s,depthSegments:o}=e;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const a={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[]};return this._buildPlane(a,"z","y","x",-1,-1,i,n,t,o,s,0),this._buildPlane(a,"z","y","x",1,-1,i,n,-t,o,s,1),this._buildPlane(a,"x","z","y",1,1,t,i,n,r,o,2),this._buildPlane(a,"x","z","y",1,-1,t,i,-n,r,o,3),this._buildPlane(a,"x","y","z",1,-1,t,n,i,r,s,4),this._buildPlane(a,"x","y","z",-1,-1,t,n,-i,r,s,5),a}}class SP extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.generators={plane:new AP("plane"),sphere:new bP("sphere"),box:new CP("box"),circle:new wP("circle"),torus:new xP("torus"),cylinder:new EP("cylinder")},this._sceneUpdate=e=>{var t;if(e.hierarchyChanged){const n=e.object||(null===(t=this._viewer)||void 0===t?void 0:t.scene.modelRoot);n&&n.traverse((e=>{var t,n,i;const r=null===(i=null===(n=null===(t=e.geometry)||void 0===t?void 0:t.userData)||void 0===n?void 0:n.generationParams)||void 0===i?void 0:i.type;r&&vP(e.geometry,(()=>{var t;const n=this.generators[r];return(null==n?void 0:n.createUiConfig)&&null!==(t=n.createUiConfig(e.geometry))&&void 0!==t?t:[]}))}))}},this.uiConfig={type:"folder",label:"Generate Geometry",children:[()=>Object.keys(this.generators).map((e=>({type:"button",label:"Generate "+e,value:async()=>{(await this.generateObject(e)).name=e}})))]}}async generateObject(e){var t,i;const r=this.generators[e];if(!r)throw new Error("Unknown generator type: "+e);const s=await(null===(i=null===(t=this._viewer)||void 0===t?void 0:t.getManager())||void 0===i?void 0:i.addImportedSingle(new n.Kj0(new n.u9r,new Pt({color:16711680})),{autoScale:!1,autoCenter:!1}));return r.generate(s.modelObject.geometry),s.name=e,s.geometry.name="Generated "+e,s.modelObject}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}}SP.PluginType="GeometryGeneratorPlugin";var MP=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let TP=class extends _t{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.dependencies=[ub],this._exporting=!1}async exportObject(e){var t,n;const i=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(ub);if(!i)throw new Error("AssetExporterPlugin not found");return e?null===(n=i.exporter)||void 0===n?void 0:n.exportObject(e,{format:"glb"}):i.exportScene(i.exportOptions)}async getLink(e){var t;const n=await this.exportObject(e);if(!n)throw new Error("Failed to export object or scene");const i=await fetch("https://bee.transfr.one/model.glb",{method:"PUT",body:n});if(200!==i.status)throw new Error("Failed to upload file");const r=null===(t=await i.text())||void 0===t?void 0:t.trim();console.log(r);try{new URL(r)}catch(e){throw new Error("Invalid URL "+r)}return r}async shareLink(e,t="m"){var n;if(this._exporting)return;this._exporting=!0;let i=await this.getLink().catch((e=>{var t,n;return null===(t=this._viewer)||void 0===t||t.console.error(e),null===(n=this._viewer)||void 0===n||n.alert("Error: Failed to share scene: \n"+e.message),null}));if(i){if(e){const n="string"==typeof e?new URL(e):e;n.searchParams.set(null!=t?t:"m",i),i=n.href}let r=!1;try{window&&window.navigator&&navigator.clipboard&&(await navigator.clipboard.writeText(i),r=!0)}catch(e){console.error("Failed to copy link",e)}null===(n=this._viewer)||void 0===n||n.alert("Link"+(r?" Copied: ":": "+i)+"\n\nNote: File will be deleted in 7 days")}return this._exporting=!1,i}async shareEditorLink(){const e=new URL(window.location.href);return this.shareLink(e)}async shareViewerLink(){const e=new URL(window.location.href);return e.pathname=e.pathname.replace(/editor\.html$/,"viewer.html"),this.shareLink(e)}};TP.PluginType="TransfrSharePlugin",MP([je("Share editor link")],TP.prototype,"shareEditorLink",null),MP([je("Share viewer link")],TP.prototype,"shareViewerLink",null),TP=MP([We("Share Link (transfr.one)")],TP);var IP=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let PP=class extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.prefix="",this.count=50,this.loops=1,this.color=(new n.Ilk).setHSL(0,.8,.5)}colorItems(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot;let t=0;const i=this.color.getHSL({h:0,s:0,l:0});e.traverse((e=>{const r=e.material&&e.material.isDiamondMaterial,s=r&&e.name.startsWith(this.prefix);if(r&&console.log("Found Diamond, name = ",e.name,", coloring = ",s),s){let r=e.name.replace(this.prefix,"");r=parseFloat(r)/this.count;const s=(new n.Ilk).setHSL((this.loops*r+i.h)%1,i.s,i.l);e.material=e.material.userData.isColoredClone?e.material:e.material.clone(),e.material.color.set(s),e.material.boostFactors.set(1,1,1),e.material.userData.isColoredClone=!0,t++}})),console.log("total",t),this._viewer.setDirty()}};PP.PluginType="RainbowDiamondPlugin",IP([ze("Object name prefix")],PP.prototype,"prefix",void 0),IP([ze("Count")],PP.prototype,"count",void 0),IP([ze("Loops")],PP.prototype,"loops",void 0),IP([Ge("First Color")],PP.prototype,"color",void 0),IP([je("Color All Items")],PP.prototype,"colorItems",null),PP=IP([We("Rainbow Diamond Coloring")],PP);class RP extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=null,this.ringSlots=[],this.dependencies=[Ls,jC],this._animating=!1,this._runningAnimations=[],this.uiConfig={type:"folder",label:"Bering Animation",children:[{label:"Play Animation",type:"button",value:()=>{this.startRingAnimation(!1)}},{label:"Record Animation",type:"button",value:async()=>{var e;const n=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("CanvasRecorder");if(!n||n.isRecording())return;this.animating&&this.stopRingAnimation(!1),await(0,t.timeout)(500);const i=await n.record((async()=>{console.log("start"),await this.startRingAnimation(!1),console.log("finish")}));i&&(console.log("recorded",i),(0,t.downloadBlob)(i,"animation.mp4"))}}]}}get animating(){return this._animating}set animating(e){var t,n;if(this._animating===e)return;this._animating=e;const i=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(Io);i&&(e?i.disable("bering"):i.enable("bering"));const r=null===(n=this._viewer)||void 0===n?void 0:n.getPlugin(yh);r&&(r.enabled=!e)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",(e=>{var t,n,i,r,s;if(!(null===(n=null===(t=e.options)||void 0===t?void 0:t.allImported)||void 0===n?void 0:n.length)||!e.object)return;if(!e.object.__importedViewerConfig&&!(null===(i=e.object.modelObject)||void 0===i?void 0:i.__importedViewerConfig)||!(null===(r=e.options)||void 0===r?void 0:r.allImported))return;let o=0;const a=null===(s=e.options)||void 0===s?void 0:s.allImported.filter((e=>!!(e&&e.modelObject&&e.name.endsWith("bmod")))).reverse();a.forEach((e=>{this.loadRingBMod(e,e.name,o,a.length-1),o++}))}))}loadRingBMod(e,t,n,i){var r,s,o;if(!t)return;if(!(null===(r=this._viewer)||void 0===r?void 0:r.getPlugin(Ls)))throw new Error("no asset manager");this._runningAnimations&&this.stopRingAnimation(),t.endsWith(".bmod")||(t+=".bmod");const a=null==e?void 0:e.modelObject;if(!a||!e)throw new Error("no model");a.userData.__ringSlot=n,this.ringSlots[n]=e;const l=[];a.traverse((e=>{e.userData.rotationCount>1&&l.push(e)})),(new p).expandByObjects(l,!0,!0),t.toLowerCase().includes("x3")||t.toLowerCase().includes("x4");const c=parseInt(t.split("-").pop().toLowerCase().replace("x","").replace(".bmod",""))+1;return a.userData.__ringWidth=c,a.userData.__ringTotalSlots=i,null===(o=null===(s=this._viewer)||void 0===s?void 0:s.scene)||void 0===o||o.setDirty({sceneUpdate:!0,frameFade:!1}),e}clearAllSlots(){this.ringSlots.forEach((e=>{e.modelObject.removeFromParent()})),this.ringSlots=[]}stopRingAnimation(e=!0){var t,n;if(0!==this._runningAnimations.length){for(const e of this._runningAnimations)e.stop();this._runningAnimations=[],e&&(null===(n=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(Io))||void 0===n||n.startTransition(1200))}}async startRingAnimation(e=!0){if(this.animating||!this._viewer)return;this.stopRingAnimation(),this.animating=!0;let t=0;const i=[];await new Promise((r=>{var s,o,a;if(!this._viewer)return;const l=()=>{t+=1,t<i.length||r()},c=2500,u=this._viewer.getPlugin(jC),d=this.ringSlots[0];if(d){const t=d.modelObject,r={left:[],right:[],rem:[]};t.traverse((e=>{const t=(null==e?void 0:e.name.trim().toLowerCase().replace(/[0-9]/g,""))||"";t.endsWith("-s")?r.left.push(e):t.endsWith("-l")?r.right.push(e):t.startsWith("testlogo")&&r.rem.push(e)}));const h=[];for(const e of r.left){const t=(null===(s=e.parent)||void 0===s?void 0:s.children)||[];h.push(...t)}for(const e of r.right){const t=(null===(o=e.parent)||void 0===o?void 0:o.children)||[];h.push(...t)}for(const e of h)r.left.includes(e)||r.right.includes(e)||r.rem.includes(e)||r.rem.push(e);for(const e of r.rem)(new p).expandByObject(e,!1,!0).getCenter(new n.Pa4).x<=0?r.left.push(e):r.right.push(e);for(const e of[...r.left,...r.right])e.userData.__initX=e.position.x,e.userData.__initRotX=e.rotation.x;const f=null===(a=this._viewer)||void 0===a?void 0:a.getPluginByType("Ground");if(r.left.length>0&&r.right.length>0){const t=t=>n=>{var i,s,o;for(const e of r[t])e.position.x=n+e.userData.__initX;null===(s=null===(i=this._viewer)||void 0===i?void 0:i.scene)||void 0===s||s.setDirty({sceneUpdate:!1,frameFade:!1}),e&&(null===(o=null==f?void 0:f.shadowBaker)||void 0===o||o.reset())},n=e=>t=>{var n,i;for(const s of r[e])s.rotation.x=t+s.userData.__initRotX;null===(i=null===(n=this._viewer)||void 0===n?void 0:n.scene)||void 0===i||i.setDirty({sceneUpdate:!1,frameFade:!1})};i.push(u.animate({from:0,to:-.75,onUpdate:t("left"),onStop:()=>{t("left")(0),l()},onComplete:l,duration:c,ease:kd.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),i.push(u.animate({from:0,to:.75,onUpdate:t("right"),onStop:()=>{t("right")(0),l()},onComplete:l,duration:c,ease:kd.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),i.push(u.animate({from:0,to:1.5*-Math.PI,onUpdate:n("left"),onStop:()=>{n("left")(0),l()},onComplete:l,duration:1250,ease:kd.easeInOut,repeat:1,repeatDelay:2750,repeatType:"mirror"}))}}this.ringSlots.forEach((e=>{if(d===e)return;const t=e.modelObject.userData.__ringSlot,n=e.modelObject.userData.__ringTotalSlots,r=e.modelObject.userData.__ringWidth,s=e.modelObject.position.x;i.push(u.animate({from:s,to:s+.75-1.5*(1-(t+1)/(n+1+(2-r))),onUpdate:t=>{var n,i;e.modelObject.position.x=t,null===(i=null===(n=this._viewer)||void 0===n?void 0:n.scene)||void 0===i||i.setDirty({sceneUpdate:!1,frameFade:!1})},onStop:()=>{e.modelObject.position.x=s,l()},onComplete:l,duration:c,ease:kd.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"}))})),i.length>0?this._runningAnimations=i:(this.animating=!1,r())})),this.animating=!1;for(const n of this._runningAnimations)n.stop();this._runningAnimations=[],console.log("animation end")}}RP.PluginType="BeringRingAnimation";class DP{constructor(e){void 0===e&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){void 0===e&&(e=new BP);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){void 0===t&&(t=new BP);const n=this.elements,i=e.x,r=e.y,s=e.z;return t.x=n[0]*i+n[1]*r+n[2]*s,t.y=n[3]*i+n[4]*r+n[5]*s,t.z=n[6]*i+n[7]*r+n[8]*s,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){void 0===t&&(t=new DP);const n=this.elements,i=e.elements,r=t.elements,s=n[0],o=n[1],a=n[2],l=n[3],c=n[4],u=n[5],d=n[6],h=n[7],p=n[8],f=i[0],m=i[1],g=i[2],_=i[3],v=i[4],y=i[5],b=i[6],A=i[7],w=i[8];return r[0]=s*f+o*_+a*b,r[1]=s*m+o*v+a*A,r[2]=s*g+o*y+a*w,r[3]=l*f+c*_+u*b,r[4]=l*m+c*v+u*A,r[5]=l*g+c*y+u*w,r[6]=d*f+h*_+p*b,r[7]=d*m+h*v+p*A,r[8]=d*g+h*y+p*w,t}scale(e,t){void 0===t&&(t=new DP);const n=this.elements,i=t.elements;for(let r=0;3!==r;r++)i[3*r+0]=e.x*n[3*r+0],i[3*r+1]=e.y*n[3*r+1],i[3*r+2]=e.z*n[3*r+2];return t}solve(e,t){void 0===t&&(t=new BP);const n=[];let i,r;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(r=0;r<3;r++)n[i+4*r]=this.elements[i+3*r];n[3]=e.x,n[7]=e.y,n[11]=e.z;let s=3;const o=s;let a,l;do{if(i=o-s,0===n[i+4*i])for(r=i+1;r<o;r++)if(0!==n[i+4*r]){a=4;do{l=4-a,n[l+4*i]+=n[l+4*r]}while(--a);break}if(0!==n[i+4*i])for(r=i+1;r<o;r++){const e=n[i+4*r]/n[i+4*i];a=4;do{l=4-a,n[l+4*r]=l<=i?0:n[l+4*r]-n[l+4*i]*e}while(--a)}}while(--s);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){void 0===e&&(e=new DP);const t=kP;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let r=3;const s=r;let o,a;do{if(n=s-r,0===t[n+6*n])for(i=n+1;i<s;i++)if(0!==t[n+6*i]){o=6;do{a=6-o,t[a+6*n]+=t[a+6*i]}while(--o);break}if(0!==t[n+6*n])for(i=n+1;i<s;i++){const e=t[n+6*i]/t[n+6*n];o=6;do{a=6-o,t[a+6*i]=a<=n?0:t[a+6*i]-t[a+6*n]*e}while(--o)}}while(--r);n=2;do{i=n-1;do{const e=t[n+6*i]/t[n+6*n];o=6;do{a=6-o,t[a+6*i]=t[a+6*i]-t[a+6*n]*e}while(--o)}while(i--)}while(--n);n=2;do{const e=1/t[n+6*n];o=6;do{a=6-o,t[a+6*n]=t[a+6*n]*e}while(--o)}while(n--);n=2;do{i=2;do{if(a=t[3+i+6*n],isNaN(a)||a===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(n,i,a)}while(i--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,r=e.w,s=t+t,o=n+n,a=i+i,l=t*s,c=t*o,u=t*a,d=n*o,h=n*a,p=i*a,f=r*s,m=r*o,g=r*a,_=this.elements;return _[0]=1-(d+p),_[1]=c-g,_[2]=u+m,_[3]=c+g,_[4]=1-(l+p),_[5]=h-f,_[6]=u-m,_[7]=h+f,_[8]=1-(l+d),this}transpose(e){void 0===e&&(e=new DP);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const kP=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class BP{constructor(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){void 0===t&&(t=new BP);const n=e.x,i=e.y,r=e.z,s=this.x,o=this.y,a=this.z;return t.x=o*r-a*i,t.y=a*n-s*r,t.z=s*i-o*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new BP(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new BP(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new DP([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const e=1/i;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return i}unit(e){void 0===e&&(e=new BP);const t=this.x,n=this.y,i=this.z;let r=Math.sqrt(t*t+n*n+i*i);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,o=e.z;return Math.sqrt((r-t)*(r-t)+(s-n)*(s-n)+(o-i)*(o-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,o=e.z;return(r-t)*(r-t)+(s-n)*(s-n)+(o-i)*(o-i)}scale(e,t){void 0===t&&(t=new BP);const n=this.x,i=this.y,r=this.z;return t.x=e*n,t.y=e*i,t.z=e*r,t}vmul(e,t){return void 0===t&&(t=new BP),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return void 0===n&&(n=new BP),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){return void 0===e&&(e=new BP),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=OP,r=1/n;i.set(this.x*r,this.y*r,this.z*r);const s=LP;Math.abs(i.x)<.9?(s.set(1,0,0),i.cross(s,e)):(s.set(0,1,0),i.cross(s,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,r=this.y,s=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=s+(e.z-s)*t}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(UP),UP.almostEquals(e,t)}clone(){return new BP(this.x,this.y,this.z)}}BP.ZERO=new BP(0,0,0),BP.UNIT_X=new BP(1,0,0),BP.UNIT_Y=new BP(0,1,0),BP.UNIT_Z=new BP(0,0,1);const OP=new BP,LP=new BP,UP=new BP;class NP{constructor(e){void 0===e&&(e={}),this.lowerBound=new BP,this.upperBound=new BP,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const r=this.lowerBound,s=this.upperBound,o=n;r.copy(e[0]),o&&o.vmult(r,r),s.copy(r);for(let a=1;a<e.length;a++){let t=e[a];o&&(o.vmult(t,FP),t=FP),t.x>s.x&&(s.x=t.x),t.x<r.x&&(r.x=t.x),t.y>s.y&&(s.y=t.y),t.y<r.y&&(r.y=t.y),t.z>s.z&&(s.z=t.z),t.z<r.z&&(r.z=t.z)}return t&&(t.vadd(r,r),t.vadd(s,s)),i&&(r.x-=i,r.y-=i,r.z-=i,s.x+=i,s.y+=i,s.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new NP).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound,s=i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,o=i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,a=i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return s&&o&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z}getCorners(e,t,n,i,r,s,o,a){const l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),i.set(l.x,c.y,c.z),r.set(c.x,l.y,c.z),s.set(l.x,c.y,l.z),o.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(e,t){const n=jP,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(i,r,s,o,a,l,c,u);for(let d=0;8!==d;d++){const t=n[d];e.pointToLocal(t,t)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=jP,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(i,r,s,o,a,l,c,u);for(let d=0;8!==d;d++){const t=n[d];e.pointToWorld(t,t)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,r=1/t.y,s=1/t.z,o=(this.lowerBound.x-n.x)*i,a=(this.upperBound.x-n.x)*i,l=(this.lowerBound.y-n.y)*r,c=(this.upperBound.y-n.y)*r,u=(this.lowerBound.z-n.z)*s,d=(this.upperBound.z-n.z)*s,h=Math.max(Math.max(Math.min(o,a),Math.min(l,c)),Math.min(u,d)),p=Math.min(Math.min(Math.max(o,a),Math.max(l,c)),Math.max(u,d));return!(p<0||h>p)}}const FP=new BP,jP=[new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP];class zP{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const e=i;i=n,n=e}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:r}=t;if(r>i){const e=r;r=i,i=e}this.matrix[(i*(i+1)>>1)+r-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class GP{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[e]||!n[e].includes(t))}hasAnyEventListener(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[e])return this;const i=n[e].indexOf(t);return-1!==i&&n[e].splice(i,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}class VP{constructor(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){void 0===e&&(e=new BP),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const t=HP,n=QP;e.tangents(t,n),this.setFromAxisAngle(t,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){void 0===t&&(t=new VP);const n=this.x,i=this.y,r=this.z,s=this.w,o=e.x,a=e.y,l=e.z,c=e.w;return t.x=n*c+s*o+i*l-r*a,t.y=i*c+s*a+r*o-n*l,t.z=r*c+s*l+n*a-i*o,t.w=s*c-n*o-i*a-r*l,t}inverse(e){void 0===e&&(e=new VP);const t=this.x,n=this.y,i=this.z,r=this.w;this.conjugate(e);const s=1/(t*t+n*n+i*i+r*r);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e}conjugate(e){return void 0===e&&(e=new VP),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){void 0===t&&(t=new BP);const n=e.x,i=e.y,r=e.z,s=this.x,o=this.y,a=this.z,l=this.w,c=l*n+o*r-a*i,u=l*i+a*n-s*r,d=l*r+s*i-o*n,h=-s*n-o*i-a*r;return t.x=c*l+h*-s+u*-a-d*-o,t.y=u*l+h*-o+d*-s-c*-a,t.z=d*l+h*-a+c*-o-u*-s,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,i,r;void 0===t&&(t="YZX");const s=this.x,o=this.y,a=this.z,l=this.w;if("YZX"!==t)throw new Error(`Euler order ${t} not supported yet.`);{const e=s*o+a*l;if(e>.499&&(n=2*Math.atan2(s,l),i=Math.PI/2,r=0),e<-.499&&(n=-2*Math.atan2(s,l),i=-Math.PI/2,r=0),void 0===n){const t=s*s,c=o*o,u=a*a;n=Math.atan2(2*o*l-2*s*a,1-2*c-2*u),i=Math.asin(2*e),r=Math.atan2(2*s*l-2*o*a,1-2*t-2*u)}}e.y=n,e.z=i,e.x=r}setFromEuler(e,t,n,i){void 0===i&&(i="XYZ");const r=Math.cos(e/2),s=Math.cos(t/2),o=Math.cos(n/2),a=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(n/2);return"XYZ"===i?(this.x=a*s*o+r*l*c,this.y=r*l*o-a*s*c,this.z=r*s*c+a*l*o,this.w=r*s*o-a*l*c):"YXZ"===i?(this.x=a*s*o+r*l*c,this.y=r*l*o-a*s*c,this.z=r*s*c-a*l*o,this.w=r*s*o+a*l*c):"ZXY"===i?(this.x=a*s*o-r*l*c,this.y=r*l*o+a*s*c,this.z=r*s*c+a*l*o,this.w=r*s*o-a*l*c):"ZYX"===i?(this.x=a*s*o-r*l*c,this.y=r*l*o+a*s*c,this.z=r*s*c-a*l*o,this.w=r*s*o+a*l*c):"YZX"===i?(this.x=a*s*o+r*l*c,this.y=r*l*o+a*s*c,this.z=r*s*c-a*l*o,this.w=r*s*o-a*l*c):"XZY"===i&&(this.x=a*s*o-r*l*c,this.y=r*l*o-a*s*c,this.z=r*s*c+a*l*o,this.w=r*s*o+a*l*c),this}clone(){return new VP(this.x,this.y,this.z,this.w)}slerp(e,t,n){void 0===n&&(n=new VP);const i=this.x,r=this.y,s=this.z,o=this.w;let a,l,c,u,d,h=e.x,p=e.y,f=e.z,m=e.w;return l=i*h+r*p+s*f+o*m,l<0&&(l=-l,h=-h,p=-p,f=-f,m=-m),1-l>1e-6?(a=Math.acos(l),c=Math.sin(a),u=Math.sin((1-t)*a)/c,d=Math.sin(t*a)/c):(u=1-t,d=t),n.x=u*i+d*h,n.y=u*r+d*p,n.z=u*s+d*f,n.w=u*o+d*m,n}integrate(e,t,n,i){void 0===i&&(i=new VP);const r=e.x*n.x,s=e.y*n.y,o=e.z*n.z,a=this.x,l=this.y,c=this.z,u=this.w,d=.5*t;return i.x+=d*(r*u+s*c-o*l),i.y+=d*(s*u+o*a-r*c),i.z+=d*(o*u+r*l-s*a),i.w+=d*(-r*a-s*l-o*c),i}}const HP=new BP,QP=new BP;class WP{constructor(e){void 0===e&&(e={}),this.id=WP.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}WP.idCounter=0,WP.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class qP{constructor(e){void 0===e&&(e={}),this.position=new BP,this.quaternion=new VP,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return qP.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return qP.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return void 0===t&&(t=new BP),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return void 0===i&&(i=new BP),n.vsub(e,i),t.conjugate(XP),XP.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return void 0===i&&(i=new BP),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return void 0===n&&(n=new BP),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return void 0===i&&(i=new BP),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const XP=new VP;class YP extends WP{constructor(e){void 0===e&&(e={});const{vertices:t=[],faces:n=[],normals:i=[],axes:r,boundingSphereRadius:s}=e;super({type:WP.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),s?this.boundingSphereRadius=s:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new BP;for(let r=0;r!==e.length;r++){const s=e[r],o=s.length;for(let e=0;e!==o;e++){const r=(e+1)%o;t[s[e]].vsub(t[s[r]],i),i.normalize();let a=!1;for(let e=0;e!==n.length;e++)if(n[e].almostEquals(i)||n[e].almostEquals(i)){a=!0;break}a||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error(`Vertex ${this.faces[e][i]} not found!`);const t=this.faceNormals[e]||new BP;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let t=0;t<this.faces[e].length;t++)console.warn(`.vertices[${this.faces[e][t]}] = Vec3(${this.vertices[this.faces[e][t]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],r=this.vertices[n[1]],s=this.vertices[n[2]];YP.computeNormal(i,r,s,t)}static computeNormal(e,t,n,i){const r=new BP,s=new BP;t.vsub(e,s),n.vsub(t,r),r.cross(s,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,r,s,o,a,l){const c=new BP;let u=-1,d=-Number.MAX_VALUE;for(let p=0;p<n.faces.length;p++){c.copy(n.faceNormals[p]),r.vmult(c,c);const e=c.dot(s);e>d&&(d=e,u=p)}const h=[];for(let p=0;p<n.faces[u].length;p++){const e=n.vertices[n.faces[u][p]],t=new BP;t.copy(e),r.vmult(t,t),i.vadd(t,t),h.push(t)}u>=0&&this.clipFaceAgainstHull(s,e,t,h,o,a,l)}findSeparatingAxis(e,t,n,i,r,s,o,a){const l=new BP,c=new BP,u=new BP,d=new BP,h=new BP,p=new BP;let f=Number.MAX_VALUE;const m=this;if(m.uniqueAxes)for(let g=0;g!==m.uniqueAxes.length;g++){n.vmult(m.uniqueAxes[g],l);const o=m.testSepAxis(l,e,t,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(l))}else{const a=o?o.length:m.faces.length;for(let c=0;c<a;c++){const a=o?o[c]:c;l.copy(m.faceNormals[a]),n.vmult(l,l);const u=m.testSepAxis(l,e,t,n,i,r);if(!1===u)return!1;u<f&&(f=u,s.copy(l))}}if(e.uniqueAxes)for(let g=0;g!==e.uniqueAxes.length;g++){r.vmult(e.uniqueAxes[g],c);const o=m.testSepAxis(c,e,t,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(c))}else{const o=a?a.length:e.faces.length;for(let l=0;l<o;l++){const o=a?a[l]:l;c.copy(e.faceNormals[o]),r.vmult(c,c);const u=m.testSepAxis(c,e,t,n,i,r);if(!1===u)return!1;u<f&&(f=u,s.copy(c))}}for(let g=0;g!==m.uniqueEdges.length;g++){n.vmult(m.uniqueEdges[g],d);for(let o=0;o!==e.uniqueEdges.length;o++)if(r.vmult(e.uniqueEdges[o],h),d.cross(h,p),!p.almostZero()){p.normalize();const o=m.testSepAxis(p,e,t,n,i,r);if(!1===o)return!1;o<f&&(f=o,s.copy(p))}}return i.vsub(t,u),u.dot(s)>0&&s.negate(s),!0}testSepAxis(e,t,n,i,r,s){YP.project(this,e,n,i,KP),YP.project(t,e,r,s,JP);const o=KP[0],a=KP[1],l=JP[0],c=JP[1];if(o<c||l<a)return!1;const u=o-c,d=l-a;return u<d?u:d}calculateLocalInertia(e,t){const n=new BP,i=new BP;this.computeLocalAABB(i,n);const r=n.x-i.x,s=n.y-i.y,o=n.z-i.z;t.x=1/12*e*(2*s*2*s+2*o*2*o),t.y=1/12*e*(2*r*2*r+2*o*2*o),t.z=1/12*e*(2*s*2*s+2*r*2*r)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,r,s,o){const a=new BP,l=new BP,c=new BP,u=new BP,d=new BP,h=new BP,p=new BP,f=new BP,m=this,g=i,_=[];let v=-1,y=Number.MAX_VALUE;for(let E=0;E<m.faces.length;E++){a.copy(m.faceNormals[E]),n.vmult(a,a);const t=a.dot(e);t<y&&(y=t,v=E)}if(v<0)return;const b=m.faces[v];b.connectedFaces=[];for(let E=0;E<m.faces.length;E++)for(let e=0;e<m.faces[E].length;e++)-1!==b.indexOf(m.faces[E][e])&&E!==v&&-1===b.connectedFaces.indexOf(E)&&b.connectedFaces.push(E);const A=b.length;for(let E=0;E<A;E++){const e=m.vertices[b[E]],i=m.vertices[b[(E+1)%A]];e.vsub(i,l),c.copy(l),n.vmult(c,c),t.vadd(c,c),u.copy(this.faceNormals[v]),n.vmult(u,u),t.vadd(u,u),c.cross(u,d),d.negate(d),h.copy(e),n.vmult(h,h),t.vadd(h,h);const r=b.connectedFaces[E];p.copy(this.faceNormals[r]);const s=this.getPlaneConstantOfFace(r);f.copy(p),n.vmult(f,f);const o=s-f.dot(t);for(this.clipFaceAgainstPlane(g,_,f,o);g.length;)g.shift();for(;_.length;)g.push(_.shift())}p.copy(this.faceNormals[v]);const w=this.getPlaneConstantOfFace(v);f.copy(p),n.vmult(f,f);const x=w-f.dot(t);for(let E=0;E<g.length;E++){let e=f.dot(g[E])+x;if(e<=r&&(console.log(`clamped: depth=${e} to minDist=${r}`),e=r),e<=s){const t=g[E];if(e<=1e-6){const n={point:t,normal:f,depth:e};o.push(n)}}}}clipFaceAgainstPlane(e,t,n,i){let r,s;const o=e.length;if(o<2)return t;let a=e[e.length-1],l=e[0];r=n.dot(a)+i;for(let c=0;c<o;c++){if(l=e[c],s=n.dot(l)+i,r<0)if(s<0){const e=new BP;e.copy(l),t.push(e)}else{const e=new BP;a.lerp(l,r/(r-s),e),t.push(e)}else if(s<0){const e=new BP;a.lerp(l,r/(r-s),e),t.push(e),t.push(l)}a=l,r=s}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new BP);const n=this.vertices,i=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)t.vmult(n[r],i[r]),e.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const r=n[i];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new BP);const n=this.faceNormals,i=this.worldFaceNormals;for(let r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const r=this.vertices;let s,o,a,l,c,u,d=new BP;for(let h=0;h<r.length;h++){d.copy(r[h]),t.vmult(d,d),e.vadd(d,d);const n=d;(void 0===s||n.x<s)&&(s=n.x),(void 0===l||n.x>l)&&(l=n.x),(void 0===o||n.y<o)&&(o=n.y),(void 0===c||n.y>c)&&(c=n.y),(void 0===a||n.z<a)&&(a=n.z),(void 0===u||n.z>u)&&(u=n.z)}n.set(s,o,a),i.set(l,c,u)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){void 0===e&&(e=new BP);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let e=0;e<n;e++){const n=i[e];t.vmult(n,n)}for(let e=0;e<this.faceNormals.length;e++){const n=this.faceNormals[e];t.vmult(n,n)}}if(e)for(let r=0;r<n;r++){const t=i[r];t.vadd(e,t)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,r=new BP;this.getAveragePointLocal(r);for(let s=0;s<this.faces.length;s++){let o=i[s];const a=t[n[s][0]],l=new BP;e.vsub(a,l);const c=o.dot(l),u=new BP;r.vsub(a,u);const d=o.dot(u);if(c<0&&d>0||c>0&&d<0)return!1}return-1}static project(e,t,n,i,r){const s=e.vertices.length,o=ZP;let a=0,l=0;const c=$P,u=e.vertices;c.setZero(),qP.vectorToLocalFrame(n,i,t,o),qP.pointToLocalFrame(n,i,c,c);const d=c.dot(o);l=a=u[0].dot(o);for(let h=1;h<s;h++){const e=u[h].dot(o);e>a&&(a=e),e<l&&(l=e)}if(l-=d,a-=d,l>a){const e=l;l=a,a=e}r[0]=a,r[1]=l}}const KP=[],JP=[],ZP=(new BP,new BP),$P=new BP;class eR extends WP{constructor(e){super({type:WP.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=BP,r=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],s=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],o=new YP({vertices:r,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:s});this.convexPolyhedronRepresentation=o,o.material=this.material}calculateLocalInertia(e,t){return void 0===t&&(t=new BP),eR.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==t)for(let r=0;r!==n.length;r++)t.vmult(n[r],n[r]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let s=0;s<r.length;s++)tR.set(r[s][0],r[s][1],r[s][2]),t.vmult(tR,tR),e.vadd(tR,tR),n(tR.x,tR.y,tR.z)}calculateWorldAABB(e,t,n,i){const r=this.halfExtents;nR[0].set(r.x,r.y,r.z),nR[1].set(-r.x,r.y,r.z),nR[2].set(-r.x,-r.y,r.z),nR[3].set(-r.x,-r.y,-r.z),nR[4].set(r.x,-r.y,-r.z),nR[5].set(r.x,r.y,-r.z),nR[6].set(-r.x,r.y,-r.z),nR[7].set(r.x,-r.y,r.z);const s=nR[0];t.vmult(s,s),e.vadd(s,s),i.copy(s),n.copy(s);for(let o=1;o<8;o++){const r=nR[o];t.vmult(r,r),e.vadd(r,r);const s=r.x,a=r.y,l=r.z;s>i.x&&(i.x=s),a>i.y&&(i.y=a),l>i.z&&(i.z=l),s<n.x&&(n.x=s),a<n.y&&(n.y=a),l<n.z&&(n.z=l)}}}const tR=new BP,nR=[new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP];class iR extends GP{constructor(e){void 0===e&&(e={}),super(),this.id=iR.idCounter++,this.index=-1,this.world=null,this.vlambda=new BP,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new BP,this.previousPosition=new BP,this.interpolatedPosition=new BP,this.initPosition=new BP,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new BP,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new BP,this.force=new BP;const t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?iR.STATIC:iR.DYNAMIC,typeof e.type==typeof iR.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=iR.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new BP,this.quaternion=new VP,this.initQuaternion=new VP,this.previousQuaternion=new VP,this.interpolatedQuaternion=new VP,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new BP,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new BP,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new BP,this.invInertia=new BP,this.invInertiaWorld=new DP,this.invMassSolve=0,this.invInertiaSolve=new BP,this.invInertiaWorldSolve=new DP,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new BP(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new BP(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new NP,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new BP,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=iR.AWAKE,this.wakeUpAfterNarrowphase=!1,e===iR.SLEEPING&&this.dispatchEvent(iR.wakeupEvent)}sleep(){this.sleepState=iR.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===iR.AWAKE&&n<i?(this.sleepState=iR.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(iR.sleepyEvent)):t===iR.SLEEPY&&n>i?this.wakeUp():t===iR.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(iR.sleepEvent))}}updateSolveMassProperties(){this.sleepState===iR.SLEEPING||this.type===iR.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return void 0===t&&(t=new BP),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return void 0===t&&(t=new BP),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return void 0===t&&(t=new BP),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return void 0===t&&(t=new BP),this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new BP,r=new VP;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let r=0;r!==n;r++){const n=e[r];n.updateBoundingSphereRadius();const s=t[r].length(),o=n.boundingSphereRadius;s+o>i&&(i=s+o)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=rR,s=sR,o=this.quaternion,a=this.aabb,l=oR;for(let c=0;c!==i;c++){const i=e[c];o.vmult(t[c],r),r.vadd(this.position,r),o.mult(n[c],s),i.calculateWorldAABB(r,s,l.lowerBound,l.upperBound),0===c?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const e=aR,n=lR;e.setRotationFromQuaternion(this.quaternion),e.transpose(n),e.scale(t,e),e.mmult(n,this.invInertiaWorld)}}applyForce(e,t){if(void 0===t&&(t=new BP),this.type!==iR.DYNAMIC)return;this.sleepState===iR.SLEEPING&&this.wakeUp();const n=cR;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(void 0===t&&(t=new BP),this.type!==iR.DYNAMIC)return;const n=uR,i=dR;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===iR.DYNAMIC&&(this.sleepState===iR.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(void 0===t&&(t=new BP),this.type!==iR.DYNAMIC)return;this.sleepState===iR.SLEEPING&&this.wakeUp();const n=t,i=hR;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const r=pR;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(e,t){if(void 0===t&&(t=new BP),this.type!==iR.DYNAMIC)return;const n=fR,i=mR;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=gR;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),eR.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new BP;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==iR.DYNAMIC&&this.type!==iR.KINEMATIC||this.sleepState===iR.SLEEPING)return;const i=this.velocity,r=this.angularVelocity,s=this.position,o=this.force,a=this.torque,l=this.quaternion,c=this.invMass,u=this.invInertiaWorld,d=this.linearFactor,h=c*e;i.x+=o.x*h*d.x,i.y+=o.y*h*d.y,i.z+=o.z*h*d.z;const p=u.elements,f=this.angularFactor,m=a.x*f.x,g=a.y*f.y,_=a.z*f.z;r.x+=e*(p[0]*m+p[1]*g+p[2]*_),r.y+=e*(p[3]*m+p[4]*g+p[5]*_),r.z+=e*(p[6]*m+p[7]*g+p[8]*_),s.x+=i.x*e,s.y+=i.y*e,s.z+=i.z*e,l.integrate(this.angularVelocity,e,this.angularFactor,l),t&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}iR.idCounter=0,iR.COLLIDE_EVENT_NAME="collide",iR.DYNAMIC=1,iR.STATIC=2,iR.KINEMATIC=4,iR.AWAKE=0,iR.SLEEPY=1,iR.SLEEPING=2,iR.wakeupEvent={type:"wakeup"},iR.sleepyEvent={type:"sleepy"},iR.sleepEvent={type:"sleep"};const rR=new BP,sR=new VP,oR=new NP,aR=new DP,lR=new DP,cR=(new DP,new BP),uR=new BP,dR=new BP,hR=new BP,pR=new BP,fR=new BP,mR=new BP,gR=new BP;class _R{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&iR.STATIC)&&e.sleepState!==iR.SLEEPING||0==(t.type&iR.STATIC)&&t.sleepState!==iR.SLEEPING)}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const r=vR;t.position.vsub(e.position,r);const s=(e.boundingRadius+t.boundingRadius)**2;r.lengthSquared()<s&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=yR,i=bR,r=AR,s=e.length;for(let o=0;o!==s;o++)i[o]=e[o],r[o]=t[o];e.length=0,t.length=0;for(let o=0;o!==s;o++){const e=i[o].id,t=r[o].id,s=e<t?`${e},${t}`:`${t},${e}`;n[s]=o,n.keys.push(s)}for(let o=0;o!==n.keys.length;o++){const s=n.keys.pop(),o=n[s];e.push(i[o]),t.push(r[o]),delete n[s]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new BP;e.position.vsub(t.position,n);const i=e.shapes[0],r=t.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const vR=new BP;new BP,new VP,new BP;const yR={keys:[]},bR=[],AR=[];new BP,new BP,new BP;class wR extends _R{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,r=i.length;let s,o;for(let a=0;a!==r;a++)for(let e=0;e!==a;e++)s=i[a],o=i[e],this.needBroadphaseCollision(s,o)&&this.intersectionTest(s,o,t,n)}aabbQuery(e,t,n){void 0===n&&(n=[]);for(let i=0;i<e.bodies.length;i++){const r=e.bodies[i];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}}class xR{constructor(){this.rayFromWorld=new BP,this.rayToWorld=new BP,this.hitNormalWorld=new BP,this.hitPointWorld=new BP,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,r,s,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=s,this.distance=o}}let ER,CR,SR,MR,TR,IR,PR;ER=WP.types.SPHERE,CR=WP.types.PLANE,SR=WP.types.BOX,MR=WP.types.CYLINDER,TR=WP.types.CONVEXPOLYHEDRON,IR=WP.types.HEIGHTFIELD,PR=WP.types.TRIMESH;class RR{get[ER](){return this._intersectSphere}get[CR](){return this._intersectPlane}get[SR](){return this._intersectBox}get[MR](){return this._intersectConvex}get[TR](){return this._intersectConvex}get[IR](){return this._intersectHeightfield}get[PR](){return this._intersectTrimesh}constructor(e,t){void 0===e&&(e=new BP),void 0===t&&(t=new BP),this.from=e.clone(),this.to=t.clone(),this.direction=new BP,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=RR.ANY,this.result=new xR,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||RR.ANY,this.result=t.result||new xR,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(DR),kR.length=0,e.broadphase.aabbQuery(e,DR,kR),this.intersectBodies(kR),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse)return;if(0==(this.collisionFilterGroup&e.collisionFilterMask)||0==(e.collisionFilterGroup&this.collisionFilterMask))return;const i=LR,r=UR;for(let s=0,o=e.shapes.length;s<o;s++){const t=e.shapes[s];if((!n||t.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[s],r),e.quaternion.vmult(e.shapeOffsets[s],i),i.vadd(e.position,i),this.intersectShape(t,r,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const r=function(e,t,n){n.vsub(e,rD);const i=rD.dot(t);return t.scale(i,sD),sD.vadd(e,sD),n.distanceTo(sD)}(this.from,this.direction,n);if(r>e.boundingSphereRadius)return;const s=this[e.type];s&&s.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}_intersectPlane(e,t,n,i,r){const s=this.from,o=this.to,a=this.direction,l=new BP(0,0,1);t.vmult(l,l);const c=new BP;s.vsub(n,c);const u=c.dot(l);if(o.vsub(n,c),u*c.dot(l)>0)return;if(s.distanceTo(o)<u)return;const d=l.dot(a);if(Math.abs(d)<this.precision)return;const h=new BP,p=new BP,f=new BP;s.vsub(n,h);const m=-l.dot(h)/d;a.scale(m,p),s.vadd(p,f),this.reportIntersection(l,f,r,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,r=this.from;t.x=Math.min(i.x,r.x),t.y=Math.min(i.y,r.y),t.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}_intersectHeightfield(e,t,n,i,r){e.data,e.elementSize;const s=HR;s.from.copy(this.from),s.to.copy(this.to),qP.pointToLocalFrame(n,t,s.from,s.from),qP.pointToLocalFrame(n,t,s.to,s.to),s.updateDirection();const o=QR;let a,l,c,u;a=l=0,c=u=e.data.length-1;const d=new NP;s.getAABB(d),e.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,o,!0),a=Math.max(a,o[0]),l=Math.max(l,o[1]),e.getIndexOfPosition(d.upperBound.x,d.upperBound.y,o,!0),c=Math.min(c,o[0]+1),u=Math.min(u,o[1]+1);for(let h=a;h<c;h++)for(let o=l;o<u;o++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,o,d),d.overlapsRay(s)){if(e.getConvexTrianglePillar(h,o,!1),qP.pointToWorldFrame(n,t,e.pillarOffset,VR),this._intersectConvex(e.pillarConvex,t,VR,i,r,GR),this.result.shouldStop)return;e.getConvexTrianglePillar(h,o,!0),qP.pointToWorldFrame(n,t,e.pillarOffset,VR),this._intersectConvex(e.pillarConvex,t,VR,i,r,GR)}}}_intersectSphere(e,t,n,i,r){const s=this.from,o=this.to,a=e.radius,l=(o.x-s.x)**2+(o.y-s.y)**2+(o.z-s.z)**2,c=2*((o.x-s.x)*(s.x-n.x)+(o.y-s.y)*(s.y-n.y)+(o.z-s.z)*(s.z-n.z)),u=c**2-4*l*((s.x-n.x)**2+(s.y-n.y)**2+(s.z-n.z)**2-a**2),d=WR,h=qR;if(!(u<0))if(0===u)s.lerp(o,u,d),d.vsub(n,h),h.normalize(),this.reportIntersection(h,d,r,i,-1);else{const e=(-c-Math.sqrt(u))/(2*l),t=(-c+Math.sqrt(u))/(2*l);if(e>=0&&e<=1&&(s.lerp(o,e,d),d.vsub(n,h),h.normalize(),this.reportIntersection(h,d,r,i,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(s.lerp(o,t,d),d.vsub(n,h),h.normalize(),this.reportIntersection(h,d,r,i,-1))}}_intersectConvex(e,t,n,i,r,s){const o=XR,a=YR,l=s&&s.faceList||null,c=e.faces,u=e.vertices,d=e.faceNormals,h=this.direction,p=this.from,f=this.to,m=p.distanceTo(f),g=l?l.length:c.length,_=this.result;for(let v=0;!_.shouldStop&&v<g;v++){const e=l?l[v]:v,s=c[e],f=d[e],g=t,y=n;a.copy(u[s[0]]),g.vmult(a,a),a.vadd(y,a),a.vsub(p,a),g.vmult(f,o);const b=h.dot(o);if(Math.abs(b)<this.precision)continue;const A=o.dot(a)/b;if(!(A<0)){h.scale(A,NR),NR.vadd(p,NR),FR.copy(u[s[0]]),g.vmult(FR,FR),y.vadd(FR,FR);for(let t=1;!_.shouldStop&&t<s.length-1;t++){jR.copy(u[s[t]]),zR.copy(u[s[t+1]]),g.vmult(jR,jR),g.vmult(zR,zR),y.vadd(jR,jR),y.vadd(zR,zR);const n=NR.distanceTo(p);!RR.pointInTriangle(NR,FR,jR,zR)&&!RR.pointInTriangle(NR,jR,FR,zR)||n>m||this.reportIntersection(o,NR,r,i,e)}}}}_intersectTrimesh(e,t,n,i,r,s){const o=KR,a=nD,l=iD,c=YR,u=JR,d=ZR,h=$R,p=tD,f=eD,m=e.indices;e.vertices;const g=this.from,_=this.to,v=this.direction;l.position.copy(n),l.quaternion.copy(t),qP.vectorToLocalFrame(n,t,v,u),qP.pointToLocalFrame(n,t,g,d),qP.pointToLocalFrame(n,t,_,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,h.vsub(d,u),u.normalize();const y=d.distanceSquared(h);e.tree.rayQuery(this,l,a);for(let b=0,A=a.length;!this.result.shouldStop&&b!==A;b++){const s=a[b];e.getNormal(s,o),e.getVertex(m[3*s],FR),FR.vsub(d,c);const l=u.dot(o),h=o.dot(c)/l;if(h<0)continue;u.scale(h,NR),NR.vadd(d,NR),e.getVertex(m[3*s+1],jR),e.getVertex(m[3*s+2],zR);const g=NR.distanceSquared(d);!RR.pointInTriangle(NR,jR,FR,zR)&&!RR.pointInTriangle(NR,FR,jR,zR)||g>y||(qP.vectorToWorldFrame(t,o,f),qP.pointToWorldFrame(n,t,NR,p),this.reportIntersection(f,p,r,i,s))}a.length=0}reportIntersection(e,t,n,i,r){const s=this.from,o=this.to,a=s.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case RR.ALL:this.hasHit=!0,l.set(s,o,e,t,n,i,a),l.hasHit=!0,this.callback(l);break;case RR.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,o,e,t,n,i,a));break;case RR.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,o,e,t,n,i,a),l.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,rD),n.vsub(t,BR),e.vsub(t,OR);const r=rD.dot(rD),s=rD.dot(BR),o=rD.dot(OR),a=BR.dot(BR),l=BR.dot(OR);let c,u;return(c=a*o-s*l)>=0&&(u=r*l-s*o)>=0&&c+u<r*a-s*s}}RR.CLOSEST=1,RR.ANY=2,RR.ALL=4;const DR=new NP,kR=[],BR=new BP,OR=new BP,LR=new BP,UR=new VP,NR=new BP,FR=new BP,jR=new BP,zR=new BP;new BP,new xR;const GR={faceList:[0]},VR=new BP,HR=new RR,QR=[],WR=new BP,qR=new BP,XR=new BP,YR=(new BP,new BP,new BP),KR=new BP,JR=new BP,ZR=new BP,$R=new BP,eD=new BP,tD=new BP;new NP;const nD=[],iD=new qP,rD=new BP,sD=new BP;class oD{static defaults(e,t){void 0===e&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class aD{constructor(e,t,n){void 0===n&&(n={}),n=oD.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=aD.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}aD.idCounter=0;class lD{constructor(){this.spatial=new BP,this.rotational=new BP}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class cD{constructor(e,t,n,i){void 0===n&&(n=-1e6),void 0===i&&(i=1e6),this.id=cD.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new lD,this.jacobianElementB=new lD,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,r=e,s=n;this.a=4/(s*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(s*s*r*(1+4*i))}computeB(e,t,n){const i=this.computeGW();return-this.computeGq()*e-i*t-this.computeGiMf()*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,s=i.position;return e.spatial.dot(r)+t.spatial.dot(s)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,s=i.velocity,o=n.angularVelocity,a=i.angularVelocity;return e.multiplyVectors(r,o)+t.multiplyVectors(s,a)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,s=i.vlambda,o=n.wlambda,a=i.wlambda;return e.multiplyVectors(r,o)+t.multiplyVectors(s,a)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,s=n.torque,o=i.force,a=i.torque,l=n.invMassSolve,c=i.invMassSolve;return r.scale(l,uD),o.scale(c,dD),n.invInertiaWorldSolve.vmult(s,hD),i.invInertiaWorldSolve.vmult(a,pD),e.multiplyVectors(uD,hD)+t.multiplyVectors(dD,pD)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,s=i.invMassSolve,o=n.invInertiaWorldSolve,a=i.invInertiaWorldSolve;let l=r+s;return o.vmult(e.rotational,fD),l+=fD.dot(e.rotational),a.vmult(t.rotational,fD),l+=fD.dot(t.rotational),l}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,s=mD;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,s),i.wlambda.addScaledVector(e,s,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,s),r.wlambda.addScaledVector(e,s,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}cD.idCounter=0;const uD=new BP,dD=new BP,hD=new BP,pD=new BP,fD=new BP,mD=new BP;class gD extends cD{constructor(e,t,n){void 0===n&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new BP,this.rj=new BP,this.ni=new BP}computeB(e){const t=this.a,n=this.b,i=this.bi,r=this.bj,s=this.ri,o=this.rj,a=_D,l=vD,c=i.velocity,u=i.angularVelocity;i.force,i.torque;const d=r.velocity,h=r.angularVelocity;r.force,r.torque;const p=yD,f=this.jacobianElementA,m=this.jacobianElementB,g=this.ni;s.cross(g,a),o.cross(g,l),g.negate(f.spatial),a.negate(f.rotational),m.spatial.copy(g),m.rotational.copy(l),p.copy(r.position),p.vadd(o,p),p.vsub(i.position,p),p.vsub(s,p);const _=g.dot(p),v=this.restitution+1;return-_*t-(v*d.dot(g)-v*c.dot(g)+h.dot(l)-u.dot(a))*n-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=bD,t=AD,n=wD,i=xD,r=ED;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,r),this.ni.dot(r)}}const _D=new BP,vD=new BP,yD=new BP,bD=new BP,AD=new BP,wD=new BP,xD=new BP,ED=new BP;class CD extends aD{constructor(e,t,n,i,r){void 0===t&&(t=new BP),void 0===i&&(i=new BP),void 0===r&&(r=1e6),super(e,n),this.pivotA=t.clone(),this.pivotB=i.clone();const s=this.equationX=new gD(e,n),o=this.equationY=new gD(e,n),a=this.equationZ=new gD(e,n);this.equations.push(s,o,a),s.minForce=o.minForce=a.minForce=-r,s.maxForce=o.maxForce=a.maxForce=r,s.ni.set(1,0,0),o.ni.set(0,1,0),a.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,n=this.equationX,i=this.equationY,r=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj)}}new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP;class SD extends cD{constructor(e,t,n){super(e,t,-n,n),this.ri=new BP,this.rj=new BP,this.t=new BP}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,r=MD,s=TD,o=this.t;n.cross(o,r),i.cross(o,s);const a=this.jacobianElementA,l=this.jacobianElementB;return o.negate(a.spatial),r.negate(a.rotational),l.spatial.copy(o),l.rotational.copy(s),-this.computeGW()*t-e*this.computeGiMf()}}const MD=new BP,TD=new BP;class ID{constructor(e,t,n){n=oD.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ID.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}ID.idCounter=0;class PD{constructor(e){void 0===e&&(e={});let t="";"string"==typeof e&&(t=e,e={}),this.name=t,this.id=PD.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}PD.idCounter=0,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new RR,new BP,new BP,new BP,new BP(1,0,0),new BP(0,1,0),new BP(0,0,1),new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP;class RD extends WP{constructor(e){if(super({type:WP.types.SPHERE}),this.radius=void 0!==e?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){void 0===t&&(t=new BP);const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const r=this.radius,s=["x","y","z"];for(let o=0;o<s.length;o++){const t=s[o];n[t]=e[t]-r,i[t]=e[t]+r}}}new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP;class DD extends YP{constructor(e,t,n,i){if(void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===i&&(i=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const r=i,s=[],o=[],a=[],l=[],c=[],u=Math.cos,d=Math.sin;s.push(new BP(-t*d(0),.5*-n,t*u(0))),l.push(0),s.push(new BP(-e*d(0),.5*n,e*u(0))),c.push(1);for(let p=0;p<r;p++){const i=2*Math.PI/r*(p+1),h=2*Math.PI/r*(p+.5);p<r-1?(s.push(new BP(-t*d(i),.5*-n,t*u(i))),l.push(2*p+2),s.push(new BP(-e*d(i),.5*n,e*u(i))),c.push(2*p+3),a.push([2*p,2*p+1,2*p+3,2*p+2])):a.push([2*p,2*p+1,1,0]),(r%2==1||p<r/2)&&o.push(new BP(-d(h),0,u(h)))}a.push(l),o.push(new BP(0,1,0));const h=[];for(let p=0;p<c.length;p++)h.push(c[c.length-p-1]);a.push(h),super({vertices:s,faces:a,axes:o}),this.type=WP.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=i}}class kD extends WP{constructor(){super({type:WP.types.PLANE}),this.worldNormal=new BP,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return void 0===t&&(t=new BP),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,i){BD.set(0,0,1),t.vmult(BD,BD);const r=Number.MAX_VALUE;n.set(-r,-r,-r),i.set(r,r,r),1===BD.x?i.x=e.x:-1===BD.x&&(n.x=e.x),1===BD.y?i.y=e.y:-1===BD.y&&(n.y=e.y),1===BD.z?i.z=e.z:-1===BD.z&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const BD=new BP;new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP,new BP;class OD{constructor(e){void 0===e&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new NP,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,n){void 0===n&&(n=0);const i=this.data;if(!this.aabb.contains(e))return!1;const r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let i=!1;r.length||(this.subdivide(),i=!0);for(let s=0;8!==s;s++)if(r[s].insert(e,t,n+1))return!0;i&&(r.length=0)}return i.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,n=e.upperBound,i=this.children;i.push(new OD({aabb:new NP({lowerBound:new BP(0,0,0)})}),new OD({aabb:new NP({lowerBound:new BP(1,0,0)})}),new OD({aabb:new NP({lowerBound:new BP(1,1,0)})}),new OD({aabb:new NP({lowerBound:new BP(1,1,1)})}),new OD({aabb:new NP({lowerBound:new BP(0,1,1)})}),new OD({aabb:new NP({lowerBound:new BP(0,0,1)})}),new OD({aabb:new NP({lowerBound:new BP(1,0,1)})}),new OD({aabb:new NP({lowerBound:new BP(0,1,0)})})),n.vsub(t,UD),UD.scale(.5,UD);const r=this.root||this;for(let s=0;8!==s;s++){const e=i[s];e.root=r;const n=e.aabb.lowerBound;n.x*=UD.x,n.y*=UD.y,n.z*=UD.z,n.vadd(t,n),n.vadd(UD,e.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t}rayQuery(e,t,n){return e.getAABB(ND),ND.toLocalFrame(t,ND),this.aabbQuery(ND,n),n}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class LD extends OD{constructor(e,t){void 0===t&&(t={}),super({root:null,aabb:e}),this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}}const UD=new BP,ND=new NP;class FD extends WP{constructor(e,t){super({type:WP.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new NP,this.edges=null,this.scale=new BP(1,1,1),this.tree=new LD,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const n=new NP,i=new BP,r=new BP,s=new BP,o=[i,r,s];for(let a=0;a<this.indices.length/3;a++){const t=3*a;this._getUnscaledVertex(this.indices[t],i),this._getUnscaledVertex(this.indices[t+1],r),this._getUnscaledVertex(this.indices[t+2],s),n.setFromPoints(o),e.insert(n,a)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){zD.copy(e);const n=this.scale,i=n.x,r=n.y,s=n.z,o=zD.lowerBound,a=zD.upperBound;return o.x/=i,o.y/=r,o.z/=s,a.x/=i,a.y/=r,a.z/=s,this.tree.aabbQuery(zD,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=jD,t=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,r=this.indices[i],s=this.indices[i+1],o=this.indices[i+2];this.getVertex(r,WD),this.getVertex(s,qD),this.getVertex(o,XD),FD.computeNormal(qD,WD,XD,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}}updateEdges(){const e={},t=(t,n)=>{e[t<n?`${t}_${n}`:`${n}_${t}`]=!0};for(let i=0;i<this.indices.length/3;i++){const e=3*i,n=this.indices[e],r=this.indices[e+1],s=this.indices[e+2];t(n,r),t(r,s),t(s,n)}const n=Object.keys(e);this.edges=new Int16Array(2*n.length);for(let i=0;i<n.length;i++){const e=n[i].split("_");this.edges[2*i]=parseInt(e[0],10),this.edges[2*i+1]=parseInt(e[1],10)}}getEdgeVertex(e,t,n){const i=this.edges[2*e+(t?1:0)];this.getVertex(i,n)}getEdgeVector(e,t){const n=GD,i=VD;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)}static computeNormal(e,t,n,i){t.vsub(e,QD),n.vsub(t,HD),HD.cross(QD,i),i.isZero()||i.normalize()}getVertex(e,t){const n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){const n=3*e,i=this.vertices;return t.set(i[n],i[n+1],i[n+2])}getWorldVertex(e,t,n,i){return this.getVertex(e,i),qP.pointToWorldFrame(t,n,i,i),i}getTriangleVertices(e,t,n,i){const r=3*e;this.getVertex(this.indices[r],t),this.getVertex(this.indices[r+1],n),this.getVertex(this.indices[r+2],i)}getNormal(e,t){const n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(e,t){this.computeLocalAABB(YD);const n=YD.upperBound.x-YD.lowerBound.x,i=YD.upperBound.y-YD.lowerBound.y,r=YD.upperBound.z-YD.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*r*2*r),1/12*e*(2*n*2*n+2*r*2*r),1/12*e*(2*i*2*i+2*n*2*n))}computeLocalAABB(e){const t=e.lowerBound,n=e.upperBound,i=this.vertices.length;this.vertices;const r=KD;this.getVertex(0,r),t.copy(r),n.copy(r);for(let s=0;s!==i;s++)this.getVertex(s,r),r.x<t.x?t.x=r.x:r.x>n.x&&(n.x=r.x),r.y<t.y?t.y=r.y:r.y>n.y&&(n.y=r.y),r.z<t.z?t.z=r.z:r.z>n.z&&(n.z=r.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,n=new BP;for(let i=0,r=t.length/3;i!==r;i++){this.getVertex(i,n);const t=n.lengthSquared();t>e&&(e=t)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const r=JD,s=ZD;r.position=e,r.quaternion=t,this.aabb.toWorldFrame(r,s),n.copy(s.lowerBound),i.copy(s.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,n,i,r){void 0===e&&(e=1),void 0===t&&(t=.5),void 0===n&&(n=8),void 0===i&&(i=6),void 0===r&&(r=2*Math.PI);const s=[],o=[];for(let a=0;a<=n;a++)for(let o=0;o<=i;o++){const l=o/i*r,c=a/n*Math.PI*2,u=(e+t*Math.cos(c))*Math.cos(l),d=(e+t*Math.cos(c))*Math.sin(l),h=t*Math.sin(c);s.push(u,d,h)}for(let a=1;a<=n;a++)for(let e=1;e<=i;e++){const t=(i+1)*a+e-1,n=(i+1)*(a-1)+e-1,r=(i+1)*(a-1)+e,s=(i+1)*a+e;o.push(t,n,s),o.push(n,r,s)}return new FD(s,o)}}const jD=new BP,zD=new NP,GD=new BP,VD=new BP,HD=new BP,QD=new BP,WD=new BP,qD=new BP,XD=new BP,YD=new NP,KD=new BP,JD=new qP,ZD=new NP;class $D{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);-1!==n&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class ek extends $D{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,r=this.tolerance*this.tolerance,s=this.equations,o=s.length,a=t.bodies,l=a.length,c=e;let u,d,h,p,f,m;if(0!==o)for(let y=0;y!==l;y++)a[y].updateSolveMassProperties();const g=nk,_=ik,v=tk;g.length=o,_.length=o,v.length=o;for(let y=0;y!==o;y++){const e=s[y];v[y]=0,_[y]=e.computeB(c),g[y]=1/e.computeC()}if(0!==o){for(let n=0;n!==l;n++){const e=a[n],t=e.vlambda,i=e.wlambda;t.set(0,0,0),i.set(0,0,0)}for(n=0;n!==i;n++){p=0;for(let e=0;e!==o;e++){const t=s[e];u=_[e],d=g[e],m=v[e],f=t.computeGWlambda(),h=d*(u-f-t.eps*m),m+h<t.minForce?h=t.minForce-m:m+h>t.maxForce&&(h=t.maxForce-m),v[e]+=h,p+=h>0?h:-h,t.addToWlambda(h)}if(p*p<r)break}for(let n=0;n!==l;n++){const e=a[n],t=e.velocity,i=e.angularVelocity;e.vlambda.vmul(e.linearFactor,e.vlambda),t.vadd(e.vlambda,t),e.wlambda.vmul(e.angularFactor,e.wlambda),i.vadd(e.wlambda,i)}let e=s.length;const t=1/c;for(;e--;)s[e].multiplier=v[e]*t}return n}}const tk=[],nk=[],ik=[];iR.STATIC;class rk{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class sk extends rk{constructor(){super(...arguments),this.type=BP}constructObject(){return new BP}}const ok=WP.types.SPHERE,ak=WP.types.SPHERE|WP.types.PLANE,lk=WP.types.BOX|WP.types.BOX,ck=WP.types.SPHERE|WP.types.BOX,uk=WP.types.PLANE|WP.types.BOX,dk=WP.types.CONVEXPOLYHEDRON,hk=WP.types.SPHERE|WP.types.CONVEXPOLYHEDRON,pk=WP.types.PLANE|WP.types.CONVEXPOLYHEDRON,fk=WP.types.BOX|WP.types.CONVEXPOLYHEDRON,mk=WP.types.SPHERE|WP.types.HEIGHTFIELD,gk=WP.types.BOX|WP.types.HEIGHTFIELD,_k=WP.types.CONVEXPOLYHEDRON|WP.types.HEIGHTFIELD,vk=WP.types.PARTICLE|WP.types.SPHERE,yk=WP.types.PLANE|WP.types.PARTICLE,bk=WP.types.BOX|WP.types.PARTICLE,Ak=WP.types.PARTICLE|WP.types.CONVEXPOLYHEDRON,wk=WP.types.CYLINDER,xk=WP.types.SPHERE|WP.types.CYLINDER,Ek=WP.types.PLANE|WP.types.CYLINDER,Ck=WP.types.BOX|WP.types.CYLINDER,Sk=WP.types.CONVEXPOLYHEDRON|WP.types.CYLINDER,Mk=WP.types.HEIGHTFIELD|WP.types.CYLINDER,Tk=WP.types.PARTICLE|WP.types.CYLINDER,Ik=WP.types.SPHERE|WP.types.TRIMESH,Pk=WP.types.PLANE|WP.types.TRIMESH;class Rk{get[ok](){return this.sphereSphere}get[ak](){return this.spherePlane}get[lk](){return this.boxBox}get[ck](){return this.sphereBox}get[uk](){return this.planeBox}get[dk](){return this.convexConvex}get[hk](){return this.sphereConvex}get[pk](){return this.planeConvex}get[fk](){return this.boxConvex}get[mk](){return this.sphereHeightfield}get[gk](){return this.boxHeightfield}get[_k](){return this.convexHeightfield}get[vk](){return this.sphereParticle}get[yk](){return this.planeParticle}get[bk](){return this.boxParticle}get[Ak](){return this.convexParticle}get[wk](){return this.convexConvex}get[xk](){return this.sphereConvex}get[Ek](){return this.planeConvex}get[Ck](){return this.boxConvex}get[Sk](){return this.convexConvex}get[Mk](){return this.heightfieldCylinder}get[Tk](){return this.particleCylinder}get[Ik](){return this.sphereTrimesh}get[Pk](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new sk,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,r,s){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=e,o.bj=t):o=new gD(e,t),o.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const a=this.currentContactMaterial;o.restitution=a.restitution,o.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=n.material||e.material,c=i.material||t.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(o.restitution=l.restitution*c.restitution),o.si=r||n,o.sj=s||i,o}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,r=e.si,s=e.sj,o=this.world,a=this.currentContactMaterial;let l=a.friction;const c=r.material||n.material,u=s.material||i.material;if(c&&u&&c.friction>=0&&u.friction>=0&&(l=c.friction*u.friction),l>0){const r=l*o.gravity.length();let s=n.invMass+i.invMass;s>0&&(s=1/s);const c=this.frictionEquationPool,u=c.length?c.pop():new SD(n,i,r*s),d=c.length?c.pop():new SD(n,i,r*s);return u.bi=d.bi=n,u.bj=d.bj=i,u.minForce=d.minForce=-r*s,u.maxForce=d.maxForce=r*s,u.ri.copy(e.ri),u.rj.copy(e.rj),d.ri.copy(e.ri),d.rj.copy(e.rj),e.ni.tangents(u.t,d.t),u.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),d.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),u.enabled=d.enabled=e.enabled,t.push(u,d),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||1===e)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];Dk.setZero(),kk.setZero(),Bk.setZero();const r=t.bi;t.bj;for(let o=0;o!==e;o++)t=this.result[this.result.length-1-o],t.bi!==r?(Dk.vadd(t.ni,Dk),kk.vadd(t.ri,kk),Bk.vadd(t.rj,Bk)):(Dk.vsub(t.ni,Dk),kk.vadd(t.rj,kk),Bk.vadd(t.ri,Bk));const s=1/e;kk.scale(s,n.ri),Bk.scale(s,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),Dk.normalize(),Dk.tangents(n.t,i.t)}getContacts(e,t,n,i,r,s,o){this.contactPointPool=r,this.frictionEquationPool=o,this.result=i,this.frictionResult=s;const a=Uk,l=Nk,c=Ok,u=Lk;for(let d=0,h=e.length;d!==h;d++){const i=e[d],r=t[d];let s=null;i.material&&r.material&&(s=n.getContactMaterial(i.material,r.material)||null);const o=i.type&iR.KINEMATIC&&r.type&iR.STATIC||i.type&iR.STATIC&&r.type&iR.KINEMATIC||i.type&iR.KINEMATIC&&r.type&iR.KINEMATIC;for(let e=0;e<i.shapes.length;e++){i.quaternion.mult(i.shapeOrientations[e],a),i.quaternion.vmult(i.shapeOffsets[e],c),c.vadd(i.position,c);const t=i.shapes[e];for(let e=0;e<r.shapes.length;e++){r.quaternion.mult(r.shapeOrientations[e],l),r.quaternion.vmult(r.shapeOffsets[e],u),u.vadd(r.position,u);const d=r.shapes[e];if(!(t.collisionFilterMask&d.collisionFilterGroup&&d.collisionFilterMask&t.collisionFilterGroup))continue;if(c.distanceTo(u)>t.boundingSphereRadius+d.boundingSphereRadius)continue;let h=null;t.material&&d.material&&(h=n.getContactMaterial(t.material,d.material)||null),this.currentContactMaterial=h||s||n.defaultContactMaterial;const p=this[t.type|d.type];if(p){let e=!1;e=t.type<d.type?p.call(this,t,d,c,u,a,l,i,r,t,d,o):p.call(this,d,t,u,c,l,a,r,i,t,d,o),e&&o&&(n.shapeOverlapKeeper.set(t.id,d.id),n.bodyOverlapKeeper.set(i.id,r.id))}}}}}sphereSphere(e,t,n,i,r,s,o,a,l,c,u){if(u)return n.distanceSquared(i)<(e.radius+t.radius)**2;const d=this.createContactEquation(o,a,e,t,l,c);i.vsub(n,d.ni),d.ni.normalize(),d.ri.copy(d.ni),d.rj.copy(d.ni),d.ri.scale(e.radius,d.ri),d.rj.scale(-t.radius,d.rj),d.ri.vadd(n,d.ri),d.ri.vsub(o.position,d.ri),d.rj.vadd(i,d.rj),d.rj.vsub(a.position,d.rj),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}spherePlane(e,t,n,i,r,s,o,a,l,c,u){const d=this.createContactEquation(o,a,e,t,l,c);if(d.ni.set(0,0,1),s.vmult(d.ni,d.ni),d.ni.negate(d.ni),d.ni.normalize(),d.ni.scale(e.radius,d.ri),n.vsub(i,iB),d.ni.scale(d.ni.dot(iB),rB),iB.vsub(rB,d.rj),-iB.dot(d.ni)<=e.radius){if(u)return!0;const e=d.ri,t=d.rj;e.vadd(n,e),e.vsub(o.position,e),t.vadd(i,t),t.vsub(a.position,t),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}boxBox(e,t,n,i,r,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,r,s,o,a,e,t,u)}sphereBox(e,t,n,i,r,s,o,a,l,c,u){const d=this.v3pool,h=pB;n.vsub(i,cB),t.getSideNormals(h,s);const p=e.radius;let f=!1;const m=mB,g=gB,_=_B;let v=null,y=0,b=0,A=0,w=null;for(let R=0,D=h.length;R!==D&&!1===f;R++){const e=uB;e.copy(h[R]);const t=e.length();e.normalize();const n=cB.dot(e);if(n<t+p&&n>0){const i=dB,r=hB;i.copy(h[(R+1)%3]),r.copy(h[(R+2)%3]);const s=i.length(),o=r.length();i.normalize(),r.normalize();const a=cB.dot(i),l=cB.dot(r);if(a<s&&a>-s&&l<o&&l>-o){const s=Math.abs(n-t-p);if((null===w||s<w)&&(w=s,b=a,A=l,v=t,m.copy(e),g.copy(i),_.copy(r),y++,u))return!0}}}if(y){f=!0;const r=this.createContactEquation(o,a,e,t,l,c);m.scale(-p,r.ri),r.ni.copy(m),r.ni.negate(r.ni),m.scale(v,m),g.scale(b,g),m.vadd(g,m),_.scale(A,_),m.vadd(_,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}let x=d.get();const E=fB;for(let R=0;2!==R&&!f;R++)for(let r=0;2!==r&&!f;r++)for(let s=0;2!==s&&!f;s++)if(x.set(0,0,0),R?x.vadd(h[0],x):x.vsub(h[0],x),r?x.vadd(h[1],x):x.vsub(h[1],x),s?x.vadd(h[2],x):x.vsub(h[2],x),i.vadd(x,E),E.vsub(n,E),E.lengthSquared()<p*p){if(u)return!0;f=!0;const r=this.createContactEquation(o,a,e,t,l,c);r.ri.copy(E),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(p,r.ri),r.rj.copy(x),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}d.release(x),x=null;const C=d.get(),S=d.get(),M=d.get(),T=d.get(),I=d.get(),P=h.length;for(let R=0;R!==P&&!f;R++)for(let r=0;r!==P&&!f;r++)if(R%3!=r%3){h[r].cross(h[R],C),C.normalize(),h[R].vadd(h[r],S),M.copy(n),M.vsub(S,M),M.vsub(i,M);const s=M.dot(C);C.scale(s,T);let d=0;for(;d===R%3||d===r%3;)d++;I.copy(n),I.vsub(T,I),I.vsub(S,I),I.vsub(i,I);const m=Math.abs(s),g=I.length();if(m<h[d].length()&&g<p){if(u)return!0;f=!0;const r=this.createContactEquation(o,a,e,t,l,c);S.vadd(T,r.rj),r.rj.copy(r.rj),I.negate(r.ni),r.ni.normalize(),r.ri.copy(r.rj),r.ri.vadd(i,r.ri),r.ri.vsub(n,r.ri),r.ri.normalize(),r.ri.scale(p,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}d.release(C,S,M,T,I)}planeBox(e,t,n,i,r,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,r,s,o,a,e,t,u)}convexConvex(e,t,n,i,r,s,o,a,l,c,u,d,h){const p=DB;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,i,s,p,d,h)){const d=[],h=kB;e.clipAgainstHull(n,r,t,i,s,p,-100,100,d);let f=0;for(let r=0;r!==d.length;r++){if(u)return!0;const s=this.createContactEquation(o,a,e,t,l,c),m=s.ri,g=s.rj;p.negate(s.ni),d[r].normal.negate(h),h.scale(d[r].depth,h),d[r].point.vadd(h,m),g.copy(d[r].point),m.vsub(n,m),g.vsub(i,g),m.vadd(n,m),m.vsub(o.position,m),g.vadd(i,g),g.vsub(a.position,g),this.result.push(s),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(s,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(e,t,n,i,r,s,o,a,l,c,u){const d=this.v3pool;n.vsub(i,vB);const h=t.faceNormals,p=t.faces,f=t.vertices,m=e.radius;let g=!1;for(let _=0;_!==f.length;_++){const r=f[_],d=wB;s.vmult(r,d),i.vadd(d,d);const h=AB;if(d.vsub(n,h),h.lengthSquared()<m*m){if(u)return!0;g=!0;const r=this.createContactEquation(o,a,e,t,l,c);return r.ri.copy(h),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(m,r.ri),d.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),void this.createFrictionEquationsFromContact(r,this.frictionResult)}}for(let _=0,v=p.length;_!==v&&!1===g;_++){const r=h[_],v=p[_],y=xB;s.vmult(r,y);const b=EB;s.vmult(f[v[0]],b),b.vadd(i,b);const A=CB;y.scale(-m,A),n.vadd(A,A);const w=SB;A.vsub(b,w);const x=w.dot(y),E=MB;if(n.vsub(b,E),x<0&&E.dot(y)>0){const r=[];for(let e=0,t=v.length;e!==t;e++){const t=d.get();s.vmult(f[v[e]],t),i.vadd(t,t),r.push(t)}if(lB(r,y,n)){if(u)return!0;g=!0;const s=this.createContactEquation(o,a,e,t,l,c);y.scale(-m,s.ri),y.negate(s.ni);const h=d.get();y.scale(-x,h);const p=d.get();y.scale(-m,p),n.vsub(i,s.rj),s.rj.vadd(p,s.rj),s.rj.vadd(h,s.rj),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),d.release(h),d.release(p),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let e=0,t=r.length;e!==t;e++)d.release(r[e]);return}for(let h=0;h!==v.length;h++){const p=d.get(),g=d.get();s.vmult(f[v[(h+1)%v.length]],p),s.vmult(f[v[(h+2)%v.length]],g),i.vadd(p,p),i.vadd(g,g);const _=yB;g.vsub(p,_);const y=bB;_.unit(y);const b=d.get(),A=d.get();n.vsub(p,A);const w=A.dot(y);y.scale(w,b),b.vadd(p,b);const x=d.get();if(b.vsub(n,x),w>0&&w*w<_.lengthSquared()&&x.lengthSquared()<m*m){if(u)return!0;const s=this.createContactEquation(o,a,e,t,l,c);b.vsub(i,s.rj),b.vsub(n,s.ni),s.ni.normalize(),s.ni.scale(m,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let e=0,t=r.length;e!==t;e++)d.release(r[e]);return d.release(p),d.release(g),d.release(b),d.release(x),void d.release(A)}d.release(p),d.release(g),d.release(b),d.release(x),d.release(A)}for(let e=0,t=r.length;e!==t;e++)d.release(r[e])}}}planeConvex(e,t,n,i,r,s,o,a,l,c,u){const d=TB,h=IB;h.set(0,0,1),r.vmult(h,h);let p=0;const f=PB;for(let m=0;m!==t.vertices.length;m++)if(d.copy(t.vertices[m]),s.vmult(d,d),i.vadd(d,d),d.vsub(n,f),h.dot(f)<=0){if(u)return!0;const r=this.createContactEquation(o,a,e,t,l,c),s=RB;h.scale(h.dot(f),s),d.vsub(s,s),s.vsub(n,r.ri),r.ni.copy(h),d.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(e,t,n,i,r,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,r,s,o,a,e,t,u)}sphereHeightfield(e,t,n,i,r,s,o,a,l,c,u){const d=t.data,h=e.radius,p=t.elementSize,f=qB,m=WB;qP.pointToLocalFrame(i,s,n,m);let g=Math.floor((m.x-h)/p)-1,_=Math.ceil((m.x+h)/p)+1,v=Math.floor((m.y-h)/p)-1,y=Math.ceil((m.y+h)/p)+1;if(_<0||y<0||g>d.length||v>d[0].length)return;g<0&&(g=0),_<0&&(_=0),v<0&&(v=0),y<0&&(y=0),g>=d.length&&(g=d.length-1),_>=d.length&&(_=d.length-1),y>=d[0].length&&(y=d[0].length-1),v>=d[0].length&&(v=d[0].length-1);const b=[];t.getRectMinMax(g,v,_,y,b);const A=b[0],w=b[1];if(m.z-h>w||m.z+h<A)return;const x=this.result;for(let E=g;E<_;E++)for(let l=v;l<y;l++){const c=x.length;let d=!1;if(t.getConvexTrianglePillar(E,l,!1),qP.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,n,f,r,s,o,a,e,t,u)),u&&d)return!0;if(t.getConvexTrianglePillar(E,l,!0),qP.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,n,f,r,s,o,a,e,t,u)),u&&d)return!0;if(x.length-c>2)return}}boxHeightfield(e,t,n,i,r,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,r,s,o,a,e,t,u)}convexHeightfield(e,t,n,i,r,s,o,a,l,c,u){const d=t.data,h=t.elementSize,p=e.boundingSphereRadius,f=HB,m=QB,g=VB;qP.pointToLocalFrame(i,s,n,g);let _=Math.floor((g.x-p)/h)-1,v=Math.ceil((g.x+p)/h)+1,y=Math.floor((g.y-p)/h)-1,b=Math.ceil((g.y+p)/h)+1;if(v<0||b<0||_>d.length||y>d[0].length)return;_<0&&(_=0),v<0&&(v=0),y<0&&(y=0),b<0&&(b=0),_>=d.length&&(_=d.length-1),v>=d.length&&(v=d.length-1),b>=d[0].length&&(b=d[0].length-1),y>=d[0].length&&(y=d[0].length-1);const A=[];t.getRectMinMax(_,y,v,b,A);const w=A[0],x=A[1];if(!(g.z-p>x||g.z+p<w))for(let E=_;E<v;E++)for(let l=y;l<b;l++){let c=!1;if(t.getConvexTrianglePillar(E,l,!1),qP.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(c=this.convexConvex(e,t.pillarConvex,n,f,r,s,o,a,null,null,u,m,null)),u&&c)return!0;if(t.getConvexTrianglePillar(E,l,!0),qP.pointToWorldFrame(i,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(c=this.convexConvex(e,t.pillarConvex,n,f,r,s,o,a,null,null,u,m,null)),u&&c)return!0}}sphereParticle(e,t,n,i,r,s,o,a,l,c,u){const d=UB;if(d.set(0,0,1),i.vsub(n,d),d.lengthSquared()<=e.radius*e.radius){if(u)return!0;const n=this.createContactEquation(a,o,t,e,l,c);d.normalize(),n.rj.copy(d),n.rj.scale(e.radius,n.rj),n.ni.copy(d),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(e,t,n,i,r,s,o,a,l,c,u){const d=BB;d.set(0,0,1),o.quaternion.vmult(d,d);const h=OB;if(i.vsub(o.position,h),d.dot(h)<=0){if(u)return!0;const n=this.createContactEquation(a,o,t,e,l,c);n.ni.copy(d),n.ni.negate(n.ni),n.ri.set(0,0,0);const r=LB;d.scale(d.dot(i),r),i.vsub(r,r),n.rj.copy(r),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(e,t,n,i,r,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,r,s,o,a,e,t,u)}convexParticle(e,t,n,i,r,s,o,a,l,c,u){let d=-1;const h=jB,p=GB;let f=null;const m=FB;if(m.copy(i),m.vsub(n,m),r.conjugate(NB),NB.vmult(m,m),e.pointIsInside(m)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let t=0,n=e.faces.length;t!==n;t++){const n=[e.worldVertices[e.faces[t][0]]],r=e.worldFaceNormals[t];i.vsub(n[0],zB);const s=-r.dot(zB);if(null===f||Math.abs(s)<Math.abs(f)){if(u)return!0;f=s,d=t,h.copy(r)}}if(-1!==d){const r=this.createContactEquation(a,o,t,e,l,c);h.scale(f,p),p.vadd(i,p),p.vsub(n,p),r.rj.copy(p),h.negate(r.ni),r.ri.set(0,0,0);const s=r.ri,u=r.rj;s.vadd(i,s),s.vsub(a.position,s),u.vadd(n,u),u.vsub(o.position,u),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,r,s,o,a,l,c,u){return this.convexHeightfield(t,e,i,n,s,r,a,o,l,c,u)}particleCylinder(e,t,n,i,r,s,o,a,l,c,u){return this.convexParticle(t,e,i,n,s,r,a,o,l,c,u)}sphereTrimesh(e,t,n,i,r,s,o,a,l,c,u){const d=Wk,h=qk,p=Xk,f=Yk,m=Kk,g=Jk,_=tB,v=Qk,y=Vk,b=nB;qP.pointToLocalFrame(i,s,n,m);const A=e.radius;_.lowerBound.set(m.x-A,m.y-A,m.z-A),_.upperBound.set(m.x+A,m.y+A,m.z+A),t.getTrianglesInAABB(_,b);const w=Hk,x=e.radius*e.radius;for(let T=0;T<b.length;T++)for(let r=0;r<3;r++)if(t.getVertex(t.indices[3*b[T]+r],w),w.vsub(m,y),y.lengthSquared()<=x){if(v.copy(w),qP.pointToWorldFrame(i,s,v,w),w.vsub(n,y),u)return!0;let r=this.createContactEquation(o,a,e,t,l,c);r.ni.copy(y),r.ni.normalize(),r.ri.copy(r.ni),r.ri.scale(e.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.copy(w),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}for(let T=0;T<b.length;T++)for(let r=0;r<3;r++){t.getVertex(t.indices[3*b[T]+r],d),t.getVertex(t.indices[3*b[T]+(r+1)%3],h),h.vsub(d,p),m.vsub(h,g);const _=g.dot(p);m.vsub(d,g);let v=g.dot(p);if(v>0&&_<0&&(m.vsub(d,g),f.copy(p),f.normalize(),v=g.dot(f),f.scale(v,g),g.vadd(d,g),g.distanceTo(m)<e.radius)){if(u)return!0;const r=this.createContactEquation(o,a,e,t,l,c);g.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(e.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),qP.pointToWorldFrame(i,s,g,g),g.vsub(a.position,r.rj),qP.vectorToWorldFrame(s,r.ni,r.ni),qP.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}const E=Zk,C=$k,S=eB,M=Gk;for(let T=0,I=b.length;T!==I;T++){t.getTriangleVertices(b[T],E,C,S),t.getNormal(b[T],M),m.vsub(E,g);let r=g.dot(M);if(M.scale(r,g),m.vsub(g,g),r=g.distanceTo(m),RR.pointInTriangle(g,E,C,S)&&r<e.radius){if(u)return!0;let r=this.createContactEquation(o,a,e,t,l,c);g.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(e.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),qP.pointToWorldFrame(i,s,g,g),g.vsub(a.position,r.rj),qP.vectorToWorldFrame(s,r.ni,r.ni),qP.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}b.length=0}planeTrimesh(e,t,n,i,r,s,o,a,l,c,u){const d=new BP,h=Fk;h.set(0,0,1),r.vmult(h,h);for(let p=0;p<t.vertices.length/3;p++){t.getVertex(p,d);const r=new BP;r.copy(d),qP.pointToWorldFrame(i,s,r,d);const f=jk;if(d.vsub(n,f),h.dot(f)<=0){if(u)return!0;const n=this.createContactEquation(o,a,e,t,l,c);n.ni.copy(h);const i=zk;h.scale(f.dot(h),i),d.vsub(i,i),n.ri.copy(i),n.ri.vsub(o.position,n.ri),n.rj.copy(d),n.rj.vsub(a.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const Dk=new BP,kk=new BP,Bk=new BP,Ok=new BP,Lk=new BP,Uk=new VP,Nk=new VP,Fk=new BP,jk=new BP,zk=new BP,Gk=new BP,Vk=new BP;new BP;const Hk=new BP,Qk=new BP,Wk=new BP,qk=new BP,Xk=new BP,Yk=new BP,Kk=new BP,Jk=new BP,Zk=new BP,$k=new BP,eB=new BP,tB=new NP,nB=[],iB=new BP,rB=new BP,sB=new BP,oB=new BP,aB=new BP;function lB(e,t,n){let i=null;const r=e.length;for(let s=0;s!==r;s++){const o=e[s],a=sB;e[(s+1)%r].vsub(o,a);const l=oB;a.cross(t,l);const c=aB;n.vsub(o,c);const u=l.dot(c);if(!(null===i||u>0&&!0===i||u<=0&&!1===i))return!1;null===i&&(i=u>0)}return!0}const cB=new BP,uB=new BP,dB=new BP,hB=new BP,pB=[new BP,new BP,new BP,new BP,new BP,new BP],fB=new BP,mB=new BP,gB=new BP,_B=new BP,vB=new BP,yB=new BP,bB=new BP,AB=new BP,wB=new BP,xB=new BP,EB=new BP,CB=new BP,SB=new BP,MB=new BP;new BP,new BP;const TB=new BP,IB=new BP,PB=new BP,RB=new BP,DB=new BP,kB=new BP,BB=new BP,OB=new BP,LB=new BP,UB=new BP,NB=new VP,FB=new BP;new BP;const jB=new BP,zB=new BP,GB=new BP,VB=new BP,HB=new BP,QB=[0],WB=new BP,qB=new BP;class XB{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let r=0;for(;n>i[r];)r++;if(n!==i[r]){for(let e=i.length-1;e>=r;e--)i[e+1]=i[e];i[r]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,r=n.length,s=i.length;let o=0;for(let a=0;a<r;a++){let t=!1;const r=n[a];for(;r>i[o];)o++;t=r===i[o],t||YB(e,r)}o=0;for(let a=0;a<s;a++){let e=!1;const r=i[a];for(;r>n[o];)o++;e=n[o]===r,e||YB(t,r)}}}function YB(e,t){e.push((4294901760&t)>>16,65535&t)}const KB=(e,t)=>e<t?`${e}-${t}`:`${t}-${e}`;class JB{constructor(){this.data={keys:[]}}get(e,t){const n=KB(e,t);return this.data[n]}set(e,t,n){const i=KB(e,t);this.get(e,t)||this.data.keys.push(i),this.data[i]=n}delete(e,t){const n=KB(e,t),i=this.data.keys.indexOf(n);-1!==i&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;)delete e[t.pop()]}}class ZB extends GP{constructor(e){void 0===e&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new BP,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=void 0!==e.broadphase?e.broadphase:new wR,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==e.solver?e.solver:new ek,this.constraints=[],this.narrowphase=new Rk(this),this.collisionMatrix=new zP,this.collisionMatrixPrevious=new zP,this.bodyOverlapKeeper=new XB,this.shapeOverlapKeeper=new XB,this.contactmaterials=[],this.contactMaterialTable=new JB,this.defaultMaterial=new PD("default"),this.defaultContactMaterial=new ID(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof xR?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,i){return void 0===n&&(n={}),n.mode=RR.ALL,n.from=e,n.to=t,n.callback=i,$B.intersectWorld(this,n)}raycastAny(e,t,n,i){return void 0===n&&(n={}),n.mode=RR.ANY,n.from=e,n.to=t,n.result=i,$B.intersectWorld(this,n)}raycastClosest(e,t,n,i){return void 0===n&&(n={}),n.mode=RR.CLOSEST,n.from=e,n.to=t,n.result=i,$B.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof iR&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(-1!==i){n.splice(i,1);for(let e=0;e!==n.length;e++)n[e].index=e;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let t=0;t<i.length;t++){const n=i[t];if(n.id===e)return n}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);-1!==t&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){void 0===e&&(e=1/60),void 0===t&&(t=10);const n=eO.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(e,i,t)}else this.step(e,void 0,t);this.lastCallTime=n}step(e,t,n){if(void 0===n&&(n=10),void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=eO.now();let r=0;for(;this.accumulator>=e&&r<n&&(this.internalStep(e),this.accumulator-=e,r++,!(eO.now()-i>1e3*e)););this.accumulator=this.accumulator%e;const s=this.accumulator/e;for(let e=0;e!==this.bodies.length;e++){const t=this.bodies[e];t.previousPosition.lerp(t.position,s,t.interpolatedPosition),t.previousQuaternion.slerp(t.quaternion,s,t.interpolatedQuaternion),t.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=oO,i=aO,r=this.bodies.length,s=this.bodies,o=this.solver,a=this.gravity,l=this.doProfiling,c=this.profile,u=iR.DYNAMIC;let d=-1/0;const h=this.constraints,p=sO;a.length();const f=a.x,m=a.y,g=a.z;let _=0;for(l&&(d=eO.now()),_=0;_!==r;_++){const e=s[_];if(e.type===u){const t=e.force,n=e.mass;t.x+=n*f,t.y+=n*m,t.z+=n*g}}for(let M=0,T=this.subsystems.length;M!==T;M++)this.subsystems[M].update();l&&(d=eO.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),l&&(c.broadphase=eO.now()-d);let v=h.length;for(_=0;_!==v;_++){const e=h[_];if(!e.collideConnected)for(let t=n.length-1;t>=0;t-=1)(e.bodyA===n[t]&&e.bodyB===i[t]||e.bodyB===n[t]&&e.bodyA===i[t])&&(n.splice(t,1),i.splice(t,1))}this.collisionMatrixTick(),l&&(d=eO.now());const y=rO,b=t.length;for(_=0;_!==b;_++)y.push(t[_]);t.length=0;const A=this.frictionEquations.length;for(_=0;_!==A;_++)p.push(this.frictionEquations[_]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,y,this.frictionEquations,p),l&&(c.narrowphase=eO.now()-d),l&&(d=eO.now()),_=0;_<this.frictionEquations.length;_++)o.addEquation(this.frictionEquations[_]);const w=t.length;for(let M=0;M!==w;M++){const e=t[M],n=e.bi,i=e.bj,r=e.si,s=e.sj;let a;a=n.material&&i.material&&this.getContactMaterial(n.material,i.material)||this.defaultContactMaterial,a.friction,n.material&&i.material&&(n.material.friction>=0&&i.material.friction>=0&&(n.material.friction,i.material.friction),n.material.restitution>=0&&i.material.restitution>=0&&(e.restitution=n.material.restitution*i.material.restitution)),o.addEquation(e),n.allowSleep&&n.type===iR.DYNAMIC&&n.sleepState===iR.SLEEPING&&i.sleepState===iR.AWAKE&&i.type!==iR.STATIC&&i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(n.wakeUpAfterNarrowphase=!0),i.allowSleep&&i.type===iR.DYNAMIC&&i.sleepState===iR.SLEEPING&&n.sleepState===iR.AWAKE&&n.type!==iR.STATIC&&n.velocity.lengthSquared()+n.angularVelocity.lengthSquared()>=2*n.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(n,i,!0),this.collisionMatrixPrevious.get(n,i)||(iO.body=i,iO.contact=e,n.dispatchEvent(iO),iO.body=n,i.dispatchEvent(iO)),this.bodyOverlapKeeper.set(n.id,i.id),this.shapeOverlapKeeper.set(r.id,s.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=eO.now()-d,d=eO.now()),_=0;_!==r;_++){const e=s[_];e.wakeUpAfterNarrowphase&&(e.wakeUp(),e.wakeUpAfterNarrowphase=!1)}for(v=h.length,_=0;_!==v;_++){const e=h[_];e.update();for(let t=0,n=e.equations.length;t!==n;t++){const n=e.equations[t];o.addEquation(n)}}o.solve(e,this),l&&(c.solve=eO.now()-d),o.removeAllEquations();const x=Math.pow;for(_=0;_!==r;_++){const t=s[_];if(t.type&u){const n=x(1-t.linearDamping,e),i=t.velocity;i.scale(n,i);const r=t.angularVelocity;if(r){const n=x(1-t.angularDamping,e);r.scale(n,r)}}}this.dispatchEvent(nO),l&&(d=eO.now());const E=this.stepnumber%(this.quatNormalizeSkip+1)==0,C=this.quatNormalizeFast;for(_=0;_!==r;_++)s[_].integrate(e,E,C);this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=eO.now()-d),this.stepnumber+=1,this.dispatchEvent(tO);let S=!0;if(this.allowSleep)for(S=!1,_=0;_!==r;_++){const e=s[_];e.sleepTick(this.time),e.sleepState!==iR.SLEEPING&&(S=!0)}this.hasActiveBodies=S}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(lO,cO),e){for(let e=0,t=lO.length;e<t;e+=2)uO.bodyA=this.getBodyById(lO[e]),uO.bodyB=this.getBodyById(lO[e+1]),this.dispatchEvent(uO);uO.bodyA=uO.bodyB=null}if(t){for(let e=0,t=cO.length;e<t;e+=2)dO.bodyA=this.getBodyById(cO[e]),dO.bodyB=this.getBodyById(cO[e+1]),this.dispatchEvent(dO);dO.bodyA=dO.bodyB=null}lO.length=cO.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(lO,cO),n){for(let e=0,t=lO.length;e<t;e+=2){const t=this.getShapeById(lO[e]),n=this.getShapeById(lO[e+1]);hO.shapeA=t,hO.shapeB=n,t&&(hO.bodyA=t.body),n&&(hO.bodyB=n.body),this.dispatchEvent(hO)}hO.bodyA=hO.bodyB=hO.shapeA=hO.shapeB=null}if(i){for(let e=0,t=cO.length;e<t;e+=2){const t=this.getShapeById(cO[e]),n=this.getShapeById(cO[e+1]);pO.shapeA=t,pO.shapeB=n,t&&(pO.bodyA=t.body),n&&(pO.bodyB=n.body),this.dispatchEvent(pO)}pO.bodyA=pO.bodyB=pO.shapeA=pO.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const t=e[n];t.force,t.torque,t.force.set(0,0,0),t.torque.set(0,0,0)}}}new NP;const $B=new RR,eO=globalThis.performance||{};if(!eO.now){let e=Date.now();eO.timing&&eO.timing.navigationStart&&(e=eO.timing.navigationStart),eO.now=()=>Date.now()-e}new BP;const tO={type:"postStep"},nO={type:"preStep"},iO={type:iR.COLLIDE_EVENT_NAME,body:null,contact:null},rO=[],sO=[],oO=[],aO=[],lO=[],cO=[],uO={type:"beginContact",bodyA:null,bodyB:null},dO={type:"endContact",bodyA:null,bodyB:null},hO={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},pO={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var fO=function(){var e,t,i,r,s=0,o=new n.Pa4;function a(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new d,this.unassigned=new d,this.vertices=[]}function l(){this.normal=new n.Pa4,this.midpoint=new n.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=s,this.edge=null}function c(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function u(e,t){this.point=e,this.index=t,this.prev=null,this.next=null,this.face=null}function d(){this.head=null,this.tail=null}return Object.assign(a.prototype,{toJSON:function(){const e=this.faces.map((e=>e.toArray())),t=Array.from(new Set(e.flat())).sort(),n=[];for(let s=0;s<t.length;s++)n.push(this.vertices[t[s]].point.x,this.vertices[t[s]].point.y,this.vertices[t[s]].point.z);const i=new Map;for(let s=0;s<t.length;s++)i.set(t[s],s);const r=[];for(let s=0;s<e.length;s++)r.push([i.get(e[s][0]),i.get(e[s][1]),i.get(e[s][2])]);return[n,r]},setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.vertices.push(new u(e[t],t));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){var i,r,s,o=e.geometry;if(void 0!==o&&(o.isGeometry&&(o=o.toBufferGeometry?o.toBufferGeometry():(new BufferGeometry).fromGeometry(o)),o.isBufferGeometry)){var a=o.attributes.position;if(void 0!==a)for(i=0,r=a.count;i<r;i++)(s=new n.Pa4).fromBufferAttribute(a,i).applyMatrix4(e.matrixWorld),t.push(s)}})),this.setFromPoints(t)},containsPoint:function(e){for(var t=this.faces,n=0,i=t.length;n<i;n++)if(t[n].distanceToPoint(e)>this.tolerance)return!1;return!0},intersectRay:function(e,t){for(var n=this.faces,i=-1/0,r=1/0,s=0,o=n.length;s<o;s++){var a=n[s],l=a.distanceToPoint(e.origin),c=a.normal.dot(e.direction);if(l>0&&c>=0)return null;var u=0!==c?-l/c:0;if(!(u<=0)&&(c>0?r=Math.min(u,r):i=Math.max(u,i),i>r))return null}return i!==-1/0?e.at(i,t):e.at(r,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,o)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,n=e.outside;null!==n.next&&n.next.face===e;)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var n=this.removeAllVerticesFromFace(e);if(void 0!==n)if(void 0===t)this.unassigned.appendChain(n);else{var i=n;do{var r=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=r}while(null!==i)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var n=t.next,i=this.tolerance,r=null,o=0;o<e.length;o++){var a=e[o];if(a.mark===s){var l=a.distanceToPoint(t.point);if(l>i&&(i=l,r=a),i>1e3*this.tolerance)break}}null!==r&&this.addVertexToFace(t,r),t=n}while(null!==t)}return this},computeExtremes:function(){var e,t,i,r=new n.Pa4,s=new n.Pa4,o=[],a=[];for(e=0;e<3;e++)o[e]=a[e]=this.vertices[0];for(r.copy(this.vertices[0].point),s.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var l=this.vertices[e],c=l.point;for(i=0;i<3;i++)c.getComponent(i)<r.getComponent(i)&&(r.setComponent(i,c.getComponent(i)),o[i]=l);for(i=0;i<3;i++)c.getComponent(i)>s.getComponent(i)&&(s.setComponent(i,c.getComponent(i)),a[i]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(s.x))+Math.max(Math.abs(r.y),Math.abs(s.y))+Math.max(Math.abs(r.z),Math.abs(s.z))),{min:o,max:a}},computeInitialHull:function(){void 0===e&&(e=new n.Zzh,t=new n.JOQ,i=new n.Pa4);var r,s,o,a,c,u,d,h,p,f=this.vertices,m=this.computeExtremes(),g=m.min,_=m.max,v=0,y=0;for(u=0;u<3;u++)(p=_[u].point.getComponent(u)-g[u].point.getComponent(u))>v&&(v=p,y=u);for(s=g[y],o=_[y],v=0,e.set(s.point,o.point),u=0,d=this.vertices.length;u<d;u++)(r=f[u])!==s&&r!==o&&(e.closestPointToPoint(r.point,!0,i),(p=i.distanceToSquared(r.point))>v&&(v=p,a=r));for(v=-1,t.setFromCoplanarPoints(s.point,o.point,a.point),u=0,d=this.vertices.length;u<d;u++)(r=f[u])!==s&&r!==o&&r!==a&&(p=Math.abs(t.distanceToPoint(r.point)))>v&&(v=p,c=r);var b=[];if(t.distanceToPoint(c.point)<0)for(b.push(l.create(s,o,a),l.create(c,o,s),l.create(c,a,o),l.create(c,s,a)),u=0;u<3;u++)h=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge(h)),b[u+1].getEdge(1).setTwin(b[h+1].getEdge(0));else for(b.push(l.create(s,a,o),l.create(c,s,o),l.create(c,o,a),l.create(c,a,s)),u=0;u<3;u++)h=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge((3-u)%3)),b[u+1].getEdge(0).setTwin(b[h+1].getEdge(1));for(u=0;u<4;u++)this.faces.push(b[u]);for(u=0,d=f.length;u<d;u++)if((r=f[u])!==s&&r!==o&&r!==a&&r!==c){v=this.tolerance;var A=null;for(h=0;h<4;h++)(p=this.faces[h].distanceToPoint(r.point))>v&&(v=p,A=this.faces[h]);null!==A&&this.addVertexToFace(r,A)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var n=this.faces[t];n.mark===s&&e.push(n)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,n=this.assigned.first().face,i=n.outside;do{var r=n.distanceToPoint(i.point);r>t&&(t=r,e=i),i=i.next}while(null!==i&&i.face===n);return e}},computeHorizon:function(e,t,n,i){var r;this.deleteFaceVertices(n),n.mark=1,r=null===t?t=n.getEdge(0):t.next;do{var o=r.twin,a=o.face;a.mark===s&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,o,a,i):i.push(r)),r=r.next}while(r!==t);return this},addAdjoiningFace:function(e,t){var n=l.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var n=null,i=null,r=0;r<t.length;r++){var s=t[r],o=this.addAdjoiningFace(e,s);null===n?n=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return n.next.setTwin(i),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(l,{create:function(e,t,n){var i=new l,r=new c(e,i),s=new c(t,i),o=new c(n,i);return r.next=o.prev=s,s.next=r.prev=o,o.next=s.prev=r,i.edge=r,i.compute()}}),Object.assign(l.prototype,{toArray:function(){const e=[];let t=this.edge;do{e.push(t.head().index),t=t.next}while(t!==this.edge);return e},getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===r&&(r=new n.CJI);var e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return r.set(e.point,t.point,i.point),r.getNormal(this.normal),r.getMidpoint(this.midpoint),this.area=r.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(c.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(d.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),a}();const mO=new n.Pa4,gO=new n.Pa4,_O=new n._fP;function vO(e){const t=function(e){const t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t}(e);if(0===t.length)return null;if(1===t.length)return yO(t[0]);let i;const r=[];for(;i=t.pop();)r.push(wO(yO(i)));return function(e){let t=0;for(let n=0;n<e.length;n++){const i=e[n].attributes.position;i&&3===i.itemSize&&(t+=i.count)}const i=new Float32Array(3*t);let r=0;for(let n=0;n<e.length;n++){const t=e[n].attributes.position;if(t&&3===t.itemSize)for(let e=0;e<t.count;e++)i[r++]=t.getX(e),i[r++]=t.getY(e),i[r++]=t.getZ(e)}return(new n.u9r).setAttribute("position",new n.TlE(i,3))}(r)}function yO(e){let t=e.geometry;return t=t.toBufferGeometry?t.toBufferGeometry():t.clone(),e.updateMatrixWorld(),e.matrixWorld.decompose(mO,_O,gO),t.scale(gO.x,gO.y,gO.z),t}function bO(e){const t=e.attributes.position,n=new Float32Array(3*t.count);for(let i=0;i<t.count;i++)n[3*i]=t.getX(i),n[3*i+1]=t.getY(i),n[3*i+2]=t.getZ(i);return n}function AO(e,t){switch(t){case"x":return e.x;case"y":return e.y;case"z":return e.z}throw new Error(`Unexpected component ${t}`)}function wO(e,t=1e-4){t=Math.max(t,Number.EPSILON);const i={},r=e.getIndex(),s=e.getAttribute("position"),o=r?r.count:s.count;let a=0;const l=[],c=[],u=Math.log10(1/t),d=Math.pow(10,u);for(let n=0;n<o;n++){const e=r?r.getX(n):n;let t="";t+=~~(s.getX(e)*d)+",",t+=~~(s.getY(e)*d)+",",t+=~~(s.getZ(e)*d)+",",t in i?l.push(i[t]):(c.push(s.getX(e)),c.push(s.getY(e)),c.push(s.getZ(e)),i[t]=a,l.push(a),a++)}const h=new n.TlE(new Float32Array(c),s.itemSize,s.normalized),p=new n.u9r;return p.setAttribute("position",h),p.setIndex(l),p}const xO=Math.PI/2;var EO;!function(e){e.BOX="Box",e.CYLINDER="Cylinder",e.SPHERE="Sphere",e.HULL="ConvexPolyhedron",e.MESH="Trimesh"}(EO||(EO={}));const CO=function(e,t={}){const i=function(e,t={}){let i;if(t.type===EO.BOX)return MO(e);if(t.type===EO.CYLINDER)return function(e,t){const i=["x","y","z"],r=t.cylinderAxis||"y",s=i.splice(i.indexOf(r),1)&&i,o=(new n.ZzF).setFromObject(e);if(!isFinite(o.min.lengthSq()))return null;const a=o.max[r]-o.min[r],l=.5*Math.max(AO(o.max,s[0])-AO(o.min,s[0]),AO(o.max,s[1])-AO(o.min,s[1])),c="y"===r?xO:0,u="z"===r?xO:0;return{type:EO.CYLINDER,params:{radiusTop:l,radiusBottom:l,height:a,segments:12},orientation:(new VP).setFromEuler(c,u,0,"XYZ").normalize()}}(e,t);if(t.type===EO.SPHERE)return function(e,t){if(t.sphereRadius)return{type:EO.SPHERE,params:{radius:t.sphereRadius}};const n=vO(e);return n?(n.computeBoundingSphere(),{type:EO.SPHERE,params:{radius:n.boundingSphere.radius}}):null}(e,t);if(t.type===EO.HULL)return function(e){const t=vO(e);if(!t)return null;const i=1e-4;for(let n=0;n<t.attributes.position.count;n++)t.attributes.position.setXYZ(n,t.attributes.position.getX(n)+(Math.random()-.5)*i,t.attributes.position.getY(n)+(Math.random()-.5)*i,t.attributes.position.getZ(n)+(Math.random()-.5)*i);const[r,s]=(new fO).setFromObject(new n.Kj0(t)).toJSON();return{type:EO.HULL,params:{vertices:new Float32Array(r),faces:s}}}(e);if(t.type===EO.MESH)return i=vO(e),i?function(e){const t=bO(e);if(!t.length)return null;const n=new Uint32Array(t.length);for(let i=0;i<t.length;i++)n[i]=i;return{type:EO.MESH,params:{vertices:t,indices:n}}}(i):null;if(t.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${t.type}".`);if(i=vO(e),!i)return null;switch(i.type){case"BoxGeometry":case"BoxBufferGeometry":return SO(i);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){const t=e.parameters;return{type:EO.CYLINDER,params:{radiusTop:t.radiusTop,radiusBottom:t.radiusBottom,height:t.height,segments:t.radialSegments},orientation:(new VP).setFromEuler(n.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(i);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();const t=e.boundingBox;return{type:EO.BOX,params:{x:(t.max.x-t.min.x)/2||.1,y:(t.max.y-t.min.y)/2||.1,z:(t.max.z-t.min.z)/2||.1}}}(i);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return{type:EO.SPHERE,params:{radius:e.parameters.radius}}}(i);case"TubeGeometry":case"BufferGeometry":return MO(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',i.type),SO(i)}}(e,t);if(!i)return null;const{type:r,params:s,offset:o,orientation:a}=i;let l;return l=r===EO.BOX?function(e){const{x:t,y:n,z:i}=e;return new eR(new BP(t,n,i))}(s):r===EO.CYLINDER?function(e){const{radiusTop:t,radiusBottom:n,height:i,segments:r}=e,s=new DD(t,n,i,r);return s.radiusTop=n,s.radiusBottom=n,s.height=i,s.numSegments=r,s}(s):r===EO.SPHERE?function(e){return new RD(e.radius)}(s):r===EO.HULL?function(e){const{faces:t,vertices:n}=e,i=[];for(let r=0;r<n.length;r+=3)i.push(new BP(n[r],n[r+1],n[r+2]));return new YP({faces:t,vertices:i})}(s):function(e){const{vertices:t,indices:n}=e;return new FD(t,n)}(s),{shape:l,offset:o,orientation:a}};function SO(e){if(!bO(e).length)return null;e.computeBoundingBox();const t=e.boundingBox;return{type:EO.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2}}}function MO(e){const t=e.clone();t.quaternion.set(0,0,0,1),t.updateMatrixWorld();const i=(new n.ZzF).setFromObject(t);if(!isFinite(i.min.lengthSq()))return null;const r=i.translate(t.position.negate()).getCenter(new n.Pa4);return{type:EO.BOX,params:{x:(i.max.x-i.min.x)/2,y:(i.max.y-i.min.y)/2,z:(i.max.z-i.min.z)/2},offset:r.lengthSq()?new BP(r.x,r.y,r.z):void 0}}var TO,IO=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let PO=TO=class extends _t{constructor(e=!1){super(),this._world=new ZB,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var e;null===(e=this._viewer)||void 0===e||e.scene.modelRoot.children.forEach((e=>{this.makeBody(e)}))},this._bodyMeshMap=new Map,this._movementPlane=new n.Kj0(new n._12(100,100),new n.vBJ({color:65280,side:n.ehD})),this.enabled=e,this._world.gravity.set(0,-9.81,0);const t=new kD,i=new iR({mass:0,position:new BP(0,-2,0)});i.addShape(t),i.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=i,this._world.addBody(i);const r=new RD(.1);this._jointBody=new iR({mass:0}),this._jointBody.addShape(r),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(e){await super.onAdded(e);const t=new n.Pa4,i=new n.Pa4,r=new n.Pa4,s=new n._fP,o=new n._fP,a=new n.yGw,l=new n.yGw;let c=!1,u=!1;function d(t){const i=e.canvas.getBoundingClientRect(),r=new n.FM8;return r.x=(t.clientX-i.x)/i.width*2-1,r.y=-(t.clientY-i.y)/i.height*2+1,r}e.addEventListener("preFrame",(()=>{const n=e.getPlugin(G_),d=e.getPlugin(Io);if(!this.enabled){if(!(this.nextSteps>0))return n&&c&&(n.enableRefreshTransform=!0,c=!1),d&&u&&(d.enable(TO.PluginType),u=!1),void(this._dirty=!1);this.enabled=!0}if(n&&n.enableRefreshTransform&&!c&&(n.enableRefreshTransform=!1,c=!0),d&&!u&&d.disable(TO.PluginType),this.nextSteps>0)for(let e=0;e<this.stepPhysics.stepCount;e++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let h=!1;for(const e of this._world.bodies){if(0===e.mass)continue;const n=this._bodyMeshMap.get(e);if(n&&(n.updateMatrixWorld(),n.getWorldPosition(i),n.getWorldQuaternion(o),n.getWorldScale(r),i.manhattanDistanceTo(t.copy(e.position))>0&&(h=!0),o.angleTo(s.copy(e.quaternion))>0&&(h=!0),h)){if(a.compose(t,s,r),!n.parent)throw new Error("no parent");l.copy(n.parent.matrixWorld).invert(),l.multiply(a),l.decompose(t,s,r),n.position.copy(t),n.quaternion.copy(s)}}this._dirty=h,e.setDirty(),e.renderer.resetShadows(),null==n||n.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)})),e.scene.addEventListener("update",(e=>{this._bodyMeshMap.forEach(((e,t)=>{t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0)}))})),e.scene.addEventListener("addSceneObject",(e=>{var t;const n=null===(t=e.object)||void 0===t?void 0:t.modelObject;n&&n.traverse((e=>{const t=e.uiConfig;t&&Array.isArray(t.children)&&(t.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(e)},{type:"number",label:"Mass",hidden:()=>!e._physicsBody,getValue:()=>{var t,n;return null!==(n=null===(t=e._physicsBody)||void 0===t?void 0:t.mass)&&void 0!==n?n:0},setValue:t=>{e._physicsBody&&(e._physicsBody.mass=t)}}]}),void 0!==e.userData.physicsMass&&this.makeBody(e))}))})),e.canvas.addEventListener("pointerdown",(t=>{if(!this.enabled)return;if(!t.isPrimary)return;e.getPlugin(za)&&(e.getPlugin(za).enabled=!1);const i=d(t),r=new n.iMs;r.setFromCamera(i,e.scene.activeCamera.cameraObject);const s=r.intersectObjects([...this._bodyMeshMap.values()],!0);if(!s.length)return;let o,a=null,l=s[0];for(const e of s){for(a=e.object,l=e;!(null==a||a.visible&&a.material);)a=a.parent;if(a)break}if(!a)return;for(;a.parent&&!o;){for(const[e,t]of this._bodyMeshMap.entries())if(t===a){e.mass>0&&(o=e);break}a=a.parent}if(!o)return;e.scene.activeCamera.setInteractions(!1,TO.PluginType),this._movementPlane.position.copy(l.point),this._movementPlane.lookAt(e.scene.activeCamera.cameraObject.getWorldPosition(new n.Pa4));const c=(new BP).copy(l.point).vsub(o.position),u=o.quaternion.inverse().vmult(c);this._jointBody.position.copy(l.point),this._jointConstraint=new CD(o,u,this._jointBody,new BP(0,0,0)),this._world.addConstraint(this._jointConstraint)})),e.canvas.addEventListener("pointermove",(t=>{if(!this.enabled)return;if(!t.isPrimary)return;if(!this._jointConstraint)return;const i=d(t),r=new n.iMs;r.setFromCamera(i,e.scene.activeCamera.cameraObject);const s=r.intersectObject(this._movementPlane);if(!s.length)return;const o=s[0];this._jointBody.position.copy(o.point),this._jointConstraint.update()})),e.canvas.addEventListener("pointerup",(t=>{this.enabled&&t.isPrimary&&(e.getPlugin(za)&&(e.getPlugin(za).enabled=!0),e.scene.activeCamera.setInteractions(!0,TO.PluginType),this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))}))}makeBody(e){if(e.isLight)return;if(e._physicsBody)return;const t=[];let i=0;if(e.updateMatrixWorld(),e.traverse((e=>{var n;const r=e;if(!r.isMesh)return;if(!r.material)return;if(!r.visible)return;if(r._physicsShape)return void t.push(r._physicsShape);if(i+=null!==(n=r.userData.physicsMass)&&void 0!==n?n:1,r.addEventListener("objectUpdate",(()=>{0===r.userData.physicsMass&&(this._ground.position.y=r.position.y,this._bodyMeshMap.forEach(((e,t)=>{t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0),t.force.set(0,0,0),t.torque.set(0,0,0)})))})),0===r.userData.physicsMass)return;const s=CO(r,{type:EO.HULL});s?(t.push([s.shape,r]),r._physicsShape=s.shape):console.warn("Failed to convert mesh to cannon shape",r)})),!t.length)return;const r=new iR({mass:i,angularVelocity:new BP(0,0,0),velocity:new BP(0,0,0)}),s=new n.Pa4,o=new n._fP,a=new n.Pa4,l=new n.yGw;for(const[n,c]of t)c!==e?(c.updateMatrixWorld(),l.copy(e.matrixWorld).invert(),l.multiply(c.matrixWorld),l.decompose(s,o,a),r.addShape(n,new BP(...s.toArray()),new VP(...o.toArray()))):r.addShape(n);r.position.set(...e.getWorldPosition(s).toArray()),r.quaternion.set(...e.getWorldQuaternion(o).toArray()),r.angularVelocity.set(0,0,0),r.velocity.set(0,0,0),e.addEventListener("objectUpdate",(()=>{r.position.set(...e.getWorldPosition(s).toArray()),r.quaternion.set(...e.getWorldQuaternion(o).toArray()),r.angularVelocity.set(0,0,0),r.velocity.set(0,0,0)})),this._world.addBody(r),this._bodyMeshMap.set(r,e),e._physicsBody=r,e.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};PO.PluginType="CannonPhysics",IO([Oe("Enabled",(e=>({onChange:()=>{}}))),re()],PO.prototype,"enabled",void 0),IO([Be()],PO.prototype,"stepPhysics",void 0),IO([je("Make Root Bodies")],PO.prototype,"makeRootBodies",void 0),PO=TO=IO([We("Physics (dev)")],PO);var RO=__webpackgi_require__(819),DO=__webpackgi_require__(665);const kO=(e,t,n)=>{var i,r;const s=e.controller_,o=null===(r=null===(i=s.parent)||void 0===i?void 0:i.children)||void 0===r?void 0:r.indexOf(s),a=((e,t)=>t.controller_.rackController.rack===e.controller_.parent)(e,t);return!(a&&o===n||(t.add(e,n),0))},BO=(e,n,i,r)=>{var s,o,a,l,c;let u=n.uiRef;(null==u?void 0:u.controller_.viewProps.get("disposed"))&&(u=void 0);const d=null==u?void 0:u.expanded;if(!u){const i=e.addFolder({title:""});u=i,u.on("fold",(e=>{var r,s,o,a;let l=i.expanded;(0,t.safeSetProperty)(n,"expanded",l,!0),l=null!==(r=(0,t.getOrCall)(n.expanded))&&void 0!==r?r:l,l!==i.expanded&&(i.expanded=l),null===(s=n.uiRefresh)||void 0===s||s.call(n,"postFrame",!0,10),l?null===(o=n.onExpand)||void 0===o||o.call(n,n):null===(a=n.onCollapse)||void 0===a||a.call(n,n)}))}if(!u)return u;u.expanded=null!==(o=null!==(s=(0,t.getOrCall)(n.expanded))&&void 0!==s?s:d)&&void 0!==o&&o;const h=(null!==(a=n.children)&&void 0!==a?a:[]).map((e=>e&&(0,t.getOrCall)(e))).flat(2).filter((e=>e));let p=0;for(const t of h){if(Array.isArray(t)||"object"!=typeof t){console.error("child is not an object",t);continue}let e=t.uiRef;e&&e.controller_.viewProps.get("disposed")&&(t.uiRef=void 0,t.uiRefresh=void 0),e=t.uiRef,e||(i.appendUiObject({uiConfig:t},u),e=t.uiRef),e&&kO(e,u,p++)&&i.appendUiObject({uiConfig:t},u)}let f=u.children;for(;f.length>p;){const e=f[f.length-1];u.remove(e),e.dispose(),f=u.children}u.controller_.props.set("title",null!==(l=(0,t.getOrCall)(n.label))&&void 0!==l?l:"");const m=u.controller_.view.containerElement,g=(0,t.getOrCall)(n.domChildren,[]);if(void 0!==(null==g?void 0:g.length)){const e=[];for(let t=0;t<m.children.length;t++){const n=m.children[t];(null===(c=n.dataset)||void 0===c?void 0:c.tpCustomDOM)&&e.push(n)}for(const t of e)m.removeChild(t);for(const t of g)t.parentElement!==m&&(m.appendChild(t),t.dataset.tpCustomDOM="true");u.controller_.foldable.cleanUpTransition()}return u},OO=(e,n,i,r)=>{var s,o;const[a,l]=null!==(s=n.property)&&void 0!==s?s:[void 0,void 0],c=null!==(o=(0,t.getOrCall)(n.label))&&void 0!==o?o:l;let u=n.uiRef;return(null==u?void 0:u.controller_.viewProps.get("disposed"))&&(u=void 0),u||(u=e.addButton({title:""}),u.on("click",(async()=>{const e=[];n.prompt&&e.push(await i.prompt(...n.prompt));let t=a&&l?a[l]:void 0,r=a;if(t||(t=n.value,r=n),"function"==typeof t){const s=()=>{i.removeEventListener("postFrame",s),t.call(null!=r?r:n,...e)};i.addEventListener("postFrame",s)}else console.warn("uiconfig.js: Invalid action type for button")}))),u&&(u.title=(null!=c?c:"click me")+""),u},LO=(e,n,i,r)=>{var s;const o=Object.fromEntries((null!==(s=(0,t.getOrCall)(n.children))&&void 0!==s?s:[]).map((e=>(0,t.getOrCall)(e))).flat(2).filter((e=>e)).map((e=>{var n;const i=(0,t.getOrCall)(e.label);return[i,null!==(n=e.value)&&void 0!==n?n:i]})));return jO(e,n,i,{options:o,...null!=r?r:{}})},UO=(e,n,i,r)=>{var s,o;const a=(0,t.getOrCall)(n.bounds),l=(null!==(s=null==a?void 0:a.length)&&void 0!==s?s:0)>=2?a[1]:1,c=(null!==(o=null==a?void 0:a.length)&&void 0!==o?o:0)>=1?a[0]:0,u=n.stepSize||void 0;return jO(e,n,i,{min:c,max:l,step:u,...null!=r?r:{}})},NO=(e,i,r,s)=>{var o,a,l;const c=(0,t.getOrCall)(i.bounds);if(!c||c.length<1)return jO(e,i,r,{...null!=s?s:{}});const u=(null!==(o=c.length)&&void 0!==o?o:0)>=2?c[1]:1,d=(null!==(a=c.length)&&void 0!==a?a:0)>=1?c[0]:0,h={min:d,max:u,step:null!==(l=i.stepSize)&&void 0!==l?l:(u-d)/100},p={x:h,y:h};"vec3"!==i.type&&"vec4"!==i.type||(p.z=h),"vec4"===i.type&&(p.w=h);const f=i.property;if(void 0===i.value&&f&&f[0]&&"object"==typeof f[0]&&f[0][f[1]]&&Array.isArray(f[0][f[1]])){const[e,t]=f,r=e[t],s=r.length,o=(new(2===s?n.FM8:3===s?n.Pa4:n.Ltg)).fromArray(r);i.value=o,i.property=void 0,i.onChange=[()=>{e[t]=o.toArray()},...Array.isArray(i.onChange)?i.onChange:[i.onChange]].filter((e=>e)),void 0===i.label&&(i.label=t)}return jO(e,i,r,{...p,...null!=s?s:{}})},FO=(e,i,r,s)=>{var o;const a=i.property;if(void 0===i.value&&a&&"object"==typeof a[0]&&(null===(o=a[0][a[1]])||void 0===o?void 0:o.isColor)){const[e,t]=a,r=n.KI_;Object.defineProperty(i,"value",{get:()=>{const i=e[t];return i?new n.Ilk(i).getHex(r):0},set:i=>{const s=e[t],o=(new n.Ilk).setHex(i,r);s.isColor?s.copy(o):"number"==typeof s?e[t]=o.getHex():"string"==typeof s&&(e[t]="#"+o.getHexString()),"function"==typeof(null==e?void 0:e.setDirty)&&e.setDirty()}}),i.property=void 0,i.onChange=[...Array.isArray(i.onChange)?i.onChange:[i.onChange]].filter((e=>e)),void 0===i.label&&(i.label=t+"")}return(s=null!=s?s:{}).view="color",(0,t.getOrCall)(i.inlinePicker)&&(s.picker="inline"),jO(e,i,r,s)},jO=(e,n,i,r)=>{var s,o,a,l,c,u,d;let h=(0,t.getOrCall)(n.property);if((n.getValue||n.setValue)&&h&&console.error("specify either property or value, or getValue and setValue",n),h)n.value&&console.warn("uiconfig.js: Both property and value are defined, value will be ignored",n);else if((Object.hasOwn?Object.hasOwn(n,"value"):n.hasOwnProperty("value"))||void 0!==n.value||!n.getValue&&!n.setValue||(Object.defineProperty(n,"value",{get:()=>{var e;return null===(e=n.getValue)||void 0===e?void 0:e.call(n)},set:e=>{var t;return null===(t=n.setValue)||void 0===t?void 0:t.call(n,e)}}),h=[n,"value"]),h||void 0===n.value||(h=[n,"value"]),!h)return void console.error("cannot determine property",n);r=null!=r?r:{};const p={label:null!==(s=(0,t.getOrCall)(n.label))&&void 0!==s?s:h[1],...r};let f=n.uiRef;if((null==f?void 0:f.controller_.viewProps.get("disposed"))&&(f=void 0),!f&&"object"==typeof h[0]&&h[0]){const[t,i]=h;try{f=n.isMonitor?e.addMonitor(t,i,p):e.addInput(t,i,p).on("change",(e=>{[n.onChange].flat().forEach((t=>"function"==typeof t&&(null==t?void 0:t(e)))),"function"==typeof(null==t?void 0:t.setDirty)&&t.setDirty(e)}))}catch(e){if(!e.message.startsWith("No matching controller for"))throw e;f=void 0}}if(f){for(const[e,t]of Object.entries(p)){const n=f.controller_;let i=n.props.value(e);if(void 0!==i)i.rawValue!==t&&f.controller_.props.set(e,t);else{const r=n.valueController;i=null===(a=null===(o=r.props)||void 0===o?void 0:o.value)||void 0===a?void 0:a.call(o,e);let s=t;const u=null==i?void 0:i.rawValue;let d=!1;"options"===e&&"object"==typeof s&&!Array.isArray(s)&&Array.isArray(u)&&(s=Object.entries(s).map((([e,t])=>({text:e,value:t}))),d=!0),void 0===i||u===s||d&&f.__lastOptions===t||(r.props.set(e,s),d&&(null===(c=null===(l=r.view)||void 0===l?void 0:l.update_)||void 0===c||c.call(l),f.__lastOptions=t))}}"slider"===n.type&&(void 0!==p.min&&f.controller_.valueController.sliderController.props.set("minValue",p.min),void 0!==p.max&&f.controller_.valueController.sliderController.props.set("maxValue",p.max)),null===(u=(null==f?void 0:f.controller_.valueController.view).inputElement)||void 0===u||u.setAttribute("placeholder",null!==(d=(0,t.getOrCall)(n.placeholder))&&void 0!==d?d:""),f.refresh()}return f};class zO extends t.SimpleEventDispatcher{constructor(e=!1,t=!1,n=!1,i=!0,r=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:BO,folder:BO,input:jO,number:jO,slider:UO,dropdown:LO,checkbox:jO,color:FO,vec:NO,vec2:NO,vec3:NO,vec4:NO,button:OO,monitor:(e,t,n,i)=>(t.isMonitor=!0,jO(e,t,n,i)),dummy:(e,t,n,i)=>jO(e,t,n,i)},this.alert=async e=>alert(e),this.confirm=async e=>confirm(e),this.prompt=async(e,t,n=!0)=>prompt(e,t),this._expand=e,this._limitedOptions=n;const s=this._createUiContainer();r.appendChild(s),this._container=r,this._pane=new DO.Pane({title:"Configuration",container:s}),this._pane.expanded=this._expand,i&&(this.addEventListener("postFrame",(()=>this.refreshQueue("postFrame"))),setTimeout((()=>{this.dispatchEvent({type:"postFrame"})}),32))}refreshQueue(e){const n=this._refreshQueue[e],i=[],r=(0,t.now)(),s=r-this._lastModeTime[e];n.forEach((e=>{e[2]>.001?(e[2]-=s,i.push(e)):this._refreshUiObject(e[0],e[1],e[2])})),this._refreshQueue[e]=i,this._lastModeTime[e]=r}addToRefreshQueue(e,t){var n;const i=null===(n=t[0])||void 0===n?void 0:n.uiConfig,r=null==i?void 0:i.uuid,s=this._refreshQueue[e],o=s.find((e=>e[3]===r));o?o[2]=Math.max(o[2],t[2]):s.push([...t,r]),this._refreshQueue[e]=s}dispose(){var e;null===(e=this._pane)||void 0===e||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,n){var i,r,s,o;const{uiConfig:a}=null!=e?e:{};if(a&&(!this._limitedOptions||a.limitedUi)&&(n=null!=n?n:this._pane,a.type)){a.uuid||(a.uuid=De()),a.uiRef&&a.uiRefType!==a.type&&this.removeUiConfig(a);const l=null===(r=(i=this._typeGenerators)[a.type])||void 0===r?void 0:r.call(i,n,a,this);l&&(l.hidden=null!==(s=(0,t.getOrCall)(a.hidden))&&void 0!==s&&s,l.disabled=null!==(o=(0,t.getOrCall)(a.disabled))&&void 0!==o&&o),a.uiRef=l,a.uiRefType=l?a.type:void 0,a.uiRefresh=(t="postFrame",i=!1,r=0)=>{var s;return this._uiObjectRefresh(t,null!==(s=null==e?void 0:e.uiConfig)&&void 0!==s?s:a,n,i,r)},null==l||l.controller_.viewProps.handleDispose((()=>{a.uiRef=void 0,a.uiRefType=void 0,a.uiRefresh=void 0}))}}removeUiObject(e){this.removeUiConfig(null==e?void 0:e.uiConfig)}removeUiConfig(e){var t,n;e&&e.uiRef&&(null===(n=(t=e.uiRef).dispose)||void 0===n||n.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,i,r){(i?GO(t,n):[{uiConfig:t,parentFolder:n}]).forEach((t=>{const n=[{uiConfig:t.uiConfig},t.parentFolder,r];"immediate"===e?this._refreshUiObject(...n):this.addToRefreshQueue(e,n)}))}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,t.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,t.createStyles)(t.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function GO(e,t,n){return n=null!=n?n:[],e&&e.uiRef?(n.push({uiConfig:e,parentFolder:t}),"function"==typeof e.children||[...e.children||[]].forEach((t=>{"function"!=typeof t&&t&&(Array.isArray(t)?t.forEach((t=>n=GO(t,e.uiRef,n))):n=GO(t,e.uiRef,n))})),n):n}var VO=__webpackgi_require__(898),HO={};VO.Z&&VO.Z.locals&&(HO.locals=VO.Z.locals);var QO,WO=0,qO={};qO.styleTagTransform=uc(),qO.setAttributes=oc(),qO.insert=function(e,t){(t.target||document.head).appendChild(e)},qO.domAPI=rc(),qO.insertStyleElement=lc(),HO.use=function(e){return qO.options=e||{},WO++||(QO=nc()(VO.Z,qO)),HO},HO.unuse=function(){WO>0&&! --WO&&(QO(),QO=null)};var XO=HO;class YO extends zO{constructor(e=!1,t=!1,n=!1,i,r){var s,o;super(e,t,n,!1,null!==(s=null!=i?i:document.getElementById("tweakpaneMainPanelSlot"))&&void 0!==s?s:document.body),this.dependencies=[Ls],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=e=>{this.dispatchEvent(e),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async e=>this._viewer?this._viewer.alert(e):super.alert(e),this.confirm=async e=>this._viewer?this._viewer.confirm(e):super.confirm(e),this.prompt=async(e,t,n=!0)=>this._viewer?this._viewer.prompt(e,t,n):super.prompt(e,t,n),this._pane.registerPlugin(RO),XO.use({target:this._container}),this.colorMode=null!==(o=null!=r?r:localStorage?localStorage.getItem("tpTheme"):"blue")&&void 0!==o?o:"blue"}async onAdded(e){this._viewer=e,this._typeGenerators.image=(e=>(i,r,s,o)=>{let a=r.property||r.__property;const l="placeholder";if(void 0===r.value&&(r.getValue||r.setValue)&&(Object.defineProperty(r,"_value",{get:()=>{var e;return null===(e=r.getValue)||void 0===e?void 0:e.call(r)},set:e=>{var t;return null===(t=r.setValue)||void 0===t?void 0:t.call(r,e)}}),a=[r,"_value"]),(!(Object.hasOwn?Object.hasOwn(r,"value"):r.hasOwnProperty("value"))||void 0===r.value)&&a&&"object"==typeof a[0]){const[i,s]=a,o=(0,t.makeTextSvg)("Render Target"),c=(0,t.makeTextSvg)("Data Texture"),u=(0,t.makeTextSvg)("CUBE Texture"),d=(0,t.makeTextSvg)("Compressed Texture"),h={},p={};Object.defineProperty(r,"value",{get:()=>{var n;let r,a=i[s];if((null==a?void 0:a.get)&&(a=a.get()),!a)return l;if(a.isCompressedTexture&&a.image&&!a.image.tp_src&&(a.image.tp_src=d),a.isTexture?(a.image&&!a.image.tp_src&&(a.image instanceof ImageBitmap||a.image instanceof HTMLImageElement||a.image instanceof HTMLVideoElement)?a.image.tp_src=(0,t.imageBitmapToBase64)(a.image,160):a.image&&a.isRenderTargetTexture&&!a.image.tp_src?a.__target&&(a.tp_src=e.renderer.renderTargetToDataUrl(a.__target,void 0,void 0,Array.isArray(a.__target.texture)?a.__target.texture.indexOf(a):void 0)):a.image&&!a.image.tp_src&&(a.image.tp_src=ee(a,160,!1).toDataURL("image/png",90)),!a.isRenderTargetTexture||a.image.tp_src||a.tp_src||(a.image.tp_src=o),a.isDataTexture&&a.image&&!a.image.tp_src&&(a.image.tp_src=c),a.image&&(r=a.image.tp_src_uuid,r=r?h[r]:void 0,r||(r=a.image.tp_src||a.image.src)),a.tp_src&&(r=a.tp_src)):"string"==typeof a?r=a:a.domainMin?(r=a.texture,a.texture.image&&!a.texture.image.tp_src&&(a.texture.image.tp_src=u),a.texture.image&&(r=a.texture.image.tp_src_uuid,r=r?h[r]:void 0,r||(r=a.texture.image.tp_src||a.texture.image.src))):a&&console.error("unknown value",a),r||(r=l),a.image&&!a.image.tp_src_uuid){const e=De();a.image.tp_src_uuid=e,p[r]=e}return"string"==typeof r&&(r=null!==(n=h[r])&&void 0!==n?n:r),r},set:t=>{var o,a,c,u,d,f,m,g,_,v,y;const b=i[s],A=e=>{var t;i[s]=e,(null==e?void 0:e.isTexture)&&(e.flipY=e.isDataTexture?e.flipY:null===(t=null==b?void 0:b.flipY)||void 0===t||t)};if("string"==typeof t)return void("string"==typeof b&&A(t));if(!t)return void(r.value=l);if(t.isPlaceholder)return void(b&&(A("string"==typeof b?"":null),"function"==typeof(null==i?void 0:i.setDirty)&&i.setDirty()));let w=t.tp_src_uuid;if(w||(w=null!==(o=t.src)&&void 0!==o?o:t.tp_src,w=null!==(a=p[w])&&void 0!==a?a:w,delete p[w],t.tp_src_uuid=w),w&&(h[w]=t),"string"!=typeof b){if(!((null==b?void 0:b.image)===t||(null===(c=null==b?void 0:b.image)||void 0===c?void 0:c.src)===t.src||(null===(u=null==b?void 0:b.image)||void 0===u?void 0:u.tp_src)===t.tp_src&&null!=t.tp_src||(null===(d=null==b?void 0:b.image)||void 0===d?void 0:d.tp_src)===t.src&&null!=t.src||(null===(f=null==b?void 0:b.image)||void 0===f?void 0:f.src)===t.tp_src&&null!=t.tp_src))if(t instanceof File){const n=null==e?void 0:e.getPlugin(Ls);if(!n)throw"Viewer or AssetManagerPlugin not found";null===(m=n.importer)||void 0===m||m.importSingle({file:t,path:t.src}).then((e=>{var n,s,o,a;if(e){e.isDataTexture&&(e.needsUpdate=!0);const l=null===(o=null===(s=null===(n=t.src)||void 0===n?void 0:n.split("?"))||void 0===s?void 0:s[0])||void 0===o?void 0:o.split(".").pop();e.userData&&(e.userData.mimeType||(e.userData.mimeType="image/"+(["jpg","jpeg"].includes(l)?"jpeg":"png"))),A(e),[r.onChange].flat().forEach((e=>"function"==typeof e&&(null==e?void 0:e()))),"function"==typeof(null==i?void 0:i.setDirty)&&i.setDirty(),null===(a=r.uiRefresh)||void 0===a||a.call(r,"postFrame",!1)}}))}else{const e=new n.xEZ(t);e.assetType="texture",e.needsUpdate=!0;const o=null===(v=null===(_=null===(g=t.src)||void 0===g?void 0:g.split("?"))||void 0===_?void 0:_[0])||void 0===v?void 0:v.split(".").pop();e.userData.mimeType||(e.userData.mimeType="image/"+(["jpg","jpeg"].includes(o)?"jpeg":"png"));const a=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(s);e.colorSpace=a?n.GUF:n.KI_,e.wrapS=n.rpg,e.wrapT=n.rpg,A(e),[r.onChange].flat().forEach((e=>"function"==typeof e&&(null==e?void 0:e()))),"function"==typeof(null==i?void 0:i.setDirty)&&i.setDirty(),null===(y=r.uiRefresh)||void 0===y||y.call(r,"postFrame",!1)}}else A(w)}}),r.__property=r.property,r.property=void 0,void 0===r.label&&(r.label=s)}return(o=null!=o?o:{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],void 0===o.imageFit&&(o.imageFit="contain"),void 0===o.clickCallback&&(o.clickCallback=(i,o)=>{var a;const c=null==i?void 0:i.target,u=null==c?void 0:c.getBoundingClientRect();if(!u)return void o.click();const d=r.uiRef.controller_.valueController.value.rawValue,h=d===l||(null==d?void 0:d.isPlaceholder)?{}:{"remove image":()=>{var e;r.uiRef.controller_.valueController.value.setRawValue("");const[t,n]=r.property||r.__property||[r,"value"],i="string"==typeof t[n];t[n]=i?"":null,[r.onChange].flat().forEach((e=>"function"==typeof e&&(null==e?void 0:e()))),"function"==typeof(null==t?void 0:t.setDirty)&&t.setDirty(),null===(e=r.uiRefresh)||void 0===e||e.call(r,"postFrame",!1),T_.Remove()},"download image":async()=>{var i,s;T_.Remove();const[o,a]=r.property||r.__property||[r,"value"],l=o[a];if(!l)return;const c=null!==(i=null==l?void 0:l.image)&&void 0!==i?i:r.uiRef.controller_.valueController.value.rawValue;let u=l.__rootBlob?l.__rootBlob.objectUrl||URL.createObjectURL(l.__rootBlob):l.userData.rootPath||(null==c?void 0:c.src);c&&(c instanceof ImageBitmap||c instanceof HTMLImageElement||c instanceof HTMLVideoElement)&&!u&&(u=(0,t.imageBitmapToBase64)(c));let d=l.__rootBlob?l.__rootBlob.name||"image."+(l.__rootBlob.ext||"png"):null;if(!u&&l.isRenderTargetTexture){const t=l.__target;if(l.type===n.ywz)u=e.renderer.renderTargetToDataUrl(t,"image/png",90,Array.isArray(l.__target.texture)?l.__target.texture.indexOf(l):void 0),d="renderTarget.png";else{const n=(new ab).parse(e.renderer.rendererObject,t,{textureIndex:Array.isArray(l.__target.texture)?l.__target.texture.indexOf(l):void 0}),i=new Blob([n],{type:"image/x-exr"});if(!i)return void console.error("cannot export render target",c,o[a],o,a,r);d="renderTarget.exr",u=URL.createObjectURL(i)}}if(!u&&l.isDataTexture){const e=(new ab).parse(void 0,l),t=new Blob([e],{type:"image/x-exr"});if(!t)return void console.error("cannot export data texture",c,o[a],o,a,r);d="dataTexture.exr",u=URL.createObjectURL(t)}if(!u)return void console.error("cannot export image",c,o[a],o,a,r);const h=document.createElement("a");document.body.appendChild(h),h.style.display="none",h.href=u,h.download=d||(u.startsWith("data:")?"image.png":null!==(s=u.split("/").pop())&&void 0!==s?s:"image.png"),h.target="_blank",h.click(),document.body.removeChild(h)}},p=T_.Create({...h,"set/replace image":()=>{o.click(),T_.Remove()},"from url":async()=>{var t,i;let o="";if(o=await s.prompt("Load texture: Enter Image/Texture URL",o,!0),!o||!o.startsWith("http")&&!o.startsWith("data:image"))return null!==o&&await s.alert("Loading Image: Invalid URL"),void T_.Remove();o=o.trim();const[a,l]=r.property||r.__property||[r,"value"],c=a[l];if("string"==typeof c)a[l]=o,[r.onChange].flat().forEach((e=>"function"==typeof e&&(null==e?void 0:e()))),"function"==typeof(null==a?void 0:a.setDirty)&&a.setDirty(),null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!1);else{const t=null==e?void 0:e.getPlugin(Ls);if(!t)throw"Viewer or AssetManagerPlugin not found";null===(i=t.importer)||void 0===i||i.importSinglePath(o).then((e=>{var t;if(e){e.isDataTexture?e.needsUpdate=!0:e&&void 0!==(null==c?void 0:c.flipY)&&(e.flipY=c.flipY);const i=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(l);e.colorSpace=i?n.GUF:n.KI_,a[l]=e,[r.onChange].flat().forEach((e=>"function"==typeof e&&(null==e?void 0:e()))),"function"==typeof(null==a?void 0:a.setDirty)&&a.setDirty(),null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!1)}else console.warn("uiconfig-tweakpane: Failed to load texture",o)}))}T_.Remove()},cancel:()=>{T_.Remove()}},2,u.height+8);null===(a=c.parentElement)||void 0===a||a.appendChild(p),u.y>.7*document.body.clientHeight&&(p.style.top="auto",p.style.bottom=u.height+8+"px")}),o.view="input-image",jO(i,r,s,o)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var n;const i=null===(n=this._viewer)||void 0===n?void 0:n.getPlugin(e);if(!i)return void console.warn("plugin not found:",e);this._plugins.push(i),i.uiConfig&&(i.uiConfig.limitedUi=!0),i.uiConfig&&void 0===i.uiConfig.hidden&&(i.uiConfig.hidden=!1),this._appendUiObject(i);const r=i.uiConfig;if((null==r?void 0:r.uiRef)&&i.toJSON){const e="function"==typeof i.toJSON?i.toJSON():null;i.resetDefaults=async()=>{var t,n;await(null===(t=i.fromJSON)||void 0===t?void 0:t.call(i,e)),null===(n=r.uiRefresh)||void 0===n||n.call(r,"postFrame",!0)};const n=r.uiRef.controller_.view.element,s=(0,t.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});s.onclick=s=>{const o={};"function"==typeof i.toJSON&&(o["download preset"]=async()=>{var e,n;const r=null===(n=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Ls))||void 0===n?void 0:n.exportPluginPreset(i);await(0,t.downloadBlob)(new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),"preset."+i.constructor.PluginType+".json"),T_.Remove()}),"function"==typeof i.fromJSON&&(o["upload preset"]=async()=>{var e,n,s;T_.Remove();const o=await(0,t.uploadFile)(!1,!1);if(0===o.length)return;const a=o[0],l=await a.text(),c=JSON.parse(l);await(null===(n=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Ls))||void 0===n?void 0:n.importPluginPreset(c,i)),null===(s=r.uiRefresh)||void 0===s||s.call(r,"postFrame",!0)},e&&(o["reset defaults"]=async()=>{var e,t;T_.Remove(),await(null===(t=(e=i).resetDefaults)||void 0===t?void 0:t.call(e))}));const a=T_.Create(o,n.clientWidth-120,12);n.append(a),s.preventDefault()},n.appendChild(s)}return r}setupPlugins(...e){e.forEach((e=>this.setupPluginUi(e)))}refreshPluginsEnabled(){this._plugins.forEach((e=>{var n;const i=e.uiConfig;i&&(!0!==(0,t.getOrCall)(i.hidden)?null===(n=i.uiRefresh)||void 0===n||n.call(i,"postFrame",!0):i.uiRef&&(i.uiRef.hidden=!0))}))}_colorModeChanged(){document.body.classList.remove("tpTheme-black","tpTheme-white","tpTheme-blue"),document.body.classList.add("tpTheme-"+this.colorMode),localStorage&&localStorage.setItem("tpTheme",this.colorMode)}}YO.PluginType="TweakpaneUi",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([(0,t.onChange)(YO.prototype._colorModeChanged)],YO.prototype,"colorMode",void 0);class KO extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e,t;return null!==(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.backgroundIntensity)&&void 0!==t?t:1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",getValue:()=>{var e;return(null===(e=this._viewer)||void 0===e?void 0:e.scene.environment)||null},setValue:e=>{this._viewer&&(this._viewer.scene.environment=e)},type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",getValue:()=>{var e,t,n;return null!==(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.environment)||void 0===t?void 0:t.rotation)&&void 0!==n?n:0},setValue:e=>{var t,n;const i=null===(t=this._viewer)||void 0===t?void 0:t.scene.environment;i&&(i.rotation=e,null===(n=this._viewer)||void 0===n||n.scene.setDirty())},bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",getValue:()=>{var e,t;return null!==(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.envMapIntensity)&&void 0!==t?t:1},setValue:e=>{var t;(null===(t=this._viewer)||void 0===t?void 0:t.scene)&&(this._viewer.scene.envMapIntensity=e)},bounds:[0,4],limitedUi:!0},()=>({label:"Environment1",getValue:()=>{var e;return(null===(e=this._viewer)||void 0===e?void 0:e.scene.textureSlots.environment1)||null},setValue:e=>{this._viewer&&(e.mapping===n.xfE&&(e.mapping=n.dSO,e.needsUpdate=!0),this._viewer.scene.textureSlots.environment1=e)},type:"image"}),{type:"slider",label:"Env1 Rotation",hidden:()=>{var e;return!(null===(e=this._viewer)||void 0===e?void 0:e.scene.textureSlots.environment1)},getValue:()=>{var e,t,n;return null!==(n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.textureSlots.environment1)||void 0===t?void 0:t.rotation)&&void 0!==n?n:0},setValue:e=>{var t,n;const i=null===(t=this._viewer)||void 0===t?void 0:t.scene.textureSlots.environment1;i&&(i.rotation=e,null===(n=this._viewer)||void 0===n||n.scene.setDirty())},bounds:[0,2*Math.PI]},{type:"checkbox",label:"Fixed Env Direction",getValue:()=>{var e,t;return null!==(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.fixedEnvMapDirection)&&void 0!==t&&t},setValue:e=>{this._viewer&&(this._viewer.scene.fixedEnvMapDirection=e)}},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e,t;return null===(t=null===(e=this._viewer)||void 0===e?void 0:e.renderer.useLegacyLights)||void 0===t||t},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var e,t;const i=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.backgroundColor)||void 0===t?void 0:t.getHex(n.KI_);return void 0!==i&&(this._savedBg=!0),i||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new n.Ilk),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var e;const t=null===(e=this._viewer)||void 0===e?void 0:e.scene.background;return t&&(t.isTexture||"texture"===t.assetType)?t:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get envmapBg(){var e,t,n;return"environment"===(null===(e=this._viewer)||void 0===e?void 0:e.scene.background)||(null===(t=this._viewer)||void 0===t?void 0:t.scene.background)===(null===(n=this._viewer)||void 0===n?void 0:n.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const e=this._viewer.scene.background;e&&e!==this._viewer.scene.environment&&"environment"!==e&&(this.lastBgVal=e),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&"environment"!==this._viewer.scene.background||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",(()=>{var e,t;null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0)})),e.scene.addEventListener("environmentChanged",(()=>{var e,t;null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}))}}KO.PluginType="SimpleBackgroundEnvUiPlugin1";class JO extends _t{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene",children:[],onExpand:()=>{var e,t;null===(t=(e=this._uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;null===(e=this._viewer)||void 0===e||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get uiConfig(){return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig):this._uiConfig}_sceneUpdate(){}}JO.PluginType="SimpleUi";var ZO=__webpackgi_require__(1),$O=__webpackgi_require__.n(ZO)();class eL extends _t{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,t.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._resetting=!1,this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(e,t)=>(e.push({text:t.name||"unnamed",id:t.uuid,children:t.children.reduce(this._buildData,[])}),e),this._findVisible=(e,t)=>t.visible?(t.children.length<1?e.push(t.uuid):e.push(...t.children.reduce(this._findVisible,[])),e):e,this._setVisible=e=>{var t;null===(t=this._viewer)||void 0===t||t.doOnce("postFrame",(()=>{var t,n,i;const r=null===(t=this._viewer)||void 0===t?void 0:t.scene.modelRoot;if(!r||null==e)return;const s=new Set;r.traverse((t=>{t!==r&&(t.visible=e.includes(t.uuid),t.visible&&t.traverseAncestors((e=>s.add(e))))})),s.forEach((e=>e.visible=!0)),null===(i=null===(n=this._viewer)||void 0===n?void 0:n.scene)||void 0===i||i.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})}))},this.enabled=e,this.reset=this.reset.bind(this),(0,t.createStyles)(t.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: var(--tp-container-foreground-color, hsl(230, 7%, 75%));
  margin-top: 0;
}
.treejs .treejs-switcher:before {
    border-top: 6px solid var(--tp-container-foreground-color, hsl(230, 7%, 75%)) !important;
}
        `)}_reset(e){var n;if(null==e?void 0:e.fromHierarchyPlugin)return;if(e&&!e.hierarchyChanged)return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const i=null===(n=this._viewer)||void 0===n?void 0:n.scene.modelRoot;if(!i)return;const r=i.children.reduce(this._buildData,[]),s=i.children.reduce(this._findVisible,[]);let o=!1;return new Promise(((e,n)=>{this.treeView=new $O(this.hierarchyDiv,{closeDepth:1,data:r,loaded:function(){this.values=s,e()},onChange:()=>{o?(0,t.timeout)(200).then((()=>{this.treeView&&this._setVisible(this.treeView.values)})):o=!0},onItemLabelClick:e=>{var t;const n=null===(t=this._viewer)||void 0===t?void 0:t.scene.modelRoot.modelObject.getObjectByProperty("uuid",e);n&&i.visible&&n.dispatchEvent({type:"select",value:n,ui:!0})}})}))}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this.reset),await this.reset()}async reset(e){this._resetting||(this._resetting=!0,await(0,t.timeout)(500),await this._reset(e),this._resetting=!1)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}eL.PluginType="HierarchyUiPlugin";class tL extends _t{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new si;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const e=new li;e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const e=new ai;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const e=new oi;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,e.lookAt(0,0,0),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Ls],this._sceneUpdate=e=>{var t,n,i;if(!e.hierarchyChanged)return;const r=[];null===(t=this._viewer)||void 0===t||t.traverseSceneObjects((e=>{if(!e.lightObject)return;const t=e.uiConfig;t&&!r.includes(t)&&r.push(t)})),[...this.uiConfig.children].forEach((e=>{"button"===(null==e?void 0:e.type)||r.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)})),r.forEach((e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)})),null===(i=(n=this.uiConfig).uiRefresh)||void 0===i||i.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}tL.PluginType="SimpleLightsUi";class nL extends _t{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var e;if(!this._viewer)return;const t=this._viewer.createCamera(new n.cPb(45,1,.5,20));this._viewer.scene.modelRoot.add(t.cameraObject),t.setCameraOptions({controlsMode:"orbit"}),t.position.set(2,2,2),t.target.set(0,0,0),t.positionUpdated(!0),t.cameraObject.lookAt(0,0,0),t.setDirty();const i=this._viewer.getPluginByType("VirtualCamerasPlugin");if(i){const n=i.addCamera(t),r=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("debug");r&&r.addTexture("camera frame",(()=>n.target.texture),[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[Ls],this._sceneUpdate=e=>{var t,n,i;if(!e.hierarchyChanged)return;const r=[];null===(t=this._viewer)||void 0===t||t.traverseSceneObjects((e=>{if(!e.cameraObject)return;const t=e.uiConfig;t&&!r.includes(t)&&r.push(t)})),[...this.uiConfig.children].forEach((e=>{"button"===(null==e?void 0:e.type)||r.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)})),r.forEach((e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)})),null===(i=(n=this.uiConfig).uiRefresh)||void 0===i||i.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}nL.PluginType="SimpleSceneCamerasUi";var iL,rL=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let sL=iL=class extends _t{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(e=!0){if(!this._viewer)return;if("full"===this.mode)return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const t={width:Math.floor(this.width),height:Math.floor(this.height)},n=this._viewer.container.getBoundingClientRect(),i={width:Math.floor(n.width),height:Math.floor(n.height)};let r=1;if(t.width>i.width){const e=t.width;t.width=i.width;const n=t.width/e;if(t.height=Math.floor(t.height*n),r/=n,r>iL.MaxCanvasScale)return this.width=i.width*iL.MaxCanvasScale,console.log("loop",this.width,i.width,r),void this._sizeChanged()}if(t.height>i.height){const e=t.height;t.height=i.height;const n=t.height/e;if(t.width=Math.floor(t.width*n),r/=n,r>iL.MaxCanvasScale)return this.height=i.height*iL.MaxCanvasScale,console.log("loop",this.width,i.width,this.height,i.height,r),void this._sizeChanged()}(t.width>=i.width||t.width<1)&&delete t.width,(t.height>=i.height||t.height<1)&&delete t.height,this._viewer.setSize(t),this._setScale(r),e&&(this.scale=r),this._refresh()}_setScale(e){this._viewer&&(this._viewer.renderer.displayCanvasScaling=e)}_scaleChanged(){if(!this._viewer)return;const e=this.scale;if(Math.abs(e-this._viewer.renderer.displayCanvasScaling)<.01)return;if("full"===this.mode)return void this._sizeChanged();const t=this.width/this.height,n=this._viewer.container.getBoundingClientRect(),i=Math.floor(n.width*e),r=Math.floor(i/t);this.width=i,this.height=r,this._sizeChanged(!1)}async onAdded(e){await super.onAdded(e);const t=e.canvas.clientWidth,n=e.canvas.clientHeight,i=e.renderer.displayCanvasScaling;this.width=t,this.height=n,this.scale=i,e.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",(()=>this._sizeChanged(!0))),this._refresh()}async onRemove(e){return e.renderer.removeEventListener("resize",this._refresh),super.onRemove(e)}_refresh(){var e,t;null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}fromJSON(e,t){if(!e.mode)if(e.width||e.height){const t=this._viewer.container.getBoundingClientRect();e.width||(e.width=t.width),e.height||(e.height=t.height),e.scale&&(e.width*=e.scale,e.height*=e.scale,delete e.scale),e.width=Math.round(e.width),e.height=Math.round(e.height),e.mode="custom"}else e.mode="full";return super.fromJSON(e,t)}toJSON(e){const t=super.toJSON(e);return"full"===t.mode&&(delete t.width,delete t.height),"custom"===t.mode&&delete t.scale,t}};sL.PluginType="RendererParamsUiPlugin",sL.MaxCanvasScale=5,rL([re("version")],sL.prototype,"_serializeVersion",void 0),rL([re(),Fe("Mode",["full","custom"].map((e=>({label:e})))),(0,t.onChange2)(iL.prototype._sizeChanged)],sL.prototype,"mode",void 0),rL([re(),Ue("Width",void 0,1,(e=>({onChange:()=>e._sizeChanged(),hidden:()=>"full"===e.mode,bounds:()=>{var t;return[10,Math.pow(2,Math.ceil(Math.log2((null===(t=e._viewer)||void 0===t?void 0:t.container.getBoundingClientRect().width)||1024)+2))]}})))],sL.prototype,"width",void 0),rL([re(),Ue("Height",void 0,1,(e=>({onChange:()=>e._sizeChanged(),hidden:()=>"full"===e.mode,bounds:()=>{var t;return[10,Math.pow(2,Math.ceil(Math.log2((null===(t=e._viewer)||void 0===t?void 0:t.container.getBoundingClientRect().height)||1024)+2))]}})))],sL.prototype,"height",void 0),rL([re(),(0,t.onChange)(iL.prototype._scaleChanged),Ue("Scale",[.25,iL.MaxCanvasScale],.001,(e=>({disabled:()=>"custom"===e.mode})))],sL.prototype,"scale",void 0),sL=iL=rL([We("Renderer")],sL);class oL extends _t{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var t;const n=super.toJSON(e);return n.activeCamera=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera.toJSON(),n}fromJSON(e,t){var n;return e.activeCamera&&(null===(n=this._viewer)||void 0===n||n.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&(null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0))}get uiConfig(){var e;return(null===(e=this._viewer)||void 0===e?void 0:e.scene.activeCamera.uiConfig)||{}}}oL.PluginType="CameraUiPlugin";let aL={create:e=>{let t="button"+(e.type?" "+e.type:""),n=uL.createDiv(t,e.text);return n.addEventListener("click",e.onClick),n}};var lL=aL;let cL={createElement:(e,t,n,i)=>{let r=document.createElement(e);if(t&&(r.className=t),n&&(r.innerHTML=n),i)for(let s in i)r.setAttribute(s,i[s]);return r},createDiv:(e,t,n)=>cL.createElement("div",e,t,n),createDomTree:e=>{if(!e||!e.hasOwnProperty("dom"))return e;let t=e.dom;if(e.children)for(let n in e.children)e.children[n]&&t.appendChild(cL.createDomTree(e.children[n]));return t},removeElement:e=>{null!=e&&e.parentNode.removeChild(e)},appendToBody:e=>{document.body.appendChild(e)},makeIconHTML:e=>{let t="";return"ok"==e&&(t="#tick"),"error"==e&&(t="#cancel"),"info"==e&&(t="#info-button"),"caution"==e&&(t="#danger"),"min"==e&&(t="#line"),"close"==e&&(t="#close"),`<svg class="icon ${e}"><use xlink:href="${t}" /></svg>`},makeNftContent:e=>{let t=null;if(e.type){let n=null;n="string"==typeof e.content?cL.createDiv("inner-content",e.content):cL.createDomTree({dom:cL.createDiv("inner-content"),children:[e.content]}),t="text"==e.type?cL.createDomTree({dom:cL.createDiv("content text"),children:[n]}):cL.createDomTree({dom:cL.createDiv("content"),children:[cL.createDiv("state",cL.makeIconHTML(e.type)),n]})}else"string"==typeof e.content&&(t=cL.createDiv("content",e.content));return t},standardizeButtons:(e,t)=>{let n=[];if(void 0===t.buttons)return"caution"!=t.type&&"info"!=t.type||n.push({key:27,text:"Cancel",onClick:e.close.bind(e,"cancel")}),n.push({key:13,text:"OK",type:"main",onClick:e.close.bind(e,"ok")}),n;n=t.buttons,n.constructor!==Array&&(n=[n]);for(let i in n)!n[i].onClick&&(n[i].onClick=e.close.bind(e,n[i].id));return n},makeButtons:e=>{let t=[];if(e)for(let n in e)t.push(lL.create({text:e[n].text?e[n].text:"OK",type:e[n].normal?null:"main",onClick:e[n].onClick}));return cL.createDomTree({dom:cL.createDiv("button-wrapper"),children:t})},bindButtonKeyEvents:e=>{let t=t=>{for(let n in e)if(e[n].key===t.keyCode)return void e[n].onClick()};return window.addEventListener("keydown",t),t},unbindButtonKeyEvents:e=>{window.removeEventListener("keydown",e)}};var uL=cL,dL=__webpackgi_require__(476),hL={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let pL={};pL.overlay_in=[new dL.Frame(hL["wwise-overlay-in-1"],0),new dL.Frame(hL["wwise-overlay-in-2"],400)],pL.overlay_out=[new dL.Frame(hL["wwise-overlay-out-1"],300)],pL.pop_in=[new dL.Frame(hL["wwise-pop-in-1"],0),new dL.Frame(hL["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new dL.Frame(hL["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new dL.Frame(hL["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],pL.pop_out=[new dL.Frame(hL["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],pL.flip_in=[new dL.Frame(hL["wwise-flip-in-1"],0),new dL.Frame(hL["wwise-flip-in-2"],500)],pL.flip_out=[new dL.Frame(hL["wwise-flip-out-1"],400)],pL.min_in=[new dL.Frame(hL["wwise-min-in-1"],0),new dL.Frame(hL["wwise-min-in-2"],350)],pL.min_out=[new dL.Frame(hL["wwise-min-out-1"],400)];let fL=["top","bottom","left","right"];for(let EN in fL){let e=fL[EN];pL[e+"_in"]=[new dL.Frame(hL["wwise-"+e+"-in-1"],0),new dL.Frame(hL["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],pL[e+"_out"]=[new dL.Frame(hL["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var mL=pL;let gL={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class _L{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let i=e.getElementsByClassName("content")[0];return i&&(i=i.innerHTML),uL.removeElement(e),t.title=n,t.content=i,new _L(t)}constructor(e){this.options=JSON.parse(JSON.stringify(gL));for(let a in e)null!=e[a]&&(this.options[a]=e[a]);let t=this.options.position;if(-1==t.indexOf(" ")&&("left"==t||"right"==t?t+=" center":t="top"==t||"bottom"==t?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let e=document.getElementsByClassName("wwise-overlay");e.length?(this.overlay=e[0],this.hasOverlay=!0):(this.overlay=uL.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let e=[];this.options.topbar.showMin&&(e.push(uL.createDiv(null,uL.makeIconHTML("min"))),e[e.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(e.push(uL.createDiv(null,uL.makeIconHTML("close"))),e[e.length-1].addEventListener("click",this.close.bind(this,void 0)));let t=null;t="string"==typeof this.options.title?uL.createDiv("title",this.options.title):uL.createDomTree({dom:uL.createDiv("title"),children:[this.options.title]}),this.topbar=uL.createDomTree({dom:uL.createDiv("topbar"),children:[{dom:uL.createDiv("control"),children:e.map((e=>({dom:e})))},{dom:t},{dom:uL.createDiv("clear")}]})}else n+=" no-topbar";"string"==typeof this.options.content?this.content=uL.createDomTree({dom:uL.createDiv(n,this.options.content)}):this.content=uL.createDomTree({dom:uL.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=uL.createDomTree({dom:uL.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let i=uL.createDiv("wwise-wrapper");this.options.zIndex&&(i.style.zIndex=this.options.zIndex),this.wrapper=uL.createDomTree({dom:i,children:[this.window]}),this.dom=uL.createDomTree({dom:uL.createDiv(),children:[this.wrapper]});let r=this.options.position.split(" "),s=-50,o=-50;if("left"==r[0]?(s=0,this.wrapper.classList.add("left")):"right"==r[0]?(s=-100,this.wrapper.classList.add("right")):"center"==r[0]?this.wrapper.classList.add("h-center"):this.wrapper.style.left=r[0],"top"==r[1]?(o=0,this.wrapper.classList.add("top")):"bottom"==r[1]?(o=-100,this.wrapper.classList.add("bottom")):"center"==r[1]?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${s}%, ${o}%)`,this.options.style)for(let a in this.options.style)this.window.style[a]=this.options.style[a];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise((e=>{this.promiseResolve=e})),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){"min"!=t&&"flip"!=t||this.dom.classList.add("wwise-perspective");let e=[new dL.Queue(this.wrapper,mL[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&e.push(new dL.Queue(this.overlay,mL.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(e).then((()=>{this.dom.classList.remove("wwise-perspective")}))}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){"min"!=t&&"flip"!=t||this.dom.classList.add("wwise-perspective");let e=[new dL.Queue(this.wrapper,mL[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&e.push(new dL.Queue(this.overlay,mL.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(e).then((()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()}))}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(uL.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",(e=>{e.preventDefault()}))),uL.appendToBody(this.dom)}removeDoms(){uL.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(uL.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),i=this.options.draggable,r=parseFloat(n.left),s=parseFloat(n.top);if(-1!=n.left.indexOf("%")){r=n.left,r=r.substr(0,r.length-1),r=parseInt(r);let e=window,t=document,i=t.documentElement,s=t.getElementsByTagName("body")[0];r=r*(e.innerWidth||i.clientWidth||s.clientWidth)/100}if(-1!=n.top.indexOf("%")){s=n.top,s=s.substr(0,s.length-1),s=parseInt(s);let e=window,t=document,i=t.documentElement,r=t.getElementsByTagName("body")[0];s=s*(e.innerHeight||i.clientHeight||r.clientHeight)/100}1!=i&&"horizontal"!=i||(this.wrapper.style.left=r+t.x+"px"),1!=i&&"vertical"!=i||(this.wrapper.style.top=s+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&"HTML"!=t.nodeName||(this.inDragging=!1)}}var vL=_L,yL=class{constructor(e){let t=this.options=e;!t.type&&(t.type="ok");let n={topbar:!1};n.content=this.constructContent({type:t.type,title:t.title,text:t.text,content:t.content,buttons:t.buttons}),n.overlay=!0,n.keepOverlay=t.keepOverlay,n.clickOverlayToClose=!1,n.animation=t.animation,n.zIndex=t.zIndex,this.wwise=new vL(n)}constructContent(e){let t=uL.createDiv("modal"),n=uL.createDomTree({dom:uL.createDiv("main "+e.type),children:[uL.createDiv(null,uL.makeIconHTML(e.type)),uL.createDiv("title",e.title),uL.createDiv("text",e.text)]});this.buttonArr=uL.standardizeButtons(this,e);let i=uL.makeButtons(this.buttonArr),r=null;e.content&&(r="string"==typeof e.content?uL.createDiv(null,e.content):e.content);let s=null;return i.innerHTML&&(s=uL.createDomTree({dom:uL.createDiv("operation "+e.type),children:[i]})),r||s||n.classList.add("no-op"),uL.createDomTree({dom:t,children:[n,r,s]})}open(){if(this.wwise.opened)return;let e=this.wwise.open();return this.value=void 0,this.promise=new Promise((e=>{this.promiseResolve=e})),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=uL.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout((()=>{this.close("timer")}),this.options.closeAfter),e}close(e){if(this.wwise.opened)return this.value=e,uL.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let bL={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},AL={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var wL=__webpackgi_require__(513),xL={};wL.Z&&wL.Z.locals&&(xL.locals=wL.Z.locals);var EL,CL=0,SL={};SL.styleTagTransform=uc(),SL.setAttributes=oc(),SL.insert=function(e,t){(t.target||document.head).appendChild(e)},SL.domAPI=rc(),SL.insertStyleElement=lc(),xL.use=function(e){return SL.options=e||{},CL++||(EL=nc()(wL.Z,SL)),xL},xL.unuse=function(){CL>0&&! --CL&&(EL(),EL=null)};var ML=xL;class TL extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},uL.appendToBody=t=>{t.style.zIndex="100",e.container.appendChild(t)},uL.makeIconHTML=e=>"",ML.use({target:e.container}),e.alert=async e=>{const t=null==e?void 0:e.split(":")[0],n=new yL({type:"info",title:null!=t?t:"&ndsp;",text:(null==e?void 0:e.replace(t+":","").replace(/(\r?\n)/gm,"<br>"))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return n.open(),n.getPromise()},e.confirm=async e=>{const t=null==e?void 0:e.split(":")[0],n=new yL({type:"info",title:null!=t?t:"&ndsp;",text:(null==e?void 0:e.replace(t||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return n.open(),"yes"===await n.getPromise()},e.prompt=async(e,t,n=!0)=>{const i=null==e?void 0:e.split(":")[0],r=new class{constructor(e){this.options=JSON.parse(JSON.stringify(bL));for(let r in e)null!=e[r]&&(this.options[r]=e[r]);let t=this.options,n=JSON.parse(JSON.stringify(AL));for(let r in n)t.hasOwnProperty(r)&&(n[r]=t[r]);let i=[];t.showCancel&&i.push({key:27,text:t.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),i.push({key:13,text:t.okText,onClick:this.handleOk.bind(this)}),n.buttons=i,this.input=uL.createElement("input","input",null,{placeholder:t.placeholder}),this.error=uL.createDiv("error"),n.content=uL.createDomTree({dom:uL.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new yL(n)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then((()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))}),(e=>{this.error.innerText=e})):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let e=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise(((e,t)=>{this.promiseResolve=e,this.promiseReject=t})),e}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:null!=i?i:"&ndsp;",placeholder:null!=t?t:"",showCancel:n,animation:"overlay",text:(null==e?void 0:e.replace(i||"","").replace(":",""))||""});return r.open(),await r.getPromise().catch((async()=>null))}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}TL.PluginType="WindowiseDialogPlugin";var IL=__webpackgi_require__(729),PL={};IL.Z&&IL.Z.locals&&(PL.locals=IL.Z.locals);var RL,DL=0,kL={};kL.styleTagTransform=uc(),kL.setAttributes=oc(),kL.insert=function(e,t){(t.target||document.head).appendChild(e)},kL.domAPI=rc(),kL.insertStyleElement=lc(),PL.use=function(e){return kL.options=e||{},DL++||(RL=nc()(IL.Z,kL)),PL},PL.unuse=function(){DL>0&&! --DL&&(RL(),RL=null)};var BL=PL;function OL(){BL.use(),dv.use()}async function LL(e,n=void 0,i=[]){var r,s;M_.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>e.container});const o=(0,t.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),a=(0,t.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,t.getUrlQueryParam)("logo-img")&&(a.style.backgroundImage=`url(${(0,t.getUrlQueryParam)("logo-img")})`),a.onclick=()=>{window.open((0,t.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const l='<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />\n</svg>';e.container.appendChild(a),M_(a,{placement:"right",content:"Powered by WebGi SDK"});const c=(0,t.createDiv)({innerHTML:l,id:"fsToggle",classList:["round-button"],addToBody:!1});c.dataset.tippyContent="Full-Screen",null===(r=e.getPlugin(Ah))||void 0===r||r.addEventListener("enter",(()=>{c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',c.dataset.tippyContent="Exit Full-Screen"})),null===(s=e.getPlugin(Ah))||void 0===s||s.addEventListener("exit",(()=>{c.innerHTML=l,c.dataset.tippyContent="Full-Screen"})),c.onclick=()=>{var t;null===(t=e.getPlugin(Ah))||void 0===t||t.toggle(e.container)},e.container.appendChild(c),M_(c,{placement:"left"});const u=(0,t.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});e.container.appendChild(u);const d=[{id:"reset-settings",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />\n</svg>',tooltip:"Reset All Settings",onclick:async()=>{var t;if(!await e.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const n=g.map((t=>e.getPlugin(t)));for(const e of n)await(null===(t=null==e?void 0:e.resetDefaults)||void 0===t?void 0:t.call(e))}},{id:"clear-scene",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n</svg>',tooltip:"Clear Scene",onclick:async()=>{await e.confirm("Clear scene: Are you sure you want to clear the scene?")&&e.scene.disposeSceneModels()}},{id:"fit-scene",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">\n    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />\n</svg>',tooltip:"Fit Object/Scene",onclick:async()=>{var t;await e.fitToView(null===(t=e.getPlugin(za))||void 0===t?void 0:t.getSelectedObject())}},{id:"loop-cam-views",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />\n</svg>',tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{e.getPlugin(zd)&&(e.getPlugin(zd).viewLooping=!e.getPlugin(zd).viewLooping)}},{id:"play-gltf",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />\n  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n</svg>',tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var t;null===(t=e.getPlugin(Ya))||void 0===t||t.playPauseAnimation()}},{id:"auto-rotate-cc",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />\n</svg>',tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const t=e.scene.activeCamera.controls;t&&void 0!==t.autoRotate&&(t.autoRotate=!t.autoRotate)}},{id:"snapshot",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />\n  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />\n</svg>',tooltip:"Capture Snapshot",onclick:async()=>{const t=e.getPlugin(Nc);t?await t.downloadSnapshot():e.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />\n</svg>',tooltip:"Export GLB",onclick:async()=>{const t=e.getPlugin(ub);t?await(null==t?void 0:t.downloadSceneGlb()):e.console.error("AssetExporterPlugin not added")}}];for(const v of d){const e=(0,t.createDiv)({innerHTML:v.icon,id:v.id,classList:["button-bar-button","util-button"],addToBody:!1});e.dataset.tippyContent=v.tooltip,e.onclick=()=>{v.toggle&&e.classList.toggle("button-bar-selected-box"),v.onclick()},u.appendChild(e)}S_(M_(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const h=e.getPlugin(za),p=e.getPlugin(iv);for(const[t,v]of Object.entries(null!=n?n:{})){const e=i.find((e=>e.title===t));e?e.plugins.push(...v):i.push({title:t,plugins:[...v]})}let f=i[2],m=[];const g=i.reduce(((e,t)=>e.concat(t.plugins)),[]);function _(n){var r;f=n,h&&(h.enabled=!0),p&&(["Plugins"].includes(f.title)?p.enable("modesUi"):p.disable("modesUi")),m=[];for(const i of g){const r=e.getPlugin(i);if(!(null==r?void 0:r.uiConfig))continue;const s=n.plugins.includes(i);(0,t.safeSetProperty)(r.uiConfig,"hidden",!s,!0),s&&m.push(r)}for(const e of i)null===(r=e.div)||void 0===r||r.classList[f!==e?"remove":"add"]("mode-button-selected","button-bar-selected");e.getPlugin(YO).refreshPluginsEnabled()}for(const v of i){const e=(0,t.createDiv)({innerHTML:v.title,classList:["mode-button","button-bar-button"]});e.onclick=()=>{_(v)},v.div=e,o.appendChild(e)}_(i[0]),window.webgi_setEditorMode=_,window.webgi_editorModes=i,null==h||h.addEventListener("selectedObjectChanged",(()=>{(null==h?void 0:h.getSelectedObject())&&!["Picking","Modifiers","Configurators"].includes(f.title)&&_(i.find((e=>e.plugins.includes(za))))}))}class UL extends _t{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Color Scheme",type:"dropdown",children:["black","white","blue"].map((e=>({label:e}))),getValue:()=>{var e,t;return null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("TweakpaneUi"))||void 0===t?void 0:t.colorMode},setValue:e=>{var t;const n=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("TweakpaneUi");n&&(n.colorMode=e)}}),()=>({label:"Shadow type",type:"dropdown",children:[["Basic",n._MY],["PCF",n._iA],["PCFSoft",n.ntZ],["VSM",n.dwk]].map((e=>({label:e[0],value:e[1]}))),getValue:()=>{var e;return null===(e=this._viewer)||void 0===e?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var t;null===(t=this._viewer)||void 0===t||t.doOnce("postFrame",(()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())}))}}),()=>{var e;return{label:((null===(e=this._viewer)||void 0===e?void 0:e.useRgbm)?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var e,n;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("rgbm",(null===(n=this._viewer)||void 0===n?void 0:n.useRgbm)?"no":"yes",!0)}}},()=>{var e;return{label:((null===(e=this._viewer)||void 0===e?void 0:e.isAntialiased)?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var e,n;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("msaa",(null===(n=this._viewer)||void 0===n?void 0:n.isAntialiased)?"no":"yes",!0)}}},()=>{var e;return{label:((null===(e=this._viewer)||void 0===e?void 0:e.useGBufferDepth)?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var e,n;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("depthPrepass",(null===(n=this._viewer)||void 0===n?void 0:n.useGBufferDepth)?"no":"yes",!0)}}},()=>{var e;return{label:((null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("debug"))?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var e,n;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("debug",(null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("debug"))?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var e,t;const n=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Ls))||void 0===t?void 0:t.storage;if(n instanceof Storage)n.clear();else if(n instanceof Cache){const e=await n.keys();await Promise.all(e.map((async e=>n.delete(e))))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var e;const t=new Set;null===(e=this._viewer)||void 0===e||e.scene.modelRoot.traverse((e=>e.geometry&&t.add(e.geometry))),t.forEach((e=>ge(e)))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var e;const t=new Set;null===(e=this._viewer)||void 0===e||e.scene.modelRoot.traverse((e=>e.geometry&&t.add(e.geometry))),t.forEach((e=>{const t=new n.Pa4;e.center(t),t.negate();const i=e.userData.__appliedMeshes;i||console.error("No meshes found for geometry",e),null==i||i.forEach((e=>{e.updateMatrix(),e.position.copy(t).applyMatrix4(e.matrix),e.setDirty&&e.setDirty()}))}))}}]}}}UL.PluginType="ExtrasUiPlugin1";class NL extends n.Tme{constructor(e){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=Qe("Widget",this),this.object=e,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(e),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(e){var t,n;return this.object&&this.detach(),this.object=e,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&(null===(n=null===(t=this.object.uiConfig)||void 0===t?void 0:t.children)||void 0===n||n.push(this.uiConfig)),this.visible=!0),this}detach(){var e,t,n,i;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const r=null===(t=null===(e=this.object.uiConfig)||void 0===e?void 0:e.children)||void 0===t?void 0:t.indexOf(this.uiConfig);void 0!==r&&r>=0&&(null===(i=null===(n=this.object.uiConfig)||void 0===n?void 0:n.children)||void 0===i||i.splice(r,1))}this.object=void 0,this.visible=!1}return this}}!function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe()],NL.prototype,"visible",void 0);class FL extends NL{constructor(e){super(e),this.light=e,this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}}var jL=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class zL extends FL{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this._v1=new n.Pa4,this._v2=new n.Pa4,this._v3=new n.Pa4,this.color=i,void 0!==t&&(this.size=t);let r=new Jv;this.material=new ta({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new Zv(r,this.material),this.add(this.lightPlane),r=new Jv,r.setPositions([0,0,0,0,0,1]),this.targetLine=new Zv(r,this.material),this.add(this.targetLine),this.update(),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){var e;this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set(null!==(e=this.color)&&void 0!==e?e:this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(e){return e.isDirectionalLight}static Create(e){return new zL(e)}}jL([(0,t.onChange)(zL.prototype.update)],zL.prototype,"material",void 0),jL([(0,t.onChange)(zL.prototype.update),Ue(void 0,[.1,20],.01)],zL.prototype,"lineWidth",void 0),jL([(0,t.onChange)(zL.prototype.update),Ue(void 0,[.01,10],.01)],zL.prototype,"size",void 0);var GL=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class VL extends FL{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this.color=i,void 0!==t&&(this.size=t);const r=new ea(new n.xo$(.5,4,2));this.material=new ta({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new ra(r,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){var e;this.light&&this.lightSphere&&(this.material.color.set(null!==(e=this.color)&&void 0!==e?e:this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(e){return e.isPointLight}static Create(e){return new VL(e)}}GL([(0,t.onChange)(VL.prototype.update)],VL.prototype,"material",void 0),GL([(0,t.onChange)(VL.prototype.update),Ue(void 0,[.1,20],.01)],VL.prototype,"lineWidth",void 0),GL([(0,t.onChange)(VL.prototype.update),Ue(void 0,[.01,10],.01)],VL.prototype,"size",void 0);var HL=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class QL extends FL{constructor(e,t,i){super(e),this.lineWidth=5,this._v1=new n.Pa4,this.color=i,void 0===t&&(t=.5);let r=new $o;const s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let n=0,o=1,a=32;n<a;n++,o++){const e=n/a*Math.PI*2,t=o/a*Math.PI*2;s.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}r.setPositions(s),this.material=new ta({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new Kv(r,this.material),this.add(this.cone),r=new Jv,r.setPositions([0,0,0,0,0,1]),this.update(),this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){var e;if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,n=t*Math.tan(this.light.angle);this.cone.scale.set(n,n,t),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set(null!==(e=this.color)&&void 0!==e?e:this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(e){return e.isSpotLight}static Create(e){return new QL(e)}}HL([(0,t.onChange)(QL.prototype.update)],QL.prototype,"material",void 0),HL([(0,t.onChange)(QL.prototype.update),Ue(void 0,[.1,20],.01)],QL.prototype,"lineWidth",void 0);class WL extends NL{constructor(e){super(e),this.camera=e,this.traverse((e=>{e.userData.__keepShadowDef=!0,e.castShadow=!1,e.receiveShadow=!1}))}}class qL extends WL{constructor(e){super(e),this._vector=new n.Pa4,this._camera=new n.V1s;const t=new $o,i=new ta({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:r,colors:s,pointMap:o}=function(){const e=[],t=[],n={};function i(e,t){r(e),r(t)}function r(i){e.push(0,0,0),t.push(0,0,0),void 0===n[i]&&(n[i]=[]),n[i].push(e.length/3-1)}return i("n1","n2"),i("n2","n4"),i("n4","n3"),i("n3","n1"),i("f1","f2"),i("f2","f4"),i("f4","f3"),i("f3","f1"),i("n1","f1"),i("n2","f2"),i("n3","f3"),i("n4","f4"),i("p","n1"),i("p","n2"),i("p","n3"),i("p","n4"),i("u1","u2"),i("u2","u3"),i("u3","u1"),i("c","t"),i("p","c"),i("cn1","cn2"),i("cn3","cn4"),i("cf1","cf2"),i("cf3","cf4"),{vertices:e,colors:t,pointMap:n}}();t.setPositions(r),t.setColors(s),this.line=new Kv(t,i),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=o,this.update();const a=new n.Ilk(16755200),l=new n.Ilk(16711680),c=new n.Ilk(43775),u=new n.Ilk(16777215),d=new n.Ilk(3355443);this.setColors(a,l,c,u,d)}setColors(e,t,n,i,r){const s=this.line.geometry,o=s.getAttribute("instanceColorStart"),a=s.getAttribute("instanceColorEnd");function l(e,t){o.setXYZ(e/2,t.r,t.g,t.b),a.setXYZ(e/2,t.r,t.g,t.b)}l(0,e),l(2,e),l(4,e),l(6,e),l(8,e),l(10,e),l(12,e),l(14,e),l(16,e),l(18,e),l(20,e),l(22,e),l(24,t),l(26,t),l(28,t),l(30,t),l(32,n),l(34,n),l(36,n),l(38,i),l(40,r),l(42,r),l(44,r),l(46,r),l(48,r),o.needsUpdate=!0,a.needsUpdate=!0}update(){if(!this.camera)return;const e=this.line.geometry,t=this.pointMap,{_camera:n,_vector:i}=this;n.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),XL("c",t,e,n,0,0,-1,i),XL("t",t,e,n,0,0,1,i),XL("n1",t,e,n,-1,-1,-1,i),XL("n2",t,e,n,1,-1,-1,i),XL("n3",t,e,n,-1,1,-1,i),XL("n4",t,e,n,1,1,-1,i),XL("f1",t,e,n,-1,-1,1,i),XL("f2",t,e,n,1,-1,1,i),XL("f3",t,e,n,-1,1,1,i),XL("f4",t,e,n,1,1,1,i),XL("u1",t,e,n,.7,1.1,-1,i),XL("u2",t,e,n,-.7,1.1,-1,i),XL("u3",t,e,n,0,2,-1,i),XL("cf1",t,e,n,-1,0,1,i),XL("cf2",t,e,n,1,0,1,i),XL("cf3",t,e,n,0,-1,1,i),XL("cf4",t,e,n,0,1,1,i),XL("cn1",t,e,n,-1,0,-1,i),XL("cn2",t,e,n,1,0,-1,i),XL("cn3",t,e,n,0,-1,-1,i),XL("cn4",t,e,n,0,1,-1,i),e.getAttribute("instanceStart").needsUpdate=!0,e.getAttribute("instanceEnd").needsUpdate=!0,e.computeBoundingBox(),e.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(e){return e.isCamera}static Create(e){return new qL(e)}}function XL(e,t,n,i,r,s,o,a){a.set(r,s,o).unproject(i);const l=t[e];if(void 0!==l){const e=n.getAttribute("instanceStart"),t=n.getAttribute("instanceEnd");for(let n=0,i=l.length;n<i;n++){const i=Math.floor(l[n]/2);(l[n]%2==0?e:t).setXYZ(i,a.x,a.y,a.z)}}}class YL extends _t{setDirty(){var e,t;null===(e=this.widgets)||void 0===e||e.forEach((e=>e.visible=this.enabled)),null===(t=this._viewer)||void 0===t||t.setDirty()}constructor(e=!0){super(),this.enabled=!0,this.helpers=[zL,QL,VL,qL],this.toJSON=null,this._addSceneObject=e=>{const t=e.object;this._createWidgets(null==t?void 0:t.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"enabled"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]},this.enabled=e}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach((e=>e.dispose&&e.dispose())),this.widgets=[],super.onRemove(e)}refresh(){var e;this._createWidgets(null===(e=this._viewer)||void 0===e?void 0:e.scene.modelRoot)}_createWidgets(e){null==e||e.traverse((e=>{const t=this.widgets.find((t=>t.object===e));t?t.update&&t.update():this.helpers.filter((t=>t.Check(e))).forEach((t=>{var n;const i=t.Create(e);i.visible=this.enabled,this.widgets.push(i),null===(n=this._viewer)||void 0===n||n.scene.addWidget(i)}))}))}}YL.PluginType="WidgetsPlugin",function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([(0,t.onChange)(YL.prototype.setDirty)],YL.prototype,"enabled",void 0);var KL=sg({defaultModifiers:[lg,pg,gg,_g]}),JL=__webpackgi_require__(388),ZL=__webpackgi_require__.n(JL);function $L(e){const t=[];e.traverse((e=>{e.geometry&&t.push(e)}));const n={},i={};t.forEach((e=>{var t;if(!n[e.geometry.uuid]){const t=e.geometry.toJSON().data,i=t?ZL()({a:t.attributes||{},b:t.index||[]}):"";n[e.geometry.uuid]=i}const r=n[e.geometry.uuid],s=null!==(t=i[r])&&void 0!==t?t:i[r]=[];s.includes(e)||s.push(e)})),Object.values(i).forEach((e=>{if(e.length<2)return;const t=e[0].geometry;e.forEach(((e,n)=>{n<1||(e.geometry.dispose(),e.geometry=t)}))}))}const eU=new n.Pa4,tU=new n.Pa4,nU=new n.Pa4,iU=new n.Pa4,rU=new n.Pa4,sU=new n.Pa4;let oU=1;const aU=new n.Pa4(0,1,0);class lU extends Ze{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new n.Pa4(0,0,0);const i=this.update;this.update=()=>this._update(i)}_update(e){this.target.add(this.targetOffset),eU.copy(this.object.position).sub(this.target),oU=eU.length(),sU.copy(this.target);const t=e();return sU.sub(this.target),eU.copy(this.object.position).sub(this.target),oU/=eU.length(),this.target.add(sU),this.object.position.copy(this.target).add(eU),eU.normalize(),tU.crossVectors(aU,eU).normalize(),nU.crossVectors(eU,tU).normalize(),iU.crossVectors(tU,nU).normalize().negate(),tU.length()>.1&&this.object.up.crossVectors(eU.clone().normalize(),tU),this.enablePan&&(rU.set(0,0,0).addScaledVector(tU,sU.x).addScaledVector(nU,sU.y).addScaledVector(iU,sU.z),this.targetOffset.add(rU),this.targetOffset.multiplyScalar(1/oU)),rU.set(0,0,0).addScaledVector(tU,-this.targetOffset.x).addScaledVector(nU,-this.targetOffset.y).addScaledVector(iU,-this.targetOffset.z),this.object.lookAt(rU.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class cU extends t.SimpleEventDispatcher{_setOptions(e){var t,n;Object.assign(this._options,e),this._options.mimeType&&"auto"!==this._options.mimeType||(this._options.mimeType=null!==(t=cU.GetSupportedMimeTypes([],["h264"],!0))&&void 0!==t?t:cU.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(null===(n=this._options.mimeType)||void 0===n?void 0:n.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,n){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=e=>{var t;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const e=new Blob(this._currentRecording,{type:this._options.mimeType});null===(t=this._recordingCallback)||void 0===t||t.call(this,e)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=e=>{var t;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&(null===(t=this._recorder)||void 0===t||t.pause())},this._onresume=e=>{if(!this.stepMode)return;const n=()=>{var e;"recording"===this._state&&(null===(e=this._recorder)||void 0===e||e.pause())},i=Math.min(this._resumeSyncTime-(0,t.now)(),0)+1e3/this._options.frameRate;i>0?(0,t.timeout)(i).then(n):n()},this._onpause=e=>{},this._ondataavailable=e=>{e.data&&e.data.size>0&&this._currentRecording.push(e.data)},this._onerror=e=>{this._state="error",this._console.error(e),this.dispatchEvent({type:"error",error:e}),this._recorder=void 0},this._canvas=e;const i=null==n?void 0:n.mimeType;this._options={mimeType:i||"auto",frameRate:30,stepMode:!1},this._setOptions(n||this._options)}isRecording(){return"recording"===this._state}start(){var e,t,n;if("recording"===this._state)return void this._console.log("Already recording canvas");if("error"===this._state&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return"paused"===this._state?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if("paused"===this._state)return this.dispatchEvent({type:"starting"}),void(this._state="recording");const i={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,null===(e=i.mimeType)||void 0===e?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const e=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),n=null===(t=e.getVideoTracks())||void 0===t?void 0:t[0];this._track=n,this._recorder=new window.MediaRecorder(e,i),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",null===(n=this._recorder)||void 0===n||n.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then((async e=>{const t=await(null==e?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._state="recording",this._onstart({})})).catch((e=>{this._onerror({detail:e})}))}async requestFrame(){if("recording"!==this._state)return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,t.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){"paused"!==this._state&&"stopped"!==this._state&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){"stopped"!==this._state&&("error"!==this._state?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&"error"!==this._state?this.stop((e=>{this._console.warn("disposed with blob",e),this.dispose()})):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const n=await Promise.all(e.map((async([e,t])=>await(await fetch(t)).blob()))),i=[];for(let r=0;r<e.length;r++){const s=await this._imgDirectory.getFileHandle(e[r][0],{create:!0});i.push((0,t.writeFile)(s,n[r]))}await Promise.all(i)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter((t=>!e||e.length<1||e.includes(t))),r=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter((e=>!t||t.length<1||t.includes(e))),s=[];return i.forEach((e=>{const t=`video/${e}`;r.forEach((e=>{[`${t};codecs=${e}`,`${t};codecs:${e}`,`${t};codecs=${e.toUpperCase()}`,`${t};codecs:${e.toUpperCase()}`,`${t}`].forEach((e=>{MediaRecorder.isTypeSupported(e)&&s.push(e)}))}))})),n?s.length>0?s[0]:void 0:s}}class uU extends sa{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new n.cJO(1,0))}}function dU(e,t,n){var i,r;let s=Array.from((null!==(i=e.access)&&void 0!==i?i:"").split(".")),o=null!==(r=e.targetObject)&&void 0!==r?r:t;const a=s.pop();if(!a||0===a.length)return{key:void 0,tar:o};if((n=null!=n?n:null==t?void 0:t._animGetters)&&s[0]in n){const e=n[s[0]](s);e?(o=e.tar,s=s.slice(e.i+1)):o=e}return o=function(e,t,n=!1){for("string"==typeof e&&(e=e.split("."));e.length>0;){if(!t)return t;const i=e.splice(0,1)[0];if(!(i.length<1))if(Array.isArray(t))t=t[parseInt(i)];else{if("object"!=typeof t||!(i in t)){if(n)throw new Error("invalid access, check "+i+" in "+t);return}t=t[i]}}return t}(s,o),o&&!(a in o)?(console.error("invalid key",a,o,t,e),{key:void 0,tar:o}):{key:a,tar:o}}async function hU(e,n,i){var r,s,o,a;const{key:l,tar:c}=dU(n,e),u=n.animSet?[fU(e,n.animSet,i,null!==(r=n.animSetParallel)&&void 0!==r&&r)]:[];if(l&&c){const e=null!==(a=n.updater)&&void 0!==a?a:[],r=async()=>Ld(c,l,{from:n.from,to:n.to,ease:"string"==typeof n.ease?kd[n.ease]:n.ease,duration:n.duration,...n.options,onUpdate:t=>{var r,s;null===(s=(r=n.options).onUpdate)||void 0===s||s.call(r,t),e.forEach((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.call(i)}))}},void 0,!1);n.delay?u.push((0,t.timeout)(n.delay).then(r)):u.push(r())}else(n.duration||n.delay)&&u.push((0,t.timeout)((null!==(s=n.delay)&&void 0!==s?s:0)+(null!==(o=n.duration)&&void 0!==o?o:0)));return 1===u.length?u[0]:Promise.all(u)}async function pU(e,t,n){return"function"==typeof t.animate?t.animate():hU(e,t,n)}async function fU(e,t,n,i=!1){if(i)return Promise.all(t.map((async t=>pU(e,t,n))));for(const r of t)await pU(e,r,n)}const mU=new TextEncoder,gU={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},_U=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class vU{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:n,service:i,region:r,cache:s,retries:o,initRetryMs:a}){if(null==e)throw new TypeError("accessKeyId is a required option");if(null==t)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=n,this.service=i,this.region=r,this.cache=s||new Map,this.retries=null!=o?o:10,this.initRetryMs=a||50}async sign(e,t){if(e instanceof Request){const{method:n,url:i,headers:r,body:s}=e;null==(t=Object.assign({method:n,url:i,headers:r},t)).body&&r.has("Content-Type")&&(t.body=null!=s&&r.has("X-Amz-Content-Sha256")?s:await e.clone().arrayBuffer()),e=i}const n=new yU(Object.assign({url:e},t,this,t&&t.aws)),i=Object.assign({},t,await n.sign());delete i.aws;try{return new Request(i.url.toString(),i)}catch(e){if(e instanceof TypeError)return new Request(i.url.toString(),Object.assign({duplex:"half"},i));throw e}}async fetch(e,t){for(let n=0;n<=this.retries;n++){const i=fetch(await this.sign(e,t));if(n===this.retries)return i;const r=await i;if(r.status<500&&429!==r.status)return r;await new Promise((e=>setTimeout(e,Math.random()*this.initRetryMs*Math.pow(2,n))))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class yU{constructor({method:e,url:t,headers:n,body:i,accessKeyId:r,secretAccessKey:s,sessionToken:o,service:a,region:l,cache:c,datetime:u,signQuery:d,appendSessionToken:h,allHeaders:p,singleEncode:f}){if(null==t)throw new TypeError("url is a required option");if(null==r)throw new TypeError("accessKeyId is a required option");if(null==s)throw new TypeError("secretAccessKey is a required option");let m,g;this.method=e||(i?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(n||{}),this.body=i,this.accessKeyId=r,this.secretAccessKey=s,this.sessionToken=o,a&&l||([m,g]=function(e,t){const{hostname:n,pathname:i}=e;if(n.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(n.endsWith(".backblazeb2.com")){const e=n.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return null!=e?["s3",e[1]]:["",""]}const r=n.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[s,o]=(r||["",""]).slice(1,3);if("us-gov"===o)o="us-gov-west-1";else if("s3"===o||"s3-accelerate"===o)o="us-east-1",s="s3";else if("iot"===s)s=n.startsWith("iot.")?"execute-api":n.startsWith("data.jobs.iot.")?"iot-jobs-data":"/mqtt"===i?"iotdevicegateway":"iotdata";else if("autoscaling"===s){const e=(t.get("X-Amz-Target")||"").split(".")[0];"AnyScaleFrontendService"===e?s="application-autoscaling":"AnyScaleScalingPlannerFrontendService"===e&&(s="autoscaling-plans")}else null==o&&s.startsWith("s3-")?(o=s.slice(3).replace(/^fips-|^external-1/,""),s="s3"):s.endsWith("-fips")?s=s.slice(0,-5):o&&/-\d$/.test(s)&&!/-\d$/.test(o)&&([s,o]=[o,s]);return[gU[s]||s,o]}(this.url,this.headers)),this.service=a||m||"",this.region=l||g||"us-east-1",this.cache=c||new Map,this.datetime=u||(new Date).toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=d,this.appendSessionToken=h||"iotdevicegateway"===this.service,this.headers.delete("Host"),"s3"!==this.service||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const _=this.signQuery?this.url.searchParams:this.headers;if(_.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&_.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter((e=>p||!_U.has(e))).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map((e=>e+":"+("host"===e?this.url.host:(this.headers.get(e)||"").replace(/\s+/g," ")))).join("\n"),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&("s3"!==this.service||_.has("X-Amz-Expires")||_.set("X-Amz-Expires","86400"),_.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),_.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),_.set("X-Amz-SignedHeaders",this.signedHeaders)),"s3"===this.service)try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch(e){this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");f||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=xU(this.encodedPath);const v=new Set;this.encodedSearch=[...this.url.searchParams].filter((([e])=>{if(!e)return!1;if("s3"===this.service){if(v.has(e))return!1;v.add(e)}return!0})).map((e=>e.map((e=>xU(encodeURIComponent(e)))))).sort((([e,t],[n,i])=>e<n?-1:e>n?1:t<i?-1:t>i?1:0)).map((e=>e.join("="))).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join();let n=this.cache.get(t);if(!n){const i=await bU("AWS4"+this.secretAccessKey,e),r=await bU(i,this.region),s=await bU(r,this.service);n=await bU(s,"aws4_request"),this.cache.set(t,n)}return wU(await bU(n,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,wU(await AU(await this.canonicalString()))].join("\n")}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+"\n",this.signedHeaders,await this.hexBodyHash()].join("\n")}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||("s3"===this.service&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(null==e){if(this.body&&"string"!=typeof this.body&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=wU(await AU(this.body||""))}return e}}async function bU(e,t){const n=await crypto.subtle.importKey("raw","string"==typeof e?mU.encode(e):e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",n,mU.encode(t))}async function AU(e){return crypto.subtle.digest("SHA-256","string"==typeof e?mU.encode(e):e)}function wU(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("0"+e.toString(16)).slice(-2))).join("")}function xU(e){return e.replace(/[!'()*]/g,(e=>"%"+e.charCodeAt(0).toString(16).toUpperCase()))}var EU,CU=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let SU=EU=class extends _t{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[PI],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1,this.fetchFunction=fetch}connect(){this._connected&&this.disconnect(),this._client=new vU({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var e,t;null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(e){return this.serializeSettings?super.toJSON(e):{type:this.constructor.PluginType}}async onAdded(e){await super.onAdded(e);const n=e.getPlugin(PI);n.actions.exportFile=async(i,r,s)=>{if(!this._connected)return void await n.defaultActions.exportFile(i,r);const o=(0,t.pathJoin)([this.endpointURL,this.pathPrefix,r]),a=await this.fetch(o,{method:"PUT",body:i},s);if(!a.ok)return e.console.error("Error uploading file",a),void await n.defaultActions.exportFile(i,r);this.dispatchEvent({type:"fileUpload",name:r,blob:i,response:a,path:o}),e.console.log("File uploaded",a)}}async fetch(e,n,i){if(!this._client)throw new Error("Not connected");for(let r=0;r<=this._client.retries;r++){const i=await MU(this._client,e,n);let s=i.url.toString();EU.USE_PROXY&&s&&!s.includes(EU.PROXY_URL)&&(s=EU.PROXY_URL.replace("{path}",s));const o=(0,this.fetchFunction)(s,i);if(r===this._client.retries)return o;const a=await o;if(a.status<500&&429!==a.status)return a;await(0,t.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,r))}throw new Error("An unknown error occurred, ensure retries is not negative")}};async function MU(e,t,n){if(t instanceof Request){const{method:e,url:i,headers:r,body:s}=t;null==(n=Object.assign({method:e,url:i,headers:r},n)).body&&r.has("Content-Type")&&(n.body=null!=s&&r.has("X-Amz-Content-Sha256")?s:await t.clone().arrayBuffer()),t=i,console.warn("WebGi AWSClientPlugin: There could be a bug in chrome with cloning Request objects, see https://bugs.chromium.org/p/chromium/issues/detail?id=1360943")}const i=new yU(Object.assign({url:t},n,e,n&&n.aws)),r=Object.assign({},n,await i.sign());return delete r.aws,r}SU.PluginType="AWSClientPlugin1",SU.USE_PROXY=!1,SU.PROXY_URL="https://r2-s3-api.repalash.com/{path}",CU([re(),ze("Access Key ID",(e=>({disabled:()=>!e.enabled||e._connected})))],SU.prototype,"accessKeyId",void 0),CU([re(),ze("Access Key Secret",(e=>({disabled:()=>!e.enabled||e._connected})))],SU.prototype,"accessKeySecret",void 0),CU([re(),ze("Endpoint URL",(e=>({disabled:()=>!e.enabled||e._connected})))],SU.prototype,"endpointURL",void 0),CU([re(),ze("Path Prefix",(e=>({disabled:()=>!e.enabled})))],SU.prototype,"pathPrefix",void 0),CU([re(),Oe("Remember",(e=>({disabled:()=>!e.enabled||e._connected})))],SU.prototype,"serializeSettings",void 0),CU([je(void 0,(e=>({label:()=>e._connected?"Disconnect":"Connect"})))],SU.prototype,"toggleConnection",void 0),SU=EU=CU([We("S3 Connection")],SU);const TU=(()=>{let e=!1,t=!1;const n="function"==typeof globalThis.ReadableStream,i="function"==typeof globalThis.Request;return n&&i&&(t=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type")),e&&!t})(),IU={Background:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map((e=>({path:e})))}).assets,Environment:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map((e=>({path:e})))}).assets,GemEnvironment:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map((e=>({path:e})))}).assets,GemEnvironment2:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map((e=>({path:e})))}).assets,GemEnvironment3:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map((e=>({path:e})))}).assets,Ground:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map((e=>({path:e})))}).assets,CameraViews:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map((e=>({path:e})))}).assets,MaterialConfiguration:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map((e=>({path:e})))}).assets,MaterialLibraries:new Iv({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map((e=>({path:e})))}).assets};function PU(e,t){return t?e*(1e3/t):0}function RU(e){var t,n=e.from,i=void 0===n?0:n,r=e.velocity,s=void 0===r?0:r,o=e.min,a=e.max,l=e.power,c=void 0===l?.8:l,u=e.timeConstant,d=void 0===u?750:u,h=e.bounceStiffness,p=void 0===h?500:h,f=e.bounceDamping,m=void 0===f?10:f,g=e.restDelta,_=void 0===g?1:g,v=e.modifyTarget,y=e.driver,b=e.onUpdate,A=e.onComplete,w=e.onStop;function x(e){return void 0!==o&&e<o||void 0!==a&&e>a}function E(e){return void 0===o?a:void 0===a||Math.abs(o-e)<Math.abs(a-e)?o:a}function C(e){null==t||t.stop(),t=Dd(ru(ru({},e),{driver:y,onUpdate:function(t){var n;null==b||b(t),null===(n=e.onUpdate)||void 0===n||n.call(e,t)},onComplete:A,onStop:w}))}function S(e){C(ru({type:"spring",stiffness:p,damping:m,restDelta:_},e))}if(x(i))S({from:i,velocity:s,to:E(i)});else{var M=c*s+i;void 0!==v&&(M=v(M));var T,I,P=E(M),R=P===o?-1:1;C({type:"decay",from:i,velocity:s,timeConstant:d,power:c,restDelta:_,modifyTarget:v,onUpdate:x(M)?function(e){T=I,I=e,s=PU(e-T,Td().delta),(1===R&&e>P||-1===R&&e<P)&&S({from:e,to:P,velocity:s})}:void 0})}return{stop:function(){return null==t?void 0:t.stop()}}}var DU=function(e){return 180*e/Math.PI},kU=function(e,t){return void 0===t&&(t=$u),DU(Math.atan2(t.y-e.y,t.x-e.x))},BU=function(e,t){var n=!0;return void 0===t&&(t=e,n=!1),function(i){return n?i-e+t:(e=i,n=!0,t)}},OU=function(e){return e},LU=function(e){return void 0===e&&(e=OU),function(t,n,i){var r=n-i,s=-(0-t+1)*(0-e(Math.abs(r)));return r<=0?n+s:n-s}},UU=LU(),NU=LU(Math.sqrt),FU=function(e){return e*Math.PI/180},jU=function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")},zU=function(e){return jU(e)&&e.hasOwnProperty("z")},GU=function(e,t){return Math.abs(e-t)};function VU(e,t){if(ed(e)&&ed(t))return GU(e,t);if(jU(e)&&jU(t)){var n=GU(e.x,t.x),i=GU(e.y,t.y),r=zU(e)&&zU(t)?GU(e.z,t.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(i,2)+Math.pow(r,2))}}var HU=function(e,t,n){return t=FU(t),{x:n*Math.cos(t)+e.x,y:n*Math.sin(t)+e.y}},QU=function(e,t){return void 0===t&&(t=2),t=Math.pow(10,t),Math.round(e*t)/t},WU=function(e,t,n,i){return void 0===i&&(i=0),QU(e+n*(t-e)/Math.max(i,n))},qU=function(e){void 0===e&&(e=50);var t=0,n=0;return function(i){var r=Td().timestamp,s=r!==n?r-n:0,o=s?WU(t,i,s,e):t;return n=r,t=o,o}},XU=function(e){if("number"==typeof e)return function(t){return Math.round(t/e)*e};var t=0,n=e.length;return function(i){var r=Math.abs(e[0]-i);for(t=1;t<n;t++){var s=e[t],o=Math.abs(s-i);if(0===o)return s;if(o>r)return e[t-1];if(t===n-1)return s;r=o}}};function YU(e,t){return e/(1e3/t)}var KU=function(e,t,n){var i=t-e;return((n-e)%i+i)%i+e},JU=function(e,t){return 1-3*t+3*e},ZU=function(e,t){return 3*t-6*e},$U=function(e){return 3*e},eN=function(e,t,n){return((JU(t,n)*e+ZU(t,n))*e+$U(t))*e},tN=function(e,t,n){return 3*JU(t,n)*e*e+2*ZU(t,n)*e+$U(t)},nN=1e-7,iN=10,rN=8,sN=.001,oN=11,aN=1/(oN-1);function lN(e,t,n,i){if(e===t&&n===i)return Hc;for(var r=new Float32Array(oN),s=0;s<oN;++s)r[s]=eN(s*aN,e,n);return function(s){return 0===s||1===s?s:eN(function(t){for(var i=0,s=1,o=oN-1;s!==o&&r[s]<=t;++s)i+=aN;--s;var a=i+(t-r[s])/(r[s+1]-r[s])*aN,l=tN(a,e,n);return l>=sN?function(e,t,n,i){for(var r=0;r<rN;++r){var s=tN(t,n,i);if(0===s)return t;t-=(eN(t,n,i)-e)/s}return t}(t,a,e,n):0===l?a:function(e,t,n,i,r){var s,o,a=0;do{(s=eN(o=t+(n-t)/2,i,r)-e)>0?n=o:t=o}while(Math.abs(s)>nN&&++a<iN);return o}(t,i,i+aN,e,n)}(s),t,i)}}var cN=function(e,t){return void 0===t&&(t="end"),function(n){var i=(n="end"===t?Math.min(n,.999):Math.max(n,.001))*e,r="end"===t?Math.floor(i):Math.ceil(i);return lu(0,1,r/e)}};const uN=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function dN(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(uN[255&e]+uN[e>>8&255]+uN[e>>16&255]+uN[e>>24&255]+"-"+uN[255&t]+uN[t>>8&255]+"-"+uN[t>>16&15|64]+uN[t>>24&255]+"-"+uN[63&n|128]+uN[n>>8&255]+"-"+uN[n>>16&255]+uN[n>>24&255]+uN[255&i]+uN[i>>8&255]+uN[i>>16&255]+uN[i>>24&255]).toLowerCase()}Math.PI,Math.PI;var hN,pN=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class fN extends _t{constructor(){super(...arguments),this.enabled=!0,this.animation=new mN((()=>this._viewer)),this.uiConfig=this.animation.uiConfig}async onAdded(e){function t(e){let t="",n=1;for(;n<e.length&&(t+=e[n],e[n].endsWith("\\"));n++)t=t.slice(0,-1),t+=".";return[t,n]}await super.onAdded(e),e._animGetters={objects:n=>{if(n.length<2||!e)return;const[i,r]=t(n);return{tar:e.scene.getObjectByName(i),i:r}},materials:n=>{var i,r,s;if(n.length<2||!e)return;const[o,a]=t(n);return{tar:null===(s=null===(r=null===(i=e.assetManager)||void 0===i?void 0:i.materials)||void 0===r?void 0:r.findMaterialsByName(o))||void 0===s?void 0:s[0],i:a}}}}}fN.PluginType="AnimationObjectPlugin",pN([re(),Be()],fN.prototype,"animation",void 0);let mN=hN=class{constructor(e){this.target=e,this.uuid=dN(),this.name="",this.access="",this.options={},this.duration=1e3,this.delay=0,this.repeat=1,this.repeatType="mirror",this.ease="easeInOutSine",this.updater=[],this.updateScene=!1,this.updateCamera=!1,this.updateViewer=!1,this.animSetParallel=!1,this.animSet=[],this.uiConfig=Qe("Animation Object",this,void 0,"folder",!0)}_onAccessChanged(){const e=(0,t.getOrCall)(this.target),{key:n,tar:i}=dU(this,e);if(this.from=void 0,this.to=void 0,!n||!i)return void this.refreshUi();const r=i[n];if(null==r)return void this.refreshUi();const s=()=>{if(!r)return r;if(r.isColor)return"#"+r.getHexString();const e="function"==typeof r.clone?r.clone():"object"==typeof r?{...r}:r;return console.log(e),e};this.from=s(),this.to=s(),this.refreshUi()}refreshUi(){var e,t;null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0,1)}add(e){this.animSet.push(e),e.parent=this,this.refreshUi()}remove(e){const t=this.animSet.indexOf(e);t>=0&&(this.animSet.splice(t,1),e.parent=void 0,this.refreshUi())}async animate(e=!1){"boolean"!=typeof e&&(e=!1);const n=(0,t.getOrCall)(this.target);if(!n)return void console.warn("AnimationObject: No viewer");e&&(this.options.to=this.from,this.options.from=this.to),this.options.repeatType=this.repeatType,this.options.repeat=this.repeat,this.updater=[],this.updateScene&&this.updater.push("scene"),this.updateCamera&&this.updater.push("camera"),this.updateViewer&&this.updater.push("viewer"),this.animSet.forEach((e=>e.target=this.target));const i=hU(n,this,{viewer:()=>n.setDirty(),renderer:()=>n.renderer.reset(),scene:()=>{n.scene.setDirty()},camera:()=>n.scene.activeCamera.setDirty()});await i,delete this.options.to,delete this.options.from}async animateReverse(){await this.animate(!0)}async removeFromParent2(){const e=(0,t.getOrCall)(this.target);this.parent&&e&&await e.confirm(`Delete: Are you sure you want to delete the animation ${this.name}?`)&&this.removeFromParent()}removeFromParent(){this.parent&&this.parent.remove(this)}addAnimation(){this.add(new hN(this.target))}};pN([re(),ze()],mN.prototype,"name",void 0),pN([re(),ze(),(0,t.onChange)(hN.prototype._onAccessChanged)],mN.prototype,"access",void 0),pN([Be(),re()],mN.prototype,"from",void 0),pN([Be(),re()],mN.prototype,"to",void 0),pN([re()],mN.prototype,"options",void 0),pN([re(),Ue(void 0,[0,1e4],1,(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"duration",void 0),pN([re(),Ue(void 0,[0,1e4],1,(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"delay",void 0),pN([re(),Ue(void 0,[0,10],1,(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"repeat",void 0),pN([re(),Fe("repeatType",["loop","reverse","mirror"].map((e=>({label:e}))),(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"repeatType",void 0),pN([re(),Fe("ease",Object.keys(kd).map((e=>({label:e}))),(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"ease",void 0),pN([re(),Oe(void 0,(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"updateScene",void 0),pN([re(),Oe(void 0,(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"updateCamera",void 0),pN([re(),Oe(void 0,(e=>({hidden:()=>void 0===e.from})))],mN.prototype,"updateViewer",void 0),pN([je("Animate")],mN.prototype,"animate",null),pN([je("Animate Reverse")],mN.prototype,"animateReverse",null),pN([je("Delete")],mN.prototype,"removeFromParent2",null),pN([re(),Oe()],mN.prototype,"animSetParallel",void 0),pN([re(),Be()],mN.prototype,"animSet",void 0),pN([je("Add Animation")],mN.prototype,"addAnimation",null),mN=hN=pN([de("AnimationObject")],mN);var gN,_N=function(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let vN=gN=class extends _t{constructor(e=!0){super(),this.enabled=!0,this.dependencies=[],this.options={id:dN(),type:"linear",gradientUnits:"objectBoundingBox",linearOptions:{angle:45,x1:0,y1:0,x2:1,y2:1},radialOptions:{cx:.5,cy:.5,r:.5,fx:.5,fy:.5,spreadMethod:"pad"}},this.type="linear",this.gradientUnits="objectBoundingBox",this.position1=new n.FM8(0,0),this.position2=new n.FM8(1,1),this.angle=0,this.radius=.5,this.center=new n.FM8(.5,.5),this.focus=new n.FM8(.5,.5),this.spreadMethod="pad",this._svgGradient=new yN,this._needsUpdate=!1,this.colors=[new n.Ilk(1,1,1),new n.Ilk(1,0,0)],this.color1=this.colors[0],this.color2=this.colors[1],this.applyToBackground=!1,this.autoRefresh=!0,this.enabled=e}_refreshOptions(){var e,t,n,i,r,s,o,a;this.options.type=this.type,this.options.gradientUnits=this.gradientUnits,this.options.linearOptions={angle:this.angle,x1:null===(e=this.position1)||void 0===e?void 0:e.x,y1:null===(t=this.position1)||void 0===t?void 0:t.y,x2:null===(n=this.position2)||void 0===n?void 0:n.x,y2:null===(i=this.position2)||void 0===i?void 0:i.y},this.options.radialOptions={cx:null===(r=this.center)||void 0===r?void 0:r.x,cy:null===(s=this.center)||void 0===s?void 0:s.y,r:this.radius,fx:null===(o=this.focus)||void 0===o?void 0:o.x,fy:null===(a=this.focus)||void 0===a?void 0:a.y,spreadMethod:this.spreadMethod},this.setDirty()}setDirty(){this._needsUpdate=!0}addColor(){this.colors.push(new n.Ilk),this.setDirty()}refreshSvg(){if((!this.applyToBackground||this._viewer)&&(this._refreshOptions(),this._needsUpdate=!1,this._svgElement=this._svgGradient.get(this.colors,this.options),this.applyToBackground)){const e=`\n            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">\n            <defs>\n            ${this._svgElement.outerHTML}\n            </defs>\n            <rect width="100%" height="100%" fill="url(#${this.options.id})"/>\n            </svg>\n            `,i=(0,t.svgUrl)(e),r=new Image;r.src=i;const s=new n.xEZ(r);r.onload=()=>{this._svgTexture===s&&(this._svgTexture.needsUpdate=!0,this._viewer.scene.background=this._svgTexture,this._viewer.setDirty())},this._svgTexture&&this._svgTexture.dispose(),this._svgTexture=s}}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",(()=>{this.enabled&&this._needsUpdate&&this.autoRefresh&&this.refreshSvg()}))}};vN.PluginType="GradientSvgPlugin",_N([Oe()],vN.prototype,"enabled",void 0),_N([re(),Fe("type",["linear","radial"].map((e=>({label:e})))),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"type",void 0),_N([re(),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"gradientUnits",void 0),_N([re(),Ne("position1",[0,1],.01,(e=>({hidden:()=>"linear"!==e.type,onChange:()=>e._refreshOptions()}))),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"position1",void 0),_N([re(),Ne("position2",[0,1],.01,(e=>({hidden:()=>"linear"!==e.type,onChange:()=>e._refreshOptions()}))),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"position2",void 0),_N([re(),Ue("angle",[0,360],1,(e=>({hidden:()=>"linear"!==e.type}))),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"angle",void 0),_N([re(),Ue("radius",[0,1],.01,(e=>({hidden:()=>"radial"!==e.type}))),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"radius",void 0),_N([re(),Ne("center",[0,1],.01,(e=>({hidden:()=>"radial"!==e.type,onChange:()=>e._refreshOptions()}))),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"center",void 0),_N([re(),Ne("focus",[0,1],.01,(e=>({hidden:()=>"radial"!==e.type,onChange:()=>e._refreshOptions()}))),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"focus",void 0),_N([re(),(0,t.onChange)(gN.prototype._refreshOptions)],vN.prototype,"spreadMethod",void 0),_N([re()],vN.prototype,"colors",void 0),_N([Ge(void 0,(e=>({onChange:()=>e.setDirty()}))),(0,t.onChange)(gN.prototype.setDirty)],vN.prototype,"color1",void 0),_N([Ge(void 0,(e=>({onChange:()=>e.setDirty()}))),(0,t.onChange)(gN.prototype.setDirty)],vN.prototype,"color2",void 0),_N([re(),Oe(),(0,t.onChange)(gN.prototype.setDirty)],vN.prototype,"applyToBackground",void 0),_N([je()],vN.prototype,"refreshSvg",null),_N([re()],vN.prototype,"autoRefresh",void 0),vN=gN=_N([We("Gradient SVG")],vN);class yN{constructor(){}get(e,t){return this.colors=e,this.options=t,this.createGradient()}createSvgElement(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}createColorStop(e,t,n){const i=this.createSvgElement("stop");return i.setAttribute("offset",t/n*100+"%"),i.setAttribute("stop-color",e),i}colorsToStops(){const e=this.colors;return e.map(((t,n)=>{const i=t.getStyle();return this.createColorStop(i,n,e.length)}))}createGradientElement(){const e=this.options,t=this.createSvgElement(`${e.type}Gradient`),n=/((id)|([c|f|x|y|r][x|y|1|2]?)|(gradientUnits))/,i=e[`${e.type}Options`],r={id:e.id,type:e.type,gradientUnits:e.gradientUnits,...i};return Object.entries(r).filter((e=>n.test(e[0]))).forEach((e=>{"type"!==e[0]&&t.setAttribute(e[0],e[1])})),r.angle&&t.setAttribute("gradientTransform",`rotate(${r.angle})`),t}createGradient(){const e=this.createGradientElement();return this.colorsToStops().forEach((t=>e.appendChild(t))),e}}class bN extends zs{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[sL,oL,Ho,Ns]},{title:"Picking",plugins:[eL,za,Bc,k_,uP,YL]},{title:"Scene",plugins:[KO,G_,JO,tL,nL,bl,Ul,SC,SP,vN]},{title:"Anti-aliasing",plugins:[To,yh,nh]},{title:"Post Processing",plugins:[eo,$E,ah,ro,Yo,Kd,El,fo,yo,Ro,rl,jl]},{title:"Export",plugins:[ub,Nc,wC,SU,TP]},{title:"Animations",plugins:[Ya,zd,fN,Zd,LI,PO]},{title:"Modifiers",plugins:[RC,NC,XC,BC,aS,VT,hh,MI]},{title:"Configurators",plugins:[R_,I_,Ih,pP]},{title:"Plugins",plugins:[iv,Sl,Ah,Ha,Io,Wh,ko,Rl,Dh,al,fh,Sc,HE,J_]},{title:"Extras",plugins:[UL,mC,gP,PP,RP]}],OL()}async setupUi(e,t){await LL(this,e,null!=t?t:this.defaultModes),this._editorInitialized=!0}}async function AN(e,{debug:n=!1,ground:i=!0,bloom:r=!0,depthTonemap:s=!0,importPopup:o=!0,caching:a=!0,presetLibrary:l=!0,switchNode:c=!0,materialConfigurator:u=!0}){e.enabled=!1,n&&await e.addPlugin(bp),e.getPlugin(Ls)||await e.addPlugin(Ls,void 0,void 0,{storage:a&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await e.addPlugin(ub),await e.addPlugin(uE),await e.addPlugin(PI),o&&await e.addPlugin(Sc),await e.addPlugin(TL),await e.addPlugin(gP,!1),await e.getOrAddPlugin(ty),await e.addPlugin(jC),await e.getOrAddPlugin(Ns),await e.addPlugin(PO),await e.addPlugin(fP),await e.addPlugin(za,oa,!1,!0),await sv(e,{ground:i,bloom:r,depthTonemap:s}),l&&await e.getOrAddPlugin(Ho),await e.getOrAddPlugin(Bc),await e.addPlugin($E),await e.addPlugin(BC,!1),await e.addPlugin($T),await e.addPlugin(oI),await e.addPlugin(mI),await e.addPlugin(wI),await e.addPlugin(HE,!1),await e.addPlugin(new RC(!1)),await e.addPlugin(NC),await e.addPlugin(XC),u&&((await e.addPlugin(I_)).enableEditContextMenus=!0),c&&await e.addPlugin(R_),await e.addPlugin(pP),await e.addPlugin(k_),await e.addPlugin(wC),await e.addPlugin(Nc),await e.addPlugin(eL),await e.addPlugin(JO),await e.addPlugin(tL),await e.addPlugin(nL),await e.addPlugin(sL),await e.addPlugin(oL),await e.addPlugin(KO),await e.addPlugin(YL,!1),await e.addPlugin(SP),await e.addPlugin(uP),await e.addPlugin(LI,e.container,!1),await e.addPlugin(SU),await e.addPlugin(PP),await e.addPlugin(TP),await e.addPlugin(vN),await e.addPlugin(fN),await e.addPlugin(MI);const d=await e.addPlugin(new YO(!(0,t.mobileAndTabletCheck)()));return e.renderer.refreshPipeline(),e.scene.addEventListener("textureAdded",(t=>{t.texture&&e.setEnvironmentMap(t.texture)})),d.setupPluginUi(Ah),d.setupPluginUi(sL),d.setupPluginUi(oL),d.setupPluginUi(Sc),d.setupPluginUi(Ns),d.setupPluginUi(KO),d.setupPluginUi(ub),d.setupPluginUi(Ya),d.setupPluginUi(bl),c&&d.setupPluginUi(R_),u&&d.setupPluginUi(I_),d.setupPluginUi(PO),d.setupPluginUi(eL),d.setupPluginUi(k_),d.setupPluginUi(Bc),d.setupPluginUi(za),i&&e.getPlugin(G_)&&d.setupPluginUi(G_),i&&e.getPlugin(SC)&&d.setupPluginUi(SC),d.setupPluginUi(El),d.setupPluginUi(zd),d.setupPluginUi(wC),d.setupPluginUi(eo),d.setupPluginUi($E),d.setupPluginUi(ro),d.setupPluginUi(Yo),d.setupPluginUi(ah),d.setupPluginUi(Kd),d.setupPluginUi(Ro),d.setupPluginUi(fo),d.setupPluginUi(al),d.setupPluginUi(Dh),d.setupPluginUi(JO),d.setupPluginUi(RC),d.setupPluginUi(NC),d.setupPluginUi(To),d.setupPluginUi(vN),d.setupPluginUi(fN),d.setupPluginUi(tL),d.setupPluginUi(nL),d.setupPluginUi(ko),d.setupPluginUi(Rl),d.setupPluginUi(fh),r&&d.setupPluginUi(yo),d.setupPluginUi(Nc),d.setupPluginUi(Sl),d.setupPluginUi(yh),d.setupPluginUi(Ul),d.setupPluginUi(rl),d.setupPluginUi(jl),d.setupPluginUi(XC),d.setupPluginUi(Io),d.setupPluginUi(nh),l&&d.setupPluginUi(Ho),d.setupPluginUi(Ih),d.setupPluginUi(Ha),d.setupPluginUi(BC),d.setupPluginUi(Zd),d.setupPluginUi(HE),d.setupPluginUi(SU),d.setupPluginUi(LI),d.setupPluginUi(uP),d.setupPluginUi(pP),d.setupPluginUi(hh),d.setupPluginUi(YL),d.setupPluginUi(J_),d.setupPluginUi(gP),d.setupPluginUi(SP),d.setupPluginUi(iv),d.setupPluginUi(PP),d.setupPluginUi(TP),d.setupPluginUi(MI),e.enabled=!0,e}async function wN(e,{debug:t=!1,ground:n=!0,bloom:i=!0,depthTonemap:r=!0,importPopup:s=!0,caching:o=!0}){const a=new zs(e);return await AN(a,{debug:t,ground:n,bloom:i,depthTonemap:r,importPopup:s,caching:o}),a}async function xN(e,{debug:t=!1,ground:n=!0,bloom:i=!0,depthTonemap:r=!0,importPopup:s=!1,enableDrop:o=!1,caching:a=!0}={}){const l=new zs(e);return t&&await l.addPlugin(bp),l.getPlugin(Ls)||l.addPluginSync(Ls,void 0,void 0,{storage:a&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await l.addPlugin(Tv,!0),await sv(l,{ground:n,bloom:i,depthTonemap:r,enableDrop:o,importPopup:s}),await l.getOrAddPlugin(Bc),l}}();var __webpackgi_exports__AAssetManagerProcessStatePlugin=__webpackgi_exports__.MWW,__webpackgi_exports__ACESFilmicToneMapping=__webpackgi_exports__.LY2,__webpackgi_exports__ACameraControlsPlugin=__webpackgi_exports__.GYo,__webpackgi_exports__ACanvasRecorder=__webpackgi_exports__.GPz,__webpackgi_exports__AMaterialManager=__webpackgi_exports__.HRj,__webpackgi_exports__ARPlacementBox=__webpackgi_exports__.li4,__webpackgi_exports__ARPlugin=__webpackgi_exports__.FO5,__webpackgi_exports__ARTouchInputHelper=__webpackgi_exports__.Nlh,__webpackgi_exports__AShaderMaterial2=__webpackgi_exports__.Mp4,__webpackgi_exports__AViewerPlugin=__webpackgi_exports__.QvI,__webpackgi_exports__AWSClientPlugin=__webpackgi_exports__.PrA,__webpackgi_exports__AddBlendPass=__webpackgi_exports__.JHp,__webpackgi_exports__AddEquation=__webpackgi_exports__.bGH,__webpackgi_exports__AddOperation=__webpackgi_exports__.NDo,__webpackgi_exports__AdditiveAnimationBlendMode=__webpackgi_exports__.gSk,__webpackgi_exports__AdditiveBlending=__webpackgi_exports__.WMw,__webpackgi_exports__AlphaFormat=__webpackgi_exports__.OTo,__webpackgi_exports__AlwaysCompare=__webpackgi_exports__.T6w,__webpackgi_exports__AlwaysDepth=__webpackgi_exports__.Se2,__webpackgi_exports__AlwaysStencilFunc=__webpackgi_exports__.cum,__webpackgi_exports__AmbientLight=__webpackgi_exports__.Mig,__webpackgi_exports__AmbientLight2=__webpackgi_exports__.B$7,__webpackgi_exports__AmbientLightProbe=__webpackgi_exports__.i_9,__webpackgi_exports__AnimationAction=__webpackgi_exports__.bBp,__webpackgi_exports__AnimationClip=__webpackgi_exports__.m7l,__webpackgi_exports__AnimationLoader=__webpackgi_exports__.sYA,__webpackgi_exports__AnimationMixer=__webpackgi_exports__.Xcj,__webpackgi_exports__AnimationObjectGroup=__webpackgi_exports__.mzJ,__webpackgi_exports__AnimationUtils=__webpackgi_exports__.ZZA,__webpackgi_exports__AnisotropyPlugin=__webpackgi_exports__.$Ph,__webpackgi_exports__ArcCurve=__webpackgi_exports__.T__,__webpackgi_exports__ArrayCamera=__webpackgi_exports__.HkE,__webpackgi_exports__ArrowHelper=__webpackgi_exports__.tGC,__webpackgi_exports__AssetExporter=__webpackgi_exports__.g1S,__webpackgi_exports__AssetExporterPlugin=__webpackgi_exports__.I$C,__webpackgi_exports__AssetImporter=__webpackgi_exports__.QIH,__webpackgi_exports__AssetManagerBasicPopupPlugin=__webpackgi_exports__._JE,__webpackgi_exports__AssetManagerLoadingBarPlugin=__webpackgi_exports__.SwW,__webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm,__webpackgi_exports__AsyncCompress=__webpackgi_exports__.jl_,__webpackgi_exports__AsyncDecompress=__webpackgi_exports__.b7R,__webpackgi_exports__AsyncDeflate=__webpackgi_exports__.BDV,__webpackgi_exports__AsyncGunzip=__webpackgi_exports__.Ea_,__webpackgi_exports__AsyncGzip=__webpackgi_exports__.qff,__webpackgi_exports__AsyncInflate=__webpackgi_exports__.tmC,__webpackgi_exports__AsyncUnzipInflate=__webpackgi_exports__.BON,__webpackgi_exports__AsyncUnzlib=__webpackgi_exports__.P40,__webpackgi_exports__AsyncZipDeflate=__webpackgi_exports__.wLL,__webpackgi_exports__AsyncZlib=__webpackgi_exports__.iHO,__webpackgi_exports__Audio=__webpackgi_exports__.BbS,__webpackgi_exports__AudioAnalyser=__webpackgi_exports__.kqm,__webpackgi_exports__AudioContext=__webpackgi_exports__.Hmr,__webpackgi_exports__AudioListener=__webpackgi_exports__.SJI,__webpackgi_exports__AudioLoader=__webpackgi_exports__.mTL,__webpackgi_exports__AxesHelper=__webpackgi_exports__.y8_,__webpackgi_exports__BackSide=__webpackgi_exports__._Li,__webpackgi_exports__BackgroundPresetGroup=__webpackgi_exports__.w7U,__webpackgi_exports__BaseGroundPlugin=__webpackgi_exports__.g56,__webpackgi_exports__BaseRenderer=__webpackgi_exports__.bj3,__webpackgi_exports__BasicDepthPacking=__webpackgi_exports__.z81,__webpackgi_exports__BasicShadowMap=__webpackgi_exports__._MY,__webpackgi_exports__BeringRingAnimation=__webpackgi_exports__.L7J,__webpackgi_exports__BlobLoader=__webpackgi_exports__.yEv,__webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ,__webpackgi_exports__Bone=__webpackgi_exports__.N$j,__webpackgi_exports__BooleanKeyframeTrack=__webpackgi_exports__._YM,__webpackgi_exports__Box2=__webpackgi_exports__.TUj,__webpackgi_exports__Box3=__webpackgi_exports__.ZzF,__webpackgi_exports__Box3B=__webpackgi_exports__.qzb,__webpackgi_exports__Box3Helper=__webpackgi_exports__.GQ,__webpackgi_exports__BoxBufferGeometry=__webpackgi_exports__.nvb,__webpackgi_exports__BoxGeometry=__webpackgi_exports__.DvJ,__webpackgi_exports__BoxHelper=__webpackgi_exports__.fQA,__webpackgi_exports__BoxSelectionWidget=__webpackgi_exports__.cPz,__webpackgi_exports__BufferAttribute=__webpackgi_exports__.TlE,__webpackgi_exports__BufferGeometry=__webpackgi_exports__.u9r,__webpackgi_exports__BufferGeometryLoader=__webpackgi_exports__.s4_,__webpackgi_exports__ByteType=__webpackgi_exports__.T95,__webpackgi_exports__CSGPluginBSP=__webpackgi_exports__.F5w,__webpackgi_exports__CSGPluginBVH=__webpackgi_exports__.NlP,__webpackgi_exports__CSGPluginBase=__webpackgi_exports__.$8Z,__webpackgi_exports__CSS3DRendererPlugin=__webpackgi_exports__.YYN,__webpackgi_exports__Cache=__webpackgi_exports__.CtF,__webpackgi_exports__Camera=__webpackgi_exports__.V1s,__webpackgi_exports__CameraController=__webpackgi_exports__.jOv,__webpackgi_exports__CameraHelper=__webpackgi_exports__.Rki,__webpackgi_exports__CameraUiPlugin=__webpackgi_exports__.pzV,__webpackgi_exports__CameraView=__webpackgi_exports__.itZ,__webpackgi_exports__CameraViewControlPlugin=__webpackgi_exports__.MMq,__webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.qKx,__webpackgi_exports__CannonPhysicsPlugin=__webpackgi_exports__.Hmi,__webpackgi_exports__CanvasMediaRecorder=__webpackgi_exports__.X4S,__webpackgi_exports__CanvasRecorder=__webpackgi_exports__.vlJ,__webpackgi_exports__CanvasRecorderPlugin=__webpackgi_exports__.nPO,__webpackgi_exports__CanvasSnipper=__webpackgi_exports__.zcQ,__webpackgi_exports__CanvasSnipperPlugin=__webpackgi_exports__.GH1,__webpackgi_exports__CanvasTexture=__webpackgi_exports__.ROQ,__webpackgi_exports__CapsuleBufferGeometry=__webpackgi_exports__.YN5,__webpackgi_exports__CapsuleGeometry=__webpackgi_exports__.BVQ,__webpackgi_exports__CatmullRomCurve3=__webpackgi_exports__.YT8,__webpackgi_exports__ChromaticAberrationPlugin=__webpackgi_exports__._DE,__webpackgi_exports__CineonToneMapping=__webpackgi_exports__.YGz,__webpackgi_exports__CircleBufferGeometry=__webpackgi_exports__.trn,__webpackgi_exports__CircleGeometry=__webpackgi_exports__.zf8,__webpackgi_exports__ClampToEdgeWrapping=__webpackgi_exports__.uWy,__webpackgi_exports__ClearcoatTintPlugin=__webpackgi_exports__.wYQ,__webpackgi_exports__Clock=__webpackgi_exports__.SUY,__webpackgi_exports__Color=__webpackgi_exports__.Ilk,__webpackgi_exports__ColorKeyframeTrack=__webpackgi_exports__.R2R,__webpackgi_exports__ColorManagement=__webpackgi_exports__.epp,__webpackgi_exports__CombinedPostPlugin=__webpackgi_exports__.xmJ,__webpackgi_exports__Compress=__webpackgi_exports__.GD$,__webpackgi_exports__CompressedArrayTexture=__webpackgi_exports__.Z_g,__webpackgi_exports__CompressedTexture=__webpackgi_exports__.EB7,__webpackgi_exports__CompressedTextureLoader=__webpackgi_exports__.DqL,__webpackgi_exports__ConeBufferGeometry=__webpackgi_exports__._3,__webpackgi_exports__ConeGeometry=__webpackgi_exports__.b_z,__webpackgi_exports__ContactShadowGroundPlugin=__webpackgi_exports__.OCn,__webpackgi_exports__CoreEditorApp=__webpackgi_exports__.N_j,__webpackgi_exports__CoreViewerApp=__webpackgi_exports__.hNv,__webpackgi_exports__CubeCamera=__webpackgi_exports__._am,__webpackgi_exports__CubeNormalsCaptureHelper=__webpackgi_exports__.kB7,__webpackgi_exports__CubeReflectionMapping=__webpackgi_exports__.fY$,__webpackgi_exports__CubeRefractionMapping=__webpackgi_exports__.vxC,__webpackgi_exports__CubeTexture=__webpackgi_exports__.BtG,__webpackgi_exports__CubeTextureLoader=__webpackgi_exports__.cBK,__webpackgi_exports__CubeUVReflectionMapping=__webpackgi_exports__.g8_,__webpackgi_exports__CubicBezierCurve=__webpackgi_exports__.AXT,__webpackgi_exports__CubicBezierCurve3=__webpackgi_exports__.yj7,__webpackgi_exports__CubicInterpolant=__webpackgi_exports__.dYG,__webpackgi_exports__CullFaceBack=__webpackgi_exports__.tm_,__webpackgi_exports__CullFaceFront=__webpackgi_exports__.S2y,__webpackgi_exports__CullFaceFrontBack=__webpackgi_exports__.B02,__webpackgi_exports__CullFaceNone=__webpackgi_exports__.PeU,__webpackgi_exports__Curve=__webpackgi_exports__.Hyl,__webpackgi_exports__CurvePath=__webpackgi_exports__.Wqd,__webpackgi_exports__CustomAnimationHelper=__webpackgi_exports__.c0Q,__webpackgi_exports__CustomAnimationHelperPlugin=__webpackgi_exports__.re0,__webpackgi_exports__CustomBlending=__webpackgi_exports__.Xaj,__webpackgi_exports__CustomBumpMapPlugin=__webpackgi_exports__.DUb,__webpackgi_exports__CustomToneMapping=__webpackgi_exports__.dZ3,__webpackgi_exports__CylinderBufferGeometry=__webpackgi_exports__.m_w,__webpackgi_exports__CylinderGeometry=__webpackgi_exports__.fHI,__webpackgi_exports__Cylindrical=__webpackgi_exports__.LBq,__webpackgi_exports__DRACOLoader2=__webpackgi_exports__.Qww,__webpackgi_exports__Damper=__webpackgi_exports__.CGV,__webpackgi_exports__Data3DTexture=__webpackgi_exports__.JUT,__webpackgi_exports__DataArrayTexture=__webpackgi_exports__.p3g,__webpackgi_exports__DataTexture=__webpackgi_exports__.IEO,__webpackgi_exports__DataTextureLoader=__webpackgi_exports__.yxD,__webpackgi_exports__DataUrlLoader=__webpackgi_exports__.CUS,__webpackgi_exports__DataUtils=__webpackgi_exports__.A5E,__webpackgi_exports__DebugPlugin=__webpackgi_exports__.zqG,__webpackgi_exports__DecodeUTF8=__webpackgi_exports__.PfX,__webpackgi_exports__Decompress=__webpackgi_exports__.Q1o,__webpackgi_exports__DecrementStencilOp=__webpackgi_exports__.jfJ,__webpackgi_exports__DecrementWrapStencilOp=__webpackgi_exports__.T_J,__webpackgi_exports__DefaultLoadingManager=__webpackgi_exports__.tEQ,__webpackgi_exports__Deflate=__webpackgi_exports__.gb4,__webpackgi_exports__DepthFormat=__webpackgi_exports__.qkB,__webpackgi_exports__DepthOfFieldPass=__webpackgi_exports__.cvk,__webpackgi_exports__DepthOfFieldPlugin=__webpackgi_exports__.HWo,__webpackgi_exports__DepthStencilFormat=__webpackgi_exports__.brP,__webpackgi_exports__DepthTexture=__webpackgi_exports__.$YQ,__webpackgi_exports__DeviceOrientationControls2=__webpackgi_exports__.X8d,__webpackgi_exports__DeviceOrientationControlsPlugin=__webpackgi_exports__.Zdt,__webpackgi_exports__DiamondMaterial=__webpackgi_exports__.yNB,__webpackgi_exports__DiamondPlugin=__webpackgi_exports__.h7x,__webpackgi_exports__DirectionalLight=__webpackgi_exports__.Ox3,__webpackgi_exports__DirectionalLight2=__webpackgi_exports__.qtn,__webpackgi_exports__DirectionalLightHelper=__webpackgi_exports__.cBI,__webpackgi_exports__DiscreteInterpolant=__webpackgi_exports__.cU9,__webpackgi_exports__DisplayP3ColorSpace=__webpackgi_exports__.ntt,__webpackgi_exports__DodecahedronBufferGeometry=__webpackgi_exports__.DT1,__webpackgi_exports__DodecahedronGeometry=__webpackgi_exports__.Kgo,__webpackgi_exports__DoubleSide=__webpackgi_exports__.ehD,__webpackgi_exports__Dropzone=__webpackgi_exports__.fhJ,__webpackgi_exports__DropzonePlugin=__webpackgi_exports__.y1s,__webpackgi_exports__DstAlphaFactor=__webpackgi_exports__.fSK,__webpackgi_exports__DstColorFactor=__webpackgi_exports__.Vdb,__webpackgi_exports__DynamicCopyUsage=__webpackgi_exports__.l8J,__webpackgi_exports__DynamicDrawUsage=__webpackgi_exports__.dj0,__webpackgi_exports__DynamicReadUsage=__webpackgi_exports__.QM0,__webpackgi_exports__EXRExporter2=__webpackgi_exports__.n94,__webpackgi_exports__EXRLoadPlugin=__webpackgi_exports__.OIS,__webpackgi_exports__EasingFunctions=__webpackgi_exports__.q8b,__webpackgi_exports__EdgesGeometry=__webpackgi_exports__.TOt,__webpackgi_exports__EffectComposer2=__webpackgi_exports__.xaN,__webpackgi_exports__EllipseCurve=__webpackgi_exports__.Ny0,__webpackgi_exports__EllipseCurve3D=__webpackgi_exports__.NeD,__webpackgi_exports__EncodeUTF8=__webpackgi_exports__.Zof,__webpackgi_exports__EncoderMethod=__webpackgi_exports__.N1Y,__webpackgi_exports__EnvironmentPresetGroup=__webpackgi_exports__.itK,__webpackgi_exports__EqualCompare=__webpackgi_exports__.F1y,__webpackgi_exports__EqualDepth=__webpackgi_exports__.eD,__webpackgi_exports__EqualStencilFunc=__webpackgi_exports__.jwo,__webpackgi_exports__EquirectangularReflectionMapping=__webpackgi_exports__.dSO,__webpackgi_exports__EquirectangularRefractionMapping=__webpackgi_exports__.Bf4,__webpackgi_exports__Euler=__webpackgi_exports__.USm,__webpackgi_exports__EventDispatcher=__webpackgi_exports__.pBf,__webpackgi_exports__ExtrasUiPlugin=__webpackgi_exports__.eBg,__webpackgi_exports__ExtrudeBufferGeometry=__webpackgi_exports__.$Vf,__webpackgi_exports__ExtrudeGeometry=__webpackgi_exports__.O7d,__webpackgi_exports__FBXLoadPlugin=__webpackgi_exports__.ksq,__webpackgi_exports__FFMPEGRecorder=__webpackgi_exports__.hFL,__webpackgi_exports__FSShadowMaterial=__webpackgi_exports__.gXf,__webpackgi_exports__FileLoader=__webpackgi_exports__.hH6,__webpackgi_exports__FileTransferPlugin=__webpackgi_exports__.izP,__webpackgi_exports__FilmicGrainPlugin=__webpackgi_exports__.kpi,__webpackgi_exports__FirstPersonControls2=__webpackgi_exports__.DwZ,__webpackgi_exports__FirstPersonControlsPlugin=__webpackgi_exports__.kN3,__webpackgi_exports__Float16BufferAttribute=__webpackgi_exports__.e62,__webpackgi_exports__Float32BufferAttribute=__webpackgi_exports__.a$l,__webpackgi_exports__Float64BufferAttribute=__webpackgi_exports__.OM3,__webpackgi_exports__FloatType=__webpackgi_exports__.VzW,__webpackgi_exports__Fog=__webpackgi_exports__.ybr,__webpackgi_exports__FogExp2=__webpackgi_exports__.yo9,__webpackgi_exports__FragmentClippingExtensionPlugin=__webpackgi_exports__.Dzq,__webpackgi_exports__FragmentClippingMode=__webpackgi_exports__.zCA,__webpackgi_exports__FrameFadePlugin=__webpackgi_exports__.$Bt,__webpackgi_exports__FramebufferTexture=__webpackgi_exports__.Wzm,__webpackgi_exports__FrontSide=__webpackgi_exports__.Wl3,__webpackgi_exports__Frustum=__webpackgi_exports__.iWj,__webpackgi_exports__FullScreenPlugin=__webpackgi_exports__.DNz,__webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M,__webpackgi_exports__GLBufferAttribute=__webpackgi_exports__.ylh,__webpackgi_exports__GLSL1=__webpackgi_exports__.v9Y,__webpackgi_exports__GLSL3=__webpackgi_exports__.LSk,__webpackgi_exports__GLTFAnimationPlugin=__webpackgi_exports__.LHE,__webpackgi_exports__GLTFDracoExportPlugin=__webpackgi_exports__.KE0,__webpackgi_exports__GLTFDracoExporter=__webpackgi_exports__.KCF,__webpackgi_exports__GLTFExporter2=__webpackgi_exports__.a4n,__webpackgi_exports__GLTFExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.NKC,__webpackgi_exports__GLTFKHRMaterialVariantsPlugin=__webpackgi_exports__.jrv,__webpackgi_exports__GLTFLoader2=__webpackgi_exports__.zIH,__webpackgi_exports__GLTFMaterialsAlphaMapExtensionName=__webpackgi_exports__.Hfk,__webpackgi_exports__GLTFMaterialsBumpMapExtensionName=__webpackgi_exports__.png,__webpackgi_exports__GLTFMaterialsDisplacementMapExtensionName=__webpackgi_exports__.tAj,__webpackgi_exports__GLTFMaterialsLightMapExtensionName=__webpackgi_exports__.Eb_,__webpackgi_exports__GLTFMaterialsVariantsExtensionImport=__webpackgi_exports__.SJj,__webpackgi_exports__GLTFMeshGpuInstancingExporter=__webpackgi_exports__.cF0,__webpackgi_exports__GLTFMeshOptPlugin=__webpackgi_exports__.BT2,__webpackgi_exports__GLTFWriter2=__webpackgi_exports__._8p,__webpackgi_exports__GammaCorrectionExtension=__webpackgi_exports__.V5Z,__webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b,__webpackgi_exports__GemEnvironmentPresetGroup=__webpackgi_exports__.BHZ,__webpackgi_exports__GenericBlendTexturePass=__webpackgi_exports__.hkn,__webpackgi_exports__GenericFilterPlugin=__webpackgi_exports__.GFY,__webpackgi_exports__GeometryGeneratorPlugin=__webpackgi_exports__.hZr,__webpackgi_exports__GreaterCompare=__webpackgi_exports__.Zen,__webpackgi_exports__GreaterDepth=__webpackgi_exports__.w$m,__webpackgi_exports__GreaterEqualCompare=__webpackgi_exports__.Jjb,__webpackgi_exports__GreaterEqualDepth=__webpackgi_exports__.ksN,__webpackgi_exports__GreaterEqualStencilFunc=__webpackgi_exports__.j4z,__webpackgi_exports__GreaterStencilFunc=__webpackgi_exports__.OAl,__webpackgi_exports__GridHelper=__webpackgi_exports__.VLJ,__webpackgi_exports__GroundPlugin=__webpackgi_exports__.C73,__webpackgi_exports__Group=__webpackgi_exports__.ZAu,__webpackgi_exports__Gunzip=__webpackgi_exports__.ibP,__webpackgi_exports__GyroInputDevice=__webpackgi_exports__.lth,__webpackgi_exports__Gzip=__webpackgi_exports__._fI,__webpackgi_exports__HDRiGroundPlugin=__webpackgi_exports__.hUN,__webpackgi_exports__HalfFloatType=__webpackgi_exports__.cLu,__webpackgi_exports__HemisphereLight=__webpackgi_exports__.vmT,__webpackgi_exports__HemisphereLightHelper=__webpackgi_exports__.Qpg,__webpackgi_exports__HemisphereLightProbe=__webpackgi_exports__.So8,__webpackgi_exports__HierarchyUiPlugin=__webpackgi_exports__.eOv,__webpackgi_exports__IcosahedronBufferGeometry=__webpackgi_exports__.Wjw,__webpackgi_exports__IcosahedronGeometry=__webpackgi_exports__.cJO,__webpackgi_exports__ImageBitmapLoader=__webpackgi_exports__.QRU,__webpackgi_exports__ImageLoader=__webpackgi_exports__.S3k,__webpackgi_exports__ImageSequenceRecorder=__webpackgi_exports__.OPJ,__webpackgi_exports__ImageUtils=__webpackgi_exports__.PpQ,__webpackgi_exports__Importer=__webpackgi_exports__.q_9,__webpackgi_exports__IncrementStencilOp=__webpackgi_exports__.ZRs,__webpackgi_exports__IncrementWrapStencilOp=__webpackgi_exports__.oqc,__webpackgi_exports__Inflate=__webpackgi_exports__.T_x,__webpackgi_exports__InstancedBufferAttribute=__webpackgi_exports__.lb7,__webpackgi_exports__InstancedBufferGeometry=__webpackgi_exports__.L5s,__webpackgi_exports__InstancedInterleavedBuffer=__webpackgi_exports__.$TI,__webpackgi_exports__InstancedMesh=__webpackgi_exports__.SPe,__webpackgi_exports__Int16BufferAttribute=__webpackgi_exports__.aVm,__webpackgi_exports__Int32BufferAttribute=__webpackgi_exports__.j87,__webpackgi_exports__Int8BufferAttribute=__webpackgi_exports__.RNb,__webpackgi_exports__IntType=__webpackgi_exports__.Kz5,__webpackgi_exports__InteractionPromptPlugin=__webpackgi_exports__.LYt,__webpackgi_exports__InterleavedBuffer=__webpackgi_exports__.vpT,__webpackgi_exports__InterleavedBufferAttribute=__webpackgi_exports__.kB5,__webpackgi_exports__Interpolant=__webpackgi_exports__._C8,__webpackgi_exports__InterpolateDiscrete=__webpackgi_exports__.Syv,__webpackgi_exports__InterpolateLinear=__webpackgi_exports__.NMF,__webpackgi_exports__InterpolateSmooth=__webpackgi_exports__.pIN,__webpackgi_exports__InvertStencilOp=__webpackgi_exports__.eMJ,__webpackgi_exports__KHR_TEXTURE_BASISU=__webpackgi_exports__.rN7,__webpackgi_exports__KTX2LoadPlugin=__webpackgi_exports__.iUp,__webpackgi_exports__KTXLoadPlugin=__webpackgi_exports__.GFd,__webpackgi_exports__KeepStencilOp=__webpackgi_exports__.x5V,__webpackgi_exports__KeyframeTrack=__webpackgi_exports__.tUh,__webpackgi_exports__LOD=__webpackgi_exports__.z8B,__webpackgi_exports__LUTPlugin=__webpackgi_exports__.vcl,__webpackgi_exports__LatheBufferGeometry=__webpackgi_exports__.GZb,__webpackgi_exports__LatheGeometry=__webpackgi_exports__.p7y,__webpackgi_exports__LayeredMaterialPlugin=__webpackgi_exports__.e6l,__webpackgi_exports__Layers=__webpackgi_exports__.S9g,__webpackgi_exports__LessCompare=__webpackgi_exports__.D67,__webpackgi_exports__LessDepth=__webpackgi_exports__.Zr5,__webpackgi_exports__LessEqualCompare=__webpackgi_exports__.M$G,__webpackgi_exports__LessEqualDepth=__webpackgi_exports__.vCF,__webpackgi_exports__LessEqualStencilFunc=__webpackgi_exports__.yt0,__webpackgi_exports__LessStencilFunc=__webpackgi_exports__.uXU,__webpackgi_exports__Light=__webpackgi_exports__._kC,__webpackgi_exports__LightProbe=__webpackgi_exports__.lk7,__webpackgi_exports__LightsUiPlugin=__webpackgi_exports__.USc,__webpackgi_exports__Line=__webpackgi_exports__.x12,__webpackgi_exports__Line2=__webpackgi_exports__.w_R,__webpackgi_exports__Line3=__webpackgi_exports__.Zzh,__webpackgi_exports__LineBasicMaterial=__webpackgi_exports__.nls,__webpackgi_exports__LineCurve=__webpackgi_exports__.g_z,__webpackgi_exports__LineCurve3=__webpackgi_exports__.U7,__webpackgi_exports__LineDashedMaterial=__webpackgi_exports__.FT0,__webpackgi_exports__LineGeometry=__webpackgi_exports__.L1_,__webpackgi_exports__LineLoop=__webpackgi_exports__.blk,__webpackgi_exports__LineMaterial=__webpackgi_exports__.YRm,__webpackgi_exports__LineSegments=__webpackgi_exports__.ejS,__webpackgi_exports__LineSegments2=__webpackgi_exports__.wUb,__webpackgi_exports__LineSegmentsGeometry=__webpackgi_exports__.zOz,__webpackgi_exports__LinearEncoding=__webpackgi_exports__.rnI,__webpackgi_exports__LinearFilter=__webpackgi_exports__.wem,__webpackgi_exports__LinearInterpolant=__webpackgi_exports__.lfu,__webpackgi_exports__LinearMipMapLinearFilter=__webpackgi_exports__.FDw,__webpackgi_exports__LinearMipMapNearestFilter=__webpackgi_exports__.lRj,__webpackgi_exports__LinearMipmapLinearFilter=__webpackgi_exports__.D1R,__webpackgi_exports__LinearMipmapNearestFilter=__webpackgi_exports__.qyh,__webpackgi_exports__LinearSRGBColorSpace=__webpackgi_exports__.GUF,__webpackgi_exports__LinearToneMapping=__webpackgi_exports__.EoG,__webpackgi_exports__Loader=__webpackgi_exports__.aNw,__webpackgi_exports__LoaderUtils=__webpackgi_exports__.Zp0,__webpackgi_exports__LoadingManager=__webpackgi_exports__.lLk,__webpackgi_exports__LoadingScreenPlugin=__webpackgi_exports__.NHT,__webpackgi_exports__LoopOnce=__webpackgi_exports__.jAl,__webpackgi_exports__LoopPingPong=__webpackgi_exports__.uEv,__webpackgi_exports__LoopRepeat=__webpackgi_exports__.YKA,__webpackgi_exports__LuminanceAlphaFormat=__webpackgi_exports__.cRx,__webpackgi_exports__LuminanceFormat=__webpackgi_exports__.Y8D,__webpackgi_exports__MOUSE=__webpackgi_exports__.RsA,__webpackgi_exports__MTLLoader2=__webpackgi_exports__.Y0m,__webpackgi_exports__Material=__webpackgi_exports__.F5T,__webpackgi_exports__MaterialConfiguratorBasePlugin=__webpackgi_exports__.EDU,__webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.z$Q,__webpackgi_exports__MaterialExtender=__webpackgi_exports__.KA8,__webpackgi_exports__MaterialLibPresetGroupPresetGroup=__webpackgi_exports__.ZqF,__webpackgi_exports__MaterialLibraryBasePlugin=__webpackgi_exports__.XUj,__webpackgi_exports__MaterialLibraryPlugin=__webpackgi_exports__.Me$,__webpackgi_exports__MaterialLoader=__webpackgi_exports__.u7G,__webpackgi_exports__MaterialManager=__webpackgi_exports__.PEk,__webpackgi_exports__MaterialPreviewGenerator=__webpackgi_exports__.BG4,__webpackgi_exports__MathUtils=__webpackgi_exports__.M8C,__webpackgi_exports__Matrix3=__webpackgi_exports__.Vkp,__webpackgi_exports__Matrix4=__webpackgi_exports__.yGw,__webpackgi_exports__MaxEquation=__webpackgi_exports__.Sm8,__webpackgi_exports__Mesh=__webpackgi_exports__.Kj0,__webpackgi_exports__MeshBasicMaterial=__webpackgi_exports__.vBJ,__webpackgi_exports__MeshBasicMaterial2=__webpackgi_exports__.QfV,__webpackgi_exports__MeshDepthMaterial=__webpackgi_exports__.lRF,__webpackgi_exports__MeshDistanceMaterial=__webpackgi_exports__.Lun,__webpackgi_exports__MeshLambertMaterial=__webpackgi_exports__.YBo,__webpackgi_exports__MeshMatcapMaterial=__webpackgi_exports__.kaV,__webpackgi_exports__MeshNormalMaterial=__webpackgi_exports__.RSm,__webpackgi_exports__MeshOptSimplifyModifierPlugin=__webpackgi_exports__.NDk,__webpackgi_exports__MeshPhongMaterial=__webpackgi_exports__.xoR,__webpackgi_exports__MeshPhysicalMaterial=__webpackgi_exports__.EJi,__webpackgi_exports__MeshStandardMaterial=__webpackgi_exports__.Wid,__webpackgi_exports__MeshStandardMaterial2=__webpackgi_exports__.iuj,__webpackgi_exports__MeshToonMaterial=__webpackgi_exports__.IKL,__webpackgi_exports__MinEquation=__webpackgi_exports__.r_,__webpackgi_exports__MirroredRepeatWrapping=__webpackgi_exports__.OoA,__webpackgi_exports__MixOperation=__webpackgi_exports__.qhX,__webpackgi_exports__MouseInputDevice=__webpackgi_exports__.CRe,__webpackgi_exports__MultiFilterPlugin=__webpackgi_exports__.qPT,__webpackgi_exports__MultiplyBlending=__webpackgi_exports__.M5h,__webpackgi_exports__MultiplyOperation=__webpackgi_exports__.Ns1,__webpackgi_exports__NearestFilter=__webpackgi_exports__.TyD,__webpackgi_exports__NearestMipMapLinearFilter=__webpackgi_exports__.vZf,__webpackgi_exports__NearestMipMapNearestFilter=__webpackgi_exports__.HTd,__webpackgi_exports__NearestMipmapLinearFilter=__webpackgi_exports__.aH4,__webpackgi_exports__NearestMipmapNearestFilter=__webpackgi_exports__.YLQ,__webpackgi_exports__NeverCompare=__webpackgi_exports__.xoQ,__webpackgi_exports__NeverDepth=__webpackgi_exports__.BVF,__webpackgi_exports__NeverStencilFunc=__webpackgi_exports__.MyG,__webpackgi_exports__NoBlending=__webpackgi_exports__.jFi,__webpackgi_exports__NoColorSpace=__webpackgi_exports__.aCh,__webpackgi_exports__NoToneMapping=__webpackgi_exports__.uL9,__webpackgi_exports__NoiseBumpMaterialPlugin=__webpackgi_exports__.TNj,__webpackgi_exports__NormalAnimationBlendMode=__webpackgi_exports__.IFH,__webpackgi_exports__NormalBlending=__webpackgi_exports__.bdR,__webpackgi_exports__NormalBufferPlugin=__webpackgi_exports__.RPs,__webpackgi_exports__NormalCaptureMaterial=__webpackgi_exports__.kM_,__webpackgi_exports__NotEqualCompare=__webpackgi_exports__.O78,__webpackgi_exports__NotEqualDepth=__webpackgi_exports__.M6v,__webpackgi_exports__NotEqualStencilFunc=__webpackgi_exports__.RvT,__webpackgi_exports__NumberKeyframeTrack=__webpackgi_exports__.dUE,__webpackgi_exports__OBJLoader2=__webpackgi_exports__.oe_,__webpackgi_exports__ObjMtlLoadPlugin=__webpackgi_exports__.BuN,__webpackgi_exports__Object3D=__webpackgi_exports__.Tme,__webpackgi_exports__Object3DModel=__webpackgi_exports__.N9P,__webpackgi_exports__Object3DWidgetsPlugin=__webpackgi_exports__.tfP,__webpackgi_exports__ObjectLoader=__webpackgi_exports__.Gql,__webpackgi_exports__ObjectLoader2=__webpackgi_exports__.$XY,__webpackgi_exports__ObjectPicker=__webpackgi_exports__.O9d,__webpackgi_exports__ObjectProcessorMap=__webpackgi_exports__.zEO,__webpackgi_exports__ObjectRotationPlugin=__webpackgi_exports__.qfx,__webpackgi_exports__ObjectSpaceNormalMap=__webpackgi_exports__.PA7,__webpackgi_exports__OctahedronBufferGeometry=__webpackgi_exports__.REq,__webpackgi_exports__OctahedronGeometry=__webpackgi_exports__.pQR,__webpackgi_exports__OneFactor=__webpackgi_exports__.ghN,__webpackgi_exports__OneMinusDstAlphaFactor=__webpackgi_exports__.Hy8,__webpackgi_exports__OneMinusDstColorFactor=__webpackgi_exports__.Wpd,__webpackgi_exports__OneMinusSrcAlphaFactor=__webpackgi_exports__.LgZ,__webpackgi_exports__OneMinusSrcColorFactor=__webpackgi_exports__.iWC,__webpackgi_exports__OrbitControls2=__webpackgi_exports__.mqn,__webpackgi_exports__OrbitControls3=__webpackgi_exports__.SKe,__webpackgi_exports__OrthographicCamera=__webpackgi_exports__.iKG,__webpackgi_exports__OutlinePlugin=__webpackgi_exports__.rCq,__webpackgi_exports__PCFShadowMap=__webpackgi_exports__._iA,__webpackgi_exports__PCFSoftShadowMap=__webpackgi_exports__.ntZ,__webpackgi_exports__PMREMGenerator=__webpackgi_exports__.anP,__webpackgi_exports__PMREMGeneratorPlugin=__webpackgi_exports__.X2e,__webpackgi_exports__ParallaxCameraControllerPlugin=__webpackgi_exports__.oxT,__webpackgi_exports__ParallaxMappingPlugin=__webpackgi_exports__.FCo,__webpackgi_exports__Path=__webpackgi_exports__.y$t,__webpackgi_exports__PerspectiveCamera=__webpackgi_exports__.cPb,__webpackgi_exports__PickingPlugin=__webpackgi_exports__.lmx,__webpackgi_exports__Plane=__webpackgi_exports__.JOQ,__webpackgi_exports__PlaneBufferGeometry=__webpackgi_exports__.BKK,__webpackgi_exports__PlaneGeometry=__webpackgi_exports__._12,__webpackgi_exports__PlaneHelper=__webpackgi_exports__.tJx,__webpackgi_exports__PluginPresetGroup=__webpackgi_exports__.mjX,__webpackgi_exports__PointLight=__webpackgi_exports__.cek,__webpackgi_exports__PointLight2=__webpackgi_exports__.qD0,__webpackgi_exports__PointLightHelper=__webpackgi_exports__.xG9,__webpackgi_exports__PointerDragHelper=__webpackgi_exports__.eqi,__webpackgi_exports__PointerLockControls2=__webpackgi_exports__.wI8,__webpackgi_exports__PointerLockControlsPlugin=__webpackgi_exports__.Sgv,__webpackgi_exports__Points=__webpackgi_exports__.woe,__webpackgi_exports__PointsMaterial=__webpackgi_exports__.UY4,__webpackgi_exports__PolarGridHelper=__webpackgi_exports__.aq0,__webpackgi_exports__PolyhedronBufferGeometry=__webpackgi_exports__.ujx,__webpackgi_exports__PolyhedronGeometry=__webpackgi_exports__.Uol,__webpackgi_exports__PopmotionPlugin=__webpackgi_exports__.JiH,__webpackgi_exports__PositionalAudio=__webpackgi_exports__.VYz,__webpackgi_exports__PresetGroup=__webpackgi_exports__.B2H,__webpackgi_exports__PresetLibraryPlugin=__webpackgi_exports__._Pm,__webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW,__webpackgi_exports__PropertyBinding=__webpackgi_exports__.iUV,__webpackgi_exports__PropertyMixer=__webpackgi_exports__.tf,__webpackgi_exports__QuadraticBezierCurve=__webpackgi_exports__.ZQ6,__webpackgi_exports__QuadraticBezierCurve3=__webpackgi_exports__.mXe,__webpackgi_exports__Quaternion=__webpackgi_exports__._fP,__webpackgi_exports__QuaternionKeyframeTrack=__webpackgi_exports__.iLg,__webpackgi_exports__QuaternionLinearInterpolant=__webpackgi_exports__.zbs,__webpackgi_exports__RED_GREEN_RGTC2_Format=__webpackgi_exports__.ZTh,__webpackgi_exports__RED_RGTC1_Format=__webpackgi_exports__.HdW,__webpackgi_exports__REVISION=__webpackgi_exports__.UZH,__webpackgi_exports__RGBADepthPacking=__webpackgi_exports__.mSO,__webpackgi_exports__RGBAFormat=__webpackgi_exports__.wk1,__webpackgi_exports__RGBAIntegerFormat=__webpackgi_exports__.E2K,__webpackgi_exports__RGBA_ASTC_10x10_Format=__webpackgi_exports__.FUD,__webpackgi_exports__RGBA_ASTC_10x5_Format=__webpackgi_exports__.pKu,__webpackgi_exports__RGBA_ASTC_10x6_Format=__webpackgi_exports__.GG6,__webpackgi_exports__RGBA_ASTC_10x8_Format=__webpackgi_exports__.Gih,__webpackgi_exports__RGBA_ASTC_12x10_Format=__webpackgi_exports__.iiP,__webpackgi_exports__RGBA_ASTC_12x12_Format=__webpackgi_exports__.SvJ,__webpackgi_exports__RGBA_ASTC_4x4_Format=__webpackgi_exports__.ptH,__webpackgi_exports__RGBA_ASTC_5x4_Format=__webpackgi_exports__.jZA,__webpackgi_exports__RGBA_ASTC_5x5_Format=__webpackgi_exports__.y2t,__webpackgi_exports__RGBA_ASTC_6x5_Format=__webpackgi_exports__.gi4,__webpackgi_exports__RGBA_ASTC_6x6_Format=__webpackgi_exports__.Djp,__webpackgi_exports__RGBA_ASTC_8x5_Format=__webpackgi_exports__.BG$,__webpackgi_exports__RGBA_ASTC_8x6_Format=__webpackgi_exports__.NYV,__webpackgi_exports__RGBA_ASTC_8x8_Format=__webpackgi_exports__.xJs,__webpackgi_exports__RGBA_BPTC_Format=__webpackgi_exports__.bsb,__webpackgi_exports__RGBA_ETC2_EAC_Format=__webpackgi_exports__.ekQ,__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format=__webpackgi_exports__.CaW,__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format=__webpackgi_exports__.eaV,__webpackgi_exports__RGBA_S3TC_DXT1_Format=__webpackgi_exports__.BFQ,__webpackgi_exports__RGBA_S3TC_DXT3_Format=__webpackgi_exports__.v3W,__webpackgi_exports__RGBA_S3TC_DXT5_Format=__webpackgi_exports__.ILR,__webpackgi_exports__RGBM16ColorSpace=__webpackgi_exports__.G_r,__webpackgi_exports__RGBM16ColorSpace_=__webpackgi_exports__.N3F,__webpackgi_exports__RGB_ETC1_Format=__webpackgi_exports__.fto,__webpackgi_exports__RGB_ETC2_Format=__webpackgi_exports__.l0P,__webpackgi_exports__RGB_PVRTC_2BPPV1_Format=__webpackgi_exports__.vCx,__webpackgi_exports__RGB_PVRTC_4BPPV1_Format=__webpackgi_exports__._AM,__webpackgi_exports__RGB_S3TC_DXT1_Format=__webpackgi_exports__.wuA,__webpackgi_exports__RGFormat=__webpackgi_exports__.av9,__webpackgi_exports__RGIntegerFormat=__webpackgi_exports__.CtA,__webpackgi_exports__RainbowDiamondPlugin=__webpackgi_exports__.fpq,__webpackgi_exports__RandomizedDirectionalLight=__webpackgi_exports__.BvQ,__webpackgi_exports__RandomizedDirectionalLightPlugin=__webpackgi_exports__.FZJ,__webpackgi_exports__RawShaderMaterial=__webpackgi_exports__.FIo,__webpackgi_exports__Ray=__webpackgi_exports__.zHn,__webpackgi_exports__Raycaster=__webpackgi_exports__.iMs,__webpackgi_exports__RectAreaLight=__webpackgi_exports__.T_f,__webpackgi_exports__RedFormat=__webpackgi_exports__.hEm,__webpackgi_exports__RedIntegerFormat=__webpackgi_exports__.D9w,__webpackgi_exports__Reflector2=__webpackgi_exports__.sHH,__webpackgi_exports__ReinhardToneMapping=__webpackgi_exports__.CdI,__webpackgi_exports__RendererUiPlugin=__webpackgi_exports__.rkc,__webpackgi_exports__RepeatWrapping=__webpackgi_exports__.rpg,__webpackgi_exports__ReplaceStencilOp=__webpackgi_exports__.ce8,__webpackgi_exports__ReverseSubtractEquation=__webpackgi_exports__.rOj,__webpackgi_exports__Rhino3dmLoadPlugin=__webpackgi_exports__.P6m,__webpackgi_exports__Rhino3dmLoader2=__webpackgi_exports__.JA6,__webpackgi_exports__RingBufferGeometry=__webpackgi_exports__.V4E,__webpackgi_exports__RingGeometry=__webpackgi_exports__.o8S,__webpackgi_exports__RootScene=__webpackgi_exports__.flB,__webpackgi_exports__SIGNED_RED_GREEN_RGTC2_Format=__webpackgi_exports__.lGU,__webpackgi_exports__SIGNED_RED_RGTC1_Format=__webpackgi_exports__.vuL,__webpackgi_exports__SRGBColorSpace=__webpackgi_exports__.KI_,__webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN,__webpackgi_exports__SSBevelPass=__webpackgi_exports__.X6w,__webpackgi_exports__SSBevelPlugin=__webpackgi_exports__.rz_,__webpackgi_exports__SSContactShadows=__webpackgi_exports__.jsw,__webpackgi_exports__SSGIPlugin=__webpackgi_exports__.srG,__webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z,__webpackgi_exports__STLLoadPlugin=__webpackgi_exports__.vfv,__webpackgi_exports__Scene=__webpackgi_exports__.xsS,__webpackgi_exports__SceneCamerasUiPlugin=__webpackgi_exports__.or,__webpackgi_exports__SceneLoopPlugin=__webpackgi_exports__.EQj,__webpackgi_exports__ScrollableCameraViewPlugin=__webpackgi_exports__.Rnn,__webpackgi_exports__ScrollableCameraViewPreviewPlugin=__webpackgi_exports__.TyN,__webpackgi_exports__SelectionWidget=__webpackgi_exports__.ov0,__webpackgi_exports__ShaderChunk=__webpackgi_exports__.WdD,__webpackgi_exports__ShaderLib=__webpackgi_exports__.Vj0,__webpackgi_exports__ShaderMaterial=__webpackgi_exports__.jyz,__webpackgi_exports__ShaderMaterial2=__webpackgi_exports__.mTM,__webpackgi_exports__ShaderMaterialEncodingSupport=__webpackgi_exports__.Mn1,__webpackgi_exports__ShaderPass2=__webpackgi_exports__.Hlq,__webpackgi_exports__ShadowMapBaker=__webpackgi_exports__.Fi7,__webpackgi_exports__ShadowMaterial=__webpackgi_exports__.Tn7,__webpackgi_exports__Shape=__webpackgi_exports__.bnF,__webpackgi_exports__ShapeBufferGeometry=__webpackgi_exports__.HW6,__webpackgi_exports__ShapeGeometry=__webpackgi_exports__.oa8,__webpackgi_exports__ShapePath=__webpackgi_exports__.T_1,__webpackgi_exports__ShapeTubeExtrudePlugin=__webpackgi_exports__.zHJ,__webpackgi_exports__ShapeUtils=__webpackgi_exports__.iDF,__webpackgi_exports__ShortType=__webpackgi_exports__.iAb,__webpackgi_exports__SimpleAssetList=__webpackgi_exports__.d4E,__webpackgi_exports__SimpleBackgroundEnvUiPlugin=__webpackgi_exports__.lBg,__webpackgi_exports__SimpleDataSource=__webpackgi_exports__.JeJ,__webpackgi_exports__SimpleEventDispatcher=__webpackgi_exports__.FKY,__webpackgi_exports__SimpleJSONExporter=__webpackgi_exports__.zlZ,__webpackgi_exports__SimpleJSONLoader=__webpackgi_exports__.vkg,__webpackgi_exports__SimpleTextExporter=__webpackgi_exports__.brh,__webpackgi_exports__SimpleTextPlugin=__webpackgi_exports__.kZK,__webpackgi_exports__SimpleViewerUi=__webpackgi_exports__.puG,__webpackgi_exports__SimplifyModifierPlugin=__webpackgi_exports__.VJK,__webpackgi_exports__Skeleton=__webpackgi_exports__.OdW,__webpackgi_exports__SkeletonHelper=__webpackgi_exports__._YX,__webpackgi_exports__SkinnedMesh=__webpackgi_exports__.TUv,__webpackgi_exports__Source=__webpackgi_exports__.Hw6,__webpackgi_exports__Sphere=__webpackgi_exports__.aLr,__webpackgi_exports__SphereBufferGeometry=__webpackgi_exports__.Aip,__webpackgi_exports__SphereGeometry=__webpackgi_exports__.xo$,__webpackgi_exports__SphereSelectionWidget=__webpackgi_exports__.bIn,__webpackgi_exports__Spherical=__webpackgi_exports__.$V,__webpackgi_exports__SphericalHarmonics3=__webpackgi_exports__.lDi,__webpackgi_exports__SplineCurve=__webpackgi_exports__.gti,__webpackgi_exports__SpotLight=__webpackgi_exports__.PMe,__webpackgi_exports__SpotLight2=__webpackgi_exports__.iwP,__webpackgi_exports__SpotLightHelper=__webpackgi_exports__.FvO,__webpackgi_exports__Sprite=__webpackgi_exports__.jyi,__webpackgi_exports__SpriteMaterial=__webpackgi_exports__.xeV,__webpackgi_exports__SrcAlphaFactor=__webpackgi_exports__.k74,__webpackgi_exports__SrcAlphaSaturateFactor=__webpackgi_exports__.RlZ,__webpackgi_exports__SrcColorFactor=__webpackgi_exports__.KhW,__webpackgi_exports__StaticCopyUsage=__webpackgi_exports__.HgB,__webpackgi_exports__StaticDrawUsage=__webpackgi_exports__.W2J,__webpackgi_exports__StaticReadUsage=__webpackgi_exports__.JWc,__webpackgi_exports__StereoCamera=__webpackgi_exports__.u37,__webpackgi_exports__StreamCopyUsage=__webpackgi_exports__.Z6B,__webpackgi_exports__StreamDrawUsage=__webpackgi_exports__.QZ1,__webpackgi_exports__StreamReadUsage=__webpackgi_exports__.Ir4,__webpackgi_exports__StringKeyframeTrack=__webpackgi_exports__.NwF,__webpackgi_exports__SubtractEquation=__webpackgi_exports__.Wbm,__webpackgi_exports__SubtractiveBlending=__webpackgi_exports__.N4l,__webpackgi_exports__SwitchNodeBasePlugin=__webpackgi_exports__.Jxm,__webpackgi_exports__SwitchNodePlugin=__webpackgi_exports__.ej9,__webpackgi_exports__TOUCH=__webpackgi_exports__.QmN,__webpackgi_exports__TYPED_ARRAYS=__webpackgi_exports__.Y4W,__webpackgi_exports__TangentSpaceNormalMap=__webpackgi_exports__.IOt,__webpackgi_exports__TemporalAAPlugin=__webpackgi_exports__.NOD,__webpackgi_exports__TetrahedronBufferGeometry=__webpackgi_exports__.L5g,__webpackgi_exports__TetrahedronGeometry=__webpackgi_exports__.H$k,__webpackgi_exports__TextSVGOptions=__webpackgi_exports__.cuP,__webpackgi_exports__Texture=__webpackgi_exports__.xEZ,__webpackgi_exports__TextureLoader=__webpackgi_exports__.dpR,__webpackgi_exports__ThinFilmLayerPlugin=__webpackgi_exports__.wOD,__webpackgi_exports__ThreeMaterialLoader=__webpackgi_exports__.KNb,__webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN,__webpackgi_exports__TorusBufferGeometry=__webpackgi_exports__.Cne,__webpackgi_exports__TorusGeometry=__webpackgi_exports__.XvJ,__webpackgi_exports__TorusKnotBufferGeometry=__webpackgi_exports__.XZw,__webpackgi_exports__TorusKnotGeometry=__webpackgi_exports__.FE5,__webpackgi_exports__TrackballControlsPlugin=__webpackgi_exports__.lUF,__webpackgi_exports__TransformAnimationPlugin=__webpackgi_exports__.Mck,__webpackgi_exports__TransformControls2=__webpackgi_exports__.lVp,__webpackgi_exports__TransfrSharePlugin=__webpackgi_exports__.Lpo,__webpackgi_exports__Triangle=__webpackgi_exports__.CJI,__webpackgi_exports__TriangleFanDrawMode=__webpackgi_exports__.z$h,__webpackgi_exports__TriangleStripDrawMode=__webpackgi_exports__.UlW,__webpackgi_exports__TrianglesDrawMode=__webpackgi_exports__.WwZ,__webpackgi_exports__TriplanarUVMappingPlugin=__webpackgi_exports__.zG7,__webpackgi_exports__TubeBufferGeometry=__webpackgi_exports__.Lcc,__webpackgi_exports__TubeGeometry=__webpackgi_exports__.WXh,__webpackgi_exports__TubeShapeGeometry=__webpackgi_exports__.Vjr,__webpackgi_exports__TweakpaneUiPlugin=__webpackgi_exports__.LuM,__webpackgi_exports__TweakpaneWrapper=__webpackgi_exports__.LP5,__webpackgi_exports__TwoPassDoubleSide=__webpackgi_exports__.ub3,__webpackgi_exports__UChartOptions=__webpackgi_exports__.OV,__webpackgi_exports__UPackOptions=__webpackgi_exports__.G_n,__webpackgi_exports__UVMapping=__webpackgi_exports__.xfE,__webpackgi_exports__Uint16BufferAttribute=__webpackgi_exports__.qlB,__webpackgi_exports__Uint32BufferAttribute=__webpackgi_exports__.lCJ,__webpackgi_exports__Uint8BufferAttribute=__webpackgi_exports__.WTc,__webpackgi_exports__Uint8ClampedBufferAttribute=__webpackgi_exports__.rAo,__webpackgi_exports__Uncharted2Tonemapping=__webpackgi_exports__.LZj,__webpackgi_exports__Uniform=__webpackgi_exports__.xWb,__webpackgi_exports__UniformsGroup=__webpackgi_exports__.gH0,__webpackgi_exports__UniformsLib=__webpackgi_exports__.rBU,__webpackgi_exports__UniformsUtils=__webpackgi_exports__.rDY,__webpackgi_exports__UnsignedByteType=__webpackgi_exports__.ywz,__webpackgi_exports__UnsignedInt248Type=__webpackgi_exports__.wJv,__webpackgi_exports__UnsignedIntType=__webpackgi_exports__.JQ4,__webpackgi_exports__UnsignedShort4444Type=__webpackgi_exports__.k0A,__webpackgi_exports__UnsignedShort5551Type=__webpackgi_exports__.irR,__webpackgi_exports__UnsignedShortType=__webpackgi_exports__.LsT,__webpackgi_exports__Unzip=__webpackgi_exports__.q5h,__webpackgi_exports__UnzipInflate=__webpackgi_exports__.TKh,__webpackgi_exports__UnzipPassThrough=__webpackgi_exports__.tyg,__webpackgi_exports__Unzlib=__webpackgi_exports__.Ro5,__webpackgi_exports__VJSONPresetGroup=__webpackgi_exports__.Saj,__webpackgi_exports__VRPluginBasic=__webpackgi_exports__.CHp,__webpackgi_exports__VSMShadowMap=__webpackgi_exports__.dwk,__webpackgi_exports__VariationConfiguratorEditorUiPlugin=__webpackgi_exports__.t0w,__webpackgi_exports__VariationConfiguratorGridUiPlugin=__webpackgi_exports__.M7$,__webpackgi_exports__VariationConfiguratorPlugin=__webpackgi_exports__.ML4,__webpackgi_exports__Vector2=__webpackgi_exports__.FM8,__webpackgi_exports__Vector3=__webpackgi_exports__.Pa4,__webpackgi_exports__Vector4=__webpackgi_exports__.Ltg,__webpackgi_exports__VectorKeyframeTrack=__webpackgi_exports__.yC1,__webpackgi_exports__VelocityBufferPlugin=__webpackgi_exports__.lHq,__webpackgi_exports__VideoTexture=__webpackgi_exports__.fO1,__webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA,__webpackgi_exports__ViewerState=__webpackgi_exports__.JzW,__webpackgi_exports__VignettePlugin=__webpackgi_exports__.QEt,__webpackgi_exports__VirtualCamerasPlugin=__webpackgi_exports__.IFZ,__webpackgi_exports__WebGL1Renderer=__webpackgi_exports__.b5g,__webpackgi_exports__WebGL3DRenderTarget=__webpackgi_exports__.Ywn,__webpackgi_exports__WebGLArrayRenderTarget=__webpackgi_exports__.GVz,__webpackgi_exports__WebGLCoordinateSystem=__webpackgi_exports__._RZ,__webpackgi_exports__WebGLCubeRenderTarget=__webpackgi_exports__.oAp,__webpackgi_exports__WebGLMultipleRenderTargets=__webpackgi_exports__.kFz,__webpackgi_exports__WebGLRenderTarget=__webpackgi_exports__.dd2,__webpackgi_exports__WebGLRenderer=__webpackgi_exports__.CP7,__webpackgi_exports__WebGLUtils=__webpackgi_exports__.fQK,__webpackgi_exports__WebGPUCoordinateSystem=__webpackgi_exports__.JCZ,__webpackgi_exports__WebGiViewerElement=__webpackgi_exports__.Wd$,__webpackgi_exports__WindowiseDialogPlugin=__webpackgi_exports__.t1_,__webpackgi_exports__Wireframe=__webpackgi_exports__.v27,__webpackgi_exports__WireframeGeometry=__webpackgi_exports__.Uk6,__webpackgi_exports__WireframeGeometry2=__webpackgi_exports__.H7Z,__webpackgi_exports__WrapAroundEnding=__webpackgi_exports__._sL,__webpackgi_exports__XAtlasPlugin=__webpackgi_exports__.czO,__webpackgi_exports__ZeroCurvatureEnding=__webpackgi_exports__.Pnf,__webpackgi_exports__ZeroFactor=__webpackgi_exports__.c8b,__webpackgi_exports__ZeroSlopeEnding=__webpackgi_exports__._lf,__webpackgi_exports__ZeroStencilOp=__webpackgi_exports__.ad5,__webpackgi_exports__Zip=__webpackgi_exports__.sZV,__webpackgi_exports__ZipDeflate=__webpackgi_exports__.TfA,__webpackgi_exports__ZipLoader=__webpackgi_exports__.sKX,__webpackgi_exports__ZipPassThrough=__webpackgi_exports__.UdM,__webpackgi_exports__Zlib=__webpackgi_exports__.P0y,__webpackgi_exports___SRGBAFormat=__webpackgi_exports__.L_r,__webpackgi_exports__absMax=__webpackgi_exports__.zC5,__webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve,__webpackgi_exports__addBloomData=__webpackgi_exports__.b5G,__webpackgi_exports__addDracoLoader=__webpackgi_exports__.UeO,__webpackgi_exports__addEditorPlugins=__webpackgi_exports__.qCx,__webpackgi_exports__addGLTFExporter=__webpackgi_exports__.$nx,__webpackgi_exports__addGLTFLoader=__webpackgi_exports__.Bk6,__webpackgi_exports__addLUTData=__webpackgi_exports__.EER,__webpackgi_exports__addRGBELoader=__webpackgi_exports__.y4l,__webpackgi_exports__addSSBevel=__webpackgi_exports__.P39,__webpackgi_exports__aesGcmDecrypt=__webpackgi_exports__.HI1,__webpackgi_exports__aesGcmEncrypt=__webpackgi_exports__.ZYi,__webpackgi_exports__afterMain=__webpackgi_exports__.wXW,__webpackgi_exports__afterRead=__webpackgi_exports__.r5x,__webpackgi_exports__afterWrite=__webpackgi_exports__.MSI,__webpackgi_exports__angle=__webpackgi_exports__.EUu,__webpackgi_exports__animate=__webpackgi_exports__.jtH,__webpackgi_exports__animateAsync=__webpackgi_exports__.T0T,__webpackgi_exports__animateObject=__webpackgi_exports__.gAb,__webpackgi_exports__animateSet=__webpackgi_exports__.je_,__webpackgi_exports__animateTarget=__webpackgi_exports__.wBP,__webpackgi_exports__anticipate=__webpackgi_exports__.LU2,__webpackgi_exports__applyOffset=__webpackgi_exports__.wQL,__webpackgi_exports__applyStyles=__webpackgi_exports__.Zs7,__webpackgi_exports__arrayBufferToBase64=__webpackgi_exports__.sMc,__webpackgi_exports__arrow=__webpackgi_exports__.x7s,__webpackgi_exports__attract=__webpackgi_exports__.Mnd,__webpackgi_exports__attractExpo=__webpackgi_exports__.A0_,__webpackgi_exports__auto=__webpackgi_exports__.d73,__webpackgi_exports__autoCenterObject3D=__webpackgi_exports__.HCD,__webpackgi_exports__autoGPUInstanceMeshes=__webpackgi_exports__.YQ8,__webpackgi_exports__autoScaleObject3D=__webpackgi_exports__.RG9,__webpackgi_exports__backIn=__webpackgi_exports__.G2P,__webpackgi_exports__backInOut=__webpackgi_exports__.XLf,__webpackgi_exports__backOut=__webpackgi_exports__.CGN,__webpackgi_exports__base64ToArrayBuffer=__webpackgi_exports__.RGi,__webpackgi_exports__basePlacements=__webpackgi_exports__.mvg,__webpackgi_exports__basicMaterialPropList=__webpackgi_exports__.Hiy,__webpackgi_exports__beforeMain=__webpackgi_exports__.XMc,__webpackgi_exports__beforeRead=__webpackgi_exports__.N7M,__webpackgi_exports__beforeWrite=__webpackgi_exports__.iv,__webpackgi_exports__blobToDataURL=__webpackgi_exports__.n55,__webpackgi_exports__bottom=__webpackgi_exports__.IaC,__webpackgi_exports__bounceIn=__webpackgi_exports__.h9t,__webpackgi_exports__bounceInOut=__webpackgi_exports__.yDW,__webpackgi_exports__bounceOut=__webpackgi_exports__.gJv,__webpackgi_exports__buildCSGMeshBSP=__webpackgi_exports__.l$g,__webpackgi_exports__buildCSGMeshBVH=__webpackgi_exports__.vQi,__webpackgi_exports__cLinearToRGBM=__webpackgi_exports__.$MY,__webpackgi_exports__cRGBMToLinear=__webpackgi_exports__.wJl,__webpackgi_exports__circIn=__webpackgi_exports__.Z7Y,__webpackgi_exports__circInOut=__webpackgi_exports__.X7D,__webpackgi_exports__circOut=__webpackgi_exports__.BnX,__webpackgi_exports__clamp=__webpackgi_exports__.uZ5,__webpackgi_exports__clippingParents=__webpackgi_exports__.zVI,__webpackgi_exports__colorToDataUrl=__webpackgi_exports__.Wz1,__webpackgi_exports__combineDofShader=__webpackgi_exports__.DpF,__webpackgi_exports__compress=__webpackgi_exports__.nNb,__webpackgi_exports__compressSync=__webpackgi_exports__.cqZ,__webpackgi_exports__computeAverageGeometryNormal=__webpackgi_exports__.pKN,__webpackgi_exports__computeEigenVectors=__webpackgi_exports__.CN8,__webpackgi_exports__computeGeometryCenter=__webpackgi_exports__.DdI,__webpackgi_exports__computeGeometrySize=__webpackgi_exports__.rrX,__webpackgi_exports__computeMikkTSpaceTangents=__webpackgi_exports__.uqj,__webpackgi_exports__computeMorphedAttributes=__webpackgi_exports__.Z9P,__webpackgi_exports__computeOffsetMatrix=__webpackgi_exports__.KlC,__webpackgi_exports__computeScreenSpaceBoundingBox=__webpackgi_exports__.KVn,__webpackgi_exports__computeStyles=__webpackgi_exports__.oau,__webpackgi_exports__copyMaterialUserData=__webpackgi_exports__.aw9,__webpackgi_exports__copyObject3DUserData=__webpackgi_exports__.Aap,__webpackgi_exports__copyProps=__webpackgi_exports__.Dxg,__webpackgi_exports__copyTextureUserData=__webpackgi_exports__.MjT,__webpackgi_exports__createAnticipate=__webpackgi_exports__.F7Q,__webpackgi_exports__createAttractor=__webpackgi_exports__.IFq,__webpackgi_exports__createBackIn=__webpackgi_exports__.IJl,__webpackgi_exports__createCanvasElement=__webpackgi_exports__.O5A,__webpackgi_exports__createDiv=__webpackgi_exports__.wCn,__webpackgi_exports__createExpoIn=__webpackgi_exports__.gGT,__webpackgi_exports__createGenericExtensionClass=__webpackgi_exports__.hqj,__webpackgi_exports__createIFrameCSS3DObject=__webpackgi_exports__.pEc,__webpackgi_exports__createImage=__webpackgi_exports__.Bi6,__webpackgi_exports__createPopper=__webpackgi_exports__.fi_,__webpackgi_exports__createPopperBase=__webpackgi_exports__.TT,__webpackgi_exports__createPopperLite=__webpackgi_exports__.q2Z,__webpackgi_exports__createRenderTargetKey=__webpackgi_exports__.NyK,__webpackgi_exports__createScriptFromURL=__webpackgi_exports__.bgu,__webpackgi_exports__createStyles=__webpackgi_exports__.kcS,__webpackgi_exports__csgOperations=__webpackgi_exports__.rRN,__webpackgi_exports__css=__webpackgi_exports__.ivY,__webpackgi_exports__cubicBezier=__webpackgi_exports__._s1,__webpackgi_exports__dataTextureFromColor=__webpackgi_exports__._HO,__webpackgi_exports__dataTextureFromVec4=__webpackgi_exports__.tpL,__webpackgi_exports__decay=__webpackgi_exports__.DMK,__webpackgi_exports__decompress=__webpackgi_exports__.LjN,__webpackgi_exports__decompressSync=__webpackgi_exports__.iFs,__webpackgi_exports__deepAccessObject=__webpackgi_exports__.qTg,__webpackgi_exports__deepCloneAttribute=__webpackgi_exports__.J4G,__webpackgi_exports__defaultPresets=__webpackgi_exports__.Zj8,__webpackgi_exports__deflate=__webpackgi_exports__.Wtl,__webpackgi_exports__deflateSync=__webpackgi_exports__.DmK,__webpackgi_exports__degreesToRadians=__webpackgi_exports__.Htt,__webpackgi_exports__deinterleaveAttribute=__webpackgi_exports__.Nv0,__webpackgi_exports__deinterleaveGeometry=__webpackgi_exports__.tCp,__webpackgi_exports__deserializeObject=__webpackgi_exports__.Hx7,__webpackgi_exports__deserializers=__webpackgi_exports__.imt,__webpackgi_exports__detectOverflow=__webpackgi_exports__.US6,__webpackgi_exports__diamondMaterialPropList=__webpackgi_exports__.vZs,__webpackgi_exports__distance=__webpackgi_exports__.TE$,__webpackgi_exports__downloadBlob=__webpackgi_exports__.lmu,__webpackgi_exports__downloadFile=__webpackgi_exports__.SvO,__webpackgi_exports__easeIn=__webpackgi_exports__.YQY,__webpackgi_exports__easeInOut=__webpackgi_exports__.mZN,__webpackgi_exports__easeOut=__webpackgi_exports__.VvG,__webpackgi_exports__embedUrlRefs=__webpackgi_exports__.omp,__webpackgi_exports__end=__webpackgi_exports__.utz,__webpackgi_exports__envMapBackground=__webpackgi_exports__.TFV,__webpackgi_exports__escapeRegExp=__webpackgi_exports__.hrz,__webpackgi_exports__estimateBytesUsed=__webpackgi_exports__.H$s,__webpackgi_exports__eventListeners=__webpackgi_exports__.JKM,__webpackgi_exports__extractAnimationKey=__webpackgi_exports__.jZf,__webpackgi_exports__flattenUiConfig=__webpackgi_exports__.RjL,__webpackgi_exports__flip=__webpackgi_exports__.RRI,__webpackgi_exports__fontFormatExtensionMap=__webpackgi_exports__.RUq,__webpackgi_exports__generateUiConfig=__webpackgi_exports__._t4,__webpackgi_exports__generateUiFolder=__webpackgi_exports__.YHh,__webpackgi_exports__getEncodingComponents=__webpackgi_exports__.R8g,__webpackgi_exports__getFileHandle=__webpackgi_exports__.f1L,__webpackgi_exports__getFilenameFromPath=__webpackgi_exports__.Bbl,__webpackgi_exports__getKeyByValue=__webpackgi_exports__.V9r,__webpackgi_exports__getNewFileHandle=__webpackgi_exports__.a95,__webpackgi_exports__getOrCall=__webpackgi_exports__.PZ2,__webpackgi_exports__getPropertyDescriptor=__webpackgi_exports__.w7A,__webpackgi_exports__getTexelDecoding=__webpackgi_exports__.N6S,__webpackgi_exports__getTexelDecoding2=__webpackgi_exports__.Uxp,__webpackgi_exports__getTexelDecodingFunction=__webpackgi_exports__.tAz,__webpackgi_exports__getTexelEncoding=__webpackgi_exports__.R$F,__webpackgi_exports__getTexelEncodingFunction=__webpackgi_exports__.N33,__webpackgi_exports__getTextureColorSpaceFromMap=__webpackgi_exports__.JFD,__webpackgi_exports__getTextureDataType=__webpackgi_exports__.gw2,__webpackgi_exports__getTypedArray=__webpackgi_exports__.rfc,__webpackgi_exports__getUrlQueryParam=__webpackgi_exports__.wo6,__webpackgi_exports__glbEncryptionPreparser=__webpackgi_exports__.V4T,__webpackgi_exports__glsl=__webpackgi_exports__.H4P,__webpackgi_exports__gltfExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.NLp,__webpackgi_exports__gunzip=__webpackgi_exports__.swA,__webpackgi_exports__gunzipSync=__webpackgi_exports__._Z3,__webpackgi_exports__gzip=__webpackgi_exports__.ivc,__webpackgi_exports__gzipSync=__webpackgi_exports__.rZ1,__webpackgi_exports__hide=__webpackgi_exports__.CpZ,__webpackgi_exports__html=__webpackgi_exports__.dyc,__webpackgi_exports__htmlToCanvas=__webpackgi_exports__.MxZ,__webpackgi_exports__htmlToPng=__webpackgi_exports__.btp,__webpackgi_exports__htmlToSvg=__webpackgi_exports__.mXy,__webpackgi_exports__iGeometryIgnoredUserData=__webpackgi_exports__.Ej0,__webpackgi_exports__iMaterialIgnoredUserData=__webpackgi_exports__.ep4,__webpackgi_exports__iModelIgnoredUserData=__webpackgi_exports__.DQP,__webpackgi_exports__iTextureIgnoredUserData=__webpackgi_exports__.VNr,__webpackgi_exports__imageBitmapToBase64=__webpackgi_exports__.V7q,__webpackgi_exports__imageDataToCanvas=__webpackgi_exports__.hiB,__webpackgi_exports__imageToCanvas=__webpackgi_exports__.zEk,__webpackgi_exports__imageUrlToImageData=__webpackgi_exports__.qfq,__webpackgi_exports__includesAll=__webpackgi_exports__.piB,__webpackgi_exports__inertia=__webpackgi_exports__.IIc,__webpackgi_exports__inflate=__webpackgi_exports__.rrF,__webpackgi_exports__inflateSync=__webpackgi_exports__.naq,__webpackgi_exports__interleaveAttributes=__webpackgi_exports__.zlD,__webpackgi_exports__interpolate=__webpackgi_exports__.sXR,__webpackgi_exports__isAnimatableType=__webpackgi_exports__.p5I,__webpackgi_exports__isPoint=__webpackgi_exports__.wps,__webpackgi_exports__isPoint3D=__webpackgi_exports__.wuo,__webpackgi_exports__isPropertyWritable=__webpackgi_exports__.GpE,__webpackgi_exports__keyframes=__webpackgi_exports__.F4b,__webpackgi_exports__khrMaterialsVariantsGLTF=__webpackgi_exports__.NN$,__webpackgi_exports__left=__webpackgi_exports__.t$v,__webpackgi_exports__lerpAngle=__webpackgi_exports__.tdn,__webpackgi_exports__lerpAngle2=__webpackgi_exports__.Y9t,__webpackgi_exports__linear=__webpackgi_exports__.GEo,__webpackgi_exports__longestCommonPrefix=__webpackgi_exports__.GGm,__webpackgi_exports__main=__webpackgi_exports__.DH3,__webpackgi_exports__makeColorSvg=__webpackgi_exports__.uxM,__webpackgi_exports__makeColorSvgCircle=__webpackgi_exports__.zH3,__webpackgi_exports__makeFilter=__webpackgi_exports__.MLs,__webpackgi_exports__makeSamplerUi=__webpackgi_exports__.xXG,__webpackgi_exports__makeSetterFor=__webpackgi_exports__.YM4,__webpackgi_exports__makeTextSvg=__webpackgi_exports__.iAx,__webpackgi_exports__matDefine=__webpackgi_exports__.lDn,__webpackgi_exports__mergeAttributes=__webpackgi_exports__.P1O,__webpackgi_exports__mergeBufferAttributes=__webpackgi_exports__.iib,__webpackgi_exports__mergeBufferGeometries=__webpackgi_exports__.qf5,__webpackgi_exports__mergeGeometries=__webpackgi_exports__.n4s,__webpackgi_exports__mergeGroups=__webpackgi_exports__.fr,__webpackgi_exports__mergeVertices=__webpackgi_exports__.Z9s,__webpackgi_exports__mirrorEasing=__webpackgi_exports__.oaQ,__webpackgi_exports__mix=__webpackgi_exports__.CD7,__webpackgi_exports__mixColor=__webpackgi_exports__.Rc0,__webpackgi_exports__mixComplex=__webpackgi_exports__.iPG,__webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.TIc,__webpackgi_exports__modifierPhases=__webpackgi_exports__.xsC,__webpackgi_exports__now=__webpackgi_exports__.zOc,__webpackgi_exports__objectHasOwn=__webpackgi_exports__.i8W,__webpackgi_exports__offset=__webpackgi_exports__.r46,__webpackgi_exports__onChange=__webpackgi_exports__.z2C,__webpackgi_exports__onChange2=__webpackgi_exports__.N4A,__webpackgi_exports__onChange3=__webpackgi_exports__.hjq,__webpackgi_exports__parseFileExtension=__webpackgi_exports__._X$,__webpackgi_exports__patchShaderEncodingSupport=__webpackgi_exports__._yn,__webpackgi_exports__pathJoin=__webpackgi_exports__.Dyg,__webpackgi_exports__physicalMaterialPropList=__webpackgi_exports__.cUc,__webpackgi_exports__pipe=__webpackgi_exports__.zGw,__webpackgi_exports__placements=__webpackgi_exports__.Ctq,__webpackgi_exports__pointFromVector=__webpackgi_exports__.$ch,__webpackgi_exports__popper=__webpackgi_exports__.k5b,__webpackgi_exports__popperGenerator=__webpackgi_exports__.kZl,__webpackgi_exports__popperOffsets=__webpackgi_exports__.OCg,__webpackgi_exports__prettyScrollbar=__webpackgi_exports__.Kd3,__webpackgi_exports__preventOverflow=__webpackgi_exports__.YjH,__webpackgi_exports__processViewer=__webpackgi_exports__.Ui8,__webpackgi_exports__progress=__webpackgi_exports__.YD2,__webpackgi_exports__radiansToDegrees=__webpackgi_exports__.vi9,__webpackgi_exports__read=__webpackgi_exports__.ij3,__webpackgi_exports__readFile=__webpackgi_exports__.pJq,__webpackgi_exports__reference=__webpackgi_exports__.YPW,__webpackgi_exports__remoteWorkerURL=__webpackgi_exports__._tY,__webpackgi_exports__removeDuplicateGeometries=__webpackgi_exports__.Bg1,__webpackgi_exports__replaceAll=__webpackgi_exports__.kon,__webpackgi_exports__reverseEasing=__webpackgi_exports__.M3g,__webpackgi_exports__right=__webpackgi_exports__.F2z,__webpackgi_exports__rotateDuplicatedMesh=__webpackgi_exports__.pJF,__webpackgi_exports__sRGBEncoding=__webpackgi_exports__.knz,__webpackgi_exports__safeSetProperty=__webpackgi_exports__.Ejo,__webpackgi_exports__serializable=__webpackgi_exports__.BgY,__webpackgi_exports__serialize=__webpackgi_exports__.qCG,__webpackgi_exports__serializeObject=__webpackgi_exports__.HD9,__webpackgi_exports__serializeTextureInExtras=__webpackgi_exports__.Rgz,__webpackgi_exports__serializers=__webpackgi_exports__.fEB,__webpackgi_exports__setMeshGeometry=__webpackgi_exports__.Udc,__webpackgi_exports__setMeshMaterial=__webpackgi_exports__.ZQg,__webpackgi_exports__setThreeRendererMode=__webpackgi_exports__.ofC,__webpackgi_exports__setUrlQueryParam=__webpackgi_exports__.yRy,__webpackgi_exports__setupCoreWebGiViewer=__webpackgi_exports__._NL,__webpackgi_exports__setupIModel=__webpackgi_exports__.LCA,__webpackgi_exports__setupModesStyles=__webpackgi_exports__.Sy1,__webpackgi_exports__setupModesUi=__webpackgi_exports__.Vs_,__webpackgi_exports__setupObject3dModel=__webpackgi_exports__.j1w,__webpackgi_exports__setupSandboxWebGiEditor=__webpackgi_exports__.i8J,__webpackgi_exports__shaderReplaceString=__webpackgi_exports__.p7C,__webpackgi_exports__sign2=__webpackgi_exports__.Y8s,__webpackgi_exports__slerp=__webpackgi_exports__.ZAS,__webpackgi_exports__smooth=__webpackgi_exports__.ipH,__webpackgi_exports__smoothFrame=__webpackgi_exports__.$TF,__webpackgi_exports__snap=__webpackgi_exports__.uZI,__webpackgi_exports__snapObject=__webpackgi_exports__.VWG,__webpackgi_exports__sphericalFromObject=__webpackgi_exports__.pQ7,__webpackgi_exports__spring=__webpackgi_exports__.STw,__webpackgi_exports__standardMaterialPropList=__webpackgi_exports__.jc8,__webpackgi_exports__start=__webpackgi_exports__.BL_,__webpackgi_exports__steps=__webpackgi_exports__.S6,__webpackgi_exports__strFromU8=__webpackgi_exports__.T8U,__webpackgi_exports__strToU8=__webpackgi_exports__.TD6,__webpackgi_exports__supportsRequestStreams=__webpackgi_exports__.BTW,__webpackgi_exports__svgToCanvas=__webpackgi_exports__.akS,__webpackgi_exports__svgToPng=__webpackgi_exports__.QKE,__webpackgi_exports__svgUrl=__webpackgi_exports__.dKx,__webpackgi_exports__texImageToCanvas=__webpackgi_exports__.doP,__webpackgi_exports__textureDataToImageData=__webpackgi_exports__.$jA,__webpackgi_exports__textureToCanvas=__webpackgi_exports__.T99,__webpackgi_exports__textureToDataUrl=__webpackgi_exports__.LJS,__webpackgi_exports__timeout=__webpackgi_exports__.VsW,__webpackgi_exports__toCreasedNormals=__webpackgi_exports__.LZE,__webpackgi_exports__toDecimal=__webpackgi_exports__.YMc,__webpackgi_exports__toIndexedGeometry=__webpackgi_exports__.aPg,__webpackgi_exports__toTitleCase=__webpackgi_exports__.LFn,__webpackgi_exports__toTrianglesDrawMode=__webpackgi_exports__.VsX,__webpackgi_exports__top=__webpackgi_exports__.wey,__webpackgi_exports__uiButton=__webpackgi_exports__.MaE,__webpackgi_exports__uiColor=__webpackgi_exports__.s4x,__webpackgi_exports__uiConfig=__webpackgi_exports__.FJA,__webpackgi_exports__uiDropdown=__webpackgi_exports__.vIA,__webpackgi_exports__uiFolder=__webpackgi_exports__.Spv,__webpackgi_exports__uiImage=__webpackgi_exports__.w8l,__webpackgi_exports__uiInput=__webpackgi_exports__.riG,__webpackgi_exports__uiMonitor=__webpackgi_exports__.Kbh,__webpackgi_exports__uiPanel=__webpackgi_exports__.BFq,__webpackgi_exports__uiSlider=__webpackgi_exports__.t8K,__webpackgi_exports__uiToggle=__webpackgi_exports__.Q7n,__webpackgi_exports__uiVector=__webpackgi_exports__.KGF,__webpackgi_exports__uniform=__webpackgi_exports__.e5,__webpackgi_exports__unzip=__webpackgi_exports__.Rik,__webpackgi_exports__unzipSync=__webpackgi_exports__.GZo,__webpackgi_exports__unzlib=__webpackgi_exports__.Bds,__webpackgi_exports__unzlibSync=__webpackgi_exports__.HTu,__webpackgi_exports__uploadFile=__webpackgi_exports__.cTq,__webpackgi_exports__vLinearToRGBM=__webpackgi_exports__.X_Y,__webpackgi_exports__vRGBMToLinear=__webpackgi_exports__.dA8,__webpackgi_exports__valueToUiType=__webpackgi_exports__.NSm,__webpackgi_exports__variationPlacements=__webpackgi_exports__.bwS,__webpackgi_exports__velocityPerFrame=__webpackgi_exports__.Lks,__webpackgi_exports__velocityPerSecond=__webpackgi_exports__.Rvq,__webpackgi_exports__verifyPermission=__webpackgi_exports__.P4F,__webpackgi_exports__viewerGLTFExtension=__webpackgi_exports__.Pd0,__webpackgi_exports__viewport=__webpackgi_exports__.Pjo,__webpackgi_exports__webgiLightExtrasExtension=__webpackgi_exports__.Tum,__webpackgi_exports__webgiMaterialExtrasExtension=__webpackgi_exports__.dRH,__webpackgi_exports__webgiObject3DExtrasExtension=__webpackgi_exports__.RX0,__webpackgi_exports__wrap=__webpackgi_exports__.reQ,__webpackgi_exports__write=__webpackgi_exports__.cWm,__webpackgi_exports__writeFile=__webpackgi_exports__.NC9,__webpackgi_exports__zip=__webpackgi_exports__.$Re,__webpackgi_exports__zipSync=__webpackgi_exports__.Xo9,__webpackgi_exports__zlib=__webpackgi_exports__.LNO,__webpackgi_exports__zlibSync=__webpackgi_exports__.iZP},9306:function(e,t,n){var i=n(4901),r=n(6823),s=TypeError;e.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not a function")}},3506:function(e,t,n){var i=n(3925),r=String,s=TypeError;e.exports=function(e){if(i(e))return e;throw new s("Can't set "+r(e)+" as a prototype")}},7080:function(e,t,n){var i=n(4402).has;e.exports=function(e){return i(e),e}},679:function(e,t,n){var i=n(1625),r=TypeError;e.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}},8551:function(e,t,n){var i=n(34),r=String,s=TypeError;e.exports=function(e){if(i(e))return e;throw new s(r(e)+" is not an object")}},7811:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7394:function(e,t,n){var i=n(4576),r=n(6706),s=n(2195),o=i.ArrayBuffer,a=i.TypeError;e.exports=o&&r(o.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==s(e))throw new a("ArrayBuffer expected");return e.byteLength}},3238:function(e,t,n){var i=n(4576),r=n(7476),s=n(7394),o=i.ArrayBuffer,a=o&&o.prototype,l=a&&r(a.slice);e.exports=function(e){if(0!==s(e))return!1;if(!l)return!1;try{return l(e,0,0),!1}catch(t){return!0}}},5169:function(e,t,n){var i=n(3238),r=TypeError;e.exports=function(e){if(i(e))throw new r("ArrayBuffer is detached");return e}},5636:function(e,t,n){var i=n(4576),r=n(9504),s=n(6706),o=n(7696),a=n(5169),l=n(7394),c=n(4483),u=n(1548),d=i.structuredClone,h=i.ArrayBuffer,p=i.DataView,f=Math.min,m=h.prototype,g=p.prototype,_=r(m.slice),v=s(m,"resizable","get"),y=s(m,"maxByteLength","get"),b=r(g.getInt8),A=r(g.setInt8);e.exports=(u||c)&&function(e,t,n){var i,r=l(e),s=void 0===t?r:o(t),m=!v||!v(e);if(a(e),u&&(e=d(e,{transfer:[e]}),r===s&&(n||m)))return e;if(r>=s&&(!n||m))i=_(e,0,s);else{var g=n&&!m&&y?{maxByteLength:y(e)}:void 0;i=new h(s,g);for(var w=new p(e),x=new p(i),E=f(s,r),C=0;C<E;C++)A(x,C,b(w,C))}return u||c(e),i}},4644:function(e,t,n){var i,r,s,o=n(7811),a=n(3724),l=n(4576),c=n(4901),u=n(34),d=n(9297),h=n(6955),p=n(6823),f=n(6699),m=n(6840),g=n(2106),_=n(1625),v=n(2787),y=n(2967),b=n(8227),A=n(3392),w=n(1181),x=w.enforce,E=w.get,C=l.Int8Array,S=C&&C.prototype,M=l.Uint8ClampedArray,T=M&&M.prototype,I=C&&v(C),P=S&&v(S),R=Object.prototype,D=l.TypeError,k=b("toStringTag"),B=A("TYPED_ARRAY_TAG"),O="TypedArrayConstructor",L=o&&!!y&&"Opera"!==h(l.opera),U=!1,N={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},j=function(e){if(!u(e))return!1;var t=h(e);return"DataView"===t||d(N,t)||d(F,t)},z=function(e){var t=v(e);if(u(t)){var n=E(t);return n&&d(n,O)?n[O]:z(t)}},G=function(e){if(!u(e))return!1;var t=h(e);return d(N,t)||d(F,t)},V=function(e){if(G(e))return e;throw new D("Target is not a typed array")},H=function(e){if(c(e)&&(!y||_(I,e)))return e;throw new D(p(e)+" is not a typed array constructor")},Q=function(e,t,n,i){if(a){if(n)for(var r in N){var s=l[r];if(s&&d(s.prototype,e))try{delete s.prototype[e]}catch(o){try{s.prototype[e]=t}catch(c){}}}P[e]&&!n||m(P,e,n?t:L&&S[e]||t,i)}},W=function(e,t,n){var i,r;if(a){if(y){if(n)for(i in N)if(r=l[i],r&&d(r,e))try{delete r[e]}catch(s){}if(I[e]&&!n)return;try{return m(I,e,n?t:L&&I[e]||t)}catch(s){}}for(i in N)r=l[i],!r||r[e]&&!n||m(r,e,t)}};for(i in N)r=l[i],s=r&&r.prototype,s?x(s)[O]=r:L=!1;for(i in F)r=l[i],s=r&&r.prototype,s&&(x(s)[O]=r);if((!L||!c(I)||I===Function.prototype)&&(I=function(){throw new D("Incorrect invocation")},L))for(i in N)l[i]&&y(l[i],I);if((!L||!P||P===R)&&(P=I.prototype,L))for(i in N)l[i]&&y(l[i].prototype,P);if(L&&v(T)!==P&&y(T,P),a&&!d(P,k))for(i in U=!0,g(P,k,{configurable:!0,get:function(){return u(this)?this[B]:void 0}}),N)l[i]&&f(l[i],B,i);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:L,TYPED_ARRAY_TAG:U&&B,aTypedArray:V,aTypedArrayConstructor:H,exportTypedArrayMethod:Q,exportTypedArrayStaticMethod:W,getTypedArrayConstructor:z,isView:j,isTypedArray:G,TypedArray:I,TypedArrayPrototype:P}},5370:function(e,t,n){var i=n(6198);e.exports=function(e,t,n){var r=0,s=arguments.length>2?n:i(t),o=new e(s);while(s>r)o[r]=t[r++];return o}},9617:function(e,t,n){var i=n(5397),r=n(5610),s=n(6198),o=function(e){return function(t,n,o){var a=i(t),l=s(a);if(0===l)return!e&&-1;var c,u=r(o,l);if(e&&n!==n){while(l>u)if(c=a[u++],c!==c)return!0}else for(;l>u;u++)if((e||u in a)&&a[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},4527:function(e,t,n){var i=n(3724),r=n(4376),s=TypeError,o=Object.getOwnPropertyDescriptor,a=i&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(r(e)&&!o(e,"length").writable)throw new s("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},7680:function(e,t,n){var i=n(9504);e.exports=i([].slice)},7628:function(e,t,n){var i=n(6198);e.exports=function(e,t){for(var n=i(e),r=new t(n),s=0;s<n;s++)r[s]=e[n-s-1];return r}},9928:function(e,t,n){var i=n(6198),r=n(1291),s=RangeError;e.exports=function(e,t,n,o){var a=i(e),l=r(n),c=l<0?a+l:l;if(c>=a||c<0)throw new s("Incorrect index");for(var u=new t(a),d=0;d<a;d++)u[d]=d===c?o:e[d];return u}},6319:function(e,t,n){var i=n(8551),r=n(9539);e.exports=function(e,t,n,s){try{return s?t(i(n)[0],n[1]):t(n)}catch(o){r(e,"throw",o)}}},2195:function(e,t,n){var i=n(9504),r=i({}.toString),s=i("".slice);e.exports=function(e){return s(r(e),8,-1)}},6955:function(e,t,n){var i=n(2140),r=n(4901),s=n(2195),o=n(8227),a=o("toStringTag"),l=Object,c="Arguments"===s(function(){return arguments}()),u=function(e,t){try{return e[t]}catch(n){}};e.exports=i?s:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=u(t=l(e),a))?n:c?s(t):"Object"===(i=s(t))&&r(t.callee)?"Arguments":i}},7740:function(e,t,n){var i=n(9297),r=n(5031),s=n(7347),o=n(4913);e.exports=function(e,t,n){for(var a=r(t),l=o.f,c=s.f,u=0;u<a.length;u++){var d=a[u];i(e,d)||n&&i(n,d)||l(e,d,c(t,d))}}},2211:function(e,t,n){var i=n(9039);e.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},2529:function(e){e.exports=function(e,t){return{value:e,done:t}}},6699:function(e,t,n){var i=n(3724),r=n(4913),s=n(6980);e.exports=i?function(e,t,n){return r.f(e,t,s(1,n))}:function(e,t,n){return e[t]=n,e}},6980:function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4659:function(e,t,n){var i=n(3724),r=n(4913),s=n(6980);e.exports=function(e,t,n){i?r.f(e,t,s(0,n)):e[t]=n}},2106:function(e,t,n){var i=n(283),r=n(4913);e.exports=function(e,t,n){return n.get&&i(n.get,t,{getter:!0}),n.set&&i(n.set,t,{setter:!0}),r.f(e,t,n)}},6840:function(e,t,n){var i=n(4901),r=n(4913),s=n(283),o=n(9433);e.exports=function(e,t,n,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(i(n)&&s(n,c,a),a.global)l?e[t]=n:o(t,n);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(u){}l?e[t]=n:r.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},6279:function(e,t,n){var i=n(6840);e.exports=function(e,t,n){for(var r in t)i(e,r,t[r],n);return e}},9433:function(e,t,n){var i=n(4576),r=Object.defineProperty;e.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch(n){i[e]=t}return t}},3724:function(e,t,n){var i=n(9039);e.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4483:function(e,t,n){var i,r,s,o,a=n(4576),l=n(9429),c=n(1548),u=a.structuredClone,d=a.ArrayBuffer,h=a.MessageChannel,p=!1;if(c)p=function(e){u(e,{transfer:[e]})};else if(d)try{h||(i=l("worker_threads"),i&&(h=i.MessageChannel)),h&&(r=new h,s=new d(2),o=function(e){r.port1.postMessage(null,[e])},2===s.byteLength&&(o(s),0===s.byteLength&&(p=o)))}catch(f){}e.exports=p},4055:function(e,t,n){var i=n(4576),r=n(34),s=i.document,o=r(s)&&r(s.createElement);e.exports=function(e){return o?s.createElement(e):{}}},6837:function(e){var t=TypeError,n=9007199254740991;e.exports=function(e){if(e>n)throw t("Maximum allowed index exceeded");return e}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8727:function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},9544:function(e,t,n){var i=n(2839);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)},6193:function(e,t,n){var i=n(4215);e.exports="NODE"===i},2839:function(e,t,n){var i=n(4576),r=i.navigator,s=r&&r.userAgent;e.exports=s?String(s):""},9519:function(e,t,n){var i,r,s=n(4576),o=n(2839),a=s.process,l=s.Deno,c=a&&a.versions||l&&l.version,u=c&&c.v8;u&&(i=u.split("."),r=i[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&o&&(i=o.match(/Edge\/(\d+)/),(!i||i[1]>=74)&&(i=o.match(/Chrome\/(\d+)/),i&&(r=+i[1]))),e.exports=r},4215:function(e,t,n){var i=n(4576),r=n(2839),s=n(2195),o=function(e){return r.slice(0,e.length)===e};e.exports=function(){return o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===s(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"}()},8574:function(e,t,n){var i=n(9504),r=Error,s=i("".replace),o=function(e){return String(new r(e).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(o);e.exports=function(e,t){if(l&&"string"==typeof e&&!r.prepareStackTrace)while(t--)e=s(e,a,"");return e}},6518:function(e,t,n){var i=n(4576),r=n(7347).f,s=n(6699),o=n(6840),a=n(9433),l=n(7740),c=n(2796);e.exports=function(e,t){var n,u,d,h,p,f,m=e.target,g=e.global,_=e.stat;if(u=g?i:_?i[m]||a(m,{}):i[m]&&i[m].prototype,u)for(d in t){if(p=t[d],e.dontCallGetSet?(f=r(u,d),h=f&&f.value):h=u[d],n=c(g?d:m+(_?".":"#")+d,e.forced),!n&&void 0!==h){if(typeof p==typeof h)continue;l(p,h)}(e.sham||h&&h.sham)&&s(p,"sham",!0),o(u,d,p,e)}}},9039:function(e){e.exports=function(e){try{return!!e()}catch(t){return!0}}},8745:function(e,t,n){var i=n(616),r=Function.prototype,s=r.apply,o=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?o.bind(s):function(){return o.apply(s,arguments)})},6080:function(e,t,n){var i=n(7476),r=n(9306),s=n(616),o=i(i.bind);e.exports=function(e,t){return r(e),void 0===t?e:s?o(e,t):function(){return e.apply(t,arguments)}}},616:function(e,t,n){var i=n(9039);e.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},9565:function(e,t,n){var i=n(616),r=Function.prototype.call;e.exports=i?r.bind(r):function(){return r.apply(r,arguments)}},350:function(e,t,n){var i=n(3724),r=n(9297),s=Function.prototype,o=i&&Object.getOwnPropertyDescriptor,a=r(s,"name"),l=a&&"something"===function(){}.name,c=a&&(!i||i&&o(s,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},6706:function(e,t,n){var i=n(9504),r=n(9306);e.exports=function(e,t,n){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(s){}}},7476:function(e,t,n){var i=n(2195),r=n(9504);e.exports=function(e){if("Function"===i(e))return r(e)}},9504:function(e,t,n){var i=n(616),r=Function.prototype,s=r.call,o=i&&r.bind.bind(s,s);e.exports=i?o:function(e){return function(){return s.apply(e,arguments)}}},9429:function(e,t,n){var i=n(4576),r=n(6193);e.exports=function(e){if(r){try{return i.process.getBuiltinModule(e)}catch(t){}try{return Function('return require("'+e+'")')()}catch(t){}}}},7751:function(e,t,n){var i=n(4576),r=n(4901),s=function(e){return r(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?s(i[e]):i[e]&&i[e][t]}},1767:function(e){e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},8646:function(e,t,n){var i=n(9565),r=n(8551),s=n(1767),o=n(851);e.exports=function(e,t){t&&"string"===typeof e||r(e);var n=o(e);return s(r(void 0!==n?i(n,e):e))}},851:function(e,t,n){var i=n(6955),r=n(5966),s=n(4117),o=n(6269),a=n(8227),l=a("iterator");e.exports=function(e){if(!s(e))return r(e,l)||r(e,"@@iterator")||o[i(e)]}},81:function(e,t,n){var i=n(9565),r=n(9306),s=n(8551),o=n(6823),a=n(851),l=TypeError;e.exports=function(e,t){var n=arguments.length<2?a(e):t;if(r(n))return s(i(n,e));throw new l(o(e)+" is not iterable")}},5966:function(e,t,n){var i=n(9306),r=n(4117);e.exports=function(e,t){var n=e[t];return r(n)?void 0:i(n)}},3789:function(e,t,n){var i=n(9306),r=n(8551),s=n(9565),o=n(1291),a=n(1767),l="Invalid size",c=RangeError,u=TypeError,d=Math.max,h=function(e,t){this.set=e,this.size=d(t,0),this.has=i(e.has),this.keys=i(e.keys)};h.prototype={getIterator:function(){return a(r(s(this.keys,this.set)))},includes:function(e){return s(this.has,this.set,e)}},e.exports=function(e){r(e);var t=+e.size;if(t!==t)throw new u(l);var n=o(t);if(n<0)throw new c(l);return new h(e,n)}},4576:function(e,t,n){var i=function(e){return e&&e.Math===Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof n.g&&n.g)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:function(e,t,n){var i=n(9504),r=n(8981),s=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return s(r(e),t)}},421:function(e){e.exports={}},397:function(e,t,n){var i=n(7751);e.exports=i("document","documentElement")},5917:function(e,t,n){var i=n(3724),r=n(9039),s=n(4055);e.exports=!i&&!r((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},7055:function(e,t,n){var i=n(9504),r=n(9039),s=n(2195),o=Object,a=i("".split);e.exports=r((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?a(e,""):o(e)}:o},3167:function(e,t,n){var i=n(4901),r=n(34),s=n(2967);e.exports=function(e,t,n){var o,a;return s&&i(o=t.constructor)&&o!==n&&r(a=o.prototype)&&a!==n.prototype&&s(e,a),e}},3706:function(e,t,n){var i=n(9504),r=n(4901),s=n(7629),o=i(Function.toString);r(s.inspectSource)||(s.inspectSource=function(e){return o(e)}),e.exports=s.inspectSource},1181:function(e,t,n){var i,r,s,o=n(8622),a=n(4576),l=n(34),c=n(6699),u=n(9297),d=n(7629),h=n(6119),p=n(421),f="Object already initialized",m=a.TypeError,g=a.WeakMap,_=function(e){return s(e)?r(e):i(e,{})},v=function(e){return function(t){var n;if(!l(t)||(n=r(t)).type!==e)throw new m("Incompatible receiver, "+e+" required");return n}};if(o||d.state){var y=d.state||(d.state=new g);y.get=y.get,y.has=y.has,y.set=y.set,i=function(e,t){if(y.has(e))throw new m(f);return t.facade=e,y.set(e,t),t},r=function(e){return y.get(e)||{}},s=function(e){return y.has(e)}}else{var b=h("state");p[b]=!0,i=function(e,t){if(u(e,b))throw new m(f);return t.facade=e,c(e,b,t),t},r=function(e){return u(e,b)?e[b]:{}},s=function(e){return u(e,b)}}e.exports={set:i,get:r,has:s,enforce:_,getterFor:v}},4209:function(e,t,n){var i=n(8227),r=n(6269),s=i("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[s]===e)}},4376:function(e,t,n){var i=n(2195);e.exports=Array.isArray||function(e){return"Array"===i(e)}},1108:function(e,t,n){var i=n(6955);e.exports=function(e){var t=i(e);return"BigInt64Array"===t||"BigUint64Array"===t}},4901:function(e){var t="object"==typeof document&&document.all;e.exports="undefined"==typeof t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},2796:function(e,t,n){var i=n(9039),r=n(4901),s=/#|\.prototype\./,o=function(e,t){var n=l[a(e)];return n===u||n!==c&&(r(t)?i(t):!!t)},a=o.normalize=function(e){return String(e).replace(s,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},4117:function(e){e.exports=function(e){return null===e||void 0===e}},34:function(e,t,n){var i=n(4901);e.exports=function(e){return"object"==typeof e?null!==e:i(e)}},3925:function(e,t,n){var i=n(34);e.exports=function(e){return i(e)||null===e}},6395:function(e){e.exports=!1},757:function(e,t,n){var i=n(7751),r=n(4901),s=n(1625),o=n(7040),a=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&s(t.prototype,a(e))}},507:function(e,t,n){var i=n(9565);e.exports=function(e,t,n){var r,s,o=n?e:e.iterator,a=e.next;while(!(r=i(a,o)).done)if(s=t(r.value),void 0!==s)return s}},2652:function(e,t,n){var i=n(6080),r=n(9565),s=n(8551),o=n(6823),a=n(4209),l=n(6198),c=n(1625),u=n(81),d=n(851),h=n(9539),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},m=f.prototype;e.exports=function(e,t,n){var g,_,v,y,b,A,w,x=n&&n.that,E=!(!n||!n.AS_ENTRIES),C=!(!n||!n.IS_RECORD),S=!(!n||!n.IS_ITERATOR),M=!(!n||!n.INTERRUPTED),T=i(t,x),I=function(e){return g&&h(g,"normal",e),new f(!0,e)},P=function(e){return E?(s(e),M?T(e[0],e[1],I):T(e[0],e[1])):M?T(e,I):T(e)};if(C)g=e.iterator;else if(S)g=e;else{if(_=d(e),!_)throw new p(o(e)+" is not iterable");if(a(_)){for(v=0,y=l(e);y>v;v++)if(b=P(e[v]),b&&c(m,b))return b;return new f(!1)}g=u(e,_)}A=C?e.next:g.next;while(!(w=r(A,g)).done){try{b=P(w.value)}catch(R){h(g,"throw",R)}if("object"==typeof b&&b&&c(m,b))return b}return new f(!1)}},9539:function(e,t,n){var i=n(9565),r=n(8551),s=n(5966);e.exports=function(e,t,n){var o,a;r(e);try{if(o=s(e,"return"),!o){if("throw"===t)throw n;return n}o=i(o,e)}catch(l){a=!0,o=l}if("throw"===t)throw n;if(a)throw o;return r(o),n}},9462:function(e,t,n){var i=n(9565),r=n(2360),s=n(6699),o=n(6279),a=n(8227),l=n(1181),c=n(5966),u=n(7657).IteratorPrototype,d=n(2529),h=n(9539),p=a("toStringTag"),f="IteratorHelper",m="WrapForValidIterator",g=l.set,_=function(e){var t=l.getterFor(e?m:f);return o(r(u),{next:function(){var n=t(this);if(e)return n.nextHandler();try{var i=n.done?void 0:n.nextHandler();return d(i,n.done)}catch(r){throw n.done=!0,r}},return:function(){var n=t(this),r=n.iterator;if(n.done=!0,e){var s=c(r,"return");return s?i(s,r):d(void 0,!0)}if(n.inner)try{h(n.inner.iterator,"normal")}catch(o){return h(r,"throw",o)}return r&&h(r,"normal"),d(void 0,!0)}})},v=_(!0),y=_(!1);s(y,p,"Iterator Helper"),e.exports=function(e,t){var n=function(n,i){i?(i.iterator=n.iterator,i.next=n.next):i=n,i.type=t?m:f,i.nextHandler=e,i.counter=0,i.done=!1,g(this,i)};return n.prototype=t?v:y,n}},713:function(e,t,n){var i=n(9565),r=n(9306),s=n(8551),o=n(1767),a=n(9462),l=n(6319),c=a((function(){var e=this.iterator,t=s(i(this.next,e)),n=this.done=!!t.done;if(!n)return l(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return s(this),r(e),new c(o(this),{mapper:e})}},7657:function(e,t,n){var i,r,s,o=n(9039),a=n(4901),l=n(34),c=n(2360),u=n(2787),d=n(6840),h=n(8227),p=n(6395),f=h("iterator"),m=!1;[].keys&&(s=[].keys(),"next"in s?(r=u(u(s)),r!==Object.prototype&&(i=r)):m=!0);var g=!l(i)||o((function(){var e={};return i[f].call(e)!==e}));g?i={}:p&&(i=c(i)),a(i[f])||d(i,f,(function(){return this})),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:m}},6269:function(e){e.exports={}},6198:function(e,t,n){var i=n(8014);e.exports=function(e){return i(e.length)}},283:function(e,t,n){var i=n(9504),r=n(9039),s=n(4901),o=n(9297),a=n(3724),l=n(350).CONFIGURABLE,c=n(3706),u=n(1181),d=u.enforce,h=u.get,p=String,f=Object.defineProperty,m=i("".slice),g=i("".replace),_=i([].join),v=a&&!r((function(){return 8!==f((function(){}),"length",{value:8}).length})),y=String(String).split("String"),b=e.exports=function(e,t,n){"Symbol("===m(p(t),0,7)&&(t="["+g(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!o(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),v&&n&&o(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(r){}var i=d(e);return o(i,"source")||(i.source=_(y,"string"==typeof t?t:"")),e};Function.prototype.toString=b((function(){return s(this)&&h(this).source||c(this)}),"toString")},741:function(e){var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?n:t)(i)}},2603:function(e,t,n){var i=n(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:i(e)}},2360:function(e,t,n){var i,r=n(8551),s=n(6801),o=n(8727),a=n(421),l=n(397),c=n(4055),u=n(6119),d=">",h="<",p="prototype",f="script",m=u("IE_PROTO"),g=function(){},_=function(e){return h+f+d+e+h+"/"+f+d},v=function(e){e.write(_("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){var e,t=c("iframe"),n="java"+f+":";return t.style.display="none",l.appendChild(t),t.src=String(n),e=t.contentWindow.document,e.open(),e.write(_("document.F=Object")),e.close(),e.F},b=function(){try{i=new ActiveXObject("htmlfile")}catch(t){}b="undefined"!=typeof document?document.domain&&i?v(i):y():v(i);var e=o.length;while(e--)delete b[p][o[e]];return b()};a[m]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(g[p]=r(e),n=new g,g[p]=null,n[m]=e):n=b(),void 0===t?n:s.f(n,t)}},6801:function(e,t,n){var i=n(3724),r=n(8686),s=n(4913),o=n(8551),a=n(5397),l=n(1072);t.f=i&&!r?Object.defineProperties:function(e,t){o(e);var n,i=a(t),r=l(t),c=r.length,u=0;while(c>u)s.f(e,n=r[u++],i[n]);return e}},4913:function(e,t,n){var i=n(3724),r=n(5917),s=n(8686),o=n(8551),a=n(6969),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d="enumerable",h="configurable",p="writable";t.f=i?s?function(e,t,n){if(o(e),t=a(t),o(n),"function"===typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var i=u(e,t);i&&i[p]&&(e[t]=n.value,n={configurable:h in n?n[h]:i[h],enumerable:d in n?n[d]:i[d],writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(o(e),t=a(t),o(n),r)try{return c(e,t,n)}catch(i){}if("get"in n||"set"in n)throw new l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},7347:function(e,t,n){var i=n(3724),r=n(9565),s=n(8773),o=n(6980),a=n(5397),l=n(6969),c=n(9297),u=n(5917),d=Object.getOwnPropertyDescriptor;t.f=i?d:function(e,t){if(e=a(e),t=l(t),u)try{return d(e,t)}catch(n){}if(c(e,t))return o(!r(s.f,e,t),e[t])}},8480:function(e,t,n){var i=n(1828),r=n(8727),s=r.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,s)}},3717:function(e,t){t.f=Object.getOwnPropertySymbols},2787:function(e,t,n){var i=n(9297),r=n(4901),s=n(8981),o=n(6119),a=n(2211),l=o("IE_PROTO"),c=Object,u=c.prototype;e.exports=a?c.getPrototypeOf:function(e){var t=s(e);if(i(t,l))return t[l];var n=t.constructor;return r(n)&&t instanceof n?n.prototype:t instanceof c?u:null}},1625:function(e,t,n){var i=n(9504);e.exports=i({}.isPrototypeOf)},1828:function(e,t,n){var i=n(9504),r=n(9297),s=n(5397),o=n(9617).indexOf,a=n(421),l=i([].push);e.exports=function(e,t){var n,i=s(e),c=0,u=[];for(n in i)!r(a,n)&&r(i,n)&&l(u,n);while(t.length>c)r(i,n=t[c++])&&(~o(u,n)||l(u,n));return u}},1072:function(e,t,n){var i=n(1828),r=n(8727);e.exports=Object.keys||function(e){return i(e,r)}},8773:function(e,t){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!n.call({1:2},1);t.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},2967:function(e,t,n){var i=n(6706),r=n(34),s=n(7750),o=n(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{e=i(Object.prototype,"__proto__","set"),e(n,[]),t=n instanceof Array}catch(a){}return function(n,i){return s(n),o(i),r(n)?(t?e(n,i):n.__proto__=i,n):n}}():void 0)},4270:function(e,t,n){var i=n(9565),r=n(4901),s=n(34),o=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&r(n=e.toString)&&!s(a=i(n,e)))return a;if(r(n=e.valueOf)&&!s(a=i(n,e)))return a;if("string"!==t&&r(n=e.toString)&&!s(a=i(n,e)))return a;throw new o("Can't convert object to primitive value")}},5031:function(e,t,n){var i=n(7751),r=n(9504),s=n(8480),o=n(3717),a=n(8551),l=r([].concat);e.exports=i("Reflect","ownKeys")||function(e){var t=s.f(a(e)),n=o.f;return n?l(t,n(e)):t}},7979:function(e,t,n){var i=n(8551);e.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},7750:function(e,t,n){var i=n(4117),r=TypeError;e.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}},9472:function(e,t,n){var i=n(4576),r=n(8745),s=n(4901),o=n(4215),a=n(2839),l=n(7680),c=n(2812),u=i.Function,d=/MSIE .\./.test(a)||"BUN"===o&&function(){var e=i.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}();e.exports=function(e,t){var n=t?2:1;return d?function(i,o){var a=c(arguments.length,1)>n,d=s(i)?i:u(i),h=a?l(arguments,n):[],p=a?function(){r(d,this,h)}:d;return t?e(p,o):e(p)}:e}},9286:function(e,t,n){var i=n(4402),r=n(8469),s=i.Set,o=i.add;e.exports=function(e){var t=new s;return r(e,(function(e){o(t,e)})),t}},3440:function(e,t,n){var i=n(7080),r=n(4402),s=n(9286),o=n(5170),a=n(3789),l=n(8469),c=n(507),u=r.has,d=r.remove;e.exports=function(e){var t=i(this),n=a(e),r=s(t);return o(t)<=n.size?l(t,(function(e){n.includes(e)&&d(r,e)})):c(n.getIterator(),(function(e){u(t,e)&&d(r,e)})),r}},4402:function(e,t,n){var i=n(9504),r=Set.prototype;e.exports={Set:Set,add:i(r.add),has:i(r.has),remove:i(r["delete"]),proto:r}},8750:function(e,t,n){var i=n(7080),r=n(4402),s=n(5170),o=n(3789),a=n(8469),l=n(507),c=r.Set,u=r.add,d=r.has;e.exports=function(e){var t=i(this),n=o(e),r=new c;return s(t)>n.size?l(n.getIterator(),(function(e){d(t,e)&&u(r,e)})):a(t,(function(e){n.includes(e)&&u(r,e)})),r}},4449:function(e,t,n){var i=n(7080),r=n(4402).has,s=n(5170),o=n(3789),a=n(8469),l=n(507),c=n(9539);e.exports=function(e){var t=i(this),n=o(e);if(s(t)<=n.size)return!1!==a(t,(function(e){if(n.includes(e))return!1}),!0);var u=n.getIterator();return!1!==l(u,(function(e){if(r(t,e))return c(u,"normal",!1)}))}},3838:function(e,t,n){var i=n(7080),r=n(5170),s=n(8469),o=n(3789);e.exports=function(e){var t=i(this),n=o(e);return!(r(t)>n.size)&&!1!==s(t,(function(e){if(!n.includes(e))return!1}),!0)}},8527:function(e,t,n){var i=n(7080),r=n(4402).has,s=n(5170),o=n(3789),a=n(507),l=n(9539);e.exports=function(e){var t=i(this),n=o(e);if(s(t)<n.size)return!1;var c=n.getIterator();return!1!==a(c,(function(e){if(!r(t,e))return l(c,"normal",!1)}))}},8469:function(e,t,n){var i=n(9504),r=n(507),s=n(4402),o=s.Set,a=s.proto,l=i(a.forEach),c=i(a.keys),u=c(new o).next;e.exports=function(e,t,n){return n?r({iterator:c(e),next:u},t):l(e,t)}},4916:function(e,t,n){var i=n(7751),r=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};e.exports=function(e){var t=i("Set");try{(new t)[e](r(0));try{return(new t)[e](r(-1)),!1}catch(n){return!0}}catch(s){return!1}}},5170:function(e,t,n){var i=n(6706),r=n(4402);e.exports=i(r.proto,"size","get")||function(e){return e.size}},3650:function(e,t,n){var i=n(7080),r=n(4402),s=n(9286),o=n(3789),a=n(507),l=r.add,c=r.has,u=r.remove;e.exports=function(e){var t=i(this),n=o(e).getIterator(),r=s(t);return a(n,(function(e){c(t,e)?u(r,e):l(r,e)})),r}},4204:function(e,t,n){var i=n(7080),r=n(4402).add,s=n(9286),o=n(3789),a=n(507);e.exports=function(e){var t=i(this),n=o(e).getIterator(),l=s(t);return a(n,(function(e){r(l,e)})),l}},6119:function(e,t,n){var i=n(5745),r=n(3392),s=i("keys");e.exports=function(e){return s[e]||(s[e]=r(e))}},7629:function(e,t,n){var i=n(6395),r=n(4576),s=n(9433),o="__core-js_shared__",a=e.exports=r[o]||s(o,{});(a.versions||(a.versions=[])).push({version:"3.39.0",mode:i?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:function(e,t,n){var i=n(7629);e.exports=function(e,t){return i[e]||(i[e]=t||{})}},1548:function(e,t,n){var i=n(4576),r=n(9039),s=n(9519),o=n(4215),a=i.structuredClone;e.exports=!!a&&!r((function(){if("DENO"===o&&s>92||"NODE"===o&&s>94||"BROWSER"===o&&s>97)return!1;var e=new ArrayBuffer(8),t=a(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength}))},4495:function(e,t,n){var i=n(9519),r=n(9039),s=n(4576),o=s.String;e.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))},9225:function(e,t,n){var i,r,s,o,a=n(4576),l=n(8745),c=n(6080),u=n(4901),d=n(9297),h=n(9039),p=n(397),f=n(7680),m=n(4055),g=n(2812),_=n(9544),v=n(6193),y=a.setImmediate,b=a.clearImmediate,A=a.process,w=a.Dispatch,x=a.Function,E=a.MessageChannel,C=a.String,S=0,M={},T="onreadystatechange";h((function(){i=a.location}));var I=function(e){if(d(M,e)){var t=M[e];delete M[e],t()}},P=function(e){return function(){I(e)}},R=function(e){I(e.data)},D=function(e){a.postMessage(C(e),i.protocol+"//"+i.host)};y&&b||(y=function(e){g(arguments.length,1);var t=u(e)?e:x(e),n=f(arguments,1);return M[++S]=function(){l(t,void 0,n)},r(S),S},b=function(e){delete M[e]},v?r=function(e){A.nextTick(P(e))}:w&&w.now?r=function(e){w.now(P(e))}:E&&!_?(s=new E,o=s.port2,s.port1.onmessage=R,r=c(o.postMessage,o)):a.addEventListener&&u(a.postMessage)&&!a.importScripts&&i&&"file:"!==i.protocol&&!h(D)?(r=D,a.addEventListener("message",R,!1)):r=T in m("script")?function(e){p.appendChild(m("script"))[T]=function(){p.removeChild(this),I(e)}}:function(e){setTimeout(P(e),0)}),e.exports={set:y,clear:b}},5610:function(e,t,n){var i=n(1291),r=Math.max,s=Math.min;e.exports=function(e,t){var n=i(e);return n<0?r(n+t,0):s(n,t)}},5854:function(e,t,n){var i=n(2777),r=TypeError;e.exports=function(e){var t=i(e,"number");if("number"==typeof t)throw new r("Can't convert number to bigint");return BigInt(t)}},7696:function(e,t,n){var i=n(1291),r=n(8014),s=RangeError;e.exports=function(e){if(void 0===e)return 0;var t=i(e),n=r(t);if(t!==n)throw new s("Wrong length or index");return n}},5397:function(e,t,n){var i=n(7055),r=n(7750);e.exports=function(e){return i(r(e))}},1291:function(e,t,n){var i=n(741);e.exports=function(e){var t=+e;return t!==t||0===t?0:i(t)}},8014:function(e,t,n){var i=n(1291),r=Math.min;e.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}},8981:function(e,t,n){var i=n(7750),r=Object;e.exports=function(e){return r(i(e))}},2777:function(e,t,n){var i=n(9565),r=n(34),s=n(757),o=n(5966),a=n(4270),l=n(8227),c=TypeError,u=l("toPrimitive");e.exports=function(e,t){if(!r(e)||s(e))return e;var n,l=o(e,u);if(l){if(void 0===t&&(t="default"),n=i(l,e,t),!r(n)||s(n))return n;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},6969:function(e,t,n){var i=n(2777),r=n(757);e.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}},2140:function(e,t,n){var i=n(8227),r=i("toStringTag"),s={};s[r]="z",e.exports="[object z]"===String(s)},655:function(e,t,n){var i=n(6955),r=String;e.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}},6823:function(e){var t=String;e.exports=function(e){try{return t(e)}catch(n){return"Object"}}},3392:function(e,t,n){var i=n(9504),r=0,s=Math.random(),o=i(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++r+s,36)}},7040:function(e,t,n){var i=n(4495);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:function(e,t,n){var i=n(3724),r=n(9039);e.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},2812:function(e){var t=TypeError;e.exports=function(e,n){if(e<n)throw new t("Not enough arguments");return e}},8622:function(e,t,n){var i=n(4576),r=n(4901),s=i.WeakMap;e.exports=r(s)&&/native code/.test(String(s))},8227:function(e,t,n){var i=n(4576),r=n(5745),s=n(9297),o=n(3392),a=n(4495),l=n(7040),c=i.Symbol,u=r("wks"),d=l?c["for"]||c:c&&c.withoutSetter||o;e.exports=function(e){return s(u,e)||(u[e]=a&&s(c,e)?c[e]:d("Symbol."+e)),u[e]}},6573:function(e,t,n){var i=n(3724),r=n(2106),s=n(3238),o=ArrayBuffer.prototype;i&&!("detached"in o)&&r(o,"detached",{configurable:!0,get:function(){return s(this)}})},7936:function(e,t,n){var i=n(6518),r=n(5636);r&&i({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return r(this,arguments.length?arguments[0]:void 0,!1)}})},8100:function(e,t,n){var i=n(6518),r=n(5636);r&&i({target:"ArrayBuffer",proto:!0},{transfer:function(){return r(this,arguments.length?arguments[0]:void 0,!0)}})},4114:function(e,t,n){var i=n(6518),r=n(8981),s=n(6198),o=n(4527),a=n(6837),l=n(9039),c=l((function(){return 4294967297!==[].push.call({length:4294967296},1)})),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},d=c||!u();i({target:"Array",proto:!0,arity:1,forced:d},{push:function(e){var t=r(this),n=s(t),i=arguments.length;a(n+i);for(var l=0;l<i;l++)t[n]=arguments[l],n++;return o(t,n),n}})},8111:function(e,t,n){var i=n(6518),r=n(4576),s=n(679),o=n(8551),a=n(4901),l=n(2787),c=n(2106),u=n(4659),d=n(9039),h=n(9297),p=n(8227),f=n(7657).IteratorPrototype,m=n(3724),g=n(6395),_="constructor",v="Iterator",y=p("toStringTag"),b=TypeError,A=r[v],w=g||!a(A)||A.prototype!==f||!d((function(){A({})})),x=function(){if(s(this,f),l(this)===f)throw new b("Abstract class Iterator not directly constructable")},E=function(e,t){m?c(f,e,{configurable:!0,get:function(){return t},set:function(t){if(o(this),this===f)throw new b("You can't redefine this property");h(this,e)?this[e]=t:u(this,e,t)}}):f[e]=t};h(f,y)||E(y,v),!w&&h(f,_)&&f[_]!==Object||E(_,x),x.prototype=f,i({global:!0,constructor:!0,forced:w},{Iterator:x})},1148:function(e,t,n){var i=n(6518),r=n(2652),s=n(9306),o=n(8551),a=n(1767);i({target:"Iterator",proto:!0,real:!0},{every:function(e){o(this),s(e);var t=a(this),n=0;return!r(t,(function(t,i){if(!e(t,n++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},2489:function(e,t,n){var i=n(6518),r=n(9565),s=n(9306),o=n(8551),a=n(1767),l=n(9462),c=n(6319),u=n(6395),d=l((function(){var e,t,n,i=this.iterator,s=this.predicate,a=this.next;while(1){if(e=o(r(a,i)),t=this.done=!!e.done,t)return;if(n=e.value,c(i,s,[n,this.counter++],!0))return n}}));i({target:"Iterator",proto:!0,real:!0,forced:u},{filter:function(e){return o(this),s(e),new d(a(this),{predicate:e})}})},116:function(e,t,n){var i=n(6518),r=n(2652),s=n(9306),o=n(8551),a=n(1767);i({target:"Iterator",proto:!0,real:!0},{find:function(e){o(this),s(e);var t=a(this),n=0;return r(t,(function(t,i){if(e(t,n++))return i(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},531:function(e,t,n){var i=n(6518),r=n(9565),s=n(9306),o=n(8551),a=n(1767),l=n(8646),c=n(9462),u=n(9539),d=n(6395),h=c((function(){var e,t,n=this.iterator,i=this.mapper;while(1){if(t=this.inner)try{if(e=o(r(t.next,t.iterator)),!e.done)return e.value;this.inner=null}catch(s){u(n,"throw",s)}if(e=o(r(this.next,n)),this.done=!!e.done)return;try{this.inner=l(i(e.value,this.counter++),!1)}catch(s){u(n,"throw",s)}}}));i({target:"Iterator",proto:!0,real:!0,forced:d},{flatMap:function(e){return o(this),s(e),new h(a(this),{mapper:e,inner:null})}})},7588:function(e,t,n){var i=n(6518),r=n(2652),s=n(9306),o=n(8551),a=n(1767);i({target:"Iterator",proto:!0,real:!0},{forEach:function(e){o(this),s(e);var t=a(this),n=0;r(t,(function(t){e(t,n++)}),{IS_RECORD:!0})}})},1701:function(e,t,n){var i=n(6518),r=n(713),s=n(6395);i({target:"Iterator",proto:!0,real:!0,forced:s},{map:r})},8237:function(e,t,n){var i=n(6518),r=n(2652),s=n(9306),o=n(8551),a=n(1767),l=TypeError;i({target:"Iterator",proto:!0,real:!0},{reduce:function(e){o(this),s(e);var t=a(this),n=arguments.length<2,i=n?void 0:arguments[1],c=0;if(r(t,(function(t){n?(n=!1,i=t):i=e(i,t,c),c++}),{IS_RECORD:!0}),n)throw new l("Reduce of empty iterator with no initial value");return i}})},3579:function(e,t,n){var i=n(6518),r=n(2652),s=n(9306),o=n(8551),a=n(1767);i({target:"Iterator",proto:!0,real:!0},{some:function(e){o(this),s(e);var t=a(this),n=0;return r(t,(function(t,i){if(e(t,n++))return i()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1806:function(e,t,n){var i=n(6518),r=n(8551),s=n(2652),o=n(1767),a=[].push;i({target:"Iterator",proto:!0,real:!0},{toArray:function(){var e=[];return s(o(r(this)),a,{that:e,IS_RECORD:!0}),e}})},9479:function(e,t,n){var i=n(4576),r=n(3724),s=n(2106),o=n(7979),a=n(9039),l=i.RegExp,c=l.prototype,u=r&&a((function(){var e=!0;try{l(".","d")}catch(u){e=!1}var t={},n="",i=e?"dgimsy":"gimsy",r=function(e,i){Object.defineProperty(t,e,{get:function(){return n+=i,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(s.hasIndices="d"),s)r(o,s[o]);var a=Object.getOwnPropertyDescriptor(c,"flags").get.call(t);return a!==i||n!==i}));u&&s(c,"flags",{configurable:!0,get:o})},7642:function(e,t,n){var i=n(6518),r=n(3440),s=n(4916);i({target:"Set",proto:!0,real:!0,forced:!s("difference")},{difference:r})},8004:function(e,t,n){var i=n(6518),r=n(9039),s=n(8750),o=n(4916),a=!o("intersection")||r((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));i({target:"Set",proto:!0,real:!0,forced:a},{intersection:s})},3853:function(e,t,n){var i=n(6518),r=n(4449),s=n(4916);i({target:"Set",proto:!0,real:!0,forced:!s("isDisjointFrom")},{isDisjointFrom:r})},5876:function(e,t,n){var i=n(6518),r=n(3838),s=n(4916);i({target:"Set",proto:!0,real:!0,forced:!s("isSubsetOf")},{isSubsetOf:r})},2475:function(e,t,n){var i=n(6518),r=n(8527),s=n(4916);i({target:"Set",proto:!0,real:!0,forced:!s("isSupersetOf")},{isSupersetOf:r})},5024:function(e,t,n){var i=n(6518),r=n(3650),s=n(4916);i({target:"Set",proto:!0,real:!0,forced:!s("symmetricDifference")},{symmetricDifference:r})},1698:function(e,t,n){var i=n(6518),r=n(4204),s=n(4916);i({target:"Set",proto:!0,real:!0,forced:!s("union")},{union:r})},7467:function(e,t,n){var i=n(7628),r=n(4644),s=r.aTypedArray,o=r.exportTypedArrayMethod,a=r.getTypedArrayConstructor;o("toReversed",(function(){return i(s(this),a(this))}))},4732:function(e,t,n){var i=n(4644),r=n(9504),s=n(9306),o=n(5370),a=i.aTypedArray,l=i.getTypedArrayConstructor,c=i.exportTypedArrayMethod,u=r(i.TypedArrayPrototype.sort);c("toSorted",(function(e){void 0!==e&&s(e);var t=a(this),n=o(l(t),t);return u(n,e)}))},9577:function(e,t,n){var i=n(9928),r=n(4644),s=n(1108),o=n(1291),a=n(5854),l=r.aTypedArray,c=r.getTypedArrayConstructor,u=r.exportTypedArrayMethod,d=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();u("with",{with:function(e,t){var n=l(this),r=o(e),u=s(n)?a(t):+t;return i(n,c(n),r,u)}}["with"],!d)},8992:function(e,t,n){n(8111)},3215:function(e,t,n){n(1148)},4520:function(e,t,n){n(2489)},2577:function(e,t,n){n(116)},670:function(e,t,n){n(531)},3949:function(e,t,n){n(7588)},1454:function(e,t,n){n(1701)},8872:function(e,t,n){n(8237)},7550:function(e,t,n){n(3579)},1795:function(e,t,n){n(1806)},6368:function(e,t,n){var i=n(6518),r=n(4576),s=n(9225).clear;i({global:!0,bind:!0,enumerable:!0,forced:r.clearImmediate!==s},{clearImmediate:s})},4979:function(e,t,n){var i=n(6518),r=n(4576),s=n(7751),o=n(6980),a=n(4913).f,l=n(9297),c=n(679),u=n(3167),d=n(2603),h=n(5002),p=n(8574),f=n(3724),m=n(6395),g="DOMException",_=s("Error"),v=s(g),y=function(){c(this,b);var e=arguments.length,t=d(e<1?void 0:arguments[0]),n=d(e<2?void 0:arguments[1],"Error"),i=new v(t,n),r=new _(t);return r.name=g,a(i,"stack",o(1,p(r.stack,1))),u(i,this,y),i},b=y.prototype=v.prototype,A="stack"in new _(g),w="stack"in new v(1,2),x=v&&f&&Object.getOwnPropertyDescriptor(r,g),E=!!x&&!(x.writable&&x.configurable),C=A&&!E&&!w;i({global:!0,constructor:!0,forced:m||C},{DOMException:C?y:v});var S=s(g),M=S.prototype;if(M.constructor!==S)for(var T in m||a(M,"constructor",o(1,S)),h)if(l(h,T)){var I=h[T],P=I.s;l(S,P)||a(S,P,o(6,I.c))}},9848:function(e,t,n){n(6368),n(9309)},9309:function(e,t,n){var i=n(6518),r=n(4576),s=n(9225).set,o=n(9472),a=r.setImmediate?o(s,!1):s;i({global:!0,bind:!0,enumerable:!0,forced:r.setImmediate!==a},{setImmediate:a})},4603:function(e,t,n){var i=n(6840),r=n(9504),s=n(655),o=n(2812),a=URLSearchParams,l=a.prototype,c=r(l.append),u=r(l["delete"]),d=r(l.forEach),h=r([].push),p=new a("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&i(l,"delete",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return u(this,e);var i=[];d(this,(function(e,t){h(i,{key:t,value:e})})),o(t,1);var r,a=s(e),l=s(n),p=0,f=0,m=!1,g=i.length;while(p<g)r=i[p++],m||r.key===a?(m=!0,u(this,r.key)):f++;while(f<g)r=i[f++],r.key===a&&r.value===l||c(this,r.key,r.value)}),{enumerable:!0,unsafe:!0})},7566:function(e,t,n){var i=n(6840),r=n(9504),s=n(655),o=n(2812),a=URLSearchParams,l=a.prototype,c=r(l.getAll),u=r(l.has),d=new a("a=1");!d.has("a",2)&&d.has("a",void 0)||i(l,"has",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return u(this,e);var i=c(this,e);o(t,1);var r=s(n),a=0;while(a<i.length)if(i[a++]===r)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:function(e,t,n){var i=n(3724),r=n(9504),s=n(2106),o=URLSearchParams.prototype,a=r(o.forEach);i&&!("size"in o)&&s(o,"size",{get:function(){var e=0;return a(this,(function(){e++})),e},configurable:!0,enumerable:!0})}}]);
//# sourceMappingURL=chunk-vendors.63966b5b.js.map